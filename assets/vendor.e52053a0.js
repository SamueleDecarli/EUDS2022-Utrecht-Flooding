var SCe=Object.defineProperty,ECe=Object.defineProperties;var CCe=Object.getOwnPropertyDescriptors;var q3=Object.getOwnPropertySymbols;var YJ=Object.prototype.hasOwnProperty,ZJ=Object.prototype.propertyIsEnumerable;var XJ=(e,t,i)=>t in e?SCe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,F=(e,t)=>{for(var i in t||(t={}))YJ.call(t,i)&&XJ(e,i,t[i]);if(q3)for(var i of q3(t))ZJ.call(t,i)&&XJ(e,i,t[i]);return e},me=(e,t)=>ECe(e,CCe(t));var W3=(e,t)=>{var i={};for(var r in e)YJ.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&q3)for(var r of q3(e))t.indexOf(r)<0&&ZJ.call(e,r)&&(i[r]=e[r]);return i};function u(e,t,i,r){var s,n=arguments.length,o=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}function mwt(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function gwt(e,t){for(const i of e)if(i!=null&&t(i))return i}function Wue(e){return e!=null&&typeof e[Symbol.iterator]=="function"}const E1=null;function _(e){return e!=null}function M(e){return e==null}function Qi(e,t){return _(e)?t(e):E1}function ywt(e){return e}function ACe(e,t){if(M(e))throw new Error(t);return e}function ft(e,t){return _(e)?e:typeof t=="function"?t():t}function vwt(e,t){return _(e)?e:t}function lt(e){return _(e)&&e.destroy(),null}function Qe(e){return _(e)&&e.dispose(),null}function Vs(e){return _(e)&&e.remove(),null}function Xh(e){return _(e)&&e.abort(),null}function er(e){return _(e)&&e.release(),null}function MCe(e,t,i){return _(e)&&_(t)?_(i)?i(e,t):e.equals(t):e===t}function OCe(e){return null}function _wt(e,t){const i=new Array;return e.forEach(r=>{const s=t(r);_(s)&&i.push(s)}),i}function bwt(e,t){const i=new Array;for(const r of e)i.push(fu(r,null,t));return i}function wwt(e,t){for(const i of e)Qi(i,t)}function fu(e,t,i){return _(e)?i(e):t}function xwt(e){return e.filter(t=>_(t))}function rs(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}function Twt(e){return e}function x2(e){return Yh(()=>e.forEach(t=>_(t)&&t.remove()))}function Yh(e){return{remove:()=>{e&&(e(),e=void 0)}}}function Swt(e){return Yh(_(e)?()=>e.destroy():void 0)}function RCe(e,t){const i=setTimeout(e,t);return Yh(()=>clearTimeout(i))}class Oh{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*Oh._m:t}getInt(){return this._seed=(Oh._a*this._seed+Oh._c)%Oh._m,this._seed}getFloat(){return this.getInt()/(Oh._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/Oh._m*r}}Oh._m=2147483647,Oh._a=48271,Oh._c=0;function AP(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):e.filter((i,r,s)=>s.indexOf(i)===r)}function i_(e,t,i){if(M(e)&&M(t))return!0;if(M(e)||M(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Kq(e,t){let i=e.length!==t.length;e.length=t.length;for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function PCe(e,t,i){let r,s;return i?(r=t.filter(n=>!e.some(o=>i(o,n))),s=e.filter(n=>!t.some(o=>i(o,n)))):(r=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:r,removed:s}}function ICe(e){return e&&typeof e.length=="number"}function $Ce(e,t){const i=e.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const DCe=!!Array.prototype.fill;function Ewt(e,t){if(DCe)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function LCe(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function Xue(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return i?t>=e[r-1]?-1:o===t?s:s-1:o===t?s:-1}function Yue(e){return e.reduce((t,i)=>t.concat(i||[]),[])}class Zue{constructor(){this.last=0}}const Que=new Zue;function Jue(e,t,i,r){r=r||Que;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(e[o]===t)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(e[o]===t)return r.last=o,o;return-1}function C5(e,t,i,r){const s=i==null?e.length:i,n=Jue(e,t,s,r);if(n!==-1)return e[n]=e[s-1],i==null&&e.pop(),t}const ud=new Set;function NCe(e,t,i=e.length,r=t.length,s,n){if(r===0||i===0)return i;ud.clear();for(let a=0;a<r;++a)ud.add(t[a]);s=s||Que;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(ud.has(e[a])&&(n&&n.push(e[a]),ud.delete(e[a]),e[a]=e[i-1],--i,--a,ud.size===0||i===0))return ud.clear(),i;for(let a=0;a<o;++a)if(ud.has(e[a])&&(n&&n.push(e[a]),ud.delete(e[a]),e[a]=e[i-1],--i,--a,ud.size===0||i===0))return ud.clear(),i;return ud.clear(),i}function FCe(e){return e?(QJ.seed=e,()=>QJ.getFloat()):Math.random}function Cwt(e,t){const i=FCe(t);for(let r=e.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}return e}const QJ=new Oh;function eW(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}let xv;function he(e){return typeof xv[e]=="function"?xv[e]=xv[e](globalThis):xv[e]}var kue,Uue,zue,Vue;xv=((kue=globalThis.dojoConfig)==null?void 0:kue.has)||((Uue=globalThis.esriConfig)==null?void 0:Uue.has)?F(F({},(zue=globalThis.dojoConfig)==null?void 0:zue.has),(Vue=globalThis.esriConfig)==null?void 0:Vue.has):{},he.add=(e,t,i,r)=>((r||xv[e]===void 0)&&(xv[e]=t),i&&he(e)),he.cache=xv,he.add("esri-deprecation-warnings",!0),(()=>{var t;he.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document;if(he.add("host-browser",e),he.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),he.add("dom",e),he("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(he.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),he.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),he.add("khtml",s.includes("Konqueror")?n:void 0),he.add("edge",parseFloat(r.split("Edge/")[1])||void 0),he.add("opr",parseFloat(r.split("OPR/")[1])||void 0),he.add("webkit",!he("wp")&&!he("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),he.add("chrome",!he("edge")&&!he("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),he.add("android",!he("wp")&&parseFloat(r.split("Android ")[1])||void 0),he.add("safari",!s.includes("Safari")||he("wp")||he("chrome")||he("android")||he("edge")||he("opr")?void 0:parseFloat(s.split("Version/")[1])),he.add("mac",s.includes("Macintosh")),!he("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));he.add(o,l),he.add("ios",l)}he.add("trident",parseFloat(s.split("Trident/")[1])||void 0),he("webkit")||(!r.includes("Gecko")||he("wp")||he("khtml")||he("trident")||he("edge")||he.add("mozilla",n),he("mozilla")&&he.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&he.add("esri-mobile",t),i&&he.add("esri-iPhone",i),he.add("esri-geolocation",!!navigator.geolocation)}he.add("esri-canvas-svg-support",!he("trident")),he.add("esri-wasm","WebAssembly"in globalThis),he.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),he.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),he.add("esri-atomics","Atomics"in globalThis),he.add("esri-workers","Worker"in globalThis),he.add("web-feat:cache","caches"in globalThis),he.add("esri-workers-arraybuffer-transfer",!he("safari")||Number(he("safari"))>=12),he.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),he.add("featurelayer-simplify-payload-size-factors",[1,1,4]),he.add("featurelayer-snapshot-enabled",!0),he.add("featurelayer-snapshot-point-min-threshold",8e4),he.add("featurelayer-snapshot-point-max-threshold",4e5),he.add("featurelayer-snapshot-point-coverage",.1),he.add("featurelayer-advanced-symbols",!1),he.add("featurelayer-pbf",!0),he.add("featurelayer-pbf-statistics",!1),he.add("feature-layers-workers",!0),he.add("feature-polyline-generalization-factor",1),he.add("mapview-transitions-duration",200),he.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),he.add("mapserver-pbf-enabled",!1),he.add("mapimagelayer-popup-identify-max-tolerance",20),he.add("heatmap-allow-raster-fallback",!0),he.add("heatmap-force-raster",!1),he("host-webworker")||he("host-browser")&&(he.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),he.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{he.add("esri-image-decode",!0,!0,!0)}).catch(()=>{he.add("esri-image-decode",!1,!0,!0)})}return!1}),he.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();function kCe(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function tW(e,t,i){if(e.slice)return e.slice(t,i);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),i===void 0?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new e.constructor(r);for(let n=0;n<r;n++)s[n]=e[t+n];return s}function vC(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function UCe(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function bb(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function zCe(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function Kue(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function oF(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function ehe(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function aF(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function the(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function ihe(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function VCe(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}function X3(e){return M(e)?0:128+e.buffer.byteLength+64}function rhe(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&rhe(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function ie(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=ahe(e);if(_(t))return t;if(she(e))return e.clone();if(nhe(e))return e.map(ie);if(ohe(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=ie(e[r]);return i}function I8(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=ahe(e);if(_(t))return t;if(nhe(e)){let i=!0;const r=e.map(s=>{const n=I8(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(she(e))return e.clone();if(!ohe(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],n=I8(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function she(e){return typeof e.clone=="function"}function nhe(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function ohe(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function JJ(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function ahe(e){if(UCe(e)||bb(e)||zCe(e)||Kue(e)||oF(e)||ehe(e)||aF(e)||the(e)||ihe(e))return tW(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((i,r)=>{t.set(r,ie(i))}),t}if(e instanceof Set){const t=new Set;return e.forEach(i=>{t.add(ie(i))}),t}return null}function iW(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function BCe(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&i_(e,t):e instanceof Set?t instanceof Set&&jCe(e,t):e instanceof Map?t instanceof Map&&HCe(e,t):!!JJ(e)&&JJ(t)&&GCe(e,t))}function GCe(e,t){if(e===null||t===null)return!1;const i=Object.keys(e);if(t===null||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}function jCe(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function HCe(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const s=t.get(i);if(s!==r||s===void 0&&!t.has(i))return!1}return!0}function Ba(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function qCe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function YD(e,t,i){return i?lF(e,t,{policy:i,path:""}):lF(e,t,null)}function lF(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace")return r[s]=t[s],r;if(r[s]===void 0)return r[s]=ie(t[s]),r;let a=r[s],l=t[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=lF(a,l,i),i.path=c}else r[s]=lF(a,l,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=l);return r},e||{}):e}function lhe(e){return Array.isArray(e)?e:e.split(".")}function KJ(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function WCe(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...KJ(i));return t}return KJ(e)}function che(e,t,i,r){const s=WCe(t);if(s.length!==1){const n=s.map(o=>r(e,o,i));return x2(n)}return r(e,s[0],i)}function rW(e){let t=!1;return()=>{t||(t=!0,e())}}function uhe(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const r=Ba(t);return qCe(r,i)?r.get(i):t[i]}function hhe(e,t,i){if(e==null)return e;const r=uhe(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:hhe(r,t,i+1)}function MP(e,t,i=0){return typeof t!="string"||t.includes(".")?hhe(e,lhe(t),i):uhe(t,e)}function cF(e,t){return MP(e,t)}function eK(e,t){return MP(t,e)!==void 0}var kf;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(kf||(kf={}));class tK{constructor(t){this.autoDestroy=!1,this.properties=t}}function OP(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const r=Object.create(t.properties),s=t.autoDestroy;for(const n in r)r[n]=ie(r[n]);t=new tK(r),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new tK({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function XCe(e){return OP(e).properties}function A5(e,t){const i=XCe(e);let r=i[t];return r||(r=i[t]={}),r}function YCe(e,t){return YD(e,t,QCe)}const ZCe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function QCe(e){return ZCe.test(e)?"replace":"merge"}function dhe(e,t,i=!1){return fhe(e,t,i)}function VE(e,t){if(t!=null)return t[e]||phe(e.split("."),!1,t)}function xc(e,t,i){const r=e.split("."),s=r.pop(),n=phe(r,!0,i);n&&s&&(n[s]=t)}function phe(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function fhe(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=r[s],o=t[s];return n===o?r:n===void 0?(r[s]=ie(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=fhe(n,o,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=o),r)},e||{}):e}var Bue;const ki={apiKey:void 0,applicationUrl:(Bue=globalThis.location)==null?void 0:Bue.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(dhe(ki,globalThis.esriConfig,!0),delete ki.has),!ki.assetsPath){const e="4.24.4";ki.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}ki.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(ki,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),ki.request.corsEnabledServers=[],ki.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const JCe=/\{([^\}]+)\}/g;function iK(e){return e==null?"":e}function rm(e,t){return e.replace(JCe,typeof t=="object"?(i,r)=>iK(VE(r,t)):(i,r)=>iK(t(r)))}function mhe(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.includes(i)?i:`\\${i}`)}function sW(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function Awt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const rK={info:0,warn:1,error:2,none:3};class ge{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,ge._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=ge.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const i=ge._loggers;return ge._loggers=t,i},set throttlingDisabled(t){ge._throttlingDisabled=t}}}static getLogger(t){let i=ge._loggers[t];return i||(i=new ge({module:t})),i}_log(t,i,...r){if(!!this._matchLevel(t)){if(i!=="always"&&!ge._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[t].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=ge._tickCounter)return;this._loggedMessages[t].set(s,ge._tickCounter),ge._scheduleTickCounterIncrement()}for(const s of ki.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;_(r);){const s=r[t];if(_(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=ki.log.level?ki.log.level:"warn";return rK[this._parentWithMember("level",i)]<=rK[t]}_argsToKey(...t){const i=(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return sW(JSON.stringify(t,i))}static _scheduleTickCounterIncrement(){ge._tickCounterScheduled||(ge._tickCounterScheduled=!0,Promise.resolve().then(()=>{ge._tickCounter++,ge._tickCounterScheduled=!1}))}}ge._loggers={},ge._tickCounter=0,ge._tickCounterScheduled=!1,ge._throttlingDisabled=!1;function KCe(e){return e&&e.release&&typeof e.release=="function"}function eAe(e){return e&&e.acquire&&typeof e.acquire=="function"}class Es{constructor(t,i,r,s=1,n=0){if(this.ctor=t,this.acquireFunction=i,this.releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let o=0;o<n;o++)this._pool[o]=new this.ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(Es.test.disabled)i=new this.ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this.ctor}i=this._pool.pop()}return this.acquireFunction?this.acquireFunction(i,...t):eAe(i)&&i.acquire(...t),i}release(t){t&&!Es.test.disabled&&(this.releaseFunction?this.releaseFunction(t):KCe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}Es.test={disabled:!1};var Oi;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(Oi||(Oi={}));const $8=Oi.USER+1;function Tv(e){switch(e){case"defaults":return Oi.DEFAULTS;case"service":return Oi.SERVICE;case"portal-item":return Oi.PORTAL_ITEM;case"web-scene":return Oi.WEB_SCENE;case"web-map":return Oi.WEB_MAP;case"user":return Oi.USER}}function uF(e){switch(e){case Oi.DEFAULTS:return"defaults";case Oi.SERVICE:return"service";case Oi.PORTAL_ITEM:return"portal-item";case Oi.WEB_SCENE:return"web-scene";case Oi.WEB_MAP:return"web-map";case Oi.USER:return"user"}return void 0}function tAe(e){return uF(e)}var br;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(br||(br={}));let hF,LA=[];const iAe=ge.getLogger("esri.core.Accessor");function Kt(e){hF!==void 0&&hF.onObservableAccessed(e)}let ZD=!1,QD=!1;function ny(e,t,i){if(ZD)return nW(e,t,i);ghe(e);const r=t.call(i);return yhe(),r}function rAe(e,t){return ny(void 0,e,t)}function nW(e,t,i){const r=ZD;ZD=!0,ghe(e);let s=null;try{s=t.call(i)}catch(n){QD&&iAe.error(n)}return yhe(),ZD=r,s}function ghe(e){hF=e,LA.push(e)}function yhe(){const e=LA.pop();hF=LA.length>0?LA[LA.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function vhe(e,t){if(t.flags&br.DepTrackingInitialized)return;const i=QD;QD=!1,t.flags&br.AutoTracked?nW(t,t.metadata.get,e):_he(e,t),QD=i}const sAe=[];function _he(e,t){t.flags&br.ExplicitlyTracking||(t.flags|=br.ExplicitlyTracking,nW(t,()=>{const i=t.metadata.dependsOn||sAe;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=lhe(r);for(let n=0,o=e;n<s.length&&o!=null&&typeof o=="object";++n)o=sK(o,s[n],n!==s.length-1)}else sK(e,r,!1)}),t.flags&=~br.ExplicitlyTracking)}function sK(e,t,i){var n;const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=Ba(e))==null?void 0:n.properties.get(r);return s&&(Kt(s),vhe(e,s)),i?e[r]:void 0}class bhe{constructor(t,i){this._observers=t,this._observer=i}remove(){eW(this._observers,this._observer)}}class nK{constructor(t,i,r){this.properties=t,this.propertyName=i,this.metadata=r,this._observers=null,this._accessed=null,this._handles=null,this.flags=br.Dirty|(r.nonNullable?br.NonNullable:0)|(r.hasOwnProperty("value")?br.HasDefaultValue:0)|(r.get===void 0?br.DepTrackingInitialized:0)|(r.dependsOn===void 0?br.AutoTracked:0)}destroy(){if(this.flags&br.Dirty&&this._observers){const t=this._observers.slice();for(const i of t)i.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){Kt(this);const t=this.properties.store,i=this.propertyName,r=this.flags,s=t.get(i);if(r&br.Computing||~r&br.Dirty&&t.has(i))return s;this.flags|=br.Computing;const n=this.properties.host;let o;r&br.AutoTracked?o=ny(this,this.metadata.get,n):(_he(n,this),o=this.metadata.get.call(n)),t.set(i,o,Oi.COMPUTED);const a=t.get(i);return a===s?this.flags&=~br.Dirty:rAe(this.commit,this),this.flags&=~br.Computing,a}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=br.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let r=0;r<t.length;++r)i.push(t[r].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new bhe(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&br.Overriden&&(this.flags|=br.Dirty);const t=this._observers;if(t!==null)for(let i=0;i<t.length;++i)t[i].onInvalidated()}commit(){this.flags&=~br.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let i=0;i<t.length;++i)t[i].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}}class oW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new oW;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,ie(r))}),i}get(t){return this._values.get(t)}originOf(){return Oi.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function Y3(e,t,i){return e!==void 0}function oK(e,t,i,r){return e!==void 0&&(!(i==null&&e.flags&br.NonNullable)||(r.lifecycle,kf.INITIALIZING,!1))}function nAe(e){return e&&typeof e.destroy=="function"}ge.getLogger("esri.core.accessorSupport.Properties");class oAe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=kf.INITIALIZING,this.store=new oW,this._origin=Oi.USER;const i=this.host.constructor.__accessorMetadata__,r=i.properties;for(const s in r){const n=new nK(this,s,r[s]);this.properties.set(s,n)}this.metadatas=r,this._autoDestroy=i.autoDestroy}initialize(){this.lifecycle=kf.CONSTRUCTING}constructed(){this.lifecycle=kf.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,i]of this.properties){const r=this.internalGet(t);r&&nAe(r)&&(r.destroy(),~i.flags&br.NonNullable&&this._internalSet(i,null)),i.destroy()}else for(const[t,i]of this.properties)i.destroy()}get initialized(){return this.lifecycle!==kf.INITIALIZING}get(t){const i=this.properties.get(t);if(i.metadata.get)return i.getComputed();Kt(i);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.properties.get(t);if(r!==void 0&&r.flags&br.HasDefaultValue)return"defaults"}return uF(i)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const i=this.properties.get(t);if(Y3(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.properties.get(t);Y3(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.properties.get(i);if(!Y3(s))return"";const n=new Set,o=ny({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${r}${t.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof nK))continue;const c=l.properties.host,h=l.propertyName,p=Ba(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(t,i,r){const s=this.properties.get(t);if(Y3(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.properties.get(t);return i!==void 0&&!!(i.flags&br.Overriden)}clearOverride(t){const i=this.properties.get(t);i!==void 0&&i.flags&br.Overriden&&(i.flags&=~br.Overriden,i.notifyChange())}override(t,i){const r=this.properties.get(t);if(!oK(r,t,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(Mz.release(n),!o)return;i=a}r.flags|=br.Overriden,this._internalSet(r,i)}set(t,i){const r=this.properties.get(t);if(!oK(r,t,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(Mz.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=Tv(t)}getDefaultOrigin(){return uF(this._origin)}notifyChange(t){const i=this.properties.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.properties.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.properties.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==kf.INITIALIZING?this._origin:Oi.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,n=t.propertyName;s.has(n,r)&&iW(i,s.get(n))&&~t.flags&br.Overriden&&r===s.originOf(n)||(t.invalidate(),s.set(n,i,r),t.commit(),vhe(this.host,t))}_cast(t,i){const r=Mz.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}}class aAe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const Mz=new Es(aAe);function lAe(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=VE(r,t),n=s==null?"":s;if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}class M5{constructor(t,i,r){this.name=t,this.details=r,this.message=void 0,this instanceof M5&&(this.message=i&&lAe(i,r)||"")}toString(){return"["+this.name+"]: "+this.message}}class q extends M5{constructor(t,i,r){if(super(t,i,r),!(this instanceof q))return new q(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ie(i)}catch{return"[object]"}}))}}catch(t){throw ge.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new q(t.name,t.message,t.details)}}q.prototype.type="error";function dF(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))dF(e,r,t[r]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void dF(cF(e,s),n,i)}const r=e.__accessor__;r!=null&&cAe(t,r),e[t]=i}}function cAe(e,t){if(he("esri-unknown-property-errors")&&!uAe(e,t))throw new q("set:unknown-property",hAe(e,t))}function uAe(e,t){return t.metadatas[e]!=null}function hAe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}ge.getLogger("esri.core.accessorSupport.set");function dAe(e){e.length=0}class cc{constructor(t=50,i=50){this._pool=new Es(Array,void 0,dAe,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return Oz.acquire()}static release(t){return Oz.release(t)}static prune(){Oz.prune()}}const Oz=new cc(100);class whe extends Es{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=OCe(this._set)}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const Z3=[];function T2(e){Z3.push(e),Z3.length===1&&queueMicrotask(()=>{const t=Z3.slice();Z3.length=0;for(const i of t)i()})}const pAe=29;class Gv{constructor(t,i=pAe){this.name=t,this._counter=0,this._items=new Array(i)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,i)=>t-i)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,i)=>t+i,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var D8;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=r,e.iterableSort=s})(D8||(D8={}));const aK=D8,fAe=1.5,mAe=1.1;class Gt{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Zue,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>lK(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,i){const r=this.data.indexOf(t,i);return r!==-1&&r<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,lK(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=Jue(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){const i=C5(this.data,t,this.length,this._hint);return i!==void 0&&(this.length=this.length-1),this._shrink(),i}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=NCe(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){t>=this.length||i>=this.length||t===i||([this.data[t],this.data[i]]=[this.data[i],this.data[t]])}sort(t){aK.sort(this.data,0,this.length,t)}iterableSort(t){return aK.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)t.call(i,s[n],n,s)}forEach(t,i){for(let r=0;r<this.length;++r)t.call(i,this.data[r],r,this.data)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}}function lK(e){e.data.length>fAe*e.length&&(e.data.length=Math.floor(e.length*mAe))}function gAe(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return{remove:()=>e.clearTimeout(r)}}}}const O5=gAe(globalThis),cK=new Set;function yAe(e,t,i=!1){i&&cK.has(t)||(i&&cK.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function vAe(e,t,i={}){if(he("esri-deprecation-warnings")){const{moduleName:r}=i;xhe(e,`Property: ${(r?r+"::":"")+t}`,i)}}function xhe(e,t,i={}){if(he("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=t;r&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${r}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),yAe(e,a,o)}}function R5(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function BE(e,t,i){if(!R5(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const s of r)e.addEventListener(s,i);return{remove(){for(const s of r)e.removeEventListener(s,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function The(e,t,i){if(!R5(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=BE(e,t,s=>{r.remove(),i.call(e,s)});return{remove(){r.remove()}}}function _Ae(e,t,i){let r=!1;const s=BE(e,t,n=>{r||i.call(e,n)});return{resume(){r=!1},pause(){r=!0},remove(){s.remove()}}}const bAe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function vl({key:e}){return bAe[e]||e}function hi(e="Aborted"){return new q("AbortError",e)}function ci(e,t="Aborted"){if(nn(e))throw hi(t)}function P5(e){return _(e)?"aborted"in e?e:e.signal:e}function nn(e){const t=P5(e);return _(t)&&t.aborted}function by(e){if(Qr(e))throw e}function L8(e){if(!Qr(e))throw e}function ha(e,t){const i=P5(e);if(!M(i)){if(!i.aborted)return The(i,"abort",()=>t());t()}}function I5(e,t){const i=P5(e);if(!M(i))return ci(i),The(i,"abort",()=>t(hi()))}function wAe(e,t){const i=P5(t);return M(i)?e:new Promise((r,s)=>{let n=ha(t,()=>s(hi()));const o=()=>n=Vs(n);e.then(o,o),e.then(r,s)})}function Qr(e){return e&&e.name==="AbortError"}async function N8(e){try{return await e}catch(t){if(!Qr(t))throw t}}async function Mwt(e,t=ge.getLogger("esri")){try{return await e}catch(i){Qr(i)||t.error(i)}}function r_(){let e=null;const t=new Promise((i,r)=>{e={promise:void 0,resolve:i,reject:r}});return e.promise=t,e}async function Sn(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e),r=i.map(o=>e[o]),s=await Sn(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(i=>{const r=[];let s=t.length;s===0&&i(r),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function xAe(e){return(await Sn(e)).filter(t=>!!t.value).map(t=>t.value)}function S2(e,t,i){const r=new AbortController;return ha(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);ha(r,()=>{o&&(clearTimeout(o),n(hi()))})})}function Bu(e){return e&&typeof e.then=="function"}function F8(e){return Bu(e)?e:Promise.resolve(e)}function aW(e,t=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(hi()),n=r_();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||r_(),n=null,t>0){const f=new AbortController;i=F8(e(...l,f.signal));const m=i;S2(t).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=F8(e(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function bp(){let e,t;const i=new Promise((s,n)=>{e=s,t=n}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,n)=>O5.setTimeout(()=>r.reject(n),s),r.promise=i,r}function Owt(e,t){return e.then(t,t)}function RP(e,t){let i,r=new AbortController;const s=e(r.signal);let n={promise:s,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const o=()=>{n&&(n.finished=!0,n=null),_(i)&&(i.remove(),i=null),r=null};return s.then(o,o),i=ha(t,()=>{_(n)&&n.abort()}),n}async function uK(e){await Promise.resolve(),ci(e)}function She(e){return 1e3*e}function lW(e){return .001*e}class TAe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class SAe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let k8=0,U8=0;const _C={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},z8=["prepare","preRender","render","postRender","update","finish"],V8=[],yw=new Gt;class EAe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const pF={frameTasks:yw,willDispatch:!1,clearFrameTasks:CAe,dispatch:Ahe,executeFrameTasks:MAe};function ix(e){const t=new SAe(e);return V8.push(t),pF.willDispatch||(pF.willDispatch=!0,T2(Ahe)),t}function vw(e){const t=new TAe(e);return yw.push(t),fF==null&&(k8=performance.now(),fF=requestAnimationFrame(Ehe)),new EAe(t)}let fF=null;function CAe(e=!1){yw.forAll(t=>{t.removed=!0}),e&&Che()}function AAe(e){U8=Math.max(0,e)}function Ehe(){const e=performance.now();fF=null,fF=yw.length>0?requestAnimationFrame(Ehe):null,pF.executeFrameTasks(e)}function MAe(e){const t=e-k8;k8=e;const i=U8>0?U8:1e3/60,r=Math.max(0,t-i);for(let s=0;s<z8.length;s++){const n=performance.now(),o=z8[s];yw.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(_C.time=e,_C.deltaTime=a.ticks===0?0:t,_C.elapsedFrameTime=performance.now()-e,_C.frameDuration=i-r,(l=a.phases[o])==null||l.call(a,_C)))}),OAe[s].record(performance.now()-n)}Che(),RAe.record(performance.now()-e)}const Q3=new Gt;function Che(){yw.forAll(e=>{e.removed&&Q3.push(e)}),yw.removeUnorderedMany(Q3.data,Q3.length),Q3.clear()}function Ahe(){for(;V8.length;){const e=V8.shift();e.isActive&&e.callback()}pF.willDispatch=!1}function Rwt(e=1,t){const i=bp(),r=()=>{nn(t)?i.reject(hi()):e===0?i():(--e,T2(()=>r()))};return r(),i.promise}const OAe=z8.map(e=>new Gv(e)),RAe=new Gv("total");function JD(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}let PAe=0;const IAe=0;function Tl(){return++PAe}class $5{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed;for(let r=0;r<i.length;++r)t.push(i[r].observe(this));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}let XS=!1;const mF=[];function Mhe(e,t){let i=new $5(n),r=null,s=!1;function n(){if(!i||s)return;if(XS)return void Phe(n);const a=r;i.clear(),XS=!0,s=!0,r=ny(i,e),s=!1,XS=!1,t(r,a),Ihe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=ny(i,e),s=!1,{remove:o}}function Ohe(e,t){let i=new $5(s),r=null;function s(){t(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=ny(i,e),r):null}return o(),{remove:n}}function Rhe(e){let t=new $5(r),i=!1;function r(){t&&!i&&(XS?Phe(r):(t.clear(),XS=!0,i=!0,ny(t,e),i=!1,XS=!1,Ihe()))}function s(){t&&(t.destroy(),t=null)}return i=!0,ny(t,e),i=!1,{remove:s}}function Phe(e){mF.includes(e)||mF.unshift(e)}function Ihe(){for(;mF.length;)mF.pop()()}var iO;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(iO||(iO={}));class QO{constructor(){this.uid=Tl(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,n){return this.pool.acquire(iO.Untracked,t,i,r,s,n,iW)}static acquireTracked(t,i,r,s){return this.pool.acquire(iO.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===iO.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i)}acquire(t,i,r,s,n,o,a){this.uid=Tl(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Tl(),this.removed=!0}}QO.pool=new whe(QO);const KD=new cc,Hg=new Set;let gF;function yF(e){Hg.delete(e),Hg.add(e),gF||(gF=ix(LAe))}function $Ae(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function DAe(e){for(const t of Hg.values())t.target===e&&(t.removed=!0)}function LAe(){let e=10;for(;gF&&e--;){gF=null;const t=NAe(),i=KD.acquire();for(const r of t){const s=r.uid;$Ae(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Hg)r.removed&&(i.push(r),Hg.delete(r));for(const r of i)QO.pool.release(r);KD.release(i),KD.release(t),B8.forEach(r=>r())}}function NAe(){const e=KD.acquire();e.length=Hg.size;let t=0;for(const i of Hg)e[t]=i,++t;return Hg.clear(),e}const B8=new Set;function $he(e){return B8.add(e),{remove(){B8.delete(e)}}}function FAe(e,t,i){let r=che(e,t,i,(s,n,o)=>{let a,l,c=Ohe(()=>MP(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=QO.acquireUntracked(h,o,p,s,n),l=a.uid),yF(a))});return{remove:rW(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,yF(a)),a=null),r=c=null})}});return r}function kAe(e,t,i){const r=che(e,t,i,(s,n,o)=>{let a=!1;return Mhe(()=>MP(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,iW(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function UAe(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?kAe(e,t,i):FAe(e,t,i)}function zAe(e,t,i){let r,s,n=Ohe(e,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=QO.acquireTracked(o,t,a,i),s=r.uid),yF(r))});return{remove:rW(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,yF(r)),r=null),n=null})}}function VAe(e,t,i){let r=!1;return Mhe(e,(s,n)=>{r||(r=!0,i(n,s)||t(s,n),r=!1)})}function BAe(e,t,i=!1,r=BCe){return i?VAe(e,t,r):zAe(e,t,r)}function hK(e){return JD(Hg,t=>t.oldValue===e)}function on(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function Pwt(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function cW(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}const YS=ge.getLogger("esri.core.Accessor");function GAe(e){return e==null?e:new Date(e)}function jAe(e){return e==null?e:!!e}function PP(e){return e==null?e:e.toString()}function Rh(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function uW(e){return e==null?e:Math.round(parseFloat(e))}function Dhe(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function vF(e,t){return t!=null&&e&&!(t instanceof e)}function Lhe(e){return e&&"isCollection"in e}function dK(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function HAe(e,t){if(!t||!t.constructor||!Lhe(t.constructor))return G8(e,t)?t:new e(t);const i=dK(e.prototype.itemType),r=dK(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(G8(e,t),t):new e(t):t}function G8(e,t){return!!Dhe(t)&&(YS.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+D5(e)+"'"),!0)}function E2(e,t){return t==null?t:Lhe(e)?HAe(e,t):vF(e,t)?G8(e,t)?t:new e(t):t}function D5(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const qAe=new WeakMap;function WAe(e){switch(e){case Number:return Rh;case Sr:return uW;case Boolean:return jAe;case String:return PP;case Date:return GAe;default:return cW(qAe,e,()=>E2.bind(null,e))}}function ns(e,t){const i=WAe(e);return arguments.length===1?i:i(t)}function JO(e,t,i){return arguments.length===1?JO.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function XAe(e,t){return arguments.length===1?JO(ns.bind(null,e)):JO(ns.bind(null,e),t)}function Nhe(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>Nhe(e,t-1,r)):e(i)}function _F(e,t,i){if(arguments.length===2)return _F.bind(null,e,t);if(!i)return i;let r=t,s=i=Nhe(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function YAe(e,t,i){return arguments.length===2?_F(ns.bind(null,e),t):_F(ns.bind(null,e),t,i)}function Fhe(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function j8(e,t){if(arguments.length===2)return j8(e).call(null,t);const i=new Set,r=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!vF(a,p))?a:(h&&r.length?(n||(n=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),YS.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>D5(p)).join(", ")),YS.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):YS.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function wp(e,t){if(arguments.length===2)return wp(e).call(null,t);const i={},r=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];i[l]=ns(c),r.push(D5(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!vF(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=i[c];if(!h)return YS.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!vF(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!Dhe(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return h(p)}return h(l)}}class Sr{}const Iwt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function ZAe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function khe(e){switch(e.type){case"native":return ns(e.value);case"array":return JO(khe(e.value));case"one-of":return QAe(e);default:return null}}function QAe(e){let t=null;return(i,r)=>q8(i,e)?i:(t==null&&(t=H8(e)),YS.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function H8(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Sr:return"integer";case Date:return"date";default:return D5(e.value)}case"array":return`array of ${H8(e.value)}`;case"one-of":{const t=e.values.map(i=>H8(i));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function q8(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case Sr:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!q8(i,t.value));case"one-of":return t.values.some(i=>q8(e,i))}}function d(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=A5(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&ge.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=cF(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=cF(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){p!==void 0?this._override(i,p):this._clearOverride(i)}:function(p){dF(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=JAe(o):a&&(Array.isArray(a)?s.cast=JO(wp(a[0])):s.cast=wp(a))),e.range&&(s.cast=KAe(s.cast,e.range)),YCe(s,e)}}function Uhe(e,t,i){const r=A5(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function JAe(e){let t=0,i=e;if(ZAe(e))return khe(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(Fhe(r))return t===0?j8(r):_F(j8(r),t);if(t===1)return XAe(r);if(t>1)return YAe(r,t);const s=e;return s.from?s.from:ns(s)}function KAe(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}function eMe(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(n=>{t[n]=s}),delete t[r]}}}class Iu extends M5{constructor(t,i,r){if(super(t,i,r),!(this instanceof Iu))return new Iu(t,i,r)}}Iu.prototype.type="warning";function zhe(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const W8=ge.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function pK(e,t,i){var r,s;e&&(!i&&!t.read||((r=t.read)==null?void 0:r.reader)||((s=t.read)==null?void 0:s.enabled)===!1||rMe(e)&&xc("read.reader",GE(e),t))}function GE(e){var i,r,s;const t=(i=e.ndimArray)!=null?i:0;if(t>1)return iMe(e);if(t===1)return fK(e);if("type"in e&&Bhe(e.type)){const n=(s=(r=e.type.prototype)==null?void 0:r.itemType)==null?void 0:s.Type,o=fK(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return hW(e)}function hW(e){return"type"in e?tMe(e.type):sMe(e.types)}function tMe(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void W8.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}function Vhe(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>Vhe(e,s,i,r-1)):e(t,void 0,i)}function iMe(e){var s;const t=hW(e),i=Vhe.bind(null,t),r=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=i(n,a,r);let l=r,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function fK(e){const t=hW(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(i,void 0,s);return n!==void 0?[n]:void 0}}function Bhe(e){if(!zhe(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?dW(t.Type):Ghe(t.Type))}function rMe(e){return"types"in e?Ghe(e.types):dW(e.type)}function dW(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||Bhe(e))}function Ghe(e){for(const t in e.typeMap)if(!dW(e.typeMap[t]))return!1;return!0}function sMe(e){var r;let t=null;const i=(r=e.errorContext)!=null?r:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void W8.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=nMe(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new Iu(`${i}:unsupported`,f,{definition:s,context:o})),void W8.error(f)}const p=new h;return p.read(s,o),p}}function nMe(e){var i,r;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=OP(n.prototype);if(typeof e.key=="function")continue;const a=o.properties[e.key];if(!a)continue;((i=a.json)==null?void 0:i.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function oMe(e){if(e.json||(e.json={}),gK(e.json),yK(e.json),mK(e.json),e.json.origins)for(const t in e.json.origins)gK(e.json.origins[t]),yK(e.json.origins[t]),mK(e.json.origins[t]);return!0}function mK(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function gK(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function yK(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const aMe=ge.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function vK(e,t){var r;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const i=(r=e==null?void 0:e.ndimArray)!=null?r:0;e&&(i===1||"type"in e&&zhe(e.type))?t.write.writer=uMe:i>1?t.write.writer=hMe(i):t.types?Array.isArray(t.types)?t.write.writer=cMe(t.types[0]):t.write.writer=lMe(t.types):t.write.writer=KO}function lMe(e){return(t,i,r,s)=>t?jhe(t,e,s)?KO(t,i,r,s):void 0:KO(t,i,r,s)}function jhe(e,t,i){var r,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(i==null?void 0:i.messages){const n=(r=t.errorContext)!=null?r:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new q(`${n}:unsupported`,o,{definition:e,context:i})),aMe.error(o)}return!1}function cMe(e){return(t,i,r,s)=>!t||!Array.isArray(t)?KO(t,i,r,s):KO(t.filter(n=>jhe(n,e,s)),i,r,s)}function KO(e,t,i,r){xc(i,bF(e,r),t)}function bF(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?wF(e):e}function wF(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function uMe(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>bF(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[bF(e,r)],xc(i,s,t)}function Hhe(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>Hhe(r,t,i-1)):bF(e,t)}function hMe(e){return(t,i,r,s)=>{let n;if(t===null)n=null;else{n=Hhe(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}xc(r,n,i)}}function X8(e,t){return pW(e,"read",t)}function qhe(e,t){return pW(e,"write",t)}function pW(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&(t==="any"||t in s)&&(r=s)}return r}function dMe(e){const t=pMe(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?fMe(r):t;pK(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write=F({},e.json.write)),vK(s,r)}pK(t,e.json,!0),vK(t,e.json)}function pMe(e){return e.json.types?Y8(e.json):e.type?Whe(e):Y8(e)}function fMe(e){return e.type?Whe(e):Y8(e)}function Whe(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!Fhe(i);)i=i[0],t++;return{type:i,ndimArray:t}}function Y8(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function mMe(e){oMe(e)&&(eMe(e),dMe(e))}const Rz=new Set,Pz=new Set;function P(e){return t=>{t.prototype.declaredClass=e,yMe(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!Rz.has(s.initialize)&&(Rz.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!Pz.has(s.destroy)&&(Pz.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);Rz.clear(),Pz.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<r.length;c++)r[c].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=OP(t.prototype),n.prototype.declaredClass=e,n}}function gMe(e,t){return t.get==null?function(){const i=this.__accessor__.properties.get(e);if(i===void 0)return;Kt(i);const r=this.__accessor__.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const i=this.__accessor__.properties.get(e);if(i!==void 0)return i.getComputed()}}function yMe(e){const t=e.prototype,i=OP(t).properties,r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];mMe(n),r[s]={enumerable:!0,configurable:!0,get:gMe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===kf.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,r)}var Xhe;function vMe(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const NA=Symbol("Accessor-Handles");class Se{constructor(...t){if(this[Xhe]=null,this.constructor===Se)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new oAe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}OP(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:t[a]}for(const a in i){const l=vMe(i[a]);d(l)(o.prototype,a)}return P(r)(o)}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(Qi(this[NA],t=>{t.forEach(i=>i.remove())}),this[NA]=null,DAe(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===kf.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return cF(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return dF(this,t,i),this}watch(t,i,r){return UAe(this,t,i,r)}own(t){let i=this[NA];if(M(i)&&(i=this[NA]=new Set),Wue(t))for(const r of t)i.add(r);else i.add(t)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,i){return this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}}Xhe=NA;ge.getLogger("esri.core.Clonable");const Oc=e=>{let t=class extends e{clone(){var l;const i=ACe(Ba(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==Oi.USER&&p!==Oi.DEFAULTS&&p!==Oi.WEB_MAP&&p!==Oi.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof f=="function"?f(m):f==="reference"?m:I8(m),m!=null&&y==null||(p===Oi.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=Ba(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Oi.DEFAULTS)}return a}};return t=u([P("esri.core.Clonable")],t),t};let _K=class extends Oc(Se){};_K=u([P("esri.core.Clonable")],_K);function R(){return[0,0,0]}function Bs(e){return[e[0],e[1],e[2]]}function Fe(e,t,i){return[e,t,i]}function pl(e){const t=R(),i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function fW(e,t){return new Float64Array(e,t,3)}function Yhe(){return R()}function Zhe(){return Fe(1,1,1)}function Qhe(){return Fe(1,0,0)}function Jhe(){return Fe(0,1,0)}function mW(){return Fe(0,0,1)}const za=Yhe(),Gf=Zhe(),_Me=Qhe(),bMe=Jhe(),Khe=mW();Object.freeze(Object.defineProperty({__proto__:null,create:R,clone:Bs,fromValues:Fe,fromArray:pl,createView:fW,zeros:Yhe,ones:Zhe,unitX:Qhe,unitY:Jhe,unitZ:mW,ZEROS:za,ONES:Gf,UNIT_X:_Me,UNIT_Y:bMe,UNIT_Z:Khe},Symbol.toStringTag,{value:"Module"}));const Et=1e-6,sp=Math.random,wMe=Math.PI/180,xMe=180/Math.PI;function L5(e){return e*wMe}function TMe(e){return e*xMe}function SMe(e,t){return Math.abs(e-t)<=Et*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:Et,RANDOM:sp,toRadian:L5,toDegree:TMe,equals:SMe},Symbol.toStringTag,{value:"Module"}));function Oe(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function le(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ne(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function de(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function pe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function N5(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function xF(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function EMe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function CMe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Z8(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function ede(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function tde(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function AMe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function MMe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function ce(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Fb(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function hr(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function Gs(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function Fa(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function ca(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function OMe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function we(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function Te(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ct(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function dn(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function RMe(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+s[0]*h,e[1]=t[1]*a+i[1]*l+r[1]*c+s[1]*h,e[2]=t[2]*a+i[2]*l+r[2]*c+s[2]*h,e}function PMe(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+i[0]*h+r[0]*p+s[0]*f,e[1]=t[1]*c+i[1]*h+r[1]*p+s[1]*f,e[2]=t[2]*c+i[2]*h+r[2]*p+s[2]*f,e}function IMe(e,t){t=t||1;const i=2*sp()*Math.PI,r=2*sp()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=r*t,e}function ke(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function fc(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function Eu(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-r*c,f=r*l-s*a,m=s*f-n*p,y=n*h-r*f,v=r*p-s*h;const w=2*o;return h*=w,p*=w,f*=w,m*=2,y*=2,v*=2,e[0]=a+h+m,e[1]=l+p+y,e[2]=c+f+v,e}function $Me(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function DMe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function LMe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function NMe(e,t){le(J3,e),le(K3,t),we(J3,J3),we(K3,K3);const i=Te(J3,K3);return i>1?0:i<-1?Math.PI:Math.acos(i)}const J3=R(),K3=R();function FMe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function bl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function _w(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=t[0],o=t[1],a=t[2];return Math.abs(i-n)<=Et*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Et*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Et*Math.max(1,Math.abs(s),Math.abs(a))}function wy(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const Tc=pe,kMe=N5,UMe=xF,gW=hr,yW=Gs,vW=Oe,Q8=Fa,bK=Object.freeze(Object.defineProperty({__proto__:null,length:Oe,copy:le,set:ne,add:de,subtract:pe,multiply:N5,divide:xF,ceil:EMe,floor:CMe,abs:Z8,sign:ede,min:tde,max:AMe,round:MMe,scale:ce,scaleAndAdd:Fb,distance:hr,squaredDistance:Gs,squaredLength:Fa,negate:ca,inverse:OMe,normalize:we,dot:Te,cross:ct,lerp:dn,hermite:RMe,bezier:PMe,random:IMe,transformMat4:ke,transformMat3:fc,transformQuat:Eu,rotateX:$Me,rotateY:DMe,rotateZ:LMe,angle:NMe,str:FMe,exactEquals:bl,equals:_w,direction:wy,sub:Tc,mul:kMe,div:UMe,dist:gW,sqrDist:yW,len:vW,sqrLen:Q8},Symbol.toStringTag,{value:"Module"}));function np(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ji(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function _W(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function ide(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function rde(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function sde(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function zMe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function VMe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function BMe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function GMe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function jMe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function IP(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function HMe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function nde(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function TF(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function bW(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function wW(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function qMe(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function WMe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ode(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function ade(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function F5(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function XMe(e,t){let i,r,s,n,o,a;t=t||1;do i=2*sp()-1,r=2*sp()-1,o=i*i+r*r;while(o>=1);do s=2*sp()-1,n=2*sp()-1,a=s*s+n*n;while(a>=1);const l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*s*l,e[3]=t*n*l,e}function xu(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function YMe(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,p=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return e[0]=h*c+m*-o+p*-l-f*-a,e[1]=p*c+m*-a+f*-o-h*-l,e[2]=f*c+m*-l+h*-a-p*-o,e[3]=t[3],e}function ZMe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function eR(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function lde(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Et*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Et*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Et*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Et*Math.max(1,Math.abs(n),Math.abs(c))}const QMe=ide,JMe=rde,KMe=sde,eOe=nde,tOe=TF,iOe=bW,rOe=wW,cde=Object.freeze(Object.defineProperty({__proto__:null,copy:np,set:Ji,add:_W,subtract:ide,multiply:rde,divide:sde,ceil:zMe,floor:VMe,min:BMe,max:GMe,round:jMe,scale:IP,scaleAndAdd:HMe,distance:nde,squaredDistance:TF,length:bW,squaredLength:wW,negate:qMe,inverse:WMe,normalize:ode,dot:ade,lerp:F5,random:XMe,transformMat4:xu,transformQuat:YMe,str:ZMe,exactEquals:eR,equals:lde,sub:QMe,mul:JMe,div:KMe,dist:eOe,sqrDist:tOe,len:iOe,sqrLen:rOe},Symbol.toStringTag,{value:"Module"})),wK=new Float32Array(1);function C2(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function De(e,t,i){return Math.min(Math.max(e,t),i)}function A2(e){return(e&e-1)==0}function $wt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function Dwt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function qt(e,t,i){return e+(t-e)*i}function Dt(e){return e*Math.PI/180}function Sc(e){return 180*e/Math.PI}function J8(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function pn(e){return Math.acos(De(e,-1,1))}function xp(e){return Math.asin(De(e,-1,1))}function sOe(e,t,i=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function ZS(e,t,i=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=i}function nOe(e){return ude(Math.max(-K8,Math.min(e,K8)))}function ude(e){return wK[0]=e,wK[0]}function M2(e,t,i){const r=De((i-e)/(t-e),0,1);return r*r*(3-2*r)}function xK(e,t){const i=Oe(e),r=xp(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return ne(t,i,r,s),t}function Lwt(e,t,i){return Ji(e,t[0],t[1],t[2],t[3]*i)}function Nwt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(ZS(t,1)&&ZS(i,1)&&ZS(r,1))}const K8=ude(34028234663852886e22);class s_{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,n=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return De(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}}function xW(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const oOe=xW(new s_(0,2*Math.PI)),n_=xW(new s_(-Math.PI,Math.PI)),TW=xW(new s_(0,360));class SW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new SW;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,ie(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i,r;return(r=(i=this._values.get(t))==null?void 0:i.origin)!=null?r:Oi.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===Oi.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(t,new aOe(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===Oi.DEFAULTS?t:Oi.USER}}class aOe{constructor(t,i){this.value=t,this.origin=i}}function hde(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),Oi.DEFAULTS)});const r=e.metadatas;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),Oi.DEFAULTS)})}function lOe(e,t,i){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.includes(".")&&r.indexOf(t)===0&&eK(r,i))return!0}else for(const s of r)if(s===t||s.includes(".")&&s.indexOf(t)===0&&eK(s,i))return!0;return!1}function cOe(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function uOe(e,t,i,r,s){let n=X8(t[i],s);cOe(n)&&(e[i]=!0);for(const o of Object.getOwnPropertyNames(t))n=X8(t[o],s),lOe(n,i,r)&&(e[o]=!0)}function hOe(e,t,i,r){const s=i.metadatas,n=pW(s[t],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,r):o;a!==void 0&&i.set(t,a)}const dde={origin:"service"};function pde(e,t,i=dde){if(!t||typeof t!="object")return;const r=Ba(e),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))uOe(n,s,o,t,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=X8(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?MP(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||hOe(e,o,r,i)}r.setDefaultOrigin("user")}function fde(e,t,i,r=dde){var n;const s=me(F({},r),{messages:[]});i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?r&&r.messages&&r.messages.push(o):e.loadWarnings.push(o)})}const dOe=ge.getLogger("esri.core.accessorSupport.write");function pOe(e,t,i,r,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,r,n,i,s),n}function mde(e,t,i,r,s,n){if(!r||!r.write)return!1;const o=e.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(e,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new q("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&dOe.error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===Oi.DEFAULTS)&&fOe(e,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<Tv(n.origin))}function fOe(e,t,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,i);return i_(o,s)}return!1}return n===s}function mOe(e,t,i,r){const s=Ba(e),n=s.metadatas,o=qhe(n[t],r);return!!o&&mde(e,s,t,o,i,r)}function gde(e,t,i){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return YD(t,e.toJSON(i));const r=Ba(e),s=r.metadatas;for(const a in s){const l=qhe(s[a],i);if(!mde(e,r,a,l,void 0,i))continue;const c=e.get(a),h=pOe(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(t=YD(t,h),((o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)==null?void 0:o.length)&&Promise.all(i.resources.pendingOperations).then(()=>YD(t,h)),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:a,oldOrigin:tAe(r.store.originOf(a)),newOrigin:i.origin}))}return t}const $P=e=>{let t=class extends e{constructor(...i){super(...i);const r=Ba(this),s=r.store,n=new SW;r.store=n,hde(r,s,n)}read(i,r){pde(this,i,r)}write(i={},r){return gde(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return gOe.call(this,i,r)}};return t=u([P("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function gOe(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let ve=class extends $P(Se){};ve=u([P("esri.core.JSONSupport")],ve);const yOe=Object.prototype.toString;function vOe(e){const t="__accessorMetadata__"in e?ns(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return _Oe.apply(this,i)}}function _Oe(e,t,i,r){A5(e,t).cast=r}function bOe(e){return(t,i)=>{A5(t,e).cast=t[i]}}function Rt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&yOe.call(e[0])==="[object Function]"?vOe(e[0]):e.length===1&&typeof e[0]=="string"?bOe(e[0]):void 0}function Ue(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=Uhe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function Be(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=Uhe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}var Nh;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(Nh||(Nh={}));let g;const N={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)N[g]=0;for(g=2056;g<=2065;g++)N[g]=0;for(g=2067;g<=2135;g++)N[g]=0;for(g=2137;g<=2154;g++)N[g]=0;for(g=2161;g<=2170;g++)N[g]=0;for(g=2172;g<=2193;g++)N[g]=0;for(g=2195;g<=2198;g++)N[g]=0;for(g=2200;g<=2203;g++)N[g]=0;for(g=2205;g<=2217;g++)N[g]=0;for(g=2222;g<=2224;g++)N[g]=1;for(g=2225;g<=2250;g++)N[g]=2;for(g=2251;g<=2253;g++)N[g]=1;for(g=2257;g<=2264;g++)N[g]=2;for(g=2274;g<=2279;g++)N[g]=2;for(g=2280;g<=2282;g++)N[g]=1;for(g=2283;g<=2289;g++)N[g]=2;for(g=2290;g<=2292;g++)N[g]=0;for(g=2308;g<=2313;g++)N[g]=0;for(g=2315;g<=2491;g++)N[g]=0;for(g=2494;g<=2866;g++)N[g]=0;for(g=2867;g<=2869;g++)N[g]=1;for(g=2870;g<=2888;g++)N[g]=2;for(g=2891;g<=2895;g++)N[g]=2;for(g=2896;g<=2898;g++)N[g]=1;for(g=2902;g<=2908;g++)N[g]=2;for(g=2915;g<=2920;g++)N[g]=2;for(g=2921;g<=2923;g++)N[g]=1;for(g=2924;g<=2930;g++)N[g]=2;for(g=2931;g<=2962;g++)N[g]=0;for(g=2964;g<=2968;g++)N[g]=2;for(g=2969;g<=2973;g++)N[g]=0;for(g=2975;g<=2991;g++)N[g]=0;for(g=2995;g<=3051;g++)N[g]=0;for(g=3054;g<=3079;g++)N[g]=0;for(g=3081;g<=3088;g++)N[g]=0;for(g=3092;g<=3101;g++)N[g]=0;for(g=3106;g<=3138;g++)N[g]=0;for(g=3146;g<=3151;g++)N[g]=0;for(g=3153;g<=3166;g++)N[g]=0;for(g=3168;g<=3172;g++)N[g]=0;for(g=3174;g<=3203;g++)N[g]=0;for(g=3294;g<=3358;g++)N[g]=0;for(g=3367;g<=3403;g++)N[g]=0;for(g=3408;g<=3416;g++)N[g]=0;for(g=3417;g<=3438;g++)N[g]=2;for(g=3441;g<=3446;g++)N[g]=2;for(g=3447;g<=3450;g++)N[g]=0;for(g=3451;g<=3459;g++)N[g]=2;for(g=3460;g<=3478;g++)N[g]=0;for(g=3554;g<=3559;g++)N[g]=0;for(g=3560;g<=3570;g++)N[g]=2;for(g=3571;g<=3581;g++)N[g]=0;for(g=3594;g<=3597;g++)N[g]=0;for(g=3601;g<=3604;g++)N[g]=0;for(g=3637;g<=3639;g++)N[g]=0;for(g=3665;g<=3667;g++)N[g]=0;for(g=3693;g<=3695;g++)N[g]=0;for(g=3701;g<=3727;g++)N[g]=0;for(g=3728;g<=3739;g++)N[g]=2;for(g=3740;g<=3751;g++)N[g]=0;for(g=3753;g<=3760;g++)N[g]=2;for(g=3761;g<=3773;g++)N[g]=0;for(g=3775;g<=3777;g++)N[g]=0;for(g=3779;g<=3781;g++)N[g]=0;for(g=3783;g<=3785;g++)N[g]=0;for(g=3788;g<=3791;g++)N[g]=0;for(g=3797;g<=3802;g++)N[g]=0;for(g=3814;g<=3816;g++)N[g]=0;for(g=3825;g<=3829;g++)N[g]=0;for(g=3832;g<=3841;g++)N[g]=0;for(g=3844;g<=3852;g++)N[g]=0;for(g=3873;g<=3885;g++)N[g]=0;for(g=3890;g<=3893;g++)N[g]=0;for(g=3907;g<=3912;g++)N[g]=0;for(g=3942;g<=3950;g++)N[g]=0;for(g=3968;g<=3970;g++)N[g]=0;for(g=3973;g<=3976;g++)N[g]=0;for(g=3986;g<=3989;g++)N[g]=0;for(g=3994;g<=3997;g++)N[g]=0;for(g=4048;g<=4051;g++)N[g]=0;for(g=4056;g<=4063;g++)N[g]=0;for(g=4093;g<=4096;g++)N[g]=0;for(g=4390;g<=4398;g++)N[g]=0;for(g=4399;g<=4413;g++)N[g]=2;for(g=4418;g<=4433;g++)N[g]=2;for(g=4455;g<=4457;g++)N[g]=2;for(g=4484;g<=4489;g++)N[g]=0;for(g=4491;g<=4554;g++)N[g]=0;for(g=4568;g<=4589;g++)N[g]=0;for(g=4652;g<=4656;g++)N[g]=0;for(g=4766;g<=4800;g++)N[g]=0;for(g=5014;g<=5016;g++)N[g]=0;for(g=5069;g<=5072;g++)N[g]=0;for(g=5105;g<=5130;g++)N[g]=0;for(g=5173;g<=5188;g++)N[g]=0;for(g=5253;g<=5259;g++)N[g]=0;for(g=5269;g<=5275;g++)N[g]=0;for(g=5292;g<=5311;g++)N[g]=0;for(g=5329;g<=5331;g++)N[g]=0;for(g=5343;g<=5349;g++)N[g]=0;for(g=5355;g<=5357;g++)N[g]=0;for(g=5387;g<=5389;g++)N[g]=0;for(g=5459;g<=5463;g++)N[g]=0;for(g=5479;g<=5482;g++)N[g]=0;for(g=5518;g<=5520;g++)N[g]=0;for(g=5530;g<=5539;g++)N[g]=0;for(g=5550;g<=5552;g++)N[g]=0;for(g=5562;g<=5583;g++)N[g]=0;for(g=5623;g<=5625;g++)N[g]=2;for(g=5631;g<=5639;g++)N[g]=0;for(g=5649;g<=5653;g++)N[g]=0;for(g=5663;g<=5680;g++)N[g]=0;for(g=5682;g<=5685;g++)N[g]=0;for(g=5875;g<=5877;g++)N[g]=0;for(g=5896;g<=5899;g++)N[g]=0;for(g=5921;g<=5940;g++)N[g]=0;for(g=6050;g<=6125;g++)N[g]=0;for(g=6244;g<=6275;g++)N[g]=0;for(g=6328;g<=6348;g++)N[g]=0;for(g=6350;g<=6356;g++)N[g]=0;for(g=6366;g<=6372;g++)N[g]=0;for(g=6381;g<=6387;g++)N[g]=0;for(g=6393;g<=6404;g++)N[g]=0;for(g=6480;g<=6483;g++)N[g]=0;for(g=6511;g<=6514;g++)N[g]=0;for(g=6579;g<=6581;g++)N[g]=0;for(g=6619;g<=6624;g++)N[g]=0;for(g=6625;g<=6627;g++)N[g]=2;for(g=6628;g<=6632;g++)N[g]=0;for(g=6634;g<=6637;g++)N[g]=0;for(g=6669;g<=6692;g++)N[g]=0;for(g=6707;g<=6709;g++)N[g]=0;for(g=6720;g<=6723;g++)N[g]=0;for(g=6732;g<=6738;g++)N[g]=0;for(g=6931;g<=6933;g++)N[g]=0;for(g=6956;g<=6959;g++)N[g]=0;for(g=7005;g<=7007;g++)N[g]=0;for(g=7057;g<=7070;g++)N[g]=2;for(g=7074;g<=7082;g++)N[g]=0;for(g=7109;g<=7118;g++)N[g]=0;for(g=7119;g<=7127;g++)N[g]=1;for(g=7374;g<=7376;g++)N[g]=0;for(g=7528;g<=7586;g++)N[g]=0;for(g=7587;g<=7645;g++)N[g]=2;for(g=7692;g<=7696;g++)N[g]=0;for(g=7755;g<=7787;g++)N[g]=0;for(g=7791;g<=7795;g++)N[g]=0;for(g=7799;g<=7801;g++)N[g]=0;for(g=7803;g<=7805;g++)N[g]=0;for(g=7825;g<=7831;g++)N[g]=0;for(g=7845;g<=7859;g++)N[g]=0;for(g=8013;g<=8032;g++)N[g]=0;for(g=8065;g<=8068;g++)N[g]=1;for(g=8518;g<=8529;g++)N[g]=2;for(g=8533;g<=8536;g++)N[g]=2;for(g=8538;g<=8540;g++)N[g]=2;for(g=8677;g<=8679;g++)N[g]=0;for(g=8836;g<=8840;g++)N[g]=0;for(g=8857;g<=8859;g++)N[g]=0;for(g=8908;g<=8910;g++)N[g]=0;for(g=9154;g<=9159;g++)N[g]=0;for(g=9205;g<=9218;g++)N[g]=0;for(g=9271;g<=9273;g++)N[g]=0;for(g=9295;g<=9297;g++)N[g]=0;for(g=9356;g<=9360;g++)N[g]=0;for(g=9404;g<=9407;g++)N[g]=0;for(g=9476;g<=9482;g++)N[g]=0;for(g=9487;g<=9494;g++)N[g]=0;for(g=9697;g<=9699;g++)N[g]=0;for(g=20002;g<=20032;g++)N[g]=0;for(g=20062;g<=20092;g++)N[g]=0;for(g=20135;g<=20138;g++)N[g]=0;for(g=20248;g<=20258;g++)N[g]=0;for(g=20348;g<=20358;g++)N[g]=0;for(g=20436;g<=20440;g++)N[g]=0;for(g=20822;g<=20824;g++)N[g]=0;for(g=20904;g<=20932;g++)N[g]=0;for(g=20934;g<=20936;g++)N[g]=0;for(g=21004;g<=21032;g++)N[g]=0;for(g=21035;g<=21037;g++)N[g]=0;for(g=21095;g<=21097;g++)N[g]=0;for(g=21148;g<=21150;g++)N[g]=0;for(g=21207;g<=21264;g++)N[g]=0;for(g=21307;g<=21364;g++)N[g]=0;for(g=21413;g<=21423;g++)N[g]=0;for(g=21453;g<=21463;g++)N[g]=0;for(g=21473;g<=21483;g++)N[g]=0;for(g=21780;g<=21782;g++)N[g]=0;for(g=21891;g<=21894;g++)N[g]=0;for(g=21896;g<=21899;g++)N[g]=0;for(g=22171;g<=22177;g++)N[g]=0;for(g=22181;g<=22187;g++)N[g]=0;for(g=22191;g<=22197;g++)N[g]=0;for(g=22234;g<=22236;g++)N[g]=0;for(g=22521;g<=22525;g++)N[g]=0;for(g=22991;g<=22994;g++)N[g]=0;for(g=23028;g<=23038;g++)N[g]=0;for(g=23830;g<=23853;g++)N[g]=0;for(g=23866;g<=23872;g++)N[g]=0;for(g=23877;g<=23884;g++)N[g]=0;for(g=23886;g<=23894;g++)N[g]=0;for(g=23946;g<=23948;g++)N[g]=0;for(g=24311;g<=24313;g++)N[g]=0;for(g=24342;g<=24347;g++)N[g]=0;for(g=24370;g<=24374;g++)N[g]=10;for(g=24375;g<=24381;g++)N[g]=0;for(g=24718;g<=24721;g++)N[g]=0;for(g=24817;g<=24821;g++)N[g]=0;for(g=24877;g<=24882;g++)N[g]=0;for(g=24891;g<=24893;g++)N[g]=0;for(g=25391;g<=25395;g++)N[g]=0;for(g=25828;g<=25838;g++)N[g]=0;for(g=26191;g<=26195;g++)N[g]=0;for(g=26391;g<=26393;g++)N[g]=0;for(g=26701;g<=26722;g++)N[g]=0;for(g=26729;g<=26799;g++)N[g]=2;for(g=26801;g<=26803;g++)N[g]=2;for(g=26811;g<=26813;g++)N[g]=2;for(g=26847;g<=26870;g++)N[g]=2;for(g=26891;g<=26899;g++)N[g]=0;for(g=26901;g<=26923;g++)N[g]=0;for(g=26929;g<=26946;g++)N[g]=0;for(g=26948;g<=26998;g++)N[g]=0;for(g=27037;g<=27040;g++)N[g]=0;for(g=27205;g<=27232;g++)N[g]=0;for(g=27258;g<=27260;g++)N[g]=0;for(g=27391;g<=27398;g++)N[g]=0;for(g=27561;g<=27564;g++)N[g]=0;for(g=27571;g<=27574;g++)N[g]=0;for(g=27581;g<=27584;g++)N[g]=0;for(g=27591;g<=27594;g++)N[g]=0;for(g=28191;g<=28193;g++)N[g]=0;for(g=28348;g<=28358;g++)N[g]=0;for(g=28402;g<=28432;g++)N[g]=0;for(g=28462;g<=28492;g++)N[g]=0;for(g=29118;g<=29122;g++)N[g]=0;for(g=29168;g<=29172;g++)N[g]=0;for(g=29177;g<=29185;g++)N[g]=0;for(g=29187;g<=29195;g++)N[g]=0;for(g=29900;g<=29903;g++)N[g]=0;for(g=30161;g<=30179;g++)N[g]=0;for(g=30491;g<=30494;g++)N[g]=0;for(g=30729;g<=30732;g++)N[g]=0;for(g=31251;g<=31259;g++)N[g]=0;for(g=31265;g<=31268;g++)N[g]=0;for(g=31275;g<=31279;g++)N[g]=0;for(g=31281;g<=31297;g++)N[g]=0;for(g=31461;g<=31469;g++)N[g]=0;for(g=31491;g<=31495;g++)N[g]=0;for(g=31917;g<=31922;g++)N[g]=0;for(g=31965;g<=32e3;g++)N[g]=0;for(g=32001;g<=32003;g++)N[g]=2;for(g=32005;g<=32031;g++)N[g]=2;for(g=32033;g<=32060;g++)N[g]=2;for(g=32064;g<=32067;g++)N[g]=2;for(g=32074;g<=32077;g++)N[g]=2;for(g=32081;g<=32086;g++)N[g]=0;for(g=32107;g<=32130;g++)N[g]=0;for(g=32133;g<=32158;g++)N[g]=0;for(g=32164;g<=32167;g++)N[g]=2;for(g=32180;g<=32199;g++)N[g]=0;for(g=32201;g<=32260;g++)N[g]=0;for(g=32301;g<=32360;g++)N[g]=0;for(g=32601;g<=32662;g++)N[g]=0;for(g=32664;g<=32667;g++)N[g]=2;for(g=32701;g<=32761;g++)N[g]=0;for(g=53001;g<=53004;g++)N[g]=0;for(g=53008;g<=53019;g++)N[g]=0;for(g=53021;g<=53032;g++)N[g]=0;for(g=53034;g<=53037;g++)N[g]=0;for(g=53042;g<=53046;g++)N[g]=0;for(g=53074;g<=53080;g++)N[g]=0;for(g=54001;g<=54004;g++)N[g]=0;for(g=54008;g<=54019;g++)N[g]=0;for(g=54021;g<=54032;g++)N[g]=0;for(g=54034;g<=54037;g++)N[g]=0;for(g=54042;g<=54046;g++)N[g]=0;for(g=54048;g<=54053;g++)N[g]=0;for(g=54074;g<=54080;g++)N[g]=0;for(g=54098;g<=54101;g++)N[g]=0;for(g=102001;g<=102040;g++)N[g]=0;for(g=102042;g<=102063;g++)N[g]=0;for(g=102065;g<=102067;g++)N[g]=0;for(g=102070;g<=102117;g++)N[g]=0;for(g=102122;g<=102216;g++)N[g]=0;for(g=102221;g<=102377;g++)N[g]=0;for(g=102382;g<=102388;g++)N[g]=0;for(g=102389;g<=102398;g++)N[g]=2;for(g=102399;g<=102444;g++)N[g]=0;for(g=102445;g<=102447;g++)N[g]=2;for(g=102448;g<=102458;g++)N[g]=0;for(g=102459;g<=102468;g++)N[g]=2;for(g=102469;g<=102499;g++)N[g]=0;for(g=102500;g<=102519;g++)N[g]=1;for(g=102520;g<=102524;g++)N[g]=0;for(g=102525;g<=102529;g++)N[g]=2;for(g=102530;g<=102588;g++)N[g]=0;for(g=102590;g<=102598;g++)N[g]=0;for(g=102601;g<=102603;g++)N[g]=0;for(g=102605;g<=102628;g++)N[g]=0;for(g=102629;g<=102646;g++)N[g]=2;for(g=102648;g<=102700;g++)N[g]=2;for(g=102701;g<=102703;g++)N[g]=0;for(g=102707;g<=102730;g++)N[g]=2;for(g=102733;g<=102758;g++)N[g]=2;for(g=102767;g<=102900;g++)N[g]=0;for(g=102901;g<=102933;g++)N[g]=2;for(g=102934;g<=102950;g++)N[g]=13;for(g=102951;g<=102955;g++)N[g]=0;for(g=102961;g<=102963;g++)N[g]=0;for(g=102965;g<=102969;g++)N[g]=0;for(g=102971;g<=102973;g++)N[g]=0;for(g=102975;g<=102989;g++)N[g]=0;for(g=102990;g<=102992;g++)N[g]=1;for(g=102997;g<=103002;g++)N[g]=0;for(g=103003;g<=103008;g++)N[g]=2;for(g=103009;g<=103011;g++)N[g]=0;for(g=103012;g<=103014;g++)N[g]=2;for(g=103019;g<=103021;g++)N[g]=0;for(g=103022;g<=103024;g++)N[g]=2;for(g=103029;g<=103031;g++)N[g]=0;for(g=103032;g<=103034;g++)N[g]=2;for(g=103065;g<=103068;g++)N[g]=0;for(g=103074;g<=103076;g++)N[g]=0;for(g=103077;g<=103079;g++)N[g]=1;for(g=103080;g<=103082;g++)N[g]=0;for(g=103083;g<=103085;g++)N[g]=2;for(g=103090;g<=103093;g++)N[g]=0;for(g=103097;g<=103099;g++)N[g]=0;for(g=103100;g<=103102;g++)N[g]=2;for(g=103107;g<=103109;g++)N[g]=0;for(g=103110;g<=103112;g++)N[g]=2;for(g=103113;g<=103116;g++)N[g]=0;for(g=103117;g<=103120;g++)N[g]=2;for(g=103153;g<=103157;g++)N[g]=0;for(g=103158;g<=103162;g++)N[g]=2;for(g=103163;g<=103165;g++)N[g]=0;for(g=103166;g<=103168;g++)N[g]=1;for(g=103169;g<=103171;g++)N[g]=2;for(g=103186;g<=103188;g++)N[g]=0;for(g=103189;g<=103191;g++)N[g]=2;for(g=103192;g<=103195;g++)N[g]=0;for(g=103196;g<=103199;g++)N[g]=2;for(g=103200;g<=103224;g++)N[g]=0;for(g=103225;g<=103227;g++)N[g]=1;for(g=103232;g<=103237;g++)N[g]=0;for(g=103238;g<=103243;g++)N[g]=2;for(g=103244;g<=103246;g++)N[g]=0;for(g=103247;g<=103249;g++)N[g]=2;for(g=103254;g<=103256;g++)N[g]=0;for(g=103257;g<=103259;g++)N[g]=2;for(g=103264;g<=103266;g++)N[g]=0;for(g=103267;g<=103269;g++)N[g]=2;for(g=103300;g<=103375;g++)N[g]=0;for(g=103381;g<=103383;g++)N[g]=0;for(g=103384;g<=103386;g++)N[g]=1;for(g=103387;g<=103389;g++)N[g]=0;for(g=103390;g<=103392;g++)N[g]=2;for(g=103397;g<=103399;g++)N[g]=0;for(g=103400;g<=103471;g++)N[g]=2;for(g=103476;g<=103478;g++)N[g]=0;for(g=103479;g<=103481;g++)N[g]=2;for(g=103486;g<=103488;g++)N[g]=0;for(g=103489;g<=103491;g++)N[g]=2;for(g=103492;g<=103495;g++)N[g]=0;for(g=103496;g<=103499;g++)N[g]=2;for(g=103528;g<=103543;g++)N[g]=0;for(g=103544;g<=103548;g++)N[g]=2;for(g=103549;g<=103551;g++)N[g]=0;for(g=103552;g<=103554;g++)N[g]=1;for(g=103555;g<=103557;g++)N[g]=2;for(g=103558;g<=103560;g++)N[g]=0;for(g=103571;g<=103573;g++)N[g]=0;for(g=103574;g<=103576;g++)N[g]=2;for(g=103577;g<=103580;g++)N[g]=0;for(g=103581;g<=103583;g++)N[g]=2;for(g=103595;g<=103694;g++)N[g]=0;for(g=103696;g<=103699;g++)N[g]=0;for(g=103700;g<=103793;g++)N[g]=2;for(g=103794;g<=103887;g++)N[g]=0;for(g=103900;g<=103971;g++)N[g]=2;const wOe={102113:!0,102100:!0,3857:!0,3785:!0},xOe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},TK='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',eI=[-20037508342788905e-9,20037508342788905e-9],tI=[-20037508342787e-6,20037508342787e-6],yde={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:eI,origin:tI,dx:1e-5},102100:{wkTemplate:TK,valid:eI,origin:tI,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:eI,origin:tI,dx:1e-5},3857:{wkTemplate:TK,valid:eI,origin:tI,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Rc(e,t){return!M(e)&&!M(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||bw(e)&&bw(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function jv(e){return Ml(e)&&e.wkid&&yde[e.wkid]||null}function vde(e){return!!Ml(e)&&(e.wkid?N[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function O2(e){return!(_m(e)||bm(e))}function tR(e){return Ml(e)&&e.wkid===4326}function _de(e){return Ml(e)&&e.wkid===Nh.CGCS2000}function bw(e){return Ml(e)&&e.wkid!=null&&wOe[e.wkid]===!0}function iR(e){return Ml(e)&&e.wkid===32662}function EW(e){return e===Nh.GCSMARS2000||e===Nh.GCSMARS2000_SPHERE}function _m(e){return Ml(e)&&e.wkid!=null&&EW(e.wkid)}function CW(e){return e===Nh.GCSMOON2000}function bm(e){return Ml(e)&&e.wkid!=null&&CW(e.wkid)}function TOe(e){return Ml(e)&&e.wkid!=null&&xOe[e.wkid]===!0}function Ml(e){return _(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const SOe={wkid:4326,wkt:rm(yde[4326].wkTemplate,{Central_Meridian:"0.0"})},EOe={wkid:102100,latestWkid:3857},COe={wkid:32662};var Kp;let Ar=Kp=class extends ve{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return Kp.WebMercator;if(e.wkid===4326)return Kp.WGS84}const t=new Kp;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return tR(this)}get isWebMercator(){return bw(this)}get isGeographic(){return vde(this)}get isWrappable(){return TOe(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===Kp.WGS84)return Kp.WGS84;if(this===Kp.WebMercator)return Kp.WebMercator;const e=new Kp;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=ie(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return Rc(this,e)}toJSON(e){return this.write(void 0,e)}};Ar.GCS_NAD_1927=null,Ar.WGS84=null,Ar.WebMercator=null,Ar.PlateCarree=null,u([d({readOnly:!0})],Ar.prototype,"isWGS84",null),u([d({readOnly:!0})],Ar.prototype,"isWebMercator",null),u([d({readOnly:!0})],Ar.prototype,"isGeographic",null),u([d({readOnly:!0})],Ar.prototype,"isWrappable",null),u([d({type:Sr,json:{write:!0}})],Ar.prototype,"latestWkid",void 0),u([d({type:Sr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Ar.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Ar.prototype,"wkt",void 0),u([Be("wkt"),Be("web-scene","wkt")],Ar.prototype,"writeWkt",null),u([d({type:Sr,json:{write:!0}})],Ar.prototype,"vcsWkid",void 0),u([d({type:Sr,json:{write:!0}})],Ar.prototype,"latestVcsWkid",void 0),u([d()],Ar.prototype,"imageCoordinateSystem",void 0),Ar=Kp=u([P("esri.geometry.SpatialReference")],Ar),Ar.prototype.toJSON.isDefaultToJSON=!0,Ar.GCS_NAD_1927=new Ar({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Ar.WGS84=new Ar(SOe),Ar.WebMercator=new Ar(EOe),Ar.PlateCarree=new Ar(COe),Object.freeze&&(Object.freeze(Ar.GCS_NAD_1927),Object.freeze(Ar.WGS84),Object.freeze(Ar.WebMercator));const Ze=Ar;let ef=class extends ve{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ze.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof Ze)return e;if(e!=null){const i=new Ze;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([d()],ef.prototype,"type",void 0),u([d({readOnly:!0})],ef.prototype,"cache",null),u([d({readOnly:!0})],ef.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ef.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ef.prototype,"hasZ",void 0),u([d({type:Ze,json:{write:!0}})],ef.prototype,"spatialReference",void 0),u([Ue("spatialReference")],ef.prototype,"readSpatialReference",null),ef=u([P("esri.geometry.Geometry")],ef);const Ec=ef;function AOe(e,t,i,r){var s;return e.x=e.x+t,e.y=e.y+i,r!=null&&(e.z=((s=e.z)!=null?s:0)+r),e}function MOe(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}class AW{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const Ri=new AW(6378137,1/298.257223563,3e5,.006694379990137799),Yf=new AW(3396190,1/169.8944472236118,23e4),oy=new AW(1737400,0,0),OOe=57.29577951308232,ROe=.017453292519943;function SK(e){return e*OOe}function EK(e){return e*ROe}function CK(e){return e/Ri.radius}function SF(e){return Math.PI/2-2*Math.atan(Math.exp(-e/Ri.radius))}function e9(e){return e.wkid!=null||e.wkt!=null}const Iz=[0,0];function EF(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,Iz,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,Iz,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,Iz,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function Hv(e,t){const i=e&&(e9(e)?e:e.spatialReference),r=t&&(e9(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!Rc(r,i)||bw(r)&&tR(i)||bw(i)&&tR(r))}function rx(e,t){if(M(e))return null;const i=e.spatialReference,r=t&&(e9(t)?t:t.spatialReference);return Hv(i,r)?Rc(i,r)?ie(e):bw(r)?EF(e,xS,Ze.WebMercator,!1,ie(e)):tR(r)?EF(e,rO,Ze.WGS84,!1,ie(e)):null:null}function xS(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=EK(t);return i[0]=EK(e)*Ri.radius,i[1]=Ri.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function rO(e,t,i=[0,0],r=!1){const s=SK(e/Ri.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=SK(Math.PI/2-2*Math.atan(Math.exp(-t/Ri.radius))),i}function qg(e,t=!1,i=ie(e)){return EF(e,xS,Ze.WebMercator,t,i)}function FA(e,t=!1,i=ie(e)){return EF(e,rO,Ze.WGS84,t,i)}var eL;const bC=[0,0];function AK(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const iI=ge.getLogger("esri.geometry.Point");let tl=eL=class extends Ec{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ze(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)iI.warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)iI.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=xS(n.longitude,n.latitude,bC);e=a[0],t=a[1]}}}else AK(i)?(s=i,i=null):AK(r)&&(s=r,r=null);const o={x:e,y:t};return o.x==null&&o.y!=null?iI.warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&iI.warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return rO(t,i,bC)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",xS(i,e,bC)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return rO(e,t,bC)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",xS(e,t,bC)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new eL;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return eL.copy(e,this),this}equals(e){if(M(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=xS(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=rO(l,c),h=n}return t===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(e,t,i){return AOe(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=jv(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return MOe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],tl.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],tl.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],tl.prototype,"hasZ",null),u([d({type:Number})],tl.prototype,"latitude",null),u([d({type:Number})],tl.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Rt(e=>isNaN(e)?e:Rh(e))],tl.prototype,"x",void 0),u([Be("x")],tl.prototype,"writeX",null),u([Ue("x")],tl.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],tl.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],tl.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],tl.prototype,"m",void 0),tl=eL=u([P("esri.geometry.Point")],tl),tl.prototype.toJSON.isDefaultToJSON=!0;const at=tl;let Zm=class extends Oc(ve){constructor(...e){super(...e),this.position=new at([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=Rh(e.x||0),s.y=Rh(e.y||0),s.z=e.hasZ?Rh(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new at;return i.read(e,t),i.x=Rh(i.x||0),i.y=Rh(i.y||0),i.z=i.hasZ?Rh(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:at,json:{write:{isRequired:!0}}})],Zm.prototype,"position",void 0),u([Be("position")],Zm.prototype,"writePosition",null),u([Ue("position")],Zm.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Rt(e=>TW.normalize(Rh(e)))],Zm.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Rt(e=>De(Rh(e),-180,180))],Zm.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Zm.prototype,"fov",void 0),Zm=u([P("esri.Camera")],Zm);const Cc=Zm,$z=[0,0];function MW(e,t){return!!_(t)&&Ia(e,t.x,t.y,t.z)}function Fwt(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!R2(e,i))return!1;return!0}function POe(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?Ia(e,i,r,s)&&Ia(e,i,o,s)&&Ia(e,n,o,s)&&Ia(e,n,r,s)&&Ia(e,i,r,a)&&Ia(e,i,o,a)&&Ia(e,n,o,a)&&Ia(e,n,r,a):Ia(e,i,r)&&Ia(e,i,o)&&Ia(e,n,o)&&Ia(e,n,r)}function R2(e,t){return Ia(e,t[0],t[1])}function IOe(e,t){return Ia(e,t[0],t[1],t[2])}function Ia(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function $Oe(e,t){return $z[1]=t.y,$z[0]=t.x,DOe(e,$z)}function DOe(e,t){return bde(e.rings,t)}function bde(e,t){if(!e)return!1;if(LOe(e))return MK(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=MK(i,e[r],t);return i}function LOe(e){return!Array.isArray(e[0][0])}function MK(e,t,i){const[r,s]=i;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,f]=t[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<r&&(n=!n)}return n}function NOe(e,t){return MW(e,t)}function FOe(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function kOe(e,t){const{points:i,hasZ:r}=t,s=r?IOe:R2;for(const n of i)if(s(e,n))return!0;return!1}const ww=[0,0],xw=[0,0],Tw=[0,0],Sw=[0,0],UOe=[ww,xw,Tw,Sw],wde=[[Tw,ww],[ww,xw],[xw,Sw],[Sw,Tw]];function zOe(e,t){return VOe(e,t.rings)}function VOe(e,t){ww[0]=e.xmin,ww[1]=e.ymax,xw[0]=e.xmax,xw[1]=e.ymax,Tw[0]=e.xmin,Tw[1]=e.ymin,Sw[0]=e.xmax,Sw[1]=e.ymin;for(const i of UOe)if(bde(t,i))return!0;for(const i of t){if(!i.length)continue;let r=i[0];if(R2(e,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(R2(e,n)||xde(r,n,wde))return!0;r=n}}return!1}function BOe(e,t){ww[0]=e.xmin,ww[1]=e.ymax,xw[0]=e.xmax,xw[1]=e.ymax,Tw[0]=e.xmin,Tw[1]=e.ymin,Sw[0]=e.xmax,Sw[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(R2(e,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(R2(e,o)||xde(s,o,wde))return!0;s=o}}return!1}const So=[0,0];function GOe(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(t9(n,o,c,h,So)&&!(So[0]===n[0]&&So[1]===n[1]||So[0]===c[0]&&So[1]===c[1]||So[0]===o[0]&&So[1]===o[1]||So[0]===h[0]&&So[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(t9(o,a,c,h,So)&&!(So[0]===o[0]&&So[1]===o[1]||So[0]===c[0]&&So[1]===c[1]||So[0]===a[0]&&So[1]===a[1]||So[0]===h[0]&&So[1]===h[1]))return!0}}}return!1}function xde(e,t,i){for(let r=0;r<i.length;r++)if(t9(e,t,i[r][0],i[r][1]))return!0;return!1}function t9(e,t,i,r,s){const[n,o]=e,[a,l]=t,[c,h]=i,[p,f]=r,m=p-c,y=n-c,v=a-n,w=f-h,b=o-h,S=l-o,T=w*v-m*S;if(T===0)return!1;const E=(m*b-w*y)/T,C=(v*b-S*y)/T;return E>=0&&E<=1&&C>=0&&C<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function jOe(e){switch(e){case"esriGeometryEnvelope":case"extent":return FOe;case"esriGeometryMultipoint":case"multipoint":return kOe;case"esriGeometryPoint":case"point":return NOe;case"esriGeometryPolygon":case"polygon":return zOe;case"esriGeometryPolyline":case"polyline":return BOe}}var oh;function HOe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function Ny(e,t,i){return t==null?i:i==null?t:e(t,i)}let Xn=oh=class extends Ec{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return HOe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?Ze.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s==null?Ze.WGS84:s}}static fromBounds(e,t){return new oh({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new oh({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new at({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new oh;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Hv(t,i)&&(e=t.isWebMercator?qg(e):FA(e,!0)),e.type==="point"?MW(this,e):e.type==="extent"&&POe(this,e)}equals(e){if(this===e)return!0;if(M(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Hv(t,i)&&(e=t.isWebMercator?qg(e):FA(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(M(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Hv(t,i)&&(e=t.isWebMercator?qg(e):FA(e,!0)),jOe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Ny(Math.min,this.zmin,e.zmin),this.zmax=Ny(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Ny(Math.min,this.mmin,e.mmin),this.mmax=Ny(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:M(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Ny(Math.max,this.zmin,e.zmin),this.zmax=Ny(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Ny(Math.max,this.mmin,e.mmin),this.mmax=Ny(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=jv(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?FA(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new Ze(rm(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||jv(r)))return this;const s=this._getParts(i).map(a=>a.extent);if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,o=!0;return s.forEach(a=>{a.hasZ||(n=!1),a.hasM||(o=!1)}),{rings:s.map(a=>{const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(n){const c=(a.zmax-a.zmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}if(o){const c=(a.mmax-a.mmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}return l}),hasZ:n,hasM:o,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||jv(o);const[p,f]=e.valid;h=this._normalizeX(this.xmin,e);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,e);const v=h.x,w=h.frameId,b=m===v&&a>0;if(a>2*f){const S=new oh(l<c?m:v,s,f,n,o),T=new oh(p,s,l<c?v:m,n,o),E=new oh(0,s,f,n,o),C=new oh(p,s,0,n,o),A=[],I=[];S.contains(E)&&A.push(y),S.contains(C)&&I.push(y),T.contains(E)&&A.push(w),T.contains(C)&&I.push(w);for(let L=y+1;L<w;L++)A.push(L),I.push(L);t.push({extent:S,frameIds:[y]},{extent:T,frameIds:[w]},{extent:E,frameIds:A},{extent:C,frameIds:I})}else m>v||b?t.push({extent:new oh(m,s,f,n,o),frameIds:[y]},{extent:new oh(p,s,v,n,o),frameIds:[w]}):t.push({extent:new oh(m,s,v,n,o),frameIds:[y]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([d({readOnly:!0})],Xn.prototype,"cache",null),u([d({readOnly:!0})],Xn.prototype,"center",null),u([d({readOnly:!0})],Xn.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Xn.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Xn.prototype,"hasZ",null),u([d({readOnly:!0})],Xn.prototype,"height",null),u([d({readOnly:!0})],Xn.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Xn.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],Xn.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Xn.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Xn.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],Xn.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],Xn.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Xn.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Xn.prototype,"zmax",void 0),Xn=oh=u([P("esri.geometry.Extent")],Xn),Xn.prototype.toJSON.isDefaultToJSON=!0;const ui=Xn;function P2(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var i9;function OK(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function qOe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let w0=i9=class extends Ec{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):qOe(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new ui,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=OK(Math.min),a=OK(Math.max);let l,c,h,p,[f,m]=n,[y,v]=n;for(let w=0,b=e.length;w<b;w++){const S=e[w],[T,E]=S;if(f=o(f,T),m=o(m,E),y=a(y,T),v=a(v,E),i&&S.length>2){const C=S[2];l=o(l,C),h=a(h,C)}if(r&&S.length>s){const C=S[s];c=o(c,C),p=a(p,C)}}return t.xmin=f,t.ymin=m,t.xmax=y,t.ymax=v,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=null,t.zmax=null),r?(t.mmin=c,t.mmax=p):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=ie(this.points)}addPoint(e){return P2(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:ie(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new i9(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new at(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new at(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(P2(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([d({readOnly:!0})],w0.prototype,"cache",null),u([d()],w0.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],w0.prototype,"points",void 0),u([Be("points")],w0.prototype,"writePoints",null),w0=i9=u([P("esri.geometry.Multipoint")],w0),w0.prototype.toJSON.isDefaultToJSON=!0;const sx=w0;function OW(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function Tde(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function WOe(e,t){return Tde(e,t,.5)}function Sde(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=OW(e[r],e[r+1]);return i}function Ede(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const n=OW(e[s],e[s+1]);if(t-r<n){const o=(t-r)/n;return Tde(e[s],e[s+1],o)}r+=n}return e[i-1]}function RW(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],c=e[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function kwt(e){if("rings"in e)for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]])}function Uwt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function XOe(e){return e?Cde(e.rings,e.hasZ):null}function Cde(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=YOe(e[n],t,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=e[0]&&e[0].length?ZOe(e[0],t):null;if(!n)return null;i[0]=n[0],i[1]=n[1],t&&n.length>2&&(i[2]=n[2])}return i}function YOe(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const m=e[f],y=e[(f+1)%e.length],[v,w,b]=m,S=v-l,T=w-c,E=t?b-h:void 0,[C,A,I]=y,L=C-l,D=A-c,U=t?I-h:void 0,z=S*D-L*T;if(o+=z,r+=(S+L)*z,s+=(T+D)*z,t&&m.length>2&&y.length>2){const V=S*U-L*E;n+=(E+U)*V,a+=V}v<i[0]&&(i[0]=v),v>i[1]&&(i[1]=v),w<i[2]&&(i[2]=w),w>i[3]&&(i[3]=w),t&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,s/(6*o)+c,o];return t&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function ZOe(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],t&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const f=OW(i,r);if(f){s+=f;const m=WOe(h,p);n+=f*m[0],o+=f*m[1],t&&m.length>2&&(a+=f*m[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}function Ade(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Mde(e){return e.points!==void 0}function Ode(e){return e.x!==void 0&&e.y!==void 0}function Rde(e){return e.paths!==void 0}function Pde(e){return e.rings!==void 0}function Ide(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}const Sv=Ide(Math.min),Ev=Ide(Math.max);function zwt(e,t){return Rde(t)?I2(e,t.paths,!1,!1):Pde(t)?I2(e,t.rings,!1,!1):Mde(t)?PW(e,t.points,!1,!1,!1,!1):Ade(t)?$de(e,t):(Ode(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function Vwt(e,t){return Rde(t)?I2(e,t.paths,!0,!1):Pde(t)?I2(e,t.rings,!0,!1):Mde(t)?PW(e,t.points,!0,!1,!0,!1):Ade(t)?$de(e,t,!0,!1,!0,!1):(Ode(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function I2(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const y=t[m];for(let v=0;v<y.length;v++){const w=y[v],[b,S]=w;if(c=Sv(c,b),h=Sv(h,S),p=Ev(p,b),f=Ev(f,S),i&&w.length>2){const T=w[2];n=Sv(n,T),o=Ev(o,T)}if(r&&w.length>s){const T=w[s];a=Sv(n,T),l=Ev(o,T)}}}return i?r?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):r?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function $de(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,f=t.mmin,m=t.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=h,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=m,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=m,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function PW(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let c,h,p,f,[m,y]=t[0],[v,w]=t[0];for(let b=0;b<t.length;b++){const S=t[b],[T,E]=S;if(m=Sv(m,T),y=Sv(y,E),v=Ev(v,T),w=Ev(w,E),l&&S.length>2){const C=S[2];c=Sv(c,C),h=Ev(h,C)}if(a&&S.length>o){const C=S[o];p=Sv(c,C),f=Ev(h,C)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=c,e[3]=p,e[4]=v,e[5]=w,e[6]=h,e[7]=f,e):(e[0]=m,e[1]=y,e[2]=c,e[3]=v,e[4]=w,e[5]=h,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=p,e[3]=v,e[4]=w,e[5]=f,e):(e[0]=m,e[1]=y,e[2]=v,e[3]=w,e)}function QOe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function JOe(e){return e.points!==void 0}function KOe(e){return e.x!==void 0&&e.y!==void 0}function eRe(e){return e.paths!==void 0}function tRe(e){return e.rings!==void 0}const IW=[];function Dde(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function Lde(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function Nde(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function Fde(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function $W(e,t=!1,i=!1){return t?i?Fde(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):Lde(e[0],e[1],e[2],e[3],e[4],e[5]):i?Nde(e[0],e[1],e[2],e[3],e[4],e[5]):Dde(e[0],e[1],e[2],e[3])}function Bwt(e){return e?QOe(e)?e:KOe(e)?rRe(e):tRe(e)?kde(e):eRe(e)?Ude(e):JOe(e)?iRe(e):null:null}function iRe(e){const{hasZ:t,hasM:i,points:r}=e;return $W(PW(IW,r,t,i),t,i)}function rRe(e){const{x:t,y:i,z:r,m:s}=e,n=s!=null;return r!=null?n?Fde(t,i,r,s,t,i,r,s):Lde(t,i,r,t,i,r):n?Nde(t,i,s,t,i,s):Dde(t,i,t,i)}function kde(e){const{hasZ:t,hasM:i,rings:r}=e,s=I2(IW,r,t,i);return s?$W(s,t,i):null}function Ude(e){const{hasZ:t,hasM:i,paths:r}=e,s=I2(IW,r,t,i);return s?$W(s,t,i):null}var tL;function RK(e){return!Array.isArray(e[0])}let tf=tL=class extends Ec{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const o of t)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new tL(n)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Ze.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=XOe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new at;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=kde(this);if(!t)return null;const i=new ui(t);return i.spatialReference=e,i}get isSelfIntersecting(){return GOe(this.rings)}writeRings(e,t){t.rings=ie(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(RK(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new tL;return e.spatialReference=this.spatialReference,e.rings=ie(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(M(e))return!1;const t=this.spatialReference,i=e.spatialReference;if(_(t)!==_(i)||_(t)&&_(i)&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!i_(n,o,r))return!1}return!0}contains(e){if(!e)return!1;const t=rx(e,this.spatialReference);return $Oe(this,_(t)?t:e)}isClockwise(e){let t;return t=RK(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,RW(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new at(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new at(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new at(i[0],i[1],i[2],i[3],this.spatialReference):new at(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(P2(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new at(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new at(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(P2(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],tf.prototype,"cache",null),u([d({readOnly:!0})],tf.prototype,"centroid",null),u([d({readOnly:!0})],tf.prototype,"extent",null),u([d({readOnly:!0})],tf.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],tf.prototype,"rings",void 0),u([Be("rings")],tf.prototype,"writeRings",null),tf=tL=u([P("esri.geometry.Polygon")],tf),tf.prototype.toJSON.isDefaultToJSON=!0;const $u=tf;var r9;function sRe(e){return!Array.isArray(e[0])}let x0=r9=class extends Ec{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Ze.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=Ude(this);if(!t)return null;const i=new ui(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=ie(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(sRe(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new r9;return e.spatialReference=this.spatialReference,e.paths=ie(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new at(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new at(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new at(i[0],i[1],i[2],i[3],this.spatialReference):new at(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(P2(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new at(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new at(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(P2(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],x0.prototype,"cache",null),u([d({readOnly:!0})],x0.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],x0.prototype,"paths",void 0),u([Be("paths")],x0.prototype,"writePaths",null),x0=r9=u([P("esri.geometry.Polyline")],x0),x0.prototype.toJSON.isDefaultToJSON=!0;const Tu=x0;class wi{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=i,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&xc(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const i=this.apiToJSON[t];return this.options.useNumericKeys?+i:i}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}}function fa(){return function(e,t){return new wi(e,F({ignoreUnknown:!0},t))}}const zde=fa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),PK=fa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Vde(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function DW(e){return e.points!==void 0}function LW(e){return e.x!==void 0&&e.y!==void 0}function NW(e){return e.paths!==void 0}function iw(e){return e.rings!==void 0}function sm(e){return M(e)?null:e instanceof Ec?e:LW(e)?at.fromJSON(e):NW(e)?Tu.fromJSON(e):iw(e)?$u.fromJSON(e):DW(e)?sx.fromJSON(e):Vde(e)?ui.fromJSON(e):null}function jE(e){return e?LW(e)?"esriGeometryPoint":NW(e)?"esriGeometryPolyline":iw(e)?"esriGeometryPolygon":Vde(e)?"esriGeometryEnvelope":DW(e)?"esriGeometryMultipoint":null:null}const nRe={esriGeometryPoint:at,esriGeometryPolyline:Tu,esriGeometryPolygon:$u,esriGeometryEnvelope:ui,esriGeometryMultipoint:sx};function Bde(e){return e&&nRe[e]||null}const nx={base:Ec,key:"type",typeMap:{extent:ui,multipoint:sx,point:at,polyline:Tu,polygon:$u}};wp(nx);class QS{constructor(){this._emitter=new QS.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this.target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this.target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return x2(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([P("esri.core.Evented")],s),s};let i=class extends Se{constructor(){super(...arguments),this._emitter=new QS.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([P("esri.core.Evented")],i),e.EventedAccessor=i})(QS||(QS={}));const as=QS;var Yi;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Yi||(Yi={}));function FW(e){return(t,i)=>{t[i]=e}}class Gde{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new bhe(this._observers,t)}notify(){const t=this._observers.slice();for(let i=0;i<t.length;++i){const r=t[i];r.onInvalidated(),r.onCommitted()}}}var Pg;class oRe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const Wu=new Es(oRe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),aRe=()=>{};function Dz(e){return e?e instanceof wb?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function Lz(e){if(e&&e.length)return e[0]}function lRe(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function jde(e,t,i,r){t&&t.forEach((s,n,o)=>{e.push(s),jde(e,i.call(r,s,n,o),i,r)})}const Fy=new Set,ky=new Set,Uy=new Set,Nz=new Map;let cRe=0,wb=Pg=class extends as.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new Gde,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:cRe++})}static isCollection(e){return e!=null&&e instanceof Pg}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof Pg?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Kt(this._observable),this._items}set items(e){this._emitBeforeChanges(Yi.ADD)||(this._splice(0,this.length,Dz(e)),this._emitAfterChanges(Yi.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=aRe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(Kt(this._observable),this._emitBeforeChanges(Yi.ADD))return this;const i=this.getNextIndex(t!=null?t:null);return this._splice(i,0,[e]),this._emitAfterChanges(Yi.ADD),this}addMany(e,t=this._items.length){if(Kt(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Yi.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,Dz(e)),this._emitAfterChanges(Yi.ADD),this}at(e){if(Kt(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(Kt(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(Yi.REMOVE),e}clone(){return Kt(this._observable),this._createNewInstance({items:this._items.map(ie)})}concat(...e){Kt(this._observable);const t=e.map(Dz);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(Kt(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(Yi.REMOVE)}every(e,t){return Kt(this._observable),this._items.every(e,t)}filter(e,t){let i;return Kt(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return Kt(this._observable),this._items.find(e,t)}findIndex(e,t){return Kt(this._observable),this._items.findIndex(e,t)}flatten(e,t){Kt(this._observable);const i=[];return jde(i,this,e,t),new Pg(i)}forEach(e,t){return Kt(this._observable),this._items.forEach(e,t)}getItemAt(e){return Kt(this._observable),this._items[e]}getNextIndex(e){Kt(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return Kt(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return Kt(this._observable),this._items.indexOf(e,t)}join(e=","){return Kt(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return Kt(this._observable),this._items.lastIndexOf(e,t)}map(e,t){Kt(this._observable);const i=this._items.map(e,t);return new Pg({items:i})}reorder(e,t=this.length-1){Kt(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(Yi.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(Yi.MOVE)}return e}}pop(){if(Kt(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return;const e=Lz(this._splice(this.length-1,1));return this._emitAfterChanges(Yi.REMOVE),e}push(...e){return Kt(this._observable),this._emitBeforeChanges(Yi.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Yi.ADD)),this.length}reduce(e,t){Kt(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){Kt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return Kt(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(Kt(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Yi.REMOVE))return;const t=Lz(this._splice(e,1));return this._emitAfterChanges(Yi.REMOVE),t}removeMany(e){if(Kt(this._observable),!e||!e.length||this._emitBeforeChanges(Yi.REMOVE))return[];const t=e instanceof Pg?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=i.indexOf(o);if(a>-1){const l=1+lRe(t,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Yi.REMOVE),r}reverse(){if(Kt(this._observable),this._emitBeforeChanges(Yi.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Yi.MOVE),this}shift(){if(Kt(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return;const e=Lz(this._splice(0,1));return this._emitAfterChanges(Yi.REMOVE),e}slice(e=0,t=this.length){return Kt(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return Kt(this._observable),this._items.some(e,t)}sort(e){if(Kt(this._observable),!this.length||this._emitBeforeChanges(Yi.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Yi.MOVE),this}splice(e,t,...i){Kt(this._observable);const r=(t?Yi.REMOVE:0)|(i.length?Yi.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return Kt(this._observable),this._items.slice()}toJSON(){return Kt(this._observable),this.toArray()}toLocaleString(){return Kt(this._observable),this._items.toLocaleString()}toString(){return Kt(this._observable),this._items.toString()}unshift(...e){return Kt(this._observable),!e.length||this._emitBeforeChanges(Yi.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Yi.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=ix(()=>this._dispatchChange())),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const a=Wu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(e,0,n),e+=1,l-=1,c-=1);Wu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Wu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Wu.release(a)}}if(i&&i.length){if(s){const h=[];for(const p of i){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=Wu.acquire();h.target=this,h.cancellable=!0;const p=Wu.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));Wu.release(p),Wu.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=Wu.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,Wu.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=Wu.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),Wu.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;Fy.clear(),ky.clear(),Uy.clear();for(const{added:l,removed:c}of i){if(l)if(Uy.size===0&&ky.size===0)for(const h of l)Fy.add(h);else for(const h of l)ky.has(h)?(Uy.add(h),ky.delete(h)):Uy.has(h)||Fy.add(h);if(c)if(Uy.size===0&&Fy.size===0)for(const h of c)ky.add(h);else for(const h of c)Fy.has(h)?Fy.delete(h):(Uy.delete(h),ky.add(h))}const r=cc.acquire();Fy.forEach(l=>{r.push(l)});const s=cc.acquire();ky.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=cc.acquire();if(Uy.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}cc.release(r),cc.release(s),cc.release(a)}Fy.clear(),ky.clear(),Uy.clear()}};wb.ofType=e=>{if(!e)return Pg;if(Nz.has(e))return Nz.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends Pg{};return u([FW({Type:e,ensureType:typeof e=="function"?ns(e):wp(e)})],i.prototype,"itemType",void 0),i=u([P(`esri.core.Collection<${t}>`)],i),Nz.set(e,i),i},u([d()],wb.prototype,"length",void 0),u([d()],wb.prototype,"items",null),wb=Pg=u([P("esri.core.Collection")],wb);const it=wb;var $2;function uRe(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return $2.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==t))return $2.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})($2||($2={}));let Fz;function nm(){return Fz||(Fz=(async()=>{const e=await import("./arcadeUtils.ce23ba53.js").then(function(t){return t.t});return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),Fz}const hRe=(e,t,i)=>DP.create(e,t,i,null,["$feature"]),dRe=(e,t,i)=>DP.create(e,t,i,null,["$feature","$view"]),pRe=(e,t,i,r)=>DP.create(e,t,i,r,["$feature","$view"]);class DP{constructor(t,i,r,s,n,o,a,l){this.script=t,this.evaluate=n;const c=Array.isArray(a)?a:a.fields;this.fields=c,this._syntaxTree=s,this._arcade=i,this._arcadeDictionary=r,this._arcadeFeature=o,this._spatialReference=l,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await nm(),h=Ze.fromJSON(i),p=a.parseScript(t,o),f=n.reduce((C,A)=>me(F({},C),{[A]:null}),{});let m=null;_(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p)&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p)&&a.enableAsyncSupport(),b={vars:f,spatialReference:h,useAsync:!!w},S=new c;S.immutable=!1,S.setField("scale",0);const T=a.compileScript(p,b),E=C=>("$view"in C&&C.$view&&(S.setField("scale",C.$view.scale),C.$view=S),m&&(C.$config=m),T({vars:C,spatialReference:h}));return await Promise.all([y,v,w]),new DP(t,a,c,p,E,new l,r,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const fRe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],mRe=["field","normalizationField"];function IK(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if($K(fRe,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)$K(mRe,r,t)}}function $K(e,t,i){if(e)for(const r of e){const s=VE(r,t),n=s&&typeof s!="function"&&i.get(s);n&&xc(r,n.name,t)}}function Hde(e,t){if(e!=null&&(t==null?void 0:t.fields.length))if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const kz=new Set;function qde(e,t){return e&&t?(kz.clear(),rR(kz,e,t),Array.from(kz).sort()):[]}function rR(e,t,i){var r;if(i)if((r=t==null?void 0:t.fields)==null?void 0:r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)Gh(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)e.add(s)}}function Gh(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function Gwt(e,t){return M(t)||M(e)?[]:t.includes("*")?e.fields.map(i=>i.name):t}async function Ol(e,t,i){var n;if(!i)return;const{arcadeUtils:r}=await nm(),s=r.extractFieldNames(i,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Gh(e,t,o)}async function Wde(e,t,i){if(i&&i!=="1=1"){const r=(await import("./WhereClause.c045f23c.js")).WhereClause.create(i,t);if(!r.isStandardized)throw new q("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});rR(e,t,r.fieldNames)}}function gRe({displayField:e,fields:t}){return e||(t&&t.length?Uz(t,"name-or-title")||Uz(t,"unique-identifier")||Uz(t,"type-or-category")||yRe(t):null)}function yRe(e){for(const t of e){if(!t||!t.name)continue;const i=t.name.toLowerCase();if(i.includes("name")||i.includes("title"))return t.name}return null}function Uz(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function jwt(e,t){if(!t)return;const i=VE("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function vRe(e,t,i){i.outStatistic.onStatisticValueExpression?Ol(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}async function Hwt(e,t,i){var s,n;if(!t||!i||!("fields"in i))return;const r=[];if(((s=i.popupTemplate)==null?void 0:s.expressionInfos)&&r.push(...i.popupTemplate.expressionInfos.map(o=>Ol(e,t.fieldsIndex,o.expression))),Array.isArray((n=i.popupTemplate)==null?void 0:n.content)){const o=i.popupTemplate.content;for(const a of o)a.type==="expression"&&a.expressionInfo&&r.push(Ol(e,t.fieldsIndex,a.expressionInfo.expression))}i.fields&&r.push(...i.fields.map(o=>vRe(e,t.fieldsIndex,o))),await Promise.all(r)}async function qwt(e,t,i){t&&(t.timeInfo&&_(i)&&i.timeExtent&&rR(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&rR(e,t.fieldsIndex,[t.floorInfo.floorField]),_(i)&&_(i.where)&&await Wde(e,t.fieldsIndex,i.where))}async function Wwt(e,t,i){t&&i&&await Promise.all(i.map(r=>_Re(e,t,r)))}async function _Re(e,t,i){t&&i&&(i.valueExpression?await Ol(e,t.fieldsIndex,i.valueExpression):i.field&&Gh(e,t.fieldsIndex,i.field))}function Xwt(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?qde(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function Ywt(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map(s=>bRe(e,r,s)))}async function bRe(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Ol(e,t,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Gh(e,t,o.slice(1,-1))})}await Wde(e,t,s)}function wRe(e){const t=e.defaultValue;return t!==void 0&&Zde(e,t)?t:e.nullable?null:void 0}function Xde(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function xRe(e){return e===null||Xde(e)}const kW="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function TRe(e){return e===null||kW(e)}function Yde(e){return e!=null&&typeof e=="string"}function SRe(e){return e===null||Yde(e)}function ERe(){return!0}function Zde(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?TRe:kW;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?xRe:Xde;break;case"string":case"esriFieldTypeString":i=e.nullable?SRe:Yde;break;default:i=ERe}return arguments.length===1?i:i(t)}const CRe=["integer","small-integer","single","double"],ARe=new Set([...CRe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function k5(e){return e!=null&&ARe.has(e.type)}function Zwt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}var CF,AF;function Qwt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function Jwt(e,t){return e.nullable&&t===null?null:k5(e)&&!MRe(e.type,Number(t))?CF.OUT_OF_RANGE:Zde(e,t)?e.domain?uRe(e.domain,t):null:AF.INVALID_TYPE}function MRe(e,t){const i=typeof e=="string"?Qde(e):e;return!!i&&(i.isInteger?kW(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}function Qde(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return ORe;case"esriFieldTypeInteger":case"integer":return RRe;case"esriFieldTypeSingle":case"single":return PRe;case"esriFieldTypeDouble":case"double":return IRe}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(CF||(CF={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(AF||(AF={}));const ORe={min:-32768,max:32767,isInteger:!0},RRe={min:-2147483648,max:2147483647,isInteger:!0},PRe={min:-34e37,max:12e37,isInteger:!1},IRe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function Kwt(e,t,i){switch(e){case $2.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case $2.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case AF.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case CF.OUT_OF_RANGE:{const{min:r,max:s}=Qde(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function $Re(e,t){return!DRe(e,t,null)}function DRe(e,t,i){if(!t||!t.attributes||!e){if(_(i))for(const n of e)i.add(n);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!_(i))break;i.add(n)}return s}function Jde(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let iL=class extends ve{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],iL.prototype,"type",void 0),iL=u([P("esri.popup.content.Content")],iL);const ox=iL;var s9;let C1=s9=class extends ox{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new s9({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],C1.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],C1.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],C1.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],C1.prototype,"type",void 0),C1=s9=u([P("esri.popup.content.AttachmentsContent")],C1);const sR=C1;var n9;let A1=n9=class extends ox{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new n9({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ie(this.outFields):null})}};u([d()],A1.prototype,"creator",void 0),u([d()],A1.prototype,"destroyer",void 0),u([d()],A1.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],A1.prototype,"type",void 0),A1=n9=u([P("esri.popup.content.CustomContent")],A1);const LRe=A1;var o9;let ST=o9=class extends ve{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new o9({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],ST.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],ST.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],ST.prototype,"returnType",void 0),ST=o9=u([P("esri.popup.ElementExpressionInfo")],ST);const Kde=ST;var a9;let kA=a9=class extends ox{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new a9({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([d({type:Kde,json:{write:!0}})],kA.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],kA.prototype,"type",void 0),kA=a9=u([P("esri.popup.content.ExpressionContent")],kA);const UW=kA;function ut(e,t={}){var s;const i=e instanceof wi?e:new wi(e,t),r={type:((s=t==null?void 0:t.ignoreUnknown)!=null?s:1)?i.apiValues:String,json:{type:i.jsonValues,read:!(t==null?void 0:t.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(r.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(r.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(r.json.name=t.name),d(r)}const nR=fa()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});nR.toJSON.bind(nR);nR.fromJSON.bind(nR);let sO;var Gue,jue,Hue;const zz=(Hue=(Gue=globalThis.esriConfig)==null?void 0:Gue.locale)!=null?Hue:(jue=globalThis.dojoConfig)==null?void 0:jue.locale;function epe(){var e,t;return(t=zz!=null?zz:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function ua(){return sO===void 0&&(sO=epe()),sO}function NRe(e=ua()){var t;return(t=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(e))==null?void 0:t[1].toLowerCase()}const nO=[];function FRe(e){return nO.push(e),{remove(){nO.splice(nO.indexOf(e),1)}}}const l9=[];function zW(e){return l9.push(e),{remove(){nO.splice(l9.indexOf(e),1)}}}function kRe(){const e=epe();sO!==e&&(sO=e,[...l9].forEach(t=>{t.call(null,e)}),[...nO].forEach(t=>{t.call(null,e)}))}var que;(que=globalThis.addEventListener)==null||que.call(globalThis,"languagechange",kRe);const Ip={year:"numeric",month:"numeric",day:"numeric"},wC={year:"numeric",month:"long",day:"numeric"},xC={year:"numeric",month:"short",day:"numeric"},TC={year:"numeric",month:"long",weekday:"long",day:"numeric"},ah={hour:"numeric",minute:"numeric"},hd=me(F({},ah),{second:"numeric"}),VW={"short-date":Ip,"short-date-short-time":F(F({},Ip),ah),"short-date-short-time-24":me(F(F({},Ip),ah),{hour12:!1}),"short-date-long-time":F(F({},Ip),hd),"short-date-long-time-24":me(F(F({},Ip),hd),{hour12:!1}),"short-date-le":Ip,"short-date-le-short-time":F(F({},Ip),ah),"short-date-le-short-time-24":me(F(F({},Ip),ah),{hour12:!1}),"short-date-le-long-time":F(F({},Ip),hd),"short-date-le-long-time-24":me(F(F({},Ip),hd),{hour12:!1}),"long-month-day-year":wC,"long-month-day-year-short-time":F(F({},wC),ah),"long-month-day-year-short-time-24":me(F(F({},wC),ah),{hour12:!1}),"long-month-day-year-long-time":F(F({},wC),hd),"long-month-day-year-long-time-24":me(F(F({},wC),hd),{hour12:!1}),"day-short-month-year":xC,"day-short-month-year-short-time":F(F({},xC),ah),"day-short-month-year-short-time-24":me(F(F({},xC),ah),{hour12:!1}),"day-short-month-year-long-time":F(F({},xC),hd),"day-short-month-year-long-time-24":me(F(F({},xC),hd),{hour12:!1}),"long-date":TC,"long-date-short-time":F(F({},TC),ah),"long-date-short-time-24":me(F(F({},TC),ah),{hour12:!1}),"long-date-long-time":F(F({},TC),hd),"long-date-long-time-24":me(F(F({},TC),hd),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":ah,"long-time":hd},oR=fa()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});oR.apiValues;oR.toJSON.bind(oR);oR.fromJSON.bind(oR);const URe={ar:"ar-u-nu-latn-ca-gregory"};let rL=new WeakMap,tpe=VW["short-date-short-time"];function ipe(e){const t=e||tpe;if(!rL.has(t)){const i=ua(),r=URe[ua()]||i;rL.set(t,new Intl.DateTimeFormat(r,t))}return rL.get(t)}function U5(e){return VW[e]||null}function Ls(e,t){return ipe(t).format(e)}zW(()=>{rL=new WeakMap,tpe=VW["short-date-short-time"]});const zRe={ar:"ar-u-nu-latn"};let sL=new WeakMap,rpe={};function VRe(e){const t=e||rpe;if(!sL.has(t)){const i=ua(),r=zRe[ua()]||i;sL.set(t,new Intl.NumberFormat(r,e))}return sL.get(t)}function spe(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function om(e,t){return e===-0&&(e=0),VRe(t).format(e)}zW(()=>{sL=new WeakMap,rpe={}});var c9;let M1=c9=class extends ve{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new c9({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Ls(e,F(F({},U5(this.dateFormat)),this.dateTimeFormatOptions)):om(e,spe(this))}formatRasterPixelValue(e){let t,i;return e.trim().includes(",")?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(";")?(t=";",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(" ")?(t=i=" ",this._formatDelimitedString(e,t,i,this)):this.format(Number(e))}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map(s=>this.format(Number(s))).join(i):e}};u([ut(nR)],M1.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],M1.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],M1.prototype,"digitSeparator",void 0),u([d({type:Sr,json:{write:!0}})],M1.prototype,"places",void 0),M1=c9=u([P("esri.popup.support.FieldInfoFormat")],M1);const TS=M1;var u9;let bd=u9=class extends ve{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new u9({fieldName:this.fieldName,format:this.format?ie(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],bd.prototype,"fieldName",void 0),u([d({type:TS,json:{write:!0}})],bd.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],bd.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],bd.prototype,"label",void 0),u([ut(new wi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],bd.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],bd.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],bd.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],bd.prototype,"visible",void 0),bd=u9=u([P("esri.popup.FieldInfo")],bd);const LP=bd;var h9;let Qm=h9=class extends ox{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new h9(ie({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],Qm.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Qm.prototype,"description",void 0),u([d({type:[LP]})],Qm.prototype,"fieldInfos",void 0),u([Be("fieldInfos")],Qm.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],Qm.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Qm.prototype,"type",void 0),Qm=h9=u([P("esri.popup.content.FieldsContent")],Qm);const D2=Qm;let O1=class extends ve{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],O1.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],O1.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],O1.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],O1.prototype,"type",void 0),O1=u([P("esri.popup.content.mixins.MediaInfo")],O1);const BW=O1;var d9;let ET=d9=class extends Se{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new d9({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],ET.prototype,"fieldName",void 0),u([d()],ET.prototype,"tooltip",void 0),u([d()],ET.prototype,"value",void 0),ET=d9=u([P("esri.popup.content.support.ChartMediaInfoValueSeries")],ET);const npe=ET;var p9;let R1=p9=class extends ve{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new p9({fields:ie(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],R1.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],R1.prototype,"normalizeField",void 0),u([d({type:[npe],json:{read:!1}})],R1.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],R1.prototype,"tooltipField",void 0),R1=p9=u([P("esri.popup.content.support.ChartMediaInfoValue")],R1);const BRe=R1;let UA=class extends BW{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],UA.prototype,"type",void 0),u([d({type:BRe,json:{write:!0}})],UA.prototype,"value",void 0),UA=u([P("esri.popup.content.mixins.ChartMediaInfo")],UA);const z5=UA,V5=fa()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var f9;let nL=f9=class extends z5{constructor(e){super(e),this.type="bar-chart"}clone(){return new f9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:V5.write}})],nL.prototype,"type",void 0),nL=f9=u([P("esri.popup.content.BarChartMediaInfo")],nL);const ope=nL;var m9;let oL=m9=class extends z5{constructor(e){super(e),this.type="column-chart"}clone(){return new m9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:V5.write}})],oL.prototype,"type",void 0),oL=m9=u([P("esri.popup.content.ColumnChartMediaInfo")],oL);const ape=oL;var g9;let zA=g9=class extends ve{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new g9({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],zA.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],zA.prototype,"sourceURL",void 0),zA=g9=u([P("esri.popup.content.support.ImageMediaInfoValue")],zA);const GRe=zA;var y9;let CT=y9=class extends BW{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new y9({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],CT.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],CT.prototype,"type",void 0),u([d({type:GRe,json:{write:!0}})],CT.prototype,"value",void 0),CT=y9=u([P("esri.popup.content.ImageMediaInfo")],CT);const lpe=CT;var v9;let aL=v9=class extends z5{constructor(e){super(e),this.type="line-chart"}clone(){return new v9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:V5.write}})],aL.prototype,"type",void 0),aL=v9=u([P("esri.popup.content.LineChartMediaInfo")],aL);const cpe=aL;var _9;let lL=_9=class extends z5{constructor(e){super(e),this.type="pie-chart"}clone(){return new _9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:V5.write}})],lL.prototype,"type",void 0),lL=_9=u([P("esri.popup.content.PieChartMediaInfo")],lL);const upe=lL,hpe={base:BW,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":ope,"column-chart":ape,"line-chart":cpe,"pie-chart":upe,image:lpe}};var b9;let wd=b9=class extends ox{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?lpe.fromJSON(t):t.type==="barchart"?ope.fromJSON(t):t.type==="columnchart"?ape.fromJSON(t):t.type==="linechart"?cpe.fromJSON(t):t.type==="piechart"?upe.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new b9(ie({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],wd.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],wd.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],wd.prototype,"description",void 0),u([d({types:[hpe]})],wd.prototype,"mediaInfos",void 0),u([Ue("mediaInfos")],wd.prototype,"readMediaInfos",null),u([Be("mediaInfos")],wd.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],wd.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],wd.prototype,"type",void 0),wd=b9=u([P("esri.popup.content.MediaContent")],wd);const aR=wd;var w9;let VA=w9=class extends ox{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new w9({text:this.text})}};u([d({type:String,json:{write:!0}})],VA.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],VA.prototype,"type",void 0),VA=w9=u([P("esri.popup.content.TextContent")],VA);const L2=VA,jRe={base:null,key:"type",typeMap:{attachment:sR,media:aR,text:L2,expression:UW,field:D2}};var x9;let P1=x9=class extends ve{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new x9({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],P1.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],P1.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],P1.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],P1.prototype,"returnType",void 0),P1=x9=u([P("esri.popup.ExpressionInfo")],P1);const dpe=P1;var T9;let BA=T9=class extends ve{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new T9({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],BA.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],BA.prototype,"showNoDataRecords",void 0),BA=T9=u([P("esri.popup.LayerOptions")],BA);const HRe=BA;var S9;let GA=S9=class extends ve{constructor(e){super(e),this.field=null,this.order=null}clone(){return new S9({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],GA.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],GA.prototype,"order",void 0),GA=S9=u([P("esri.popup.support.RelatedRecordsInfoFieldOrder")],GA);const ppe=GA;var E9;let jA=E9=class extends ve{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new E9({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ie(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],jA.prototype,"showRelatedRecords",void 0),u([d({type:[ppe],json:{write:!0}})],jA.prototype,"orderByFields",void 0),jA=E9=u([P("esri.popup.RelatedRecordsInfo")],jA);const qRe=jA;let WRe=0;const GW=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+WRe++})}};return t=u([P("esri.core.Identifiable")],t),t};let DK=class extends GW(class{}){};DK=u([P("esri.core.Identifiable")],DK);var C9;let xd=C9=class extends GW(Se){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new C9({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],xd.prototype,"active",void 0),u([d()],xd.prototype,"className",void 0),u([d()],xd.prototype,"disabled",void 0),u([d()],xd.prototype,"id",void 0),u([d()],xd.prototype,"indicator",void 0),u([d()],xd.prototype,"title",void 0),u([d()],xd.prototype,"type",void 0),u([d()],xd.prototype,"visible",void 0),xd=C9=u([P("esri.support.actions.ActionBase")],xd);const B5=xd;var A9;let cL=A9=class extends B5{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new A9({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],cL.prototype,"image",void 0),cL=A9=u([P("esri.support.Action.ActionButton")],cL);const HE=cL;var M9;let HA=M9=class extends B5{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new M9({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],HA.prototype,"image",void 0),u([d()],HA.prototype,"value",void 0),HA=M9=u([P("esri.support.Action.ActionToggle")],HA);const fpe=HA;var O9;const XRe=it.ofType({key:"type",defaultKeyValue:"button",base:B5,typeMap:{button:HE,toggle:fpe}}),YRe={base:ox,key:"type",typeMap:{media:aR,custom:LRe,text:L2,attachments:sR,fields:D2,expression:UW}},mpe="esri.PopupTemplate",ZRe=ge.getLogger(mpe),QRe=["attachments","fields","media","text","expression"];let Rn=O9=class extends ve{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>wp(YRe,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Bu(e)?e:(ZRe.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>QRe.includes(s.type)).map(s=>s&&s.toJSON(r)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"&&this._writeTextContent(s,t)})):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(r);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,i,r){t[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?ie(e.toArray()):[];return new O9({actions:t,content:Array.isArray(this.content)?ie(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?ie(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?ie(this.fieldInfos):null,layerOptions:this.layerOptions?ie(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?ie(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?ie(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),rR(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ie(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach(r=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===r.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(r)}):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ie(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!t||r.mediaInfos||(s.mediaInfos=t,r.mediaInfos=!0),aR.fromJSON(s)):s.type==="text"?(s.text||!e||r.description||(s.text=e,r.description=!0),L2.fromJSON(s)):s.type==="attachments"?sR.fromJSON(s):s.type==="fields"?D2.fromJSON(s):s.type==="expression"?UW.fromJSON(s):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new L2({text:e})):r.push(new D2),Array.isArray(t)&&t.length&&r.push(aR.fromJSON({mediaInfos:t})),i&&r.push(sR.fromJSON({displayType:"auto"})),r.length?r:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((r,s)=>[...r,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((i,r)=>[...i,...r.type==="expression"&&r.expressionInfo?[r.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,i)=>[...t,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map(r=>Ol(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.includes("relationships/")&&!t.includes("expression/")):[]}_getActionsFields(e){return e?e.toArray().reduce((t,i)=>[...t,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s=r==="button"||r==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,i=e.match(t);if(!i)return[];const r=/\{(\w+):.+\}/,s=i.filter(n=>!(n.indexOf("{relationships/")===0||n.indexOf("{expression/")===0)).map(n=>n.replace(r,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([d({type:XRe})],Rn.prototype,"actions",void 0),u([d()],Rn.prototype,"content",void 0),u([Rt("content")],Rn.prototype,"castContent",null),u([Ue("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],Rn.prototype,"readContent",null),u([Be("content",{popupElements:{type:it.ofType(jRe)},showAttachments:{type:Boolean},mediaInfos:{type:it.ofType(hpe)},description:{type:String}})],Rn.prototype,"writeContent",null),u([d({type:[dpe],json:{write:!0}})],Rn.prototype,"expressionInfos",void 0),u([d({type:[LP]})],Rn.prototype,"fieldInfos",void 0),u([Be("fieldInfos")],Rn.prototype,"writeFieldInfos",null),u([d({type:HRe})],Rn.prototype,"layerOptions",void 0),u([Be("layerOptions")],Rn.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Rn.prototype,"lastEditInfoEnabled",void 0),u([d()],Rn.prototype,"outFields",void 0),u([d()],Rn.prototype,"overwriteActions",void 0),u([d()],Rn.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],Rn.prototype,"title",void 0),u([Be("title")],Rn.prototype,"writeTitle",null),u([d({type:qRe,json:{write:!0}})],Rn.prototype,"relatedRecordsInfo",void 0),Rn=O9=u([P(mpe)],Rn);const NP=Rn,MF={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function gpe(e){return MF[e]||MF[e.toLowerCase()]}function jW(e){var t;return(t=MF[e])!=null?t:MF[e.toLowerCase()]}function JRe(e){return[...jW(e)]}function Vz(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function ype(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(255*Vz(o,n,s+1/3)),Math.round(255*Vz(o,n,s)),Math.round(255*Vz(o,n,s-1/3)),r]}function KRe(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function rI(e){return De(uW(e),0,255)}function sI(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class vn{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,i,r,s=new vn){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),vn.fromArray(a,i)}return vn.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return vn.fromArray(ype(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new vn){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const r=t.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(t,i=new vn){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=gpe(t)?jW(t):null;return r&&vn.fromArray(r,i)||vn.fromRgb(t,i)||vn.fromHex(t,i)}static fromJSON(t){return t&&new vn([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return _(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return _(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var i,r,s,n;return typeof t=="string"?vn.fromString(t,this):Array.isArray(t)?vn.fromArray(t,this):(this._set((i=t.r)!=null?i:0,(r=t.g)!=null?r:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof vn||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=vn.AlphaMode.ALWAYS){const i=rI(this.r),r=rI(this.g),s=rI(this.b);return t===vn.AlphaMode.ALWAYS||this.a!==1?[i,r,s,rI(255*this.a)]:[i,r,s]}clone(){return new vn(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return _(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(sI(this.r,0,255)),this.g=Math.round(sI(this.g,0,255)),this.b=Math.round(sI(this.b,0,255)),this.a=sI(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}}vn.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(vn||(vn={}));const We=vn,LK=new wi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let ePe=0,AT=class extends ve{constructor(e){super(e),this.id="sym"+ePe++,this.type=null,this.color=new We([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:LK.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:LK.write}}})],AT.prototype,"type",void 0),u([d({type:We,json:{write:{allowNull:!0}}})],AT.prototype,"color",void 0),u([Ue("color")],AT.prototype,"readColor",null),AT=u([P("esri.symbols.Symbol")],AT);const Pc=AT;var R9;let T0=R9=class extends Pc{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return Ol(e,t,n.expression)});await Promise.all(r)}}}clone(){return new R9({data:ie(this.data)})}hash(){return sW(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],T0.prototype,"color",void 0),u([d({json:{write:!0}})],T0.prototype,"data",void 0),u([Ue("data",["symbol"])],T0.prototype,"readData",null),u([Be("data",{})],T0.prototype,"writeData",null),u([ut({CIMSymbolReference:"cim"},{readOnly:!0})],T0.prototype,"type",void 0),T0=R9=u([P("esri.symbols.CIMSymbol")],T0);const qE=T0;let MT=class extends ve{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],MT.prototype,"enabled",void 0),u([Be("enabled")],MT.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],MT.prototype,"type",void 0),MT=u([P("esri.symbols.Symbol3DLayer")],MT);const wm=MT,tPe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,iPe="screenUtils.toPt: input not recognized!",vpe=96;function fo(e){return e?e/72*vpe:0}function Du(e){return e?72*e/vpe:0}function rr(e){if(typeof e=="string"){const t=e.match(tPe);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=r==="px"?Du(i):i;return s?-n:n}return console.warn(iPe),null}return e}function Tp(e=0,t=0){return{x:e,y:t}}function Yr(e=0,t=0){return[e,t]}function rPe(e=0,t=0){return[e,t]}function Fo(e=0,t=0,i=0){return[e,t,i]}function ext(e){return e}function txt(e){return e}function ixt(e){return e}function Lg(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function FP(e){const t=uW(100*(1-e));return Math.max(0,Math.min(t,100))}function N2(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function sPe(e,t){const i=t.transparency!=null?N2(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new We([r[0]||0,r[1]||0,r[2]||0,i]):null}function nPe(e,t){t.color=e.toJSON().slice(0,3);const i=FP(e.a);i!==0&&(t.transparency=i)}const xy={type:We,json:{type:[Sr],default:null,read:{source:["color","transparency"],reader:sPe},write:{target:{color:{type:[Sr]},transparency:{type:Sr}},writer:nPe}}},am={type:Number,cast:rr,json:{write:!0}};let I1=class extends ve{constructor(e){super(e),this.color=new We([0,0,0,1]),this.extensionLength=0,this.size=Du(1)}clone(){}cloneProperties(){return{color:ie(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],I1.prototype,"type",void 0),u([d(xy)],I1.prototype,"color",void 0),u([d(me(F({},am),{json:{write:{overridePolicy:e=>({enabled:!!e})}}}))],I1.prototype,"extensionLength",void 0),u([d(am)],I1.prototype,"size",void 0),I1=u([P("esri.symbols.edges.Edges3D")],I1);const HW=I1;var P9;let uL=P9=class extends HW{constructor(e){super(e),this.type="sketch"}clone(){return new P9(this.cloneProperties())}};u([ut({sketch:"sketch"},{readOnly:!0})],uL.prototype,"type",void 0),uL=P9=u([P("esri.symbols.edges.SketchEdges3D")],uL);const oPe=uL;var I9;let hL=I9=class extends HW{constructor(e){super(e),this.type="solid"}clone(){return new I9(this.cloneProperties())}};u([ut({solid:"solid"},{readOnly:!0})],hL.prototype,"type",void 0),hL=I9=u([P("esri.symbols.support.SolidEdges3D")],hL);const aPe=hL,_pe={types:{key:"type",base:HW,typeMap:{solid:aPe,sketch:oPe}},json:{write:!0}};var $9;let Cu=$9=class extends ve{constructor(e){super(e),this.color=null}clone(){const e={color:_(this.color)?this.color.clone():null};return new $9(e)}};u([d(xy)],Cu.prototype,"color",void 0),Cu=$9=u([P("esri.symbols.support.Symbol3DMaterial")],Cu);var D9;let S0=D9=class extends wm{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new D9({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([ut({Extrude:"extrude"},{readOnly:!0})],S0.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],S0.prototype,"size",void 0),u([d({type:Cu,json:{write:!0}})],S0.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],S0.prototype,"castShadows",void 0),u([d(_pe)],S0.prototype,"edges",void 0),S0=D9=u([P("esri.symbols.ExtrudeSymbol3DLayer")],S0);const bpe=S0;let qA=class extends Pc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([ut({esriSLS:"simple-line"},{readOnly:!0})],qA.prototype,"type",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],qA.prototype,"width",void 0),qA=u([P("esri.symbols.LineSymbol")],qA);const lPe=qA,cPe=["begin","end","begin-end"],wpe=["arrow","circle","square","diamond","cross","x"];var L9;let rf=L9=class extends ve{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new L9({color:ie(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],rf.prototype,"placement",void 0),u([ut({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],rf.prototype,"type",void 0),u([d({type:wpe})],rf.prototype,"style",void 0),u([Be("style")],rf.prototype,"writeStyle",null),u([d({type:We,value:null,json:{write:{allowNull:!0}}})],rf.prototype,"color",null),u([Ue("color")],rf.prototype,"readColor",null),u([Be("color")],rf.prototype,"writeColor",null),rf=L9=u([P("esri.symbols.LineSymbolMarker")],rf);const uPe=rf;var N9;const Bz=new wi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Jm=N9=class extends lPe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),i!=null&&(o.width=rr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=rr(n)),o}clone(){var e;return new N9({color:ie(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([ut({esriSLS:"simple-line"},{readOnly:!0})],Jm.prototype,"type",void 0),u([d({type:Bz.apiValues,json:{read:Bz.read,write:Bz.write}})],Jm.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],Jm.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],Jm.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":uPe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Jm.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],Jm.prototype,"miterLimit",void 0),Jm=N9=u([P("esri.symbols.SimpleLineSymbol")],Jm);const od=Jm;let WA=class extends Pc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":od}},json:{default:null,write:!0}})],WA.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],WA.prototype,"type",void 0),WA=u([P("esri.symbols.FillSymbol")],WA);const xpe=WA;let dL=class extends ve{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],dL.prototype,"type",void 0),dL=u([P("esri.symbols.patterns.LinePattern3D")],dL);const Tpe=dL,hPe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var F9;const dPe=fa()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let XA=F9=class extends Tpe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new F9(e)}};u([d({type:["style"]})],XA.prototype,"type",void 0),u([ut(dPe),d({type:hPe})],XA.prototype,"style",void 0),XA=F9=u([P("esri.symbols.patterns.LineStylePattern3D")],XA);const qW=XA;let pL=class extends ve{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],pL.prototype,"type",void 0),pL=u([P("esri.symbols.patterns.Pattern3D")],pL);const Spe=pL,pPe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var k9;let YA=k9=class extends Spe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new k9(e)}};u([d({type:["style"]})],YA.prototype,"type",void 0),u([d({type:pPe,json:{read:!0,write:!0}})],YA.prototype,"style",void 0),YA=k9=u([P("esri.symbols.patterns.StylePattern3D")],YA);const Epe=YA,fPe={types:{key:"type",base:Spe,typeMap:{style:Epe}},json:{write:!0}},Cpe={types:{key:"type",base:Tpe,typeMap:{style:qW}},json:{write:!0}},oO=new We("white");new We("black");const mPe=new We([255,255,255,0]);function gPe(e){return e.r===0&&e.g===0&&e.b===0}var U9;let aO=U9=class extends Cu{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:_(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new U9(e)}};u([ut({multiply:"multiply",replace:"replace",tint:"tint"})],aO.prototype,"colorMixMode",void 0),aO=U9=u([P("esri.symbols.support.Symbol3DFillMaterial")],aO);function Nt(e=bPe){return[e[0],e[1],e[2],e[3]]}function rxt(e){return[e[0],e[1],e[2],e[3]]}function ay(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function WW(e,t,i,r,s=Nt()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Ape(e,t=Nt()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function G5(e,t){return new ui({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function JS(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function rw(e,t,i){if(M(t))ay(i,e);else if("length"in t)V9(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function Gz(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<r;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function z9(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function vu(e){return M(e)||e[0]>=e[2]?0:e[2]-e[0]}function Sp(e){return e[1]>=e[3]?0:e[3]-e[1]}function Mpe(e){return vu(e)*Sp(e)}function XW(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Ope(e,t){return YW(e,t[0],t[1])}function NK(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function sxt(e,t,i){const r=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=i,p=(w,b)=>(h-l)*w+(a-c)*b+(c*l-a*h)<0,f=p(r,o),m=p(n,o),y=p(n,s),v=p(r,s);return!(f===m&&m===y&&y===v&&v===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function nxt(e,t){return YW(e,t.x,t.y)}function YW(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function ZA(e,t,i,r){return t>=e[0]-r&&i>=e[1]-r&&t<=e[2]+r&&i<=e[3]+r}function yPe(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function kP(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function FK(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function fL(e,t,i){if(M(t))return ay(i,e);const r=t[0],s=t[1],n=t[2],o=t[3];return i[0]=De(e[0],r,n),i[1]=De(e[1],s,o),i[2]=De(e[2],r,n),i[3]=De(e[3],s,o),i}function vPe(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-vu(e)/2,0),n=Math.max(Math.abs(t[1]-r)-Sp(e)/2,0);return Math.sqrt(s*s+n*n)}function OF(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function Lu(e){return e?ay(e,B9):Nt(B9)}function V9(e){return e!=null&&e.length===4}function _Pe(e){return!(vu(e)!==0&&isFinite(e[0])||Sp(e)!==0&&isFinite(e[1]))}function sw(e,t){return V9(e)&&V9(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const oxt=[-1/0,-1/0,1/0,1/0],B9=[1/0,1/0,-1/0,-1/0],bPe=[0,0,0,0];function Hs(e=Dpe){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Ew(e,t,i,r,s,n,o=Hs()){return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function axt(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new ui(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function F2(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function wPe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function lm(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Su(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<r;h++)s=Math.min(s,t[i+3*h]),n=Math.min(n,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),l=Math.max(l,t[i+3*h+1]),c=Math.max(c,t[i+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function jz(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function xPe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function ax(e){return e[0]>=e[3]?0:e[3]-e[0]}function lx(e){return e[1]>=e[4]?0:e[4]-e[1]}function C_(e){return e[2]>=e[5]?0:e[5]-e[2]}function Rpe(e){const t=ax(e),i=C_(e),r=lx(e);return Math.sqrt(t*t+i*i+r*r)}function op(e,t=[0,0,0]){return t[0]=e[0]+ax(e)/2,t[1]=e[1]+lx(e)/2,t[2]=e[2]+C_(e)/2,t}function nI(e,t=[0,0,0]){return t[0]=ax(e),t[1]=lx(e),t[2]=C_(e),t}function TPe(e){return Math.max(ax(e),C_(e),lx(e))}function ZW(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function lxt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function SPe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function ap(e,t){return!!M(t)||SPe(e,t)}function Ppe(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function cxt(e,t,i=e){const r=e[0]+ax(e)/2,s=e[1]+lx(e)/2,n=e[2]+C_(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function Ipe(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function $pe(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function j5(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function mr(e){return e?j5(e,UK):Hs(UK)}function QW(e,t){return t||(t=Nt()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function uxt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function kK(e){return e.length===6}function H5(e){return ax(e)===0&&lx(e)===0&&C_(e)===0}function hxt(e,t,i){if(M(e)||M(t))return e===t;if(!kK(e)||!kK(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function EPe(e,t,i,r,s,n){return Ew(e,t,i,r,s,n,CPe)}const dxt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],UK=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Dpe=[0,0,0,0,0,0],CPe=Hs();function Hz(e,{isPrimitive:t,width:i,depth:r,height:s}){const n=t?10:1;if(i==null&&s==null&&r==null)return[n*e[0],n*e[1],n*e[2]];const o=Fe(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const APe=Ew(-.5,-.5,-.5,.5,.5,.5),MPe=Ew(-.5,-.5,0,.5,.5,1),OPe=Ew(-.5,-.5,0,.5,.5,.5);function RPe(e){switch(e){case"sphere":case"cube":case"diamond":return APe;case"cylinder":case"cone":case"inverted-cone":return MPe;case"tetrahedron":return OPe;default:return}}const JW=["butt","square","round"],PPe=[...JW,"none"],Lpe=["miter","bevel","round"];var G9;let $1=G9=class extends ve{constructor(e){super(e),this.color=new We([0,0,0,1]),this.size=Du(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size,pattern:_(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new G9(e)}};u([d(xy)],$1.prototype,"color",void 0),u([d(am)],$1.prototype,"size",void 0),u([d(Cpe)],$1.prototype,"pattern",void 0),u([d({type:JW,json:{default:"butt",write:{overridePolicy(){return{enabled:_(this.pattern)}}}}})],$1.prototype,"patternCap",void 0),$1=G9=u([P("esri.symbols.support.Symbol3DOutline")],$1);var mL;let Km=mL=class extends wm{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:_(this.edges)?this.edges.clone():null,enabled:this.enabled,material:_(this.material)?this.material.clone():null,pattern:_(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:_(this.outline)?this.outline.clone():null};return new mL(e)}static fromSimpleFillSymbol(e){var r,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new qW({style:e.outline.style}):null,i={size:(s=(r=e.outline)==null?void 0:r.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:oO).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(i.patternCap=e.outline.cap),new mL({material:new aO({color:((l=e.color)!=null?l:mPe).clone()}),pattern:e.style&&e.style!=="solid"?new Epe({style:e.style}):null,outline:i})}};u([ut({Fill:"fill"},{readOnly:!0})],Km.prototype,"type",void 0),u([d({type:aO,json:{write:!0}})],Km.prototype,"material",void 0),u([d(fPe)],Km.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Km.prototype,"castShadows",void 0),u([d({type:$1,json:{write:!0}})],Km.prototype,"outline",void 0),u([d(_pe)],Km.prototype,"edges",void 0),Km=mL=u([P("esri.symbols.FillSymbol3DLayer")],Km);const q5=Km,IPe=["none","underline","line-through"],$Pe=["normal","italic","oblique"],DPe=["normal","lighter","bold","bolder"],Npe={type:Number,cast:e=>{const t=Rh(e);return t===0?1:De(t,.1,4)},nonNullable:!0},LPe=["left","right","center"],NPe=["baseline","top","middle","bottom"],Fpe={type:LPe,nonNullable:!0},kpe={type:NPe,nonNullable:!0};var j9;let eg=j9=class extends ve{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return rr(e)}clone(){return new j9({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:IPe,json:{default:"none",write:!0}})],eg.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],eg.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],eg.prototype,"size",void 0),u([Rt("size")],eg.prototype,"castSize",null),u([d({type:$Pe,json:{default:"normal",write:!0}})],eg.prototype,"style",void 0),u([d({type:DPe,json:{default:"normal",write:!0}})],eg.prototype,"weight",void 0),eg=j9=u([P("esri.symbols.Font")],eg);const W5=eg,FPe=ge.getLogger("esri.core.urlUtils"),WE=ki.request,zK="esri/config: esriConfig.request.proxyUrl is not set.",Upe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,zpe=/^\s*http:/i,kPe=/^\s*https:/i,UPe=/^\s*file:/i,zPe=/:\d+$/,VPe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,BPe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),GPe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class KS{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(BPe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(GPe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}}const oI={},jPe=new KS(ki.applicationUrl);let ka=jPe;const HPe=qPe();let KW=HPe;const eX=()=>ka,pxt=()=>KW;function qPe(){const e=ka.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${ka.scheme}://${ka.host}${ka.port!=null?`:${ka.port}`:""}`}${t}`}function xn(e){const t={path:null,query:null},i=new KS(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=Vpe(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function Vpe(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function VK(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function lR(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>VK(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):VK(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function WPe(e=!1){let t,i=WE.proxyUrl;if(typeof e=="string"){t=KPe(e);const r=X5(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw FPe.warn(zK),new q("urlutils:proxy-not-set",zK);return t&&H9()&&(i=nX(i)),xn(i)}function fxt(e){const t=X5(e);let i,r;if(t){const s=tX(t.proxyUrl);i=s.path,r=s.query?Vpe(s.query):null}if(i){const s=xn(e);e=i+"?"+s.path;const n=lR(F(F({},r),s.query));n&&(e=`${e}?${n}`)}return e}const SC={path:"",query:""};function tX(e){const t=e.indexOf("?");return t!==-1?(SC.path=e.slice(0,t),SC.query=e.slice(t+1)):(SC.path=e,SC.query=null),SC}function Bpe(e){return e=(e=RF(e=n3e(e=tX(e).path),!0)).toLowerCase()}function XPe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:Bpe(e.urlPrefix)},i=WE.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,t),s}function X5(e){const t=WE.proxyRules,i=Bpe(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function Gpe(e,t){return e=BK(e),t=BK(t),RF(e)===RF(t)}function BK(e){const t=(e=jh(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function jpe(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=WE.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function cR(e,t,i=!1){const r=W9(e),s=W9(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function iX(e){if(typeof e=="string"){if(!Au(e))return!0;e=W9(e)}if(cR(e,ka))return!0;const t=WE.trustedServers||[];for(let i=0;i<t.length;i++){const r=YPe(t[i]);for(let s=0;s<r.length;s++)if(cR(e,r[s]))return!0}return!1}function YPe(e){return oI[e]||(sX(e)||cm(e)?oI[e]=[new KS(zh(e))]:oI[e]=[new KS(`http://${e}`),new KS(`https://${e}`)]),oI[e]}function zh(e,t=KW,i){return cm(e)?i&&i.preserveProtocolRelative?e:ka.scheme==="http"&&ka.authority===fp(e).slice(2)?`http:${e}`:`https:${e}`:sX(e)?e:Nu(e[0]==="/"?r3e(t):t,e)}function rX(e,t=KW,i){if(!Au(e))return e;const r=jh(e),s=r.toLowerCase(),n=jh(t).toLowerCase().replace(/\/+$/,""),o=i?jh(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function jh(e){return e=l3e(e=a3e(e=o3e(e=zh(e=e.trim()))))}function Nu(...e){const t=e.filter(_);if(!t||!t.length)return;const i=[];if(Au(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),t3e(t[0])&&(i[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function fp(e,t=!1){if(k2(e)||xm(e))return null;let i=e.indexOf("://");if(i===-1&&cm(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=RF(e,!0)),e}function Au(e){return cm(e)||sX(e)}function k2(e){return e!=null&&e.slice(0,5)==="blob:"}function xm(e){return e.slice(0,5)==="data:"}function Hpe(e){const t=Y5(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function mxt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const ZPe=/^data:(.*?)(;base64)?,(.*)$/;function Y5(e){const t=e.match(ZPe);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function qpe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function gxt(e,t){QPe(e,t)||JPe(e,t)}function QPe(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function JPe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function cm(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function sX(e){return Upe.test(e)}function KPe(e){return kPe.test(e)||ka.scheme==="https"&&cm(e)}function e3e(e){return zpe.test(e)||ka.scheme==="http"&&cm(e)}function t3e(e){return UPe.test(e)}function nX(e){return cm(e)?`https:${e}`:e.replace(zpe,"https:")}function i3e(){return ka.scheme==="http"}function H9(){return ka.scheme==="https"}function RF(e,t=!1){return cm(e)?e.slice(2):(e=e.replace(Upe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function r3e(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function s3e(e){let t=0;if(Au(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function yxt(e,t){if(!e)return"";const i=xn(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(t==null?void 0:t.length))return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function n3e(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function Wpe(e){return e.replace(/\/+$/,"")}function o3e(e){if(/^https?:\/\//i.test(e)){const t=tX(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function a3e(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function l3e(e){const t=WE.httpsDomains;if(!e3e(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),zPe.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return i3e()&&r===ka.authority&&!VPe.test(e)||(H9()&&r===ka.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||H9()&&!X5(e))&&(e=nX(e)),e}function q9(e,t,i){if(!(t&&i&&e&&Au(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function W9(e){return typeof e=="string"?new KS(zh(e)):(e.scheme||(e.scheme=ka.scheme),e)}function oX(e){return h3e.test(e)}function Xpe(e,t){const i=xn(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function aX(e,t,i){const r=xn(e),s=r.query||{};return s[t]=String(i),`${r.path}?${lR(s)}`}function qz(e,t){const i=xn(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=lR(r);return s?`${i.path}?${s}`:i.path}function c3e(e){if(M(e))return null;const t=e.match(u3e);return t?t[1]:null}const u3e=/.*?\.([^\/]*)$/,h3e=/(^data:image\/svg|\.svg$)/i;function XE(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=zh(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=rX(e,t.portalItem.itemUrl);p3e.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return X9(e,t&&t.portal)}function Cw(e,t,i=uR.YES){if(!e)return e;!Au(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=zh(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=X9(s,t.portal);r=rX(X9(r,t.portal),n,n),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=Ype(r,t&&t.portal),Au(r)&&(r=jh(r)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!Au(r)&&!xm(r)&&i===uR.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function lX(e,t,i){return XE(e,i)}function o_(e,t,i,r){const s=Cw(e,r);s!==void 0&&(t[i]=s)}const d3e=/\/items\/([^\/]+)\/resources\//,p3e=/^\.\/resources\//;function f3e(e){const t=_(e)?e.match(d3e):null;return _(t)?t[1]:null}function Ype(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?q9(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function X9(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=eX();return cR(r,`${r.scheme}://${i}`)?q9(e,t.portalHostname,i):q9(e,i,t.portalHostname)}var uR;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(uR||(uR={}));const vxt=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:XE,toJSON:Cw,read:lX,write:o_,itemIdFromResourceUrl:f3e,ensureMainOnlineDomain:Ype,get MarkKeep(){return uR}},Symbol.toStringTag,{value:"Module"}));var Y9;const m3e=fa()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let D1=Y9=class extends ve{constructor(e){super(e)}readHref(e,t,i){return e?XE(e,i):t.dataURI}writeHref(e,t,i,r){e&&(xm(e)?t.dataURI=e:(t.href=Cw(e,r),Au(t.href)&&(t.href=jh(t.href))))}clone(){return new Y9({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],D1.prototype,"href",void 0),u([Ue("href")],D1.prototype,"readHref",null),u([Be("href",{href:{type:String},dataURI:{type:String}})],D1.prototype,"writeHref",null),u([ut(m3e)],D1.prototype,"primitive",void 0),D1=Y9=u([P("esri.symbols.support.IconSymbol3DLayerResource")],D1);const g3e="circle";var Z9;let SS=Z9=class extends Se{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new Z9({x:this.x,y:this.y})}};u([d({type:Number})],SS.prototype,"x",void 0),u([d({type:Number})],SS.prototype,"y",void 0),SS=Z9=u([P("esri.symbols.support.Symbol3DAnchorPosition2D")],SS);var Q9;let QA=Q9=class extends ve{constructor(e){super(e),this.color=new We([0,0,0,1]),this.size=Du(1)}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size};return new Q9(e)}};u([d(xy)],QA.prototype,"color",void 0),u([d(am)],QA.prototype,"size",void 0),QA=Q9=u([P("esri.symbols.support.Symbol3DIconOutline")],QA);var OT;const y3e=ge.getLogger("esri.symbols.IconSymbol3DLayer");let sf=OT=class extends wm{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new OT({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,outline:_(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||oO,i=GK(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||oO).clone()}:null;return new OT({size:e.size,resource:{primitive:_3e(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||gPe(e.color)?oO:e.color,i=GK(e);return new OT({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new OT({resource:{href:qpe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function GK(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=jK(e.xoffset),s=jK(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function jK(e){return isFinite(e)?e:0}u([d({type:Cu,json:{write:!0}})],sf.prototype,"material",void 0),u([d({type:D1,json:{write:!0}})],sf.prototype,"resource",void 0),u([ut({Icon:"icon"},{readOnly:!0})],sf.prototype,"type",void 0),u([d(am)],sf.prototype,"size",void 0),u([ut({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],sf.prototype,"anchor",void 0),u([d({type:SS,json:{type:[Number],read:{reader:e=>new SS({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],sf.prototype,"anchorPosition",void 0),u([d({type:QA,json:{write:!0}})],sf.prototype,"outline",void 0),sf=OT=u([P("esri.symbols.IconSymbol3DLayer")],sf);const v3e={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function _3e(e){return v3e[e]||(y3e.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Cv=sf;function ly(e,t,i=it){return t||(t=new i),t===e||(t.removeAll(),b3e(e)?t.addMany(e):e&&t.add(e)),t}function cX(e){return e}function b3e(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const Zpe="20220629",Qpe="424f75793a8d4dbd3ac1b1c1476f478c61e1ff6e",uX="4.24",w3e={async request(e,t){var a;const{default:i}=await Promise.resolve().then(function(){return F3e}),r=e.options,s=r.responseType;r.signal=t==null?void 0:t.signal,r.responseType=s==="native"||s==="native-request-init"?"native-request-init":["blob","json","text"].includes(s)&&((a=jpe(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await i(e.url,r),o={data:n.data,ssl:n.ssl};switch(n.requestOptions.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let zs;function _xt(e){zs=e}function bxt(e){const t=zs&&zs.findCredential(e);return t&&t.token?aX(e,"token",t.token):e}he("host-webworker")||(he("edge")||he("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const x3e=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function Jpe(e){const t=fp(e,!0);return t&&t.endsWith(".arcgis.com")&&!x3e.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function Kpe(e,t,i=!1,r){return new Promise((s,n)=>{if(nn(r))return void n(HK());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n(HK())};const c=()=>{he("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,_(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(t)};_(r)&&r.addEventListener("abort",l),he("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function HK(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function T3e(e){ki.request.crossOriginNoCorsDomains||(ki.request.crossOriginNoCorsDomains={});const t=ki.request.crossOriginNoCorsDomains;for(let i of e)i=i.toLowerCase(),/^https?:\/\//.test(i)?t[fp(i)]=0:(t[fp("http://"+i)]=0,t[fp("https://"+i)]=0)}function S3e(e){const t=ki.request.crossOriginNoCorsDomains;if(t){let i=fp(e);if(i)return i=i.toLowerCase(),!cR(i,eX())&&t[i]<Date.now()-36e5}return!1}async function E3e(e){var r;const t=ki.request.crossOriginNoCorsDomains;t&&(t[fp(e).toLowerCase()]=Date.now());const i=xn(e);e=i.path,((r=i.query)==null?void 0:r.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function gr(e,t){var c;const i=xm(e),r=k2(e);r||i||(e=jh(e));const s={url:e,requestOptions:F({},t)};let n=jpe(e);if(n){const h=await $3e(n,s);if(h!=null)return{data:h,getHeader:hX,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(he("host-webworker")||he("host-node"))throw lp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw lp("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw lp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw lp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await R3e(),PF)return PF.execute(e,t);const o=new AbortController;ha(t,()=>o.abort());const a={controller:o,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:jd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await L3e(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let PF;const jd=ki.request,efe="FormData"in globalThis,C3e=[499,498,403,401],A3e=["COM_0056","COM_0057","SB_0008"],M3e=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],hX=()=>null,J9=Symbol();function O3e(e){const t=fp(e);t&&!gr._corsServers.includes(t)&&gr._corsServers.push(t)}function qK(e){const t=fp(e);return!t||t.endsWith(".arcgis.com")||gr._corsServers.includes(t)||iX(t)}function lp(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:hX,ssl:!1};if(t instanceof q)return t.details?(t.details=ie(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=J9 in t?t[J9]:t}return Qr(t)?hi():new q(e,s,n)}async function R3e(){he("host-webworker")?PF||(PF=await import("./request.4978cc3e.js")):gr._abortableFetch||(gr._abortableFetch=globalThis.fetch.bind(globalThis))}async function K9(){zs||await import("./IdentityManager.55d209e8.js")}async function P3e(e){var a;const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,o=null;if(efe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:i.cacheBust&&!gr._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:jd.priority,redirect:"follow",signal:r},(n||o)&&(e.fetchOptions.body=n||o),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=i.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&ki.apiKey&&Jpe(t)&&(i.query||(i.query={}),i.query.token=ki.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!tfe(t)&&!nn(r)){let l;i.authMode==="immediate"?(await K9(),l=await zs.getCredential(t,{signal:r}),e.credential=l):i.authMode==="no-prompt"?(await K9(),l=await zs.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=l):zs&&(l=zs.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function tfe(e){return M3e.some(t=>t.test(e))}async function I3e(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,s=k2(t)||xm(t),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:jd.timeout;let a=!1;if(!s){e.useSSL&&(t=nX(t)),i.cacheBust&&r.cache==="default"&&(t=aX(t,"request.preventCache",Date.now()));let f=F({},i.query);e.credentialToken&&(f.token=e.credentialToken);let m=lR(f);he("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const y=t.length+1+m.length;let v;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||y>jd.maxUrlLength;const w=i.useProxy||!!X5(t);if(w){const b=WPe(t);v=b.path,!a&&v.length+1+y>jd.maxUrlLength&&(a=!0),b.query&&(f=F(F({},b.query),f))}if(r.method==="HEAD"&&(a||w)){if(a)throw y>jd.maxUrlLength?lp("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):lp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(w)throw lp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=qz(t,f):(r.body=lR(f),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=qz(t,f),w&&(e.useProxy=!0,t=`${v}?${t}`),f.token&&efe&&r.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!cR(t,eX())){if(iX(t))e.withCredentials=!0;else if(zs){const b=zs.findServerInfo(t);b&&b.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include",S3e(t)&&await E3e(a?qz(t,f):t))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||D3e(i.headers)||!s&&!e.useProxy&&jd.proxyUrl&&!qK(t)){if(l=await gr._abortableFetch(t,r),e.useProxy||O3e(t),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=WK(c,"application/xml");break;case"document":c=WK(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await XK(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await XK(t,e)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):hi("Request canceled");if(!(!l&&f instanceof TypeError&&jd.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||qK(t))throw f;e.redoRequest=!0,XPe({proxyUrl:jd.proxyUrl,urlPrefix:fp(t)})}finally{h&&clearTimeout(h)}return[l,c]}async function $3e(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers=F(F({},t.requestOptions.headers),e.headers)),e.query&&(t.requestOptions.query=F(F({},t.requestOptions.query),e.query)),e.before){let i,r;try{r=await e.before(t)}catch(s){i=lp("request:interceptor",s,t)}if((r instanceof Error||r instanceof q)&&(i=lp("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function D3e(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function WK(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function L3e(e){var n;let t,i;await P3e(e);try{do[t,i]=await I3e(e);while(!await N3e(e,t,i))}catch(o){const a=lp("request:server",o,e.params,t);throw a.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(a),a}const r=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!e.hasToken&&!e.credentialToken&&((n=i.user)==null?void 0:n.username)&&!iX(r)){const o=fp(r,!0);o&&jd.trustedServers.push(o)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&T3e(i.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&zs){const o=zs.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=zs.findCredential(a,s.userId);l&&zs._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:i,getHeader:t?o=>t.headers.get(o):hX,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function N3e(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n,o,a;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[J9]=i,s;(i==null?void 0:i.error)&&(s=i.error),s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a&&a.toUpperCase());const l=r.authMode;if(n===403&&(o===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&C3e.includes(n)&&!tfe(e.params.url)&&(n!==403||!A3e.includes(a)&&(o==null||o===2&&e.credentialToken))){await K9();try{const c=await zs.getCredential(e.params.url,{error:lp("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=null,e.credentialToken=null,!1;s=c}}if(s)throw s;return!0}function XK(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=jd.priority,s.src=e,Kpe(s,e,i,r)}gr._abortableFetch=null,gr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var F3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:gr}),iv;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(iv||(iv={}));class k3e{constructor(t){this.instance=t,this._resolver=r_(),this._status=iv.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=iv.RESOLVED,this._cleanUp()},()=>{this._status=iv.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===iv.RESOLVED}isRejected(){return this._status===iv.REJECTED}isFulfilled(){return this._status!==iv.PENDING}abort(){this._resolver.reject(hi())}when(t,i){return this._resolver.promise.then(t,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=r_(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||Qr(s)||this._resolver.reject(s)}),t.resolve()}}const UP=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new k3e(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=u([P("esri.core.Promise")],t),t};let IF=class extends UP(Se){};IF=u([P("esri.core.Promise")],IF);const U3e="not-loaded",z3e="loading",V3e="failed",YK="loaded",ife=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=I5(n,l);this.destroyed&&l(new q("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===U3e){this._set("loadStatus",z3e);const a=this._loadController=new AbortController;s({signal:a.signal}),ha(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",YK),this._loadController=null},r=>{this._set("loadStatus",V3e),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===YK}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new q("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([d({readOnly:!0})],t.prototype,"loaded",null),u([d({readOnly:!0})],t.prototype,"loadError",void 0),u([d({clonable:!1})],t.prototype,"loadStatus",void 0),u([d({type:[Iu],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([P("esri.core.Loadable")],t),t};let JA=class extends ife(IF){};JA=u([P("esri.core.Loadable")],JA),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=ife,e.isLoadable=t}(JA||(JA={}));const um=JA;var eG;const B3e=new wi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let lh=eG=class extends Se{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new eG({categories:this.categories?ie(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o)),this.extent){const o=rx(this.extent,Ze.WGS84);_(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>B3e.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:F(F({},t),n)}}};u([d()],lh.prototype,"categories",void 0),u([d()],lh.prototype,"disableExtraQuery",void 0),u([d({type:ui})],lh.prototype,"extent",void 0),u([d()],lh.prototype,"filter",void 0),u([d()],lh.prototype,"num",void 0),u([d()],lh.prototype,"query",void 0),u([d()],lh.prototype,"sortField",void 0),u([d()],lh.prototype,"sortOrder",null),u([d()],lh.prototype,"start",void 0),lh=eG=u([P("esri.portal.PortalQueryParams")],lh);const Ng=lh;let L1=class extends Se{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],L1.prototype,"nextQueryParams",void 0),u([d()],L1.prototype,"queryParams",void 0),u([d()],L1.prototype,"results",void 0),u([d()],L1.prototype,"total",void 0),L1=u([P("esri.portal.PortalQueryResult")],L1);const G3e=L1;let tg=class extends ve{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new q("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],tg.prototype,"created",void 0),u([d()],tg.prototype,"id",void 0),u([d()],tg.prototype,"portal",void 0),u([d()],tg.prototype,"title",void 0),u([d({readOnly:!0})],tg.prototype,"url",null),u([d()],tg.prototype,"username",void 0),tg=u([P("esri.portal.PortalFolder")],tg);const j3e=tg;let Yn=class extends ve{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new q("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=ns(Ng,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new Ng,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new Ng,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(i=>{const r=i.contentCategorySetsGroupQuery;if(r){const s=new Ng;return s.disableExtraQuery=!0,s.num=1,s.query=r,this.portal.queryGroups(s,t)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const r=i.results[0],s=new Ng;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(r=>{const s=r&&r.categorySchema;return s&&s.length?s:[]}):[])}};u([d()],Yn.prototype,"access",void 0),u([d({type:Date})],Yn.prototype,"created",void 0),u([d()],Yn.prototype,"description",void 0),u([d()],Yn.prototype,"id",void 0),u([d()],Yn.prototype,"isInvitationOnly",void 0),u([d({type:Date})],Yn.prototype,"modified",void 0),u([d()],Yn.prototype,"owner",void 0),u([d()],Yn.prototype,"portal",void 0),u([d()],Yn.prototype,"snippet",void 0),u([d()],Yn.prototype,"sortField",void 0),u([d()],Yn.prototype,"sortOrder",void 0),u([d()],Yn.prototype,"tags",void 0),u([d()],Yn.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Yn.prototype,"thumbnailUrl",null),u([d()],Yn.prototype,"title",void 0),u([d({readOnly:!0})],Yn.prototype,"url",null),Yn=u([P("esri.portal.PortalGroup")],Yn);const tG=Yn;var H3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:tG}),iG;let Kr=iG=class extends ve{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal._request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let i;return i=t&&t.folders?t.folders.map(r=>{const s=j3e.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(i=>{const r=tG.fromJSON(i);return r.portal=this.portal,r}):[],t})}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),Promise.resolve().then(function(){return qve}).then(({default:r})=>{t=r;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:s})}).then(r=>{let s;return r&&r.items?(s=r.items.map(n=>{const o=t.fromJSON(n);return o.portal=this.portal,o}),Promise.all(s.map(n=>n.load())).catch(n=>n).then(()=>({items:s,nextStart:r.nextStart,total:r.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new tG({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new q("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new q("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new iG;return t.sourceJSON=e,t.read(e),t}};u([d()],Kr.prototype,"access",void 0),u([d({type:Date})],Kr.prototype,"created",void 0),u([d()],Kr.prototype,"culture",void 0),u([d()],Kr.prototype,"description",void 0),u([d()],Kr.prototype,"email",void 0),u([d()],Kr.prototype,"favGroupId",void 0),u([d()],Kr.prototype,"fullName",void 0),u([d({type:Date})],Kr.prototype,"modified",void 0),u([d()],Kr.prototype,"orgId",void 0),u([d()],Kr.prototype,"portal",void 0),u([d()],Kr.prototype,"preferredView",void 0),u([d()],Kr.prototype,"privileges",void 0),u([d()],Kr.prototype,"region",void 0),u([d()],Kr.prototype,"role",void 0),u([d()],Kr.prototype,"roleId",void 0),u([d()],Kr.prototype,"sourceJSON",void 0),u([d()],Kr.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Kr.prototype,"thumbnailUrl",null),u([d()],Kr.prototype,"units",void 0),u([d({readOnly:!0})],Kr.prototype,"userContentUrl",null),u([d({readOnly:!0})],Kr.prototype,"url",null),u([d()],Kr.prototype,"username",void 0),u([d()],Kr.prototype,"userType",void 0),Kr=iG=u([P("esri.portal.PortalUser")],Kr);const dX=Kr;var q3e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:dX}),qc;let Wz;const ZK={PortalGroup:()=>Promise.resolve().then(function(){return H3e}),PortalItem:()=>Promise.resolve().then(function(){return qve}),PortalUser:()=>Promise.resolve().then(function(){return q3e})};let Ge=qc=class extends $P(um){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=ki.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)ki.request.trustedServers.includes(t)||ki.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=dX.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(function(){return oje}).then(({default:i})=>{ci(e),Wz=i}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(i=>{if(zs){const r=zs;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==qc.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await import("./ElevationLayer.80f506f1.js")).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}fetchBasemaps(e,t){const i=new Ng;return i.query=e||(ki.apiKey&&Jpe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,t)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new Wz({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):nn(e)?Promise.reject(hi()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new Ng;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return nn(e)?Promise.reject(hi()):Promise.resolve([])}fetchRegions(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||ua();return this._request(this.restUrl+"/portals/regions",me(F({},e),{query:{culture:t}}))}fetchSettings(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||ua();return this._request(this.restUrl+"/portals/self/settings",me(F({},e),{query:{culture:t}}))}static getDefault(){return qc._default&&!qc._default.destroyed||(qc._default=new qc),qc._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new q("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new qc({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new q("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new q("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s=F({authMode:e,query:{culture:ua().toLowerCase()}},i);return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=ns(Ng,t),n=o=>this._request(this.restUrl+e,F(F({},s.toRequestOptions(this)),r)).then(a=>{const l=s.clone();return l.start=a.nextStart,new G3e({nextQueryParams:l,queryParams:s,total:a.total,results:qc._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(by(l),a)));return i&&ZK[i]?ZK[i]().then(({default:o})=>(ci(r),n(o))):n()}_signIn(){if(this.authMode===qc.AUTH_MODE_ANONYMOUS)return Promise.reject(new q("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return zs?zs.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then(r=>{const s=qc._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=Wz.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const i=F({f:"json"},t.query),{authMode:r=this.authMode===qc.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return gr(this._normalizeSSL(e),c).then(h=>h.data)}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=_(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Ge.AUTH_MODE_ANONYMOUS="anonymous",Ge.AUTH_MODE_AUTO="auto",Ge.AUTH_MODE_IMMEDIATE="immediate",u([d()],Ge.prototype,"access",void 0),u([d()],Ge.prototype,"allSSL",void 0),u([d()],Ge.prototype,"authMode",void 0),u([d()],Ge.prototype,"authorizedCrossOriginDomains",void 0),u([Ue("authorizedCrossOriginDomains")],Ge.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],Ge.prototype,"basemapGalleryGroupQuery",void 0),u([d()],Ge.prototype,"bingKey",void 0),u([d()],Ge.prototype,"canListApps",void 0),u([d()],Ge.prototype,"canListData",void 0),u([d()],Ge.prototype,"canListPreProvisionedItems",void 0),u([d()],Ge.prototype,"canProvisionDirectPurchase",void 0),u([d()],Ge.prototype,"canSearchPublic",void 0),u([d()],Ge.prototype,"canShareBingPublic",void 0),u([d()],Ge.prototype,"canSharePublic",void 0),u([d()],Ge.prototype,"canSignInArcGIS",void 0),u([d()],Ge.prototype,"canSignInIDP",void 0),u([d()],Ge.prototype,"colorSetsGroupQuery",void 0),u([d()],Ge.prototype,"commentsEnabled",void 0),u([d({type:Date})],Ge.prototype,"created",void 0),u([d()],Ge.prototype,"credential",void 0),u([d()],Ge.prototype,"culture",void 0),u([d()],Ge.prototype,"currentVersion",void 0),u([d()],Ge.prototype,"customBaseUrl",void 0),u([d()],Ge.prototype,"defaultBasemap",void 0),u([Ue("defaultBasemap")],Ge.prototype,"readDefaultBasemap",null),u([d()],Ge.prototype,"defaultDevBasemap",void 0),u([Ue("defaultDevBasemap")],Ge.prototype,"readDefaultDevBasemap",null),u([d({type:ui})],Ge.prototype,"defaultExtent",void 0),u([d()],Ge.prototype,"defaultVectorBasemap",void 0),u([Ue("defaultVectorBasemap")],Ge.prototype,"readDefaultVectorBasemap",null),u([d()],Ge.prototype,"description",void 0),u([d()],Ge.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],Ge.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],Ge.prototype,"extraQuery",null),u([d()],Ge.prototype,"featuredGroups",void 0),u([d()],Ge.prototype,"featuredItemsGroupQuery",void 0),u([d()],Ge.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],Ge.prototype,"livingAtlasGroupQuery",void 0),u([d()],Ge.prototype,"hasCategorySchema",void 0),u([d()],Ge.prototype,"helpBase",void 0),u([d()],Ge.prototype,"helperServices",void 0),u([d()],Ge.prototype,"helpMap",void 0),u([d()],Ge.prototype,"homePageFeaturedContent",void 0),u([d()],Ge.prototype,"homePageFeaturedContentCount",void 0),u([d()],Ge.prototype,"httpPort",void 0),u([d()],Ge.prototype,"httpsPort",void 0),u([d()],Ge.prototype,"id",void 0),u([d()],Ge.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],Ge.prototype,"isOrganization",null),u([d()],Ge.prototype,"isPortal",void 0),u([d()],Ge.prototype,"isReadOnly",void 0),u([d()],Ge.prototype,"layerTemplatesGroupQuery",void 0),u([d()],Ge.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],Ge.prototype,"modified",void 0),u([d()],Ge.prototype,"name",void 0),u([d()],Ge.prototype,"portalHostname",void 0),u([d()],Ge.prototype,"portalMode",void 0),u([d()],Ge.prototype,"portalProperties",void 0),u([d()],Ge.prototype,"region",void 0),u([d({readOnly:!0})],Ge.prototype,"restUrl",null),u([d()],Ge.prototype,"rotatorPanels",void 0),u([d()],Ge.prototype,"showHomePageDescription",void 0),u([d()],Ge.prototype,"sourceJSON",void 0),u([d()],Ge.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],Ge.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],Ge.prototype,"stylesGroupQuery3d",void 0),u([d()],Ge.prototype,"supportsHostedServices",void 0),u([d()],Ge.prototype,"symbolSetsGroupQuery",void 0),u([d()],Ge.prototype,"templatesGroupQuery",void 0),u([d()],Ge.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Ge.prototype,"thumbnailUrl",null),u([d()],Ge.prototype,"units",void 0),u([d()],Ge.prototype,"url",void 0),u([d()],Ge.prototype,"urlKey",void 0),u([Ue("urlKey")],Ge.prototype,"readUrlKey",null),u([d()],Ge.prototype,"user",void 0),u([Ue("user")],Ge.prototype,"readUser",null),u([d()],Ge.prototype,"useStandardizedQuery",void 0),u([d()],Ge.prototype,"useVectorBasemaps",void 0),u([d()],Ge.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ge=qc=u([P("esri.portal.Portal")],Ge);const mo=Ge;let N1=class extends Oc(ve){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return _(e)&&e.placement===this.placement&&e.style===this.style&&(M(this.color)&&M(e.color)||_(this.color)&&_(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],N1.prototype,"type",void 0),u([d({type:cPe,json:{default:"begin-end",write:!0}})],N1.prototype,"placement",void 0),u([d({type:wpe,json:{default:"arrow",write:!0}})],N1.prototype,"style",void 0),u([d({type:We,json:{type:[Sr],default:null,write:!0}})],N1.prototype,"color",void 0),N1=u([P("esri.symbols.LineStyleMarker3D")],N1);const rG=N1;var gL;let nf=gL=class extends wm{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Du(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:_(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:_(this.pattern)?this.pattern.clone():null,marker:_(this.marker)?this.marker.clone():null};return new gL(e)}static fromSimpleLineSymbol(e){var i,r,s;const t={enabled:!0,size:(i=e.width)!=null?i:Du(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new qW({style:e.style}):null,material:new Cu({color:(e.color||oO).clone()}),marker:e.marker?new rG({placement:e.marker.placement,style:e.marker.style,color:(s=(r=e.marker.color)==null?void 0:r.clone())!=null?s:null}):null};return new gL(t)}};u([d({type:Cu,json:{write:!0}})],nf.prototype,"material",void 0),u([ut({Line:"line"},{readOnly:!0})],nf.prototype,"type",void 0),u([d({type:Lpe,json:{write:!0,default:"miter"}})],nf.prototype,"join",void 0),u([d({type:JW,json:{write:!0,default:"butt"}})],nf.prototype,"cap",void 0),u([d(am)],nf.prototype,"size",void 0),u([d(Cpe)],nf.prototype,"pattern",void 0),u([d({types:{key:"type",base:rG,typeMap:{style:rG}},json:{write:!0}})],nf.prototype,"marker",void 0),nf=gL=u([P("esri.symbols.LineSymbol3DLayer")],nf);const zP=nf;var sG;const W3e=fa()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let KA=sG=class extends ve{clone(){return new sG({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:lX,write:o_}})],KA.prototype,"href",void 0),u([ut(W3e)],KA.prototype,"primitive",void 0),KA=sG=u([P("esri.symbols.support.ObjectSymbol3DLayerResource")],KA);const rfe="sphere";var nG;let xb=nG=class extends Se{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new nG({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],xb.prototype,"x",void 0),u([d({type:Number})],xb.prototype,"y",void 0),u([d({type:Number})],xb.prototype,"z",void 0),xb=nG=u([P("esri.symbols.support.Symbol3DAnchorPosition3D")],xb);var oG;let ba=oG=class extends wm{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new oG({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:Cu,json:{write:!0}})],ba.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ba.prototype,"castShadows",void 0),u([d({type:KA,json:{write:!0}})],ba.prototype,"resource",void 0),u([ut({Object:"object"},{readOnly:!0})],ba.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],ba.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],ba.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],ba.prototype,"depth",void 0),u([ut({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],ba.prototype,"anchor",void 0),u([d({type:xb,json:{type:[Number],read:{reader:e=>new xb({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ba.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],ba.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],ba.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],ba.prototype,"roll",void 0),u([d({readOnly:!0})],ba.prototype,"isPrimitive",null),ba=oG=u([P("esri.symbols.ObjectSymbol3DLayer")],ba);const pX=ba;var aG;let il=aG=class extends wm{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new aG({enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:Cu,json:{write:!0}})],il.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],il.prototype,"castShadows",void 0),u([ut({Path:"path"},{readOnly:!0})],il.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],il.prototype,"profile",void 0),u([d({type:Lpe,json:{write:!0,default:"miter"}})],il.prototype,"join",void 0),u([d({type:PPe,json:{write:!0,default:"butt"}})],il.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],il.prototype,"width",void 0),u([Ue("width",["width","size","height"])],il.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],il.prototype,"height",void 0),u([Ue("height",["height","size","width"])],il.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],il.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],il.prototype,"profileRotation",void 0),il=aG=u([P("esri.symbols.PathSymbol3DLayer")],il);const fX=il;var lG;let ES=lG=class extends ve{constructor(){super(...arguments),this.color=new We([0,0,0,1]),this.size=0}clone(){const e={color:ie(this.color),size:this.size};return new lG(e)}};u([d(xy)],ES.prototype,"color",void 0),u([d(am)],ES.prototype,"size",void 0),ES=lG=u([P("esri.symbols.support.Symbol3DHalo")],ES);let lO=class extends Oc(ve){constructor(e){super(e),this.color=null}};u([d(xy)],lO.prototype,"color",void 0),lO=u([P("esri.symbols.support.Symbol3DTextBackground")],lO);var yL;let jl=yL=class extends wm{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){_(e)&&_(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s=me(F({},r),{textSymbol3D:!0});t.font=e.write({},s),delete t.font.size}get size(){return _(this._userSize)?this._userSize:_(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,_(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new yL({enabled:this.enabled,font:this.font&&ie(this.font),halo:this.halo&&ie(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:_(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ie(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new yL({font:_(e.font)?e.font.clone():new W5,halo:X3e(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Cu({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new lO({color:e.backgroundColor.clone()}):null})}};function X3e(e,t){return e&&t>0?new ES({color:ie(e),size:t}):null}u([d({type:W5,json:{write:!0}})],jl.prototype,"font",null),u([Be("font")],jl.prototype,"writeFont",null),u([d({type:ES,json:{write:!0}})],jl.prototype,"halo",void 0),u([d(me(F({},Fpe),{json:{default:"center",write:!0}}))],jl.prototype,"horizontalAlignment",void 0),u([d(me(F({},Npe),{json:{default:1,write:!0}}))],jl.prototype,"lineHeight",void 0),u([d({type:Cu,json:{write:!0}})],jl.prototype,"material",void 0),u([d({type:lO,json:{write:!0}})],jl.prototype,"background",void 0),u([d(am)],jl.prototype,"size",null),u([d({type:String,json:{write:!0}})],jl.prototype,"text",void 0),u([ut({Text:"text"},{readOnly:!0})],jl.prototype,"type",void 0),u([d(me(F({},kpe),{json:{default:"baseline",write:!0}}))],jl.prototype,"verticalAlignment",void 0),jl=yL=u([P("esri.symbols.TextSymbol3DLayer")],jl);const cx=jl;var cG;let E0=cG=class extends wm{constructor(e){super(e),this.color=uG.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new cG({color:ie(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:We,nonNullable:!0,json:{type:[Sr],write:(e,t,i)=>t[i]=e.toArray(We.AlphaMode.UNLESS_OPAQUE),default:()=>uG.clone(),defaultEquals:e=>e.toCss(!0)===uG.toCss(!0)}})],E0.prototype,"color",void 0),u([ut({Water:"water"},{readOnly:!0})],E0.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],E0.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],E0.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],E0.prototype,"waveStrength",void 0),E0=cG=u([P("esri.symbols.WaterSymbol3DLayer")],E0);const uG=new We([0,119,190]),sfe=E0;var hG;let F1=hG=class extends Se{constructor(){super(...arguments),this.portal=null}clone(){return new hG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],F1.prototype,"name",void 0),u([d({type:String})],F1.prototype,"styleUrl",void 0),u([d({type:String})],F1.prototype,"styleName",void 0),u([d({type:mo})],F1.prototype,"portal",void 0),F1=hG=u([P("esri.symbols.support.StyleOrigin")],F1);const dG=F1;var pG;let cO=pG=class extends Se{clone(){return new pG({url:this.url})}};u([d({type:String})],cO.prototype,"url",void 0),cO=pG=u([P("esri.symbols.support.Thumbnail")],cO);const nfe={icon:Cv,object:pX,line:zP,path:fX,fill:q5,extrude:bpe,text:cx,water:sfe},Y3e=it.ofType({base:wm,key:"type",typeMap:nfe,errorContext:"symbol-layer"}),Z3e=ge.getLogger("esri.symbols.Symbol3D");let of=class extends Pc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||it;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.initialized&&Z3e.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){ly(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const r=XE(e.styleUrl,i);return new dG({styleUrl:r,name:e.name})}if(e.styleName&&e.name)return new dG({portal:i&&i.portal||mo.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Iu("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let s=Cw(e.styleUrl,r);Au(s)&&(s=jh(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!Gpe(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new Iu("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof wm||e&&nfe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],of.prototype,"color",null),u([d({type:Y3e,nonNullable:!0,json:{write:!0}}),Rt(cX)],of.prototype,"symbolLayers",null),u([d({type:dG})],of.prototype,"styleOrigin",void 0),u([Ue("styleOrigin")],of.prototype,"readStyleOrigin",null),u([Be("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],of.prototype,"writeStyleOrigin",null),u([d({type:cO,json:{read:!1}})],of.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],of.prototype,"type",void 0),of=u([P("esri.symbols.Symbol3D")],of);const YE=of;let eM=class extends ve{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],eM.prototype,"type",void 0),u([d({readOnly:!0})],eM.prototype,"visible",void 0),eM=u([P("esri.symbols.callouts.Callout3D")],eM);const ofe=eM;var fG;let vL=fG=class extends ve{constructor(){super(...arguments),this.color=new We("white")}clone(){return new fG({color:ie(this.color)})}};u([d(xy)],vL.prototype,"color",void 0),vL=fG=u([P("esri.symbols.callouts.LineCallout3DBorder")],vL);const afe=vL;Object.freeze(Object.defineProperty({__proto__:null,default:afe},Symbol.toStringTag,{value:"Module"}));var mG;let C0=mG=class extends ofe{constructor(e){super(e),this.type="line",this.color=new We([0,0,0,1]),this.size=Du(1),this.border=null}get visible(){return this.size>0&&_(this.color)&&this.color.a>0}clone(){return new mG({color:ie(this.color),size:this.size,border:ie(this.border)})}};u([ut({line:"line"},{readOnly:!0})],C0.prototype,"type",void 0),u([d(xy)],C0.prototype,"color",void 0),u([d(am)],C0.prototype,"size",void 0),u([d({type:afe,json:{write:!0}})],C0.prototype,"border",void 0),u([d({readOnly:!0})],C0.prototype,"visible",null),C0=mG=u([P("esri.symbols.callouts.LineCallout3D")],C0);const Q3e=C0;function mX(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function lfe(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!mX(e)}function gX(e){return e.type==="point-3d"||e.type==="label-3d"}function cfe(e){return e.horizontalAlignment==="center"}const ufe={types:{key:"type",base:ofe,typeMap:{line:Q3e}},json:{write:!0}};var gG;let Tb=gG=class extends ve{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new gG({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(am)],Tb.prototype,"screenLength",void 0),u([d({type:Number,json:{write:!0,default:0}})],Tb.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],Tb.prototype,"maxWorldLength",void 0),Tb=gG=u([P("esri.symbols.support.Symbol3DVerticalOffset")],Tb);var _L;const hfe=it.ofType({base:null,key:"type",typeMap:{text:cx}});let A0=_L=class extends YE{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new hfe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return lfe(this)}hasVisibleVerticalOffset(){return mX(this)}clone(){return new _L({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail),callout:ie(this.callout),verticalOffset:ie(this.verticalOffset)})}static fromTextSymbol(e){return new _L({symbolLayers:[cx.fromTextSymbol(e)]})}};u([d({type:Tb,json:{write:!0}})],A0.prototype,"verticalOffset",void 0),u([d(ufe)],A0.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],A0.prototype,"styleOrigin",void 0),u([d({type:hfe})],A0.prototype,"symbolLayers",void 0),u([ut({LabelSymbol3D:"label-3d"},{readOnly:!0})],A0.prototype,"type",void 0),A0=_L=u([P("esri.symbols.LabelSymbol3D")],A0);const Z5=A0;var bL;const dfe=it.ofType({base:null,key:"type",typeMap:{line:zP,path:fX}}),J3e=it.ofType({base:null,key:"type",typeMap:{line:zP,path:fX}});let tM=bL=class extends YE{constructor(e){super(e),this.symbolLayers=new dfe,this.type="line-3d"}clone(){return new bL({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleLineSymbol(e){return new bL({symbolLayers:[zP.fromSimpleLineSymbol(e)]})}};u([d({type:dfe,json:{type:J3e}})],tM.prototype,"symbolLayers",void 0),u([ut({LineSymbol3D:"line-3d"},{readOnly:!0})],tM.prototype,"type",void 0),tM=bL=u([P("esri.symbols.LineSymbol3D")],tM);const Q5=tM;let M0=class extends Pc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],M0.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],M0.prototype,"type",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],M0.prototype,"xoffset",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],M0.prototype,"yoffset",void 0),u([d({type:Number,cast:e=>e==="auto"?e:rr(e),json:{write:!0}})],M0.prototype,"size",void 0),M0=u([P("esri.symbols.MarkerSymbol")],M0);const pfe=M0;var yG;const ffe=it.ofType({base:null,key:"type",typeMap:{fill:q5}});let iM=yG=class extends YE{constructor(e){super(e),this.symbolLayers=new ffe,this.type="mesh-3d"}clone(){return new yG({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}};u([d({type:ffe})],iM.prototype,"symbolLayers",void 0),u([ut({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],iM.prototype,"type",void 0),iM=yG=u([P("esri.symbols.MeshSymbol3D")],iM);const yX=iM;function K3e(e,t,i){return t.imageData?qpe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):mfe(t.url,i)}function mfe(e,t){return tIe(t)&&!Au(e)&&t.layer.parsedUrl?Nu(t.layer.parsedUrl.path,"images",e):XE(e,t)}function eIe(e,t,i,r){if(xm(e)){const s=Y5(e);t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&o_(i.url,t,"url",r)}else o_(e,t,"url",r)}const gfe={json:{read:{source:["imageData","url"],reader:K3e},write:{writer(e,t,i,r){eIe(e,t,this.source,r)}}}},yfe={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=mfe(t.url,i)),r}}}};function tIe(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var vG;let ch=vG=class extends xpe{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=rr(i)),r!=null&&(s.height=rr(r)),s}clone(){const e=new vG({color:ie(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",ie(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([ut({esriPFS:"picture-fill"},{readOnly:!0})],ch.prototype,"type",void 0),u([d(gfe)],ch.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],ch.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],ch.prototype,"yscale",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],ch.prototype,"width",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],ch.prototype,"height",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],ch.prototype,"xoffset",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],ch.prototype,"yoffset",void 0),u([d(yfe)],ch.prototype,"source",void 0),ch=vG=u([P("esri.symbols.PictureFillSymbol")],ch);const vfe=ch;var _G;let Td=_G=class extends pfe{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=rr(t)),i!=null&&(r.height=rr(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new _G({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",ie(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],Td.prototype,"color",void 0),u([ut({esriPMS:"picture-marker"},{readOnly:!0})],Td.prototype,"type",void 0),u([d(gfe)],Td.prototype,"url",void 0),u([d(yfe)],Td.prototype,"source",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],Td.prototype,"height",void 0),u([Ue("height",["height","size"])],Td.prototype,"readHeight",null),u([d({type:Number,cast:rr,json:{write:!0}})],Td.prototype,"width",void 0),u([d({json:{write:!1}})],Td.prototype,"size",void 0),Td=_G=u([P("esri.symbols.PictureMarkerSymbol")],Td);const J5=Td;var O0;const _fe=it.ofType({base:null,key:"type",typeMap:{icon:Cv,object:pX,text:cx}});let k1=O0=class extends YE{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new _fe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return lfe(this)}hasVisibleVerticalOffset(){return mX(this)}clone(){return new O0({verticalOffset:ie(this.verticalOffset),callout:ie(this.callout),styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new O0({symbolLayers:[Cv.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new O0({symbolLayers:[Cv.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var i,r;return((r=(i=e.data)==null?void 0:i.symbol)==null?void 0:r.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new O0({symbolLayers:[Cv.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new O0({symbolLayers:[Cv.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new O0({symbolLayers:[cx.fromTextSymbol(e)]})}};u([d({type:Tb,json:{write:!0}})],k1.prototype,"verticalOffset",void 0),u([d(ufe)],k1.prototype,"callout",void 0),u([d({type:_fe,json:{origins:{"web-scene":{write:!0}}}})],k1.prototype,"symbolLayers",void 0),u([ut({PointSymbol3D:"point-3d"},{readOnly:!0})],k1.prototype,"type",void 0),k1=O0=u([P("esri.symbols.PointSymbol3D")],k1);const Av=k1;var rM;const bfe=it.ofType({base:null,key:"type",typeMap:{extrude:bpe,fill:q5,icon:Cv,line:zP,object:pX,text:cx,water:sfe}});let sM=rM=class extends YE{constructor(e){super(e),this.symbolLayers=new bfe,this.type="polygon-3d"}clone(){return new rM({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromJSON(e){const t=new rM;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:_(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new rM({symbolLayers:[q5.fromSimpleFillSymbol(e)]})}};u([d({type:bfe,json:{write:!0}})],sM.prototype,"symbolLayers",void 0),u([ut({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],sM.prototype,"type",void 0),sM=rM=u([P("esri.symbols.PolygonSymbol3D")],sM);const VP=sM;var bG;const Xz=new wi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let U1=bG=class extends xpe{constructor(...e){super(...e),this.color=new We([0,0,0,.25]),this.outline=new od,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new bG({color:ie(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],U1.prototype,"color",void 0),u([d()],U1.prototype,"outline",void 0),u([ut({esriSFS:"simple-fill"},{readOnly:!0})],U1.prototype,"type",void 0),u([d({type:Xz.apiValues,json:{read:Xz.read,write:Xz.write}})],U1.prototype,"style",void 0),U1=bG=u([P("esri.symbols.SimpleFillSymbol")],U1);const A_=U1;var wG;const Yz=new wi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let af=wG=class extends pfe{constructor(...e){super(...e),this.color=new We([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new od}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=rr(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new wG({angle:this.angle,color:ie(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([d()],af.prototype,"color",void 0),u([Be("color")],af.prototype,"writeColor",null),u([ut({esriSMS:"simple-marker"},{readOnly:!0})],af.prototype,"type",void 0),u([d()],af.prototype,"size",void 0),u([d({type:Yz.apiValues,json:{read:Yz.read,write:Yz.write}})],af.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],af.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":od}},json:{default:null,write:!0}})],af.prototype,"outline",void 0),af=wG=u([P("esri.symbols.SimpleMarkerSymbol")],af);const M_=af;var xG;let us=xG=class extends Pc{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new W5,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return rr(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new xG({angle:this.angle,backgroundColor:ie(this.backgroundColor),borderLineColor:ie(this.borderLineColor),borderLineSize:this.borderLineSize,color:ie(this.color),font:this.font&&this.font.clone(),haloColor:ie(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:We,json:{write:!0}})],us.prototype,"backgroundColor",void 0),u([d({type:We,json:{write:!0}})],us.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0}})],us.prototype,"borderLineSize",void 0),u([d({type:W5,json:{write:!0}})],us.prototype,"font",void 0),u([d(me(F({},Fpe),{json:{write:!0}}))],us.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],us.prototype,"kerning",void 0),u([d({type:We,json:{write:!0}})],us.prototype,"haloColor",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],us.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],us.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],us.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],us.prototype,"text",void 0),u([ut({esriTS:"text"},{readOnly:!0})],us.prototype,"type",void 0),u([d(me(F({},kpe),{json:{write:!0}}))],us.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],us.prototype,"xoffset",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],us.prototype,"yoffset",void 0),u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],us.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],us.prototype,"width",void 0),u([d({type:Number})],us.prototype,"lineWidth",void 0),u([Be("lineWidth")],us.prototype,"writeLineWidth",null),u([Rt("lineWidth")],us.prototype,"castLineWidth",null),u([d(Npe)],us.prototype,"lineHeight",void 0),u([Be("lineHeight")],us.prototype,"writeLineHeight",null),us=xG=u([P("esri.symbols.TextSymbol")],us);const ZE=us;var TG;const iIe=ge.getLogger("esri.symbols.WebStyleSymbol");let Sd=TG=class extends Pc{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const e=_(this.portal)?this.portal:mo.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new TG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=_(t)?t.cache:null,r=i?this.fetchCacheKey:null;if(_(i)){const a=i.get(r);if(a)return a.clone()}const s=await rIe();ci(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{iIe.error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(_(i)&&i.set(r,o.clone()),o):null}};function rIe(){return import("./webStyleSymbolUtils.aa523071.js")}u([d({json:{write:!1}})],Sd.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Sd.prototype,"styleName",void 0),u([d({type:mo,json:{write:!1}})],Sd.prototype,"portal",void 0),u([d({type:String,json:{read:lX,write:o_}})],Sd.prototype,"styleUrl",void 0),u([d({type:cO,json:{read:!1}})],Sd.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],Sd.prototype,"name",void 0),u([ut({styleSymbolReference:"web-style"},{readOnly:!0})],Sd.prototype,"type",void 0),u([d()],Sd.prototype,"fetchCacheKey",null),Sd=TG=u([P("esri.symbols.WebStyleSymbol")],Sd);const ux=Sd;function K5(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function U2(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const nw={base:Pc,key:"type",typeMap:{"simple-fill":A_,"picture-fill":vfe,"picture-marker":J5,"simple-line":od,"simple-marker":M_,text:ZE,"label-3d":Z5,"line-3d":Q5,"mesh-3d":yX,"point-3d":Av,"polygon-3d":VP,"web-style":ux,cim:qE},errorContext:"symbol"},sIe={base:Pc,key:"type",typeMap:{"picture-marker":J5,"simple-marker":M_,text:ZE,"web-style":ux,cim:qE},errorContext:"symbol"},nIe=GE({types:nw}),wfe={base:Pc,key:"type",typeMap:{"simple-fill":A_,"picture-fill":vfe,"picture-marker":J5,"simple-line":od,"simple-marker":M_,text:ZE,"line-3d":Q5,"mesh-3d":yX,"point-3d":Av,"polygon-3d":VP,"web-style":ux,cim:qE},errorContext:"symbol"},oIe={base:Pc,key:"type",typeMap:{text:ZE,"label-3d":Z5},errorContext:"symbol"},QK={base:Pc,key:"type",typeMap:{"line-3d":Q5,"mesh-3d":yX,"point-3d":Av,"polygon-3d":VP,"web-style":ux,cim:qE},errorContext:"symbol"},aIe={base:Pc,key:"type",typeMap:{"label-3d":Z5},errorContext:"symbol"},xfe=wp(nw);function lIe(e){if(!e)return null;const t={};for(const i in e){const r=sm(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function cIe(e){if(!_(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let Hl=class extends Oc(ve){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Tl(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&_(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:cIe(this.aggregateGeometries),geometry:_(this.geometry)?this.geometry.toJSON():null,symbol:_(this.symbol)?this.symbol.toJSON():null,attributes:F({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){_(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:lIe}})],Hl.prototype,"aggregateGeometries",null),u([d({value:null})],Hl.prototype,"attributes",null),u([d({value:null,types:nx,json:{read:sm}})],Hl.prototype,"geometry",null),u([d({type:Boolean})],Hl.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],Hl.prototype,"layer",void 0),u([d({type:NP})],Hl.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],Hl.prototype,"sourceLayer",void 0),u([d({value:null,types:nw})],Hl.prototype,"symbol",null),u([d({type:Boolean,value:!0})],Hl.prototype,"visible",null),Hl=u([P("esri.Graphic")],Hl),function(e){e.generateUID=Tl}(Hl||(Hl={}));const Ga=Hl;var SG;let R0=SG=class extends ve{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new SG({rotation:this.rotation,scale:this.scale,targetGeometry:_(this.targetGeometry)?this.targetGeometry.clone():null,camera:_(this.camera)?this.camera.clone():null})}};function Zz(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Zz}}}}})],R0.prototype,"rotation",void 0),u([Rt("rotation")],R0.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Zz}}}}})],R0.prototype,"scale",void 0),u([d({types:nx,json:{read:sm,write:!0,origins:{"web-scene":{read:sm,write:{overridePolicy:Zz}}}}})],R0.prototype,"targetGeometry",void 0),u([d({type:Cc,json:{write:!0}})],R0.prototype,"camera",void 0),R0=SG=u([P("esri.Viewpoint")],R0);const Rl=R0;function BP(e){return typeof e=="string"?document.getElementById(e):e}function Tfe(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function JK(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function KK(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}function uIe(e){e.parentNode&&e.parentNode.removeChild(e)}function se(e,t,i={}){return vX(e,t,i,Sfe)}function vo(e,t,i={}){return vX(e,t,i,Efe)}function vX(e,t,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(Vs(s),t(o,a))}:(o,a)=>{r(o)&&t(o,a)};if(s=BAe(e,n,i.sync,i.equals),i.initial){const o=e();n(o,o)}return s}function En(e,t,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&Vs(o),i(h)}const c=se(e,(h,p)=>{var f;a(),R5(h)&&(s=h,n=BE(h,t,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=Yh(()=>{c.remove(),a()}),o}function hR(e,t){return hIe(e,Efe,t)}function hIe(e,t,i){if(nn(i))return Promise.reject(hi());const r=e();if(t==null?void 0:t(r))return Promise.resolve(r);let s=null;function n(){s=Vs(s)}return new Promise((o,a)=>{s=x2([ha(i,()=>{n(),a(hi())}),vX(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:Sfe)])})}function Sfe(e){return!0}function Efe(e){return!!e}function dIe(e,t,i={}){let r=!1;const s=se(e,(n,o)=>{r||t(n,o)},i);return{remove(){s.remove()},pause(){r=!0},resume(){r=!1}}}const Ki={sync:!0},At={initial:!0},wr={sync:!0,initial:!0};class EG{constructor(t=i=>i.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(i=>{t(i)||this._items.delete(i)}),this}}var Sl;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(Sl||(Sl={}));let pIe=0;function Cfe(){return pIe++}function fIe(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function $F(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function Afe(e,t,i,r){if(t.type===Sl.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==Sl.INVOKE&&t.type!==Sl.RESPONSE)return void e.postMessage(t);let s;fIe(i)?(s=eee(i.transferList),t.data=i.result):(s=eee(r),t.data=i),s?e.postMessage(t,s):e.postMessage(t)}function dR(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function eee(e){if(!e||!e.length)return null;if(he("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!mIe(i));return t.length?t:null}function mIe(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const gIe={statsWorker:()=>import("./statsWorker.2ca874e9.js"),geometryEngineWorker:()=>import("./geometryEngineWorker.6b706bcf.js"),CSVSourceWorker:()=>import("./CSVSourceWorker.8397b775.js"),EdgeProcessingWorker:()=>Promise.resolve().then(function(){return Igt}),ElevationSamplerWorker:()=>import("./ElevationSamplerWorker.b09cca9a.js"),FeatureServiceSnappingSourceWorker:()=>import("./FeatureServiceSnappingSourceWorker.a081af6d.js"),GeoJSONSourceWorker:()=>import("./GeoJSONSourceWorker.8894f29f.js"),LercWorker:()=>import("./LercWorker.f1f3caab.js"),MemorySourceWorker:()=>import("./MemorySourceWorker.895cf970.js"),PBFDecoderWorker:()=>import("./PBFDecoderWorker.2e36136c.js"),Pipeline:()=>import("./Pipeline.04c3697a.js").then(function(e){return e.P}),PointCloudWorker:()=>import("./PointCloudWorker.b43a56ed.js"),RasterWorker:()=>import("./RasterWorker.98a451a0.js"),SceneLayerSnappingSourceWorker:()=>import("./SceneLayerSnappingSourceWorker.8316d968.js"),SceneLayerWorker:()=>import("./SceneLayerWorker.e9f4ce79.js").then(function(e){return e.S}),WFSSourceWorker:()=>import("./WFSSourceWorker.4a0bec8b.js"),WorkerTileHandler:()=>import("./WorkerTileHandler.a56df9d9.js")},{CLOSE:tee,ABORT:iee,INVOKE:ree,RESPONSE:EC,OPEN_PORT:see,ON:yIe}=Sl,vIe=2;class _Ie{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===Sl.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class hc{constructor(t,i,r){this._port=t,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new _Ie(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new hc(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),hc.clients.set(s,r),i.port2}static loadWorker(t){const i=gIe[t];return i?i():Promise.resolve(null)}close(){this._post({type:tee}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new q("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const o=Cfe();return new Promise((a,l)=>{if(nn(s))return this._processWork(),void l(hi());const c=ha(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Vs(p.abortHandle),this._post({type:iee,jobId:o}),l(hi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:ree,jobId:o,methodName:t,abortable:s!=null},i,n)})}on(t,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:Sl.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:Sl.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:see,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=vIe)return;const t=this._getNextJob();if(!t)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=t;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{Vs(t.abortHandle),t.reject(hi(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){_(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=dR(t);if(i)switch(i.type){case EC:this._onResponseMessage(i);break;case ree:this._invokeQueue.push(i);break;case iee:this._onAbortMessage(i);break;case tee:this._onCloseMessage();break;case see:this._onOpenPortMessage(i);break;case yIe:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&hc.clients.get(this)===t&&t.destroy(),hc.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:EC,jobId:r,error:$F(p)})}Bu(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:EC,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),Qr(p)||this._post({type:EC,jobId:r,error:$F(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:EC,jobId:r},l)}_onOpenPortMessage(t){new hc(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,n=>{i.postMessage(n)}),s=BE(t.port,"message",n=>{dR(n).type===Sl.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);this._processWork(),n.delete(i),Vs(o.abortHandle),r?o.reject(q.fromJSON(JSON.parse(r))):o.resolve(s)}_post(t,i,r){return Afe(this._port,t,i,r)}}hc.kernelInfo={revision:Qpe,version:uX,buildDate:Zpe},hc.clients=new Map;const bIe=ge.getLogger("esri.core.workers.Connection");class wIe{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new EG}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,i){return new Promise((r,s)=>{let n=!0;const o=a=>{ci(i.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];Bu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new hc(c,i,()=>this._ongoingJobsQueue.pop()),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new hc(l,i,()=>this._ongoingJobsQueue.pop()),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a.invoke(t,i,r))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(hi(`Worker closing, aborting job calling '${t.methodName}'`));for(const i of this._clientPromises)i.then(r=>r.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,i,r){let s=null;Array.isArray(r)?(bIe.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=r_();this._ongoingJobsQueue.push({methodName:t,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l.jobAdded())}return n.promise}on(t,i){return Promise.all(this._clientPromises).then(()=>x2(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{i[s]=n.openPort(),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}}const xIe=ge.getLogger("esri.assets");function TIe(e,t){return gr(Li(e),t)}function Li(e){if(!ki.assetsPath)throw xIe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new q("assets:path-not-set","config.assetsPath is not set");return Nu(ki.assetsPath,e)}const Mfe=ge.getLogger("esri.intl");function Af(e,t,i={}){const{format:r={}}=i;return rm(e,s=>SIe(s,t,r))}function SIe(e,t,i){let r,s;const n=e.indexOf(":");if(n===-1?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const o=VE(r,t);if(o==null)return"";const a=i[s]||i[r];return a?EIe(o,a):s?CIe(o,s):_X(o)}function EIe(e,t){switch(t.type){case"date":return Ls(e,t.intlOptions);case"number":return om(e,t.intlOptions);default:return Mfe.warn("missing format descriptor for key {key}"),_X(e)}}function CIe(e,t){switch(t.toLowerCase()){case"dateformat":return Ls(e);case"numberformat":return om(e);default:return Mfe.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Ls(e):/^numberformat/i.test(t)?om(e):_X(e)}}function _X(e){switch(typeof e){case"string":return e;case"number":return om(e);case"boolean":return""+e;default:return e instanceof Date?Ls(e):""}}const nee=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,AIe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function oee(e){var t;return(t=AIe[e])!=null?t:!1}const nM=[],e2=new Map;function aee(e){for(const t of e2.keys())Rfe(e.pattern,t)&&e2.delete(t)}function MIe(e){return nM.includes(e)||(aee(e),nM.unshift(e)),{remove(){const t=nM.indexOf(e);t>-1&&(nM.splice(t,1),aee(e))}}}async function Ofe(e){const t=ua();e2.has(e)||e2.set(e,RIe(e,t));const i=e2.get(e);return await PIe.add(i),i}function OIe(e){if(!nee.test(e))return null;const[,t,i]=nee.exec(e),r=t+(i?"-"+i.toUpperCase():"");return oee(r)?r:oee(t)?t:null}async function RIe(e,t){const i=[];for(const r of nM)if(Rfe(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new q("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new q("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function Rfe(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}zW(()=>{e2.clear()});const PIe=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=r_())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function IIe(e,t,i,r){const s=t.exec(i);if(!s)throw new q("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=OIe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await lee(e(c))}catch(p){if(c===l)throw new q("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await lee(e(l))}catch(f){throw new q("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function lee(e){if(_(cee.fetchBundleAsset))return cee.fetchBundleAsset(e);const t=await gr(e,{responseType:"text"});return JSON.parse(t.data)}class $Ie{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return IIe(this.getAssetUrl,this.matcher,t,i)}}function DIe(e){return new $Ie(e)}const cee={};MIe(DIe({pattern:"esri/",location:Li}));const uee={};function LIe(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}function NIe(e){var i;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:F({},e.has),map:F({},e.map),packages:e.packages&&e.packages.concat()||[],paths:F({},e.paths)};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=uee.baseUrl),(i=uee.packages)==null||i.forEach(r=>{LIe(t.packages,r)}),t}class FIe{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}}class wL{constructor(){this._dispatcher=new FIe,this._workerPostMessage({type:Sl.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){T2(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){T2(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=dR(t);if(i&&i.type===Sl.OPEN){const{modulePath:r,jobId:s}=i;let n=await hc.loadWorker(r);n||(n=await import(r));const o=hc.connect(n);this._workerPostMessage({type:Sl.OPENED,jobId:s,data:o})}}}const CG=ge.getLogger("esri.core.workers"),{HANDSHAKE:kIe}=Sl,UIe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let aI,lI;const hee="Failed to create Worker. Fallback to execute module in main thread";async function zIe(){if(!he("esri-workers")||(he("mozilla"),0))return dee(new wL);if(!aI&&!lI)try{const t=UIe.replace('"{CONFIGURATION}"',`'${VIe()}'`);aI=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){lI=t||{}}let e;if(aI)try{e=new Worker(aI,{name:"esri-worker-"+BIe++})}catch{CG.warn(hee,lI),e=new wL}else CG.warn(hee,lI),e=new wL;return dee(e)}async function dee(e){return new Promise(t=>{function i(s){const n=dR(s);n&&n.type===kIe&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),CG.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new wL).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function VIe(){let e;if(ki.default!=null){const s=F({},ki);delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(ki));e.assetsPath=zh(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=ua(),e.has={"esri-csp-restrictions":he("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":he("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":he("esri-2d-query-centroid-enabled"),"featurelayer-pbf":he("featurelayer-pbf"),"featurelayer-simplify-thresholds":he("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":he("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":he("featurelayer-simplify-mobile-factor"),"esri-atomics":he("esri-atomics"),"esri-shared-array-buffer":he("esri-shared-array-buffer"),"esri-tiles-debug":he("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":he("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":he("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=zh(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=zh(e.workers.workerPath):e.workers.workerPath=zh(Li("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=ki.workers.loaderConfig,i=NIe({baseUrl:t==null?void 0:t.baseUrl,locale:ua(),has:F({"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1},t==null?void 0:t.has),map:F({},t==null?void 0:t.map),paths:F({},t==null?void 0:t.paths),packages:(t==null?void 0:t.packages)||[]}),r={version:uX,buildDate:Zpe,revision:Qpe};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}let BIe=0;const GIe=ge.getLogger("esri.core.workers"),{ABORT:pee,INVOKE:jIe,OPEN:HIe,OPENED:qIe,RESPONSE:CC}=Sl;class bX{constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),GIe.error(r)})}static async create(t){const i=await zIe();return new bX(i,t)}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=Cfe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:I5(r,()=>{this._outJobs.delete(s),this._post({type:pee,jobId:s})})};this._outJobs.set(s,a),this._post({type:HIe,jobId:s,modulePath:t})})}_onMessage(t){const i=dR(t);if(i)switch(i.type){case qIe:this._onOpenedMessage(i);break;case CC:this._onResponseMessage(i);break;case pee:this._onAbortMessage(i);break;case jIe:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=w3e[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:CC,jobId:r,error:$F(h)})}Bu(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:CC,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),Qr(h)||this._post({type:CC,jobId:r,error:$F(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:CC,jobId:r},c)}_onOpenedMessage(t){const{jobId:i,data:r}=t,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Vs(s.abortHandle),s.resolve(r))}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Vs(n.abortHandle),r?n.reject(q.fromJSON(JSON.parse(r))):n.resolve(s))}_post(t,i,r){return Afe(this.worker,t,i,r)}}let kb=he("esri-workers-debug")?1:he("host-browser")?navigator.hardwareConcurrency-1:0;kb||(kb=he("safari")&&he("mac")||he("trident")?7:2);let fee=0;const xL=[];function WIe(){Ife()}async function cI(e,t){const i=new wIe;return await i.open(e,t),i}async function Pfe(e,t={}){if(typeof e!="string")throw new q("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(he("host-webworker")&&!he("esri-workers")&&(i="local"),i==="local"){let r=await hc.loadWorker(e);r||(r=await import(e)),ci(t.signal);const s=t.client||r;return cI([hc.connect(r)],me(F({},t),{client:s}))}if(await Ife(),ci(t.signal),i==="dedicated"){const r=fee++%kb;return cI([await xL[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,kb);if(r<kb){const s=new Array(r);for(let n=0;n<r;++n){const o=fee++%kb;s[n]=xL[o].open(e,t)}return cI(s,t)}}return cI(xL.map(r=>r.open(e,t)),t)}let uI=null;async function Ife(){if(uI)return uI;new AbortController;const e=[];for(let t=0;t<kb;t++){const i=bX.create(t).then(r=>(xL[t]=r,r));e.push(i)}return uI=Promise.all(e),uI}let TL=class extends Se{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!it.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||it.isCollection(e)?e.forEach(r=>this._isHandle(r)&&i.push(r)):i.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||it.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let i=0;i<t.length;i++)t[i].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};u([d({readOnly:!0})],TL.prototype,"size",null),TL=u([P("esri.core.Handles")],TL);const jt=TL;let Zf=class extends Se{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new jt,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,se)}addWhen(e,t,i={}){return this._installWatch(e,t,i,vo)}addOnCollectionChange(e,t,{initial:i=!1,final:r=!1}={}){const s=++this.handleId;return this.handles.add([En(e,"after-changes",this._createSyncUpdatingCallback(),Ki),En(e,"change",t,{onListenerAdd:i?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:r?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this.handles.remove(s)}}addPromise(e){if(M(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(hI)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=se(e,i,{sync:!0,equals:()=>!1});return this.handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this.handles.remove(hI),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(ix(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(hI))}),hI)}}};u([d({readOnly:!0})],Zf.prototype,"updating",void 0),Zf=u([P("esri.core.support.WatchUpdatingTracking")],Zf);const hI=-42;var mee;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(mee||(mee={}));const hx=e=>{let t=class extends e{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new jt}get updatingHandles(){return this._get("updatingHandles")||new Zf}};return u([d({readOnly:!0})],t.prototype,"handles",null),u([d({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([P("esri.core.HandleOwner")],t),t};let Aw=class extends hx(Se){};Aw=u([P("esri.core.HandleOwner")],Aw);ge.getLogger("esri.core.support.OwningCollection");let uO=class extends hx(it){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{M(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(it.ofType(this.itemType.Type))(e):new it(e)}};function AG(e,t){return{type:e,cast:cX,set(i){const r=ly(i,this._get(t),e);r.owner=this,this._set(t,r)}}}u([d()],uO.prototype,"owner",null),uO=u([P("esri.core.support.OwningCollection")],uO);function wX(e){return new Ze({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const $fe=wX(Ri),DF=wX(Yf),LF=wX(oy),XIe=new Ze({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Ri.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function hm(e){return e&&(_m(e)||e===DF)?DF:e&&(bm(e)||e===LF)?LF:$fe}function bi(e){return e&&(_m(e)||e===DF)?Yf:e&&(bm(e)||e===LF)?oy:Ri}function wxt(e){return EW(e)?Yf:CW(e)?oy:Ri}const Dfe=39.37,YIe=Ri.radius*Math.PI/200,Lfe=/UNIT\[([^\]]+)\]\]$/i,ow=N,Nfe=/UNIT\[([^\]]+)\]/i,ZIe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),QIe=fa()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),$p=e=>e*e,zy=e=>e*e*e,pR={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:$p(.001)},"square-centimeters":{inBaseUnits:$p(.01)},"square-decimeters":{inBaseUnits:$p(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:$p(1e3)},"square-inches":{inBaseUnits:$p(.0254)},"square-feet":{inBaseUnits:$p(.3048)},"square-yards":{inBaseUnits:$p(.9144)},"square-miles":{inBaseUnits:$p(1609.344)},"square-us-feet":{inBaseUnits:$p(1200/3937)},acres:{inBaseUnits:.0015625*$p(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*zy(.001)},"cubic-centimeters":{inBaseUnits:1e3*zy(.01)},"cubic-decimeters":{inBaseUnits:1e3*zy(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*zy(1e3)},"cubic-inches":{inBaseUnits:1e3*zy(.0254)},"cubic-feet":{inBaseUnits:1e3*zy(.3048)},"cubic-yards":{inBaseUnits:1e3*zy(.9144)},"cubic-miles":{inBaseUnits:1e3*zy(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},JIe=(()=>{const e={};for(const t in pR)for(const i in pR[t].units)e[i]=t;return e})();function KIe(e,t,i){return e*pR[i].units[t].inBaseUnits}function e$e(e,t,i){return e/pR[i].units[t].inBaseUnits}const t$e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function MG(e){const t=JIe[e];if(!t)throw new Error("unknown type");return t}function gee(e,t=null){return t=t||MG(e),pR[t].baseUnit===e}function sn(e,t,i){if(t===i)return e;const r=MG(t);if(r!==MG(i))throw new Error("incompatible units");const s=gee(t,r)?e:KIe(e,t,r);return gee(i,r)?s:e$e(s,i,r)}function i$e(e,t){const i=sn(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function r$e(e,t){const i=sn(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function s$e(e,t){const i=sn(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function n$e(e,t){const i=sn(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function xxt(e,t){const i=sn(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function Txt(e,t){const i=sn(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function o$e(e,t,i){return sn(e,t,"meters")/(i*Math.PI/180)}function Ffe(e){return QIe.fromJSON(e.toLowerCase())||null}function z2(e){if(e&&typeof e=="object"&&!O2(e))return 1;const t=Ic(e);return t>1e5?1:t}function a$e(e){return Ic(e)>=(e instanceof Ze?bi(e).metersPerDegree:1e5)?"meters":xX(e)}function Ic(e,t=Ri.metersPerDegree){return ft(l$e(e,!0),t)}function l$e(e,t=!1){let i,r,s=null;if(e!=null&&(typeof e=="object"?(i=e.wkid,r=e.wkt):typeof e=="number"?i=e:typeof e=="string"&&(r=e)),i){if(EW(i))return Yf.metersPerDegree;if(CW(i))return oy.metersPerDegree;s=ow.values[ow[i]],!s&&t&&ZIe.has(i)&&(s=YIe)}else r&&(zfe(r)?s=yee(Lfe.exec(r),s):Ufe(r)&&(s=yee(Nfe.exec(r),s)));return s}function yee(e,t){return e&&e[1]?kfe(e[1]):t}function kfe(e){return parseFloat(e.split(",")[1])}function xX(e){let t,i,r=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,i=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(i=e)),t)r=ow.units[ow[t]];else if(i){const s=zfe(i)?Lfe:Ufe(i)?Nfe:null;if(s){const n=s.exec(i);n&&n[1]&&(r=u$e(n[1]))}}return _(r)?Ffe(r):null}function Sxt(e){const t=xX(e);return M(t)||!t$e.includes(t)?null:t}function Ufe(e){return/^GEOCCS/i.test(e)}function zfe(e){return/^PROJCS/i.test(e)}const c$e=1e-7;function u$e(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!ow.units.includes(i)){const r=kfe(e);i=null;const s=ow.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<c$e){i=ow.units[n];break}}return i}function h$e(e){const t=xX(e);if(M(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}function Ext(e){var s,n,o;const t="metric";if(M(e))return t;const i=e.map,r=i&&"portalItem"in i?(s=i.portalItem)==null?void 0:s.portal:null;if(r)switch((o=(n=r==null?void 0:r.user)==null?void 0:n.units)!=null?o:r.units){case t:return t;case"english":return"imperial"}return ft(h$e(e.spatialReference),t)}const Vfe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Bfe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},d$e=fa()(Vfe),p$e=fa()(Bfe);fa()(F(F({},Vfe),Bfe));var oM;const NF=fa()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Gfe=NF.jsonValues.slice();C5(Gfe,"orthometric");const hO=fa()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Ed=oM=class extends ve{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return NF.write(e,t,i)}readHeightModel(e,t,i){return NF.read(e)||(i&&i.messages&&i.messages.push(f$e(e,{context:i})),null)}readHeightUnit(e,t,i){return hO.read(e)||(i&&i.messages&&i.messages.push(vee(e,{context:i})),null)}readHeightUnitService(e,t,i){return Ffe(e)||hO.read(e)||(i&&i.messages&&i.messages.push(vee(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new oM({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=a$e(t);return new oM({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t=F({origin:"web-scene"},t),super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new oM;return t.read(e,{origin:"web-scene"}),t}};function vee(e,t){return new Iu("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function f$e(e,t){return new Iu("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([d({type:NF.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Gfe,default:"ellipsoidal"}}}})],Ed.prototype,"heightModel",void 0),u([Be("web-scene","heightModel")],Ed.prototype,"writeHeightModel",null),u([Ue(["web-scene","service"],"heightModel")],Ed.prototype,"readHeightModel",null),u([d({type:hO.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:hO.jsonValues,write:hO.write}}}})],Ed.prototype,"heightUnit",void 0),u([Ue("web-scene","heightUnit")],Ed.prototype,"readHeightUnit",null),u([Ue("service","heightUnit")],Ed.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Ed.prototype,"vertCRS",void 0),u([Ue("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Ed.prototype,"readVertCRS",null),Ed=oM=u([P("esri.geometry.HeightModelInfo")],Ed);const O_=Ed;function Ts(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Tm(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v,w){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=f,e[12]=m,e[13]=y,e[14]=v,e[15]=w,e}function dm(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pl(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function vs(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],w=t[14],b=t[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,C=r*l-s*a,A=r*c-n*a,I=s*c-n*l,L=h*v-p*y,D=h*w-f*y,U=h*b-m*y,z=p*w-f*v,V=p*b-m*v,X=f*b-m*w;let Z=S*X-T*V+E*z+C*U-A*D+I*L;return Z?(Z=1/Z,e[0]=(a*X-l*V+c*z)*Z,e[1]=(s*V-r*X-n*z)*Z,e[2]=(v*I-w*A+b*C)*Z,e[3]=(f*A-p*I-m*C)*Z,e[4]=(l*U-o*X-c*D)*Z,e[5]=(i*X-s*U+n*D)*Z,e[6]=(w*E-y*I-b*T)*Z,e[7]=(h*I-f*E+m*T)*Z,e[8]=(o*V-a*U+c*L)*Z,e[9]=(r*U-i*V-n*L)*Z,e[10]=(y*A-v*E+b*S)*Z,e[11]=(p*E-h*A-m*S)*Z,e[12]=(a*D-o*z-l*L)*Z,e[13]=(i*z-r*D+s*L)*Z,e[14]=(v*T-y*C-w*S)*Z,e[15]=(h*C-p*T+f*S)*Z,e):null}function m$e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],w=t[14],b=t[15];return e[0]=a*(f*b-m*w)-p*(l*b-c*w)+v*(l*m-c*f),e[1]=-(r*(f*b-m*w)-p*(s*b-n*w)+v*(s*m-n*f)),e[2]=r*(l*b-c*w)-a*(s*b-n*w)+v*(s*c-n*l),e[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*b-m*w)-h*(l*b-c*w)+y*(l*m-c*f)),e[5]=i*(f*b-m*w)-h*(s*b-n*w)+y*(s*m-n*f),e[6]=-(i*(l*b-c*w)-o*(s*b-n*w)+y*(s*c-n*l)),e[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),e[8]=o*(p*b-m*v)-h*(a*b-c*v)+y*(a*m-c*p),e[9]=-(i*(p*b-m*v)-h*(r*b-n*v)+y*(r*m-n*p)),e[10]=i*(a*b-c*v)-o*(r*b-n*v)+y*(r*c-n*a),e[11]=-(i*(a*m-c*p)-o*(r*m-n*p)+h*(r*c-n*a)),e[12]=-(o*(p*w-f*v)-h*(a*w-l*v)+y*(a*f-l*p)),e[13]=i*(p*w-f*v)-h*(r*w-s*v)+y*(r*f-s*p),e[14]=-(i*(a*w-l*v)-o*(r*w-s*v)+y*(r*l-s*a)),e[15]=i*(a*f-l*p)-o*(r*f-s*p)+h*(r*l-s*a),e}function g$e(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],m=e[12],y=e[13],v=e[14],w=e[15];return(t*o-i*n)*(p*w-f*v)-(t*a-r*n)*(h*w-f*y)+(t*l-s*n)*(h*v-p*y)+(i*a-r*o)*(c*w-f*m)-(i*l-s*o)*(c*v-p*m)+(r*l-s*a)*(c*y-h*m)}function jr(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=t[9],m=t[10],y=t[11],v=t[12],w=t[13],b=t[14],S=t[15];let T=i[0],E=i[1],C=i[2],A=i[3];return e[0]=T*r+E*a+C*p+A*v,e[1]=T*s+E*l+C*f+A*w,e[2]=T*n+E*c+C*m+A*b,e[3]=T*o+E*h+C*y+A*S,T=i[4],E=i[5],C=i[6],A=i[7],e[4]=T*r+E*a+C*p+A*v,e[5]=T*s+E*l+C*f+A*w,e[6]=T*n+E*c+C*m+A*b,e[7]=T*o+E*h+C*y+A*S,T=i[8],E=i[9],C=i[10],A=i[11],e[8]=T*r+E*a+C*p+A*v,e[9]=T*s+E*l+C*f+A*w,e[10]=T*n+E*c+C*m+A*b,e[11]=T*o+E*h+C*y+A*S,T=i[12],E=i[13],C=i[14],A=i[15],e[12]=T*r+E*a+C*p+A*v,e[13]=T*s+E*l+C*f+A*w,e[14]=T*n+E*c+C*m+A*b,e[15]=T*o+E*h+C*y+A*S,e}function ja(e,t,i){const r=i[0],s=i[1],n=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],m=t[7],y=t[8],v=t[9],w=t[10],b=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=f,e[7]=m,e[8]=y,e[9]=v,e[10]=w,e[11]=b,e[12]=o*r+h*s+y*n+t[12],e[13]=a*r+p*s+v*n+t[13],e[14]=l*r+f*s+w*n+t[14],e[15]=c*r+m*s+b*n+t[15]}return e}function ek(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function mc(e,t,i,r){let s,n,o,a,l,c,h,p,f,m,y,v,w,b,S,T,E,C,A,I,L,D,U,z,V=r[0],X=r[1],Z=r[2],ae=Math.sqrt(V*V+X*X+Z*Z);return ae<Et?null:(ae=1/ae,V*=ae,X*=ae,Z*=ae,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],f=t[5],m=t[6],y=t[7],v=t[8],w=t[9],b=t[10],S=t[11],T=V*V*o+n,E=X*V*o+Z*s,C=Z*V*o-X*s,A=V*X*o-Z*s,I=X*X*o+n,L=Z*X*o+V*s,D=V*Z*o+X*s,U=X*Z*o-V*s,z=Z*Z*o+n,e[0]=a*T+p*E+v*C,e[1]=l*T+f*E+w*C,e[2]=c*T+m*E+b*C,e[3]=h*T+y*E+S*C,e[4]=a*A+p*I+v*L,e[5]=l*A+f*I+w*L,e[6]=c*A+m*I+b*L,e[7]=h*A+y*I+S*L,e[8]=a*D+p*U+v*z,e[9]=l*D+f*U+w*z,e[10]=c*D+m*U+b*z,e[11]=h*D+y*U+S*z,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function V2(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*r,e[5]=o*s+h*r,e[6]=a*s+p*r,e[7]=l*s+f*r,e[8]=c*s-n*r,e[9]=h*s-o*r,e[10]=p*s-a*r,e[11]=f*s-l*r,e}function tk(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*r,e[1]=o*s-h*r,e[2]=a*s-p*r,e[3]=l*s-f*r,e[8]=n*r+c*s,e[9]=o*r+h*s,e[10]=a*r+p*s,e[11]=l*r+f*s,e}function B2(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*r,e[1]=o*s+h*r,e[2]=a*s+p*r,e[3]=l*s+f*r,e[4]=c*s-n*r,e[5]=h*s-o*r,e[6]=p*s-a*r,e[7]=f*s-l*r,e}function ik(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function y$e(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fu(e,t,i){let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Et?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*r,e[2]=l*o*n-a*r,e[3]=0,e[4]=o*a*n-l*r,e[5]=a*a*n+s,e[6]=l*a*n+o*r,e[7]=0,e[8]=o*l*n+a*r,e[9]=a*l*n-o*r,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function jfe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v$e(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Hfe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function qfe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,c=n+n,h=r*a,p=r*l,f=r*c,m=s*l,y=s*c,v=n*c,w=o*a,b=o*l,S=o*c;return e[0]=1-(m+v),e[1]=p+S,e[2]=f-b,e[3]=0,e[4]=p-S,e[5]=1-(h+v),e[6]=y+w,e[7]=0,e[8]=f+b,e[9]=y-w,e[10]=1-(h+m),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function _$e(e,t){const i=b$e,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=r*r+s*s+n*n+o*o;return p>0?(i[0]=2*(a*o+h*r+l*n-c*s)/p,i[1]=2*(l*o+h*s+c*r-a*n)/p,i[2]=2*(c*o+h*n+a*s-l*r)/p):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),qfe(e,t,i),e}const b$e=R();function w$e(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Wfe(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function x$e(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function T$e(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,v=n*h,w=o*h,b=a*l,S=a*c,T=a*h,E=r[0],C=r[1],A=r[2];return e[0]=(1-(y+w))*E,e[1]=(f+T)*E,e[2]=(m-S)*E,e[3]=0,e[4]=(f-T)*C,e[5]=(1-(p+w))*C,e[6]=(v+b)*C,e[7]=0,e[8]=(m+S)*A,e[9]=(v-b)*A,e[10]=(1-(p+y))*A,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function S$e(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,v=o*h,w=o*p,b=a*p,S=l*c,T=l*h,E=l*p,C=r[0],A=r[1],I=r[2],L=s[0],D=s[1],U=s[2],z=(1-(v+b))*C,V=(m+E)*C,X=(y-T)*C,Z=(m-E)*A,ae=(1-(f+b))*A,re=(w+S)*A,$=(y+T)*I,k=(w-S)*I,B=(1-(f+v))*I;return e[0]=z,e[1]=V,e[2]=X,e[3]=0,e[4]=Z,e[5]=ae,e[6]=re,e[7]=0,e[8]=$,e[9]=k,e[10]=B,e[11]=0,e[12]=i[0]+L-(z*L+Z*D+$*U),e[13]=i[1]+D-(V*L+ae*D+k*U),e[14]=i[2]+U-(X*L+re*D+B*U),e[15]=1,e}function E$e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,v=n*o,w=n*a,b=n*l;return e[0]=1-p-y,e[1]=h+b,e[2]=f-w,e[3]=0,e[4]=h-b,e[5]=1-c-y,e[6]=m+v,e[7]=0,e[8]=f+w,e[9]=m-v,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xfe(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function C$e(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e}function A$e(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function TX(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*c,e[15]=1,e}function rk(e,t,i,r){let s,n,o,a,l,c,h,p,f,m;const y=t[0],v=t[1],w=t[2],b=r[0],S=r[1],T=r[2],E=i[0],C=i[1],A=i[2];return Math.abs(y-E)<Et&&Math.abs(v-C)<Et&&Math.abs(w-A)<Et?dm(e):(h=y-E,p=v-C,f=w-A,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,s=S*f-T*p,n=T*h-b*f,o=b*p-S*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*y+n*v+o*w),e[13]=-(a*y+l*v+c*w),e[14]=-(h*y+p*v+f*w),e[15]=1,e)}function Yfe(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],p=n-i[1],f=o-i[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,v=c*h-a*f,w=a*p-l*h;return m=y*y+v*v+w*w,m>0&&(m=1/Math.sqrt(m),y*=m,v*=m,w*=m),e[0]=y,e[1]=v,e[2]=w,e[3]=0,e[4]=p*w-f*v,e[5]=f*y-h*w,e[6]=h*v-p*y,e[7]=0,e[8]=h,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function M$e(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function O$e(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function R$e(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function Zfe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function P$e(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function I$e(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function $$e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Qfe(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],v=e[13],w=e[14],b=e[15],S=t[0],T=t[1],E=t[2],C=t[3],A=t[4],I=t[5],L=t[6],D=t[7],U=t[8],z=t[9],V=t[10],X=t[11],Z=t[12],ae=t[13],re=t[14],$=t[15];return Math.abs(i-S)<=Et*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-T)<=Et*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(s-E)<=Et*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-C)<=Et*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-A)<=Et*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-I)<=Et*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(l-L)<=Et*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(c-D)<=Et*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-U)<=Et*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(p-z)<=Et*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(f-V)<=Et*Math.max(1,Math.abs(f),Math.abs(V))&&Math.abs(m-X)<=Et*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(y-Z)<=Et*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(v-ae)<=Et*Math.max(1,Math.abs(v),Math.abs(ae))&&Math.abs(w-re)<=Et*Math.max(1,Math.abs(w),Math.abs(re))&&Math.abs(b-$)<=Et*Math.max(1,Math.abs(b),Math.abs($))}function SX(e){const t=Et,i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const D$e=jr,L$e=Zfe;Object.freeze(Object.defineProperty({__proto__:null,copy:Ts,set:Tm,identity:dm,transpose:Pl,invert:vs,adjoint:m$e,determinant:g$e,multiply:jr,translate:ja,scale:ek,rotate:mc,rotateX:V2,rotateY:tk,rotateZ:B2,fromTranslation:ik,fromScaling:y$e,fromRotation:Fu,fromXRotation:jfe,fromYRotation:v$e,fromZRotation:Hfe,fromRotationTranslation:qfe,fromQuat2:_$e,getTranslation:w$e,getScaling:Wfe,getRotation:x$e,fromRotationTranslationScale:T$e,fromRotationTranslationScaleOrigin:S$e,fromQuat:E$e,frustum:Xfe,perspective:C$e,perspectiveFromFieldOfView:A$e,ortho:TX,lookAt:rk,targetTo:Yfe,str:M$e,frob:O$e,add:R$e,subtract:Zfe,multiplyScalar:P$e,multiplyScalarAndAdd:I$e,exactEquals:$$e,equals:Qfe,isOrthoNormal:SX,mul:D$e,sub:L$e},Symbol.toStringTag,{value:"Module"}));let Qz,oe=null;function Jfe(){return!!oe}function N$e(){return!!he("esri-wasm")}function Kfe(){return Qz||(Qz=import("./pe-wasm.41ba155b.js").then(e=>e.p).then(({default:e})=>e({locateFile:t=>Li(`esri/geometry/support/${t}`)})).then(e=>{tme(e)}),Qz)}var OG,ds,RG;(function(e){function t(n,o,a){oe.ensureCache.prepare();const l=Sb(a),c=a===l,h=oe.ensureFloat64(l),p=oe._pe_geog_to_proj(oe.getPointer(n),o,h);return p&&fv(a,o,h,c),p}function i(n,o,a,l){switch(l){case ds.PE_TRANSFORM_P_TO_G:return r(n,o,a);case ds.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){oe.ensureCache.prepare();const c=Sb(a),h=a===c,p=oe.ensureFloat64(c),f=oe._pe_proj_to_geog_center(oe.getPointer(n),o,p,l);return f&&fv(a,o,p,h),f}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(OG||(OG={})),function(e){function t(){e.PE_BUFFER_MAX=oe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=oe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=oe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=oe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=oe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=oe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=oe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=oe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=oe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=oe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=oe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=oe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=oe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=oe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=oe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=oe.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=oe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=oe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=oe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=oe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=oe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=oe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=oe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=oe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=oe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=oe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=oe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=oe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=oe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=oe.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(ds||(ds={})),function(e){const t={},i={},r=m=>{if(m){const y=m.getType();switch(y){case ds.PE_TYPE_GEOGCS:m=oe.castObject(m,oe.PeGeogcs);break;case ds.PE_TYPE_PROJCS:m=oe.castObject(m,oe.PeProjcs);break;case ds.PE_TYPE_GEOGTRAN:m=oe.castObject(m,oe.PeGeogtran);break;default:y&ds.PE_TYPE_UNIT&&(m=oe.castObject(m,oe.PeUnit))}}return m};function s(){oe.PeFactory.prototype.initialize(null)}function n(m){return o(ds.PE_TYPE_COORDSYS,m)}function o(m,y){let v=null,w=t[m];if(w||(w={},t[m]=w),w.hasOwnProperty(String(y)))v=w[y];else{const b=oe.PeFactory.prototype.factoryByType(m,y);oe.compare(b,oe.NULL)||(v=b,w[y]=v)}return v=r(v),v}function a(m,y){let v=null,w=i[m];if(w||(w={},i[m]=w),w.hasOwnProperty(y))v=w[y];else{const b=oe.PeFactory.prototype.fromString(m,y);oe.compare(b,oe.NULL)||(v=b,w[y]=v)}return v=r(v),v}function l(m){return o(ds.PE_TYPE_GEOGCS,m)}function c(m){return o(ds.PE_TYPE_GEOGTRAN,m)}function h(m){return oe.PeFactory.prototype.getCode(m)}function p(m){return o(ds.PE_TYPE_PROJCS,m)}function f(m){return o(ds.PE_TYPE_UNIT,m)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=f}(RG||(RG={}));let eme=null;var FF,PG,IG,$G,kF,DG,UF,zF,LG;function tme(e){function t(n,o,a){n[o]=a(n[o])}oe=e,ds.init(),FF.init(),kF.init(),UF.init(),zF.init(),eme=class extends oe.PeGCSExtent{destroy(){oe.destroy(this)}};const i=[oe.PeDatum,oe.PeGeogcs,oe.PeGeogtran,oe.PeObject,oe.PeParameter,oe.PePrimem,oe.PeProjcs,oe.PeSpheroid,oe.PeUnit];for(const n of i)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(ds.PE_NAME_MAX))});for(const n of[oe.PeGeogtran,oe.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(ds.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=oe.getValue(l,"*");a[c]=h?oe.wrapPointer(h,oe.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(oe.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return fv(a,o,n.call(this)),a}),t(oe.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=oe._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=oe.getPointer(l);for(let p=1;p<c;p++)a.push(oe.wrapPointer(h+o*p,oe.PeGTlistExtendedGTs))}}return a}});const r=oe._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=l.getNump();if(c>1){const h=oe.getPointer(l);for(let p=1;p<c;p++)a.push(oe.wrapPointer(h+r*p,oe.PeHorizon))}}return o.set(n,a),a};t(oe.PeProjcs.prototype,"horizonGcsGenerate",s),t(oe.PeProjcs.prototype,"horizonPcsGenerate",s),oe.PeObject.prototype.toString=function(n=ds.PE_STR_OPTS_NONE){oe.ensureCache.prepare();const o=oe.getPointer(this),a=oe.ensureInt8(new Array(ds.PE_BUFFER_MAX));return oe.UTF8ToString(oe._pe_object_to_string_ext(o,n,a))}}function $m(e){if(!e)return;const t=oe.getClass(e);if(!t)return;const i=oe.getCache(t);if(!i)return;const r=oe.getPointer(e);r&&delete i[r]}function dI(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(oe.ensureInt8(r));return i}function Sb(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function fv(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=oe.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=oe.getValue(i,"double"),e[n][1]=oe.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=oe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=oe._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const p=new oe.PeInteger(c);try{const f=oe.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=oe.getPointer(f);for(let y=1;y<c;y++)h.push(oe.wrapPointer(m+t*y,oe.PeGTlistExtendedEntry))}}finally{oe.destroy(p)}return h}e.init=i,e.getGTlist=r})(FF||(FF={})),function(e){function t(i){if(i&&i.length){for(const r of i)$m(r),r.getEntries().forEach(s=>{$m(s);const n=s.getGeogtran();$m(n),n.getParameters().forEach($m),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{$m(o);const a=o.getDatum();$m(a),$m(a.getSpheroid()),$m(o.getPrimem()),$m(o.getUnit())})});oe.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(PG||(PG={})),function(e){function t(i,r,s,n,o){oe.ensureCache.prepare();const a=Sb(s),l=s===a,c=oe.ensureFloat64(a);let h=0;n&&(h=oe.ensureFloat64(n));const p=oe._pe_geog_to_geog(oe.getPointer(i),r,c,h,o);return p&&fv(s,r,c,l),p}e.geogToGeog=t}(IG||(IG={})),function(e){const t=(c,h,p,f,m,y)=>{let v,w;switch(oe.ensureCache.prepare(),c){case"dd":v=oe._pe_geog_to_dd,w=ds.PE_DD_MAX;break;case"ddm":v=oe._pe_geog_to_ddm,w=ds.PE_DDM_MAX;break;case"dms":v=oe._pe_geog_to_dms,w=ds.PE_DMS_MAX}let b=0;h&&(b=oe.getPointer(h));const S=Sb(f),T=oe.ensureFloat64(S),E=dI(p,w),C=v(b,p,T,m,oe.ensureInt32(E));if(C)for(let A=0;A<p;A++)y[A]=oe.UTF8ToString(E[A]);return C},i=(c,h,p,f,m)=>{let y;switch(oe.ensureCache.prepare(),c){case"dd":y=oe._pe_dd_to_geog;break;case"ddm":y=oe._pe_ddm_to_geog;break;case"dms":y=oe._pe_dms_to_geog}let v=0;h&&(v=oe.getPointer(h));const w=f.map(E=>oe.ensureString(E)),b=oe.ensureInt32(w),S=oe.ensureFloat64(new Array(2*p)),T=y(v,p,b,S);return T&&fv(m,p,S),T};function r(c,h,p,f,m){return t("dms",c,h,p,f,m)}function s(c,h,p,f){return i("dms",c,h,p,f)}function n(c,h,p,f,m){return t("ddm",c,h,p,f,m)}function o(c,h,p,f){return i("ddm",c,h,p,f)}function a(c,h,p,f,m){return t("dd",c,h,p,f,m)}function l(c,h,p,f){return i("dd",c,h,p,f)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}($G||($G={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=oe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=oe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){oe.ensureCache.prepare();let p=0;s&&(p=oe.getPointer(s));const f=Sb(o),m=oe.ensureFloat64(f),y=dI(n,ds.PE_MGRS_MAX),v=oe.ensureInt32(y),w=oe._pe_geog_to_mgrs_extended(p,n,m,a,l,c,v);if(w)for(let b=0;b<n;b++)h[b]=oe.UTF8ToString(y[b]);return w}function r(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=o.map(y=>oe.ensureString(y)),p=oe.ensureInt32(h),f=oe.ensureFloat64(new Array(2*n)),m=oe._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&fv(l,n,f),m}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(kF||(kF={})),function(e){function t(r,s,n,o,a,l,c){oe.ensureCache.prepare();let h=0;r&&(h=oe.getPointer(r));const p=Sb(n),f=oe.ensureFloat64(p),m=dI(s,ds.PE_MGRS_MAX),y=oe.ensureInt32(m),v=oe._pe_geog_to_usng(h,s,f,o,a,l,y);if(v)for(let w=0;w<s;w++)c[w]=oe.UTF8ToString(m[w]);return v}function i(r,s,n,o){oe.ensureCache.prepare();let a=0;r&&(a=oe.getPointer(r));const l=n.map(f=>oe.ensureString(f)),c=oe.ensureInt32(l),h=oe.ensureFloat64(new Array(2*s)),p=oe._pe_usng_to_geog(a,s,c,h);return p&&fv(o,s,h),p}e.geogToUsng=t,e.usngToGeog=i}(DG||(DG={})),function(e){function t(){e.PE_UTM_OPTS_NONE=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=oe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=Sb(o),p=oe.ensureFloat64(h),f=dI(n,ds.PE_UTM_MAX),m=oe.ensureInt32(f),y=oe._pe_geog_to_utm(c,n,p,a,m);if(y)for(let v=0;v<n;v++)l[v]=oe.UTF8ToString(f[v]);return y}function r(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=o.map(y=>oe.ensureString(y)),p=oe.ensureInt32(h),f=oe.ensureFloat64(new Array(2*n)),m=oe._pe_utm_to_geog(c,n,p,a,f);return m&&fv(l,n,f),m}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(UF||(UF={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=oe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=oe.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o,a;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=oe.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=i,e.generate=r}(zF||(zF={})),function(e){function t(){return oe.PeVersion.prototype.version_string()}e.versionString=t}(LG||(LG={}));const F$e=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return oe},isLoaded:Jfe,isSupported:N$e,load:Kfe,get PeCSTransformations(){return OG},get PeDefs(){return ds},get PeFactory(){return RG},get PeGCSExtent(){return eme},get PeGTlistExtended(){return FF},get PeGTlistExtendedEntry(){return PG},get PeGTTransformations(){return IG},get PeNotationDms(){return $G},get PeNotationMgrs(){return kF},get PeNotationUsng(){return DG},get PeNotationUtm(){return UF},get PePCSInfo(){return zF},get PeVersion(){return LG},_init:tme},Symbol.toStringTag,{value:"Module"})),Cxt=Math.PI/180,Axt=/SPHEROID\[([^\]]+)]/i,Vy=Ri.radius,dd=Ri.eccentricitySquared,k$e={a1:Vy*dd,a2:Vy*dd*Vy*dd,a3:Vy*dd*dd/2,a4:Vy*dd*Vy*dd*2.5,a5:Vy*dd+Vy*dd*dd/2,a6:1-dd},Mxt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Ri.radius,f:Ri.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:oy.radius,f:oy.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Yf.radius,f:Yf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Yf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let pI=0;class t2{constructor(t=null){this.uid=pI++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const i=new t2;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=pI++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=pI++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=pI++}getInverse(){const t=new t2;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class Mv{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const i of t.steps)i instanceof t2?this.steps.push(i):this.steps.push(new t2({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}static cacheKey(t,i){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(t){const i=new Mv;let r="";for(const s of t.steps){const n=t2.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cached_projection={},i._gtlistentry=null,i._chain=r,i}getInverse(){const t=new Mv;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cached_projection[Mv.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);const s=this._cached_projection[Mv.cacheKey(t,i)];return s===void 0?null:s}}function ime(e,t,i){if(M(t)||M(i)||i.vcsWkid||Rc(t,i))return null;const r=z2(t)/z2(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>U$e(s,r);case"polyline":case"esriGeometryPolyline":return s=>V$e(s,r);case"polygon":case"esriGeometryPolygon":return s=>z$e(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>B$e(s,r);case"extent":case"esriGeometryExtent":return s=>G$e(s,r);default:return null}}function U$e(e,t){e&&e.z!=null&&(e.z*=t)}function z$e(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function V$e(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function B$e(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function G$e(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let qv=null,VF=null,Jz=null,Kz={};const rme=new Gde;function EX(){return!!qv&&Jfe()}function BF(e){return M(Jz)&&(Jz=Promise.all([Kfe(),import("./geometryEngineBase.f43341a0.js").then(t=>t.g),import("./hydrated.4444a522.js")])),Jz.then(([,t,{hydratedAdapter:i}])=>{ci(e),VF=i,qv=t.default,qv._enableProjection(F$e),rme.notify()})}function GP(e,t,i=null,r=null){return Array.isArray(e)?e.length===0?[]:_ee(VF,e,e[0].spatialReference,t,i,r):_ee(VF,[e],e.spatialReference,t,i,r)[0]}function _ee(e,t,i,r,s=null,n=null){if(M(i)||M(r))return t;if(cy(i,r,s))return t.map(o=>sme(o,i,r));if(M(s)){const o=Mv.cacheKey(i,r);Kz[o]!==void 0?s=Kz[o]:(s=j$e(i,r,null),M(s)&&(s=new Mv),Kz[o]=s)}if(M(qv))throw new CX;return _(n)?qv._project(e,t,i,r,s,n):qv._project(e,t,i,r,s)}function Oxt(e,t){return M(e)?{pending:null,geometry:null}:Rc(e.spatialReference,t)?{pending:null,geometry:e}:Ml(e.spatialReference)&&Ml(t)?cy(e.spatialReference,t)||EX()?{pending:null,geometry:H$e(e,t)}:(Kt(rme),{pending:BF(),geometry:null}):{pending:null,geometry:null}}function j$e(e,t,i=null){if(M(qv))throw new CX;if(M(e)||M(t))return null;const r=qv._getTransformation(VF,e,t,i,i==null?void 0:i.spatialReference);return r!==null?Mv.fromGE(r):null}class CX extends q{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var J;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(J||(J={}));function H$e(e,t){try{const i=GP(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=ime(i.type,e.spatialReference,t);return _(r)&&r(i),i}catch(i){if(!(i instanceof CX))throw i;return null}}function cy(e,t,i){return!i&&(!!Rc(e,t)||Ml(e)&&Ml(t)&&!!RX(e,t,IX))}async function Rxt(e,t,i,r){if(EX())return uK(r);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!cy(s,n,o))return BF(r)}else if(!cy(e,t,i))return BF(r);return uK(r)}function Pxt(e,t){switch(RX(e,t,IX)){case _r:return"copy3";case Rv:return"wgs84ToSphericalECEF";case Mw:return"wgs84ToWebMercator";case Ov:return"wgs84ToPlateCarree";case Iv:return"wgs84ToWGS84ECEF";case aw:return"webMercatorToWGS84";case ume:return"webMercatorToSphericalECEF";case hme:return"webMercatorToWGS84ECEF";case dme:return"webMercatorToPlateCarree";case $v:return"wgs84ECEFToWGS84";case mme:return"wgs84ECEFToSphericalECEF";case gme:return"wgs84ECEFToWebMercator";case Pv:return"sphericalECEFToWGS84";case pme:return"sphericalECEFToWebMercator";case UG:return"sphericalMarsPCPFToMars2000";case kG:return"sphericalMoonPCPFToMoon2000";case fme:return"sphericalECEFToWGS84ECEF";case FG:return"mars2000ToSphericalPCPF";case NG:return"moon2000ToSphericalPCPF";default:return null}}function sme(e,t,i){return e?"x"in e?nme(e,t,new at,i,0):"xmin"in e?Y$e(e,t,new ui,i,0):"rings"in e?ome(e,t,new $u,i,0):"paths"in e?X$e(e,t,new Tu,i,0):"points"in e?W$e(e,t,new sx,i,0):null:null}function q$e(e,t,i=t.spatialReference,r=0){return!M(i)&&_(nme(e,e.spatialReference,t,i,r))}function nme(e,t,i,r,s){Vi[0]=e.x,Vi[1]=e.y;const n=e.z;return Vi[2]=n!==void 0?n:s,pr(Vi,t,0,Vi,r,0,1)?(i.x=Vi[0],i.y=Vi[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=Vi[2],i.hasZ=!0),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function W$e(e,t,i,r,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!pr(h,t,0,h,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function X$e(e,t,i,r,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return lme(n,o,a,t,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function Ixt(e,t,i=t.spatialReference,r=0){return _(i)&&_(ome(e,e.spatialReference,t,i,r))}function ome(e,t,i,r,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return lme(n,o,a,t,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function Y$e(e,t,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return bee(n,o,c?e.zmin:s,t,Vi,r)?(i.xmin=Vi[0],i.ymin=Vi[1],c&&(i.zmin=Vi[2]),bee(a,l,c?e.zmax:s,t,Vi,r)?(i.xmax=Vi[0],i.ymax=Vi[1],c&&(i.zmax=Vi[2]),h&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}function a_(e,t,i){if(M(t)||M(i))return null;const r=new at({spatialReference:i});return pr(e,t,0,Vi,i,0,1)?(r.x=Vi[0],r.y=Vi[1],r.z=Vi[2],r):null}function ame(e,t,i){return pr(e,t,0,Vi,i.spatialReference,0,1)?(i.x=Vi[0],i.y=Vi[1],i.z=Vi[2],i):null}function Gn(e,t,i,r=0){Vi[0]=e.x,Vi[1]=e.y;const s=e.z;return Vi[2]=s!==void 0?s:r,pr(Vi,e.spatialReference,0,t,i,0,1)}function bee(e,t,i,r,s,n){return Xr[0]=e,Xr[1]=t,Xr[2]=i,pr(Xr,r,0,s,n,0,1)}function un(e,t,i,r){return!(M(t)||M(r)||e.length<2)&&(e.length===2&&(Xr[0]=e[0],Xr[1]=e[1],Xr[2]=0,e=Xr),pr(e,t,0,i,r,0,1))}function Z$e(e,t){Vi[0]=e.x,Vi[1]=e.y;const i=e.z;return Vi[2]=i!==void 0?i:0,Q$e(Vi,e.spatialReference,t)}function Q$e(e,t,i){return J$e(e,t,i)}function J$e(e,t,i){if(M(t))return!1;const r=l_(t,nk),s=jf[r][J.WGS84_COMPARABLE_LON_LAT];return!M(s)&&(s(e,0,Xr,0),i!==Xr&&(i[0]=Xr[0],i[1]=Xr[1],i.length>2&&(i[2]=Xr[2])),!0)}function pr(e,t,i,r,s,n,o=1){const a=RX(t,s,IX);if(M(a))return!1;if(a===_r){if(e===r&&i===n)return!0;const c=i+3*o;for(let h=i,p=n;h<c;h++,p++)r[p]=e[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(e,c,r,h);return!0}function $xt(e,t,i,r,s){le(Vi,e),de(fI,e,t),un(Vi,i,Vi,s),un(fI,i,fI,s),pe(r,fI,Vi),we(r,r)}function lme(e,t,i,r,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!pr(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&i?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function K$e(e,t,i,r){if(M(t)||M(r))return!1;const s=yme(t,r,aDe);if(s.projector===_r)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if(M(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===J.WEB_MERCATOR){const a=jf[n.spatialReferenceId][J.WGS84];return!M(a)&&(a(e,0,Bd,0),Mw(Bd,0,i,0),i[3]=wee(Bd[1],e[2],e[3],Ri.radius),!0)}if(n.spatialReferenceId!==J.WGS84&&n.spatialReferenceId!==J.CGCS2000||o.spatialReferenceId!==J.PLATE_CARREE)s.projector(e,0,i,0),i[3]=e[3]*n.metersPerUnit/o.metersPerUnit;else{const a=jf[n.spatialReferenceId][J.SPHERICAL_ECEF],l=jf[J.SPHERICAL_ECEF][J.PLATE_CARREE];let c=e[3];_(a)&&_(l)&&(c=wee(e[1],e[2],e[3],Ri.radius)),s.projector(e,0,i,0),i[3]=c}return!0}function wee(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(cp*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function sk(e,t,i,r){return e!=null&&(Rc(t,r)?(ay(i,e),!0):(Xr[0]=e[0],Xr[1]=e[1],Xr[2]=0,!!pr(Xr,t,0,Xr,r,0,1)&&(i[0]=Xr[0],i[1]=Xr[1],Xr[0]=e[2],Xr[1]=e[3],Xr[2]=0,!!pr(Xr,t,0,Xr,r,0,1)&&(i[2]=Xr[0],i[3]=Xr[1],!0))))}function Dxt(e,t,i,r){if(M(t)||M(r))return!1;const s=l_(t,nk),n=l_(r,vme);if(s===n&&s!==J.UNKNOWN||Rc(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===J.SPHERICAL_ECEF){const o=Oe(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/Ri.radius;if(n===J.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===J.WGS84||n===J.CGCS2000){const c=dO;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===J.PLATE_CARREE){if(n===J.WGS84||n===J.CGCS2000)return i[0]=dO,i[1]=dO,i[2]=1,!0;if(n===J.WEB_MERCATOR){const o=e[1]/Ri.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function ku(e,t,i,r){if(M(e)||M(r))return!1;const s=l_(e,nk),n=l_(r,vme);if(s===n&&!xee(n)&&(s!==J.UNKNOWN||Rc(e,r)))return ik(i,t),!0;if(xee(n)){const o=jf[s][J.LON_LAT],a=jf[J.LON_LAT][n];return!M(o)&&!M(a)&&(o(t,0,Bd,0),a(Bd,0,By,0),cme(cp*Bd[0],cp*Bd[1],i),i[12]=By[0],i[13]=By[1],i[14]=By[2],!0)}if((n===J.WEB_MERCATOR||n===J.PLATE_CARREE)&&(s===J.WGS84||s===J.CGCS2000&&n===J.PLATE_CARREE||s===J.SPHERICAL_ECEF||s===J.WEB_MERCATOR)){const o=jf[s][J.LON_LAT],a=jf[J.LON_LAT][n];return!M(o)&&!M(a)&&(o(t,0,Bd,0),a(Bd,0,By,0),s===J.SPHERICAL_ECEF?eDe(cp*Bd[0],cp*Bd[1],i):dm(i),i[12]=By[0],i[13]=By[1],i[14]=By[2],!0)}return!1}function xee(e){return e===J.SPHERICAL_ECEF||e===J.SPHERICAL_MARS_PCPF||e===J.SPHERICAL_MOON_PCPF}function cme(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function eDe(e,t,i){return cme(e,t,i),Pl(i,i),i}function l_(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=Ic(e,1)),e.wkt===$fe.wkt?t.spatialReferenceId=J.SPHERICAL_ECEF:tR(e)?t.spatialReferenceId=J.WGS84:bw(e)?t.spatialReferenceId=J.WEB_MERCATOR:iR(e)?t.spatialReferenceId=J.PLATE_CARREE:e.wkt===XIe.wkt?t.spatialReferenceId=J.WGS84_ECEF:e.wkid===Nh.CGCS2000?t.spatialReferenceId=J.CGCS2000:e.wkt===DF.wkt?t.spatialReferenceId=J.SPHERICAL_MARS_PCPF:e.wkt===LF.wkt?t.spatialReferenceId=J.SPHERICAL_MOON_PCPF:_m(e)?t.spatialReferenceId=J.GCSMARS2000:bm(e)?t.spatialReferenceId=J.GCSMOON2000:t.spatialReferenceId=J.UNKNOWN)}function _r(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function aw(e,t,i,r){i[r++]=G2*(e[t++]/Ri.radius),i[r++]=G2*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/Ri.radius))),i[r]=e[t]}function ume(e,t,i,r){aw(e,t,i,r),Rv(i,r,i,r)}function hme(e,t,i,r){aw(e,t,i,r),Iv(i,r,i,r)}function AX(e,t,i,r,s){const n=.4999999*Math.PI,o=De(cp*e[t+1],-n,n),a=Math.sin(o);i[r++]=cp*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=e[t+2]}function Mw(e,t,i,r){AX(e,t,i,r,Ri)}const Tee=Ri.radius*Math.PI/180,dO=180/(Ri.radius*Math.PI);function Ov(e,t,i,r){i[r]=e[t]*Tee,i[r+1]=e[t+1]*Tee,i[r+2]=e[t+2]}function Ub(e,t,i,r){i[r]=e[t]*dO,i[r+1]=e[t+1]*dO,i[r+2]=e[t+2]}function dme(e,t,i,r){aw(e,t,i,r),Ov(i,r,i,r)}function tDe(e,t,i,r){$v(e,t,i,r),Ov(i,r,i,r)}function iDe(e,t,i,r){Pv(e,t,i,r),Ov(i,r,i,r)}function rDe(e,t,i,r){Ub(e,t,i,r),Rv(i,r,i,r)}function sDe(e,t,i,r){Ub(e,t,i,r),Mw(i,r,i,r)}function nDe(e,t,i,r){Ub(e,t,i,r),Iv(i,r,i,r)}function Ow(e){if(M(e))return!1;const t=l_(e,nk);return!!jf[t][J.WGS84_COMPARABLE_LON_LAT]}function AC(e,t,i,r){const s=Math.cos(i);e[0]=Math.cos(t)*s*r,e[1]=Math.sin(t)*s*r,e[2]=Math.sin(i)*r}function MX(e,t,i,r,s){const n=s+e[t+2],o=cp*e[t+1],a=cp*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function NG(e,t,i,r){MX(e,t,i,r,oy.radius)}function FG(e,t,i,r){MX(e,t,i,r,Yf.radius)}function Rv(e,t,i,r){MX(e,t,i,r,Ri.radius)}function OX(e,t,i,r,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=xp(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=G2*h,i[r++]=G2*c,i[r]=l-s}function kG(e,t,i,r){OX(e,t,i,r,oy.radius)}function UG(e,t,i,r){OX(e,t,i,r,Yf.radius)}function Pv(e,t,i,r){OX(e,t,i,r,Ri.radius)}function pme(e,t,i,r){Pv(e,t,i,r),Mw(i,r,i,r)}function fme(e,t,i,r){Pv(e,t,i,r),Iv(i,r,i,r)}function oDe(e,t,i,r,s){const n=cp*e[t],o=cp*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function Iv(e,t,i,r){oDe(e,t,i,r,Ri)}function $v(e,t,i,r){const s=k$e,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,f,m,y,v,w,b,S,T,E,C,A,I,L,D,U,z,V;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),z=Math.atan2(o,n),m=a*a/p,y=c/p,C=s.a2/f,A=s.a3-s.a4/f,y>.3?(v=l/f*(1+y*(s.a1+C+m*A)/f),U=Math.asin(v),b=v*v,w=Math.sqrt(1-b)):(w=h/f*(1-m*(s.a5-C-y*A)/f),U=Math.acos(w),b=1-w*w,v=Math.sqrt(b)),S=1-Ri.eccentricitySquared*b,T=Ri.radius/Math.sqrt(S),E=s.a6*T,C=h-T*w,A=l-E*v,L=w*C+v*A,I=w*A-v*C,D=I/(E/S+L),U+=D,V=L+I*D/2,a<0&&(U=-U),i[r++]=G2*z,i[r++]=G2*U,i[r]=V}function mme(e,t,i,r){$v(e,t,i,r),Rv(i,r,i,r)}function gme(e,t,i,r){$v(e,t,i,r),Mw(i,r,i,r)}const jf={[J.WGS84]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:_r,[J.WGS84_COMPARABLE_LON_LAT]:_r,[J.SPHERICAL_ECEF]:Rv,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Mw,[J.PLATE_CARREE]:Ov,[J.WGS84]:_r,[J.WGS84_ECEF]:Iv},[J.CGCS2000]:{[J.CGCS2000]:_r,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:_r,[J.WGS84_COMPARABLE_LON_LAT]:_r,[J.SPHERICAL_ECEF]:Rv,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:Ov,[J.WGS84]:null,[J.WGS84_ECEF]:Iv},[J.GCSMARS2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:_r,[J.GCSMOON2000]:null,[J.LON_LAT]:_r,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:FG,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.GCSMOON2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:_r,[J.LON_LAT]:_r,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:NG,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.WEB_MERCATOR]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:aw,[J.WGS84_COMPARABLE_LON_LAT]:aw,[J.SPHERICAL_ECEF]:ume,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:_r,[J.PLATE_CARREE]:dme,[J.WGS84]:aw,[J.WGS84_ECEF]:hme},[J.WGS84_ECEF]:{[J.CGCS2000]:$v,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:$v,[J.WGS84_COMPARABLE_LON_LAT]:$v,[J.SPHERICAL_ECEF]:mme,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:gme,[J.PLATE_CARREE]:tDe,[J.WGS84]:$v,[J.WGS84_ECEF]:_r},[J.SPHERICAL_ECEF]:{[J.CGCS2000]:Pv,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Pv,[J.WGS84_COMPARABLE_LON_LAT]:Pv,[J.SPHERICAL_ECEF]:_r,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:pme,[J.PLATE_CARREE]:iDe,[J.WGS84]:Pv,[J.WGS84_ECEF]:fme},[J.SPHERICAL_MARS_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:UG,[J.GCSMOON2000]:null,[J.LON_LAT]:UG,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:_r,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.SPHERICAL_MOON_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:kG,[J.LON_LAT]:kG,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:_r,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.UNKNOWN]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:null,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:_r,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.LON_LAT]:{[J.CGCS2000]:_r,[J.GCSMARS2000]:_r,[J.GCSMOON2000]:_r,[J.LON_LAT]:_r,[J.WGS84_COMPARABLE_LON_LAT]:_r,[J.SPHERICAL_ECEF]:Rv,[J.SPHERICAL_MARS_PCPF]:FG,[J.SPHERICAL_MOON_PCPF]:NG,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Mw,[J.PLATE_CARREE]:Ov,[J.WGS84]:_r,[J.WGS84_ECEF]:Iv},[J.WGS84_COMPARABLE_LON_LAT]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:_r,[J.WGS84_COMPARABLE_LON_LAT]:_r,[J.SPHERICAL_ECEF]:Rv,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:Ov,[J.WGS84]:_r,[J.WGS84_ECEF]:Iv},[J.PLATE_CARREE]:{[J.CGCS2000]:Ub,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Ub,[J.WGS84_COMPARABLE_LON_LAT]:Ub,[J.SPHERICAL_ECEF]:rDe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:sDe,[J.PLATE_CARREE]:_r,[J.WGS84]:Ub,[J.WGS84_ECEF]:nDe}};function RX(e,t,i=PX()){return M(e)||M(t)?null:yme(e,t,i).projector}function yme(e,t,i){if(M(e)||M(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=l_(e,i.source),s=l_(t,i.dest);return r===J.UNKNOWN&&s===J.UNKNOWN?Rc(e,t)?i.projector=_r:i.projector=null:i.projector=jf[r][s],i}function PX(){return{source:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},projector:_r}}const nk={spatialReference:null,spatialReferenceId:J.UNKNOWN},vme={spatialReference:null,spatialReferenceId:J.UNKNOWN},IX=PX(),aDe=PX(),cp=Dt(1),G2=Sc(1),Xr=R(),Bd=R(),By=R(),Vi=R(),fI=R();class Ty{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&T2(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*See);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,See));t++)this._items.push(this.allocator())}}const See=1024;function Ae(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function lw(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function $X(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v){return[e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v]}function _me(e,t){return new Float64Array(e,t,16)}const hn=Ae();Object.freeze(Object.defineProperty({__proto__:null,create:Ae,clone:lw,fromValues:$X,createView:_me,IDENTITY:hn},Symbol.toStringTag,{value:"Module"}));var Mu;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Mu||(Mu={}));function lDe(e){return 32+e.length}function cDe(){return 16}function bme(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=lDe(r);break;case"number":t+=cDe();break;case"boolean":t+=4}}return t}function Lxt(e,t){return 32+e.length*t}var j2;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(j2||(j2={}));function Pr(){return[1,0,0,0,1,0,0,0,1]}function uDe(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function hDe(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]}function wme(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Pr,clone:uDe,fromValues:hDe,createView:wme},Symbol.toStringTag,{value:"Module"}));function Sy(){return[0,0,0,1]}function dDe(e){return[e[0],e[1],e[2],e[3]]}function pDe(e,t,i,r){return[e,t,i,r]}function xme(e,t){return new Float64Array(e,t,4)}const fDe=Sy();Object.freeze(Object.defineProperty({__proto__:null,create:Sy,clone:dDe,fromValues:pDe,createView:xme,IDENTITY:fDe},Symbol.toStringTag,{value:"Module"}));function st(){return[0,0]}function aM(e){return[e[0],e[1]]}function Ni(e,t){return[e,t]}function Tme(e){const t=st(),i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function Sme(e,t){return new Float64Array(e,t,2)}function Eme(){return st()}function Cme(){return Ni(1,1)}function Ame(){return Ni(1,0)}function Mme(){return Ni(0,1)}const Zh=Eme(),Ome=Cme(),mDe=Ame(),gDe=Mme();Object.freeze(Object.defineProperty({__proto__:null,create:st,clone:aM,fromValues:Ni,fromArray:Tme,createView:Sme,zeros:Eme,ones:Cme,unitX:Ame,unitY:Mme,ZEROS:Zh,ONES:Ome,UNIT_X:mDe,UNIT_Y:gDe},Symbol.toStringTag,{value:"Module"}));function Ht(){return[0,0,0,0]}function ok(e){return[e[0],e[1],e[2],e[3]]}function mi(e,t,i,r){return[e,t,i,r]}function DX(e){const t=Ht(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function Rme(e,t){return new Float64Array(e,t,4)}function Pme(){return Ht()}function Ime(){return mi(1,1,1,1)}function $me(){return mi(1,0,0,0)}function Dme(){return mi(0,1,0,0)}function Lme(){return mi(0,0,1,0)}function Nme(){return mi(0,0,0,1)}const Qf=Pme(),Fh=Ime(),yDe=$me(),vDe=Dme(),_De=Lme(),bDe=Nme();Object.freeze(Object.defineProperty({__proto__:null,create:Ht,clone:ok,fromValues:mi,fromArray:DX,createView:Rme,zeros:Pme,ones:Ime,unitX:$me,unitY:Dme,unitZ:Lme,unitW:Nme,ZEROS:Qf,ONES:Fh,UNIT_X:yDe,UNIT_Y:vDe,UNIT_Z:_De,UNIT_W:bDe},Symbol.toStringTag,{value:"Module"}));class mu{constructor(t,i,r){this.itemByteSize=t,this.itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}get(){this._itemsPtr===0&&T2(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const i=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this.itemCreate(i,r*this.itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=wx){return new mu(16,Sme,t)}static createVec3f64(t=wx){return new mu(24,fW,t)}static createVec4f64(t=wx){return new mu(32,Rme,t)}static createMat3f64(t=wx){return new mu(72,wme,t)}static createMat4f64(t=wx){return new mu(128,_me,t)}static createQuatf64(t=wx){return new mu(32,xme,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const wx=4*j2.KILOBYTES,Nxt=mu.createVec2f64(),He=mu.createVec3f64(),LX=mu.createVec4f64();mu.createMat3f64();const NX=mu.createMat4f64(),Fxt=mu.createQuatf64();function Sm(e){return e?{origin:Bs(e.origin),vector:Bs(e.vector)}:{origin:R(),vector:R()}}function wDe(e,t){const i=TDe.get();return i.origin=e,i.vector=t,i}function kxt(e,t=Sm()){return xDe(e.origin,e.vector,t)}function xDe(e,t,i=Sm()){return le(i.origin,e),le(i.vector,t),i}function cw(e,t,i=Sm()){return le(i.origin,e),pe(i.vector,t,e),i}function FX(e,t){const i=pe(He.get(),t,e.origin),r=Te(e.vector,i),s=Te(e.vector,e.vector),n=De(r/s,0,1),o=pe(He.get(),ce(He.get(),e.vector,n),i);return Te(o,o)}function Uxt(e,t,i){return zG(e,t,0,1,i)}function zxt(e,t,i){return de(i,e.origin,ce(i,e.vector,t))}function zG(e,t,i,r,s){const{vector:n,origin:o}=e,a=pe(He.get(),t,o),l=Te(n,a)/Fa(n);return ce(s,n,De(l,i,r)),de(s,s,e.origin)}function Vxt(e,t){if(kme(e,wDe(t.origin,t.direction),!1,GF)){const{tA:i,pB:r,distance2:s}=GF;if(i>=0&&i<=1)return s;if(i<0)return Gs(e.origin,r);if(i>1)return Gs(de(He.get(),e.origin,e.vector),r)}return null}function Fme(e,t,i){return!!kme(e,t,!0,GF)&&(le(i,GF.pA),!0)}function kme(e,t,i,r){const n=e.origin,o=de(He.get(),n,e.vector),a=t.origin,l=de(He.get(),a,t.vector),c=He.get(),h=He.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=He.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],w=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*v-m*m;if(Math.abs(w)<1e-6)return!1;let b=(f*m-y*v)/w,S=(f+m*b)/v;i&&(b=De(b,0,1),S=De(S,0,1));const T=He.get(),E=He.get();return T[0]=n[0]+b*p[0],T[1]=n[1]+b*p[1],T[2]=n[2]+b*p[2],E[0]=a[0]+S*h[0],E[1]=a[1]+S*h[1],E[2]=a[2]+S*h[2],r.tA=b,r.tB=S,r.pA=T,r.pB=E,r.distance2=Gs(T,E),!0}const GF={tA:0,tB:0,pA:R(),pB:R(),distance2:0},TDe=new Ty(()=>({origin:null,vector:null}));function uo(e){return e?{origin:Bs(e.origin),direction:Bs(e.direction)}:{origin:R(),direction:R()}}function Bxt(e,t){return i_(e.origin,t.origin)&&i_(e.direction,t.direction)}function Uu(e,t){const i=MDe.get();return i.origin=e,i.direction=t,i}function jF(e,t=uo()){return Ume(e.origin,e.direction,t)}function SDe(e,t,i=uo()){return le(i.origin,e),pe(i.direction,t,e),i}function Ume(e,t,i=uo()){return le(i.origin,e),le(i.direction,t),i}function EDe(e,t){const i=ct(He.get(),we(He.get(),e.direction),pe(He.get(),t,e.origin));return Te(i,i)}function CDe(e,t,i){const r=Te(e.direction,pe(i,t,e.origin));return de(i,e.origin,ce(i,e.direction,r)),i}function ADe(){return{origin:null,direction:null}}const MDe=new Ty(ADe);function pO(e,t){return Te(e,t)/Oe(e)}function kX(e,t){const i=Te(e,t)/(Oe(e)*Oe(t));return-pn(i)}function ODe(e,t,i){we(mI,e),we(e6,t);const r=Te(mI,e6),s=pn(r),n=ct(mI,mI,e6);return Te(n,i)<0?2*Math.PI-s:s}const mI=R(),e6=R(),RDe=ge.getLogger("esri.geometry.support.sphere");function Cn(){return Ht()}function H2(e,t=Cn()){return np(t,e)}function zme(e,t){return mi(e[0],e[1],e[2],t)}function PDe(e){return e}function Vme(e){e[0]=e[1]=e[2]=e[3]=0}function ak(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function Wg(e){return e[3]}function IDe(e){return e}function Bme(e,t,i,r){return mi(e,t,i,r)}function $De(e,t,i){return e!==i&&le(i,e),i[3]=e[3]+t,i}function DDe(e,t,i){return RDe.error("sphere.setExtent is not yet supported"),e===i?i:H2(e,i)}function R_(e,t,i){if(M(t))return!1;const{origin:r,direction:s}=t,n=LDe;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const LDe=R();function VG(e,t){return R_(e,t,null)}function NDe(e,t,i){if(R_(e,t,i))return i;const r=QE(e,t,He.get());return de(i,t.origin,ce(He.get(),t.direction,hr(t.origin,r)/Oe(t.direction))),i}function QE(e,t,i){const r=He.get(),s=NX.get();ct(r,t.origin,t.direction);const n=Wg(e);ct(i,r,t.origin),ce(i,i,1/Oe(i)*n);const o=Hme(e,t.origin),a=kX(t.origin,i);return Fu(s,a+o,r),ke(i,i,s),i}function FDe(e,t,i){return R_(e,t,i)?i:(CDe(t,e,i),Gme(e,i,i))}function Gme(e,t,i){const r=pe(He.get(),t,e),s=ce(He.get(),r,e[3]/Oe(r));return de(i,s,e)}function jme(e,t){const i=pe(He.get(),t,e),r=Fa(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function Hme(e,t){const i=pe(He.get(),t,e),r=Oe(i),s=Wg(e),n=s+Math.abs(s-r);return pn(s/n)}const t6=R();function qme(e,t,i,r){const s=pe(t6,t,e);switch(i){case Mu.X:{const n=xK(s,t6)[2];return ne(r,-Math.sin(n),Math.cos(n),0)}case Mu.Y:{const n=xK(s,t6),o=n[1],a=n[2],l=Math.sin(o);return ne(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Mu.Z:return we(r,s);default:return}}function Wme(e,t){const i=pe(BG,t,e);return Oe(i)-e[3]}function kDe(e,t,i,r){const s=Wme(e,t),n=qme(e,t,Mu.Z,BG),o=ce(BG,n,i-s);return de(r,t,o)}function UDe(e,t){const i=Gs(e,t),r=Wg(e);return i<=r*r}const BG=R(),lk=Cn(),zDe=Object.freeze(Object.defineProperty({__proto__:null,create:Cn,copy:H2,fromCenterAndRadius:zme,wrap:PDe,clear:Vme,fromRadius:ak,getRadius:Wg,getCenter:IDe,fromValues:Bme,elevate:$De,setExtent:DDe,intersectRay:R_,intersectsRay:VG,intersectRayClosestSilhouette:NDe,closestPointOnSilhouette:QE,closestPoint:FDe,projectPoint:Gme,distanceToSilhouette:jme,angleToSilhouette:Hme,axisAt:qme,altitudeAt:Wme,setAltitudeAt:kDe,containsPoint:UDe,tmpSphere:lk},Symbol.toStringTag,{value:"Module"}));function Rw(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function VDe(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return ne(e,i,r,s),e}function Gxt(e,t,i){i=i||e;const r=Te(e,t);ne(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),we(i,i)}function jxt(e,t,i){Math.abs(e[0])>Math.abs(e[1])?ne(t,0,1,0):ne(t,1,0,0),ct(i,e,t),we(t,t),ct(t,i,e),we(i,i)}function BDe(e,t){return(e%t+t)%t}function gI(e,t,i,r,s,n){const o=e+(t-e)*s;return o+(i+(r-i)*s-o)*n}function GDe(e,t,i,r=R()){const s=Oe(e),n=Oe(t),o=Te(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return ce(zb,e,c),ce(Vb,t,h),de(r,zb,Vb)}return dn(r,e,t,i)}function Hxt(e,t,i,r=R(),s=R()){const n=Oe(e),o=Oe(t),a=Te(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,y=m/o*h;ce(zb,e,m/n*p),ce(Vb,t,y),de(r,zb,Vb)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+p*(-n+o));ce(zb,e,m);const y=1/o*(Math.cos(i*l)*l*f+h*(-n+o));ce(Vb,t,y),de(s,zb,Vb),ce(s,s,1/c)}return s}return dn(r,e,t,i),pe(s,t,e),we(s,s),s}function SL(e,t,i){e=we(zb,e),t=we(Vb,t);const r=pn(Te(e,t));if(i){const s=ct(jDe,e,t);if(Te(s,i)<0)return-r}return r}function EL(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],o=(n-i)/(n-s);return o*e[r-1][1]+(1-o)*e[r][1]}}function qxt(e,t,i,r){pe(Eee,t,e),pe(Cee,i,e),ct(r,Eee,Cee),we(r,r),r[3]=-Te(e,r)}const Eee=R(),Cee=R(),jDe=R(),zb=R(),Vb=R();function vi(e=lM){return[e[0],e[1],e[2],e[3]]}function HDe(e=lM[0],t=lM[1],i=lM[2],r=lM[3]){return UX(e,t,i,r,LX.get())}function ck(e,t){return UX(t[0],t[1],t[2],t[3],e)}function UX(e,t,i,r,s=vi()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Xme(e,t,i){return le(i,e),i[3]=t,i}function q2(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function na(e,t,i,r=vi()){const s=i[0]-t[0],n=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*y,r[1]=p*y,r[2]=f*y,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function Yme(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,MC);let n=r,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,xx),n++,o=!bl(MC,xx);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,Eb),n++,pe(yI,MC,xx),we(yI,yI),pe(vI,xx,Eb),we(vI,vI),o=!bl(MC,Eb)&&!bl(xx,Eb)&&Math.abs(Te(yI,vI))<qDe;return o?(na(MC,xx,Eb,t),!0):(i!==0||r!==1||s!==2)&&Yme(e,t,0,1,2)}const qDe=.99619469809,MC=R(),xx=R(),Eb=R(),yI=R(),vI=R();function GG(e,t,i){return t!==e&&ck(e,t),e[3]=-Te(e,i),e}function jG(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function fR(e,t,i,r){return ct(Eb,t,e),q2(i,Eb,r)}function Wxt(e,t,i,r){return uk(e,t,pe(He.get(),i,t),KDe,r)}function dx(e,t,i){return!!_(t)&&uk(e,t.origin,t.direction,eLe,i)}function WDe(e,t,i){return uk(e,t.origin,t.vector,Jf.NONE,i)}function XDe(e,t,i){return uk(e,t.origin,t.vector,Jf.CLAMP,i)}function Zme(e,t){return cr(e,t)>=0}function YDe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:o)+e[2]*(e[2]>0?s:a)+e[3]>=0}function ZDe(e,t){const i=Te(e,t.ray.direction),r=-cr(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function QDe(e,t){const i=Te(e,t.ray.direction),r=-cr(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function JDe(e,t,i){const r=ce(He.get(),e,-e[3]),s=HG(e,pe(He.get(),t,r),He.get());return de(i,s,r),i}function HG(e,t,i){const r=ce(He.get(),e,Te(e,t));return pe(i,t,r),i}function cr(e,t){return Te(e,t)+e[3]}function uk(e,t,i,r,s){const n=Te(e,i);if(n===0)return!1;let o=-(Te(e,t)+e[3])/n;return r&Jf.CLAMP&&(o=De(o,0,1)),!(!(r&Jf.INFINITE_MIN)&&o<0||!(r&Jf.INFINITE_MAX)&&o>1)&&(de(s,t,ce(s,i,o)),!0)}function Xxt(e){return e}const lM=[0,0,1,0];var Jf;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(Jf||(Jf={}));const KDe=Jf.INFINITE_MIN|Jf.INFINITE_MAX,eLe=Jf.INFINITE_MAX,i6=ge.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class Qme{constructor(){this.plane=vi(),this.origin=R(),this.basis1=R(),this.basis2=R()}}function P_(e=lge){return{plane:vi(e.plane),origin:Bs(e.origin),basis1:Bs(e.basis1),basis2:Bs(e.basis2)}}function tLe(e,t,i){const r=pLe.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=HDe(0,0,0,0),hk(r),r}function px(e,t=P_()){return zX(e.origin,e.basis1,e.basis2,t)}function iLe(e,t){le(t.origin,e.origin),le(t.basis1,e.basis1),le(t.basis2,e.basis2),ck(t.plane,e.plane)}function zX(e,t,i,r=P_()){return le(r.origin,e),le(r.basis1,t),le(r.basis2,i),hk(r),hLe(r,"fromValues()"),r}function hk(e){fR(e.basis2,e.basis1,e.origin,e.plane)}function Jme(e,t,i){e!==i&&px(e,i);const r=ce(He.get(),uy(e),t);return de(i.origin,i.origin,r),i.plane[3]-=t,i}function rLe(e,t,i){return Kme(t,i),Jme(i,jX(e,e.origin),i),i}function Kme(e,t=P_()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return ne(t.origin,e[0]+i,e[1]+r,0),ne(t.basis1,i,0,0),ne(t.basis2,0,r,0),UX(0,0,1,0,t.plane),t}function VX(e,t,i){return!!dx(e.plane,t,i)&&oge(e,i)}function sLe(e,t,i){if(VX(e,t,i))return i;const r=ege(e,t,He.get());return de(i,t.origin,ce(He.get(),t.direction,hr(t.origin,r)/Oe(t.direction))),i}function ege(e,t,i){const r=HF.get();age(e,t,r,HF.get());let s=Number.POSITIVE_INFINITY;for(const n of qX){const o=HX(e,n,dk.get()),a=He.get();if(WDe(r,o,a)){const l=wy(He.get(),t.origin,a),c=Math.abs(pn(Te(t.direction,l)));c<s&&(s=c,le(i,a))}}return s===Number.POSITIVE_INFINITY?tge(e,t,i):i}function tge(e,t,i){if(VX(e,t,i))return i;const r=HF.get(),s=HF.get();age(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of qX){const a=HX(e,o,dk.get()),l=He.get();if(XDe(r,a,l)){const c=EDe(t,l);if(!Zme(s,l))continue;c<n&&(n=c,le(i,l))}}return BX(e,t.origin)<n&&ige(e,t.origin,i),i}function ige(e,t,i){const r=JDe(e.plane,t,He.get()),s=zG(Aee(e,e.basis1),r,-1,1,He.get()),n=zG(Aee(e,e.basis2),r,-1,1,He.get());return pe(i,de(He.get(),s,n),e.origin),i}function rge(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=pe(He.get(),t,r),a=pO(s,o),l=pO(n,o),c=pO(uy(e),o);return ne(i,a,l,c)}function BX(e,t){const i=rge(e,t,He.get()),{basis1:r,basis2:s}=e,n=Oe(r),o=Oe(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function nLe(e,t){return Math.sqrt(BX(e,t))}function oLe(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of qX){const s=HX(e,r,dk.get()),n=FX(s,t);n>i&&(i=n)}return Math.sqrt(i)}function GX(e,t){return Zme(e.plane,t)&&oge(e,t)}function aLe(e,t,i,r){return uLe(e,i,r)}function jX(e,t){const i=-e.plane[3];return pO(uy(e),t)-i}function lLe(e,t,i,r){const s=jX(e,t),n=ce(dLe,uy(e),i-s);return de(r,t,n),r}function sge(e,t){return bl(e.basis1,t.basis1)&&bl(e.basis2,t.basis2)&&bl(e.origin,t.origin)}function nge(e,t,i){return e!==i&&px(e,i),vs(Tx,t),Pl(Tx,Tx),ke(i.basis1,e.basis1,Tx),ke(i.basis2,e.basis2,Tx),ke(i.plane,e.plane,Tx),ke(i.origin,e.origin,t),GG(i.plane,i.plane,i.origin),i}function cLe(e,t,i,r){return e!==r&&px(e,r),Fu(r6,t,i),ke(r.basis1,e.basis1,r6),ke(r.basis2,e.basis2,r6),hk(r),r}function uy(e){return e.plane}function uLe(e,t,i){switch(t){case Mu.X:le(i,e.basis1),we(i,i);break;case Mu.Y:le(i,e.basis2),we(i,i);break;case Mu.Z:le(i,uy(e))}return i}function oge(e,t){const i=pe(He.get(),t,e.origin),r=Fa(e.basis1),s=Fa(e.basis2),n=Te(e.basis1,i),o=Te(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function Aee(e,t){const i=dk.get();return le(i.origin,e.origin),le(i.vector,t),i}function HX(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=ce(He.get(),r,t.origin[0]),a=ce(He.get(),s,t.origin[1]);de(i.origin,o,a),de(i.origin,i.origin,n);const l=ce(He.get(),r,t.direction[0]),c=ce(He.get(),s,t.direction[1]);return ce(i.vector,de(l,l,c),2),i}function hLe(e,t){Math.abs(Te(e.basis1,e.basis2)/(Oe(e.basis1)*Oe(e.basis2)))>1e-6&&i6.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Te(e.basis1,uy(e)))>1e-6&&i6.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Te(uy(e),e.origin)-e.plane[3])>1e-6&&i6.warn(t,"Plane offset is not consistent with plane origin")}function age(e,t,i,r){const s=uy(e);fR(s,t.direction,t.origin,i),fR(i,s,t.origin,r)}const lge={plane:vi(),origin:Fe(0,0,0),basis1:Fe(1,0,0),basis2:Fe(0,1,0)},HF=new Ty(vi),dk=new Ty(Sm),dLe=R(),pLe=new Ty(()=>({origin:null,basis1:null,basis2:null,plane:null})),qX=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Tx=Ae(),r6=Ae(),fLe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Qme,create:P_,wrap:tLe,copy:px,copyWithoutVerify:iLe,fromValues:zX,updateUnboundedPlane:hk,elevate:Jme,setExtent:rLe,fromAABoundingRect:Kme,intersectRay:VX,intersectRayClosestSilhouette:sLe,closestPointOnSilhouette:ege,closestPoint:tge,projectPoint:ige,projectPointLocal:rge,distance2:BX,distance:nLe,distanceToSilhouette:oLe,extrusionContainsPoint:GX,axisAt:aLe,altitudeAt:jX,setAltitudeAt:lLe,equals:sge,transform:nge,rotate:cLe,normal:uy,UP:lge},Symbol.toStringTag,{value:"Module"}));function mLe(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function gLe(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function yLe(e){return{operations:e,value:e.create()}}function cge(e,t,i=yLe(e)){return i.operations=e,e.copy(t,i.value),i}function vLe(e){return cge(zDe,Bme(0,0,0,bi(e).radius))}const Mee=2**50;function _Le(){return cge(fLe,zX([0,0,0],[Mee,0,0],[0,Mee,0]))}function bLe(e,t,i){return e.operations.axisAt(e.value,t,Mu.Z,i)}function wLe(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function xLe(e,t,i){return e.operations.intersectRay(e.value,t,i)}function TLe(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function SLe(e,t){return e.operations.altitudeAt(e.value,t)}function uge(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function ELe(e,t,i,r){return t!==r&&Ts(r,t),ne(Sx,r[12],r[13],r[14]),uge(e,Sx,i,Sx),r[12]=Sx[0],r[13]=Sx[1],r[14]=Sx[2],r}function s6(e,t,i){return e.operations.elevate(e.value,t,i.value)}const Sx=R();function Oee(e,t,i,r,s){return s[0]=Te(e,t),s[1]=Te(e,i),s[2]=Te(e,r),s}function qG(e,t,i,r,s){le(i,e),le(_I,t),we(_I,_I),ct(r,_I,i),ct(s,r,i)}function hge(e,t){return e?hm(t):t.isGeographic?Ze.PlateCarree:t}const _I=R(),dge=96;function Yxt(e,t){const i=t||e.extent,r=e.width,s=Ic(i&&i.spatialReference);return i&&r?i.width/r*s*Dfe*dge:0}function pge(e,t){return e/(Ic(t)*Dfe*dge)}function fO(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function Ree(e){return(e==null?void 0:e.type)==="voxel"}function Pee(e){return(e==null?void 0:e.type)==="imagery-tile"}function fge(e){var t;return((t=e.parent)==null?void 0:t.declaredClass)==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function WX(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function Zxt(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function WG(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function CLe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}const ALe=ge.getLogger("esri.support.AnalysesCollection");let W2=class extends uO{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{M(t.item)||t.item.parent===this.owner&&(ALe.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};W2=u([P("esri.support.AnalysesCollection")],W2);const CL={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},n6={xsmall:544,small:768,medium:992,large:1200};function MLe(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function o6(e,t){return t?CL[e].valueToClassName[t].split(" "):[]}const OLe=e=>{let t=class extends e{constructor(...i){super(...i),this._breakpointsHandles=new jt,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=n6}initialize(){this._breakpointsHandles.add(se(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),At))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=lt(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=MLe(i);if(!r){const s=JSON.stringify(n6,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:n6,this._set("breakpoints",F({},i))}_updateClassNames(){if(!this.container)return;const i=cc.acquire(),r=cc.acquire();let s,n=!1;for(s in CL){const o=this[s],a=CL[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,o6(s,o).forEach(l=>r.push(l)),o6(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),cc.release(i),cc.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in CL)o6(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([P("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v2.10.0 - Tue Mar 15 2022 16:38:25 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var RLe="[object Object]";function PLe(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function ILe(e,t){return function(i){return e(t(i))}}var $Le=Function.prototype,mge=Object.prototype,gge=$Le.toString,DLe=mge.hasOwnProperty,LLe=gge.call(Object),NLe=mge.toString,FLe=ILe(Object.getPrototypeOf,Object);function kLe(e){return!!e&&typeof e=="object"}function ULe(e){if(!kLe(e)||NLe.call(e)!=RLe||PLe(e))return!1;var t=FLe(e);if(t===null)return!0;var i=DLe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&gge.call(i)==LLe}var zLe=ULe,Cb={exports:{}},Ws={},mR={exports:{}},fx={};function yge(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function VLe(e,t,i){}function BLe(e,t,i){}var GLe=/javascript\s*\:/img;function jLe(e,t){return GLe.test(t)?"":t}fx.whiteList=yge();fx.getDefaultWhiteList=yge;fx.onAttr=VLe;fx.onIgnoreAttr=BLe;fx.safeAttrValue=jLe;var HLe={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},OC=HLe;function qLe(e,t){e=OC.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=OC.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=OC.trim(h.slice(0,p)),m=OC.trim(h.slice(p+1));if(f){var y=t(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return OC.trim(o)}var WLe=qLe,bI=fx,XLe=WLe;function Iee(e){return e==null}function YLe(e){var t={};for(var i in e)t[i]=e[i];return t}function vge(e){e=YLe(e||{}),e.whiteList=e.whiteList||bI.whiteList,e.onAttr=e.onAttr||bI.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||bI.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||bI.safeAttrValue,this.options=e}vge.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=XLe(e,function(l,c,h,p,f){var m=r[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var v={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var w=s(h,p,v);return Iee(w)?h+":"+p:w}else{var w=n(h,p,v);if(!Iee(w))return w}}});return a};var ZLe=vge;(function(e,t){var i=fx,r=ZLe;function s(o,a){var l=new r(a);return l.process(o)}t=e.exports=s,t.FilterCSS=r;for(var n in i)t[n]=i[n]})(mR,mR.exports);var XX={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},QLe=mR.exports.FilterCSS,JLe=mR.exports.getDefaultWhiteList,qF=XX;function _ge(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var bge=new QLe;function KLe(e,t,i){}function eNe(e,t,i){}function tNe(e,t,i){}function iNe(e,t,i){}function wge(e){return e.replace(sNe,"&lt;").replace(nNe,"&gt;")}function rNe(e,t,i,r){if(i=Age(i),t==="href"||t==="src"){if(i=qF.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(wI.lastIndex=0,wI.test(i))return""}else if(t==="style"){if($ee.lastIndex=0,$ee.test(i)||(Dee.lastIndex=0,Dee.test(i)&&(wI.lastIndex=0,wI.test(i))))return"";r!==!1&&(r=r||bge,i=r.process(i))}return i=Mge(i),i}var sNe=/</g,nNe=/>/g,oNe=/"/g,aNe=/&quot;/g,lNe=/&#([a-zA-Z0-9]*);?/gim,cNe=/&colon;?/gim,uNe=/&newline;?/gim,wI=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,$ee=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Dee=/u\s*r\s*l\s*\(.*/gi;function xge(e){return e.replace(oNe,"&quot;")}function Tge(e){return e.replace(aNe,'"')}function Sge(e){return e.replace(lNe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function Ege(e){return e.replace(cNe,":").replace(uNe," ")}function Cge(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return qF.trim(t)}function Age(e){return e=Tge(e),e=Sge(e),e=Ege(e),e=Cge(e),e}function Mge(e){return e=xge(e),e=wge(e),e}function hNe(){return""}function dNe(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(o){return i?!0:qF.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return qF.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function pNe(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function fNe(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}Ws.whiteList=_ge();Ws.getDefaultWhiteList=_ge;Ws.onTag=KLe;Ws.onIgnoreTag=eNe;Ws.onTagAttr=tNe;Ws.onIgnoreTagAttr=iNe;Ws.safeAttrValue=rNe;Ws.escapeHtml=wge;Ws.escapeQuote=xge;Ws.unescapeQuote=Tge;Ws.escapeHtmlEntities=Sge;Ws.escapeDangerHtml5Entities=Ege;Ws.clearNonPrintableCharacter=Cge;Ws.friendlyAttrValue=Age;Ws.escapeAttrValue=Mge;Ws.onIgnoreTagStripAll=hNe;Ws.StripTagBody=dNe;Ws.stripCommentTag=pNe;Ws.stripBlankChar=fNe;Ws.cssFilter=bge;Ws.getDefaultCSSWhiteList=JLe;var pk={},rv=XX;function mNe(e){var t=rv.spaceIndex(e);if(t===-1)var i=e.slice(1,-1);else var i=e.slice(1,t+1);return i=rv.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function gNe(e){return e.slice(0,2)==="</"}function yNe(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){r+=i(e.slice(s,a)),n=a,s=a;continue}if(p===">"){r+=i(e.slice(s,n)),h=e.slice(n,a+1),c=mNe(h),r+=t(n,r.length,c,h,gNe(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=e.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var vNe=/[^a-zA-Z0-9_:\.\-]/gim;function _Ne(e,t){var i=0,r=[],s=!1,n=e.length;function o(p,f){if(p=rv.trim(p),p=p.replace(vNe,"").toLowerCase(),!(p.length<1)){var m=t(p,f||"");m&&r.push(m)}}for(var a=0;a<n;a++){var l=e.charAt(a),c,h;if(s===!1&&l==="="){s=e.slice(i,a),i=a+1;continue}if(s!==!1&&a===i&&(l==='"'||l==="'")&&e.charAt(a-1)==="="){if(h=e.indexOf(l,a+1),h===-1)break;c=rv.trim(e.slice(i+1,h)),o(s,c),s=!1,a=h,i=a+1;continue}if(/\s|\n|\t/.test(l))if(e=e.replace(/\s|\n|\t/g," "),s===!1)if(h=bNe(e,a),h===-1){c=rv.trim(e.slice(i,a)),o(c),s=!1,i=a+1;continue}else{a=h-1;continue}else if(h=wNe(e,a-1),h===-1){c=rv.trim(e.slice(i,a)),c=Lee(c),o(s,c),s=!1,i=a+1;continue}else continue}return i<e.length&&(s===!1?o(e.slice(i)):o(s,Lee(rv.trim(e.slice(i))))),rv.trim(r.join(" "))}function bNe(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function wNe(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function xNe(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function Lee(e){return xNe(e)?e.substr(1,e.length-2):e}pk.parseTag=yNe;pk.parseAttr=_Ne;var TNe=mR.exports.FilterCSS,Gd=Ws,Oge=pk,SNe=Oge.parseTag,ENe=Oge.parseAttr,AL=XX;function xI(e){return e==null}function CNe(e){var t=AL.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=AL.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=AL.trim(e.slice(0,-1))),{html:e,closing:i}}function ANe(e){var t={};for(var i in e)t[i]=e[i];return t}function Rge(e){e=ANe(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Gd.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||Gd.whiteList,e.onTag=e.onTag||Gd.onTag,e.onTagAttr=e.onTagAttr||Gd.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Gd.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Gd.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Gd.safeAttrValue,e.escapeHtml=e.escapeHtml||Gd.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new TNe(e.css))}Rge.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=t.cssFilter;i.stripBlankChar&&(e=Gd.stripBlankChar(e)),i.allowCommentTag||(e=Gd.stripCommentTag(e));var p=!1;if(i.stripIgnoreTagBody){var p=Gd.StripTagBody(i.stripIgnoreTagBody,n);n=p.onIgnoreTag}var f=SNe(e,function(m,y,v,w,b){var S={sourcePosition:m,position:y,isClosing:b,isWhite:r.hasOwnProperty(v)},T=s(v,w,S);if(!xI(T))return T;if(S.isWhite){if(S.isClosing)return"</"+v+">";var E=CNe(w),C=r[v],A=ENe(E.html,function(L,D){var U=AL.indexOf(C,L)!==-1,z=o(v,L,D,U);if(!xI(z))return z;if(U)return D=l(v,L,D,h),D?L+'="'+D+'"':L;var z=a(v,L,D,U);return xI(z)?void 0:z}),w="<"+v;return A&&(w+=" "+A),E.closing&&(w+=" /"),w+=">",w}else{var T=n(v,w,S);return xI(T)?c(w):T}},c);return p&&(f=p.remove(f)),f};var MNe=Rge;(function(e,t){var i=Ws,r=pk,s=MNe;function n(l,c){var h=new s(c);return h.process(l)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s;for(var o in i)t[o]=i[o];for(var o in r)t[o]=r[o];function a(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=e.exports)})(Cb,Cb.exports);var ONe=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):Cb.exports.safeAttrValue(n,o,a,l)}};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new Cb.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t,i){var r=(i!=null?i:{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?Cb.exports.escapeAttrValue(t):!n&&!s?Cb.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):Cb.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(zLe(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof t=="undefined"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const fk=new Map;function Pge(){fk.clear()}function RNe(e){return fk.get(e)}function PNe(e,t){fk.set(e,t)}function a6(e){fk.delete(e)}var Pw,X2,INe=function(e){if("WebkitTransition"in e.style)Pw="webkitTransitionEnd",X2="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");Pw="transitionend",X2="animationend"}},Ige=function(e){Pw||INe(e)},$Ne=function(e,t){return t===void 0&&(t=e+"-active"),function(i){Ige(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(Pw,s),i.removeEventListener(X2,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(Pw,s),i.addEventListener(X2,s),requestAnimationFrame(function(){i.classList.add(t)})}},DNe=function(e,t){return t===void 0&&(t=e+"-active"),function(i,r){Ige(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(Pw,n),i.removeEventListener(X2,n),r())};i.classList.add(e),i.addEventListener(Pw,n),i.addEventListener(X2,n),requestAnimationFrame(function(){i.classList.add(t)})}};const LNe=ge.getLogger("esri.widgets.support.widgetUtils");function YX(e){const t=cc.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const i=t.join(" ");return cc.release(t),i}const NNe=(()=>{const e=new Map,t=new ResizeObserver(i=>{Pge();for(const r of i)e.get(r.target)(r)});return(i,r,s)=>(e.has(i)&&LNe.error("Already observing element",i),e.set(i,r),t.observe(i,s),Yh(()=>{t.unobserve(i),e.delete(i)}))})();function Hf(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function FNe(e){return Hf(e)?"rtl":"ltr"}function Nee(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function Bb(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function kNe(e,t){return(e==="enter"?$Ne:DNe)(t)}const UNe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],zNe=UNe.reduce((e,t)=>(e[t]=[],e),{}),VNe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],$ge=new ONe({whiteList:zNe,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(VNe.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function cM(e){return e==="Enter"||e===" "}const Dge="http://www.w3.org/",mk=`${Dge}2000/svg`,Lge=`${Dge}1999/xlink`;let WF,Fee=[],ZX=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},QX=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Nge=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},BNe=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if(QX(e[r],t))return r}return-1},l6=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n?n.key===void 0?n.bind:n.key:void 0)){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(QX(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},GNe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},XG=[],YG=!1,Fge=e=>{(e.children||[]).forEach(Fge),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},kee=()=>{YG=!1,XG.forEach(Fge),XG.length=0},Uee=e=>{XG.push(e),YG||(YG=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(kee,{timeout:16}):setTimeout(kee,16))},zee=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),Uee(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),Uee(e))},jNe=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")ZG(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(Nge(m),i.styleApplyer(e,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):i.namespace===mk?a==="href"?e.setAttributeNS(Lge,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=$ge.sanitize(l):e.setAttribute(a,l):e[a]=l}}},HNe=(e,t,i)=>{if(t)for(let r of t)CS(r,e,void 0,i)},kge=(e,t,i)=>{HNe(e,t.children,i),t.text&&(e.textContent=t.text),jNe(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},CS=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(r=ZX(r,{namespace:mk})),r.namespace!==void 0?s=e.domNode=a.createElementNS(r.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=l+1}}kge(s,e,r)}},ZG=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},qNe=(e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=t[l];if(l==="class")h!==c&&(ZG(e,h,!1),ZG(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let v=f[y],w=!!c[v];w!==!!h[v]&&(s=!0,w?p.add(v):p.remove(v))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],v=c[y];v!==h[y]&&(s=!0,v?(Nge(v),r.styleApplyer(e,y,v)):r.styleApplyer(e,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===mk?l==="href"?e.setAttributeNS(Lge,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=$ge.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},WNe=(e,t,i,r,s)=>{if(i===r)return!1;r=r||Fee;let n,o=(i=i||Fee).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&QX(p,f))h=WF(p,f,s)||h,l++;else{let m=BNe(i,f,l+1);if(m>=0){for(n=l;n<m;n++)zee(i[n]),l6(i,n,e,"removed");h=WF(i[m],f,s)||h,l=m+1}else CS(f,t,l<o?i[l].domNode:void 0,s),GNe(f),l6(r,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)zee(i[n]),l6(i,n,e,"removed");return h};WF=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(o,r),t.domNode=o,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=ZX(i,{namespace:mk})),e.text!==t.text&&(n=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=WNe(t,r,e.children,t.children,i)||n,n=qNe(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let RC=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,WF(r,i,t)},domNode:e.domNode});const XNe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let RT=e=>ZX(XNe,e),Dv={create:(e,t)=>(t=RT(t),CS(e,document.createElement("div"),void 0,t),RC(e,t)),append:(e,t,i)=>(i=RT(i),CS(t,e,void 0,i),RC(t,i)),insertBefore:(e,t,i)=>(i=RT(i),CS(t,e.parentNode,e,i),RC(t,i)),merge:(e,t,i)=>(i=RT(i),t.domNode=e,kge(e,t,i),RC(t,i)),replace:(e,t,i)=>(i=RT(i),CS(t,e.parentNode,e,i),e.parentNode.removeChild(e),RC(t,i))},Uge,YNe=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};Uge=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let ZNe=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?Uge(i.children,s=>s.domNode===r):void 0}),i},QNe=(e,t,i)=>{let r=function(s){i("domEvent",s);let n=t(),o=YNe(s.currentTarget,n.domNode);o.reverse();let a,l=ZNe(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},QG=e=>{let t,i,r=RT(e),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,v=()=>y;r.eventHandlerInterceptor=QNe(t,v,s),y=p(f,m(),r),a.push(y),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(Dv.append,p,f)},insertBefore:(p,f)=>{c(Dv.insertBefore,p,f)},merge:(p,f)=>{c(Dv.merge,p,f)},replace:(p,f)=>{c(Dv.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t},P0=class extends Se{constructor(){super(...arguments),this.items=new it,this._watchUpdatingTracking=new Zf,this._callbacks=new Map,this._projector=QG(),this._hiddenProjector=QG()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(const i of t.removed){const r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const o=r.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(i=>{t.save(),i.renderCanvas(t),t.restore()}),t.restore()}};u([d({readOnly:!0})],P0.prototype,"surface",void 0),u([d({readOnly:!0})],P0.prototype,"items",void 0),u([d({readOnly:!0})],P0.prototype,"needsRender",null),u([d({readOnly:!0})],P0.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],P0.prototype,"updating",void 0),P0=u([P("esri.views.overlay.ViewOverlay")],P0);const Vee=P0;function JX(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t!=null?t:null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function qe(e,t){const i=t?me(F({},t),{source:e}):e;return d({aliasOf:i})}const JNe="randomUUID"in crypto;function zge(){if(JNe)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const KNe={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},eFe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},tFe=e=>F(F({},eFe),e),iFe=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},rFe=(e,t)=>e.find(t),Bee=(e,t,i=!1)=>{let r=e;return t.forEach((s,n)=>{const o=(r==null?void 0:r.children)?rFe(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==t.length-1||(r=o)}),r},sFe=e=>{let t;const i=F(F({},KNe),e),r=tFe(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{var b;let v;r.eventHandlerInterceptor=(S,T,E,C)=>function(A){let I;s("domEvent",A);const L=iFe(A.currentTarget,v.domNode),D=L.some(z=>{var V;return customElements.get((V=z==null?void 0:z.tagName)==null?void 0:V.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!D)L.reverse(),I=Bee(v.getLastRender(),L);else{const z=A.composedPath(),V=z.slice(z.indexOf(A.currentTarget),z.indexOf(v.domNode)).filter(X=>X.getRootNode()===X.ownerDocument).reverse();I=Bee(v.getLastRender(),V,!0)}let U;return I&&(U=i.handleInterceptedEvent(t,I,this,A)),s("domEventProcessed",A),U},(b=i.postProcessProjectionOptions)==null||b.call(i,r);const w=y();v=f(m,w,r),l.push(v),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(v,w)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,m)=>{h(Dv.append,f,m)},insertBefore:(f,m)=>{h(Dv.insertBefore,f,m)},merge:(f,m)=>{h(Dv.merge,f,m)},replace:(f,m)=>{h(Dv.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},Mi={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let PT,Vge,gk,Bge=!1,XF=!1,KX=!1,nu=!1,Gee=null,JG=!1;const JE=typeof window!="undefined"?window:{};Mi.cssVarShim&&JE.CSS;const mp=JE.document||{head:{}},Qxt=JE.HTMLElement||class{},da={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},YF=Mi.shadowDomShim&&Mi.shadowDom?(()=>(mp.head.attachShadow+"").indexOf("[native")>-1)():!0,nFe=(()=>{let e=!1;try{mp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),oFe=e=>Promise.resolve(e),aFe=Mi.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,Gge=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=cFe(e,s),l=lFe(t,o),c=uFe(s);da.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>da.rel(a,n,l,c))})},lFe=(e,t)=>i=>{try{Mi.lazyLoad||e.$hostElement$[t](i)}catch(r){jP(r)}},cFe=(e,t)=>t&4?mp:t&8?JE:t&16?mp.body:e,uFe=e=>nFe?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,jee="http://www.w3.org/1999/xlink",Iw=(e,t="")=>()=>{},Hee=new WeakMap,hFe=(e,t,i)=>{let r=JF.get(e);aFe&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,JF.set(e,r)},dFe=(e,t,i,r)=>{let s=jge(t,i),n=JF.get(s);if(e=e.nodeType===11?e:mp,n)if(typeof n=="string"){e=e.head||e;let o=Hee.get(e),a;o||Hee.set(e,o=new Set),o.has(s)||(a=mp.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},pFe=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=Iw("attachStyles",t.$tagName$),n=dFe(YF&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},jge=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),fFe=e=>jFe.map(t=>t(e)).find(t=>!!t),qee={},mFe="http://www.w3.org/2000/svg",gFe="http://www.w3.org/1999/xhtml",yFe=e=>e!=null,eY=e=>(e=typeof e,e==="object"||e==="function"),Hge=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!eY(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?ZF(null,r):r),a=o)};if(c(i),t&&(Mi.isDev&&e==="input"&&wFe(t),Mi.vdomKey&&t.key&&(s=t.key),Mi.slotRelocation&&t.name&&(n=t.name),Mi.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(Mi.isDev&&l.some(qge)&&GFe(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Mi.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,_Fe);const h=ZF(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),Mi.vdomKey&&(h.$key$=s),Mi.slotRelocation&&(h.$name$=n),h},ZF=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Mi.vdomAttribute&&(i.$attrs$=null),Mi.vdomKey&&(i.$key$=null),Mi.slotRelocation&&(i.$name$=null),i},vFe={},qge=e=>e&&e.$tag$===vFe,_Fe={forEach:(e,t)=>e.map(Wee).forEach(t),map:(e,t)=>e.map(Wee).map(t).map(bFe)},Wee=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),bFe=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),Hge(e.vtag,i,...e.vchildren||[])}const t=ZF(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},wFe=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&iye('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},Xee=(e,t,i,r,s,n)=>{if(i!==r){let o=Jee(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=Yee(i),h=Yee(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Jee(JE,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&da.rel(e,t,i,!1),r&&da.ael(e,t,r,!1);else{const l=eY(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(jee,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(jee,t,r):e.setAttribute(t,r))}}},xFe=/\s/,Yee=e=>e?e.split(xFe):[],Wge=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||qee,o=t.$attrs$||qee;for(r in n)r in o||Xee(s,r,n[r],void 0,i,t.$flags$);for(r in o)Xee(s,r,n[r],o[r],i,t.$flags$)},QF=(e,t,i,r)=>{let s=t.$children$[i],n=0,o,a,l;if(Bge||(KX=!0,s.$tag$==="slot"&&(PT&&r.classList.add(PT+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=mp.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=mp.createTextNode("");else{if(nu||(nu=s.$tag$==="svg"),o=s.$elm$=mp.createElementNS(nu?mFe:gFe,s.$flags$&2?"slot-fb":s.$tag$),nu&&s.$tag$==="foreignObject"&&(nu=!1),Wge(null,s,nu),yFe(PT)&&o["s-si"]!==PT&&o.classList.add(o["s-si"]=PT),s.$children$)for(n=0;n<s.$children$.length;++n)a=QF(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?nu=!1:o.tagName==="foreignObject"&&(nu=!0)}return o["s-hn"]=gk,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=Vge,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&gR(e.$elm$,!1)),o},gR=(e,t)=>{da.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==gk&&s["s-ol"]&&(Zge(s).insertBefore(s,tY(s)),s["s-ol"].remove(),s["s-ol"]=void 0,KX=!0),t&&gR(s,t)}da.$flags$&=-2},Xge=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===gk&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=QF(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,tY(t))))},Yge=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,Kge(r),XF=!0,s["s-ol"]?s["s-ol"].remove():gR(s,!0),s.remove())},TFe=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],m=r[p],y,v;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(TI(c,f))IT(c,f),c=t[++s],f=r[++n];else if(TI(h,m))IT(h,m),h=t[--l],m=r[--p];else if(TI(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&gR(c.$elm$.parentNode,!1),IT(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=r[--p];else if(TI(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&gR(h.$elm$.parentNode,!1),IT(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(v=t[o],v.$tag$!==f.$tag$?y=QF(t&&t[n],i,o,e):(IT(v,f),t[o]=void 0,y=v.$elm$),f=r[++n]):(y=QF(t&&t[n],i,n,e),f=r[++n]),y&&Zge(c.$elm$).insertBefore(y,tY(c.$elm$))}s>l?Xge(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&Yge(t,s,l)},TI=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,tY=e=>e&&e["s-ol"]||e,Zge=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,IT=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(nu=n==="svg"?!0:n==="foreignObject"?!1:nu,n==="slot"||Wge(e,t,nu),r!==null&&s!==null?TFe(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),Xge(i,null,t,s,0,s.length-1)):r!==null&&Yge(r,0,r.length-1),nu&&n==="svg"&&(nu=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},Qge=e=>{let t=e.childNodes,i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}Qge(i)}},Xd=[],Jge=e=>{let t,i,r,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&(Zee(i,s)?(n=Xd.find(h=>h.$nodeToRelocate$===i),XF=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:Xd.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&Xd.map(h=>{Zee(h.$nodeToRelocate$,i["s-sn"])&&(n=Xd.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Xd.some(h=>h.$nodeToRelocate$===i)||Xd.push({$nodeToRelocate$:i}));t.nodeType===1&&Jge(t)}},Zee=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Kge=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Kge)},SFe=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||ZF(null,null),n=qge(t)?t:Hge(null,null,t);gk=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,PT=i["s-sc"],Vge=i["s-cr"],Bge=YF&&(r.$flags$&1)!==0,XF=!1,IT(s,n);{if(da.$flags$|=1,KX){Jge(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Xd.length;f++)o=Xd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=mp.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Xd.length;f++)if(o=Xd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}XF&&Qge(n.$elm$),da.$flags$&=-2,Xd.length=0}},EFe=e=>Mi.lazyLoad?KE(e).$hostElement$:e,Jxt=(e,t,i)=>{const r=EFe(e);return{emit:s=>(Mi.isDev&&!r.isConnected&&iye(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),CFe(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s}))}},CFe=(e,t,i)=>{const r=da.ce(t,i);return e.dispatchEvent(r),r},AFe=(e,t)=>{},iY=(e,t)=>(e.$flags$|=16,AFe(e,e.$ancestorComponent$),WFe(()=>MFe(e,t))),MFe=(e,t)=>{const i=e.$hostElement$,r=Iw("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=i2(s,"componentWillLoad"):n=i2(s,"componentWillUpdate"),n=Qee(n,()=>i2(s,"componentWillRender")),r(),Qee(n,()=>OFe(e,s,t))},OFe=async(e,t,i)=>{const r=e.$hostElement$,s=Iw("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&pFe(e);const n=Iw("render",e.$cmpMeta$.$tagName$);RFe(e,t,r),n(),s(),PFe(e)},RFe=(e,t,i)=>{try{Gee=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Mi.hasRenderFn||Mi.reflect)&&(Mi.vdomRender||Mi.reflect)&&(Mi.hydrateServerSide||SFe(e,t))}catch(a){jP(a,e.$hostElement$)}return Gee=null,null},PFe=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=Iw("postUpdate",t),s=i;e.$ancestorComponent$,i2(s,"componentDidRender"),e.$flags$&64?(i2(s,"componentDidUpdate"),r()):(e.$flags$|=64,i2(s,"componentDidLoad"),r())},Kxt=e=>{if(Mi.updatable){const t=KE(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&iY(t,!1),i}return!1},i2=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){jP(r)}},Qee=(e,t)=>e&&e.then?e.then(t):t(),IFe=(e,t)=>e!=null&&!eY(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,$Fe=(e,t)=>KE(e).$instanceValues$.get(t),DFe=(e,t,i,r)=>{const s=KE(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=IFe(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(f=>{try{l[f](i,o,t)}catch(m){jP(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;iY(s,!1)}}}},LFe=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return $Fe(this,n)},set(a){DFe(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){da.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},NFe=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=fFe(e)]);const a=jge(i,t.$modeName$);if(!JF.has(a)){const l=Iw("registerStyles",i.$tagName$);hFe(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>iY(t,!0))()},FFe=e=>{},kFe=e=>{if((da.$flags$&1)===0){const t=KE(e),i=t.$cmpMeta$,r=Iw("connectedCallback",i.$tagName$);t.$flags$&1?(Gge(e,t,i.$listeners$),FFe(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&UFe(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),NFe(e,t,i)),r()}},UFe=e=>{const t=e["s-cr"]=mp.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},zFe=e=>{if((da.$flags$&1)===0){const t=KE(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},eTt=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};Mi.member&&(i.$members$=t[2]),Mi.hostListener&&(i.$listeners$=t[3]),Mi.watchCallback&&(i.$watchers$=e.$watchers$),Mi.reflect&&(i.$attrsToReflect$=[]),Mi.shadowDom&&!YF&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){BFe(this,i)},connectedCallback(){kFe(this),Mi.connectedCallback&&r&&r.call(this)},disconnectedCallback(){zFe(this),Mi.disconnectedCallback&&s&&s.call(this)},__attachShadow(){YF?Mi.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,LFe(e,i)},tTt=e=>{const t=new URL(e,da.$resourcesUrl$);return t.origin!==JE.location.origin?t.href:t.pathname},VFe=e=>da.$resourcesUrl$=e,eye=new WeakMap,KE=e=>eye.get(e),BFe=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Mi.isDev&&(i.$renderCount$=0),Mi.method&&Mi.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),Mi.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),Gge(e,i,t.$listeners$),eye.set(e,i)},Jee=(e,t)=>t in e,jP=(e,t)=>(0,console.error)(e,t),tye=Mi.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],GFe=(...e)=>console.error(...tye,...e),iye=(...e)=>console.warn(...tye,...e),JF=new Map,jFe=[],Kee=[],rye=[],HFe=(e,t)=>i=>{e.push(i),JG||(JG=!0,t&&da.$flags$&4?qFe(KG):da.raf(KG))},ete=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){jP(i)}e.length=0},KG=()=>{ete(Kee),ete(rye),(JG=Kee.length>0)&&da.raf(KG)},qFe=e=>oFe().then(e),WFe=HFe(rye,!0),iTt={isDev:!!Mi.isDev,isBrowser:!0,isServer:!1,isTesting:!!Mi.isTesting};let sye;function XFe(){VFe(zh(Li(sye)))}sye="components/assets";const nye=Symbol("widget"),YFe=[],ZFe={},KF=new WeakMap;function oye(e,t){let i=t.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=oye(e,i[s]);else i=YFe;const r=t.vnodeSelector;if(rY(r)){const s=t.properties||ZFe,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:QFe,afterUpdate:JFe,afterRemoved:aye,parentWidget:e,widgetConstructor:r,widgetProperties:me(F({},s),{key:n,children:i})},children:void 0,text:void 0,domNode:null}}return t}function QFe(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,KF.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),r._internalHandles.add(Yh(()=>aye(e)))}function JFe(e,t,i,{widgetProperties:r}){var n;const s=KF.get(e);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,e))}function aye(e){const t=KF.get(e);t&&(t.destroy(),KF.delete(e))}function rY(e){return typeof e=="function"&&e[nye]}const tte=new Set;function KFe(e){tte.add(e),e.finally(()=>tte.delete(e))}const lye="esri.widgets.Widget",e4e=ge.getLogger(lye);let t4e=0;const i4e={widgetIcon:"esri-icon-checkbox-unchecked"};function cye(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?cye(e[i],t[i]):e[i]=t[i]);return e}const r4e=sFe({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,n,o)=>{const a=t(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(Pge(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let c6=!1,Pn=class extends UP(as.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new jt,this._projector=r4e,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=i4e.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=aW(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await Sn(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await Ofe(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=cye(ie(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&e4e.error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),XFe();const i="esri-widget-uid-"+zge(),r=this.render.bind(this);this._trackingTarget=new $5(()=>this.scheduleRender());const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const n=r();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=i),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(h=n.children)==null||h.forEach(p=>{if(rY(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),oye(this,n)};this.render=()=>{if(c6)return s();let n=RNe(this);if(n)return n;this._trackingTarget.clear(),c6=!0;try{n=ny(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{c6=!1}return PNe(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),KFe(this._resourcesFetch)}normalizeCtorArgs(e,t){const i=F({},e);return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(L8)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(lt(this._trackingTarget),lt(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,a6(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return BP(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+t4e++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(a6(this),this._projector.scheduleRender())}classes(...e){return YX.apply(this,e)}renderNow(){a6(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),((t=this._delegatedEventNames)==null?void 0:t.length)&&this._internalHandles.add(se(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&R5(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>BE(i,s,n=>{this.emit(s,n)})),"delegated-events")},At)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(L8),this.scheduleRender()};this._internalHandles.add([FRe(e),se(()=>this.uiStrings,e),vo(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};Pn[nye]=!0,u([d()],Pn.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Pn.prototype,"container",null),u([Rt("container")],Pn.prototype,"castContainer",null),u([d({aliasOf:"container"})],Pn.prototype,"domNode",void 0),u([d()],Pn.prototype,"iconClass",void 0),u([d()],Pn.prototype,"id",null),u([d()],Pn.prototype,"label",void 0),u([d()],Pn.prototype,"renderable",null),u([d()],Pn.prototype,"uiStrings",void 0),u([d()],Pn.prototype,"viewModel",void 0),u([d()],Pn.prototype,"visible",void 0),u([d()],Pn.prototype,"key",void 0),u([d()],Pn.prototype,"children",void 0),u([d()],Pn.prototype,"afterCreate",void 0),u([d()],Pn.prototype,"afterUpdate",void 0),u([d()],Pn.prototype,"afterRemoved",void 0),Pn=u([P(lye)],Pn);const Xs=Pn;function s4e(e,t,i){return e.units[t][i]}function yk(e,t,i,r=2,s="abbr"){return`${om(t,{minimumFractionDigits:r,maximumFractionDigits:r})} ${s4e(e,i,s)}`}function rTt(e,t,i,r=2,s="abbr"){const n=i$e(t,i);return yk(e,sn(t,i,n),n,r,s)}function sTt(e,t,i,r=2,s="abbr"){const n=r$e(t,i);return yk(e,sn(t,i,n),n,r,s)}function nTt(e,t,i,r=2,s="abbr"){const n=s$e(t,i);return yk(e,sn(t,i,n),n,r,s)}function oTt(e,t,i,r=2,s="abbr"){const n=n$e(t,i);return yk(e,sn(t,i,n),n,r,s)}const ite=["B","kB","MB","GB","TB"];function n4e(e,t){let i=t===0?0:Math.floor(Math.log(t)/Math.log(j2.KILOBYTES));i=De(i,0,ite.length-1);const r=om(t/j2.KILOBYTES**i,{maximumFractionDigits:2});return rm(e.units.bytes[ite[i]],{fileSize:r})}function o4e(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find(n=>n.name===i);return s?a4e({tagName:r,tags:s.tags}):null}function a4e(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find(s=>s.name===t);return r&&r.value||null}var e7;const l4e={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let ql=e7=class extends ve{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=o4e({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return l4e[t]||null}clone(){return new e7({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],ql.prototype,"contentType",void 0),u([d()],ql.prototype,"exifInfo",void 0),u([d({readOnly:!0})],ql.prototype,"orientationInfo",null),u([d({type:Sr})],ql.prototype,"id",void 0),u([d({type:String})],ql.prototype,"globalId",void 0),u([d({type:String})],ql.prototype,"keywords",void 0),u([d({type:String})],ql.prototype,"name",void 0),u([d({json:{read:!1}})],ql.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],ql.prototype,"parentObjectId",void 0),u([d({type:Sr})],ql.prototype,"size",void 0),u([d({json:{read:!1}})],ql.prototype,"url",void 0),ql=e7=u([P("esri.layers.support.AttachmentInfo")],ql);const c4e=ql;var t7;let Oo=t7=class extends ve{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new t7(ie({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Oo.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Oo.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Oo.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Oo.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Oo.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Oo.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Oo.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Oo.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Oo.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Oo.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Oo.prototype,"start",void 0),u([Be("start"),Be("num")],Oo.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Oo.prototype,"where",void 0),Oo=t7=u([P("esri.rest.support.AttachmentQuery")],Oo),Oo.from=ns(Oo);const i7=Oo,u4e="esri.widgets.Feature.support.featureUtils",rte=ge.getLogger(u4e),h4e=/href=(""|'')/gi,d4e=/(\{([^\{\r\n]+)\})/g,p4e=/\'/g,uye=/^\s*expression\//i,f4e=/(\n)/gi,m4e=/[\u00A0-\u9999<>\&]/gim,g4e=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,y4e=/^(?:mailto:|tel:)/,hye="relationships/",r7=U5("short-date-short-time");function dye(e){if(!M(e))return e.get("sourceLayer")||e.get("layer")}async function e4(e,t){return typeof e=="function"?e.call(null,t):e}function pye(e=""){if(e)return!y4e.test(e.trim().toLowerCase())}function fye(e){return!!e&&uye.test(e)}function v4e(e,t){if(!fye(t)||!e)return null;const i=t.replace(uye,"").toLowerCase();let r;return e.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function mye(e,t){const i=v4e(t,e==null?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function _4e(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}function b4e(e){return e.replace(h4e,"")}function t4(e,t){const i=sY(t,e);return i?i.name:e}function w4e(e,t){return e&&e.map(i=>t4(i,t))}function sY(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function gye(e){return`${e}`.trim()}function Gb({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?s7({formattedAttributes:t,template:E4e(r,F(F(F({},t),s),e),i),fieldInfoMap:n}):""}function s7({formattedAttributes:e,template:t,fieldInfoMap:i}){return gye(b4e(rm(rm(t,r=>_4e(r,i)),e)))}function x4e(e,t,i=!1){const r=t[e];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(p4e,s);t[e]=n}}function T4e(e,t=!1){const i=F({},e);return Object.keys(i).forEach(r=>x4e(r,i,t)),i}function S4e(e,t,i){const r=(t=gye(t))&&t[0]!=="{";return rm(e,T4e(i,r))}function n7(e,t){return e.replace(d4e,(i,r,s)=>{const n=sY(t,s);return n?`{${n.name}}`:r})}function E4e(e,t,i){const r=n7(e,i);return r&&r.replace(g4e,(s,n,o)=>S4e(s,n||o,t))}function C4e(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const i=Number(e);if(!isNaN(i))return i}return e}function A4e(e){return(e==null?void 0:e.type)==="feature"}function ste(e){return!!(e==null?void 0:e.layer)}function M4e(e){return(e==null?void 0:e.type)==="map-image"}function O4e(e,t){var c;const i=t.fieldInfos,r=t.fieldName,s=(c=yye(i,r))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=sY(o,r);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new TS;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!ste(o)&&A4e(o)&&o.datesInUnknownTimezone||ste(o)&&M4e(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof e=="string"&&Jde(r)&&l?l.formatRasterPixelValue(e):typeof(e=C4e(e,l))=="string"||e==null||l==null?HP(e):n?om(e,me(F({},spe(l)),{minimumFractionDigits:0,maximumFractionDigits:20})):l.format(e)}function yye(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function R4e({fieldName:e,graphic:t,layer:i}){if(Ug(e)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}function P4e({fieldName:e,value:t,graphic:i,layer:r}){if(Ug(e)||!r||typeof r.getFieldDomain!="function")return null;const s=r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function I4e(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:Ls(o,r7),user:l}}const a=t[r];if(typeof a=="number"){const l=t[i];return{type:"create",date:Ls(a,r7),user:l}}return null}function $4e(e,t){const i=new Map;return e&&e.forEach(r=>{const s=t4(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function nte(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function nY(e){return e.replace(m4e,t=>`&#${t.charCodeAt(0)};`)}function HP(e){return typeof e=="string"?e.replace(f4e,'<br class="esri-text-new-line" />'):e}function vye(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=P4e({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=R4e({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return O4e(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?Ls(t,r7):HP(t)}function u6({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>k4e({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:i})),Object.keys(t).forEach(a=>{const l=t[a];o[a]=vye({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function D4e(e,t){var h,p;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return rte.warn(f,m),null}if(!((p=(h=i.capabilities)==null?void 0:h.operations)==null?void 0:p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return rte.warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=(s==null?void 0:s.length)?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,t)).features[0]}async function L4e(e){var r;if(!((r=e.expressionInfos)==null?void 0:r.length))return!1;const t=await nm(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}async function N4e({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&await i.load(s),!e.attributes))return;const n=e.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(i.fieldsIndex),l=$Re(a,e),c=l?[]:a,h=t.returnGeometry||await L4e(t);if(l&&!h)return;const p=await D4e({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes=F(F({},e.attributes),p.attributes)))}function Ug(e=""){return!!e&&e.includes(hye)}function F4e(e){return e?`${hye}${e.layerId}/${e.fieldName}`:""}function ote({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){e&&t&&i&&Object.keys(t.attributes).forEach(o=>{const a=F4e({layerId:i.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=vye({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function k4e({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>ote({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>ote({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})))}const ate=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},_ye=({layer:e,method:t,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)==null?void 0:a.supportsCacheHint)||t==="attachments")return;const s=_(i.where)&&i.where,n=_(i.geometry)&&i.geometry;ate(r)||ate(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},U4e=({query:e,layer:t,method:i})=>{_ye({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},z4e=({queryPayload:e,layer:t,method:i})=>{_ye({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},lte={editing:!1,operations:{add:!0,update:!0,delete:!0}},bye=it.ofType(c4e),V4e="graphic.layer.capabilities.operations.supportsResizeAttachments";let Cd=class extends Se{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities=F({},lte),this.activeAttachmentInfo=null,this.attachmentInfos=new bye,this.graphic=null,this.mode="view",this.own(se(()=>this.graphic,()=>this._graphicChanged(),At))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return F(F({},lte),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(V4e)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new q("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new i7({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(a=>a[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new q("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new q("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new q("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then(a=>this._queryAttachment(a.objectId)),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new q("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new q("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new q("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then(()=>e),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new q("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new q("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new q("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex(c=>c===t);if(!i||typeof i.updateAttachment!="function")throw new q("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await a;return r.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new q("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new i7({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then(s=>s[i][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=dye(e);this._attachmentLayer=t?t.type==="scene"&&_(t.associatedLayer)?t.associatedLayer:t:null}};u([d()],Cd.prototype,"abilities",void 0),u([Rt("abilities")],Cd.prototype,"castAbilities",null),u([d()],Cd.prototype,"activeAttachmentInfo",void 0),u([d({readOnly:!0,type:bye})],Cd.prototype,"attachmentInfos",void 0),u([d({type:Ga})],Cd.prototype,"graphic",void 0),u([d()],Cd.prototype,"mode",void 0),u([d({readOnly:!0})],Cd.prototype,"state",null),u([d({readOnly:!0})],Cd.prototype,"supportsResizeAttachments",null),Cd=u([P("esri.widgets.Attachments.AttachmentsViewModel")],Cd);const oY=Cd;function B4e(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function G4e(e){const t=Li("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function js(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}var j4e=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},wye=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?wye(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=j4e(s)),t.push(s))}},H4e=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return wye(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function W(e,t,...i){return typeof e!="function"||rY(e)?H4e(e,t,...i):e(t,...i)}function ML(...e){return e}const cte={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},rt={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},h6=window.CSS;let wa=class extends Xs{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new oY,this.visibleElements=F({},cte),this._supportsImageOrientation=h6&&h6.supports&&h6.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([En(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),se(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),At)])}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return F(F({},cte),e)}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new q("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new q("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new q("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return W("div",{class:this.classes(rt.base,rt.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?W("div",{key:"error-message",class:rt.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return W("div",{class:rt.loaderContainer,key:"loader"},W("div",{class:rt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?W("div",{class:rt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?W("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(rt.esriButton,rt.esriButtonTertiary,rt.esriButtonSmall,rt.esriButtonHalf,e&&rt.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?W("button",{type:"submit",disabled:i,class:this.classes(rt.esriButton,rt.esriButtonSecondary,rt.esriButtonSmall,rt.esriButtonHalf,{[rt.buttonDisabled]:i})},this.messages.add):null,n=t?W("span",{key:"file-name",class:rt.fileName},t.name):null,o=W("form",{bind:this,afterCreate:Bb,afterRemoved:Nee,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},W("fieldset",{class:rt.fileFieldset},n,W("label",{class:this.classes(rt.fileLabel,rt.esriButton,rt.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,W("input",{class:rt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return W("div",{key:"add-form-container",class:rt.formNode},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=i,c=s||!r,h=l.editing&&l.operations.delete&&t.deleteButton?W("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:S=>this._submitDeleteAttachment(S,e),class:this.classes(rt.esriButton,rt.esriButtonSmall,rt.esriButtonTertiary,rt.deleteButton,{[rt.buttonDisabled]:s})},this.messages.delete):null,p=l.editing&&l.operations.update&&t.updateButton?W("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(rt.esriButton,rt.esriButtonSmall,rt.esriButtonThird,{[rt.buttonDisabled]:c})},this.messages.update):null,f=this.visibleElements.cancelUpdateButton?W("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(rt.esriButton,rt.esriButtonSmall,rt.esriButtonTertiary,rt.esriButtonThird,{[rt.buttonDisabled]:s})},this.messages.cancel):null,m=r?W("span",{key:"file-name",class:rt.fileName},r.name):null,y=l.editing&&l.operations.update?W("fieldset",{key:"file",class:rt.fileFieldset},m,W("label",{class:this.classes(rt.fileLabel,rt.esriButton,rt.esriButtonSecondary)},this.messages.changeFile,W("input",{class:rt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,v=W("fieldset",{key:"size",class:rt.metadataFieldset},W("label",null,n4e(this.messagesUnits,o))),w=W("fieldset",{key:"content-type",class:rt.metadataFieldset},W("label",null,n)),b=W("form",{bind:this,afterCreate:Bb,afterRemoved:Nee,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},W("div",{class:rt.metadata},v,w),y,W("div",{class:rt.actions},h,f,p));return W("div",{key:"edit-form-container",class:rt.formNode},W("a",{class:rt.itemLink,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),W("div",{class:rt.itemLinkOverlay},W("span",{class:rt.itemLinkOverlayIcon},W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},W("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),W("path",{fill:"none",d:"M0 0h32v32H0z"}))))),b)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,o=i&&B4e(r),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=n.includes("?")?"&":"?",h=o?`${n}${c}w=${t}`:G4e(r),p={[rt.itemMaskIcon]:!o},f={[rt.itemImageResizable]:i};return W("div",{class:this.classes(p,rt.itemMask)},W("img",{styles:l,alt:s,src:h,class:this.classes(f,rt.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),a=r.editing?W("span",{"aria-hidden":"true",class:this.classes(rt.itemChevronIcon,Hf(this.container)?rt.iconLeft:rt.iconRight)}):null,l=[o,W("label",{class:rt.itemLabel},W("span",{class:rt.itemFilename},s||this.messages.noTitle),a)],c=r.editing?W("button",{key:"details-button",bind:this,class:rt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):W("a",{key:"details-link",class:rt.itemButton,href:n,target:"_blank"},l);return W("li",{class:rt.item,key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,o={[rt.containerList]:e!=="preview",[rt.containerPreview]:e==="preview"},a=s.editing&&s.operations.add&&i.addButton?W("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(rt.esriButton,rt.esriButtonTertiary,rt.addAttachmentButton),type:"button"},W("span",{"aria-hidden":"true",class:this.classes(rt.itemAddIcon,rt.iconPlus)}),this.messages.add):null,l=n?W("ul",{class:rt.items},r.toArray().map(c=>this.renderAttachmentInfo({attachmentInfo:c,displayType:e}))):W("div",{class:rt.empty},this.messages.noAttachments);return W("div",{key:"attachments-container",class:this.classes(rt.container,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([qe("viewModel.abilities")],wa.prototype,"abilities",void 0),u([d()],wa.prototype,"displayType",void 0),u([d({readOnly:!0})],wa.prototype,"effectiveDisplayType",null),u([qe("viewModel.graphic")],wa.prototype,"graphic",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],wa.prototype,"label",void 0),u([d(),js("esri/widgets/Attachments/t9n/Attachments")],wa.prototype,"messages",void 0),u([d(),js("esri/core/t9n/Units")],wa.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],wa.prototype,"selectedFile",void 0),u([d({readOnly:!0})],wa.prototype,"submitting",void 0),u([d({readOnly:!0})],wa.prototype,"error",void 0),u([d({type:oY})],wa.prototype,"viewModel",void 0),u([d()],wa.prototype,"visibleElements",void 0),u([Rt("visibleElements")],wa.prototype,"castVisibleElements",null),wa=u([P("esri.widgets.Attachments")],wa);const q4e=wa;let uM=class extends oY{constructor(e){super(e),this.description=null,this.title=null}};u([d()],uM.prototype,"description",void 0),u([d()],uM.prototype,"title",void 0),uM=u([P("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],uM);const aY=uM,W4e={heading:"esri-widget__heading"};function qP(e,t){const i=X4e(e.level),r=`h${i}`;return delete e.level,W(r,me(F({},e),{class:YX(W4e.heading,e.class),role:"heading","aria-level":String(i)}),t)}function X4e(e){return De(Math.ceil(e),1,6)}const d6={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let $T=class extends Xs{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return W("div",{class:d6.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?W(qP,{level:this.headingLevel,class:d6.title},e):null}renderDescription(){const{description:e}=this;return e?W("div",{key:"description",class:d6.description},e):null}};u([d()],$T.prototype,"description",void 0),u([d()],$T.prototype,"headingLevel",void 0),u([d()],$T.prototype,"title",void 0),$T=u([P("esri.widgets.Feature.support.FeatureElementInfo")],$T);const lY=$T,Y4e={base:"esri-feature-attachments"};let lf=class extends Xs{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new q4e,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new aY}initialize(){this._featureElementInfo=new lY,this.own([se(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),At),se(()=>{var e;return(e=this.viewModel)==null?void 0:e.graphic},e=>this.attachmentsWidget.graphic=e,At)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return W("div",{class:Y4e.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};u([d({readOnly:!0})],lf.prototype,"attachmentsWidget",void 0),u([qe("viewModel.description")],lf.prototype,"description",void 0),u([qe("attachmentsWidget.displayType")],lf.prototype,"displayType",void 0),u([qe("viewModel.graphic")],lf.prototype,"graphic",void 0),u([d()],lf.prototype,"headingLevel",void 0),u([qe("viewModel.title")],lf.prototype,"title",void 0),u([d({type:aY})],lf.prototype,"viewModel",void 0),lf=u([P("esri.widgets.Feature.FeatureAttachments")],lf);const Z4e=lf;let I0=class extends hx(Se){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(se(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},At))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(e4(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=e4(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};u([d({readOnly:!0})],I0.prototype,"created",void 0),u([d()],I0.prototype,"creator",void 0),u([d()],I0.prototype,"destroyer",void 0),u([d({type:Ga})],I0.prototype,"graphic",void 0),u([d({readOnly:!0})],I0.prototype,"state",null),I0=u([P("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],I0);const i4=I0;function ra(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:J4e(e[t])}}}function Q4e(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function J4e(e){return function(t,...i){Q4e(t)?cM(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function K4e(e){return e.split(",").map(t=>t.trim())}function xye(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:K4e(e);i.push(...r)}}const Tye="calcite-theme-";function e5e(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function Sye(){return e5e().startsWith("dark")}function t5e(){return`${Tye}${Sye()?"dark":"light"}`}function i5e(e){r5e(e),e.classList.add(t5e())}function r5e(e){Array.from(e.classList).forEach(t=>{t.startsWith(Tye)&&e.classList.remove(t)})}function r4(e){return e&&typeof e.render=="function"}function Eye(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const p6={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let DT=class extends Xs{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{pye(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}renderLoading(){return W("div",{class:p6.loaderContainer,key:"loader"},W("div",{class:p6.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?W("div",{key:e,bind:e,afterCreate:this._attachToNode}):r4(e)?W("div",{key:e},!e.destroyed&&e.render()):W("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return W("div",{class:p6.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([qe("viewModel.creator")],DT.prototype,"creator",void 0),u([qe("viewModel.graphic")],DT.prototype,"graphic",void 0),u([d({type:i4})],DT.prototype,"viewModel",void 0),DT=u([P("esri.widgets.Feature.FeatureContent")],DT);const OL=DT;let ig=class extends Se{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t==null||t.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const s=r.clone();s.label=mye(s,e),i.push(s)}),i}};u([d()],ig.prototype,"attributes",void 0),u([d({type:[dpe]})],ig.prototype,"expressionInfos",void 0),u([d()],ig.prototype,"description",void 0),u([d({type:[LP]})],ig.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],ig.prototype,"formattedFieldInfos",null),u([d()],ig.prototype,"title",void 0),ig=u([P("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],ig);const vk=ig,s5e=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function n5e(e){let t=null;return s5e.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function o5e(e,t){if(typeof t!="string"||!t)return t;const i=n5e(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=rm(rm(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const PC={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let Ad=class extends Xs{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new vk,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new lY,this.own(se(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),At))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?i[r]==null?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):o5e(this.messagesURIUtils,n),l={[PC.fieldDataDate]:o};return W("tr",{key:`fields-element-info-row-${r}-${t}`},W("th",{key:`fields-element-info-row-header-${r}-${t}`,class:PC.fieldHeader,innerHTML:s}),W("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(PC.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return(e==null?void 0:e.length)?W("table",{class:PC.esriTable,summary:this.messages.fieldsSummary},W("tbody",null,e.map((t,i)=>this.renderFieldInfo(t,i)))):null}render(){var e;return W("div",{class:PC.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([qe("viewModel.attributes")],Ad.prototype,"attributes",void 0),u([qe("viewModel.description")],Ad.prototype,"description",void 0),u([qe("viewModel.expressionInfos")],Ad.prototype,"expressionInfos",void 0),u([qe("viewModel.fieldInfos")],Ad.prototype,"fieldInfos",void 0),u([qe("viewModel.title")],Ad.prototype,"title",void 0),u([d({type:vk})],Ad.prototype,"viewModel",void 0),u([d(),js("esri/widgets/Feature/t9n/Feature")],Ad.prototype,"messages",void 0),u([d(),js("esri/widgets/support/t9n/uriUtils")],Ad.prototype,"messagesURIUtils",void 0),Ad=u([P("esri.widgets.Feature.FeatureFields")],Ad);const Cye=Ad,a5e={maximumFractionDigits:20};function l5e(e){return om(e,a5e)}var o7;let z1=o7=class extends ve{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e==null?0:e}clone(){return new o7({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:We,json:{type:[Sr],write:!0}})],z1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],z1.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],z1.prototype,"value",void 0),u([Be("value")],z1.prototype,"writeValue",null),z1=o7=u([P("esri.renderers.visualVariables.support.ColorStop")],z1);const c5e=z1;function _k(e,t,i){return Sn(e.map((r,s)=>t.apply(i,[r,s])))}async function u5e(e,t,i){return(await Sn(e.map((r,s)=>t.apply(i,[r,s])))).map(r=>r.value)}async function Ac(e){if(M(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function aTt(e){try{return{ok:!0,value:await e}}catch(t){return by(t),{ok:!1,error:t}}}function lTt(e){if(e.ok===!0)return e.value;throw e.error}function WP(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function h5e(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function d5e(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v){const w=new Float32Array(16);return w[0]=e,w[1]=t,w[2]=i,w[3]=r,w[4]=s,w[5]=n,w[6]=o,w[7]=a,w[8]=l,w[9]=c,w[10]=h,w[11]=p,w[12]=f,w[13]=m,w[14]=y,w[15]=v,w}function p5e(e,t){return new Float32Array(e,t,16)}const f5e=WP();Object.freeze(Object.defineProperty({__proto__:null,create:WP,clone:h5e,fromValues:d5e,createView:p5e,IDENTITY:f5e},Symbol.toStringTag,{value:"Module"}));const m5e=(e,t)=>{const i=Tm(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return Pl(i,i)},g5e=(e,t)=>{const i=Tm(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return Pl(i,i)},y5e=(e,t)=>{const i=1-t,r=Tm(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Pl(r,r)},v5e=(e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=Tm(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Pl(s,s)},_5e=(e,t)=>{const i=1-2*t,r=Tm(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return Pl(r,r)},b5e=(e,t)=>{const i=Tm(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return Pl(i,i)},w5e=(e,t)=>{const i=1-t,r=Tm(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Pl(r,r)};class bk{constructor(t,i,r){this.strength=t,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(t,i,r){this.strength=oc(t.strength,i.strength,r),this.radius=oc(t.radius,i.radius,r),this.threshold=oc(t.threshold,i.threshold,r)}clone(){return new bk(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:mO(this.radius),strength:this.strength,threshold:this.threshold}}}class wk{constructor(t){this.radius=t,this.type="blur"}interpolate(t,i,r){this.radius=Math.round(oc(t.radius,i.radius,r))}clone(){return new wk(this.radius)}toJSON(){return{type:"blur",radius:mO(this.radius)}}}class yR{constructor(t,i){this.type=t,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.amount=oc(t.amount,i.amount,r),this._updateMatrix()}clone(){return new yR(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||WP();switch(this.type){case"brightness":this._colorMatrix=m5e(t,this.amount);break;case"contrast":this._colorMatrix=g5e(t,this.amount);break;case"grayscale":this._colorMatrix=y5e(t,this.amount);break;case"invert":this._colorMatrix=_5e(t,this.amount);break;case"saturate":this._colorMatrix=b5e(t,this.amount);break;case"sepia":this._colorMatrix=w5e(t,this.amount)}}}class xk{constructor(t,i,r,s){this.offsetX=t,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(t,i,r){this.offsetX=oc(t.offsetX,i.offsetX,r),this.offsetY=oc(t.offsetY,i.offsetY,r),this.blurRadius=oc(t.blurRadius,i.blurRadius,r),this.color[0]=Math.round(oc(t.color[0],i.color[0],r)),this.color[1]=Math.round(oc(t.color[1],i.color[1],r)),this.color[2]=Math.round(oc(t.color[2],i.color[2],r)),this.color[3]=oc(t.color[3],i.color[3],r)}clone(){return new xk(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:mO(this.offsetX),yoffset:mO(this.offsetY),blurRadius:mO(this.blurRadius),color:t}}}class Tk{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.angle=oc(t.angle,i.angle,r),this._updateMatrix()}clone(){return new Tk(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||WP();this._colorMatrix=v5e(t,this.angle)}}class Sk{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,i,r){this.amount=oc(t.amount,i.amount,r)}clone(){return new Sk(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function oc(e,t,i){return e+(t-e)*i}function mO(e){return Math.round(1e3*Du(e))/1e3}function x5e(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new yR(e.type,0);case"saturate":case"brightness":case"contrast":return new yR(e.type,1);case"opacity":return new Sk(1);case"hue-rotate":return new Tk(0);case"blur":return new wk(0);case"drop-shadow":return new xk(0,0,0,[...jW("transparent")]);case"bloom":return new bk(0,0,1)}}var cTt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function uTt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function hTt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function T5e(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every((r,s)=>r.type===i[s].type)}function S5e(e,t){const i=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let s=r.length;s<i.length;s++)r.push(x5e(i[s]))}function E5e(e){const t=e[0];return!!t&&"type"in t}var ute,hte,Aye={exports:{}};function Mye(e){if(!e||e.length===0)return null;if(typeof e=="string"){const i=dte(e);return i&&i.length!==0?i:null}const t=e.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new q("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:dte(i.value)}});t.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<t.length-1;i++){if(!T5e(t[i].effects,t[i+1].effects))throw new q("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[i].effects,b:t[i+1].effects});S5e(t[i].effects,t[i+1].effects)}return t.sort((i,r)=>r.scale-i.scale),t}function dte(e){let t;if(!e)return[];try{t=Aye.exports.parse(e)}catch(i){throw new q("effect:invalid-syntax","Invalid effect syntax",{value:e,error:i})}return t.map(i=>C5e(i))}function C5e(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return A5e(e);case"opacity":return M5e(e);case"hue-rotate":return O5e(e);case"blur":return R5e(e);case"drop-shadow":return P5e(e);case"bloom":return I5e(e)}}catch(t){throw t.details.filter=e,t}throw new q("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function A5e(e){let t=1;return eC(e.parameters,1),e.parameters.length===1&&(t=Hd(e.parameters[0])),new yR(e.name,t)}function M5e(e){let t=1;return eC(e.parameters,1),e.parameters.length===1&&(t=Hd(e.parameters[0])),new Sk(t)}function O5e(e){let t=0;return eC(e.parameters,1),e.parameters.length===1&&(t=k5e(e.parameters[0])),new Tk(t)}function R5e(e){let t=0;return eC(e.parameters,1),e.parameters.length===1&&(t=hY(e.parameters[0]),XP(t,e.parameters[0])),new wk(t)}function P5e(e){const t=[];let i=null;for(const r of e.parameters)if(r.type==="color"){if(t.length&&Object.freeze(t),i)throw new q("effect:type-error","Accepts only one color",{});i=U5e(r)}else{const s=hY(r);if(Object.isFrozen(t))throw new q("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&XP(s,r)}if(t.length<2||t.length>3)throw new q("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new xk(t[0],t[1],t[2]||0,i||Oye("black"))}function I5e(e){let t=1,i=0,r=0;return eC(e.parameters,3),e.parameters[0]&&(t=Hd(e.parameters[0])),e.parameters[1]&&(i=hY(e.parameters[1]),XP(i,e.parameters[1])),e.parameters[2]&&(r=Hd(e.parameters[2])),new bk(t,i,r)}function eC(e,t){if(e.length>t)throw new q("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function Ek(e){if(e.type==="color")return"<color>";if(e.unit){if(uY[e.unit])return"<length>";if(cY[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function XP(e,t){if(e<0)throw new q("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function $5e(e){if(e.type!=="quantity"||e.unit!==null)throw new q("effect:type-error",`Expected <double>, Actual: ${Ek(e)}`,{term:e})}function D5e(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new q("effect:type-error",`Expected <double> or <percentage>, Actual: ${Ek(e)}`,{term:e})}hte=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:qJ},h=qJ,p="none",f=")",m=",",y="(",v="%",w="px",b="cm",S="mm",T="in",E="pt",C="pc",A="deg",I="rad",L="grad",D="turn",U="#",z=".",V="e",X=/^[ \t\n\r]/,Z=/^[a-z\-]/,ae=/^[0-9a-fA-F]/,re=/^[+\-]/,$=/^[0-9]/,k=cd("none"),B=Mn("none",!1),H=Mn(")",!1),Y=Mn(",",!1),ee=cd("whitespace"),G=V_([" ","	",`
`,"\r"],!1,!1),te=cd("function"),fe=Mn("(",!1),xe=cd("identifier"),Le=V_([["a","z"],"-"],!1,!1),_e=cd("percentage"),ye=Mn("%",!1),Ce=cd("length"),Pe=Mn("px",!1),xi=Mn("cm",!1),Ti=Mn("mm",!1),Xt=Mn("in",!1),Pi=Mn("pt",!1),Yt=Mn("pc",!1),Si=cd("angle"),Ir=Mn("deg",!1),Hr=Mn("rad",!1),Ye=Mn("grad",!1),Wi=Mn("turn",!1),Zs=cd("number"),wo=cd("color"),An=Mn("#",!1),Dl=V_([["0","9"],["a","f"],["A","F"]],!1,!1),Ll=V_(["+","-"],!1,!1),Hn=V_([["0","9"]],!1,!1),Rp=Mn(".",!1),bz=Mn("e",!1),wz=function(){return[]},I3=function(Q,be){return{type:"function",name:Q,parameters:be||[]}},$3=function(Q,be){return be.length>0?TCe(Q,be,3):[Q]},D3=function(Q){return{type:"quantity",value:Q.value,unit:Q.unit}},L3=function(Q){return{type:"color",colorType:Q.type,value:Q.value}},xz=function(Q){return Q},Tz=function(){return z_()},Sz=function(Q){return{value:Q,unit:"%"}},Ez=function(Q){return{value:Q,unit:"px"}},gC=function(Q){return{value:Q,unit:"cm"}},N3=function(Q){return{value:Q,unit:"mm"}},F3=function(Q){return{value:Q,unit:"in"}},k3=function(Q){return{value:Q,unit:"pt"}},Ii=function(Q){return{value:Q,unit:"pc"}},jo=function(Q){return{value:Q,unit:"deg"}},xo=function(Q){return{value:Q,unit:"rad"}},Nl=function(Q){return{value:Q,unit:"grad"}},k_=function(Q){return{value:Q,unit:"turn"}},U3=function(Q){return{value:Q,unit:null}},z3=function(){return{type:"hex",value:z_()}},V3=function(Q){return{type:"function",value:Q}},B3=function(){return{type:"named",value:z_()}},Pp=function(){return parseFloat(z_())},ue=0,$r=0,bx=[{line:1,column:1}],ju=0,U_=[],ht=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function z_(){return s.substring($r,ue)}function Mn(Q,be){return{type:"literal",text:Q,ignoreCase:be}}function V_(Q,be,Re){return{type:"class",parts:Q,inverted:be,ignoreCase:Re}}function G3(){return{type:"end"}}function cd(Q){return{type:"other",description:Q}}function yC(Q){var be,Re=bx[Q];if(Re)return Re;for(be=Q-1;!bx[be];)be--;for(Re={line:(Re=bx[be]).line,column:Re.column};be<Q;)s.charCodeAt(be)===10?(Re.line++,Re.column=1):Re.column++,be++;return bx[Q]=Re,Re}function j3(Q,be){var Re=yC(Q),fi=yC(be);return{source:l,start:{offset:Q,line:Re.line,column:Re.column},end:{offset:be,line:fi.line,column:fi.column}}}function Zt(Q){ue<ju||(ue>ju&&(ju=ue,U_=[]),U_.push(Q))}function dCe(Q,be,Re){return new t(t.buildMessage(Q,be),Q,be,Re)}function qJ(){var Q;return(Q=pCe())===a&&(Q=fCe()),Q}function pCe(){var Q,be;return ht++,Q=ue,To(),s.substr(ue,4)===p?(be=p,ue+=4):(be=a,ht===0&&Zt(B)),be!==a?(To(),$r=Q,Q=wz()):(ue=Q,Q=a),ht--,Q===a&&ht===0&&Zt(k),Q}function fCe(){var Q,be;if(Q=[],(be=Cz())!==a)for(;be!==a;)Q.push(be),be=Cz();else Q=a;return Q}function Cz(){var Q,be,Re,fi;return Q=ue,To(),(be=gCe())!==a?(To(),(Re=mCe())===a&&(Re=null),To(),s.charCodeAt(ue)===41?(fi=f,ue++):(fi=a,ht===0&&Zt(H)),fi!==a?(To(),$r=Q,Q=I3(be,Re)):(ue=Q,Q=a)):(ue=Q,Q=a),Q}function mCe(){var Q,be,Re,fi,Ho,As,qu,H3;if(Q=ue,(be=Az())!==a){for(Re=[],fi=ue,Ho=To(),s.charCodeAt(ue)===44?(As=m,ue++):(As=a,ht===0&&Zt(Y)),As===a&&(As=null),qu=To(),(H3=Az())!==a?fi=Ho=[Ho,As,qu,H3]:(ue=fi,fi=a);fi!==a;)Re.push(fi),fi=ue,Ho=To(),s.charCodeAt(ue)===44?(As=m,ue++):(As=a,ht===0&&Zt(Y)),As===a&&(As=null),qu=To(),(H3=Az())!==a?fi=Ho=[Ho,As,qu,H3]:(ue=fi,fi=a);$r=Q,Q=$3(be,Re)}else ue=Q,Q=a;return Q}function Az(){var Q,be;return Q=ue,(be=yCe())===a&&(be=vCe())===a&&(be=_Ce())===a&&(be=bCe()),be!==a&&($r=Q,be=D3(be)),(Q=be)===a&&(Q=ue,(be=wCe())!==a&&($r=Q,be=L3(be)),Q=be),Q}function To(){var Q,be;for(ht++,Q=[],X.test(s.charAt(ue))?(be=s.charAt(ue),ue++):(be=a,ht===0&&Zt(G));be!==a;)Q.push(be),X.test(s.charAt(ue))?(be=s.charAt(ue),ue++):(be=a,ht===0&&Zt(G));return ht--,be=a,ht===0&&Zt(ee),Q}function gCe(){var Q,be,Re;return ht++,Q=ue,(be=WJ())!==a?(s.charCodeAt(ue)===40?(Re=y,ue++):(Re=a,ht===0&&Zt(fe)),Re!==a?($r=Q,Q=xz(be)):(ue=Q,Q=a)):(ue=Q,Q=a),ht--,Q===a&&(be=a,ht===0&&Zt(te)),Q}function WJ(){var Q,be,Re;if(ht++,Q=ue,be=[],Z.test(s.charAt(ue))?(Re=s.charAt(ue),ue++):(Re=a,ht===0&&Zt(Le)),Re!==a)for(;Re!==a;)be.push(Re),Z.test(s.charAt(ue))?(Re=s.charAt(ue),ue++):(Re=a,ht===0&&Zt(Le));else be=a;return be!==a&&($r=Q,be=Tz()),ht--,(Q=be)===a&&(be=a,ht===0&&Zt(xe)),Q}function yCe(){var Q,be,Re;return ht++,Q=ue,To(),(be=Hu())!==a?(s.charCodeAt(ue)===37?(Re=v,ue++):(Re=a,ht===0&&Zt(ye)),Re!==a?($r=Q,Q=Sz(be)):(ue=Q,Q=a)):(ue=Q,Q=a),ht--,Q===a&&ht===0&&Zt(_e),Q}function vCe(){var Q,be,Re;return ht++,Q=ue,To(),(be=Hu())!==a?(s.substr(ue,2)===w?(Re=w,ue+=2):(Re=a,ht===0&&Zt(Pe)),Re!==a?($r=Q,Q=Ez(be)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,To(),(be=Hu())!==a?(s.substr(ue,2)===b?(Re=b,ue+=2):(Re=a,ht===0&&Zt(xi)),Re!==a?($r=Q,Q=gC(be)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,To(),(be=Hu())!==a?(s.substr(ue,2)===S?(Re=S,ue+=2):(Re=a,ht===0&&Zt(Ti)),Re!==a?($r=Q,Q=N3(be)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,To(),(be=Hu())!==a?(s.substr(ue,2)===T?(Re=T,ue+=2):(Re=a,ht===0&&Zt(Xt)),Re!==a?($r=Q,Q=F3(be)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,To(),(be=Hu())!==a?(s.substr(ue,2)===E?(Re=E,ue+=2):(Re=a,ht===0&&Zt(Pi)),Re!==a?($r=Q,Q=k3(be)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,To(),(be=Hu())!==a?(s.substr(ue,2)===C?(Re=C,ue+=2):(Re=a,ht===0&&Zt(Yt)),Re!==a?($r=Q,Q=Ii(be)):(ue=Q,Q=a)):(ue=Q,Q=a)))))),ht--,Q===a&&ht===0&&Zt(Ce),Q}function _Ce(){var Q,be,Re;return ht++,Q=ue,(be=Hu())!==a?(s.substr(ue,3)===A?(Re=A,ue+=3):(Re=a,ht===0&&Zt(Ir)),Re!==a?($r=Q,Q=jo(be)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,(be=Hu())!==a?(s.substr(ue,3)===I?(Re=I,ue+=3):(Re=a,ht===0&&Zt(Hr)),Re!==a?($r=Q,Q=xo(be)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,(be=Hu())!==a?(s.substr(ue,4)===L?(Re=L,ue+=4):(Re=a,ht===0&&Zt(Ye)),Re!==a?($r=Q,Q=Nl(be)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,(be=Hu())!==a?(s.substr(ue,4)===D?(Re=D,ue+=4):(Re=a,ht===0&&Zt(Wi)),Re!==a?($r=Q,Q=k_(be)):(ue=Q,Q=a)):(ue=Q,Q=a)))),ht--,Q===a&&(be=a,ht===0&&Zt(Si)),Q}function bCe(){var Q,be;return ht++,Q=ue,To(),(be=Hu())!==a?($r=Q,Q=U3(be)):(ue=Q,Q=a),ht--,Q===a&&ht===0&&Zt(Zs),Q}function wCe(){var Q,be,Re,fi;if(ht++,Q=ue,s.charCodeAt(ue)===35?(be=U,ue++):(be=a,ht===0&&Zt(An)),be!==a){if(Re=[],ae.test(s.charAt(ue))?(fi=s.charAt(ue),ue++):(fi=a,ht===0&&Zt(Dl)),fi!==a)for(;fi!==a;)Re.push(fi),ae.test(s.charAt(ue))?(fi=s.charAt(ue),ue++):(fi=a,ht===0&&Zt(Dl));else Re=a;Re!==a?($r=Q,Q=z3()):(ue=Q,Q=a)}else ue=Q,Q=a;return Q===a&&(Q=ue,(be=Cz())!==a&&($r=Q,be=V3(be)),(Q=be)===a&&(Q=ue,(be=WJ())!==a&&($r=Q,be=B3()),Q=be)),ht--,Q===a&&(be=a,ht===0&&Zt(wo)),Q}function Hu(){var Q,be,Re,fi,Ho,As,qu;for(Q=ue,re.test(s.charAt(ue))?(s.charAt(ue),ue++):ht===0&&Zt(Ll),be=ue,Re=[],$.test(s.charAt(ue))?(fi=s.charAt(ue),ue++):(fi=a,ht===0&&Zt(Hn));fi!==a;)Re.push(fi),$.test(s.charAt(ue))?(fi=s.charAt(ue),ue++):(fi=a,ht===0&&Zt(Hn));if(s.charCodeAt(ue)===46?(fi=z,ue++):(fi=a,ht===0&&Zt(Rp)),fi!==a){if(Ho=[],$.test(s.charAt(ue))?(As=s.charAt(ue),ue++):(As=a,ht===0&&Zt(Hn)),As!==a)for(;As!==a;)Ho.push(As),$.test(s.charAt(ue))?(As=s.charAt(ue),ue++):(As=a,ht===0&&Zt(Hn));else Ho=a;Ho!==a?be=Re=[Re,fi,Ho]:(ue=be,be=a)}else ue=be,be=a;if(be===a)if(be=[],$.test(s.charAt(ue))?(Re=s.charAt(ue),ue++):(Re=a,ht===0&&Zt(Hn)),Re!==a)for(;Re!==a;)be.push(Re),$.test(s.charAt(ue))?(Re=s.charAt(ue),ue++):(Re=a,ht===0&&Zt(Hn));else be=a;if(be!==a){if(Re=ue,s.charCodeAt(ue)===101?(fi=V,ue++):(fi=a,ht===0&&Zt(bz)),fi!==a){if(re.test(s.charAt(ue))?(Ho=s.charAt(ue),ue++):(Ho=a,ht===0&&Zt(Ll)),Ho===a&&(Ho=null),As=[],$.test(s.charAt(ue))?(qu=s.charAt(ue),ue++):(qu=a,ht===0&&Zt(Hn)),qu!==a)for(;qu!==a;)As.push(qu),$.test(s.charAt(ue))?(qu=s.charAt(ue),ue++):(qu=a,ht===0&&Zt(Hn));else As=a;As!==a?Re=fi=[fi,Ho,As]:(ue=Re,Re=a)}else ue=Re,Re=a;Re===a&&(Re=null),$r=Q,Q=Pp()}else ue=Q,Q=a;return Q}function xCe(Q,be){return Q.map(function(Re){return Re[be]})}function TCe(Q,be,Re){return[Q].concat(xCe(be,Re))}if((o=h())!==a&&ue===s.length)return o;throw o!==a&&ue<s.length&&Zt(G3()),dCe(U_,ju<s.length?s.charAt(ju):null,ju<s.length?j3(ju,ju+1):j3(ju,ju))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length),f=a[l.line-1],m=l.line===h.line?h.column:f.length+1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1)+i("",m-l.column,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(v){return Array.isArray(v)?c(v[0])+"-"+c(v[1]):c(v)});return"["+(m.inverted?"^":"")+y+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,v,w=m.map(h);if(w.sort(),w.length>0){for(y=1,v=1;y<w.length;y++)w[y-1]!==w[y]&&(w[v]=w[y],v++);w.length=v}switch(w.length){case 1:return w[0];case 2:return w[0]+" or "+w[1];default:return w.slice(0,-1).join(", ")+", or "+w[w.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:r}},(ute=Aye).exports&&(ute.exports=hte());const cY={deg:1,grad:.9,rad:180/Math.PI,turn:360};function L5e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&cY[e.unit]!=null))throw new q("effect:type-error",`Expected <angle>, Actual: ${Ek(e)}`,{term:e})}const uY={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function N5e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&uY[e.unit]!=null))throw new q("effect:type-error",`Expected <length>, Actual: ${Ek(e)}`,{term:e})}function Hd(e){D5e(e);const t=e.value;return XP(t,e),e.unit==="%"?.01*t:t}function F5e(e){return $5e(e),XP(e.value,e),e.value}function k5e(e){return L5e(e),e.value*cY[e.unit]||0}function hY(e){return N5e(e),e.value*uY[e.unit]||0}function U5e(e){switch(e.colorType){case"hex":return KRe(e.value);case"named":return Oye(e.value);case"function":return B5e(e.value)}}function Oye(e){if(!gpe(e))throw new q("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return JRe(e)}const z5e=/^rgba?/i,V5e=/^hsla?/i;function B5e(e){if(eC(e.parameters,4),z5e.test(e.name))return[Hd(e.parameters[0]),Hd(e.parameters[1]),Hd(e.parameters[2]),e.parameters[3]?Hd(e.parameters[3]):1];if(V5e.test(e.name))return ype(F5e(e.parameters[0]),Hd(e.parameters[1]),Hd(e.parameters[2]),e.parameters[3]?Hd(e.parameters[3]):1);throw new q("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function dY(e,t,i){var r;try{return j5e(e)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function pY(e,t,i,r){try{const s=G5e(e);xc(i,s,t)}catch(s){r.messages&&r.messages.push(s)}}function G5e(e){const t=Mye(e);return t?E5e(t)?t.map(i=>i.toJSON()):t.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function j5e(e){if(!e||e.length===0)return null;if(H5e(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:pte(i.value)});return t}return pte(e)}function H5e(e){const t=e[0];return!!t&&"scale"in t}function pte(e){if(!e||!e.length)return"";const t=[];for(const i of e){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Dm(i,"amount")];break;case"blur":r=[Dm(i,"radius","pt")];break;case"hue-rotate":r=[Dm(i,"angle","deg")];break;case"drop-shadow":r=[Dm(i,"xoffset","pt"),Dm(i,"yoffset","pt"),Dm(i,"blurRadius","pt"),q5e(i,"color")];break;case"bloom":r=[Dm(i,"strength"),Dm(i,"radius","pt"),Dm(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;Mye(s),t.push(s)}return t.join(" ")}function Dm(e,t,i){if(e[t]==null)throw new q("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function q5e(e,t){if(e[t]==null)throw new q("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const RL=-3;var Ig;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(Ig||(Ig={}));class W5e{constructor(t,i,r){this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,i,r,s=0){this._storage.put(this._namespace+t,i,r,s)}get(t){const i=this._storage.get(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}pop(t){const i=this._storage.pop(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}updateSize(t,i,r){this._storage.updateSize(this._namespace+t,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class fY{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Gt,this._users=new Gt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,i){this._removeFuncs.push([t,i])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(i=>i[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,i,r,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,Ig.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,Ig.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,RL)-RL;this._db.set(t,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(t,i,r){const s=this._db.get(t);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(t,i,Ig.SOME);if(!(_(n)&&n>0))return void this._db.delete(t);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const i=this._db.get(t);if(i)return this._size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(t){const i=this._db.get(t);if(i!==void 0)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>t[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(t["Priority "+(o+RL-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((i,r)=>{r.startsWith(t)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,Ig.ALL))})}clearAll(){this._db.forEach((t,i)=>this._notifyRemove(i,t.entry,Ig.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,r){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,i]of this._db){if(this._db.delete(t),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(t,i.entry,Ig.SOME);_(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(t,i))}else--i.lives,this._db.set(t,i);if(this._size<=.9*this.maxSize)return}}}class X5e{constructor(t,i){this._storage=new fY,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i){this._storage.put(t,i,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function Y5e(e){return typeof e=="function"}function dTt(e,t,i,r){return Y5e(e)?e(t,i,r):e}function pTt(e){return[e.r,e.g,e.b,e.a]}function fTt(e,t,i){const r=` /-,
`,s=l=>{let c=l.length;for(;c--;)if(!r.includes(l.charAt(c)))return!1;return!0},n=[];let o=0,a=-1;do if(a=t.indexOf("[",o),a>=o){if(a>o){const l=t.substr(o,a-o);n.push([l,null,s(l)])}if(o=a+1,a=t.indexOf("]",o),a>=o){if(a>o){const l=e[t.substr(o,a-o)];l&&n.push([null,l,!1])}o=a+1}}while(a!==-1);if(o<t.length-1){const l=t.substr(o);n.push([l,null,s(l)])}return l=>{let c="",h=null;for(const p of n){const[f,m,y]=p;if(f)y?h=f:(h&&(c+=h,h=null),c+=f);else{const v=l.attributes[m];v&&(h&&(c+=h,h=null),c+=v)}}return Z5e(c,i)}}function Z5e(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function mTt(e,t,i,r,s,n,o=!0){const a=t/s,l=i/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let y=0,v=0,w=0,b=0,S=0,T=0,E=0;const C=(p+.5)*l;for(let A=Math.floor(p*l);A<(p+1)*l;A++){const I=Math.abs(C-(A+.5))/h,L=(f+.5)*a,D=I*I;for(let U=Math.floor(f*a);U<(f+1)*a;U++){let z=Math.abs(L-(U+.5))/c;const V=Math.sqrt(D+z*z);V>=-1&&V<=1&&(y=2*V*V*V-3*V*V+1,y>0&&(z=4*(U+A*t),E+=y*e[z+3],w+=y,e[z+3]<255&&(y=y*e[z+3]/250),b+=y*e[z],S+=y*e[z+1],T+=y*e[z+2],v+=y))}}r[m]=b/v,r[m+1]=S/v,r[m+2]=T/v,r[m+3]=E/w}}function gTt(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function Q5e(e){return e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices"}const yTt=e=>isNaN(e)||!e?0:e,vTt=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function _Tt(){return import("./geometryEngineJSON.2762c1dd.js")}function Rye(e,t,i,r){if(e.type!=="CIMTextSymbol"){if(i&&e.effects)for(const s of e.effects)eke(s,t);if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":J5e(s,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r==null?void 0:r.preserveOutlineWidth)&&s.width&&(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":Rye(s.lineSymbol,t,!0,me(F({},r),{preserveOutlineWidth:!1})),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}}else e.height*=t}function J5e(e,t,i){if(e.markerPlacement&&K5e(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,e.type==="CIMVectorMarker"&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||Rye(r.symbol,t,!0,i)}function K5e(e,t){switch(Q5e(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function eke(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map(r=>r*t);e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}new X5e(1e3);new We([128,128,128]);const fte=/\/resource\/(.*?)\.svg$/,tke=new We("white");function ike(e,t){const i=t.resource.href;return!he("esri-canvas-svg-support")&&e.styleOrigin&&fte.test(i)?i.replace(fte,"/resource/png/$1.png"):i}function Ex(e,t){if(!e)return null;let i=null;return U2(e)?i=rke(e):K5(e)&&(i=e.color?new We(e.color):null),i?vR(i,t):null}function rke(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach(r=>{r.type==="object"&&r.resource.href!=null||(i=r.type==="water"?r.color:_(r.material)?r.material.color:null)}),i?new We(i):null}function vR(e,t){if(t==null)return e;const i=e.toRgba();return i[3]=i[3]*t,new We(i)}function ske(e,t,i){const r=e.symbolLayers;if(!r)return;const s=n=>{const o=_(n)?n:null;return vR(t=t||o||i!=null&&tke,i)};r.forEach(n=>{if(n.type!=="object"||n.resource.href==null||t)if(n.type==="water")n.color=s(n.color);else{const o=_(n.material)?n.material.color:null,a=s(o);M(n.material)?n.material=new Cu({color:a}):n.material.color=a,i!=null&&"outline"in n&&_(n.outline)&&_(n.outline.color)&&(n.outline.color=vR(n.outline.color,i))}})}function nke(e,t,i){(t=t||e.color)&&(e.color=vR(t,i)),i!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=vR(e.outline.color,i))}function f6(e,t,i){e&&(t||i!=null)&&(t&&(t=new We(t)),U2(e)?ske(e,t,i):K5(e)&&nke(e,t,i))}async function oke(e,t){const i=e.symbolLayers;i&&await _k(i,async r=>ake(r,t))}async function ake(e,t){switch(e.type){case"extrude":cke(e,t);break;case"icon":case"line":case"text":lke(e,t);break;case"path":hke(e,t);break;case"object":await uke(e,t)}}function lke(e,t){const i=Pye(t);_(i)&&(e.size=i)}function Pye(e){for(const t of e)if(typeof t=="number")return t;return null}function cke(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function uke(e,t){const{resourceSize:i,symbolSize:r}=await dke(e),s=Iye(t,i,r);e.width=gO(t[0],r[0],i[0],s),e.depth=gO(t[1],r[1],i[1],s),e.height=gO(t[2],r[2],i[2],s)}function hke(e,t){const i=Iye(t,Gf,[e.width,void 0,e.height]);e.width=gO(t[0],e.width,1,i),e.height=gO(t[2],e.height,1,i)}function Iye(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return i[r]!=null?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}async function dke(e){const t=await import("./symbolLayerUtils.c2dafbcb.js"),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,o=[r,n,s];let a=1;for(let l=0;l<3;l++)if(o[l]!=null){a=o[l]/i[l];break}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function gO(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return t!=null?t:i;default:return e}}function pke(e,t){const i=Pye(t);if(!M(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=i,e.height=i*r):(e.width=i*r,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}async function fke(e,t){if(e&&t)return U2(e)?oke(e,t):void(K5(e)&&pke(e,t))}function mke(e,t,i){if(e&&t!=null)if(U2(e)){const r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else K5(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}const gke="<",yke=">",vke=U5("short-date");function _ke(e,t,i,r){let s="";t===0?s=`${gke} `:t===i&&(s=`${yke} `);let n=null;return n=r?Ls(e,vke):l5e(e),s+n}const bke=new We([64,64,64]);function wke(e,t){const i=[],r=e.length-1;return e.length===5?i.push(0,2,4):i.push(0,r),e.map((s,n)=>i.includes(n)?_ke(s,n,r,t):null)}async function xke(e,t,i){let r=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:wke(s,i);return(await Promise.all(s.map(async(c,h)=>({value:c,color:e.type==="opacity"?await Tke(c,e,t):(await Promise.resolve().then(function(){return VY})).getColor(e,c),label:r?n[h]:l[h]})))).reverse()}async function Tke(e,t,i=bke){const r=new We(i),s=(await Promise.resolve().then(function(){return VY})).getOpacity(t,e);return s!=null&&(r.a=s),r}var a7;let hM=a7=class extends ve{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new a7({color:this.color,ratio:this.ratio})}};u([d({type:We,json:{type:[Sr],default:null,write:!0}})],hM.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],hM.prototype,"ratio",void 0),hM=a7=u([P("esri.renderers.support.HeatmapColorStop")],hM);const yO=hM;function Ske(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=t.length-1;if(t&&t[0]){const r=t[i];r&&r.ratio!==1&&(t.push(new yO({ratio:1,color:r.color})),i++)}return t.map((r,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}ge.getLogger("esri.renderers.support.utils");function Lc(e,t,i){cW(e,t,()=>[]).push(...i)}async function Eke(e){var i,r;const t=new Map;if("visualVariables"in e&&e.visualVariables){const s=e.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=n.field||n.valueExpression,a=(await xke(n)).map(l=>l.color);Lc(t,o,a)}}if(e.type==="heatmap"){const s=Ske(e).map(n=>n.color);Lc(t,e.field,s)}else if(e.type==="pie-chart"){for(const s of e.attributes)Lc(t,s.field,[s.color]);Lc(t,null,[(i=e==null?void 0:e.othersCategory)==null?void 0:i.color,Ex(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const s of e.attributes)Lc(t,s.field,[s.color]);Lc(t,null,[e.backgroundColor])}else if(e.type==="unique-value")if(((r=e.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of e.uniqueValueInfos)Lc(t,s.value.toString(),[Ex(s.symbol,null)]);else{const s=e.uniqueValueInfos.map(c=>Ex(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=e;(n||l)&&Lc(t,n||l,s),o&&Lc(t,o,s),a&&Lc(t,a,s)}else if(e.type==="class-breaks"){const s=e.classBreakInfos.map(n=>Ex(n.symbol,null));Lc(t,e.field||e.valueExpression,s)}else e.type==="simple"&&Lc(t,null,[Ex(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&Lc(t,null,[Ex(e.defaultSymbol,null)]),t.forEach((s,n)=>{const o=AP(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));t.set(n,o)}),t}var l7;let dM=l7=class extends ve{constructor(e){super(e),this.name=null,this.code=null}clone(){return new l7({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],dM.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],dM.prototype,"code",void 0),dM=l7=u([P("esri.layers.support.CodedValue")],dM);const Cke=new wi({inherited:"inherited",codedValue:"coded-value",range:"range"});let pM=class extends ve{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],pM.prototype,"name",void 0),u([ut(Cke)],pM.prototype,"type",void 0),pM=u([P("esri.layers.support.Domain")],pM);const Ck=pM;var c7;let fM=c7=class extends Ck{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new c7({codedValues:ie(this.codedValues),name:this.name})}};u([d({type:[dM],json:{write:!0}})],fM.prototype,"codedValues",void 0),u([ut({codedValue:"coded-value"})],fM.prototype,"type",void 0),fM=c7=u([P("esri.layers.support.CodedValueDomain")],fM);const $ye=fM;var u7;let PL=u7=class extends Ck{constructor(e){super(e),this.type="inherited"}clone(){return new u7}};u([ut({inherited:"inherited"})],PL.prototype,"type",void 0),PL=u7=u([P("esri.layers.support.InheritedDomain")],PL);const Dye=PL;var h7;let LT=h7=class extends Ck{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new h7({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],LT.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],LT.prototype,"minValue",void 0),u([ut({range:"range"})],LT.prototype,"type",void 0),LT=h7=u([P("esri.layers.support.RangeDomain")],LT);const Lye=LT,Nye={key:"type",base:Ck,typeMap:{range:Lye,"coded-value":$ye,inherited:Dye}};function mY(e){if(!e||!e.type)return null;switch(e.type){case"range":return Lye.fromJSON(e);case"codedValue":return $ye.fromJSON(e);case"inherited":return Dye.fromJSON(e)}return null}const gY=new wi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var d7;const Ake=new wi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let rl=d7=class extends ve{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?Ake.fromJSON(i.fieldValueType):null}clone(){return new d7({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};u([d({type:String,json:{write:!0}})],rl.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],rl.prototype,"defaultValue",void 0),u([d()],rl.prototype,"description",void 0),u([Ue("description")],rl.prototype,"readDescription",null),u([d({types:Nye,json:{read:{reader:mY},write:!0}})],rl.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],rl.prototype,"editable",void 0),u([d({type:Sr,json:{write:!0}})],rl.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],rl.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],rl.prototype,"nullable",void 0),u([ut(gY)],rl.prototype,"type",void 0),u([d()],rl.prototype,"valueType",void 0),u([Ue("valueType",["description"])],rl.prototype,"readValueType",null),rl=d7=u([P("esri.layers.support.Field")],rl);const YP=rl;var p7;let NT=p7=class extends ve{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new p7({mapLayerId:e,gdbVersion:t})}};u([ut({mapLayer:"map-layer"})],NT.prototype,"type",void 0),u([d({type:Sr,json:{write:!0}})],NT.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],NT.prototype,"gdbVersion",void 0),NT=p7=u([P("esri.layers.support.source.MapLayerSource")],NT);var f7;let rg=f7=class extends ve{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:i,spatialReference:(o=r==null?void 0:r.clone())!=null?o:void 0,geometryType:s};return new f7(n)}};u([ut({queryTable:"query-table"})],rg.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],rg.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],rg.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],rg.prototype,"oidFields",void 0),u([d({type:Ze,json:{write:!0}})],rg.prototype,"spatialReference",void 0),u([ut(zde)],rg.prototype,"geometryType",void 0),rg=f7=u([P("esri.layers.support.source.QueryTableDataSource")],rg);var m7;let FT=m7=class extends ve{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new m7({workspaceId:e,dataSourceName:t})}};u([ut({raster:"raster"})],FT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],FT.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],FT.prototype,"workspaceId",void 0),FT=m7=u([P("esri.layers.support.source.RasterDataSource")],FT);var g7;let V1=g7=class extends ve{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new g7({workspaceId:e,gdbVersion:t,dataSourceName:i})}};u([ut({table:"table"})],V1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],V1.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],V1.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],V1.prototype,"dataSourceName",void 0),V1=g7=u([P("esri.layers.support.source.TableDataSource")],V1);var y7,v7;const Mke=fa()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Wc=y7=class extends ve{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return mte()(e,t,i)}castLeftTableSource(e){return wp(_7(),e)}readRightTableSource(e,t,i){return mte()(e,t,i)}castRightTableSource(e){return wp(_7(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=i==null?void 0:i.clone())!=null?o:void 0,rightTableSource:(a=r==null?void 0:r.clone())!=null?a:void 0,joinType:s};return new y7(n)}};u([ut({joinTable:"join-table"})],Wc.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Wc.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],Wc.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],Wc.prototype,"leftTableSource",void 0),u([Ue("leftTableSource")],Wc.prototype,"readLeftTableSource",null),u([Rt("leftTableSource")],Wc.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],Wc.prototype,"rightTableSource",void 0),u([Ue("rightTableSource")],Wc.prototype,"readRightTableSource",null),u([Rt("rightTableSource")],Wc.prototype,"castRightTableSource",null),u([ut(Mke)],Wc.prototype,"joinType",void 0),Wc=y7=u([P("esri.layers.support.source.JoinTableDataSource")],Wc);let m6=null;function mte(){return m6||(m6=GE({types:_7()})),m6}let g6=null;function _7(){return g6||(g6={key:"type",base:null,typeMap:{"data-layer":qd,"map-layer":NT}}),g6}const Oke={key:"type",base:null,typeMap:{"join-table":Wc,"query-table":rg,raster:FT,table:V1}};let qd=v7=class extends ve{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new v7({fields:e,dataSource:t})}};u([ut({dataLayer:"data-layer"})],qd.prototype,"type",void 0),u([d({type:[YP],json:{write:!0}})],qd.prototype,"fields",void 0),u([d({types:Oke,json:{write:!0}})],qd.prototype,"dataSource",void 0),qd=v7=u([P("esri.layers.support.source.DataLayerSource")],qd),qd.from=ns(qd);function Rke(e,t){return t?me(F({},t),{query:F(F({},e),t.query)}):{query:e}}function Fye(e){return typeof e=="string"?xn(e):ie(e)}function Pke(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=Pke(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=t?o:JSON.stringify(o)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}const SI={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Tu({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ze.WebMercator}),minus180Line:new Tu({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ze.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Tu({paths:[[[180,-180],[180,180]]],spatialReference:Ze.WGS84}),minus180Line:new Tu({paths:[[[-180,-180],[-180,180]]],spatialReference:Ze.WGS84})}};function jb(e,t){return Math.ceil((e-t)/(2*t))}function kye(e,t){const i=vO(e);for(const r of i)for(const s of r)s[0]+=t;return e}function vO(e){return iw(e)?e.rings:e.paths}async function Ike(e,t,i,r){const s=typeof e=="string"?xn(e):e,n=t[0].spatialReference,o=me(F({},r),{query:me(F({},s.query),{f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:jE(t[0]),geometries:t}),cutter:JSON.stringify(i)})}),a=await gr(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=sm(h);return p.spatialReference=n,p})}}async function $ke(e,t,i){const r=typeof e=="string"?xn(e):e,s=t[0].spatialReference,n=jE(t[0]),o=me(F({},i),{query:me(F({},r.query),{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(Dke(t))})});return Lke((await gr(r.path+"/simplify",o)).data,n,s)}function Dke(e){return{geometryType:jE(e[0]),geometries:e.map(t=>t.toJSON())}}function Lke(e,t,i){const r=Bde(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}const Uye=ge.getLogger("esri.geometry.support.normalizeUtils");function Nke(e){return e.type==="polygon"}function Fke(e){return e[0].type==="polygon"}function kke(e){return e[0].type==="polyline"}function Uke(e,t){if(!(e instanceof Tu||e instanceof $u)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw Uye.error(s),new q(s)}const i=vO(e),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,y=p/t;if(y>1){for(let S=1;S<=y-1;S++){const T=S*t,E=m*T+a,C=f*T+l;n.push([E,C])}const v=(p+Math.floor(y-1)*t)/2,w=m*v+a,b=f*v+l;n.push([w,b])}n.push([c,h])}}return Nke(e)?new $u({rings:r,spatialReference:e.spatialReference}):new Tu({paths:r,spatialReference:e.spatialReference})}function gte(e,t,i){if(t){const r=Uke(e,1e6);e=FA(r,!0)}return i&&(e=kye(e,i)),e}function yte(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=jb(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=jb(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=jb(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=jb(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function zke(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=vO(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*jb(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===i){if(Fke(e))for(const a of vO(n))e[s]=e[s].addRing(a);else if(kke(e))for(const a of vO(n))e[s]=e[s].addPath(a)}else i=s,e[s]=n}return e}async function zye(e,t,i){var E;if(!Array.isArray(e))return zye([e],t);t&&typeof t!="string"&&Uye.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof t=="string"?t:(E=t==null?void 0:t.url)!=null?E:ki.geometryServiceUrl;let s,n,o,a,l,c,h,p,f=0;const m=[],y=[];for(const C of e)if(M(C))y.push(C);else if(s||(s=C.spatialReference,n=jv(s),o=s.isWebMercator,c=o?102100:4326,a=SI[c].maxX,l=SI[c].minX,h=SI[c].plus180Line,p=SI[c].minus180Line),n)if(C.type==="mesh")y.push(C);else if(C.type==="point")y.push(yte(C.clone(),a,l));else if(C.type==="multipoint"){const A=C.clone();A.points=A.points.map(I=>yte(I,a,l)),y.push(A)}else if(C.type==="extent"){const A=C.clone()._normalize(!1,!1,n);y.push(A.rings?new $u(A):A)}else if(C.extent){const A=C.extent,I=jb(A.xmin,l)*(2*a);let L=I===0?C.clone():kye(C.clone(),I);A.offset(I,0),A.intersects(h)&&A.xmax!==a?(f=A.xmax>f?A.xmax:f,L=gte(L,o),m.push(L),y.push("cut")):A.intersects(p)&&A.xmin!==l?(f=A.xmax*(2*a)>f?A.xmax*(2*a):f,L=gte(L,o,360),m.push(L),y.push("cut")):y.push(L)}else y.push(C.clone());else y.push(C);let v=jb(f,a),w=-90;const b=v,S=new Tu;for(;v>0;){const C=360*v-180;S.addPath([[C,w],[C,-1*w]]),w*=-1,v--}if(m.length>0&&b>0){const C=zke(m,await Ike(r,m,S,i)),A=[],I=[];for(let U=0;U<y.length;U++){const z=y[U];if(z!=="cut")I.push(z);else{const V=C.shift(),X=e[U];_(X)&&X.type==="polygon"&&X.rings&&X.rings.length>1&&V.rings.length>=X.rings.length?(A.push(V),I.push("simplify")):I.push(o?qg(V):V)}}if(!A.length)return I;const L=await $ke(r,A,i),D=[];for(let U=0;U<I.length;U++){const z=I[U];z!=="simplify"?D.push(z):D.push(o?qg(L.shift()):L.shift())}return D}const T=[];for(let C=0;C<y.length;C++){const A=y[C];if(A!=="cut")T.push(A);else{const I=m.shift();T.push(o===!0?qg(I):I)}}return T}function Vye(e){const t={};for(const i in e){if(i==="declaredClass")continue;const r=e[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){t[i]=[];for(let s=0;s<r.length;s++)t[i][s]=Vye(r[s])}else typeof r=="object"?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}var sv;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(sv||(sv={}));const vte=4294967296,Vke=new TextDecoder("utf-8"),Bke=he("safari")||he("ios")?6:he("ff")?12:32;class uw{constructor(t,i,r=0,s=t?t.byteLength:0){this._tag=0,this._dataType=sv.unknown,this._init(t,i,r,s)}_init(t,i,r,s){this._data=t,this._dataView=i,this._pos=r,this._end=s}clone(){return new uw(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getUint32(i+4,!0)*vte;return this._skip(8),r}getSFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getInt32(i+4,!0)*vte;return this._skip(8),r}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+t);return this._skip(t),r}getBytes(){const t=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+t);return this._skip(t),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,i,r,s){const n=this.getMessage(),o=t(n,i,r,s);return n.release(),o}processMessage(t){const i=this.getMessage(),r=t(i);return i.release(),r}getMessage(){const t=this._getLength(),i=uw.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}release(){uw.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case sv.varint:this._decodeVarint();break;case sv.fixed64:this._skip(8);break;case sv.delimited:this._skip(this._getLength());break;case sv.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let i,r=this._pos,s=0;if(this._end-r>=10)do{if(i=t[r++],s|=127&i,(128&i)==0||(i=t[r++],s|=(127&i)<<7,(128&i)==0)||(i=t[r++],s|=(127&i)<<14,(128&i)==0)||(i=t[r++],s|=(127&i)<<21,(128&i)==0)||(i=t[r++],s+=268435456*(127&i),(128&i)==0)||(i=t[r++],s+=34359738368*(127&i),(128&i)==0)||(i=t[r++],s+=4398046511104*(127&i),(128&i)==0)||(i=t[r++],s+=562949953421312*(127&i),(128&i)==0)||(i=t[r++],s+=72057594037927940*(127&i),(128&i)==0)||(i=t[r++],s+=9223372036854776e3*(127&i),(128&i)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(i=t[r],(128&i)!=0);)++r,s+=(127&i)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,s+=i*n}return this._pos=r,s}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==sv.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,i,r){if((r=Math.min(this._end,r))-i>Bke){const o=t.subarray(i,r);return Vke.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,i,r){return r=Math.min(this._end,r),new Uint8Array(t.buffer,i,r-i)}}uw.pool=new Es(uw,null,e=>{e._data=null,e._dataView=null});class El{constructor(t=[],i=[],r=!1){this.lengths=t!=null?t:[],this.coords=i!=null?i:[],this.hasIndeterminateRingOrder=r}static fromRect(t){const[i,r,s,n]=t,o=s-i,a=n-r;return new El([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,i)=>t+i)}forEachVertex(t){let i=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)t(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(t){return t?(t.set(this.coords),new El(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new El(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class pm{constructor(t=null,i={},r,s){this.geometry=t,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new pm(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function Gke(e){return!(M(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class bTt extends pm{}class Ak{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new Ak;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const Bye=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class wTt{constructor(t){this.options=t,this.geometryTypes=Bye,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new Ak}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||Rc(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const i=z2(this.options.sourceSpatialReference)/z2(t.spatialReference);if(i!==1)for(const r of t.features){if(!Gke(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(t,i){t.features.push(i)}createFeature(){return new pm}createSpatialReference(){return{wkid:0}}createGeometry(){return new El}addField(t,i){t.fields.push(i)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,i){t.coords[this._coordinatePtr++]=i}addCoordinatePoint(t,i){t.coords.push(i)}addLength(t,i){t.lengths.push(i)}addQueryGeometry(t,i){t.queryGeometry=i.queryGeometry,t.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new El}}const _te=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],bte=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],wte=["upperLeft","lowerLeft"];function xte(e){return e>=_te.length?null:_te[e]}function jke(e){return e>=bte.length?null:bte[e]}function Tte(e){return e>=wte.length?null:wte[e]}function Ste(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function Hke(e,t,i){const s=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const n=e.getUInt32(),o=e.pos()+n;let a=0;for(;e.pos()<o;)t.addCoordinatePoint(s,e.getSInt64(),a++);break}default:e.skip()}return s}function qke(e,t,i){const n=t.createGeometry(i),o=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(;e.pos()<l;)t.addLength(n,e.getUInt32(),c++);break}case 3:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(t.allocateCoordinates(n);e.pos()<l;)t.addCoordinate(n,e.getSInt64(),c),c++,c===o&&(c=0);break}default:e.skip()}return n}function Wke(e){const s=new El;let n="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.lengths.push(e.getUInt32());break}case 3:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.coords.push(e.getSInt64());break}case 1:n=Bye[e.getEnum()];break;default:e.skip()}return{queryGeometry:s,queryGeometryType:n}}function Xke(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function Yke(e){const a={type:xte(0)};for(;e.next();)switch(e.tag()){case 1:a.name=e.getString();break;case 2:a.type=xte(e.getEnum());break;case 3:a.alias=e.getString();break;case 4:a.sqlType=jke(e.getEnum());break;case 5:e.skip();break;case 6:a.defaultValue=e.getString();break;default:e.skip()}return a}function Zke(e){const r={};for(;e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.isSystemMaintained=e.getBool();break;default:e.skip()}return r}function Qke(e,t,i,r){const a=t.createFeature(i);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=r[l++].name;a.attributes[c]=e.processMessage(Xke);break}case 2:a.geometry=e.processMessageWithArgs(qke,t,i);break;case 4:a.centroid=e.processMessageWithArgs(Hke,t,i);break;default:e.skip()}return a}function Jke(e){const n=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function Kke(e){const n=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function eUe(e){const s={originPosition:Tte(0)};for(;e.next();)switch(e.tag()){case 1:s.originPosition=Tte(e.getEnum());break;case 2:s.scale=e.processMessage(Jke);break;case 3:s.translate=e.processMessage(Kke);break;default:e.skip()}return s}function tUe(e){const s={};for(;e.next();)switch(e.tag()){case 1:s.shapeAreaFieldName=e.getString();break;case 2:s.shapeLengthFieldName=e.getString();break;case 3:s.units=e.getString();break;default:e.skip()}return s}function iUe(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function rUe(e,t){const v=t.createFeatureResult();v.geometryType=Ste(t,0);let w=!1;for(;e.next();)switch(e.tag()){case 1:v.objectIdFieldName=e.getString();break;case 3:v.globalIdFieldName=e.getString();break;case 4:v.geohashFieldName=e.getString();break;case 5:v.geometryProperties=e.processMessage(tUe);break;case 7:v.geometryType=Ste(t,e.getEnum());break;case 8:v.spatialReference=e.processMessageWithArgs(iUe,t);break;case 10:v.hasZ=e.getBool();break;case 11:v.hasM=e.getBool();break;case 12:v.transform=e.processMessage(eUe);break;case 9:{const b=e.getBool();v.exceededTransferLimit=b;break}case 13:t.addField(v,e.processMessage(Yke));break;case 15:w||(t.prepareFeatures(v),w=!0),t.addFeature(v,e.processMessageWithArgs(Qke,t,v,v.fields));break;case 2:v.uniqueIdField=e.processMessage(Zke);break;default:e.skip()}return t.finishFeatureResult(v),v}function sUe(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(Wke);break;case 1:s.featureResult=e.processMessageWithArgs(rUe,t);break;default:e.skip()}return _(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function nUe(e,t){try{const r=new uw(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(sUe,t):r.skip();return s}catch(i){throw new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function oUe(e,t){const i=nUe(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function b7(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=ime(i.geometryType,t,e.outSpatialReference);if(!M(r))for(const s of i.features)r(s.geometry)}const Ete="Layer does not support extent calculation.";function Gye(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function jye(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(_(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=jE(i),s.geometry=Gye(i,e.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=r.outSR.wkid||JSON.stringify(r.outSR),n=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&_(o)&&_(e.quantizationParameters)&&_(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c==null?"null":c},${h==null?"null":h}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&_(o)&&_(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function Hye(e,t,i,r){const s=_(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await tC(e,t,"json",r);return b7(t,i,s.data),s}async function aUe(e,t,i,r){if(_(t.timeExtent)&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await qye(e,t,r),n=s;return n.data=oUe(s.data,i),n}function qye(e,t,i){return tC(e,t,"pbf",i)}function lUe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):tC(e,t,"json",i,{returnIdsOnly:!0})}function cUe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):tC(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function uUe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):tC(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(Ete);if(s.hasOwnProperty("count"))throw new Error(Ete);return r})}function tC(e,t,i,r={},s={}){const n=typeof e=="string"?xn(e):e,o=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",zye(o,null,r).then(a=>{const l=a&&a[0];_(l)&&((t=t.clone()).geometry=l);const c=Vye(F(F(me(F({},n.query),{f:i}),s),jye(t,s)));return gr(Nu(n.path,"query"),me(F({},r),{query:F(F({},c),r.query)}))})}var xTt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",encodeGeometry:Gye,executeQuery:Hye,executeQueryForCount:cUe,executeQueryForExtent:uUe,executeQueryForIds:lUe,executeQueryPBF:aUe,executeQueryPBFBuffer:qye,queryToQueryStringParameters:jye,runQuery:tC}),w7;const x7=new wi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Ro=w7=class extends ve{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const i=Ze.fromJSON(t.spatialReference),r=[];for(let n=0;n<e.length;n++){const o=e[n],a=Ga.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;_(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&_(h))for(const p in h){const f=h[p],m=(s=c[p])==null?void 0:s.spatialReference;_(f)&&!m&&(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(e,t,i,r){if(e)return void x7.write(e,t,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&_(n.geometry))return void x7.write(n.geometry.type,t,i,r)}}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=sm(e);return!i&&t.spatialReference&&(r.spatialReference=Ze.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&_(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new w7(this.cloneProperties())}cloneProperties(){return ie({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const s=e&&e[i];r.geometry=s&&s.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=c=>Math.round((c-r)/t),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)_(h)&&c(h);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=t(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return e==="point"?r=>(r.x=t(r.x),r.y=i(r.y),r):e==="polyline"||e==="polygon"?r=>{const s=iw(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,i);c&&n.push(c)}return n.length>0?(iw(r)?r.rings=n:r.paths=n,r):null}:e==="multipoint"?r=>{const s=this._quantizePoints(r.points,t,i);return s.length>0?(r.points=s,r):null}:e==="extent"?r=>r:null}_getHydrationFunction(e,t,i){return e==="point"?r=>{r.x=t(r.x),r.y=i(r.y)}:e==="polyline"||e==="polygon"?r=>{const s=iw(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=i(o)}}}:e==="extent"?r=>{r.xmin=t(r.xmin),r.ymin=i(r.ymin),r.xmax=t(r.xmax),r.ymax=i(r.ymax)}:e==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=i(o)}}:void 0}};u([d({type:String,json:{write:!0}})],Ro.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ro.prototype,"exceededTransferLimit",void 0),u([d({type:[Ga],json:{write:!0}})],Ro.prototype,"features",void 0),u([Ue("features")],Ro.prototype,"readFeatures",null),u([d({type:[YP],json:{write:!0}})],Ro.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:x7.read}}})],Ro.prototype,"geometryType",void 0),u([Be("geometryType")],Ro.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ro.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ro.prototype,"hasZ",void 0),u([d({types:nx,json:{write:!0}})],Ro.prototype,"queryGeometry",void 0),u([Ue("queryGeometry")],Ro.prototype,"readQueryGeometry",null),u([d({type:Ze,json:{write:!0}})],Ro.prototype,"spatialReference",void 0),u([Be("spatialReference")],Ro.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Ro.prototype,"transform",void 0),Ro=w7=u([P("esri.rest.support.FeatureSet")],Ro),Ro.prototype.toJSON.isDefaultToJSON=!0;const Mk=Ro;var TTt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Mk});const Cte={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},hUe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function dUe(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}function Hh(e,t,i){const r=new Date(e.getTime());if(t&&i){const s=hUe[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=dUe(r.getFullYear(),r.getMonth()+t);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+t*a)}return r}function Ate(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function pUe(e,t,i="milliseconds"){const r=new Date(Lv(t,i,"milliseconds"));return r.setUTCFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),r}function fUe(e,t="milliseconds"){const i=Lv(e.getUTCHours(),"hours","milliseconds"),r=Lv(e.getUTCMinutes(),"minutes","milliseconds"),s=Lv(e.getUTCSeconds(),"seconds","milliseconds");return Lv(i+r+s+e.getUTCMilliseconds(),"milliseconds",t)}function mUe(e,t){const i=new Date(e.getTime());return i.setUTCFullYear(t.getFullYear(),t.getMonth(),t.getDate()),i}function gUe(e){const t=new Date(0);return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t}function Lv(e,t,i){return e===0?0:e*Cte[t]/Cte[i]}var Md;let ru=Md=class extends ve{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return Mte}static get empty(){return yUe}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(Md.allTime)}get isEmpty(){return this.equals(Md.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new Md({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=_(this.start)?this.start.getTime():this.start,i=_(this.end)?this.end.getTime():this.end,r=_(e.start)?e.start.getTime():e.start,s=_(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=Qi(this.start,r=>Ate(r,e)),i=Qi(this.end,r=>Hh(Ate(r,e),1,e));return new Md({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return Md.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=fu(this.start,-1/0,a=>a.getTime()),i=fu(this.end,1/0,a=>a.getTime()),r=fu(e.start,-1/0,a=>a.getTime()),s=fu(e.end,1/0,a=>a.getTime());let n,o;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?o=i:s>=t&&s<=i&&(o=s),!isNaN(n)&&!isNaN(o)){const a=new Md;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Md.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new Md,{start:r,end:s}=this;return _(r)&&(i.start=Hh(r,e,t)),_(s)&&(i.end=Hh(s,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return Mte.clone();const t=_(this.start)&&_(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=_(this.end)&&_(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new Md({start:t,end:i})}};u([d({type:Date,json:{write:{allowNull:!0}}})],ru.prototype,"end",void 0),u([Ue("end")],ru.prototype,"readEnd",null),u([Be("end")],ru.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],ru.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],ru.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],ru.prototype,"start",void 0),u([Ue("start")],ru.prototype,"readStart",null),u([Be("start")],ru.prototype,"writeStart",null),ru=Md=u([P("esri.TimeExtent")],ru);const Mte=new ru,yUe=new ru({start:void 0,end:void 0}),Em=ru;var T7;const Ote=new wi({upperLeft:"upper-left",lowerLeft:"lower-left"});let B1=T7=class extends ve{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new T7(ie({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:ui,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],B1.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],B1.prototype,"mode",void 0),u([d({type:String,json:{read:Ote.read,write:Ote.write}})],B1.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],B1.prototype,"tolerance",void 0),B1=T7=u([P("esri.rest.support.QuantizationParameters")],B1);const vUe=B1;var S7;const Rte=new wi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Od=S7=class extends ve{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=ie(e))}clone(){return new S7({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ie(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],Od.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],Od.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],Od.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],Od.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],Od.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:Rte.read},write:{target:"statisticType",writer:Rte.write}}})],Od.prototype,"statisticType",void 0),u([d({type:Object})],Od.prototype,"statisticParameters",void 0),u([Be("statisticParameters")],Od.prototype,"writeStatisticParameters",null),Od=S7=u([P("esri.rest.support.StatisticDefinition")],Od);const Wye=Od;var r2;const _Ue=new wi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),bUe=new wi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Mt=r2=class extends ve{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return E2(r2,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new r2(ie({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:_(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Mt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],Mt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],Mt.prototype,"datumTransformation",void 0),u([Rt("datumTransformation")],Mt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Mt.prototype,"distance",void 0),u([d({type:qd,json:{write:!0}})],Mt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"formatOf3DObjects",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"gdbVersion",void 0),u([d({types:nx,json:{read:sm,write:!0}})],Mt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Mt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"having",void 0),u([d({type:Date})],Mt.prototype,"historicMoment",void 0),u([Be("historicMoment")],Mt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Mt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:e=>e<1?1:e>r2.MAX_MAX_RECORD_COUNT_FACTOR?r2.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],Mt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],Mt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Mt.prototype,"num",void 0),u([d({json:{write:!0}})],Mt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"outFields",void 0),u([d({type:Ze,json:{name:"outSR",write:!0}})],Mt.prototype,"outSpatialReference",void 0),u([d({type:[Wye],json:{write:{enabled:!0,overridePolicy(){return{enabled:_(this.outStatistics)&&this.outStatistics.length>0}}}}})],Mt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],Mt.prototype,"parameterValues",void 0),u([Be("parameterValues")],Mt.prototype,"writeParameterValues",null),u([d({type:at,json:{write:!0}})],Mt.prototype,"pixelSize",void 0),u([d({type:vUe,json:{write:!0}})],Mt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],Mt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Mt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],Mt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mt.prototype,"returnZ",void 0),u([d({type:Ze,json:{write:!0}})],Mt.prototype,"sourceSpatialReference",void 0),u([ut(_Ue,{ignoreUnknown:!1,name:"spatialRel"})],Mt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Mt.prototype,"start",void 0),u([Be("start"),Be("num")],Mt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],Mt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"text",void 0),u([d({type:Em,json:{write:!0}})],Mt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"timeReferenceUnknownClient",void 0),u([ut(bUe,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Mt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],Mt.prototype,"where",void 0),u([Be("where")],Mt.prototype,"writeWhere",null),Mt=r2=u([P("esri.rest.support.Query")],Mt);const Kd=Mt;async function y6(e,t,i){const r=await wUe(e,t,i);return Mk.fromJSON(r)}async function wUe(e,t,i){const r=Fye(e),s=F({},i),n=Kd.from(t),{data:o}=await Hye(r,n,n.sourceSpatialReference,s);return o}function pa(e,t){return e?t?4:3:t?3:2}const ZP=ge.getLogger("esri.layers.graphics.featureConversionUtils"),Xye={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},Yye=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},s4=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},xUe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},Zye=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function yY(e,t,i,r){if(e){if(i)return t&&r?Zye:s4;if(t&&r)return xUe}else if(t&&r)return s4;return Yye}function v6({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function _6({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function Pte({scale:e,translate:t},i){return i*e[0]+t[0]}function Ite({scale:e,translate:t},i){return t[1]-i*e[1]}function STt(e,t,i){return e?t?i?bY(e):vY(e):i?_Y(e):Ok(e):null}function Ok(e){const t=e.coords;return{x:t[0],y:t[1]}}function Qye(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function vY(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function TUe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function _Y(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function SUe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function bY(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function EUe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function CUe(e,t,i,r){let s=Ok;i&&r?s=bY:i?s=vY:r&&(s=_Y);for(const n of t){const{geometry:o,attributes:a}=n,l=_(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function wY(e,t){return e&&t?EUe:e?TUe:t?SUe:Qye}function AUe(e,t,i,r,s){const n=wY(i,r);for(const o of t){const{geometry:a,attributes:l}=o;let c;a&&(c=n(new El,a)),e.push(new pm(c,l,null,l[s]))}return e}function ETt(e,t,i=wY(t.z!=null,t.m!=null)){return i(e,t)}function MUe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;n&&(a=Jye(n,i,r)),e.push({attributes:o,geometry:a})}return e}function Jye(e,t,i){if(M(e))return null;const r=pa(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(e.coords[n+a]);s.push(o)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function OUe(e,t,i,r,s){const n=pa(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=Kye(new El,a,n)),e.push(new pm(c,l,null,l[s]))}return e}function Kye(e,t,i=pa(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let o=0;o<i;o++)r[s++]=n[o];return e}function RUe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;_(n)&&(a=e0e(n,i,r)),e.push({attributes:o,geometry:a})}return e}function e0e(e,t,i){if(!e)return null;const r=pa(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function PUe(e,t,i,r,s){const n=pa(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=t0e(new El,a,n)),e.push(new pm(c,l,null,l[s]))}return e}function t0e(e,t,i=pa(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return e}function IUe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o,centroid:a}=s;let l;if(_(n)&&(l=i0e(n,i,r)),_(a)){const c=Ok(a);e.push({attributes:o,centroid:c,geometry:l})}else e.push({attributes:o,geometry:l})}return e}function i0e(e,t,i){if(!e)return null;const r=pa(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function $Ue(e,t,i,r,s){for(const n of t){const o=n.geometry,a=n.centroid,l=n.attributes;let c;o&&(c=r0e(new El,o,i,r)),_(a)?e.push(new pm(c,l,Qye(new El,a),l[s])):e.push(new pm(c,l,null,l[s]))}return e}function r0e(e,t,i=t.hasZ,r=t.hasM){return DUe(e,t.rings,i,r),e}function DUe(e,t,i,r){const s=pa(i,r),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const s2=[],_O=[];function CTt(e,t,i,r,s){s2[0]=e;const[n]=s0e(_O,s2,t,i,r,s);return s2.length=_O.length=0,n}function s0e(e,t,i,r,s,n){if(e.length=0,!i){for(const o of t){const a=o.attributes[n];e.push(new pm(null,o.attributes,null,a))}return e}switch(i){case"esriGeometryPoint":return AUe(e,t,r,s,n);case"esriGeometryMultipoint":return OUe(e,t,r,s,n);case"esriGeometryPolyline":return PUe(e,t,r,s,n);case"esriGeometryPolygon":return $Ue(e,t,r,s,n);default:ZP.error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function ATt(e,t,i,r){_O[0]=e,n0e(s2,_O,t,i,r);const s=s2[0];return s2.length=_O.length=0,s}function LUe(e,t,i){if(M(e))return null;const r=new El;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&i==null&&(i=e.hasM),LW(e)?wY(t!=null?t:e.z!=null,i!=null?i:e.m!=null)(r,e):iw(e)?r0e(r,e,t,i):NW(e)?t0e(r,e,pa(t,i)):DW(e)?Kye(r,e,pa(t,i)):void ZP.error("convertFromGeometry:unknown-geometry",new q(`Unable to parse unknown geometry type '${e}'`))}function NUe(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(M(s))return null;switch(t){case"esriGeometryPoint":{let n=Ok;return i&&r?n=bY:i?n=vY:r&&(n=_Y),n(s)}case"esriGeometryMultipoint":return Jye(s,i,r);case"esriGeometryPolyline":return e0e(s,i,r);case"esriGeometryPolygon":return i0e(s,i,r);default:return void ZP.error("convertToGeometry:unknown-geometry",new q(`Unable to parse unknown geometry type '${t}'`))}}function FUe(e,t){for(const i of t)e.push({attributes:i.attributes});return e}function n0e(e,t,i,r,s){if(e.length=0,M(i))return FUe(e,t);switch(i){case"esriGeometryPoint":return CUe(e,t,r,s);case"esriGeometryMultipoint":return MUe(e,t,r,s);case"esriGeometryPolyline":return RUe(e,t,r,s);case"esriGeometryPolygon":return IUe(e,t,r,s);default:ZP.error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${i}'`))}return e}function MTt(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=e,m={features:n0e([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:h,queryGeometry:NUe(p,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function OTt(e,t){const i=new Ak,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(i.fields=p),i.geometryType=l,i.objectIdFieldName=o||t,i.spatialReference=a,i.objectIdFieldName?(n&&s0e(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(ZP.error(new q("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function RTt(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)_(n.geometry)&&Dte(n.geometry,n.geometry,r,s,t),_(n.centroid)&&Dte(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function PTt(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new El,$te(l.geometry,a.geometry,s,n,i,e),a.centroid&&(l.centroid=new El,$te(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),r[o]=l}return t.transform=e,t}function $te(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),M(t)||!t.coords.length)return null;const l=Xye[s],{coords:c,lengths:h}=t,p=pa(i,r),f=pa(i&&o,r&&a),m=yY(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,v6(n,c[0]),_6(n,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y,v,w,b,S=0,T=0,E=T;for(const C of h){if(C<l)continue;let A=0;T=E,w=y=v6(n,c[S]),b=v=_6(n,c[S+1]),m(e.coords,c,T,S,w,b),A++,S+=p,T+=f;for(let I=1;I<C;I++,S+=p)w=v6(n,c[S]),b=_6(n,c[S+1]),w===y&&b===v||(m(e.coords,c,T,S,w-y,b-v),T+=f,A++,y=w,v=b);A>=l&&(e.lengths.push(A),E=T)}return e.coords.length=E,e.coords.length?e:null}function ITt(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=Xye[s],{coords:c,lengths:h}=t,p=pa(i,r),f=pa(i&&o,r&&a),m=yY(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y=0;const v=n*n;for(const w of h){if(w<l){y+=w*p;continue}const b=e.coords.length/f,S=y,T=y+(w-1)*p;m(e.coords,c,e.coords.length,S,c[S],c[S+1]),E7(e.coords,c,p,v,m,S,T),m(e.coords,c,e.coords.length,T,c[T],c[T+1]);const E=e.coords.length/f-b;E>=l?e.lengths.push(E):e.coords.length=b*f,y+=w*p}return e.coords.length?e:null}function kUe(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function E7(e,t,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=kUe(t,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&E7(e,t,i,r,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>i&&E7(e,t,i,r,s,c,o))}function $Tt(e,t,i,r){if(M(t)||!t.coords||!t.coords.length)return null;const s=pa(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function Dte(e,t,i,r,s){const{coords:n,lengths:o}=t,a=i?r?Zye:s4:r?s4:Yye,l=pa(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,Pte(s,n[0]),Ite(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=s.scale;let p=0;for(let f=0;f<o.length;f++){const m=o[f];e.lengths[f]=m;let y=Pte(s,n[p]),v=Ite(s,n[p+1]);a(e.coords,n,p,p,y,v),p+=l;for(let w=1;w<m;w++,p+=l)y+=n[p]*c,v-=n[p+1]*h,a(e.coords,n,p,p,y,v)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function DTt(e,t,i,r,s,n){const o=pa(i,r),a=yY(i,r,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function UUe(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const l=n+e[r*(t+a)],c=o+e[r*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function LTt(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let o=0;o<r.length;o++)n+=UUe(i,s,r[o],t),s+=o;return Math.abs(n)}function NTt(e,t){if(M(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[t*n],c=r[t*n+1];for(let h=1;h<a;h++){const p=l+r[t*(n+h)],f=c+r[t*(n+h)+1];i.coords[t*(n+h)]=p,i.coords[t*(n+h)+1]=f,l=p,c=f}n+=a}return i}var C7;let _s=C7=class extends ve{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new C7(ie({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],_s.prototype,"cacheHint",void 0),u([d({type:qd,json:{write:!0}})],_s.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],_s.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],_s.prototype,"geometryPrecision",void 0),u([d({type:Date})],_s.prototype,"historicMoment",void 0),u([Be("historicMoment")],_s.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],_s.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],_s.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],_s.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],_s.prototype,"outFields",void 0),u([d({type:Ze,json:{read:{source:"outSR"},write:{target:"outSR"}}})],_s.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],_s.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],_s.prototype,"start",void 0),u([Be("start"),Be("num")],_s.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],_s.prototype,"num",void 0),u([d({json:{write:!0}})],_s.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_s.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_s.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],_s.prototype,"where",void 0),_s=C7=u([P("esri.rest.support.RelationshipQuery")],_s),_s.from=ns(_s);const A7=_s;var M7;let kT=M7=class extends ve{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new M7({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],kT.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],kT.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],kT.prototype,"orderByFields",void 0),kT=M7=u([P("esri.rest.support.TopFilter")],kT);const zUe=kT;var O7;const Lte=new wi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Nte=new wi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let es=O7=class extends ve{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new O7(ie({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],es.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],es.prototype,"distance",void 0),u([d({types:nx,json:{read:sm,write:!0}})],es.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],es.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],es.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],es.prototype,"num",void 0),u([d({json:{write:!0}})],es.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],es.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],es.prototype,"outFields",void 0),u([d({type:Ze,json:{read:{source:"outSR"},write:{target:"outSR"}}})],es.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],es.prototype,"resultType",void 0),u([d({json:{write:!0}})],es.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],es.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],es.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],es.prototype,"start",void 0),u([Be("start"),Be("num")],es.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:Lte.read},write:{target:"spatialRel",writer:Lte.write}}})],es.prototype,"spatialRelationship",void 0),u([d({type:Em,json:{write:!0}})],es.prototype,"timeExtent",void 0),u([d({type:zUe,json:{write:!0}})],es.prototype,"topFilter",void 0),u([d({type:String,json:{read:Nte.read,write:{writer:Nte.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],es.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],es.prototype,"where",void 0),es=O7=u([P("esri.rest.support.TopFeaturesQuery")],es),es.from=ns(es);const EI=es,VUe="esri.widgets.Feature.support.relatedFeatureUtils",Fte=ge.getLogger(VUe),kte=new Map;function R7(e){if(!Ug(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function BUe(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function GUe({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some(s=>(`${s.relatedTableId}`===i&&s.id===e.id&&(r=s),!!r)),r}function jUe(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}function HUe(e,t){const i=BUe(e,t);if(!!i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function qUe(e,t){if(!t||!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}function WUe(e,t,i,r){const s=new A7;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}function XUe(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function YUe(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t,p=GUe({originRelationship:o,relationships:n.relationships,layerId:s});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await WUe(e,p,i,r))[e.attributes[i.objectIdField]];if(!m)return null;const y=m.features.map(v=>v.attributes[n.objectIdField]);if((l==null?void 0:l.length)>0&&n.supportsStatistics){const v=new Kd;v.where=XUe(n.objectIdField,y,1e3),v.outFields=a,v.outStatistics=l,v.sourceSpatialReference=h;const w={features:Promise.resolve(m),statsFeatures:y6(c,v)};return Sn(w)}}const f=p==null?void 0:p.keyField;if(f){const m=k5(eze(n.fields,f)),y=jUe(e.attributes,o.keyField),v=m?`${f}=${y}`:`${f}='${y}'`,w=y6(c,new Kd({where:v,outFields:t.relatedFields,sourceSpatialReference:h}),r),b=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?y6(c,new Kd({where:v,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),r):null,S={features:w};return b&&(S.statsFeatures=b),Sn(S)}return null}function ZUe(e,t){return gr(e,{query:{f:"json"},signal:t&&t.signal})}function QUe({relatedInfos:e,layer:t},i){const r={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new q("relation-required","A relation is required on a layer to retrieve related records.");throw Fte.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new q("A related table ID is required on a layer to retrieve related records.");throw Fte.error(p),p}const l=`${t.url}/${a}`,c=kte.get(l),h=c||ZUe(l,i);c||kte.set(l,h),r[n]=h}),Sn(r)}function JUe({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=YUe(e,n,i,r))}),Sn(s)}function KUe({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new Wye({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}function eze(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const Ute={chartAnimation:!0};let Zn=class extends Se{constructor(e){super(e),this.abilities=F({},Ute),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return F(F({},Ute),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(o=>{const a=o==null?void 0:o.clone();if(!a)return null;if(a.title=Gb({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.title}),a.caption=Gb({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.caption}),a.altText=Gb({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.altText}),a.type==="image"){const{value:l}=a;return this._setImageValue({value:l,formattedAttributes:i,layer:n}),a.value.sourceURL?a:void 0}if(a.type==="pie-chart"||a.type==="line-chart"||a.type==="column-chart"||a.type==="bar-chart"){const{value:l}=a;return this._setChartValue({value:l,chartType:a.type,attributes:e,formattedAttributes:i,layer:n}),a}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const a=n7(o,s);i.sourceURL=s7({formattedAttributes:r,template:a,fieldInfoMap:t})}if(n){const a=n7(n,s);i.linkURL=s7({formattedAttributes:r,template:a,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=w4e(l,n),c&&(t.normalizeField=t4(c,n)),!l.some(p=>!!(r[p]!=null||Ug(p)&&a.size)))return;const h=o==null?void 0:o.fieldInfos;l.forEach(p=>{if(Ug(p))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:p,formattedAttributes:r,chartType:s,value:t})]);const f=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:p,fieldInfos:h});t.series.push(f)})}_getRelatedChartInfos(e){var y;const{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n}=e,o=[],a=R7(i),{layerId:l,fieldName:c}=a,h=(y=this.relatedInfos)==null?void 0:y.get(l.toString());if(!h)return o;const{relatedFeatures:p,relation:f}=h;if(!f||!p)return o;const{cardinality:m}=f;return p.forEach(v=>{const{attributes:w}=v;w&&Object.keys(w).forEach(b=>{b===c&&o.push(this._getChartOption({value:n,attributes:w,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:b,fieldInfos:t}))})}),m==="one-to-many"||m==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var T,E,C,A,I,L;const{value:t,attributes:i,formattedAttributes:r,fieldName:s,relatedFieldName:n,fieldInfos:o,chartType:a}=e,{layer:l,fieldInfoMap:c}=this,{normalizeField:h,tooltipField:p}=t,f=h?Ug(h)?i[R7(h).fieldName]:i[h]:null,m=n&&i[n]!==void 0?i[n]:i[s]!==void 0?i[s]:r[s],y=new npe({fieldName:s,value:m===void 0?null:m&&f?m/f:m});if(Ug(s)){const D=c.get(s.toLowerCase()),U=c.get(p.toLowerCase()),z=(T=D==null?void 0:D.fieldName)!=null?T:s,V=(I=(A=(C=r[(E=U==null?void 0:U.fieldName)!=null?E:p])!=null?C:D==null?void 0:D.label)!=null?A:D==null?void 0:D.fieldName)!=null?I:n,X=r[z];return y.tooltip=this._getTooltip({label:V,value:X,chartType:a}),y}const v=yye(o,s),w=t4(s,l),b=p&&r[p]!==void 0?r[p]:mye(v||new LP({fieldName:w}),(L=this.popupTemplate)==null?void 0:L.expressionInfos),S=r[w];return y.tooltip=this._getTooltip({label:b,value:S,chartType:a}),y}};u([d()],Zn.prototype,"abilities",void 0),u([Rt("abilities")],Zn.prototype,"castAbilities",null),u([d()],Zn.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],Zn.prototype,"activeMediaInfo",null),u([d()],Zn.prototype,"attributes",void 0),u([d()],Zn.prototype,"description",void 0),u([d()],Zn.prototype,"fieldInfoMap",void 0),u([d()],Zn.prototype,"formattedAttributes",void 0),u([d()],Zn.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],Zn.prototype,"formattedMediaInfos",null),u([d()],Zn.prototype,"layer",void 0),u([d({readOnly:!0})],Zn.prototype,"formattedMediaInfoCount",null),u([d()],Zn.prototype,"mediaInfos",void 0),u([d()],Zn.prototype,"popupTemplate",void 0),u([d()],Zn.prototype,"relatedInfos",void 0),u([d()],Zn.prototype,"title",void 0),Zn=u([P("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Zn);const Hb=Zn;var zte=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],tze=[].concat(zte.slice(30,39),zte.slice(28,30).reverse()),ize=[{name:"default",colors:tze},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Vte="en-us",xY=new Map([["ar",()=>import("./ar.4312625a.js").then(e=>e.a)],["bg-bg",()=>import("./bg_BG.652fb750.js").then(e=>e.b)],["bs-ba",()=>import("./bs_BA.9d7c5c87.js").then(e=>e.b)],["ca-es",()=>import("./ca_ES.e56560f8.js").then(e=>e.c)],["cs-cz",()=>import("./cs_CZ.dc302f62.js").then(e=>e.c)],["da-dk",()=>import("./da_DK.04e274f8.js").then(e=>e.d)],["de-de",()=>import("./de_DE.d87bfc44.js").then(e=>e.d)],["de-ch",()=>import("./de_CH.63231977.js").then(e=>e.d)],["el-gr",()=>import("./el_GR.3e5d53c4.js").then(e=>e.e)],["en-us",()=>import("./en_US.48bcbb4b.js").then(e=>e.e)],["en-ca",()=>import("./en_CA.38d4fb80.js").then(e=>e.e)],["es-es",()=>import("./es_ES.8480d2b6.js").then(e=>e.e)],["et-ee",()=>import("./et_EE.88e99510.js").then(e=>e.e)],["fi-fi",()=>import("./fi_FI.404a5c87.js").then(e=>e.f)],["fr-fr",()=>import("./fr_FR.09f90a95.js").then(e=>e.f)],["he-il",()=>import("./he_IL.9b8e6478.js").then(e=>e.h)],["hr-hr",()=>import("./hr_HR.5852e6b2.js").then(e=>e.h)],["hu-hu",()=>import("./hu_HU.4fbe5f07.js").then(e=>e.h)],["id-id",()=>import("./id_ID.55b3d13b.js").then(e=>e.i)],["it-it",()=>import("./it_IT.b6bb1479.js").then(e=>e.i)],["ja-jp",()=>import("./ja_JP.f5fbcde4.js").then(e=>e.j)],["ko-kr",()=>import("./ko_KR.def1433e.js").then(e=>e.k)],["lt-lt",()=>import("./lt_LT.bfe77681.js").then(e=>e.l)],["lv-lv",()=>import("./lv_LV.72145036.js").then(e=>e.l)],["nb-no",()=>import("./nb_NO.0b97b865.js").then(e=>e.n)],["nl-nl",()=>import("./nl_NL.071e1fe9.js").then(e=>e.n)],["pl-pl",()=>import("./pl_PL.cd6ee80d.js").then(e=>e.p)],["pt-br",()=>import("./pt_BR.fda94313.js").then(e=>e.p)],["pt-pt",()=>import("./pt_PT.30c69353.js").then(e=>e.p)],["ro-ro",()=>import("./ro_RO.cdf98d25.js").then(e=>e.r)],["ru-ru",()=>import("./ru_RU.716dd811.js").then(e=>e.r)],["sk-sk",()=>import("./sk_SK.eb904f11.js").then(e=>e.s)],["sl-sl",()=>import("./sl_SL.ecd88fd0.js").then(e=>e.s)],["sr-rs",()=>import("./sr_RS.23db432f.js").then(e=>e.s)],["sv-se",()=>import("./sv_SE.e0234649.js").then(e=>e.s)],["th-th",()=>import("./th_TH.b76a0815.js").then(e=>e.t)],["tr-tr",()=>import("./tr_TR.3e3e9b62.js").then(e=>e.t)],["uk-ua",()=>import("./uk_UA.fb685ce9.js").then(e=>e.u)],["vi-vn",()=>import("./vi_VN.4642ebfe.js").then(e=>e.v)],["zh-cn",()=>import("./zh_Hans.34e8499d.js").then(e=>e.z)],["zh-hk",()=>import("./zh_Hant.30215610.js").then(e=>e.z)],["zh-tw",()=>import("./zh_Hant.30215610.js").then(e=>e.z)]]);function rze(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of xY.keys())if(r.startsWith(t)){i=r;break}return i}function sze(e){return e?xY.has(e.toLowerCase())?e.toLowerCase():rze(e)||Vte:Vte}let Cx,IC;async function nze(e=ua()){if(e=sze(e),Cx&&e===IC)return Cx;Cx=import("./index.baa95b2c.js").then(t=>t.i),IC=e;try{const[t,i]=await Promise.all([Cx,xY.get(IC)()]);IC===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Cx=null,IC=null,null}return Cx}function oze(e,t="default"){const i=ize.find(r=>r.name===t);return i?i.colors.map(r=>e.color(r)):null}const Ms={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},b6=.05,w6=.95,x6=15,Lm="color",Gy="tooltip",$C="value",Bte="default-line-value";let Wl=class extends Xs{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new Hb,this.messages=null,this._getChartDependencies=async i=>{const r=await nze(),{destroyed:s,viewModel:n}=this;if(s||!n||!i)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(r);this._renderChart({chartDiv:i,mediaInfo:o,chartsModule:r,colorMap:a})}}initialize(){this._featureElementInfo=new lY,this.own([se(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),At),se(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),At)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return W("div",{bind:this,class:Ms.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?W("div",{key:"media-element-container",class:Ms.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=pye(h)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",m=n?t:null,y=m?m.timestamp:0,v=m?m.sourceURL:c,w=W("img",{alt:o||a,key:`media-${l}-${i}-${r}-${y}`,src:v});return(h?W("a",{title:a,href:h,rel:f,target:p},w):null)||w}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return W("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:Ms.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?W("div",{key:"media-title",class:Ms.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?W("div",{key:"media-caption",class:Ms.mediaItemCaption,innerHTML:e.caption}):null;return W("div",{key:"media-container",class:Ms.mediaItemContainer},W("div",{key:"media-item-container",class:Ms.mediaItem},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?this.classes(Ms.mediaButton,Ms.mediaPrevious):this.classes(Ms.mediaButton,Ms.mediaNext),s=t?this.classes(Ms.mediaIcon,Ms.mediaPreviousIconLTR,Ms.iconLeftTriangleArrow):this.classes(Ms.mediaIcon,Ms.mediaNextIconLTR,Ms.iconRightTriangleArrow),n=t?this.classes(Ms.mediaIcon,Ms.mediaPreviousIconRTL,Ms.iconRightTriangleArrow):this.classes(Ms.mediaIcon,Ms.mediaNextIconRTL,Ms.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return W("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:a},W("span",{"aria-hidden":"true",class:s}),W("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){var n;const{am4core:t}=e,i=(n=this.viewModel)==null?void 0:n.layer,r=new Map;if(!i)return r;const s=await Eke(i.renderer);return s.delete(null),Array.from(s.values()).every(o=>(o==null?void 0:o.length)===1)&&(r.set(Bte,t.color({r:50,g:50,b:50,a:1})),Array.from(s.keys()).forEach(o=>{o&&r.set(o,t.color(s.get(o)[0].toCss(!0)))})),r}_handleMediaKeyup(e){const t=vl(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=i,c=oze(l);function h(m){m instanceof l.ColorSet&&c&&(m.list=c)}Sye()&&l.useTheme(i.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(i.am4themes_animated):l.unuseTheme(i.am4themes_animated),l.useTheme(h);const f=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),f.data=o.series.map(m=>({[Gy]:m.tooltip,[$C]:m.value,[Lm]:n.get(m.fieldName)})).filter(m=>a!=="pie-chart"||m.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=Hf(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=$C,o.dataFields.category=Gy,this._customizeChartTooltip(o.tooltip,r),o.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",o.slices.template.propertyFields.fill=Lm,o.slices.template.propertyFields.stroke=Lm,n}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=Gy,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=b6,l.renderer.maxLabelPosition=w6,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueY=$C,h.dataFields.categoryX=Gy,h.columns.template.propertyFields.fill=Lm,h.columns.template.propertyFields.stroke=Lm,e.cursor=new o.XYCursor,s.series.length>x6&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=Gy,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dx=a.tooltip.contentWidth});const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=b6,l.renderer.maxLabelPosition=w6,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueX=$C,h.dataFields.categoryY=Gy,h.columns.template.propertyFields.fill=Lm,h.columns.template.propertyFields.stroke=Lm,e.cursor=new o.XYCursor,s.series.length>x6&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r,colorMap:s}=t,{value:n}=r,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=Gy,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const c=e.yAxes.push(new a.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=b6,c.renderer.maxLabelPosition=w6,c.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(c.tooltip,o),h.wrap=!0;const p=e.series.push(new a.LineSeries);p.dataFields.categoryX=Gy,p.dataFields.valueY=$C,p.strokeWidth=1;const f=s.get(Bte);f&&(p.stroke=f);const m=p.bullets.push(new a.CircleBullet);m.propertyFields.fill=Lm,m.propertyFields.stroke=Lm,e.cursor=new a.XYCursor,n.series.length>x6&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=Hf(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};u([qe("viewModel.attributes")],Wl.prototype,"attributes",void 0),u([qe("viewModel.activeMediaInfoIndex")],Wl.prototype,"activeMediaInfoIndex",void 0),u([qe("viewModel.description")],Wl.prototype,"description",void 0),u([qe("viewModel.fieldInfoMap")],Wl.prototype,"fieldInfoMap",void 0),u([qe("viewModel.layer")],Wl.prototype,"layer",void 0),u([qe("viewModel.mediaInfos")],Wl.prototype,"mediaInfos",void 0),u([qe("viewModel.popupTemplate")],Wl.prototype,"popupTemplate",void 0),u([qe("viewModel.relatedInfos")],Wl.prototype,"relatedInfos",void 0),u([qe("viewModel.title")],Wl.prototype,"title",void 0),u([d({type:Hb})],Wl.prototype,"viewModel",void 0),u([d(),js("esri/widgets/Feature/t9n/Feature")],Wl.prototype,"messages",void 0),Wl=u([P("esri.widgets.Feature.FeatureMedia")],Wl);const o0e=Wl;class aze{constructor(t,i){this.definition=null,this.context=null,this.definition=t,this.context=i}}class Cm{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let i=0;i<this.length();i++)t.push(this.get(i));return t}}class mx extends Cm{constructor(t,i,r,s,n,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=i,this._hasZ=r,this._hasM=s,this._cacheId=n,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const i=this._elements[t];if(i===void 0)return;const r=this._hasZ,s=this._hasM;let n=null;n=r&&!s?new at(i[0],i[1],i[2],void 0,this._spRef):s&&!r?new at(i[0],i[1],void 0,i[2],this._spRef):r&&s?new at(i[0],i[1],i[2],i[3],this._spRef):new at(i[0],i[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=n}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof mx&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class TY extends Cm{constructor(t,i,r,s,n){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=i,this._cacheId=n}get(t){if(this._lazyPath[t]===void 0){const i=this._elements[t];if(i===void 0)return;this._lazyPath[t]=new mx(i,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof TY&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class gx extends Error{}class lze extends gx{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class cze extends gx{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class uze extends gx{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class mM extends gx{}class a0e extends gx{constructor(t){super(`Invalid unit ${t}`)}}class Ph extends gx{}class jy extends gx{constructor(){super("Zone is an abstract class")}}const Je="numeric",Ep="short",Ou="long",P7={year:Je,month:Je,day:Je},l0e={year:Je,month:Ep,day:Je},hze={year:Je,month:Ep,day:Je,weekday:Ep},c0e={year:Je,month:Ou,day:Je},u0e={year:Je,month:Ou,day:Je,weekday:Ou},h0e={hour:Je,minute:Je},d0e={hour:Je,minute:Je,second:Je},p0e={hour:Je,minute:Je,second:Je,timeZoneName:Ep},f0e={hour:Je,minute:Je,second:Je,timeZoneName:Ou},m0e={hour:Je,minute:Je,hourCycle:"h23"},g0e={hour:Je,minute:Je,second:Je,hourCycle:"h23"},y0e={hour:Je,minute:Je,second:Je,hourCycle:"h23",timeZoneName:Ep},v0e={hour:Je,minute:Je,second:Je,hourCycle:"h23",timeZoneName:Ou},_0e={year:Je,month:Je,day:Je,hour:Je,minute:Je},b0e={year:Je,month:Je,day:Je,hour:Je,minute:Je,second:Je},w0e={year:Je,month:Ep,day:Je,hour:Je,minute:Je},x0e={year:Je,month:Ep,day:Je,hour:Je,minute:Je,second:Je},dze={year:Je,month:Ep,day:Je,weekday:Ep,hour:Je,minute:Je},T0e={year:Je,month:Ou,day:Je,hour:Je,minute:Je,timeZoneName:Ep},S0e={year:Je,month:Ou,day:Je,hour:Je,minute:Je,second:Je,timeZoneName:Ep},E0e={year:Je,month:Ou,day:Je,weekday:Ou,hour:Je,minute:Je,timeZoneName:Ou},C0e={year:Je,month:Ou,day:Je,weekday:Ou,hour:Je,minute:Je,second:Je,timeZoneName:Ou};function Zi(e){return typeof e=="undefined"}function hw(e){return typeof e=="number"}function Rk(e){return typeof e=="number"&&e%1===0}function pze(e){return typeof e=="string"}function fze(e){return Object.prototype.toString.call(e)==="[object Date]"}function A0e(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch{return!1}}function mze(e){return Array.isArray(e)?e:[e]}function Gte(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const n=[t(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function gze(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function Y2(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function zg(e,t,i){return Rk(e)&&e>=t&&e<=i}function yze(e,t){return e-t*Math.floor(e/t)}function Un(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function nv(e){if(!(Zi(e)||e===null||e===""))return parseInt(e,10)}function B_(e){if(!(Zi(e)||e===null||e===""))return parseFloat(e)}function SY(e){if(!(Zi(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function EY(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function QP(e){return e%4===0&&(e%100!==0||e%400===0)}function bO(e){return QP(e)?366:365}function n4(e,t){const i=yze(t-1,12)+1,r=e+(t-i)/12;return i===2?QP(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function CY(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function o4(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return t===4||r===3?53:52}function I7(e){return e>99?e:e>60?1900+e:2e3+e}function M0e(e,t,i,r=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o=F({timeZoneName:t},n),a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function Pk(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function O0e(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new Ph(`Invalid unit value ${e}`);return t}function a4(e,t){const i={};for(const r in e)if(Y2(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=O0e(s)}return i}function wO(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${Un(i,2)}:${Un(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${Un(i,2)}${Un(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function Ik(e){return gze(e,["hour","minute","second","millisecond"])}const R0e=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,vze=["January","February","March","April","May","June","July","August","September","October","November","December"],P0e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_ze=["J","F","M","A","M","J","J","A","S","O","N","D"];function I0e(e){switch(e){case"narrow":return[..._ze];case"short":return[...P0e];case"long":return[...vze];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const $0e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],D0e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],bze=["M","T","W","T","F","S","S"];function L0e(e){switch(e){case"narrow":return[...bze];case"short":return[...D0e];case"long":return[...$0e];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const N0e=["AM","PM"],wze=["Before Christ","Anno Domini"],xze=["BC","AD"],Tze=["B","A"];function F0e(e){switch(e){case"narrow":return[...Tze];case"short":return[...xze];case"long":return[...wze];default:return null}}function Sze(e){return N0e[e.hour<12?0:1]}function Eze(e,t){return L0e(t)[e.weekday-1]}function Cze(e,t){return I0e(t)[e.month-1]}function Aze(e,t){return F0e(t)[e.year<0?0:1]}function Mze(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=r?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function jte(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const Oze={D:P7,DD:l0e,DDD:c0e,DDDD:u0e,t:h0e,tt:d0e,ttt:p0e,tttt:f0e,T:m0e,TT:g0e,TTT:y0e,TTTT:v0e,f:_0e,ff:w0e,fff:T0e,ffff:E0e,F:b0e,FF:x0e,FFF:S0e,FFFF:C0e};class gc{static create(t,i={}){return new gc(t,i)}static parseFormat(t){let i=null,r="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(t){return Oze[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTime(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTimeParts(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).formatToParts()}resolvedOptions(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return Un(t,i);const r=F({},this.opts);return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(t,m,y),o=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",a=()=>r?Sze(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>r?Cze(t,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>r?Eze(t,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=gc.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(t,y):m},p=m=>r?Aze(t,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(m)}};return jte(gc.parseFormat(i),f)}formatDurationFromString(t,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=gc.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(r).filter(l=>l));return jte(n,s(a))}}class up{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class JP{get type(){throw new jy}get name(){throw new jy}get ianaName(){return this.name}get isUniversal(){throw new jy}offsetName(t,i){throw new jy}formatOffset(t,i){throw new jy}offset(t){throw new jy}equals(t){throw new jy}get isValid(){throw new jy}}let T6=null;class AY extends JP{static get instance(){return T6===null&&(T6=new AY),T6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return M0e(t,i,r)}formatOffset(t,i){return wO(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let IL={};function Rze(e){return IL[e]||(IL[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),IL[e]}const Pze={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Ize(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function $ze(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=Pze[n];n==="era"?r[a]=o:Zi(a)||(r[a]=parseInt(o,10))}return r}let CI={};class hy extends JP{static create(t){return CI[t]||(CI[t]=new hy(t)),CI[t]}static resetCache(){CI={},IL={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super();this.zoneName=t,this.valid=hy.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return M0e(t,i,r,this.name)}formatOffset(t,i){return wO(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=Rze(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?$ze(r,i):Ize(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=CY({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let S6=null;class wl extends JP{static get utcInstance(){return S6===null&&(S6=new wl(0)),S6}static instance(t){return t===0?wl.utcInstance:new wl(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new wl(Pk(i[1],i[2]))}return null}constructor(t){super();this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${wO(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${wO(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return wO(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class Dze extends JP{constructor(t){super();this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function mv(e,t){if(Zi(e)||e===null)return t;if(e instanceof JP)return e;if(pze(e)){const i=e.toLowerCase();return i==="local"||i==="system"?t:i==="utc"||i==="gmt"?wl.utcInstance:wl.parseSpecifier(i)||hy.create(e)}else return hw(e)?wl.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new Dze(e)}let Hte=()=>Date.now(),qte="system",Wte=null,Xte=null,Yte=null,Zte;class no{static get now(){return Hte}static set now(t){Hte=t}static set defaultZone(t){qte=t}static get defaultZone(){return mv(qte,AY.instance)}static get defaultLocale(){return Wte}static set defaultLocale(t){Wte=t}static get defaultNumberingSystem(){return Xte}static set defaultNumberingSystem(t){Xte=t}static get defaultOutputCalendar(){return Yte}static set defaultOutputCalendar(t){Yte=t}static get throwOnInvalid(){return Zte}static set throwOnInvalid(t){Zte=t}static resetCaches(){Fs.resetCache(),hy.resetCache()}}let Qte={};function Lze(e,t={}){const i=JSON.stringify([e,t]);let r=Qte[i];return r||(r=new Intl.ListFormat(e,t),Qte[i]=r),r}let $7={};function D7(e,t={}){const i=JSON.stringify([e,t]);let r=$7[i];return r||(r=new Intl.DateTimeFormat(e,t),$7[i]=r),r}let L7={};function Nze(e,t={}){const i=JSON.stringify([e,t]);let r=L7[i];return r||(r=new Intl.NumberFormat(e,t),L7[i]=r),r}let N7={};function Fze(e,t={}){const o=t,{base:i}=o,r=W3(o,["base"]),s=JSON.stringify([e,r]);let n=N7[s];return n||(n=new Intl.RelativeTimeFormat(e,t),N7[s]=n),n}let gM=null;function kze(){return gM||(gM=new Intl.DateTimeFormat().resolvedOptions().locale,gM)}function Uze(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let i;const r=e.substring(0,t);try{i=D7(e).resolvedOptions()}catch{i=D7(r).resolvedOptions()}const{numberingSystem:s,calendar:n}=i;return[r,s,n]}}function zze(e,t,i){return(i||t)&&(e+="-u",i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function Vze(e){const t=[];for(let i=1;i<=12;i++){const r=Lt.utc(2016,i,1);t.push(e(r))}return t}function Bze(e){const t=[];for(let i=1;i<=7;i++){const r=Lt.utc(2016,11,13+i);t.push(e(r))}return t}function AI(e,t,i,r,s){const n=e.listingMode(i);return n==="error"?null:n==="en"?r(t):s(t)}function Gze(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class jze{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const a=r,{padTo:s,floor:n}=a,o=W3(a,["padTo","floor"]);if(!i||Object.keys(o).length>0){const l=F({useGrouping:!1},r);r.padTo>0&&(l.minimumIntegerDigits=r.padTo),this.inf=Nze(t,l)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):EY(t,3);return Un(i,this.padTo)}}}class Hze{constructor(t,i,r){this.opts=r;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&hy.create(a).valid?(s=a,this.dt=t):(s="UTC",r.timeZoneName?this.dt=t:this.dt=t.offset===0?t:Lt.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n=F({},this.opts);s&&(n.timeZone=s),this.dtf=D7(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class qze{constructor(t,i,r){this.opts=F({style:"long"},r),!i&&A0e()&&(this.rtf=Fze(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):Mze(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}class Fs{static fromOpts(t){return Fs.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,i,r,s=!1){const n=t||no.defaultLocale,o=n||(s?"en-US":kze()),a=i||no.defaultNumberingSystem,l=r||no.defaultOutputCalendar;return new Fs(o,a,l,n)}static resetCache(){gM=null,$7={},L7={},N7={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r}={}){return Fs.create(t,i,r)}constructor(t,i,r,s){const[n,o,a]=Uze(t);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=zze(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Gze(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Fs.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone(me(F({},t),{defaultToEN:!0}))}redefaultToSystem(t={}){return this.clone(me(F({},t),{defaultToEN:!1}))}months(t,i=!1,r=!0){return AI(this,t,r,I0e,()=>{const s=i?{month:t,day:"numeric"}:{month:t},n=i?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=Vze(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,i=!1,r=!0){return AI(this,t,r,L0e,()=>{const s=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=i?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=Bze(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return AI(this,void 0,t,()=>N0e,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Lt.utc(2016,11,13,9),Lt.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(t,i=!0){return AI(this,t,i,F0e,()=>{const r={era:t};return this.eraCache[t]||(this.eraCache[t]=[Lt.utc(-40,1,1),Lt.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(t={}){return new jze(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new Hze(t,this.intl,i)}relFormatter(t={}){return new qze(this.intl,this.isEnglish(),t)}listFormatter(t={}){return Lze(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function iC(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function rC(...e){return t=>e.reduce(([i,r,s],n)=>{const[o,a,l]=n(t,s);return[F(F({},i),o),a||r,l]},[{},null,1]).slice(0,2)}function sC(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function k0e(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=nv(t[i+s]);return[r,null,i+s]}}const U0e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Wze=`(?:${U0e.source}?(?:\\[(${R0e.source})\\])?)?`,MY=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,z0e=RegExp(`${MY.source}${Wze}`),OY=RegExp(`(?:T${z0e.source})?`),Xze=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Yze=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Zze=/(\d{4})-?(\d{3})/,Qze=k0e("weekYear","weekNumber","weekDay"),Jze=k0e("year","ordinal"),Kze=/(\d{4})-(\d\d)-(\d\d)/,V0e=RegExp(`${MY.source} ?(?:${U0e.source}|(${R0e.source}))?`),e6e=RegExp(`(?: ${V0e.source})?`);function n2(e,t,i){const r=e[t];return Zi(r)?i:nv(r)}function t6e(e,t){return[{year:n2(e,t),month:n2(e,t+1,1),day:n2(e,t+2,1)},null,t+3]}function nC(e,t){return[{hours:n2(e,t,0),minutes:n2(e,t+1,0),seconds:n2(e,t+2,0),milliseconds:SY(e[t+3])},null,t+4]}function KP(e,t){const i=!e[t]&&!e[t+1],r=Pk(e[t+1],e[t+2]),s=i?null:wl.instance(r);return[{},s,t+3]}function e3(e,t){const i=e[t]?hy.create(e[t]):null;return[{},i,t+1]}const i6e=RegExp(`^T?${MY.source}$`),r6e=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function s6e(e){const[t,i,r,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(B_(i)),months:f(B_(r)),weeks:f(B_(s)),days:f(B_(n)),hours:f(B_(o)),minutes:f(B_(a)),seconds:f(B_(l),l==="-0"),milliseconds:f(SY(c),p)}]}const n6e={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function RY(e,t,i,r,s,n,o){const a={year:t.length===2?I7(nv(t)):nv(t),month:P0e.indexOf(i)+1,day:nv(r),hour:nv(s),minute:nv(n)};return o&&(a.second=nv(o)),e&&(a.weekday=e.length>3?$0e.indexOf(e)+1:D0e.indexOf(e)+1),a}const o6e=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function a6e(e){const[,t,i,r,s,n,o,a,l,c,h,p]=e,f=RY(t,s,r,i,n,o,a);let m;return l?m=n6e[l]:c?m=0:m=Pk(h,p),[f,new wl(m)]}function l6e(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const c6e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,u6e=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,h6e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Jte(e){const[,t,i,r,s,n,o,a]=e;return[RY(t,s,r,i,n,o,a),wl.utcInstance]}function d6e(e){const[,t,i,r,s,n,o,a]=e;return[RY(t,a,i,r,s,n,o),wl.utcInstance]}const p6e=iC(Xze,OY),f6e=iC(Yze,OY),m6e=iC(Zze,OY),g6e=iC(z0e),B0e=rC(t6e,nC,KP,e3),y6e=rC(Qze,nC,KP,e3),v6e=rC(Jze,nC,KP,e3),_6e=rC(nC,KP,e3);function b6e(e){return sC(e,[p6e,B0e],[f6e,y6e],[m6e,v6e],[g6e,_6e])}function w6e(e){return sC(l6e(e),[o6e,a6e])}function x6e(e){return sC(e,[c6e,Jte],[u6e,Jte],[h6e,d6e])}function T6e(e){return sC(e,[r6e,s6e])}const S6e=rC(nC);function E6e(e){return sC(e,[i6e,S6e])}const C6e=iC(Kze,e6e),A6e=iC(V0e),M6e=rC(nC,KP,e3);function O6e(e){return sC(e,[C6e,B0e],[A6e,M6e])}const R6e="Invalid Duration",G0e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},P6e=F({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},G0e),Xu=146097/400,Ax=146097/4800,I6e=F({years:{quarters:4,months:12,weeks:Xu/7,days:Xu,hours:Xu*24,minutes:Xu*24*60,seconds:Xu*24*60*60,milliseconds:Xu*24*60*60*1e3},quarters:{months:3,weeks:Xu/28,days:Xu/4,hours:Xu*24/4,minutes:Xu*24*60/4,seconds:Xu*24*60*60/4,milliseconds:Xu*24*60*60*1e3/4},months:{weeks:Ax/7,days:Ax,hours:Ax*24,minutes:Ax*24*60,seconds:Ax*24*60*60,milliseconds:Ax*24*60*60*1e3}},G0e),G1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],$6e=G1.slice(0).reverse();function G_(e,t,i=!1){const r={values:i?t.values:F(F({},e.values),t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new ar(r)}function D6e(e){return e<0?Math.floor(e):Math.ceil(e)}function j0e(e,t,i,r,s){const n=e[s][i],o=t[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?D6e(o):Math.trunc(o);r[s]+=l,t[i]-=l*n}function L6e(e,t){$6e.reduce((i,r)=>Zi(t[r])?i:(i&&j0e(e,t,i,t,r),r),null)}class ar{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||Fs.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i?I6e:P6e,this.isLuxonDuration=!0}static fromMillis(t,i){return ar.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new Ph(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new ar({values:a4(t,ar.normalizeUnit),loc:Fs.fromObject(i),conversionAccuracy:i.conversionAccuracy})}static fromDurationLike(t){if(hw(t))return ar.fromMillis(t);if(ar.isDuration(t))return t;if(typeof t=="object")return ar.fromObject(t);throw new Ph(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=T6e(t);return r?ar.fromObject(r,i):ar.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=E6e(t);return r?ar.fromObject(r,i):ar.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new Ph("need to specify a reason the Duration is invalid");const r=t instanceof up?t:new up(t,i);if(no.throwOnInvalid)throw new uze(r);return new ar({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new a0e(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r=me(F({},i),{floor:i.round!==!1&&i.floor!==!1});return this.isValid?gc.create(this.loc,r).formatDurationFromString(this,t):R6e}toHuman(t={}){const i=G1.map(r=>{const s=this.values[r];return Zi(s)?null:this.loc.numberFormatter(me(F({style:"unit",unitDisplay:"long"},t),{unit:r.slice(0,-1)})).format(s)}).filter(r=>r);return this.loc.listFormatter(F({type:"conjunction",style:t.listStyle||"narrow"},t)).format(i)}toObject(){return this.isValid?F({},this.values):{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=EY(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;t=F({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},t);const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=ar.fromDurationLike(t),r={};for(const s of G1)(Y2(i.values,s)||Y2(this.values,s))&&(r[s]=i.get(s)+this.get(s));return G_(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=ar.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=O0e(t(this.values[r],r));return G_(this,{values:i},!0)}get(t){return this[ar.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i=F(F({},this.values),a4(t,ar.normalizeUnit));return G_(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i}),n={loc:s};return r&&(n.conversionAccuracy=r),G_(this,n)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return L6e(this.matrix,t),G_(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>ar.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of G1)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;hw(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)G1.indexOf(c)>G1.indexOf(o)&&j0e(this.matrix,s,c,i,o)}else hw(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return G_(this,{values:i},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return G_(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of G1)if(!i(this.values[r],t.values[r]))return!1;return!0}}const DC="Invalid Interval";function N6e(e,t){return!e||!e.isValid?Ds.invalid("missing or invalid start"):!t||!t.isValid?Ds.invalid("missing or invalid end"):t<e?Ds.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class Ds{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new Ph("need to specify a reason the Interval is invalid");const r=t instanceof up?t:new up(t,i);if(no.throwOnInvalid)throw new cze(r);return new Ds({invalid:r})}static fromDateTimes(t,i){const r=FC(t),s=FC(i),n=N6e(r,s);return n==null?new Ds({start:r,end:s}):n}static after(t,i){const r=ar.fromDurationLike(i),s=FC(t);return Ds.fromDateTimes(s,s.plus(r))}static before(t,i){const r=ar.fromDurationLike(i),s=FC(t);return Ds.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let n,o;try{n=Lt.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=Lt.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return Ds.fromDateTimes(n,a);if(o){const c=ar.fromISO(s,i);if(c.isValid)return Ds.after(n,c)}else if(l){const c=ar.fromISO(r,i);if(c.isValid)return Ds.before(a,c)}}return Ds.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(i,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?Ds.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(FC).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(Ds.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(t){const i=ar.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Ds.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:Ds.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return Ds.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Ds.fromDateTimes(i,l.time)),i=null);return Ds.merge(s)}difference(...t){return Ds.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:DC}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:DC}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:DC}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:DC}toFormat(t,{separator:i=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:DC}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):ar.invalid(this.invalidReason)}mapEndpoints(t){return Ds.fromDateTimes(t(this.s),t(this.e))}}class yM{static hasDST(t=no.defaultZone){const i=Lt.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return hy.isValidZone(t)}static normalizeZone(t){return mv(t,no.defaultZone)}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Fs.create(i,r,n)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Fs.create(i,r,n)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Fs.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Fs.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Fs.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return Fs.create(i,null,"gregory").eras(t)}static features(){return{relative:A0e()}}}function Kte(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(ar.fromMillis(r).as("days"))}function F6e(e,t,i){const r=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=Kte(a,l);return(c-c%7)/7}],["days",Kte]],s={};let n,o;for(const[a,l]of r)if(i.indexOf(a)>=0){n=a;let c=l(e,t);o=e.plus({[a]:c}),o>t?(e=e.plus({[a]:c-1}),c-=1):e=o,s[a]=c}return[e,s,o,n]}function k6e(e,t,i,r){let[s,n,o,a]=F6e(e,t,i);const l=t-s,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=ar.fromObject(n,r);return c.length>0?ar.fromMillis(l,r).shiftTo(...c).plus(h):h}const PY={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},eie={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},U6e=PY.hanidec.replace(/[\[|\]]/g,"").split("");function z6e(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(PY.hanidec)!==-1)t+=U6e.indexOf(e[i]);else for(const s in eie){const[n,o]=eie[s];r>=n&&r<=o&&(t+=r-n)}}return parseInt(t,10)}else return t}function pd({numberingSystem:e},t=""){return new RegExp(`${PY[e||"latn"]}${t}`)}const V6e="missing Intl.DateTimeFormat.formatToParts support";function vr(e,t=i=>i){return{regex:e,deser:([i])=>t(z6e(i))}}const B6e=String.fromCharCode(160),H0e=`[ ${B6e}]`,q0e=new RegExp(H0e,"g");function G6e(e){return e.replace(/\./g,"\\.?").replace(q0e,H0e)}function tie(e){return e.replace(/\./g,"").replace(q0e," ").toLowerCase()}function fd(e,t){return e===null?null:{regex:RegExp(e.map(G6e).join("|")),deser:([i])=>e.findIndex(r=>tie(i)===tie(r))+t}}function iie(e,t){return{regex:e,deser:([,i,r])=>Pk(i,r),groups:t}}function E6(e){return{regex:e,deser:([t])=>t}}function j6e(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function H6e(e,t){const i=pd(t),r=pd(t,"{2}"),s=pd(t,"{3}"),n=pd(t,"{4}"),o=pd(t,"{6}"),a=pd(t,"{1,2}"),l=pd(t,"{1,3}"),c=pd(t,"{1,6}"),h=pd(t,"{1,9}"),p=pd(t,"{2,4}"),f=pd(t,"{4,6}"),m=w=>({regex:RegExp(j6e(w.val)),deser:([b])=>b,literal:!0}),v=(w=>{if(e.literal)return m(w);switch(w.val){case"G":return fd(t.eras("short",!1),0);case"GG":return fd(t.eras("long",!1),0);case"y":return vr(c);case"yy":return vr(p,I7);case"yyyy":return vr(n);case"yyyyy":return vr(f);case"yyyyyy":return vr(o);case"M":return vr(a);case"MM":return vr(r);case"MMM":return fd(t.months("short",!0,!1),1);case"MMMM":return fd(t.months("long",!0,!1),1);case"L":return vr(a);case"LL":return vr(r);case"LLL":return fd(t.months("short",!1,!1),1);case"LLLL":return fd(t.months("long",!1,!1),1);case"d":return vr(a);case"dd":return vr(r);case"o":return vr(l);case"ooo":return vr(s);case"HH":return vr(r);case"H":return vr(a);case"hh":return vr(r);case"h":return vr(a);case"mm":return vr(r);case"m":return vr(a);case"q":return vr(a);case"qq":return vr(r);case"s":return vr(a);case"ss":return vr(r);case"S":return vr(l);case"SSS":return vr(s);case"u":return E6(h);case"uu":return E6(a);case"uuu":return vr(i);case"a":return fd(t.meridiems(),0);case"kkkk":return vr(n);case"kk":return vr(p,I7);case"W":return vr(a);case"WW":return vr(r);case"E":case"c":return vr(i);case"EEE":return fd(t.weekdays("short",!1,!1),1);case"EEEE":return fd(t.weekdays("long",!1,!1),1);case"ccc":return fd(t.weekdays("short",!0,!1),1);case"cccc":return fd(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return iie(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return iie(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return E6(/[a-z_+-/]{1,256}?/i);default:return m(w)}})(e)||{invalidReason:V6e};return v.token=e,v}const q6e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function W6e(e,t,i){const{type:r,value:s}=e;if(r==="literal")return{literal:!0,val:s};const n=i[r];let o=q6e[r];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function X6e(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function Y6e(e,t,i){const r=e.match(t);if(r){const s={};let n=1;for(const o in i)if(Y2(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function Z6e(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Zi(e.z)||(i=hy.create(e.z)),Zi(e.Z)||(i||(i=new wl(e.Z)),r=e.Z),Zi(e.q)||(e.M=(e.q-1)*3+1),Zi(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Zi(e.u)||(e.S=SY(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),i,r]}let C6=null;function Q6e(){return C6||(C6=Lt.fromMillis(1555555555555)),C6}function J6e(e,t){if(e.literal)return e;const i=gc.macroTokenToFormatOpts(e.val);if(!i)return e;const n=gc.create(t,i).formatDateTimeParts(Q6e()).map(o=>W6e(o,t,i));return n.includes(void 0)?e:n}function K6e(e,t){return Array.prototype.concat(...e.map(i=>J6e(i,t)))}function W0e(e,t,i){const r=K6e(gc.parseFormat(i),e),s=r.map(o=>H6e(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};{const[o,a]=X6e(s),l=RegExp(o,"i"),[c,h]=Y6e(t,l,a),[p,f,m]=h?Z6e(h):[null,null,void 0];if(Y2(h,"a")&&Y2(h,"H"))throw new mM("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function eVe(e,t,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=W0e(e,t,i);return[r,s,n,o]}const X0e=[0,31,59,90,120,151,181,212,243,273,304,334],Y0e=[0,31,60,91,121,152,182,213,244,274,305,335];function Vh(e,t){return new up("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function Z0e(e,t,i){const r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function Q0e(e,t,i){return i+(QP(e)?Y0e:X0e)[t-1]}function J0e(e,t){const i=QP(e)?Y0e:X0e,r=i.findIndex(n=>n<t),s=t-i[r];return{month:r+1,day:s}}function F7(e){const{year:t,month:i,day:r}=e,s=Q0e(t,i,r),n=Z0e(t,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=o4(a)):o>o4(t)?(a=t+1,o=1):a=t,F({weekYear:a,weekNumber:o,weekday:n},Ik(e))}function rie(e){const{weekYear:t,weekNumber:i,weekday:r}=e,s=Z0e(t,1,4),n=bO(t);let o=i*7+r-s-3,a;o<1?(a=t-1,o+=bO(a)):o>n?(a=t+1,o-=bO(t)):a=t;const{month:l,day:c}=J0e(a,o);return F({year:a,month:l,day:c},Ik(e))}function A6(e){const{year:t,month:i,day:r}=e,s=Q0e(t,i,r);return F({year:t,ordinal:s},Ik(e))}function sie(e){const{year:t,ordinal:i}=e,{month:r,day:s}=J0e(t,i);return F({year:t,month:r,day:s},Ik(e))}function tVe(e){const t=Rk(e.weekYear),i=zg(e.weekNumber,1,o4(e.weekYear)),r=zg(e.weekday,1,7);return t?i?r?!1:Vh("weekday",e.weekday):Vh("week",e.week):Vh("weekYear",e.weekYear)}function iVe(e){const t=Rk(e.year),i=zg(e.ordinal,1,bO(e.year));return t?i?!1:Vh("ordinal",e.ordinal):Vh("year",e.year)}function K0e(e){const t=Rk(e.year),i=zg(e.month,1,12),r=zg(e.day,1,n4(e.year,e.month));return t?i?r?!1:Vh("day",e.day):Vh("month",e.month):Vh("year",e.year)}function eve(e){const{hour:t,minute:i,second:r,millisecond:s}=e,n=zg(t,0,23)||t===24&&i===0&&r===0&&s===0,o=zg(i,0,59),a=zg(r,0,59),l=zg(s,0,999);return n?o?a?l?!1:Vh("millisecond",s):Vh("second",r):Vh("minute",i):Vh("hour",t)}const M6="Invalid DateTime",nie=864e13;function MI(e){return new up("unsupported zone",`the zone "${e.name}" is not supported`)}function O6(e){return e.weekData===null&&(e.weekData=F7(e.c)),e.weekData}function LC(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new Lt(me(F(F({},i),t),{old:i}))}function tve(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function oie(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function $L(e,t,i){return tve(CY(e),t,i)}function aie(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n=me(F({},e.c),{year:r,month:s,day:Math.min(e.c.day,n4(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7}),o=ar.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=CY(n);let[l,c]=tve(a,i,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function NC(e,t,i,r,s,n){const{setZone:o,zone:a}=i;if(e&&Object.keys(e).length!==0){const l=t||a,c=Lt.fromObject(e,me(F({},i),{zone:l,specificOffset:n}));return o?c:c.setZone(a)}else return Lt.invalid(new up("unparsable",`the input "${s}" can't be parsed as ${r}`))}function OI(e,t,i=!0){return e.isValid?gc.create(Fs.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function R6(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=Un(e.c.year,i?6:4),t?(r+="-",r+=Un(e.c.month),r+="-",r+=Un(e.c.day)):(r+=Un(e.c.month),r+=Un(e.c.day)),r}function lie(e,t,i,r,s,n){let o=Un(e.c.hour);return t?(o+=":",o+=Un(e.c.minute),(e.c.second!==0||!i)&&(o+=":")):o+=Un(e.c.minute),(e.c.second!==0||!i)&&(o+=Un(e.c.second),(e.c.millisecond!==0||!r)&&(o+=".",o+=Un(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=Un(Math.trunc(-e.o/60)),o+=":",o+=Un(Math.trunc(-e.o%60))):(o+="+",o+=Un(Math.trunc(e.o/60)),o+=":",o+=Un(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const ive={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},rVe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},sVe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},rve=["year","month","day","hour","minute","second","millisecond"],nVe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],oVe=["year","ordinal","hour","minute","second","millisecond"];function cie(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new a0e(e);return t}function uie(e,t){const i=mv(t.zone,no.defaultZone),r=Fs.fromObject(t),s=no.now();let n,o;if(Zi(e.year))n=s;else{for(const c of rve)Zi(e[c])&&(e[c]=ive[c]);const a=K0e(e)||eve(e);if(a)return Lt.invalid(a);const l=i.offset(s);[n,o]=$L(e,l,i)}return new Lt({ts:n,zone:i,loc:r,o})}function hie(e,t,i){const r=Zi(i.round)?!0:i.round,s=(o,a)=>(o=EY(o,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,i.units[i.units.length-1])}function die(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class Lt{constructor(t){const i=t.zone||no.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new up("invalid input"):null)||(i.isValid?null:MI(i));this.ts=Zi(t.ts)?no.now():t.ts;let s=null,n=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,n]=[t.old.c,t.old.o];else{const a=i.offset(this.ts);s=oie(this.ts,a),r=Number.isNaN(s.year)?new up("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=t.loc||Fs.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Lt({})}static local(){const[t,i]=die(arguments),[r,s,n,o,a,l,c]=i;return uie({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,i]=die(arguments),[r,s,n,o,a,l,c]=i;return t.zone=wl.utcInstance,uie({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,i={}){const r=fze(t)?t.valueOf():NaN;if(Number.isNaN(r))return Lt.invalid("invalid input");const s=mv(i.zone,no.defaultZone);return s.isValid?new Lt({ts:r,zone:s,loc:Fs.fromObject(i)}):Lt.invalid(MI(s))}static fromMillis(t,i={}){if(hw(t))return t<-nie||t>nie?Lt.invalid("Timestamp out of range"):new Lt({ts:t,zone:mv(i.zone,no.defaultZone),loc:Fs.fromObject(i)});throw new Ph(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(hw(t))return new Lt({ts:t*1e3,zone:mv(i.zone,no.defaultZone),loc:Fs.fromObject(i)});throw new Ph("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=mv(i.zone,no.defaultZone);if(!r.isValid)return Lt.invalid(MI(r));const s=no.now(),n=Zi(i.specificOffset)?r.offset(s):i.specificOffset,o=a4(t,cie),a=!Zi(o.ordinal),l=!Zi(o.year),c=!Zi(o.month)||!Zi(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Fs.fromObject(i);if((h||a)&&p)throw new mM("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new mM("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,v,w=oie(s,n);m?(y=nVe,v=rVe,w=F7(w)):a?(y=oVe,v=sVe,w=A6(w)):(y=rve,v=ive);let b=!1;for(const L of y){const D=o[L];Zi(D)?b?o[L]=v[L]:o[L]=w[L]:b=!0}const S=m?tVe(o):a?iVe(o):K0e(o),T=S||eve(o);if(T)return Lt.invalid(T);const E=m?rie(o):a?sie(o):o,[C,A]=$L(E,n,r),I=new Lt({ts:C,zone:r,o:A,loc:f});return o.weekday&&h&&t.weekday!==I.weekday?Lt.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${I.toISO()}`):I}static fromISO(t,i={}){const[r,s]=b6e(t);return NC(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=w6e(t);return NC(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=x6e(t);return NC(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(Zi(t)||Zi(i))throw new Ph("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=Fs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=eVe(o,t,i);return h?Lt.invalid(h):NC(a,l,r,`format ${i}`,t,c)}static fromString(t,i,r={}){return Lt.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=O6e(t);return NC(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new Ph("need to specify a reason the DateTime is invalid");const r=t instanceof up?t:new up(t,i);if(no.throwOnInvalid)throw new lze(r);return new Lt({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?O6(this).weekYear:NaN}get weekNumber(){return this.isValid?O6(this).weekNumber:NaN}get weekday(){return this.isValid?O6(this).weekday:NaN}get ordinal(){return this.isValid?A6(this.c).ordinal:NaN}get monthShort(){return this.isValid?yM.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?yM.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?yM.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?yM.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return QP(this.year)}get daysInMonth(){return n4(this.year,this.month)}get daysInYear(){return this.isValid?bO(this.year):NaN}get weeksInWeekYear(){return this.isValid?o4(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=gc.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone(wl.instance(t),i)}toLocal(){return this.setZone(no.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=mv(t,no.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const n=t.offset(this.ts),o=this.toObject();[s]=$L(o,n,t)}return LC(this,{ts:s,zone:t})}else return Lt.invalid(MI(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return LC(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=a4(t,cie),r=!Zi(i.weekYear)||!Zi(i.weekNumber)||!Zi(i.weekday),s=!Zi(i.ordinal),n=!Zi(i.year),o=!Zi(i.month)||!Zi(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new mM("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new mM("Can't mix ordinal dates with month/day");let c;r?c=rie(F(F({},F7(this.c)),i)):Zi(i.ordinal)?(c=F(F({},this.toObject()),i),Zi(i.day)&&(c.day=Math.min(n4(c.year,c.month),c.day))):c=sie(F(F({},A6(this.c)),i));const[h,p]=$L(c,this.o,this.zone);return LC(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const i=ar.fromDurationLike(t);return LC(this,aie(this,i))}minus(t){if(!this.isValid)return this;const i=ar.fromDurationLike(t).negate();return LC(this,aie(this,i))}startOf(t){if(!this.isValid)return this;const i={},r=ar.normalizeUnit(t);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,i={}){return this.isValid?gc.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):M6}toLocaleString(t=P7,i={}){return this.isValid?gc.create(this.loc.clone(i),t).formatDateTime(this):M6}toLocaleParts(t={}){return this.isValid?gc.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=R6(this,o);return a+="T",a+=lie(this,o,i,r,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?R6(this,t==="extended"):null}toISOWeekDate(){return OI(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+lie(this,o==="extended",i,t,r,n):null}toRFC2822(){return OI(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return OI(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?R6(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),OI(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():M6}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i=F({},this.c);return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return ar.invalid("created by diffing an invalid DateTime");const s=F({locale:this.locale,numberingSystem:this.numberingSystem},r),n=mze(i).map(ar.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=k6e(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",i={}){return this.diff(Lt.now(),t,i)}until(t){return this.isValid?Ds.fromDateTimes(this,t):this}hasSame(t,i){if(!this.isValid)return!1;const r=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||Lt.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),hie(i,this.plus(r),me(F({},t),{numeric:"always",units:s,unit:n}))}toRelativeCalendar(t={}){return this.isValid?hie(t.base||Lt.fromObject({},{zone:this.zone}),this,me(F({},t),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...t){if(!t.every(Lt.isDateTime))throw new Ph("min requires all arguments be DateTimes");return Gte(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(Lt.isDateTime))throw new Ph("max requires all arguments be DateTimes");return Gte(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=Fs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return W0e(o,t,i)}static fromStringExplain(t,i,r={}){return Lt.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return P7}static get DATE_MED(){return l0e}static get DATE_MED_WITH_WEEKDAY(){return hze}static get DATE_FULL(){return c0e}static get DATE_HUGE(){return u0e}static get TIME_SIMPLE(){return h0e}static get TIME_WITH_SECONDS(){return d0e}static get TIME_WITH_SHORT_OFFSET(){return p0e}static get TIME_WITH_LONG_OFFSET(){return f0e}static get TIME_24_SIMPLE(){return m0e}static get TIME_24_WITH_SECONDS(){return g0e}static get TIME_24_WITH_SHORT_OFFSET(){return y0e}static get TIME_24_WITH_LONG_OFFSET(){return v0e}static get DATETIME_SHORT(){return _0e}static get DATETIME_SHORT_WITH_SECONDS(){return b0e}static get DATETIME_MED(){return w0e}static get DATETIME_MED_WITH_SECONDS(){return x0e}static get DATETIME_MED_WITH_WEEKDAY(){return dze}static get DATETIME_FULL(){return T0e}static get DATETIME_FULL_WITH_SECONDS(){return S0e}static get DATETIME_HUGE(){return E0e}static get DATETIME_HUGE_WITH_SECONDS(){return C0e}}function FC(e){if(Lt.isDateTime(e))return e;if(e&&e.valueOf&&hw(e.valueOf()))return Lt.fromJSDate(e);if(e&&typeof e=="object")return Lt.fromObject(e);throw new Ph(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const P6={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function sve(e){e||(e=ua());let t=e in P6;if(!t){const n=e.split("-");n.length>1&&n[0]in P6&&(e=n[0],t=!0),t||(e="en")}const[i,r,s="#,##0.###"]=P6[e];return{decimal:i,group:r,pattern:s}}function aVe(e,t){const i=sve((t=F({},t)).locale);t.customs=i;const r=t.pattern||i.pattern;return isNaN(e)||Math.abs(e)===1/0?null:lVe(e,r,t)}const nve=/[#0,]*[#0](?:\.0*#*)?/;function lVe(e,t,i){const r=(i=i||{}).customs.group,s=i.customs.decimal,n=t.split(";"),o=n[0];if((t=n[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xA4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const a=nve,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+t);return i.fractional===!1&&(i.places=0),t.replace(a,cVe(e,l[0],{decimal:s,group:r,places:i.places,round:i.round}))}function cVe(e,t,i){(i=i||{}).places===!0&&(i.places=0),i.places===1/0&&(i.places=6);const r=t.split("."),s=typeof i.places=="string"&&i.places.indexOf(",");let n=i.places;s?n=i.places.substring(s+1):n>=0||(n=(r[1]||[]).length),i.round<0||(e=Number(e.toFixed(Number(n))));const o=String(Math.abs(e)).split("."),a=o[1]||"";if(r[1]||i.places){s&&(i.places=i.places.substring(0,s));const y=i.places!==void 0?i.places:r[1]&&r[1].lastIndexOf("0")+1;y>a.length&&(o[1]=a.padEnd(Number(y),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=r[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let h,p,f=r[0].lastIndexOf(",");if(f!==-1){h=r[0].length-f-1;const y=r[0].substr(0,f);f=y.lastIndexOf(","),f!==-1&&(p=y.length-f-1)}const m=[];for(let y=o[0];y;){const v=y.length-h;m.push(v>0?y.substr(v):y),y=v>0?y.slice(0,v):"",p&&(h=p,p=void 0)}return o[0]=m.reverse().join(i.group||","),o.join(i.decimal||".")}function uVe(e){const t=sve((e=e||{}).locale),i=e.pattern||t.pattern,r=t.group,s=t.decimal;let n=1;if(i.includes("%"))n/=100;else if(i.includes("\u2030"))n/=1e3;else if(i.includes("\xA4"))throw new Error("currency notation not supported");const o=i.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:_R(o,l=>(l="(?:"+mhe(l,".")+")").replace(nve,c=>{const h={signed:!1,separator:e.strict?r:[r,""],fractional:e.fractional,decimal:s,exponent:!1},p=c.split(".");let f=e.places;p.length===1&&n!==1&&(p[1]="###"),p.length===1||f===0?h.fractional=!1:(f===void 0&&(f=e.pattern?p[1].lastIndexOf("0")+1:1/0),f&&e.fractional==null&&(h.fractional=!0),!e.places&&f<p[1].length&&(f+=","+p[1].length),h.places=f);const m=p[0].split(",");return m.length>1&&(h.groupSize=m.pop().length,m.length>1&&(h.groupSize2=m.pop().length)),"("+dVe(h)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:r,decimal:s,factor:n}}function hVe(e,t){const i=uVe(t),r=new RegExp("^"+i.regexp+"$").exec(e);if(!r)return NaN;let s=r[1];if(!r[1]){if(!r[2])return NaN;s=r[2],i.factor*=-1}return s=s.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),Number(s)*i.factor}function dVe(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=pie(e),i=_R(e.fractional,s=>{let n="";return s&&e.places!==0&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n},!0);let r=t+i;return i&&(r="(?:(?:"+r+")|(?:"+i+"))"),r+_R(e.exponent,s=>s?"([eE]"+pie({signed:e.eSigned})+")":"")}function pie(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",_R(e.signed,t=>t?"[-+]":"",!0)+_R(e.separator,t=>{if(!t)return"(?:\\d+)";(t=mhe(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const i=e.groupSize,r=e.groupSize2;if(r){const s="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*["+t+"]\\d{"+i+"})";return i-r>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"},!0)}const _R=(e,t,i)=>{if(!(e instanceof Array))return t(e);const r=[];for(let s=0;s<e.length;s++)r.push(t(e[s]));return pVe(r.join("|"),i)},pVe=(e,t)=>"("+(t?"?:":"")+e+")";var fie,mie;function FTt(e){return YP.fromJSON(e.toJSON())}function fVe(e){return e.toJSON?e.toJSON():e}function kTt(e){return typeof e=="string"||e instanceof String}function UTt(e){return typeof e=="number"}function gie(e){return e instanceof Date}function zTt(e,t){return e===t||!(!gie(e)||!gie(t))&&e.getTime()===t.getTime()}function VTt(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function BTt(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new ui({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function GTt(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(fie||(fie={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(mie||(mie={}));const jTt=1e3,HTt={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},yie={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},qTt={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function WTt(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function XTt(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}class ove{constructor(t){this.value=t}}class ave{constructor(t){this.value=t}}class IY{constructor(t){this.fn=t}}class $Y{constructor(t,i){this.paramCount=i,this.fn=t}}const mVe=IY,gVe=ave,yVe=ove,vVe=$Y,hu={type:"VOID"},_Ve={type:"BREAK"},bVe={type:"CONTINUE"};function bR(e,t,i){return t===""||t==null||t===i||t===i?e:e=e.split(t).join(i)}function DY(e){return e instanceof IY||e instanceof aze||e instanceof $Y}function l4(e){return!!sa(e)||!!ml(e)||!!Da(e)||!!fl(e)||e===null||e===hu||typeof e=="number"}function wVe(e,t){return e===void 0?t:e}function sa(e){return typeof e=="string"||e instanceof String}function fl(e){return typeof e=="boolean"}function ml(e){return typeof e=="number"}function xVe(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function Qh(e){return e instanceof Array}function TVe(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function SVe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function EVe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function $w(e){return e instanceof Cm}function Da(e){return e instanceof Date}function CVe(e,t,i){if(e.length<t||e.length>i)throw new Error("Function called with wrong number of Parameters")}function AVe(e){return e<0?-Math.round(-e):Math.round(e)}function MVe(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?i:3&i|8).toString(16)})}function LY(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=bR(t,"\u2030",""),t=bR(t,"\xA4",""),aVe(e,{pattern:t})):e.toString()}function $k(e,t){const i=Lt.fromJSDate(e);return t==null||t===""?i.toISO({suppressMilliseconds:!0}):i.toFormat(lve(t),{locale:ua(),numberingSystem:"latn"})}function lve(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const i=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function Cr(e,t,i){switch(i){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function OVe(e,t,i){if(e===null){if(t===null||t===hu)return Cr(null,null,i);if(ml(t))return Cr(0,t,i);if(sa(t)||fl(t))return Cr(0,$s(t),i);if(Da(t))return Cr(0,t.getTime(),i)}if(e===hu){if(t===null||t===hu)return Cr(null,null,i);if(ml(t))return Cr(0,t,i);if(sa(t)||fl(t))return Cr(0,$s(t),i);if(Da(t))return Cr(0,t.getTime(),i)}else if(ml(e)){if(ml(t))return Cr(e,t,i);if(fl(t))return Cr(e,$s(t),i);if(t===null||t===hu)return Cr(e,0,i);if(sa(t))return Cr(e,$s(t),i);if(Da(t))return Cr(e,t.getTime(),i)}else if(sa(e)){if(sa(t))return Cr(Wv(e),Wv(t),i);if(Da(t))return Cr($s(e),t.getTime(),i);if(ml(t))return Cr($s(e),t,i);if(t===null||t===hu)return Cr($s(e),0,i);if(fl(t))return Cr($s(e),$s(t),i)}else if(Da(e)){if(Da(t))return Cr(e,t,i);if(t===null||t===hu)return Cr(e.getTime(),0,i);if(ml(t))return Cr(e.getTime(),t,i);if(fl(t)||sa(t))return Cr(e.getTime(),$s(t),i)}else if(fl(e)){if(fl(t))return Cr(e,t,i);if(ml(t))return Cr($s(e),$s(t),i);if(Da(t))return Cr($s(e),t.getTime(),i);if(t===null||t===hu)return Cr($s(e),0,i);if(sa(t))return Cr($s(e),$s(t),i)}return!!cve(e,t)&&(i==="<="||i===">=")}function cve(e,t){if(e===t||e===null&&t===hu||t===null&&e===hu)return!0;if(Da(e)&&Da(t))return e.getTime()===t.getTime();if(e instanceof TY||e instanceof mx)return e.equalityTest(t);if(e instanceof at&&t instanceof at){const i=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(i!=null)return i===r}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function Wv(e,t){if(sa(e))return e;if(e===null)return"";if(ml(e))return LY(e,t);if(fl(e))return e.toString();if(Da(e))return $k(e,t);if(e instanceof Ec)return JSON.stringify(e.toJSON());if(Qh(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=c4(e[r]);return"["+i.join(",")+"]"}if(e instanceof Cm){const i=[];for(let r=0;r<e.length();r++)i[r]=c4(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():DY(e)?"object, Function":""}function RVe(e){const t=[];if(Qh(e)===!1)return null;if(e instanceof Cm){for(let i=0;i<e.length();i++)t[i]=$s(e.get(i));return t}for(let i=0;i<e.length;i++)t[i]=$s(e[i]);return t}function DL(e,t){if(sa(e))return e;if(e===null)return"";if(ml(e))return LY(e,t);if(fl(e))return e.toString();if(Da(e))return $k(e,t);if(e instanceof Ec)return e instanceof ui?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+k7(e.spatialReference)+"}":k7(e.toJSON(),(i,r)=>i.key===r.key?0:i.key==="spatialReference"?1:r.key==="spatialReference"||i.key<r.key?-1:i.key>r.key?1:0);if(Qh(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=c4(e[r]);return"["+i.join(",")+"]"}if(e instanceof Cm){const i=[];for(let r=0;r<e.length();r++)i[r]=c4(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():DY(e)?"object, Function":""}function c4(e){if(e===null)return"null";if(fl(e)||ml(e)||sa(e))return JSON.stringify(e);if(e instanceof Ec||e instanceof Cm||e instanceof Array)return DL(e);if(e instanceof Date)return JSON.stringify($k(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===hu)return"null";return"null"}function $s(e,t){return ml(e)?e:e===null||e===""?0:Da(e)?NaN:fl(e)?e?1:0:Qh(e)||e===""||e===void 0?NaN:t!==void 0&&sa(e)?(t=bR(t,"\u2030",""),t=bR(t,"\xA4",""),hVe(e,{pattern:t})):e===hu?0:Number(e)}function PVe(e){if(Da(e))return e;if(sa(e)){const t=uve(e);if(t)return t.toJSDate()}return null}function IVe(e){return Da(e)?Lt.fromJSDate(e):sa(e)?uve(e):null}function uve(e){const t=/ (\d\d)/;let i=Lt.fromISO(e);return i.isValid||t.test(e)&&(e=e.replace(t,"T$1"),i=Lt.fromISO(e),i.isValid)?i:null}function $Ve(e){return fl(e)?e:sa(e)?(e=e.toLowerCase())==="true":!!ml(e)&&e!==0&&!isNaN(e)}function DVe(e,t){return M(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function LVe(e){if(e===null)return null;if(e instanceof at)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof $u){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof Tu){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof sx?e.points.length===0?null:e:e instanceof ui?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function hve(e,t){if(!e||!e.domain)return t;let i=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=Wv(t);else{if(t==null)return null;if(t==="")return t;t=$s(t)}for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.code===t&&(i=s)}return i===null?t:i.name}function dve(e,t){if(!e||!e.domain)return t;let i=null;t=Wv(t);for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.name===t&&(i=s)}return i===null?t:i.code}function Dk(e,t,i=null,r=null){if(!t||!t.fields)return null;let s,n,o=null;for(let a=0;a<t.fields.length;a++){const l=t.fields[a];l.name.toLowerCase()===e.toString().toLowerCase()&&(o=l)}if(o===null)throw new Error("Field not found");return r===null&&i&&t.typeIdField&&(r=i.hasField(t.typeIdField)?i.field(t.typeIdField):null),r!=null&&t.types.some(function(a){return a.id===r&&(s=a.domains&&a.domains[o.name],s&&s.type==="inherited"&&(s=vie(o.name,t),n=!0),!0)}),n||s||(s=vie(e,t)),{field:o,domain:s}}function vie(e,t){let i;return t.fields.some(function(r){return r.name.toLowerCase()===e.toLowerCase()&&(i=r.domain),!!i}),i}function k7(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}function NVe(e){if(e===null)return null;const t=[];for(const i of e)i&&i.arcadeDeclaredClass&&i.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(i.geometry()):t.push(i);return t}function Z2(e,t){if(!(t instanceof at))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function FVe(e,t){if(Qh(e)||$w(e)){let i=!1,r=!1,s=[],n=t;if(Qh(e)){for(const o of e)Z2(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ,r=e[0].hasM)}else if(e instanceof mx)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else{if(!$w(e))throw new Error("Invalid Argument");for(const o of e.toArray())Z2(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(RW(s,r,i)===!1&&(s=s.slice(0).reverse()),new $u({rings:[s],spatialReference:n,hasZ:i,hasM:r}))}return e}function kVe(e,t){if(Qh(e)||$w(e)){let i=!1,r=!1,s=[],n=t;if(Qh(e)){for(const o of e)Z2(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof mx)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if($w(e)){for(const o of e.toArray())Z2(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Tu({paths:[s],spatialReference:n,hasZ:i,hasM:r})}return e}function UVe(e,t){if(Qh(e)||$w(e)){let i=!1,r=!1,s=[],n=t;if(Qh(e)){for(const o of e)Z2(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof mx)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if($w(e)){for(const o of e.toArray())Z2(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new sx({points:s,spatialReference:n,hasZ:i,hasM:r})}return e}function zVe(e,t=!1){const i=[];if(e===null)return i;if(Qh(e)===!0){for(let r=0;r<e.length;r++){const s=Wv(e[r]);s===""&&t!==!0||i.push(s)}return i}if(e instanceof Cm){for(let r=0;r<e.length();r++){const s=Wv(e.get(r));s===""&&t!==!0||i.push(s)}return i}if(l4(e)){const r=Wv(e);return r===""&&t!==!0||i.push(r),i}return[]}let I6=0;function VVe(e){return I6++,I6%100==0?(I6=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function BVe(e,t,i){switch(i){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function wR(e,t=null){return e==null?null:fl(e)||ml(e)||sa(e)?e:e instanceof Ec?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof Cm?e.toArray().map(i=>wR(i,t)):e instanceof Array?e.map(i=>wR(i,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function GVe(e,t,i,r,s){const n=await NY(e,t,i);s[r]=n}async function NY(e,t=null,i=null){if(e instanceof Cm&&(e=e.toArray()),e==null)return null;if(l4(e)||e instanceof Ec||e instanceof Date)return wR(e,i);if(e instanceof Array){const r=[],s=[];for(const n of e)n===null||l4(n)||n instanceof Ec||n instanceof Date?s.push(wR(n,i)):(s.push(null),r.push(GVe(n,t,i,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,i):null}function jVe(e,t,i){const r=e.fullSchema();return r===null||!r.fields?null:Dk(t,r,e,i)}function HVe(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(i=>({name:i.name,code:i.id})):[]}:null}function qVe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;const n=Dk(t,s,e,r);if(i===void 0)try{i=e.field(t)}catch{return null}return hve(n,i)}function WVe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;if(i===void 0){try{i=e.field(t)}catch{return null}return i}return dve(Dk(t,s,e,r),i)}function XVe(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const i=[];for(const r of t.fields)i.push(fVe(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:yie[t.geometryType]===void 0?"":yie[t.geometryType],fields:i}}const YTt=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:ove,ImplicitResultE:ave,NativeFunctionE:IY,SizzleFunctionE:$Y,NativeFunction:mVe,ImplicitResult:gVe,ReturnResult:yVe,SizzleFunction:vVe,voidOperation:hu,breakResult:_Ve,continueResult:bVe,multiReplace:bR,isFunctionParameter:DY,isSimpleType:l4,defaultUndefined:wVe,isString:sa,isBoolean:fl,isNumber:ml,isInteger:xVe,isArray:Qh,isFeature:TVe,isFeatureSet:SVe,isFeatureSetCollection:EVe,isImmutableArray:$w,isDate:Da,pcCheck:CVe,absRound:AVe,generateUUID:MVe,formatNumber:LY,formatDate:$k,standardiseDateFormat:lve,greaterThanLessThan:OVe,equalityTest:cve,toString:Wv,toNumberArray:RVe,toStringExplicit:DL,toNumber:$s,toDate:PVe,toDateTime:IVe,toBoolean:$Ve,fixSpatialReference:DVe,fixNullGeometry:LVe,getDomainValue:hve,getDomainCode:dve,getDomain:Dk,stableStringify:k7,autoCastFeatureToGeometry:NVe,autoCastArrayOfPointsToPolygon:FVe,autoCastArrayOfPointsToPolyline:kVe,autoCastArrayOfPointsToMultiPoint:UVe,toStringArray:zVe,tick:VVe,binaryOperator:BVe,castAsJson:wR,castAsJsonAsync:NY,featureFullDomain:jVe,featureSubtypes:HVe,featureDomainValueLookup:qVe,featureDomainCodeLookup:WVe,featureSchema:XVe},Symbol.toStringTag,{value:"Module"}));var U7;let vM=U7=class extends ve{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new U7({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],vM.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],vM.prototype,"maxValue",void 0),vM=U7=u([P("esri.renderer.support.AuthoringInfoClassBreakInfo")],vM);var z7;let ov=z7=class extends ve{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new z7({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ie(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],ov.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],ov.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],ov.prototype,"label",void 0),u([d({type:[vM],json:{write:!0}})],ov.prototype,"classBreakInfos",void 0),ov=z7=u([P("esri.renderers.support.AuthoringInfoFieldInfo")],ov);var V7;const RI=new wi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),PI=new wi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),_ie={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},bie=["high-to-low","above-and-below","centered-on","extremes"],wie=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],xie=["seconds","minutes","hours","days","months","years"];let Xl=V7=class extends ve{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new V7({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:_ie,json:{write:!0}})],Xl.prototype,"endTime",void 0),u([Rt("endTime")],Xl.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],Xl.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],Xl.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],Xl.prototype,"minSliderValue",void 0),u([d({types:_ie,json:{write:!0}})],Xl.prototype,"startTime",void 0),u([Rt("startTime")],Xl.prototype,"castStartTime",null),u([d({type:RI.apiValues,value:null,json:{type:RI.jsonValues,read:RI.read,write:RI.write}})],Xl.prototype,"style",null),u([d({type:wie,value:null,json:{type:wie,origins:{"web-scene":{type:bie,write:{writer:(e,t)=>{bie.includes(e)&&(t.theme=e)}}}},write:!0}})],Xl.prototype,"theme",null),u([d({type:PI.apiValues,json:{type:PI.jsonValues,read:PI.read,write:PI.write}})],Xl.prototype,"type",void 0),u([d({type:xie,json:{type:xie,write:!0}})],Xl.prototype,"units",void 0),Xl=V7=u([P("esri.renderers.support.AuthoringInfoVisualVariable")],Xl);const YVe=Xl;let LL=class extends ve{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],LL.prototype,"type",void 0),LL=u([P("esri.rest.support.ColorRamp")],LL);const FY=LL;var B7;let j1=B7=class extends FY{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new B7({fromColor:ie(this.fromColor),toColor:ie(this.toColor),algorithm:this.algorithm})}};u([ut({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],j1.prototype,"algorithm",void 0),u([d({type:We,json:{type:[Sr],write:!0}})],j1.prototype,"fromColor",void 0),u([d({type:We,json:{type:[Sr],write:!0}})],j1.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],j1.prototype,"type",void 0),j1=B7=u([P("esri.rest.support.AlgorithmicColorRamp")],j1);const kY=j1;var G7;let _M=G7=class extends FY{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new G7({colorRamps:ie(this.colorRamps)})}};u([d({type:[kY],json:{write:!0}})],_M.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],_M.prototype,"type",void 0),_M=G7=u([P("esri.rest.support.MultipartColorRamp")],_M);const pve=_M,ZVe={key:"type",base:FY,typeMap:{algorithmic:kY,multipart:pve}};function QVe(e){return e&&e.type?e.type==="algorithmic"?kY.fromJSON(e):e.type==="multipart"?pve.fromJSON(e):null:null}var j7;const j_=new wi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),II=new wi({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Tie=new wi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Sie=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],JVe=["high-to-low","above-and-below","above","below","90-10"],KVe=["flow-line","wave-front"],eBe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let gn=j7=class extends ve{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return QVe(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new j7({classificationMethod:this.classificationMethod,colorRamp:ie(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:ie(this.field1),field2:ie(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:j_.apiValues,value:null,json:{type:j_.jsonValues,read:j_.read,write:j_.write,origins:{"web-document":{default:"manual",type:j_.jsonValues,read:j_.read,write:j_.write}}}})],gn.prototype,"classificationMethod",null),u([d({types:ZVe,json:{write:!0}})],gn.prototype,"colorRamp",void 0),u([Ue("colorRamp")],gn.prototype,"readColorRamp",null),u([d({type:[String],value:null,json:{write:!0}})],gn.prototype,"fields",null),u([d({type:ov,value:null,json:{write:!0}})],gn.prototype,"field1",null),u([d({type:ov,value:null,json:{write:!0}})],gn.prototype,"field2",null),u([d({type:KVe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],gn.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],gn.prototype,"focus",null),u([d({type:Number,value:null,json:{type:Sr,write:!0}})],gn.prototype,"numClasses",null),u([d({type:Sie,json:{type:Sie,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],gn.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],gn.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],gn.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],gn.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],gn.prototype,"standardDeviationInterval",null),u([d({type:II.apiValues,value:null,json:{type:II.jsonValues,read:II.read,write:II.write,origins:{"web-scene":{type:Tie.jsonValues,write:{writer:Tie.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],gn.prototype,"type",null),u([d({type:[YVe],json:{write:!0}})],gn.prototype,"visualVariables",void 0),u([d({type:eBe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],gn.prototype,"univariateSymbolStyle",null),u([d({type:JVe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],gn.prototype,"univariateTheme",null),gn=j7=u([P("esri.renderers.support.AuthoringInfo")],gn);const fve=gn,$6=new wi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let bM=class extends ve{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:fve,json:{write:!0}})],bM.prototype,"authoringInfo",void 0),u([d({type:$6.apiValues,readOnly:!0,json:{type:$6.jsonValues,read:!1,write:{writer:$6.write,ignoreOrigin:!0}}})],bM.prototype,"type",void 0),bM=u([P("esri.renderers.Renderer")],bM);const Ey=bM;var H7;let o2=H7=class extends ve{constructor(){super(...arguments),this.title=null}clone(){return new H7({title:this.title})}};u([d({type:String,json:{write:!0}})],o2.prototype,"title",void 0),o2=H7=u([P("esri.renderers.support.LegendOptions")],o2);var q7;let NL=q7=class extends o2{constructor(){super(...arguments),this.showLegend=null}clone(){return new q7({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],NL.prototype,"showLegend",void 0),NL=q7=u([P("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],NL);const mve=NL,tBe=ge.getLogger("esri.renderers.visualVariables.VisualVariable"),D6=new wi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Rd=class extends ve{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(tBe.error(".field: field must be a string value"),null):PP(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],Rd.prototype,"index",void 0),u([d({type:D6.apiValues,readOnly:!0,json:{read:D6.read,write:D6.write}})],Rd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Rd.prototype,"field",void 0),u([Rt("field")],Rd.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Rd.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Rd.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],Rd.prototype,"arcadeRequired",null),u([d({type:mve,json:{write:!0}})],Rd.prototype,"legendOptions",void 0),Rd=u([P("esri.renderers.visualVariables.VisualVariable")],Rd);const t3=Rd;var W7;let H1=W7=class extends t3{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new W7({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],H1.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],H1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],H1.prototype,"normalizationField",void 0),u([d({type:[c5e],json:{write:!0}})],H1.prototype,"stops",null),H1=W7=u([P("esri.renderers.visualVariables.ColorVariable")],H1);const gve=H1;var X7;let $0=X7=class extends ve{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return N2(t.transparency)}writeOpacity(e,t,i){t[i]=FP(e)}clone(){return new X7({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],$0.prototype,"label",void 0),u([d({type:Number,json:{type:Sr,write:{target:"transparency"}}})],$0.prototype,"opacity",void 0),u([Ue("opacity",["transparency"])],$0.prototype,"readOpacity",null),u([Be("opacity")],$0.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],$0.prototype,"value",void 0),$0=X7=u([P("esri.renderers.visualVariables.support.OpacityStop")],$0);const iBe=$0;var Y7;let q1=Y7=class extends t3{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new Y7({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],q1.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],q1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],q1.prototype,"normalizationField",void 0),u([d({type:[iBe],json:{write:!0}})],q1.prototype,"stops",null),q1=Y7=u([P("esri.renderers.visualVariables.OpacityVariable")],q1);const yve=q1;var Z7;let sg=Z7=class extends t3{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new q("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new Z7({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],sg.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],sg.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],sg.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],sg.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],sg.prototype,"valueExpressionTitle",void 0),u([Be("web-scene","valueExpressionTitle")],sg.prototype,"writeValueExpressionTitleWebScene",null),sg=Z7=u([P("esri.renderers.visualVariables.RotationVariable")],sg);const vve=sg;var Q7;let UT=Q7=class extends ve{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new Q7({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],UT.prototype,"label",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],UT.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],UT.prototype,"value",void 0),UT=Q7=u([P("esri.renderers.visualVariables.support.SizeStop")],UT);const rBe=UT;var J7;let FL=J7=class extends mve{constructor(){super(...arguments),this.customValues=null}clone(){return new J7({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],FL.prototype,"customValues",void 0),FL=J7=u([P("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],FL);const sBe=FL;var Xg,ao;function AS(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function xR(e){return e!=null&&!isNaN(e)&&isFinite(e)}function _ve(e){return e.valueExpression?Xg.Expression:e.field&&typeof e.field=="string"?Xg.Field:Xg.Unknown}function nBe(e,t){const i=t||_ve(e),r=e.valueUnit||"unknown";return i===Xg.Unknown?ao.Constant:e.stops?ao.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?ao.ClampedLinear:r==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?ao.Proportional:ao.Additive:ao.Identity:ao.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(Xg||(Xg={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(ao||(ao={}));function ZTt(e){}function oBe(e){return()=>e}const Q2={inches:sn(1,"meters","inches"),feet:sn(1,"meters","feet"),"us-feet":sn(1,"meters","us-feet"),yards:sn(1,"meters","yards"),miles:sn(1,"meters","miles"),"nautical-miles":sn(1,"meters","nautical-miles"),millimeters:sn(1,"meters","millimeters"),centimeters:sn(1,"meters","centimeters"),decimeters:sn(1,"meters","decimeters"),meters:sn(1,"meters","meters"),kilometers:sn(1,"meters","kilometers"),"decimal-degrees":1/o$e(1,"meters",Ri.radius)},c_=ge.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Eie=new Ga,kL=Math.PI,bve=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function wve(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="color"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void c_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(M(i)||M(i.arcade))return void c_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,w=v.getViewInfo(y),b=v.createExecContext(n,w);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=zY(a,c);if(y){const v=y[0],w=y[1],b=v===w?r.stops[v].color:We.blendColors(r.stops[v].color,r.stops[w].color,y[2],_(i)?i.color:void 0);return new We(b)}}}function xve(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="opacity"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void c_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(M(i)||M(i.arcade))return void c_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,w=v.getViewInfo(y),b=v.createExecContext(n,w);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=zY(a,c);if(y){const v=y[0],w=y[1];if(v===w)return r.stops[v].opacity;{const b=r.stops[v].opacity;return b+(r.stops[w].opacity-b)*y[2]}}}}function Tve(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void c_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(M(i)||M(i.arcade))return void c_.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(m),w=y.createExecContext(a,v);if(!p){const b=y.createSyntaxTree(r.valueExpression);p=y.createFunction(b),r.cache.compiledFunc=p}f=y.executeFunction(p,w)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function aBe(e,t,i){const r=typeof t=="number",s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=_(i)?i.scale:void 0,p=_(i)?i.view:void 0;o=h==null||p==="3d"?lBe(e):h}else if(!r)switch(e.inputValueType){case Xg.Expression:{if(M(i)||M(i.arcade))return void c_.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(e.valueExpression);l=p.createFunction(y),e.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case Xg.Field:n&&(o=n[e.field]);break;case Xg.Unknown:o=null}if(!xR(o))return null;if(r||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return xR(c)&&c!==0?o/c:null}function lBe(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function Lk(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void c_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=Eve(aBe(r,t,i),r,t,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function _c(e,t,i){return e==null?null:AS(e)?Lk(e,t,i):xR(e)?e:null}function Sve(e,t,i){return xR(i)&&e>i?i:xR(t)&&e<t?t:e}function cBe(e,t,i,r){return e+(_c(t.minSize,i,r)||t.minDataValue)}function uBe(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=e.minSize),_c(s,t,i)}function hBe(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=_c(t.minSize,i,r),o=_c(t.maxSize,i,r),a=_(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?kL*(n/2)**2:n*n,h=c+s*((l?kL*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/kL):Math.sqrt(h)}return n+s*(o-n)}function dBe(e,t,i,r){const s=_(r)?r.shape:void 0,n=e/t.minDataValue,o=_c(t.minSize,i,r),a=_c(t.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,Sve(l,o,a)}function pBe(e,t,i,r,s){const[n,o,a]=zY(e,s);if(n===o)return _c(t.stops[n].size,i,r);{const l=_c(t.stops[n].size,i,r);return l+(_c(t.stops[o].size,i,r)-l)*a}}function fBe(e,t,i,r){const s=(_(r)&&r.resolution?r.resolution:1)*Q2[t.valueUnit],n=_c(t.minSize,i,r),o=_c(t.maxSize,i,r),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/kL)/s:a==="radius"||a==="distance"?2*e/s:e/s,Sve(l,n,o)}function Eve(e,t,i,r,s){switch(t.transformationType){case ao.Additive:return cBe(e,t,i,r);case ao.Constant:return uBe(t,i,r);case ao.ClampedLinear:return hBe(e,t,i,r);case ao.Proportional:return dBe(e,t,i,r);case ao.Stops:return pBe(e,t,i,r,s);case ao.RealWorldSize:return fBe(e,t,i,r);case ao.Identity:return e;case ao.Unknown:return null}}function mBe(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&i==="3d"||t))return null;const s={scale:t,view:i};let n=_c(e.minSize,Eie,s),o=_c(e.maxSize,Eie,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function UY(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=wve(l,t,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=xve(l,t,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=Tve(l,t,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=Lk(l,t,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function zY(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((s,n)=>e<s?(r=n,!0):(i=n,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function gBe(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":Lk(s,t,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}var VY=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getAllSizes:gBe,getColor:wve,getOpacity:xve,getRotationAngle:Tve,getSize:Lk,getSizeForValue:Eve,getSizeFromNumberOrVariable:_c,getSizeRangeAtScale:mBe,getVisualVariableValues:UY,viewScaleRE:bve}),K7;const Mx=ge.getLogger("esri.renderers.visualVariables.SizeVariable"),$I=new wi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),ej=new wi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Cie(e){if(e!=null)return typeof e=="string"||typeof e=="number"?rr(e):e.type==="size"?AS(e)?e:(delete(e=F({},e)).type,new or(e)):void 0}function Aie(e,t,i){if(typeof e!="object")return e;const r=new or;return r.read(e,i),r}let or=K7=class extends t3{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:bve.test(this.valueExpression)}}set expression(e){Mx.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){AS(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),AS(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return _ve(this)}set maxDataValue(e){e&&this.stops&&(Mx.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(Mx.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return Cie(e)}readMaxSize(e,t,i){return Aie(e,t,i)}set minDataValue(e){e&&this.stops&&(Mx.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(Mx.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return Cie(e)}readMinSize(e,t,i){return Aie(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(Mx.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return nBe(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if(e==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new q("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?ej.read(e):null}clone(){return new K7({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:AS(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:AS(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===ao.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===ao.Stops){const e=this.stops,t=e.map(r=>r.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],or.prototype,"cache",null),u([d({type:$I.apiValues,json:{type:$I.jsonValues,origins:{"web-map":{read:!1}},read:$I.read,write:$I.write}})],or.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],or.prototype,"expression",null),u([d()],or.prototype,"index",null),u([d({type:String,readOnly:!0})],or.prototype,"inputValueType",null),u([d({type:sBe,json:{write:!0}})],or.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],or.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],or.prototype,"maxSize",null),u([Rt("maxSize")],or.prototype,"castMaxSize",null),u([Ue("maxSize")],or.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],or.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],or.prototype,"minSize",null),u([Rt("minSize")],or.prototype,"castMinSize",null),u([Ue("minSize")],or.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],or.prototype,"normalizationField",void 0),u([d({readOnly:!0})],or.prototype,"arcadeRequired",null),u([d({type:String})],or.prototype,"scaleBy",void 0),u([d({type:[rBe],value:null,json:{write:!0}})],or.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],or.prototype,"target",void 0),u([d({type:String,readOnly:!0})],or.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],or.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],or.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],or.prototype,"valueExpression",void 0),u([Ue("valueExpression",["valueExpression","expression"])],or.prototype,"readValueExpression",null),u([Be("web-scene","valueExpression")],or.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],or.prototype,"valueRepresentation",void 0),u([d({type:ej.apiValues,json:{write:ej.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],or.prototype,"valueUnit",void 0),u([Ue("valueUnit")],or.prototype,"readValueUnit",null),or=K7=u([P("esri.renderers.visualVariables.SizeVariable")],or);const Cve=or,yBe=ge.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),vBe={color:gve,size:Cve,opacity:yve,rotation:vve},_Be=new wi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),bBe=/^\[([^\]]+)\]$/i;let UL=class extends Se{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,i)=>{let r=null;return r=t.target===i.target?0:t.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(bBe),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=_Be.read(a.type),c=vBe[l];c||(yBe.warn(`Unknown variable type: ${l}`),i&&i.messages&&i.messages.push(new Iu("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:i})));const h=new c;return h.read(a,i),h})}writeVariables(e,t){const i=[];for(const r of e){const s=r.toJSON(t);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],UL.prototype,"visualVariables",null),UL=u([P("esri.renderers.visualVariables.VisualVariableFactory")],UL);const wBe=UL,xBe={base:t3,key:"type",typeMap:{opacity:yve,color:gve,rotation:vve,size:Cve}},oC=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new wBe}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Gh(i,r,n.field),n.normalizationField&&Gh(i,r,n.normalizationField),n.valueExpression&&await Ol(i,r,n.valueExpression))}};return u([d({types:[xBe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([Ue("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([Be("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([P("esri.renderers.mixins.VisualVariablesMixin")],t),t},kC={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function TBe(e,t=kC){var a,l;if(!e)return{symbol:null};const{retainId:i=kC.retainId,ignoreDrivers:r=kC.ignoreDrivers,hasLabelingContext:s=kC.hasLabelingContext,retainCIM:n=kC.retainCIM}=t;let o;if(U2(e)||e instanceof ux)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new q("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():Av.fromCIMSymbol(e)}else if(e instanceof od)o=Q5.fromSimpleLineSymbol(e);else if(e instanceof M_)o=Av.fromSimpleMarkerSymbol(e);else if(e instanceof J5)o=Av.fromPictureMarkerSymbol(e);else if(e instanceof A_)o=VP.fromSimpleFillSymbol(e);else{if(!(e instanceof ZE))return{error:new q("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?Z5.fromTextSymbol(e):Av.fromTextSymbol(e)}if(i&&o.type!=="cim"&&(o.id=e.id),r&&U2(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}const SBe=["building-scene","integrated-mesh","point-cloud","scene"];function u4(e,t,i,r){const s=Ave(e,{},{context:r,isLabelSymbol:!1});_(s)&&(t[i]=s)}function Mie(e,t,i,r){const s=Ave(e,{},{context:r,isLabelSymbol:!0});_(s)&&(t[i]=s)}function Oie(e){return e instanceof YE||e instanceof ux}function Ave(e,t,i){var a;if(M(e))return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!Oie(e)){const l=TBe(e,{retainCIM:!0,hasLabelingContext:s});return _(l.symbol)?l.symbol.write(t,r):(o==null||o.push(new q("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:l.error})),null)}return(n==="web-map"||n==="portal-item"&&!SBe.includes((a=r==null?void 0:r.layer)==null?void 0:a.type))&&Oie(e)?(o==null||o.push(new q("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:r})),null):e.write(t,r)}function QTt(e,t){return nIe(e,null,t)}const i3={types:wfe,json:{write:{writer:u4},origins:{"web-scene":{types:QK,write:{writer:u4},read:{reader:GE({types:QK})}}}}},Mve={types:{base:Pc,key:"type",typeMap:{"simple-fill":nw.typeMap["simple-fill"],"picture-fill":nw.typeMap["picture-fill"],"polygon-3d":nw.typeMap["polygon-3d"]}},json:{write:{writer:u4},origins:{"web-scene":{type:VP,write:{writer:u4}}}}};var tj;let D0=tj=class extends ve{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new tj({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([d({type:String,json:{write:!0}})],D0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],D0.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],D0.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],D0.prototype,"maxValue",void 0),u([d(i3)],D0.prototype,"symbol",void 0),D0=tj=u([P("esri.renderers.support.ClassBreakInfo")],D0);const h4=D0;var ij;const DI=ge.getLogger("esri.renderers.ClassBreaksRenderer"),Ove="log",zL="percent-of-total",VL="field",LI=new wi({esriNormalizeByLog:Ove,esriNormalizeByPercentOfTotal:zL,esriNormalizeByField:VL}),EBe=ns(h4);let In=ij=class extends oC(Ey){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map(s=>{const n=new h4;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(e,t,i,r){const s=e.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[i]=s}castField(e){return e==null?e:typeof e=="function"?(DI.error(".field: field must be a string value"),null):PP(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&VL||i&&zL||null,t&&i&&DI.warn("warning: both normalizationField and normalizationTotal are set!")):e!==VL&&e!==zL||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r=typeof e=="number"?new h4({minValue:e,maxValue:t,symbol:xfe(i)}):EBe(ie(e)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(M(t)||M(t.arcade))&&DI.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(M(t)||M(t.arcade))&&(i=me(F({},i),{arcade:await nm()}));const r=this.getBreakIndex(e,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(M(t)||M(t.arcade)))return void DI.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(M(t)||M(t.arcade))){const s=await nm(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=me(F({},i),{arcade:s})}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new ij({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ie(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ie(this.visualVariables),legendOptions:ie(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Ol(e,t,this.valueExpression)];Gh(e,t,this.field),Gh(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=ft(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const n=this.normalizationTotal,o=parseFloat(i[this.normalizationField]);if(r===Ove)s=Math.log(s)*Math.LOG10E;else if(r!==zL||isNaN(n)){if(r===VL&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};u([d(Mve)],In.prototype,"backgroundFillSymbol",void 0),u([d({type:[h4]})],In.prototype,"classBreakInfos",void 0),u([Ue("classBreakInfos")],In.prototype,"readClassBreakInfos",null),u([Be("classBreakInfos")],In.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],In.prototype,"defaultLabel",void 0),u([d(i3)],In.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],In.prototype,"field",void 0),u([Rt("field")],In.prototype,"castField",null),u([d({type:Boolean})],In.prototype,"isMaxInclusive",void 0),u([d({type:o2,json:{write:!0}})],In.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],In.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],In.prototype,"normalizationField",void 0),u([d({type:Number,cast:e=>Rh(e),json:{write:!0}})],In.prototype,"normalizationTotal",void 0),u([d({type:LI.apiValues,value:null,json:{type:LI.jsonValues,read:LI.read,write:LI.write}})],In.prototype,"normalizationType",null),u([ut({classBreaks:"class-breaks"})],In.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],In.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],In.prototype,"valueExpressionTitle",void 0),In=ij=u([P("esri.renderers.ClassBreaksRenderer")],In);const Rve=In;class CBe{constructor(t,i){this._storage=new fY,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i,r){this._storage.put(t,i,r,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const Rie=ge.getLogger("esri.renderers.support.DictionaryLoader"),ABe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class BY{constructor(t,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new CBe(100),this.url=t,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(m){if(Qr(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m];if(y&&t.attributes[y]!=null){const v=""+t.attributes[y];s[m]=v}else s[m]=""}const n=r(s,i);if(!n||typeof n!="string")return null;const o=sW(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const y=m.substr(3).split("|");if(y.length===3){const v=y[0],w=y[1];let b=y[2];if(w==="DashTemplate")b=b.split(" ").map(S=>Number(S));else if(w==="Color"){const S=new We(b).toRgba();b=[S[0],S[1],S[2],255*S[3]]}else b=Number(b);h.push({primitiveName:v,propertyName:w,value:b})}}else if(m.includes("|")){for(const y of m.split("|"))if(this._itemNames.has(y)){c.push(y);break}}else this._itemNames.has(m)&&c.push(m);const p=!_(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void Rie.error("no valid URL!");const i=gr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:_(t)?t.signal:null}),[{data:r}]=await Promise.all([i,nm()]);if(!r)throw this._dictionaryPromise=null,new q("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const l=this.config;for(const c in l)o[c]=l[c]}if(n.configuration)for(const l of n.configuration)o.hasOwnProperty(l.name)||(o[l.name]=l.value);const a=[];if(_(t)&&t.fields&&this.fieldMap)for(const l of this._symbolFields){const c=this.fieldMap[l],h=t.fields.filter(p=>p.name===c);h.length>0&&a.push(me(F({},h[0]),{name:l}))}return this._dictionaryPromise=pRe(s,_(t)?t.spatialReference:null,a,o).then(l=>{const c={scale:0};return(h,p)=>{const f=l.repurposeFeature({geometry:null,attributes:h});return c.scale=_(p)?p.scale:void 0,l.evaluate({$feature:f,$view:c})}}).catch(l=>(Rie.error("Creating dictinoary expression failed:",l),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,i,r,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;for(const l of o)Pve(l,a);return new qE({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(t,i){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=gr(r,F({responseType:"json",query:{f:"json"}},i));this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,i,r){if(!t||t.length===0)return null;const s=F({},t[0]);if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=ABe),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}}function Pve(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&MBe(s,t)}}function MBe(e,t){const i=e.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":Pve(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}var JTt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DictionaryLoader:BY}),rj;let Pd=rj=class extends oC(Ey){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new BY(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){(r==null?void 0:r.origin)||super.writeVisualVariables(e,t,i,r)}clone(){return new rj({config:ie(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ie(this.fieldMap),url:ie(this.url),visualVariables:ie(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Ol(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:BY})],Pd.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Pd.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],Pd.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Pd.prototype,"scaleExpression",void 0),u([Be("scaleExpression")],Pd.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],Pd.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],Pd.prototype,"url",void 0),u([Be("visualVariables")],Pd.prototype,"writeVisualVariables",null),Pd=rj=u([P("esri.renderers.DictionaryRenderer")],Pd);const OBe=Pd;var sj;const RBe=ge.getLogger("esri.renderers.support.AttributeColorInfo");let ng=sj=class extends ve{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(RBe.error(".field: field must be a string value"),null):PP(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new sj({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:We,json:{type:[Number],write:!0}})],ng.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],ng.prototype,"field",void 0),u([Rt("field")],ng.prototype,"castField",null),u([d({type:String,json:{write:!0}})],ng.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],ng.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],ng.prototype,"valueExpressionTitle",void 0),ng=sj=u([P("esri.renderers.support.AttributeColorInfo")],ng);const Ive=ng;var nj;let BL=nj=class extends ve{constructor(){super(...arguments),this.unit=null}clone(){return new nj({unit:this.unit})}};u([d({type:String,json:{write:!0}})],BL.prototype,"unit",void 0),BL=nj=u([P("esri.renderers.support.DotDensityLegendOptions")],BL);const PBe=BL;var oj;let xa=oj=class extends oC(Ey){constructor(e){super(e),this.attributes=null,this.backgroundColor=new We([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new od,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new A_({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new oj({attributes:ie(this.attributes),backgroundColor:ie(this.backgroundColor),dotBlendingEnabled:ie(this.dotBlendingEnabled),dotShape:ie(this.dotShape),dotSize:ie(this.dotSize),dotValue:ie(this.dotValue),legendOptions:ie(this.legendOptions),outline:ie(this.outline),referenceScale:ie(this.referenceScale),visualVariables:ie(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Ol(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[Ive],json:{write:!0}})],xa.prototype,"attributes",void 0),u([d({type:We,json:{write:!0}})],xa.prototype,"backgroundColor",void 0),u([d({type:Boolean}),qe("dotBlendingEnabled")],xa.prototype,"blendDots",void 0),u([d({type:Boolean,json:{write:!0}})],xa.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],xa.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],xa.prototype,"dotSize",void 0),u([d({type:PBe,json:{write:!0}})],xa.prototype,"legendOptions",void 0),u([d({type:od,json:{default:null,write:!0}})],xa.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],xa.prototype,"dotValue",void 0),u([d({type:Number}),qe("dotValue")],xa.prototype,"referenceDotValue",void 0),u([d({type:Number,json:{write:!0}})],xa.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],xa.prototype,"seed",void 0),u([ut({dotDensity:"dot-density"})],xa.prototype,"type",void 0),xa=oj=u([P("esri.renderers.DotDensityRenderer")],xa);const IBe=xa;let zT=class extends Oc(ve){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],zT.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],zT.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],zT.prototype,"title",void 0),zT=u([P("esri.renderers.support.HeatmapLegendOptions")],zT);const GY=2.4;function $Be(e){return Du(e*GY)}function DBe(e){return fo(e)/GY}function LBe(e,t,i,r){let{color:s,ratio:n}=t,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=De((r-n)/(a-n),0,1);F5(e,s.toArray(),o.toArray(),l)}function KTt(e){const i=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return i;let r=e[0],s=e[0],n=1;const o=Ht();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)r=s,s=e[n++];LBe(o,r,s,l),i.set(o,4*a)}return i}function eSt(e,t,i,r){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round(fo(s)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const p=FBe(o,n),f=new Set;for(const m of e){const y=m.getCursor();for(;y.next();){const v=y.getObjectId();if(f.has(v))continue;f.add(v);const w=y.readLegacyPointGeometry(),b=128;if(w.x<-b||w.x>=i+b||w.y<-b||w.y>r+b)continue;const S=+p(y),T=Math.max(0,Math.round(w.x)-a),E=Math.max(0,Math.round(w.y)-a),C=Math.min(r,Math.round(w.y)+a),A=Math.min(i,Math.round(w.x)+a);for(let I=E;I<C;I++)for(let L=T;L<A;L++){const D=I*i+L,U=NBe(w.x-L,w.y-I,a);c=l[D]+=U*S,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function NBe(e,t,i){const r=Math.sqrt(e**2+t**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function tSt(e,t){return typeof e=="function"?e:e?typeof t=="string"?i=>-1*+i[e]:i=>+i[e]+t:()=>1}function FBe(e,t){return e!=null?typeof t=="string"?i=>-1*+i.readAttribute(e):i=>+i.readAttribute(e)+t:i=>1}var aj;const kBe=ge.getLogger("esri.renderers.HeatmapRenderer");function Pie(e){if(e!=null){const{maxDensity:i,minDensity:r,radius:s}=e;if(i!=null||r!=null||s!=null){const t=e,{blurRadius:n,maxPixelIntensity:o,minPixelIntensity:a}=t;return W3(t,["blurRadius","maxPixelIntensity","minPixelIntensity"])}}return e}let Qn=aj=class extends Ey{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new yO({ratio:0,color:new We("rgba(255, 140, 0, 0)")}),new yO({ratio:.75,color:new We("rgba(255, 140, 0, 1)")}),new yO({ratio:.9,color:new We("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return Pie(e)}get blurRadius(){return DBe(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",$Be(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(GY**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||Ba(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,ix(()=>{vAe(kBe,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=Pie(e),super.read(e,t)}getSymbol(){const e=this.referenceScale!==0?5:1,t=Math.min(this.radius*e,Du(256));return new M_({size:t})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await Gh(e,t,i),r&&typeof r=="string"&&await Ol(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new aj({colorStops:ie(this.colorStops),field:this.field,legendOptions:ie(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:fve,json:{write:!1}})],Qn.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Qn.prototype,"blurRadius",null),u([d({type:[yO],json:{write:!0}})],Qn.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],Qn.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],Qn.prototype,"fieldOffset",void 0),u([d({type:zT,json:{write:!0}})],Qn.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],Qn.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Qn.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],Qn.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Qn.prototype,"minPixelIntensity",null),u([d({type:Number,cast:rr,json:{write:!0}})],Qn.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],Qn.prototype,"referenceScale",void 0),u([ut({heatmap:"heatmap"})],Qn.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Qn.prototype,"valueExpression",void 0),u([d({type:String})],Qn.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],Qn.prototype,"_pixelIntensityToDensity",null),Qn=aj=u([P("esri.renderers.HeatmapRenderer")],Qn);const $ve=Qn;let Ab=class extends Oc(ve){constructor(){super(...arguments),this.color=new We([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:We,json:{write:!0}})],Ab.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Ab.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Ab.prototype,"threshold",void 0),Ab=u([P("esri.renderers.support.OthersCategory")],Ab);let GL=class extends Oc(ve){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],GL.prototype,"title",void 0),GL=u([P("esri.renderers.support.PieChartLegendOptions")],GL);let Xc=class extends oC(Oc(Ey)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new We([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Ab,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new M_({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Ol(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[Ive],json:{write:!0}})],Xc.prototype,"attributes",void 0),u([d({type:A_,json:{default:null,write:!0}})],Xc.prototype,"backgroundFillSymbol",void 0),u([d({type:We,json:{write:!0}})],Xc.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],Xc.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Xc.prototype,"holePercentage",void 0),u([d({type:Ab,json:{write:!0}})],Xc.prototype,"othersCategory",void 0),u([d({type:GL,json:{write:!0}})],Xc.prototype,"legendOptions",void 0),u([d({type:od,json:{default:null,write:!0}})],Xc.prototype,"outline",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],Xc.prototype,"size",void 0),u([ut({pieChart:"pie-chart"})],Xc.prototype,"type",void 0),Xc=u([P("esri.renderers.PieChartRenderer")],Xc);const UBe=Xc;var lj;let W1=lj=class extends oC(Ey){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new lj({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ie(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],W1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],W1.prototype,"label",void 0),u([d(i3)],W1.prototype,"symbol",void 0),u([ut({simple:"simple"})],W1.prototype,"type",void 0),W1=lj=u([P("esri.renderers.SimpleRenderer")],W1);const jY=W1,zBe=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function cj(e){return e instanceof Se}function Iie(e){return e instanceof it?Object.keys(e.items):cj(e)?Ba(e).keys():e?Object.keys(e):[]}function NI(e,t){return e instanceof it?e.items[t]:e[t]}function VBe(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function xO(e){return e?e.declaredClass:null}function Dve(e,t){const i=e.diff;if(i&&typeof i=="function")return i(e,t);const r=Iie(e),s=Iie(t);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||VBe(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&NI(e,p)!==NI(t,p)).concat(n,o).sort(),l=xO(e);if(l&&zBe.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=cj(e)&&cj(t);for(const p of a){const f=NI(e,p),m=NI(t,p);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[p]&&typeof i[p]=="function")y=i[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&xO(f)===xO(m)?Dve(f,m):{type:"complete",oldValue:f,newValue:m};_(y)&&(_(c)?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function BBe(e,t){if(M(e))return!1;const i=t.split(".");let r=e;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function iSt(e,t){for(const i of t)if(BBe(e,i))return!0;return!1}function GBe(e,t){if(!(typeof e=="function"||typeof t=="function"||M(e)&&M(t)))return M(e)||M(t)||typeof e=="object"&&typeof t=="object"&&xO(e)!==xO(t)?{type:"complete",oldValue:e,newValue:t}:Dve(e,t)}function FI(e){if(M(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const i of t.added)if(!FI(i))return!1;for(const i of t.removed)if(!FI(i))return!1;for(const i of t.changed)if(!FI(i))return!1;return!0}case"partial":for(const t in e.diff)if(!FI(e.diff[t]))return!1;return!0}}var uj;let L0=uj=class extends ve{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new uj({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([d({type:String,json:{write:!0}})],L0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],L0.prototype,"label",void 0),u([d(i3)],L0.prototype,"symbol",void 0),u([d({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],L0.prototype,"value",void 0),u([Rt("value")],L0.prototype,"castValue",null),L0=uj=u([P("esri.renderers.support.UniqueValueInfo")],L0);const d4=L0,jBe=()=>!!he("enable-feature:force-wosr"),rSt=()=>!!he("enable-feature:direct-3d-object-feature-layer-display"),L6={};async function HBe(e,t){try{return{data:(await YBe(e,t)).data,baseUrl:s3e(e),styleUrl:e}}catch(i){return by(i),null}}function qBe(e,t,i){const r=_(t.portal)?t.portal:mo.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return L6[n]||(L6[n]=WBe(e,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl,styleName:e}))),L6[n]}function WBe(e,t,i){return t.load(i).then(()=>{const r=new Ng({disableExtraQuery:!0,query:`owner:${$ie} AND type:${Die} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords.some(a=>a.toLowerCase()===n)&&o.type===Die&&o.owner===$ie){s=o;break}}if(!s)throw new q("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(i)})}function XBe(e,t,i){return e.styleUrl?HBe(e.styleUrl,i):e.styleName?qBe(e.styleName,t,i):Promise.reject(new q("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function sSt(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function nSt(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!jBe()){for(const i of e.formatInfos)if(i.type==="gltf")return i.href}return e.webRef}function YBe(e,t){const i=F({responseType:"json",query:{f:"json"}},t);return gr(jh(e),i)}const $ie="esri_en",Die="Style",oSt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var wM;const H_=ge.getLogger("esri.renderers.UniqueValueRenderer"),ZBe=ns(d4);let Os=wM=class extends oC(Ey){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=t.find(a=>a.value===i[n].value);o?GBe(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<t.length;n++)i.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:PP(e)}writeField(e,t,i,r){typeof e=="string"?t[i]=e:r&&r.messages?r.messages.push(new q("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):H_.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||mo.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const r=XE(t.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=Cw(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?H_.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void H_.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?ZBe(e):new d4({value:e,symbol:xfe(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)H_.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(M(t)||M(t.arcade))&&(i=me(F({},i),{arcade:await nm()})),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(M(t)||M(t.arcade)))return void H_.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(M(i)||M(i.arcade))){const s=await nm(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=me(F({},i),{arcade:s})}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new wM({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ie(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ie(this.visualVariables),legendOptions:ie(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ie(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=ie(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(ie(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Ol(e,t,this.valueExpression)];Gh(e,t,this.field),Gh(e,t,this.field2),Gh(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return XBe(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const r=new ux({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new d4({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=ft(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(i[t]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof t=="function"?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new wM(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||mo.getDefault());const r=i.populateFromStyle();return r.catch(s=>{H_.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(e,t){const i=new wM(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch(s=>{H_.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([d({readOnly:!0})],Os.prototype,"_cache",null),u([ut({uniqueValue:"unique-value"})],Os.prototype,"type",void 0),u([d(Mve)],Os.prototype,"backgroundFillSymbol",void 0),u([d({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Os.prototype,"field",void 0),u([Rt("field")],Os.prototype,"castField",null),u([Be("field")],Os.prototype,"writeField",null),u([d({type:String,json:{write:!0}})],Os.prototype,"field2",void 0),u([d({type:String,json:{write:!0}})],Os.prototype,"field3",void 0),u([d({type:String,json:{write:!0}})],Os.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Os.prototype,"valueExpressionTitle",void 0),u([d({type:o2,json:{write:!0}})],Os.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],Os.prototype,"defaultLabel",void 0),u([d(dhe(F({},i3),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Os.prototype,"defaultSymbol",null),u([d({type:String,json:{write:!0}})],Os.prototype,"fieldDelimiter",void 0),u([d({type:mo,readOnly:!0})],Os.prototype,"portal",void 0),u([Ue("portal",["styleName"])],Os.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Os.prototype,"styleOrigin",void 0),u([Ue("styleOrigin",["styleName","styleUrl"])],Os.prototype,"readStyleOrigin",null),u([Be("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Os.prototype,"writeStyleOrigin",null),u([d({type:[d4],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Os.prototype,"uniqueValueInfos",null),Os=wM=u([P("esri.renderers.UniqueValueRenderer")],Os);const HY=Os,Nk={key:"type",base:Ey,typeMap:{heatmap:$ve,simple:jY,"unique-value":HY,"class-breaks":Rve,"dot-density":IBe,dictionary:OBe,"pie-chart":UBe},errorContext:"renderer"},QBe={key:"type",base:Ey,typeMap:{simple:jY,"unique-value":HY,"class-breaks":Rve,heatmap:$ve},errorContext:"renderer"},JBe=GE({types:Nk});function KBe(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Iu("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):JBe(e,t,i):null}class qY{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array($8),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const i=new qY,r=this._originStores[Oi.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,ie(s),Oi.DEFAULTS)});for(let s=Oi.SERVICE;s<$8;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||i.set(a,ie(o),s)})}return i}get(t,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(t):void 0}keys(t){const i=t==null?this._values:this._originStores[t];return i?[...i.keys()]:[]}set(t,i,r=Oi.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(t,i),!this._values.has(t)||this._propertyOriginMap.get(t)<=r){const n=this._values.get(t);return this._values.set(t,i),this._propertyOriginMap.set(t,r),n!==i}return!1}delete(t,i=Oi.USER){const r=this._originStores[i];if(!r)return;const s=r.get(t);if(r.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===i){this._values.delete(t);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(t)}revert(t,i){for(;i>0&&!this.has(t,i);)--i;const r=this._originStores[i],s=r&&r.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,i),n!==s}originOf(t){return this._propertyOriginMap.get(t)||Oi.DEFAULTS}forEach(t){this._values.forEach(t)}}const Lve=e=>{let t=class extends e{constructor(...i){super(...i);const r=Ba(this),s=r.store,n=new qY;r.store=n,hde(r,s,n)}read(i,r){pde(this,i,r)}getAtOrigin(i,r){const s=N6(this),n=Tv(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return uF(this.originIdOf(i))}originIdOf(i){return N6(this).originOf(i)}revert(i,r){const s=N6(this),n=Tv(r),o=Ba(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function N6(e){return Ba(e).store}let Lie=class extends Lve(Se){};Lie=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],Lie);const e8e=e=>{let t=class extends e{constructor(...i){super(...i)}clear(i,r="user"){return F6(this).delete(i,Tv(r))}write(i={},r){return gde(this,i=i||{},r),i}setAtOrigin(i,r,s){Ba(this).setAtOrigin(i,r,Tv(s))}removeOrigin(i){const r=F6(this),s=Tv(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Oi.USER)}updateOrigin(i,r){const s=F6(this),n=Tv(r),o=this.get(i);for(let a=n+1;a<$8;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return t=u([P("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function F6(e){return Ba(e).store}const WY=e=>{let t=class extends e8e(Lve(e)){constructor(...i){super(...i)}};return t=u([P("esri.core.MultiOriginJSONSupport")],t),t};let hj=class extends WY(Se){};hj=u([P("esri.core.MultiOriginJSONSupport")],hj);async function t8e(e,t){const{WhereClause:i}=await import("./WhereClause.c045f23c.js");return i.create(e,t)}function i8e(e,t){return _(e)?_(t)?`(${e}) AND (${t})`:e:t}var dj;let X1=dj=class extends ve{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new dj({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],X1.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],X1.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],X1.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],X1.prototype,"title",void 0),X1=dj=u([P("esri.form.ExpressionInfo")],X1);const r8e=X1;let Y1=class extends ve{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],Y1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],Y1.prototype,"label",void 0),u([d()],Y1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Y1.prototype,"visibilityExpression",void 0),Y1=u([P("esri.form.elements.Element")],Y1);const J2=Y1;var pj;let jL=pj=class extends ve{constructor(e){super(e),this.type=null}clone(){return new pj({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],jL.prototype,"type",void 0),jL=pj=u([P("esri.form.elements.inputs.AttachmentInput")],jL);const s8e=jL;var fj;let Z1=fj=class extends J2{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new fj({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],Z1.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],Z1.prototype,"editable",void 0),u([d({type:s8e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Z1.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],Z1.prototype,"type",void 0),Z1=fj=u([P("esri.form.elements.AttachmentElement")],Z1);const Nie=Z1;let HL=class extends ve{constructor(e){super(e),this.type=null}};u([d()],HL.prototype,"type",void 0),HL=u([P("esri.form.elements.inputs.Input")],HL);const aC=HL;let xM=class extends aC{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],xM.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],xM.prototype,"minLength",void 0),xM=u([P("esri.form.elements.inputs.TextInput")],xM);const XY=xM;var mj;let qL=mj=class extends XY{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new mj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],qL.prototype,"type",void 0),qL=mj=u([P("esri.form.elements.inputs.BarcodeScannerInput")],qL);const n8e=qL;var gj;let VT=gj=class extends aC{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new gj({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],VT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],VT.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],VT.prototype,"type",void 0),VT=gj=u([P("esri.form.elements.inputs.ComboBoxInput")],VT);const o8e=VT;var yj;function Fie(e){return e!=null?new Date(e):null}function kie(e){return e?e.getTime():null}let Id=yj=class extends aC{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return Fie(t.max)}writeMax(e,t){t.max=kie(e)}readMin(e,t){return Fie(t.min)}writeMin(e,t){t.min=kie(e)}clone(){return new yj({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};u([d({type:Boolean,json:{write:!0}})],Id.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],Id.prototype,"max",void 0),u([Ue("max")],Id.prototype,"readMax",null),u([Be("max")],Id.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],Id.prototype,"min",void 0),u([Ue("min")],Id.prototype,"readMin",null),u([Be("min")],Id.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],Id.prototype,"type",void 0),Id=yj=u([P("esri.form.elements.inputs.DateTimePickerInput")],Id);const a8e=Id;var vj;let BT=vj=class extends aC{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new vj({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],BT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],BT.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],BT.prototype,"type",void 0),BT=vj=u([P("esri.form.elements.inputs.RadioButtonsInput")],BT);const l8e=BT;var _j;let GT=_j=class extends aC{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new _j({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],GT.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],GT.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],GT.prototype,"type",void 0),GT=_j=u([P("esri.form.elements.inputs.SwitchInput")],GT);const c8e=GT;var bj;let WL=bj=class extends XY{constructor(e){super(e),this.type="text-area"}clone(){return new bj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],WL.prototype,"type",void 0),WL=bj=u([P("esri.form.elements.inputs.TextAreaInput")],WL);const u8e=WL;var wj;let XL=wj=class extends XY{constructor(e){super(e),this.type="text-box"}clone(){return new wj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],XL.prototype,"type",void 0),XL=wj=u([P("esri.form.elements.inputs.TextBoxInput")],XL);const h8e=XL,d8e={base:aC,key:"type",typeMap:{"barcode-scanner":n8e,"combo-box":o8e,"datetime-picker":a8e,"radio-buttons":l8e,switch:c8e,"text-area":u8e,"text-box":h8e}};var xj;let uh=xj=class extends J2{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new xj({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:Nye,json:{read:{reader:mY},write:!0}})],uh.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],uh.prototype,"editable",void 0),u([d({type:String,json:{write:!0}})],uh.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],uh.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],uh.prototype,"hint",void 0),u([d({types:d8e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],uh.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],uh.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],uh.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],uh.prototype,"valueExpression",void 0),uh=xj=u([P("esri.form.elements.FieldElement")],uh);const Uie=uh;var Tj;let og=Tj=class extends J2{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Tj({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:ie(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],og.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],og.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],og.prototype,"editable",void 0),u([d({type:[ppe],json:{write:!0}})],og.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],og.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],og.prototype,"type",void 0),og=Tj=u([P("esri.form.elements.RelationshipElement")],og);const zie=og;function Nve(e){return{typesWithGroup:{base:J2,key:"type",typeMap:{attachment:Nie,field:Uie,group:e,relationship:zie}},typesWithoutGroup:{base:J2,key:"type",typeMap:{attachment:Nie,field:Uie,relationship:zie}}}}function Fve(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function kve(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>s.toJSON())}function Uve(e,t,i=!0){return e?e.map(r=>wp(i?t.typesWithGroup:t.typesWithoutGroup,r)):null}var Sj;let Mf=Sj=class extends J2{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Uve(e,k6,!1)}readElements(e,t){return Fve(t.formElements,k6,!1)}writeElements(e,t){t.formElements=kve(e,k6,!1)}clone(){return new Sj({description:this.description,elements:ie(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],Mf.prototype,"elements",void 0),u([Rt("elements")],Mf.prototype,"castElements",null),u([Ue("elements",["formElements"])],Mf.prototype,"readElements",null),u([Be("elements")],Mf.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],Mf.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],Mf.prototype,"type",void 0),Mf=Sj=u([P("esri.form.elements.GroupElement")],Mf);const k6=Nve(Mf),p8e=Mf;var Ej;const U6=Nve(p8e);let cf=Ej=class extends ve{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Uve(e,U6)}readElements(e,t){return Fve(t.formElements,U6)}writeElements(e,t){t.formElements=kve(e,U6)}clone(){return new Ej({description:this.description,expressionInfos:ie(this.expressionInfos),elements:ie(this.elements),title:this.title})}};u([d({type:String,json:{write:!0}})],cf.prototype,"description",void 0),u([d({json:{write:!0}})],cf.prototype,"elements",void 0),u([Rt("elements")],cf.prototype,"castElements",null),u([Ue("elements",["formElements"])],cf.prototype,"readElements",null),u([Be("elements")],cf.prototype,"writeElements",null),u([d({type:[r8e],json:{write:!0}})],cf.prototype,"expressionInfos",void 0),u([d({type:String,json:{write:!0}})],cf.prototype,"title",void 0),cf=Ej=u([P("esri.form.FormTemplate")],cf);const f8e=cf,m8e=ge.getLogger("esri.layers.support.fromPortalItem");async function g8e(e){const t="portalItem"in e?e:{portalItem:e},i=await import("./portalLayers.eac585e3.js");try{return await i.fromItem(t)}catch(r){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||ki.portalUrl;throw m8e.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let y8e=0,Jn=class extends as.EventedMixin(GW(um)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ui(-180,-90,180,90,Ze.WGS84),this.id=Date.now().toString(16)+"-layer-"+y8e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ze.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await import("./arcgisLayers.2ca269c2.js")).fromUrl(t)}static fromPortalItem(e){return g8e(e)}initialize(){this.when().catch(e=>{var t,i;Qr(e)||ge.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(i=this.id)!=null?i:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?xn(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await gr(e,{query:{f:"json"},responseType:"json"})).data;throw new q("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],Jn.prototype,"attributionDataUrl",void 0),u([d({type:ui})],Jn.prototype,"fullExtent",void 0),u([d({readOnly:!0})],Jn.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],Jn.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],Jn.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],Jn.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],Jn.prototype,"opacity",void 0),u([d({clonable:!1})],Jn.prototype,"parent",void 0),u([d({readOnly:!0})],Jn.prototype,"parsedUrl",null),u([d({type:Boolean})],Jn.prototype,"popupEnabled",void 0),u([d({type:Boolean})],Jn.prototype,"attributionVisible",void 0),u([d({type:Ze})],Jn.prototype,"spatialReference",void 0),u([d({type:String})],Jn.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],Jn.prototype,"type",void 0),u([d()],Jn.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],Jn.prototype,"visible",void 0),Jn=u([P("esri.layers.Layer")],Jn);const TR=Jn;function Vie(e,t,i){if(e.hasM==null||e.hasZ)for(const r of t)for(const s of r)s.length>2&&(s[2]*=i)}function v8e(e,t,i){if(!e&&!t||!i)return;const r=z2(i);Bie(e,i,r),Bie(t,i,r)}function Bie(e,t,i){if(e)for(const r of e)_8e(r.geometry,t,i)}function _8e(e,t,i){if(M(e)||!e.spatialReference||Rc(e.spatialReference,t))return;const r=z2(e.spatialReference)/i;if(r!==1){if("x"in e)e.z!=null&&(e.z*=r);else if("rings"in e)Vie(e,e.rings,r);else if("paths"in e)Vie(e,e.paths,r);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}}let b8e=0;const z6=ge.getLogger("esri.layers.graphics.sources.MemorySource");let Sg=class extends um.LoadableMixin(UP(hx(it))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);b7(e,this.layer.spatialReference,i);const r=Mk.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new q("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return b7(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(i=>({count:i.count,extent:ui.fromJSON(i.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new q("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&r.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}v8e(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||M(e))return;const i=[];for(const{geometry:r}of e)!_(r)||r.type!=="mesh"||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const r=e.get(i.objectId);r!=null&&this._addIdToClientGraphic(r)}for(const i of t.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new q("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!r&&_(o.geometry)&&(r=o.geometry.type),i[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:i,inferredGeometryType:r,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];i!=null&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){var e,t,i;return(i=(e=this.layer)==null?void 0:e.geometryType)!=null?i:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(b8e++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return M(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?$u.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await Pfe("MemorySourceWorker",{strategy:he("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{z6.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:PK.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&s,hasZ:this.layerOrSourceGeometryType==="mesh"||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const f of h.warnings)z6.warn(f.message,{layer:this.layer,warning:f});h.featureErrors.length&&z6.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=PK.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([FW({Type:Ga,ensureType:ns(Ga)})],Sg.prototype,"itemType",void 0),u([d()],Sg.prototype,"type",void 0),u([d({constructOnly:!0})],Sg.prototype,"layer",void 0),u([d({readOnly:!0})],Sg.prototype,"workerGeometryType",null),u([d()],Sg.prototype,"sourceJSON",void 0),Sg=u([P("esri.layers.graphics.sources.MemorySource")],Sg);function w8e(e){return"portalItem"in e}const x8e=e=>{let t=class extends e{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):w8e(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],t.prototype,"apiKey",null),t=u([P("esri.layers.mixins.APIKeyMixin")],t),t},zve={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Vve=Object.values(zve),Bve=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Vve.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),T8e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Vve.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),S8e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function aSt(e){return!!Bve.test(e)}function K2(e){if(M(e))return null;const t=xn(e),i=t.path.match(Bve)||t.path.match(T8e);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:YY(a!==-1?s.slice(a+1):s),serverType:zve[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function E8e(e){const t=xn(e).path.match(S8e);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function YY(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function C8e(e,t){const i=[];if(e){const r=K2(e);_(r)&&r.title&&i.push(r.title)}if(t){const r=YY(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function Gve(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(i)||e.includes(r)||e.includes(s);return n&&o}function A8e(e,t){return e&&Wpe(Xpe(e,t))}function M8e(e){let{url:t}=e;if(!t)return{url:t};t=Xpe(t,e.logger);const i=xn(t),r=K2(i.path);let s;if(_(r))r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const n=E8e(i.path);_(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:Wpe(t),layerId:s}}function O8e(e,t,i,r,s){o_(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=Nu(r.url,i,e.layerId.toString()))}function lSt(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(r||s||n)}const R8e=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=K2(this.url);if(_(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",A8e(i,ge.getLogger(this.declaredClass)))}};return u([d()],t.prototype,"title",null),u([d({type:String})],t.prototype,"url",null),t=u([P("esri.layers.mixins.ArcGISService")],t),t},Gie={read:{reader:dY},write:{allowNull:!0,writer:pY}},P8e=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":Gie,"portal-item":Gie}}})],t.prototype,"effect",void 0),t=u([P("esri.layers.mixins.BlendLayer")],t),t},I8e=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([P("esri.layers.mixins.CustomParametersMixin")],t),t};var Cj;const V6=new wi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),B6=new wi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let uf=Cj=class extends ve{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Kd(F({geometry:ie(i),objectIds:ie(n),spatialRelationship:r,timeExtent:ie(s),where:t,units:o,distance:a},e))}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new Cj({geometry:ie(t),objectIds:ie(s),spatialRelationship:i,timeExtent:ie(r),where:e,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],uf.prototype,"where",void 0),u([d({types:nx,json:{write:!0}})],uf.prototype,"geometry",void 0),u([d({type:V6.apiValues,json:{name:"spatialRel",read:{reader:V6.read},write:{allowNull:!1,writer:V6.write,overridePolicy(){return{enabled:_(this.geometry)}}}}})],uf.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],uf.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],uf.prototype,"objectIds",void 0),u([d({type:B6.apiValues,json:{read:B6.read,write:{writer:B6.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],uf.prototype,"units",void 0),u([d({type:Em,json:{write:!0}})],uf.prototype,"timeExtent",void 0),uf=Cj=u([P("esri.layers.support.FeatureFilter")],uf);const $8e=uf;var Aj;const jie={read:{reader:dY},write:{writer:pY,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Hie={read:{reader:dY},write:{writer:pY,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},qie={name:"showExcludedLabels",default:!0};let Q1=Aj=class extends ve{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var r,s;const i=super.write(e,t);if(t==null?void 0:t.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=t.messages)==null||r.push(new q("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=t.messages)==null||s.push(new q("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new Aj({filter:_(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:$8e,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e==null?void 0:e.write({},r);s&&Object.keys(s).length!==0?xc(i,s,t):xc(i,null,t)}}}})],Q1.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":jie,"portal-item":jie}}})],Q1.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":Hie,"portal-item":Hie}}})],Q1.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":qie,"portal-item":qie}}})],Q1.prototype,"excludedLabelsVisible",void 0),Q1=Aj=u([P("esri.layers.support.FeatureEffect")],Q1);const D8e=Q1,Wie={write:{allowNull:!0}},L8e=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:D8e,json:{origins:{"web-map":Wie,"portal-item":Wie}}})],t.prototype,"featureEffect",void 0),t=u([P("esri.layers.mixins.FeatureEffectLayer")],t),t},N8e={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function F8e(e){if(!e)return e;const{start:t,end:i}=e;return new Em({start:_(t)?Hh(t,-t.getTimezoneOffset(),"minutes"):t,end:_(i)?Hh(i,-i.getTimezoneOffset(),"minutes"):i})}function k8e(e){if(!e)return e;const{start:t,end:i}=e;return new Em({start:_(t)?Hh(t,t.getTimezoneOffset(),"minutes"):t,end:_(i)?Hh(i,i.getTimezoneOffset(),"minutes"):i})}var Mj;let TM=Mj=class extends ve{async collectRequiredFields(e,t){return Ol(e,t,this.expression)}clone(){return new Mj({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([d({type:String,json:{write:!0}})],TM.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],TM.prototype,"title",void 0),TM=Mj=u([P("esri.layers.support.FeatureExpressionInfo")],TM);const Xie=TM;function U8e(e){return Q2[e]!=null}function z8e(e){return 1/(Q2[e]||1)}function V8e(){const e=Object.keys(Q2);return e.sort(),e}const B8e=V8e();var Oj;const kI=fa()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Yie=new wi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let ag=Oj=class extends ve{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):_(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new Oj({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&MCe(this.featureExpressionInfo,e.featureExpressionInfo)}};u([d({type:Xie,json:{write:!0}})],ag.prototype,"featureExpressionInfo",void 0),u([Ue("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],ag.prototype,"readFeatureExpressionInfo",null),u([Be("featureExpressionInfo",{featureExpressionInfo:{type:Xie},"featureExpression.value":{type:[0]}})],ag.prototype,"writeFeatureExpressionInfo",null),u([d({type:kI.apiValues,nonNullable:!0,json:{type:kI.jsonValues,read:kI.read,write:{writer:kI.write,isRequired:!0}}})],ag.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],ag.prototype,"offset",void 0),u([d({type:B8e,json:{type:String,read:Yie.read,write:Yie.write}})],ag.prototype,"unit",null),ag=Oj=u([P("esri.layers.support.ElevationInfo")],ag);const G8e=ag,j8e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},ZY={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},QY={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},H8e={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o_}}},q8e={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},W8e={value:null,type:G8e,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function cSt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const YL={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},X8e=me(F({},YL),{json:me(F({},YL.json),{origins:{"web-document":me(F({},YL.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&i.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?N2(t.layerDefinition.drawingInfo.transparency):void 0:N2(t.drawingInfo.transparency)}})}),uSt={type:Em,readOnly:!0,get(){var a,l;if(!((a=this.layer)==null?void 0:a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=k8e(s));let n=i?r&&s?r.intersection(s):r||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=F8e(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},hSt={type:ui,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=ui.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(i.spatialReference=Ze.fromJSON(t.spatialReference)),i}}}},read:!1}},Y8e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},Z8e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},Q8e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},jve={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},J8e=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&mOe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i||"Layer"}read(i,r){r&&(r.layer=this),fde(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(r==null?void 0:r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=N8e[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new q("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,me(F({},r),{layer:this})),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof q&&l.name==="web-document-write:property-required").length;return k2(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new q("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([d(jve)],t.prototype,"listMode",void 0),u([Be("listMode")],t.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([Be("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([d(YL)],t.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([Be([void 0,"web-scene"],"title")],t.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([P("esri.layers.mixins.OperationalLayer")],t),t};function K8e(e){return"operationalLayerType"in e}var Rj;const G6=new wi({asc:"ascending",desc:"descending"});let jT=Rj=class extends ve{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Rj({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],jT.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],jT.prototype,"valueExpression",void 0),u([d({type:G6.apiValues,json:{read:G6.read,write:G6.write}})],jT.prototype,"order",void 0),jT=Rj=u([P("esri.layers.support.OrderByInfo")],jT);const Hve=jT;function e9e(e,t,i){if(!e)return null;const r=e.find(n=>!!n.field);if(!r)return null;const s=new Hve;return s.read(r,i),[s]}function t9e(e,t,i,r){const s=e.find(n=>!!n.field);s&&xc(i,[s.toJSON()],t)}const i9e=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[Hve],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:e9e},write:{target:"layerDefinition.orderBy",writer:t9e}}})],t.prototype,"orderBy",void 0),t=u([P("esri.layers.mixins.OrderedLayer")],t),t},r9e=ge.getLogger("esri.portal.PortalItemResource");let N0=class extends Se{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?me(F({},e),{path:this._normalizePath(e.path,e.portalItem)}):e}set path(e){_(e)&&Au(e)?r9e.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(M(i))throw new q("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:rs(t,"signal")})}async update(e,t){return(await Promise.resolve().then(function(){return JM})).addOrUpdateResource(this,"update",e,t)}hasPath(){return _(this.path)}_normalizePath(e,t){return M(e)?e:(e=e.replace(/^\/+/,""),_(t)&&Au(e)&&(e=rX(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],N0.prototype,"portalItem",void 0),u([d({type:String,value:null})],N0.prototype,"path",null),u([Rt("path")],N0.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],N0.prototype,"url",null),u([d({type:String,readOnly:!0})],N0.prototype,"itemRelativeUrl",null),N0=u([P("esri.portal.PortalItemResource")],N0);const s9e=N0;let SM=class extends Se{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],SM.prototype,"created",void 0),u([d()],SM.prototype,"rating",void 0),SM=u([P("esri.portal.PortalRating")],SM);const j6=SM;var HT;let ni=HT=class extends $P(um){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return E2(HT,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Video Service"?i="Video Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?i="Locator":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(i="Instant App"),i}readExtent(e){return e&&e.length?new ui(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":"maps",s?Li(i+s+r+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=mo.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:_(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof j6&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new j6({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:ie(this.applicationProxies),avgRating:this.avgRating,categories:ie(this.categories),created:ie(this.created),culture:this.culture,description:this.description,extent:ie(this.extent),groupCategories:ie(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ie(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ie(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:ie(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ie(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new HT({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const i of["tags","typeKeywords","categories"])e[i]&&(e[i]=e[i].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",me(F({responseType:e},t),{query:{token:this.apiKey}}))}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",F({query:{token:this.apiKey}},e)).then(t=>t.rating!=null?(t.created=new Date(t.created),new j6(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",F({query:me(F({},e),{token:this.apiKey})},t),HT)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new q("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")xm(t)?r.query={data:t}:r.query={url:zh(t)},_(i)&&(r.query.filename=i);else{const s=new FormData;_(i)?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new q("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await Promise.resolve().then(function(){return JM})).fetchResources(this,e,t)}async addResource(e,t,i){const r=await Promise.resolve().then(function(){return JM});return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await Promise.resolve().then(function(){return JM});if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new q("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await Promise.resolve().then(function(){return JM})).removeAllResources(this,e)}resourceFromPath(e){return new s9e({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:ie(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:ie(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ie(this.typeKeywords),url:this.url};return rhe(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new HT({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([d({type:["private","shared","org","public"]})],ni.prototype,"access",void 0),u([d()],ni.prototype,"accessInformation",void 0),u([d({type:String})],ni.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],ni.prototype,"applicationProxies",void 0),u([d()],ni.prototype,"avgRating",void 0),u([d()],ni.prototype,"categories",void 0),u([d({type:Date})],ni.prototype,"created",void 0),u([d()],ni.prototype,"culture",void 0),u([d()],ni.prototype,"description",void 0),u([d({readOnly:!0})],ni.prototype,"displayName",null),u([d({type:ui})],ni.prototype,"extent",void 0),u([Ue("extent")],ni.prototype,"readExtent",null),u([d()],ni.prototype,"groupCategories",void 0),u([d({readOnly:!0})],ni.prototype,"iconUrl",null),u([d()],ni.prototype,"id",void 0),u([d({readOnly:!0})],ni.prototype,"isLayer",null),u([d()],ni.prototype,"itemControl",void 0),u([d({readOnly:!0})],ni.prototype,"itemUrl",null),u([d()],ni.prototype,"licenseInfo",void 0),u([d({type:Date})],ni.prototype,"modified",void 0),u([d()],ni.prototype,"name",void 0),u([d()],ni.prototype,"numComments",void 0),u([d()],ni.prototype,"numRatings",void 0),u([d()],ni.prototype,"numViews",void 0),u([d()],ni.prototype,"owner",void 0),u([d()],ni.prototype,"ownerFolder",void 0),u([d({type:mo})],ni.prototype,"portal",void 0),u([d()],ni.prototype,"screenshots",void 0),u([d()],ni.prototype,"size",void 0),u([d()],ni.prototype,"snippet",void 0),u([d()],ni.prototype,"sourceJSON",void 0),u([d({type:String})],ni.prototype,"spatialReference",void 0),u([d()],ni.prototype,"tags",void 0),u([d()],ni.prototype,"thumbnail",void 0),u([d({readOnly:!0})],ni.prototype,"thumbnailUrl",null),u([d()],ni.prototype,"title",void 0),u([d()],ni.prototype,"type",void 0),u([d()],ni.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(e,t){var r;if(t.type!=="KML")return e;const i=(r=this.portal)==null?void 0:r.restUrl;return e||(e=i&&this.id?`${i}/content/items/${this.id}/data`:null),e}}})],ni.prototype,"url",void 0),u([d({readOnly:!0})],ni.prototype,"userItemUrl",null),ni=HT=u([P("esri.portal.PortalItem")],ni);const eE=ni;var qve=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:eE});const n9e=ge.getLogger("esri.layers.mixins.PortalLayer"),o9e=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var i;(i=this.portalItem)==null||i.destroy(),this.portalItem=null}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new eE({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await import("./layersLoader.2ec3d6d1.js").then(function(n){return n.l});return ci(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData},r)}catch(s){throw Qr(s)||n9e.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(by(r),!0)))}async _fetchUserHasEditingPrivileges(i){const r=this.url?zs==null?void 0:zs.findCredential(this.url):null;if(!r)return!0;const s=UI.credential===r?UI.user:await this._fetchEditingUser(i);return UI.credential=r,UI.user=s,M(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const s=zs.findServerInfo(this.url);if(!(s==null?void 0:s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=mo.getDefault();if(o&&o.loaded&&jh(o.restUrl)===jh(n))return o.user;const a=`${n}/community/self`,l=_(i)?i.signal:null,c=await Ac(gr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?dX.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||mo.getDefault());return s&&n&&!Gpe(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new q("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,me(F({},r),{layer:this}))}};return u([d({type:eE})],t.prototype,"portalItem",null),u([Ue("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([Be("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([d({clonable:!1})],t.prototype,"resourceReferences",void 0),u([d({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=u([P("esri.layers.mixins.PortalLayer")],t),t},UI={credential:null,user:null},SR=new it,TO=new WeakMap;function a9e(e){Wve(e)&&SR.push(e)}function l9e(e){Wve(e)&&SR.includes(e)&&SR.remove(e)}function Wve(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function Xve(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:Xve(t,e%t):0}let H6=0,zI=0;function c9e(){var t;const e=Date.now();for(const i of SR)i.refreshInterval&&e-((t=TO.get(i))!=null?t:0)+5>=6e4*i.refreshInterval&&(TO.set(i,e),i.refresh(e))}Rhe(()=>{const e=Date.now();let t=0;for(const i of SR)t=Xve(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?TO.get(i)||TO.set(i,e):TO.delete(i);if(t!==zI){if(zI=t,clearInterval(H6),zI===0)return void(H6=0);H6=setInterval(c9e,zI)}});function u9e(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const h9e=e=>{let t=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=aW(()=>this.hasDataChanged()),this.when().then(()=>{a9e(this)},()=>{})}destroy(){l9e(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){N8(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{ge.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([d()],t.prototype,"refreshParameters",null),t=u([P("esri.layers.mixins.RefreshableLayer")],t),t},d9e=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&p9e(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([P("esri.layers.mixins.ScaleRangeLayer")],t),t};function p9e(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const qb=fa()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var Pj;let EM=Pj=class extends ve{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return Lv(this.value,this.unit,"milliseconds")}clone(){return new Pj({value:this.value,unit:this.unit})}};u([d({type:Number,json:{write:!0},nonNullable:!0})],EM.prototype,"value",void 0),u([d({type:qb.apiValues,json:{type:qb.jsonValues,read:qb.read,write:qb.write},nonNullable:!0})],EM.prototype,"unit",void 0),EM=Pj=u([P("esri.TimeInterval")],EM);const ER=EM;var Ij;let qT=Ij=class extends ve{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new Ij({respectsDaylightSaving:e,timezone:t})}};u([d({type:Boolean,json:{write:!0}})],qT.prototype,"respectsDaylightSaving",void 0),u([Ue("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],qT.prototype,"readRespectsDaylightSaving",null),u([d({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],qT.prototype,"timezone",void 0),qT=Ij=u([P("esri.layers.support.TimeReference")],qT);const f9e=qT;var $j;let Ta=$j=class extends ve{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new Em({start:i,end:r})}writeFullTimeExtent(e,t){e&&_(e.start)&&_(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new ER({value:t.timeInterval,unit:qb.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new ER({value:t.defaultTimeInterval,unit:qb.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new $j({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:ie(n),fullTimeExtent:ie(o),trackIdField:a,useTime:l})}};u([d({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],Ta.prototype,"cumulative",void 0),u([d({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],Ta.prototype,"endField",void 0),u([d({type:Em,json:{write:{enabled:!0,allowNull:!0}}})],Ta.prototype,"fullTimeExtent",void 0),u([Ue("fullTimeExtent",["timeExtent"])],Ta.prototype,"readFullTimeExtent",null),u([Be("fullTimeExtent")],Ta.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Ta.prototype,"hasLiveData",void 0),u([d({type:ER,json:{write:{enabled:!0,allowNull:!0}}})],Ta.prototype,"interval",void 0),u([Ue("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Ta.prototype,"readInterval",null),u([Be("interval")],Ta.prototype,"writeInterval",null),u([d({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],Ta.prototype,"startField",void 0),u([d({type:f9e,json:{write:{enabled:!0,allowNull:!0}}})],Ta.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Ta.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],Ta.prototype,"useTime",void 0),Ta=$j=u([P("esri.layers.support.TimeInfo")],Ta);const Yve=Ta,m9e=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=qb.fromJSON(s.timeOffsetUnits);return n&&o?new ER({value:n,unit:o}):null}set timeInfo(i){Hde(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([d({type:Em,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([d({type:ER})],t.prototype,"timeOffset",void 0),u([Ue("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([d({value:null,type:Yve,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([P("esri.layers.mixins.TemporalLayer")],t),t};var Dj;let Eg=Dj=class extends ve{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new Dj({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};u([d({constructOnly:!0})],Eg.prototype,"name",void 0),u([d({constructOnly:!0})],Eg.prototype,"fields",void 0),u([d({constructOnly:!0})],Eg.prototype,"isAscending",void 0),u([d({constructOnly:!0})],Eg.prototype,"isUnique",void 0),u([d({constructOnly:!0})],Eg.prototype,"description",void 0),Eg=Dj=u([P("esri.layers.support.FeatureIndex")],Eg);let Xv=class extends ve{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Xv.prototype,"type",void 0),Xv=u([P("esri.layers.support.FeatureReduction")],Xv);var Lj;let WT=Lj=class extends ve{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new Lj({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};u([d({type:String,json:{write:!0}})],WT.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],WT.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],WT.prototype,"onStatisticValueExpression",void 0),WT=Lj=u([P("esri.layers.support.OutStatistic")],WT);const g9e=WT;var Nj;let CM=Nj=class extends ve{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new Nj({name:this.name,outStatistic:this.outStatistic.clone()})}};u([d({type:String,json:{write:!0}})],CM.prototype,"name",void 0),u([d({type:g9e,json:{write:!0}})],CM.prototype,"outStatistic",void 0),CM=Nj=u([P("esri.layers.support.AggregateField")],CM);const Zve=CM,JY="__begin__",KY="__end__",y9e=new RegExp(JY,"ig"),v9e=new RegExp(KY,"ig"),Zie=new RegExp("^"+JY,"i"),Qie=new RegExp(KY+"$","i"),p4='"',_9e=p4+" + ",b9e=" + "+p4;function w9e(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function x9e(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function Fk(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=w9e(e.labelExpression),t.type="conventional"),t}function T9e(e){const t=Fk(e);if(!t)return null;switch(t.type){case"conventional":return Fj(t.expression);case"arcade":return t.expression}return null}function S9e(e){const t=Fk(e);if(!t)return null;switch(t.type){case"conventional":return C9e(t.expression);case"arcade":return eZ(t.expression)}return null}function Fj(e){let t;return e?(t=rm(e,i=>JY+'$feature["'+i+'"]'+KY),t=Zie.test(t)?t.replace(Zie,""):p4+t,t=Qie.test(t)?t.replace(Qie,""):t+p4,t=t.replace(y9e,_9e).replace(v9e,b9e)):t='""',t}const E9e=/^\s*\{([^}]+)\}\s*$/i;function C9e(e){const t=e.match(E9e);return t&&t[1].trim()||null}const A9e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,M9e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,O9e=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function eZ(e){if(!e)return null;let t=A9e.exec(e)||M9e.exec(e);return t?t[1]||t[3]:(t=O9e.exec(e),t?t[2]:null)}var kj;let F0=kj=class extends ve{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?Fj(t.value):e}writeExpression(e,t,i){this.value!=null&&(e=Fj(this.value)),e!=null&&(t[i]=e)}clone(){return new kj({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],F0.prototype,"expression",void 0),u([Ue("expression",["expression","value"])],F0.prototype,"readExpression",null),u([Be("expression")],F0.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],F0.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],F0.prototype,"value",void 0),F0=kj=u([P("esri.layers.support.LabelExpressionInfo")],F0);const Qve=F0,Jve=[252,146,31,255],dSt=[153,153,153,255],R9e={type:"esriSMS",style:"esriSMSCircle",size:6,color:Jve,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},P9e={type:"esriSLS",style:"esriSLSSolid",width:.75,color:Jve},I9e={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},$9e={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},D9e={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},L9e={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},N9e={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},pSt=M_.fromJSON(R9e),fSt=od.fromJSON(P9e),mSt=A_.fromJSON(I9e),F9e=ZE.fromJSON($9e);M_.fromJSON(D9e);od.fromJSON(L9e);A_.fromJSON(N9e);var Uj;const VI=new wi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function Kve(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function k9e(e){return(e==null?void 0:e.type)==="map-image"}function e_e(e){var t,i;return!!k9e(e)&&!!((i=(t=e.capabilities)==null?void 0:t.exportMap)==null?void 0:i.supportsArcadeExpressionForLabeling)}function U9e(e){return Kve(e)||e_e(e.layer)}let Js=Uj=class extends ve{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=F9e,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return i(t[r[0]],r[1],r[2]);if(r.length===7){const s=i(t[r[0]],r[1],r[2]),n=r[3],o=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=x9e(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=eZ(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(e==null&&this.labelExpression!=null&&Kve(r))e=new Qve({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return Fk(this)}getLabelExpressionArcade(){return T9e(this)}getLabelExpressionSingleField(){return S9e(this)}hash(){return JSON.stringify(this)}clone(){return new Uj({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ie(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ie(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],Js.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Js.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],Js.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&e_e(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],Js.prototype,"labelExpression",void 0),u([Ue("labelExpression")],Js.prototype,"readLabelExpression",null),u([Be("labelExpression")],Js.prototype,"writeLabelExpression",null),u([d({type:Qve,json:{write:{overridePolicy:(e,t,i)=>U9e(i)?{allowNull:!0}:{enabled:!1}}}})],Js.prototype,"labelExpressionInfo",void 0),u([Be("labelExpressionInfo")],Js.prototype,"writeLabelExpressionInfo",null),u([d({type:VI.apiValues,json:{type:VI.jsonValues,read:VI.read,write:VI.write}})],Js.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Js.prototype,"labelPosition",void 0),u([d({type:Number})],Js.prototype,"maxScale",void 0),u([Be("maxScale")],Js.prototype,"writeMaxScale",null),u([d({type:Number})],Js.prototype,"minScale",void 0),u([Be("minScale")],Js.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],Js.prototype,"repeatLabel",void 0),u([d({type:Number,cast:rr,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Js.prototype,"repeatLabelDistance",void 0),u([d({types:oIe,json:{origins:{"web-scene":{types:aIe,write:Mie,default:null}},write:Mie,default:null}})],Js.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],Js.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],Js.prototype,"where",void 0),Js=Uj=u([P("esri.layers.support.LabelClass")],Js);const kk=Js;var zj;let $d=zj=class extends Xv{constructor(e){super(e),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new zj({fields:ie(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ie(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:ie(this.popupTemplate),renderer:ie(this.renderer)})}};u([ut({binning:"binning"})],$d.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],$d.prototype,"fixedBinLevel",void 0),u([d({type:[kk],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],$d.prototype,"labelingInfo",void 0),u([d(QY)],$d.prototype,"labelsVisible",void 0),u([d(ZY)],$d.prototype,"popupEnabled",void 0),u([d({type:NP,json:{name:"popupInfo",write:!0}})],$d.prototype,"popupTemplate",void 0),u([d({type:[Zve],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],$d.prototype,"fields",void 0),u([d({types:Nk,json:{write:!0}})],$d.prototype,"renderer",void 0),$d=zj=u([P("esri.layers.support.FeatureReductionBinning")],$d);const z9e=$d;var Vj;let Yl=Vj=class extends ve{constructor(e){super(e),this.type="cluster",this.clusterRadius=rr("80px"),this.clusterMinSize=rr("12px"),this.clusterMaxSize=rr("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new Vj({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ie(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ie(this.fields),renderer:ie(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:ie(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Yl.prototype,"type",void 0),u([d({type:Number,cast:e=>e==="auto"?e:rr(e),json:{write:!0}})],Yl.prototype,"clusterRadius",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],Yl.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:rr,json:{write:!0}})],Yl.prototype,"clusterMaxSize",void 0),u([d(ZY)],Yl.prototype,"popupEnabled",void 0),u([d({type:NP,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Yl.prototype,"popupTemplate",void 0),u([d({types:Nk,json:{write:!0}})],Yl.prototype,"renderer",void 0),u([d({types:sIe})],Yl.prototype,"symbol",void 0),u([d({type:[kk],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Yl.prototype,"labelingInfo",void 0),u([d(QY)],Yl.prototype,"labelsVisible",void 0),u([d({type:[Zve],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Yl.prototype,"fields",void 0),Yl=Vj=u([P("esri.layers.support.FeatureReductionCluster")],Yl);const t_e=Yl;var Bj;let ZL=Bj=class extends Xv{constructor(e){super(e),this.type="selection"}clone(){return new Bj}};u([d({type:["selection"]})],ZL.prototype,"type",void 0),ZL=Bj=u([P("esri.layers.support.FeatureReductionSelection")],ZL);const Jie=ZL,Kie={key:"type",base:Xv,typeMap:{selection:t_e}},V9e={types:{key:"type",base:Xv,typeMap:{selection:Jie,cluster:t_e,binning:z9e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Kie},"portal-item":{types:Kie},"web-scene":{types:{key:"type",base:Xv,typeMap:{selection:Jie}}}}}},ere=new wi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let k0=class extends Oc(ve){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],k0.prototype,"name",void 0),u([d({json:{write:!0}})],k0.prototype,"description",void 0),u([d({json:{read:ere.read,write:ere.write}})],k0.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],k0.prototype,"prototype",void 0),u([d({json:{write:!0}})],k0.prototype,"thumbnail",void 0),k0=u([P("esri.layers.support.FeatureTemplate")],k0);const tZ=k0;let lg=class extends Oc(ve){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=mY(e[i]);return t}writeDomains(e,t){var r;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(r=e[s])==null?void 0:r.toJSON());t.domains=i}};u([d({json:{write:!0}})],lg.prototype,"id",void 0),u([d({json:{write:!0}})],lg.prototype,"name",void 0),u([d({json:{write:!0}})],lg.prototype,"domains",void 0),u([Ue("domains")],lg.prototype,"readDomains",null),u([Be("domains")],lg.prototype,"writeDomains",null),u([d({type:[tZ],json:{write:!0}})],lg.prototype,"templates",void 0),lg=u([P("esri.layers.support.FeatureType")],lg);const i_e=lg;function B9e(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function tre(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function ire(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class G9e{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const i=[];for(const r of t){const s=r&&r.name;if(s){const n=rre(s);this._fieldsMap.set(s,r),this._fieldsMap.set(n,r),i.push(n),B9e(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):k5(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),tre(r)||ire(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)tre(t)||ire(t)||t.nullable||wRe(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(rre(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const i=this.get(t);if(i)return i.name}}function rre(e){return e.toLowerCase().trim()}const j9e=ge.getLogger("esri.layers.support.fieldProperties");function H9e(){return{fields:{type:[YP],value:null},fieldsIndex:{readOnly:!0,get(){return new G9e(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||j9e.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return qde(this.fieldsIndex,e)}}}}let XT=class extends Oc(ve){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],XT.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],XT.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:e=>d$e.read(e)||p$e.read(e)}})],XT.prototype,"units",void 0),XT=u([P("esri.layers.support.GeometryFieldsInfo")],XT);const q9e=XT,W9e=/\[([^\[\]]+)\]/gi;function sre(e,t,i){return e?e.map(r=>{const s=new kk;if(s.read(r,i),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(W9e,(o,a)=>`[${X9e(a,n)}]`)}return s}):null}function X9e(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const s=t[r].name;if(s.toLowerCase()===i)return s}return e}var Gj;let YT=Gj=class extends ve{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new it}clone(){return new Gj({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],YT.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],YT.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],YT.prototype,"viewAllLevelIds",void 0),YT=Gj=u([P("esri.layers.support.LayerFloorInfo")],YT);const Y9e=YT,nre=new wi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),ore=new wi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let hh=class extends Oc(ve){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:nre.read,write:nre.write}})],hh.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],hh.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],hh.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],hh.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],hh.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],hh.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],hh.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],hh.prototype,"relationshipTableId",void 0),u([d({json:{read:ore.read,write:ore.write}})],hh.prototype,"role",void 0),hh=u([P("esri.layers.support.Relationship")],hh);const Z9e=hh,Dd=[];function Q9e(e,t){if(Gve(e.url))return!0;const{wkid:i}=t;for(const r of Dd){if(e.version>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}Dd.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),Dd.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),Dd.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),Dd.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),Dd.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),Dd.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),Dd.push([10.61,()=>new Set([102497])]),Dd.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),Dd.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),Dd.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function J9e(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Ac(r.populateFromStyle());if(ci(i),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Iu("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t.origin)}}}const K9e=["oid","global-id"],eGe=["oid","global-id","guid"];function tGe({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=aGe({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!o.length)return null;const a=uGe({titleBase:s,fields:i,displayField:e}),l=cGe();return new NP({title:a,content:l,fieldInfos:o})}const iGe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],rGe=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!r_e(e.name,t)&&(!i||e.name!==i)&&!K9e.includes(e.type)&&!iGe.some(s=>s.test(e.name));function sGe(e,t){const i=e;return t&&(e=e.filter(r=>!t.includes(r.type))),e===i&&(e=e.slice()),e.sort(nGe),e}function nGe(e,t){return e.type==="oid"?-1:t.type==="oid"?1:are(e)?-1:are(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function r_e(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function oGe(e,t){return e.editable&&!eGe.includes(e.type)&&!r_e(e.name,t)}function aGe({editFieldsInfo:e,fields:t,objectIdField:i},r){return sGe(t,(r==null?void 0:r.ignoreFieldTypes)||hGe).map(s=>new LP({fieldName:s.name,isEditable:oGe(s,e),label:s.alias,format:lGe(s),visible:rGe(s,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function lGe(e){switch(e.type){case"small-integer":case"integer":case"single":return new TS({digitSeparator:!0,places:0});case"double":return new TS({digitSeparator:!0,places:2});case"date":return new TS({dateFormat:"long-month-day-year"});default:return e.type==="string"&&Jde(e.name)?new TS({digitSeparator:!0,places:0}):null}}function cGe(){return[new D2,new sR]}function uGe(e){const t=gRe(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}function are(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const hGe=["geometry","blob","raster","guid","xml"],q6=new wi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),dGe={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Qs="FeatureLayer",lre=ge.getLogger("esri.layers.FeatureLayer");function BI(e,t){return new q("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function cre(e){return e&&e instanceof it}function Ft(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function GI(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function pGe(e){var i;const t=(i=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(t==null?void 0:t.includes("envelopeaggregate")),centroid:!!(t==null?void 0:t.includes("centroidaggregate")),convexHull:!!(t==null?void 0:t.includes("convexhullaggregate"))}}function UC(e,t){var r;const i=(r=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i==null?void 0:i.includes(t.toLowerCase()))}const W6=H9e();function X6(e,t,i){const r=!!(i==null?void 0:i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let $e=class extends L8e(P8e(i9e(m9e(d9e(h9e(R8e(J8e(o9e(WY(I8e(x8e(Oc(TR))))))))))))){constructor(...e){super(...e),this._handles=new jt,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Ze.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(it.ofType(Eg)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=lt(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}load(e){const t=_(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(r=>this._initLayerProperties(r)));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(by).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(t);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new q("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{analytics:this._readAnalyticsCapabilities(t),attachment:this._readAttachmentCapabilities(t),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),queryTopFeatures:this._readQueryTopFeaturesCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:i.lastEditDate!=null?new Date(i.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,i,r){(r==null?void 0:r.writeLayerSchema)&&xc(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}get parsedUrl(){const e=this.url?xn(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=Nu(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Nu(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){IK(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const s=KBe(r,t,i)||void 0;return s||lre.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),s}if(t.defaultSymbol)return t.types&&t.types.length?new HY({defaultSymbol:Y6(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(s=>({id:s.id,symbol:Y6(s.symbol,s,i)}))}):new jY({symbol:Y6(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(cre(t)&&this._resetMemorySource(t),cre(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof it?new Sg({layer:this,items:e}):e:null}readSource(e,t){const i=Mk.fromJSON(t.featureSet);return new Sg({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(n=>tZ.fromJSON(n)),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?C8e(this.url,i):i;let n=i;if(!n&&this.url){const o=K2(this.url);_(o)&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),YY(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(n=>(n=i_e.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}set url(e){const t=M8e({layer:this,url:e,nonStandardUrlAllowed:!0,logger:lre});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){O8e(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new q(Qs,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,i){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new q(Qs,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)})}async applyEdits(e,t){const i=await import("./editingSupport.04e592cb.js");return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return tGe(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await wAe(import("./FeatureLayerSource.b83bfaae.js"),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new Kd,t=this.get("capabilities.data"),i=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"];const r=_(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,s=i8e(this.definitionExpression,r);e.where=s||"1=1";const{timeOffset:n,timeExtent:o}=this;return e.timeExtent=n!=null&&o!=null?o.offset(-n.value,n.unit):o||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new q(Qs,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new q(Qs,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=i7.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new q(Qs,"this layer doesn't support attachments");const{attachmentTypes:i,objectIds:r,globalIds:s,num:n,size:o,start:a,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const c=r&&r.length>1,h=i&&i.length,p=s&&s.length,f=o&&o.length;if(c||h||p||f||n||a||l)throw new q(Qs,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||l))throw new q(Qs,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new q(Qs,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(Kd.from(e)||this.createQuery(),t)).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(Kd.from(e)||this.createQuery(),t);throw new q(Qs,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(Kd.from(e)||this.createQuery(),t);throw new q(Qs,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(Kd.from(e)||this.createQuery(),t);throw new q(Qs,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(A7.from(e),t);throw new q(Qs,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(A7.from(e),t);throw new q(Qs,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(EI.from(e),t).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i});throw new q(Qs,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(EI.from(e),t);throw new q(Qs,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(EI.from(e),t);throw new q(Qs,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(EI.from(e),t);throw new q(Qs,"Layer source does not support queryFeatureCount capability")})}read(e,t){const i=e.featureCollection;if(i){const r=i.layers;r&&r.length===1&&(super.read(r[0],t),i.showLegend!=null&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var n;t=me(F({},t),{writeLayerSchema:(n=t==null?void 0:t.writeLayerSchema)!=null?n:this._hasMemorySource()});const{origin:i,layerContainerType:r,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push(BI(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&r!=="tables")return s==null||s.push(BI(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(BI(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&r==="tables")return s==null||s.push(BI(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new q(Qs,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||Q9e(this,e))}async save(e){return(await import("./featureLayerUtils.72e49e0d.js")).save(this,e)}async saveAs(e,t){return(await import("./featureLayerUtils.72e49e0d.js")).saveAs(this,e,t)}_readEditingEnabled(e,t,i){var s;let r=(s=e.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=e.capabilities,t&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,i,r){var s,n;if(!e){const o=((n=(s=this.capabilities)==null?void 0:s.operations)==null?void 0:n.supportsSync)?"Query,Sync":"Query";xc("layerDefinition.capabilities",o,t),i&&!(r==null?void 0:r.writeLayerSchema)&&(t.capabilities=o)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new q(Qs,`feature is missing the identifying attribute ${i}`)):Promise.reject(new q(Qs,"'attributes' are required on a feature to query attachments")):Promise.reject(new q(Qs,"A feature is required to add/delete/update attachments")):Promise.reject(new q(Qs,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return gr(this.url,{query:me(F({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t=>{const i=t.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),IK(this.renderer,this.fieldsIndex),Hde(this.timeInfo,this.fieldsIndex),J9e(this,{origin:"service"})}async hasDataChanged(){var e,t;if((e=this.source)==null?void 0:e.refresh)try{const{dataChanged:i,updates:r}=await((t=this.source)==null?void 0:t.refresh());if(_(r)&&(this.sourceJSON=F(F({},this.sourceJSON),r),this.read(r,{origin:"service",url:this.parsedUrl})),i)return!0}catch{}if(this.definitionExpression)try{return(await t8e(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){var t;const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((t=this.fields)==null?void 0:t.some(i=>i.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(i=>{const r=i.prototype&&i.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new q("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new q("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(e){return{supportsCacheHint:UC(e.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(e){const t=e.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:UC(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:Ft(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(r=>{const s=dGe[r.name];s&&(i[s]=!!r.isEnabled)}),i}_readDataCapabilities(e){return{isVersioned:Ft(e,"isDataVersioned",!1),supportsAttachment:Ft(e,"hasAttachments",!1),supportsM:Ft(e,"hasM",!1),supportsZ:Ft(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Ft(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map(p=>p.trim()):[],r=this.url?K2(this.url):null,s=i.includes(_(r)&&r.serverType==="MapServer"?"data":"query"),n=i.includes("editing")&&!t.datesInUnknownTimezone;let o=n&&i.includes("create"),a=n&&i.includes("delete"),l=n&&i.includes("update");const c=i.includes("changetracking"),h=t.advancedQueryCapabilities;return n&&!(o||a||l)&&(o=a=l=!0),{supportsCalculate:Ft(t,"supportsCalculate",!1),supportsTruncate:Ft(t,"supportsTruncate",!1),supportsValidateSql:Ft(t,"supportsValidateSql",!1),supportsAdd:o,supportsDelete:a,supportsEditing:n,supportsChangeTracking:c,supportsQuery:s,supportsQueryAnalytics:Ft(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:Ft(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Ft(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Ft(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:Ft(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var l;const t=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,r=e.archivingInfo,s=(l=this.url)==null?void 0:l.includes("MapServer"),n=!he("mapserver-pbf-enabled")&&s&&this.version<10.81,o=Gve(this.url),a=(e.supportedQueryFormats||"").split(",").reduce((c,h)=>{const p=h.toLowerCase().trim();return p&&c.add(p),c},new Set);return{supportsStatistics:Ft(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Ft(t,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Ft(t,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:pGe(t),supportsCentroid:Ft(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Ft(t,"supportsQueryWithDistance",!1),supportsDistinct:Ft(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Ft(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Ft(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ft(t,"supportsHavingClause",!1),supportsOrderBy:Ft(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Ft(t,"supportsPagination",!1),supportsQuantization:Ft(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ft(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Ft(e,"supportsReturningQueryGeometry",!1),supportsResultType:Ft(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Ft(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Ft(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ft(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Ft(t,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Ft(i,"allowOthersToQuery",!0),supportsHistoricMoment:Ft(r,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!n&&a.has("pbf"),supportsDisjointSpatialRelationship:Ft(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Ft(t,"supportsQueryWithCacheHint",!1)||UC(t,"query"),supportsDefaultSpatialReference:Ft(t,"supportsDefaultSR",!1),supportsCompactGeometry:o,maxRecordCountFactor:GI(e,"maxRecordCountFactor",void 0),maxRecordCount:GI(e,"maxRecordCount",void 0),standardMaxRecordCount:GI(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:GI(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=Ft(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ft(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:UC(t,"queryRelated")}}_readQueryTopFeaturesCapabilities(e){return{supportsCacheHint:UC(e.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Ft(e,"allowGeometryUpdates",!0),supportsGlobalId:Ft(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Ft(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Ft(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ft(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ft(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ft(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ft(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ft(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ft(t,"allowOthersToUpdate",!0)}}};u([d({readOnly:!0,json:{read:!1}})],$e.prototype,"capabilities",void 0),u([Ue("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],$e.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],$e.prototype,"charts",void 0),u([d({readOnly:!0})],$e.prototype,"createQueryVersion",null),u([d({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],$e.prototype,"copyright",void 0),u([d({type:Boolean})],$e.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],$e.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],$e.prototype,"definitionExpression",void 0),u([d({types:nw,readOnly:!0})],$e.prototype,"defaultSymbol",void 0),u([d({type:qd})],$e.prototype,"dynamicDataSource",void 0),u([d({readOnly:!0})],$e.prototype,"editFieldsInfo",void 0),u([d({type:Boolean})],$e.prototype,"editingEnabled",null),u([Ue(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],$e.prototype,"readEditingEnabled",null),u([Ue("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],$e.prototype,"readEditingEnabledFromWebMap",null),u([Be(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],$e.prototype,"writeEditingEnabled",null),u([Be("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],$e.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],$e.prototype,"editingInfo",void 0),u([Ue("editingInfo")],$e.prototype,"readEditingInfo",null),u([d((()=>{const e=ie(W8e),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],$e.prototype,"elevationInfo",void 0),u([d(V9e)],$e.prototype,"featureReduction",void 0),u([d(me(F({},W6.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:X6}}}}}))],$e.prototype,"fields",void 0),u([d(W6.fieldsIndex)],$e.prototype,"fieldsIndex",void 0),u([d({type:Y9e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],$e.prototype,"floorInfo",void 0),u([d({type:f8e,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],$e.prototype,"formTemplate",void 0),u([d({type:ui,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],$e.prototype,"fullExtent",void 0),u([d()],$e.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:q9e,json:{read:{source:"geometryProperties"}}})],$e.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:q6.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:X6,writer(e,t,i){const r=e?q6.toJSON(e):null;r&&xc(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:q6.read}}})],$e.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],$e.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],$e.prototype,"hasZ",void 0),u([d({readOnly:!0,type:O_})],$e.prototype,"heightModelInfo",void 0),u([d({type:Date})],$e.prototype,"historicMoment",void 0),u([d(Y8e)],$e.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],$e.prototype,"infoFor3D",void 0),u([d({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],$e.prototype,"isTable",void 0),u([Ue("service","isTable",["type","geometryType"]),Ue("isTable",["layerDefinition.type","layerDefinition.geometryType"])],$e.prototype,"readIsTable",null),u([Be("web-map","isTable")],$e.prototype,"writeIsTable",null),u([d(QY)],$e.prototype,"labelsVisible",void 0),u([d({type:[kk],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:sre},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:sre},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],$e.prototype,"labelingInfo",void 0),u([d((()=>{const e=ie(X8e);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,i,r){xc(r,FP(t),i)}}},e})())],$e.prototype,"opacity",void 0),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],$e.prototype,"layerId",void 0),u([d(q8e)],$e.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const e=ie(jve.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],$e.prototype,"listMode",void 0),u([d(Z8e)],$e.prototype,"minScale",void 0),u([Ue("service","minScale",["minScale","effectiveMinScale"])],$e.prototype,"readMinScale",null),u([d(Q8e)],$e.prototype,"maxScale",void 0),u([Ue("service","maxScale",["maxScale","effectiveMaxScale"])],$e.prototype,"readMaxScale",null),u([d({type:String})],$e.prototype,"globalIdField",void 0),u([Ue("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Ue("service","globalIdField",["globalIdField","fields"])],$e.prototype,"readGlobalIdFieldFromService",null),u([d({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:X6}}}}})],$e.prototype,"objectIdField",void 0),u([Ue("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Ue("service","objectIdField",["objectIdField","fields"])],$e.prototype,"readObjectIdFieldFromService",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],$e.prototype,"operationalLayerType",void 0),u([d(W6.outFields)],$e.prototype,"outFields",void 0),u([d({readOnly:!0})],$e.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],$e.prototype,"path",void 0),u([d(ZY)],$e.prototype,"popupEnabled",void 0),u([d({type:NP,json:{name:"popupInfo",write:!0}})],$e.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],$e.prototype,"defaultPopupTemplate",null),u([d({type:[Z9e],readOnly:!0})],$e.prototype,"relationships",void 0),u([d({types:Nk,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:QBe,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],$e.prototype,"renderer",null),u([Ue("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Ue("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],$e.prototype,"readRenderer",null),u([d()],$e.prototype,"sourceJSON",void 0),u([d({type:Boolean})],$e.prototype,"returnM",void 0),u([d({type:Boolean})],$e.prototype,"returnZ",void 0),u([d((()=>{const e=ie(j8e);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],$e.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],$e.prototype,"source",null),u([Rt("source")],$e.prototype,"castSource",null),u([Ue("portal-item","source",["featureSet"]),Ue("web-map","source",["featureSet"])],$e.prototype,"readSource",null),u([d({readOnly:!0})],$e.prototype,"serviceDefinitionExpression",void 0),u([Ue("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],$e.prototype,"readServiceDefinitionExpression",null),u([d({type:Ze,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],$e.prototype,"spatialReference",void 0),u([d({type:Number})],$e.prototype,"subtypeCode",void 0),u([d({type:String,json:{origins:{service:{read:!0}}}})],$e.prototype,"subtypeField",void 0),u([d({type:[tZ]})],$e.prototype,"templates",void 0),u([Ue("templates",["editFieldsInfo","creatorField","editorField","templates"])],$e.prototype,"readTemplates",null),u([d({type:Yve})],$e.prototype,"timeInfo",void 0),u([d()],$e.prototype,"title",void 0),u([Ue("service","title",["name"]),Ue("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],$e.prototype,"readTitle",null),u([Ue("web-map","title",["layerDefinition.name","title"])],$e.prototype,"readTitleFromWebMap",null),u([d({type:String})],$e.prototype,"sublayerTitleMode",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],$e.prototype,"trackIdField",void 0),u([d({json:{read:!1}})],$e.prototype,"type",void 0),u([d({type:String})],$e.prototype,"typeIdField",void 0),u([Ue("service","typeIdField"),Ue("typeIdField",["layerDefinition.typeIdField"])],$e.prototype,"readTypeIdField",null),u([d({type:[i_e]})],$e.prototype,"types",void 0),u([Ue("service","types",["types"]),Ue("types",["layerDefinition.types"])],$e.prototype,"readTypes",null),u([d({readOnly:!0,json:{write:!1}})],$e.prototype,"serverGens",void 0),u([d({type:it.ofType(Eg),readOnly:!0})],$e.prototype,"indexes",void 0),u([d(H8e)],$e.prototype,"url",null),u([Be("url")],$e.prototype,"writeUrl",null),u([d({readOnly:!0})],$e.prototype,"userIsAdmin",void 0),u([d({json:{origins:{service:{read:!0}},read:!1}})],$e.prototype,"version",void 0),u([Ue("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],$e.prototype,"readVersion",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],$e.prototype,"visible",void 0),u([Ue("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],$e.prototype,"readVisible",null),$e=u([P("esri.layers.FeatureLayer")],$e);const Y6=GE({types:wfe}),s_e=$e;var gSt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:s_e});const fGe=["$datastore","$map","$layer","$aggregatedfeatures"],mGe="esri.widgets.Feature.support.arcadeFeatureUtils",gGe=ge.getLogger(mGe);function yGe(e){return typeof e=="string"?HP(nY(e)):Array.isArray(e)?vGe(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?_Ge(e):e}function vGe(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?HP(nY(t)):t}</li>`).join("")}</ul>`}function _Ge(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?HP(nY(i)):i}</td></tr>`}).join("")}</table>`}function bGe({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h={map:n,spatialReference:s.sr,interceptor:a};if(c==="$map"&&(r.vars[c]=t.convertMapToFeatureSetCollection(h)),c==="$layer"&&(r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),c==="$datastore"&&(r.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:f,objectIdField:m,geometryType:y,spatialReference:v,displayField:w}=p,b=new s_e(me(F({fields:f,objectIdField:m,geometryType:y,spatialReference:v,displayField:w},p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null),{source:e}));r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:b,spatialReference:s.sr,interceptor:a})}})}function n_e(){return import("./arcadeUtils.ce23ba53.js").then(function(e){return e.t})}async function wGe({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function o_e({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=fGe.filter(m=>t.hasVariable(a,m)),[c]=await Promise.all([wGe({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:r}),p=t.createExecContext(n,h);p.interceptor=i,p.useAsync=!0,bGe({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:i});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(m=>gGe.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:e}))}async function xGe({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const o=await n_e(),a={};for(const h of e)a[`expression/${h.name}`]=o_e({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const l=await Sn(a),c={};for(const h in l)c[h]=yGe(l[h].value);return c}const TGe=1;let Yc=class extends hx(Se){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var r,s;const t=(r=this.contentElement)==null?void 0:r.type;(s=this.contentElementViewModel)==null||s.destroy();const i=t==="fields"?new vk:t==="media"?new Hb:t==="text"?new i4:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=JX(this._compile,TGe,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&i&&s&&n))return void this._set("contentElement",null);const l=await n_e();if(a!==this._abortController)return;const c=await o_e({arcadeUtils:l,expressionInfo:t,graphic:i,interceptor:r,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await NY(c,a.signal),p=h==null?void 0:h.type,f=p==="media"?aR.fromJSON(h):p==="text"?L2.fromJSON(h):p==="fields"?D2.fromJSON(h):null;this._set("contentElement",f)},this.handles.add([se(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),At),se(()=>[this.contentElement],()=>this._createVM(),At)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};u([d()],Yc.prototype,"_abortController",void 0),u([d({type:Kde})],Yc.prototype,"expressionInfo",void 0),u([d({type:Ga})],Yc.prototype,"graphic",void 0),u([d({readOnly:!0})],Yc.prototype,"contentElement",void 0),u([d({readOnly:!0})],Yc.prototype,"contentElementViewModel",void 0),u([d()],Yc.prototype,"interceptor",void 0),u([d()],Yc.prototype,"spatialReference",null),u([d({readOnly:!0})],Yc.prototype,"state",null),u([d()],Yc.prototype,"map",null),u([d()],Yc.prototype,"view",void 0),Yc=u([P("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Yc);const iZ=Yc,jI={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let QL=class extends Xs{constructor(e,t){super(e,t),this.viewModel=new iZ}initialize(){this.own(se(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),At))}destroy(){this._destroyContentWidget()}renderLoading(){return W("div",{key:"loading-container",class:jI.loadingSpinnerContainer},W("span",{class:this.classes(jI.iconLoading,jI.spinner)}))}render(){var t;const{state:e}=this.viewModel;return W("div",{class:jI.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const r=e?i==="fields"?new Cye({viewModel:e}):i==="media"?new o0e({viewModel:e}):i==="text"?new OL({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};u([d({type:iZ})],QL.prototype,"viewModel",void 0),QL=u([P("esri.widgets.Feature.FeatureExpression")],QL);const SGe=QL;class EGe{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}}var JL;const CGe=1,ure="content-view-models",a_e="esri.widgets.FeatureViewModel",AGe=ge.getLogger(a_e),hre={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let bs=JL=class extends Se{constructor(e){super(e),this._handles=new jt,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=JX(this._graphicChanged,CGe,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=F({},hre),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&i.attachmentsContent||t.type==="custom"&&i.customContent||t.type==="fields"&&i.fieldsContent||t.type==="media"&&i.mediaContent||t.type==="text"&&i.textContent||t.type==="expression"&&i.expressionContent},this._handles.add(se(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this.graphicChangedThrottled(),At))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return _(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return $4e(nte(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return dye(this.graphic)}castAbilities(e){return F(F({},hre),e)}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof Hb&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Hb&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Hb&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){Qr(i)||(this._error=i,AGe.error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)):typeof e=="string"?this._compileText(new L2({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(ure),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:i}=this,{contentElement:r,contentElementViewModel:s}=e,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new iZ({expressionInfo:i,graphic:r,interceptor:JL.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(se(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),At),ure),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new aY(F({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new i4({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:Gb({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e}),description:Gb({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:t})}}_createFieldsVMParams(e,t){var c;const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s=F(F({},r.global),r.content[t]),n=(c=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>fye(h)||Ug(h)||s.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=e;return F({attributes:s,expressionInfos:o,fieldInfos:n},this._compileTitleAndDesc({title:l,description:a}))}_compileFields(e,t){const i=e.clone(),r=new vk(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:h}=r,{description:p,mediaInfos:f,title:m}=e;return F({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,layer:l,fieldInfoMap:s,formattedAttributes:F(F({},n.global),n.content[t]),expressionAttributes:c,mediaInfos:f,popupTemplate:o,relatedInfos:a},this._compileTitleAndDesc({title:m,description:p}))}_compileMedia(e,t){const i=e.clone(),r=new Hb(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=Gb({attributes:n,fieldInfoMap:i,globalAttributes:o,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new i4(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t==null?void 0:t.editFieldsInfo;return r&&s?I4e(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r,o=this.formattedAttributes.global;return Gb({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.title;return e4(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.content;return e4(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:c}}=await Sn({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await N4e({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:h}}=await Sn({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:xGe({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:r,map:o,interceptor:JL.interceptor,view:a})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes=F(F({},r.attributes),h),this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=u6({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:F(F({},l),e.attributes),layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[t]=u6({fieldInfos:e.fieldInfos,graphic:r,attributes:F(F({},a),e.attributes),layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:u6({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,nte(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=_(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const o=t.filter(c=>c&&Ug(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await QUe({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const h=r.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await JUe({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;qUe((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=R7(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||HUe(s,t);o&&(KUe({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};bs.interceptor=new EGe(U4e,z4e),u([d()],bs.prototype,"_error",void 0),u([d()],bs.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],bs.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],bs.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],bs.prototype,"_sourceLayer",null),u([d()],bs.prototype,"abilities",void 0),u([Rt("abilities")],bs.prototype,"castAbilities",null),u([d({readOnly:!0})],bs.prototype,"content",void 0),u([d({readOnly:!0})],bs.prototype,"contentViewModels",void 0),u([d({type:Boolean})],bs.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],bs.prototype,"state",null),u([d({readOnly:!0})],bs.prototype,"formattedAttributes",void 0),u([d({type:Ga,value:null})],bs.prototype,"graphic",null),u([d({readOnly:!0})],bs.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],bs.prototype,"relatedInfos",void 0),u([d()],bs.prototype,"spatialReference",null),u([d({readOnly:!0})],bs.prototype,"title",void 0),u([d()],bs.prototype,"map",null),u([d({readOnly:!0})],bs.prototype,"waitingForContent",null),u([d()],bs.prototype,"view",void 0),bs=JL=u([P(a_e)],bs);const rZ=bs,l_e=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>r4(i)&&!i.destroyed?W("div",{key:i},i.render()):i instanceof HTMLElement?W("div",{key:i,bind:i,afterCreate:this._attachToNode}):Eye(i)?W("div",{key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return t=u([P("esri.widgets.Feature.ContentMixin")],t),t},qo={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},dre={title:!0,content:!0,lastEditedInfo:!0};let Jo=class extends l_e(Xs){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements=F({},dre),this.map=null,this.view=null,this.viewModel=new rZ}initialize(){this.own(se(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),At))}loadDependencies(){return import("./calcite-notice.c4841067.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return F(F({},dre),e)}render(){const{state:e}=this.viewModel,t=W("div",{class:qo.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return W("div",{class:this.classes(qo.base,qo.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return W("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?W("div",{key:"error-title",slot:"title"},e.errorMessage):null,W("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return W("div",{key:"loading-container",class:qo.loadingSpinnerContainer},W("span",{class:this.classes(qo.iconLoading,qo.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?W("div",{class:qo.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?W(qP,{level:this.headingLevel,class:qo.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?W("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:W("div",{key:`${t}-content`},i.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?W("div",{key:this._buildKey("attachments-element",e),class:this.classes(qo.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:W("div",{key:this._buildKey("expression-element",e),class:qo.contentElement},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?W("div",{key:this._buildKey("custom-element",t),class:qo.contentElement},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:W("div",{key:this._buildKey("fields-element",e),class:qo.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:W("div",{key:this._buildKey("media-element",e),class:qo.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=Af(n,{date:r,user:s});return W("div",{key:"edit-info-element",class:this.classes(qo.lastEditedInfo,qo.contentElement)},o)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?W("div",{key:this._buildKey("text-element",t),class:this.classes(qo.contentElement,qo.text)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{s.type==="attachments"&&(this._contentWidgets[n]=new Z4e({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new Cye({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new o0e({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new OL({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new OL({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new SGe({viewModel:r[n]}))},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new OL({viewModel:s}))}this.scheduleRender()}};u([qe("viewModel.graphic")],Jo.prototype,"graphic",void 0),u([qe("viewModel.defaultPopupTemplateEnabled")],Jo.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Jo.prototype,"headingLevel",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Jo.prototype,"label",void 0),u([d(),js("esri/widgets/Feature/t9n/Feature")],Jo.prototype,"messages",void 0),u([d(),js("esri/t9n/common")],Jo.prototype,"messagesCommon",void 0),u([d(),js("esri/widgets/support/t9n/uriUtils")],Jo.prototype,"messagesURIUtils",void 0),u([qe("viewModel.spatialReference")],Jo.prototype,"spatialReference",void 0),u([qe("viewModel.title")],Jo.prototype,"title",void 0),u([d()],Jo.prototype,"visibleElements",void 0),u([Rt("visibleElements")],Jo.prototype,"castVisibleElements",null),u([qe("viewModel.map")],Jo.prototype,"map",void 0),u([qe("viewModel.view")],Jo.prototype,"view",void 0),u([d({type:rZ})],Jo.prototype,"viewModel",void 0),Jo=u([P("esri.widgets.Feature")],Jo);const MGe=Jo;var c_e;const KL=Symbol("anchorHandles");let J1=class extends as.EventedAccessor{constructor(e){super(e),this[c_e]=new jt,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[KL].add([vo(()=>Qi(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),se(()=>this.screenLocation,(t,i)=>{_(t)&&_(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[KL]=lt(this[KL])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this;return i&&_(e)&&_(t)&&t.ready?t.toScreen(e):null}};c_e=KL,u([d()],J1.prototype,"location",void 0),u([d()],J1.prototype,"screenLocation",null),u([d()],J1.prototype,"screenLocationEnabled",void 0),u([d()],J1.prototype,"view",void 0),J1=u([P("esri.widgets.support.AnchorElementViewModel")],J1);const u_e=J1,OGe="esri.widgets.CompassViewModel";let eN=class extends u_e{constructor(e){super(e),this.visible=!1}};u([d()],eN.prototype,"visible",void 0),eN=u([P(OGe)],eN);const h_e=eN,Z6={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let K1=class extends Xs{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new h_e,this.visible=!1}initialize(){this.own([se(()=>this.visible,e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;const r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,n={[Z6.spinnerStart]:r,[Z6.spinnerFinish]:s},o=this._getPositionStyles();return W("div",{class:this.classes(Z6.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=S2(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(M(t)||M(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([qe("viewModel.location")],K1.prototype,"location",void 0),u([qe("viewModel.view")],K1.prototype,"view",void 0),u([d({type:h_e})],K1.prototype,"viewModel",void 0),u([qe("viewModel.visible")],K1.prototype,"visible",void 0),K1=u([P("esri.widgets.Spinner")],K1);const RGe=K1;var pre;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(pre||(pre={}));function PGe(e){return"r"in e&&"g"in e&&"b"in e}function d_e(e){return"h"in e&&"s"in e&&"v"in e}function p_e(e){return"l"in e&&"a"in e&&"b"in e}function f_e(e){return"l"in e&&"c"in e&&"h"in e}function IGe(e){return"x"in e&&"y"in e&&"z"in e}const $Ge=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],DGe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function m_e(e,t){const i=[];let r,s;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,o=e[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=e[r][s]*t[s];i.push(a)}return i}function g_e(e){const t=[e.r/255,e.g/255,e.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=m_e($Ge,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function sZ(e){const t=m_e(DGe,[e.x/100,e.y/100,e.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function y_e(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function v_e(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function LGe(e){const t=e.l,i=e.a,r=e.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}function NGe(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}function FGe(e){return y_e(g_e(e))}function kGe(e){return sZ(v_e(e))}function UGe(e){return LGe(y_e(g_e(e)))}function zGe(e){return sZ(v_e(NGe(e)))}function VGe(e){const t=e.r,i=e.g,r=e.b,s=Math.max(t,i,r),n=s-Math.min(t,i,r);let o=s,a=n===0?0:s===t?(i-r)/n%6:s===i?(r-t)/n+2:(t-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function BGe(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,s=r*i,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function nZ(e){return PGe(e)?e:f_e(e)?zGe(e):p_e(e)?kGe(e):IGe(e)?sZ(e):d_e(e)?BGe(e):e}function ySt(e){return d_e(e)?e:VGe(nZ(e))}function vSt(e){return p_e(e)?e:FGe(nZ(e))}function _St(e){return f_e(e)?e:UGe(nZ(e))}function __e(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function GGe(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function jGe(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function HGe(e,t){return new Float32Array(e,t,6)}function b_e(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function qGe(e,t,i,r=0,s=0,n=2){const o=s||t.length/n;for(let a=r;a<o;a++)b_e(e,t,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,create:__e,clone:GGe,fromValues:jGe,createView:HGe,transform:b_e,transformMany:qGe},Symbol.toStringTag,{value:"Module"}));function WGe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function XGe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function YGe(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e}function w_e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function ZGe(e){return e[0]*e[3]-e[1]*e[2]}function x_e(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],p=i[2],f=i[3],m=i[4],y=i[5];return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*p+n*f,e[3]=s*p+o*f,e[4]=r*m+n*y+a,e[5]=s*m+o*y+l,e}function oZ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function T_e(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function aZ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*h+a,e[5]=s*c+o*h+l,e}function QGe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function JGe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function lZ(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function KGe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function e7e(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function t7e(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function S_e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function i7e(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function r7e(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function s7e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function n7e(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],f=t[4],m=t[5];return Math.abs(i-l)<=Et*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=Et*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=Et*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=Et*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=Et*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=Et*Math.max(1,Math.abs(a),Math.abs(m))}const o7e=x_e,a7e=S_e;Object.freeze(Object.defineProperty({__proto__:null,copy:WGe,identity:XGe,set:YGe,invert:w_e,determinant:ZGe,multiply:x_e,rotate:oZ,scale:T_e,translate:aZ,fromRotation:QGe,fromScaling:JGe,fromTranslation:lZ,str:KGe,frob:e7e,add:t7e,subtract:S_e,multiplyScalar:i7e,multiplyScalarAndAdd:r7e,exactEquals:s7e,equals:n7e,mul:o7e,sub:a7e},Symbol.toStringTag,{value:"Module"}));const fre=he("android");he("chrome")||fre&&fre>=4;QG();function E_e(e){return e&&"opacity"in e?e.opacity*E_e(e.parent):1}async function l7e(e,t){var w;if(!e)return;const i=e.sourceLayer,r=(w=_(t)&&t.useSourceLayer?i:e.layer)!=null?w:i,s=E_e(r);if(_(e.symbol)&&(!_(t)||t.ignoreGraphicSymbol!==!0)){const b=e.symbol.type==="web-style"?await e.symbol.fetchSymbol(me(F({},t),{cache:_(t)?t.webStyleCache:null})):e.symbol.clone();return f6(b,null,s),b}const n=_(t)&&t.renderer||r&&"renderer"in r&&r.renderer;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol(me(F({},t),{cache:_(t)?t.webStyleCache:null})):o.clone(),!("visualVariables"in n)||!n.visualVariables||!n.visualVariables.length)return f6(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(M(t)||M(t.arcade))){const b=F({},t);b.arcade=await nm(),t=b}const a=await Promise.resolve().then(function(){return VY}),l=[],c=[],h=[],p=[];for(const b of n.visualVariables)switch(b.type){case"color":l.push(b);break;case"opacity":c.push(b);break;case"rotation":p.push(b);break;case"size":b.target||h.push(b)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,e,t):null,y=!!c.length&&c[c.length-1];let v=y?a.getOpacity(y,e,t):null;if(s!=null&&(v=v!=null?v*s:s),f6(o,m,v),h.length){const b=a.getAllSizes(h,e,t);await fke(o,b)}for(const b of p)mke(o,a.getRotationAngle(b,e,t),b.axis);return o}class dy{constructor(t,i){this.owner=i,this.properties={},this.afterDispatchHandle=null;for(const r in t){const s=t[r],n=new whe(s,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=$he(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const i=this.properties[t];for(const r of i.acquired)hK(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this.properties=null,this.owner=null}get(t){const i=this.owner._get(t),r=this.properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this.properties){const i=this.properties[t];let r=0;for(const s of i.acquired)hK(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}}const c7e=he("mac")?"Meta":"Ctrl",Uk={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)Uk[e]=String.fromCharCode(e);for(let e=1;e<25;e++)Uk[111+e]=`F${e}`;for(let e=65;e<91;e++)Uk[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function u7e(e){if(e.key!==void 0)return vl(e);const t=Uk[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function h7e(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class d7e{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}}const mre=ge.getLogger("esri.views.input.InputHandler");class Go{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?mre.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof t=="string"?new d7e(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new p7e(n,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new f7e(t,{onEmit:(r,s,n,o)=>{this._manager.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):mre.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const i=this._incoming[t.type];if(i){for(const r of i)if(r.match.matches(t)&&(r.callback(t),t.shouldStopPropagation()))break}}}class p7e{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class f7e{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class m7e extends Go{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse",i.data.x,i.data.y)})}_setValue(t,i,r){t===this._value&&this._x===i&&this._y===r||(this._value=t,this._x=i,this._y=r,this._onChange(t,i,r))}}const Q6=ge.getLogger("esri.views.input.InputManager");let U0=class extends Se{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=c7e,this.latestPointerType="mouse",this._propertiesPool=new dy({latestPointerLocation:y7e},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,i=Yv.INTERNAL){if(this._nameToGroup[e])return void Q6.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void Q6.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const n=r.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(r,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Q6.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const r=this._handlers[i];r.priorityIndex=i,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s){for(const n of r.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of r.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)h7e(o)||t.add(o)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const r=this._get("latestPointerLocation");if(M(r)||r.x!==t||r.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,i=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(r(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(r(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new m7e((e,t,i)=>this._setLatestPointer(e,t,i)),this.installHandlers("input-manager-logic",[this._latestPointerHandler],Yv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Yv.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=r!==void 0?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new g7e(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new EG,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(!(r!=null&&this._stoppedPropagationEventIds.has(r)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){r!=null&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new EG;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const r of t.handler.incomingEventMatches){if(i.eventType!==r.eventType)continue;const s=i.keyModifiers.filter(n=>r.keyModifiers.includes(n));if(s.length===i.keyModifiers.length!=(s.length===r.keyModifiers.length))return i.keyModifiers.length>r.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let r=0;for(;r<t.length&&this._compareHandlerPriority(i,t[r])>=0;)r++;t.splice(r,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],U0.prototype,"hasPendingInputs",null),u([d()],U0.prototype,"eventSource",void 0),u([d()],U0.prototype,"recognizers",void 0),u([d({readOnly:!0})],U0.prototype,"latestPointerType",void 0),u([d({readOnly:!0})],U0.prototype,"latestPointerLocation",void 0),U0=u([P("esri.views.input.InputManager")],U0);class g7e{constructor(t,i,r,s,n){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=av.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=av.STOPPED}shouldStopPropagation(){return(this._propagationState&av.STOPPED)!=0}async(t){this._propagationState|=av.PAUSED;const i=(r,s)=>{this._propagationState&=~av.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&av.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var av;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(av||(av={}));const Yv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class y7e{}function gre(e){return e&&typeof e.highlight=="function"}function v7e(e){return e&&typeof e.maskOccludee=="function"}function bSt(e,t,i){return M(e)||e>i&&(t===0||e<t)}function wSt(e,t){return e>0||t>0}function xSt(e){var i,r;const t=e.effectiveScaleRange;return{minScale:(i=t==null?void 0:t.minScale)!=null?i:0,maxScale:(r=t==null?void 0:t.maxScale)!=null?r:0}}const zk={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},Wb=new HE({id:"zoom-to-feature",title:"{messages.zoom}",className:zk.iconZoom}),yre=new HE({id:"remove-selected-feature",title:"{messages.remove}",className:zk.iconTrash}),MS=new HE({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:zk.iconZoom}),OS=new HE({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:zk.iconBrowseClusteredFeatures}),_7e="esri.widgets.Popup.PopupViewModel",f4=ge.getLogger(_7e),b7e=e=>{const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new q("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new q("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new q("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new q("trigger-action:invalid-action","Action is disabled"));if(o===Wb.id)return x7e(s.viewModel).catch(L8);if(o===MS.id)return T7e(s.viewModel);if(o===OS.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===yre.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new q(`trigger-action:${yre.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function C_e(e){const{selectedFeature:t,location:i,view:r}=e;return r?r.type==="3d"?t||i:e.get("selectedFeature.geometry")||i:null}function Mb(e){var t,i;return(e==null?void 0:e.isAggregate)&&((i=(t=e==null?void 0:e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:i.type)==="cluster"}function w7e(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then(s=>{r=!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}).catch(()=>{const s=new q("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});f4.error(s)}),r}return!0}async function x7e(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=C_e(e);if(!n){const c=new q("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw f4.error(c),c}const o=r.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&a.type==="point"&&w7e(i,r);Wb.active=!0,Wb.disabled=!0;try{await e.view.goTo({target:n,scale:l?o:void 0})}finally{Wb.active=!1,Wb.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}async function T7e(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const a=new q("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw f4.error(a),a}if(!Mb(t)){const a=new q("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw f4.error(a),a}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],MS.active=!0,MS.disabled=!0;const{extent:o}=await s.queryExtent(n);await i.goTo({target:o}),MS.active=!1,MS.disabled=!1}async function S7e(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}async function E7e(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],OS.active=!0,OS.disabled=!0;const{features:o}=await s.queryFeatures(n);OS.active=!1,OS.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}function C7e(e){const t=e.features.filter(i=>Mb(i));t.length&&(e.features=t)}const cZ=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([d()],t.prototype,"goToOverride",void 0),u([d()],t.prototype,"view",void 0),t=u([P("esri.widgets.support.GoTo")],t),t},SO=it.ofType({key:"type",defaultKeyValue:"button",base:B5,typeMap:{button:HE,toggle:fpe}}),A7e=()=>[Wb.clone()],M7e=()=>[MS.clone(),OS.clone()],A_e="esri.widgets.Popup.PopupViewModel",HI=ge.getLogger(A_e);let Ei=class extends cZ(u_e){constructor(e){super(e),this._handles=new jt,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new SO,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Ga({symbol:new A_({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([se(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),se(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),se(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),se(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),se(()=>this.location,e=>this._locationChange(e)),se(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),se(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),se(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),se(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>b7e({event:e,view:this.view})),vo(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Ki),se(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),se(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),vo(()=>!this.visible,()=>this.browseClusterEnabled=!1),se(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new SO;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){const e=this._get("defaultActions")||new SO;return e.removeAll(),e.addMany(Mb(this.selectedFeature)?M7e():A7e()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=qg(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const i=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=C_e(this);if(!t){const i=new q("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return HI.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const r=new q("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return HI.error(r),Promise.reject(r)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t=me(F({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of r)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){C7e(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?Mb(t)?(await S7e(this),await E7e(this)):HI.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):HI.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(Wb.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Mb(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Mb(e)?void 0:(e.symbol=await l7e(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=r.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:i,promisesPerLayerView:r}=t,s=Promise.resolve(i),n=r.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(Mb(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(r.some((h,p)=>(h&&h.graphic===n&&(a=h,r.splice(p,1)),!!a)),a)s[o]=a;else{const h=new rZ({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),r.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const r=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},Yv.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(c=>c.promise)];return r.popup.open({location:a||i,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return M(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:t}_getHighlightTarget(e,t){const i=t.type==="imagery"?void 0:"objectIdField"in t&&t.objectIdField,r=e.attributes;return r&&i&&r[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&t&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof TR))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&gre(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof TR))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&gre(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(r=>!t.includes(r));this.features=t.concat(i)}};u([d()],Ei.prototype,"featurePage",void 0),u([d()],Ei.prototype,"isLoadingFeature",null),u([d({type:SO})],Ei.prototype,"actions",void 0),u([d({readOnly:!0})],Ei.prototype,"active",null),u([d()],Ei.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Ei.prototype,"allActions",null),u([d({type:Boolean})],Ei.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Ei.prototype,"autoCloseEnabled",void 0),u([d()],Ei.prototype,"autoOpenEnabled",void 0),u([d()],Ei.prototype,"browseClusterEnabled",void 0),u([d()],Ei.prototype,"content",void 0),u([d({type:SO,readOnly:!0})],Ei.prototype,"defaultActions",null),u([d({readOnly:!0})],Ei.prototype,"featureCount",null),u([d()],Ei.prototype,"features",null),u([d()],Ei.prototype,"featuresPerPage",void 0),u([d()],Ei.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Ei.prototype,"featureViewModels",void 0),u([d()],Ei.prototype,"highlightEnabled",void 0),u([d()],Ei.prototype,"includeDefaultActions",void 0),u([d({type:at})],Ei.prototype,"location",null),u([d({readOnly:!0})],Ei.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Ei.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Ei.prototype,"waitingForResult",null),u([d({readOnly:!0})],Ei.prototype,"promiseCount",null),u([d()],Ei.prototype,"promises",null),u([d({value:null,readOnly:!0})],Ei.prototype,"selectedFeature",null),u([d({value:-1})],Ei.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Ei.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Ei.prototype,"state",null),u([d()],Ei.prototype,"title",void 0),u([d()],Ei.prototype,"updateLocationEnabled",void 0),u([d()],Ei.prototype,"view",void 0),u([d()],Ei.prototype,"visible",void 0),u([d()],Ei.prototype,"zoomFactor",void 0),u([d()],Ei.prototype,"zoomToLocation",void 0),u([d()],Ei.prototype,"centerAtLocation",null),Ei=u([P(A_e)],Ei);const M_e=Ei,vre="selected-index",O7e=0,_re="popup-spinner",Ie={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},bre={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},wre="esri-popup";function Nm(e,t){return t===void 0?`${wre}__${e}`:`${wre}__${e}-${t}`}const O_e="esri.widgets.Popup",xre=ge.getLogger(O_e),Tre={closeButton:!0,featureNavigation:!0};let Tt=class extends l_e(Xs){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new jt,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([i])=>{(i==null?void 0:i.isIntersecting)&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=JX(()=>this._displaySpinner(),O7e),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new M_e,this.visible=null,this.visibleElements=F({},Tre),this._addSelectedFeatureIndexHandle(),this.own([se(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),se(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),se(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,r)=>{!!i!=!!r&&this.reposition()}),se(()=>{var i,r,s,n,o,a;return[(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),se(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),se(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.size},(i,r)=>this._updateDockEnabledForViewSize(i,r)),se(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,r)=>this._viewChange(i,r)),se(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.ready},(i,r)=>this._viewReadyChange(i,r)),se(()=>{var i,r;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(r=this.viewModel)==null?void 0:r.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),se(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),se(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),vo(()=>!this.collapsed,()=>{var i,r;((r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),En(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),se(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),At),se(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,r,s,n,o;return!!(this.selectedFeatureWidget?((t=(e=this.selectedFeatureWidget)==null?void 0:e.viewModel)==null?void 0:t.waitingForContent)||((r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.state)==="error"||((n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.content):(o=this.viewModel)==null?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||bre}set dockOptions(e){const t=F({},bre),i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s=F(F({},t),e),n=F(F({},t.breakpoint),r),{breakpoint:o}=s;o===!0?s.breakpoint=n:typeof o=="object"&&(s.breakpoint=F(F({},n),o)),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s=me(F({},t),{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new MGe({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return F(F({},Tre),e)}blur(){const{active:e}=this.viewModel;e||xre.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||xre.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(vre);const t=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var y,v,w,b;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:i,dividedActions:r,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=r,l=o&&a.length>1&&e,c=o&&t,h=o&&!t,p=(v=(y=this.selectedFeature)==null?void 0:y.layer)==null?void 0:v.title,f=(b=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:b.id,m={[Ie.alignTopCenter]:s==="top-center",[Ie.alignBottomCenter]:s==="bottom-center",[Ie.alignTopLeft]:s==="top-left",[Ie.alignBottomLeft]:s==="bottom-left",[Ie.alignTopRight]:s==="top-right",[Ie.alignBottomRight]:s==="bottom-right",[Ie.isDocked]:c,[Ie.shadow]:h,[Ie.isDockedTopLeft]:n==="top-left",[Ie.isDockedTopCenter]:n==="top-center",[Ie.isDockedTopRight]:n==="top-right",[Ie.isDockedBottomLeft]:n==="bottom-left",[Ie.isDockedBottomCenter]:n==="bottom-center",[Ie.isDockedBottomRight]:n==="bottom-right",[Ie.isFeatureMenuOpen]:i,[Ie.isActionsMenuOpen]:l};return W("div",{class:this.classes(Ie.base,m),role:"presentation","data-layer-title":p,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return W("span",{"aria-hidden":"true",class:this.classes(Ie.icon,Ie.iconLoading,Ie.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?W("div",{key:Nm("loading-container"),role:"presentation",class:Ie.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Hf(this.container),t={[Ie.iconRightTriangleArrow]:e,[Ie.paginationPreviousIconRTL]:e,[Ie.iconLeftTriangleArrow]:!e,[Ie.paginationPreviousIconLTR]:!e};return W("span",{"aria-hidden":"true",class:this.classes(Ie.icon,t)})}renderPreviousButton(){const{messages:e}=this;return W("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ie.button,Ie.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Hf(this.container),t={[Ie.iconLeftTriangleArrow]:e,[Ie.paginationNextIconRTL]:e,[Ie.iconRightTriangleArrow]:!e,[Ie.paginationNextIconLTR]:!e};return W("span",{"aria-hidden":"true",class:this.classes(Ie.icon,t)})}renderNextButton(){const{messages:e}=this;return W("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ie.button,Ie.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return W("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ie.button,Ie.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[Ie.iconUndock]:e,[Ie.iconDock]:!e,[Ie.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[Ie.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[Ie.iconDockToTop]:!e&&t==="top-center",[Ie.iconDockToBottom]:!e&&t==="bottom-center"};return W("span",{"aria-hidden":"true",class:this.classes(i,Ie.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,i=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,r=e?t.undock:t.dock;return i!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?W("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ie.button,Ie.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[Ie.headerContainerButton]:i},o=W(qP,{level:this.headingLevel,class:Ie.headerTitle,innerHTML:e}),a=i?W("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ie.headerContainer,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):W("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ie.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return W("span",{"aria-hidden":"true",class:this.classes(Ie.icon,Ie.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?W("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ie.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return W("header",{class:Ie.header},this.renderTitle(),W("div",{class:Ie.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?W("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:Ie.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?W("div",{key:Nm("actions-menu-button"),class:this.classes(Ie.button,Ie.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},W("span",{"aria-hidden":"true",class:Ie.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?W("ul",{id:e,role:"menu","aria-labelledby":t,key:Nm("actions"),class:Ie.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?W("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:Ie.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?W("section",{key:Nm("navigation"),class:this.classes(Ie.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,o={[Ie.footerHasPagination]:e,[Ie.footerHasActions]:s,[Ie.footerHasActionsMenu]:n};return e||s?W("div",{key:Nm("feature-buttons"),class:this.classes(Ie.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=Af(e.selectedFeatures,{total:t.length});return W("section",{key:Nm("menu"),class:Ie.featureMenu},W("strong",{class:Ie.featureMenuHeader},r),W("nav",{bind:this,class:Ie.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:Bb},this.renderFeatureMenu(),W("div",{class:Ie.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?W("div",{class:Ie.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:W("div",{key:Nm("pointer"),class:Ie.pointer,role:"presentation"},W("div",{class:this.classes(Ie.pointerDirection,Ie.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",f={[Ie.shadow]:e,[Ie.isCollapsible]:n,[Ie.isCollapsed]:a};return W("div",{class:this.classes(Ie.main,Ie.widget,f),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?W("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return W("span",{key:"text",class:Ie.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[Ie.iconLoading]:e.active,[Ie.rotating]:e.active,[Ie.icon]:!!t,[Ie.actionImage]:!e.active&&!!i};return t&&(r[t]=!e.active),W("span",{key:"icon","aria-hidden":"true",class:this.classes(Ie.icon,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={[Ie.action]:t.type!=="toggle",[Ie.actionToggle]:t.type==="toggle",[Ie.actionToggleOn]:t.type==="toggle"&&t.value,[Ie.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],o=i==="menu-item"?W("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(Ie.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):W("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(Ie.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[Ie.featureMenuSelected]:o},l=o?W("span",{key:Nm(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:Ie.iconCheckMark}):null,c=W("span",{innerHTML:e.title||r.untitled});return W("li",{role:"menuitem",tabIndex:-1,key:Nm(`feature-menu-feature-${s}`),class:this.classes(a,Ie.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},W("span",{class:Ie.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?W("ol",{class:Ie.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(i=>!!i.graphic).map((i,r)=>this.renderFeatureMenuItem(i,r))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i==null?void 0:i.attributes,o=s==="zoom-to-feature"?Af(e.title,{messages:t}):s==="remove-selected-feature"?Af(e.title,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?Af(e.title,{messages:t}):e.title;return o&&n?Af(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:Ie.iconDefaultAction;return n&&i?Af(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{image:r}=e;return r&&i?Af(r,i):r}_createFeatureUpdatedAnimation(){return kNe("enter",Ie.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(i=>{this._handles.add(se(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),i=this._getInlineActionCount(),r=i===null,s=i===0;return{inlineActions:r?t.slice(0):s?new it:t.slice(0,i),menuActions:r?new it:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,r;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?t.errorMessage:((r=e.viewModel)==null?void 0:r.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){vl(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){vl(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=vl(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=vl(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===r);if(!i)return;const o=i.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=vl(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await hR(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=se(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,i)=>this._selectedFeatureIndexUpdated(t,i));this._handles.add(e,vre)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-t<o.top||s==="bottom"&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(M(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(T){return parseInt(T.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=i.getBoundingClientRect(),m=f+t,y=Math.max(p,c,h)+t,v=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"right",view:o}),w=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"left",view:o}),b=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"top",view:o}),S=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"bottom",view:o});return w?b?"bottom-right":"top-right":v?b?"bottom-left":"top-left":b?S?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return Hf(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,i=Hf(this.container)?"top-left":"top-right";if(!t)return i;const r=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-r.left-r.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=r/2,a=i.height-t,l=i.width-e,{padding:c}=this.view;return s==="bottom-center"?{top:t+n-c.top,left:e-o-c.left}:s==="top-left"?{bottom:a+n-c.bottom,right:l+n-c.right}:s==="bottom-left"?{top:t+n-c.top,right:l+n-c.right}:s==="top-right"?{bottom:a+n-c.bottom,left:e+n-c.left}:s==="bottom-right"?{top:t+n-c.top,left:e+n-c.left}:s==="top-center"?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(M(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a,height:l}=i;return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var a,l;const t=e.breakpoint,i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s))return!1;const n=t.hasOwnProperty("width")&&r<=t.width,o=t.hasOwnProperty("height")&&s<=t.height;return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Af(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,_re),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new RGe({view:e}),e.ui.add(this._spinner,{key:_re,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex(n=>n.uid===t),s=i.getItemAt(r);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],Tt.prototype,"actionsMenuId",null),u([d({readOnly:!0})],Tt.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],Tt.prototype,"featureMenuId",null),u([d({readOnly:!0})],Tt.prototype,"titleId",null),u([d({readOnly:!0})],Tt.prototype,"contentId",null),u([d({readOnly:!0})],Tt.prototype,"hasContent",null),u([d({readOnly:!0})],Tt.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],Tt.prototype,"collapsible",null),u([d({readOnly:!0})],Tt.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],Tt.prototype,"contentCollapsed",null),u([d({readOnly:!0})],Tt.prototype,"dividedActions",null),u([qe("viewModel.actions")],Tt.prototype,"actions",void 0),u([d()],Tt.prototype,"actionsMenuOpen",null),u([d()],Tt.prototype,"alignment",void 0),u([qe("viewModel.autoCloseEnabled")],Tt.prototype,"autoCloseEnabled",void 0),u([qe("viewModel.autoOpenEnabled")],Tt.prototype,"autoOpenEnabled",void 0),u([qe("viewModel.defaultPopupTemplateEnabled")],Tt.prototype,"defaultPopupTemplateEnabled",void 0),u([qe("viewModel.content")],Tt.prototype,"content",void 0),u([d()],Tt.prototype,"collapsed",void 0),u([d()],Tt.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],Tt.prototype,"currentAlignment",null),u([d({readOnly:!0})],Tt.prototype,"currentDockPosition",null),u([d()],Tt.prototype,"dockOptions",null),u([d()],Tt.prototype,"dockEnabled",void 0),u([qe("viewModel.featureCount")],Tt.prototype,"featureCount",void 0),u([d()],Tt.prototype,"featureMenuOpen",void 0),u([qe("viewModel.features")],Tt.prototype,"features",void 0),u([qe("viewModel.goToOverride")],Tt.prototype,"goToOverride",void 0),u([d()],Tt.prototype,"headingLevel",void 0),u([qe("viewModel.highlightEnabled")],Tt.prototype,"highlightEnabled",void 0),u([qe("viewModel.location")],Tt.prototype,"location",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Tt.prototype,"label",void 0),u([d()],Tt.prototype,"maxInlineActions",void 0),u([d(),js("esri/widgets/Popup/t9n/Popup")],Tt.prototype,"messages",void 0),u([d(),js("esri/t9n/common")],Tt.prototype,"messagesCommon",void 0),u([qe("viewModel.promises")],Tt.prototype,"promises",void 0),u([qe("viewModel.selectedFeature")],Tt.prototype,"selectedFeature",void 0),u([qe("viewModel.selectedFeatureIndex")],Tt.prototype,"selectedFeatureIndex",void 0),u([d({readOnly:!0})],Tt.prototype,"selectedFeatureWidget",null),u([d()],Tt.prototype,"spinnerEnabled",void 0),u([qe("viewModel.title")],Tt.prototype,"title",void 0),u([qe("viewModel.updateLocationEnabled")],Tt.prototype,"updateLocationEnabled",void 0),u([qe("viewModel.view")],Tt.prototype,"view",void 0),u([d({type:M_e}),xye(["triggerAction","trigger-action"])],Tt.prototype,"viewModel",void 0),u([qe("viewModel.visible")],Tt.prototype,"visible",void 0),u([d()],Tt.prototype,"visibleElements",void 0),u([Rt("visibleElements")],Tt.prototype,"castVisibleElements",null),u([ra()],Tt.prototype,"_close",null),u([ra()],Tt.prototype,"_toggleDockEnabled",null),u([ra()],Tt.prototype,"_toggleFeatureMenu",null),u([ra()],Tt.prototype,"_toggleActionsMenu",null),u([ra()],Tt.prototype,"_triggerAction",null),u([ra()],Tt.prototype,"_selectFeature",null),u([ra()],Tt.prototype,"_next",null),u([ra()],Tt.prototype,"_previous",null),Tt=u([P(O_e)],Tt);const Sre=Tt,J6=[0,0];function R7e(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return J6[0]=i.left+t.pageXOffset,J6[1]=i.top+t.pageYOffset,J6}function Ere(e){e&&(Tfe(e),e.parentNode&&e.parentNode.removeChild(e))}function P7e(e){const t=document.createElement("div");return e.appendChild(t),t}const zC=16,qI=750,I7e=512,$7e=2,D7e=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:zC,time:qI},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([se(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),se(()=>this.interacting,r=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",r.toString())})])}initialize(){this.handles.add(se(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(i){const r=this._get("container");if(r===i)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),Ere(this.root),this._set("root",null),KK(this.userContent,r),Ere(this.userContent),this._set("userContent",null)),i){i.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",KK(i,n),i.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",i.insertBefore(o,i.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Vee;o.appendChild(l.surface),this._set("overlay",l),se(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=vw({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(se(()=>this.size,c=>{const[h,p]=c,f="esri-view-surface--inset-outline";h>=document.body.clientWidth||p>=document.body.clientHeight?a.classList.add(f):a.classList.remove(f)},At),s),this._set("container",i),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get popup(){return this._get("popup")||new Sre({view:this})}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n[0],r-=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n[0],r+=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([se(()=>this.root,r=>{i.container=r?P7e(r):null},At),se(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},At)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=zC,i.time=qI,this.handles.add([(()=>{const r=()=>{i.freq=zC,i.time=qI};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),vw({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=zC,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?zC:Math.min(qI,n.freq*$7e),!s&&n.freq>=I7e&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=R7e(i);return(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d({value:null,cast:i=>BP(i)})],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d({type:Sre})],t.prototype,"popup",null),u([d({type:Vee})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d()],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([P("esri.views.DOMContainer")],t),t};function TSt(e){return e&&"focus"in e}const uZ=ge.getLogger("esri.layers.support.ElevationSampler");class R_e{queryElevation(t){return P_e(t.clone(),this)}on(){return U7e}projectIfRequired(t,i){return I_e(t,i)}}class L7e extends R_e{constructor(t,i,r){super(),this.tile=t,this.noDataValue=r,this.extent=G5(t.tile.extent,i.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this.aaExtent=t.tile.extent;const s=Ic(i.spatialReference),n=i.lodAt(t.tile.level).resolution*s;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const i=this.projectIfRequired(t,this.spatialReference);return!M(i)&&this.containsAt(i.x,i.y)}containsAt(t,i){return YW(this.aaExtent,t,i)}elevationAt(t,i){if(!this.containsAt(t,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return uZ.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return ft(this.tile.sample(t,i),this.noDataValue)}}class SSt extends R_e{constructor(t,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?t.map(o=>new L7e(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=G5(Nt(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,i){for(const r of this.samplers)if(r.containsAt(t,i))return r.elevationAt(t,i);return uZ.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler`),this.noDataValue}}function P_e(e,t){const i=I_e(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":N7e(e,i,t);break;case"polyline":F7e(e,i,t);break;case"multipoint":k7e(e,i,t)}return e}function I_e(e,t){if(M(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=rx(e,t);return r||uZ.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function N7e(e,t,i){e.z=i.elevationAt(t.x,t.y)}function F7e(e,t,i){Uf.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Uf.x=c[0],Uf.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Uf.x,Uf.y)}}e.hasZ=!0}function k7e(e,t,i){Uf.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];Uf.x=o[0],Uf.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Uf.x,Uf.y)}e.hasZ=!0}const Uf=new at,U7e={remove(){}};var jj;let hf=jj=class extends ve{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new jj({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],hf.prototype,"cols",void 0),u([d({type:Sr,json:{write:!0}})],hf.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],hf.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],hf.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],hf.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],hf.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],hf.prototype,"scale",void 0),hf=jj=u([P("esri.layers.support.LOD")],hf);const $_e=hf;var z0;const Cre=new wi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Kn=z0=class extends ve{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=Ze.WebMercator,numLODs:n=24}=e;if(!Ml(s)){const p=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];p.push({level:f,scale:m,resolution:m})}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift({level:m,scale:f,resolution:f}),f*=2}return new z0({dpi:96,lods:p,origin:new at(0,0,s),size:[r,r],spatialReference:s})}const o=jv(s),a=e.origin?new at({x:e.origin.x,y:e.origin.y,spatialReference:s}):new at(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Ic(s)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],m=f*c;h.push({level:p,scale:f,resolution:m})}else{let p=vde(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/t);h.push({level:0,scale:p,resolution:p*c});for(let m=1;m<f;m++){const y=p/2**t,v=y*c;h.push({level:m,scale:y,resolution:v}),p=y}}return new z0({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=jv(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return at.fromJSON(F({spatialReference:t.spatialReference},e))}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach(s=>{r.push(s.scale),t=s.scale>t?s.scale:t,i=s.scale<i?s.scale:i,this._levelToLOD[s.level]=s})),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+Math.log(s/e)/Math.log(s/n)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=i;else if(Rc(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const c=rx(t,this.spatialReference);if(M(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:Nt()}),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=z0.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===z0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(i=o)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Nt()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return z0.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*t;i.push(new $_e({level:n.level,scale:n.scale,resolution:o}))}return new z0({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};u([d({type:Number,json:{write:!0}})],Kn.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],Kn.prototype,"dpi",void 0),u([d({type:String,json:{read:Cre.read,write:Cre.write,origins:{"web-scene":{read:!1,write:!1}}}})],Kn.prototype,"format",void 0),u([d({readOnly:!0})],Kn.prototype,"isWrappable",null),u([d({type:at,json:{write:!0}})],Kn.prototype,"origin",void 0),u([Ue("origin")],Kn.prototype,"readOrigin",null),u([d({type:[$_e],value:null,json:{write:!0}})],Kn.prototype,"lods",null),u([d({readOnly:!0})],Kn.prototype,"minScale",void 0),u([d({readOnly:!0})],Kn.prototype,"maxScale",void 0),u([d({readOnly:!0})],Kn.prototype,"scales",void 0),u([d({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],Kn.prototype,"size",void 0),u([Ue("size",["rows","cols"])],Kn.prototype,"readSize",null),u([Be("size",{cols:{type:Sr},rows:{type:Sr}})],Kn.prototype,"writeSize",null),u([d({type:Ze,json:{write:!0}})],Kn.prototype,"spatialReference",void 0),Kn=z0=u([P("esri.layers.support.TileInfo")],Kn),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(Kn||(Kn={}));const tN=Kn,z7e=12;class Nr{constructor(t){const i=Nr.checkUnsupported(t);if(_(i))throw i;const r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Ow(this.spatialReference)||_m(this.spatialReference)||bm(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Nr(this.toTileInfo())}toTileInfo(){return new tN({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=CK(t[0]),i[1]=SF(t[1]),i[2]=CK(t[2]),i[3]=SF(t[3])):this._isGCS&&(i[0]=Dt(t[0]),i[1]=Dt(t[1]),i[2]=Dt(t[2]),i[3]=Dt(t[3]))}getExtentGeometry(t,i,r,s=new ui){return this.getExtent(t,i,r,Dp),s.spatialReference=this.spatialReference,s.xmin=Dp[0],s.ymin=Dp[1],s.xmax=Dp[2],s.ymax=Dp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof Nr)){if(Nr.checkUnsupported(t))return!1;t=new Nr(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!ZS(t.origin[0],this.origin[0],s)||!ZS(t.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*z7e,ZS(r,t.levels[i].resolution,s))}rootTilesInExtent(t,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(M(t)||n[0]===0||n[1]===0)return s;Nr.computeRowColExtent(t,n,this.origin,Dp);let o=Dp[1],a=Dp[3],l=Dp[0],c=Dp[2];const h=c-l,p=a-o;if(h*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return _(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,i,r,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-t[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!sOe(s.resolution,r/2**s.level))}static hasGapInLevels(t){const i=t.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new q("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return M(t)?hZ():t.lods.length<1?new q("tilingscheme:generic","Tiling scheme must have at least one level"):Nr.isPowerOfTwo(t)?Nr.hasGapInLevels(t)?new q("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Nr.tileSizeSupported(t)?Nr.hasOriginPerLODs(t)?new q("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new q("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new q("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const r=t[2]-t[0],s=t[3]-t[1],n=Ic(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new Nr(new tN({size:[a,a],origin:{x:t[0]-.5*(o-r),y:t[3]+.5*(o-s)},lods:[{level:0,resolution:o/a,scale:1/(a/l*c/(o*n))}],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const i=new Nr(Nr.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){const s=256/i,n=new Nr(new tN({size:[i,i],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function hZ(){return new q("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Nr.WebMercatorAuxiliarySphereTileInfo=new tN({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ze.WebMercator},spatialReference:Ze.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),Nr.WebMercatorAuxiliarySphere=Nr.makeWebMercatorAuxiliarySphere(19);const Dp=Nt(),RS=64,Hj=512,V7e=2.5,CR=nOe(K8/10),D_e=4,B7e=4,iN=e=>e<4?3:B7e,L_e=Nt();Nr.WebMercatorAuxiliarySphere.getExtent(0,0,0,L_e);const G7e=Nt([-180,-90,180,90]),j7e="Cannot extend surface to encompass all layers because it would result in too many root tiles.",H7e="Surface extent is too large for tile resolution at level 0.",wh=8,q7e=ge.getLogger("esri.views.support.GroundViewElevationSampler");let V0=class extends as.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=CR}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(M(e.extent)||!e.spatialReference)return null;const t=G5(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(M(this.extent)||!Ia(this.extent,e,t)){const i=_(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return q7e.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return ft(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return P_e(e.clone(),this)}};u([d({readOnly:!0})],V0.prototype,"demResolution",void 0),u([d({readOnly:!0})],V0.prototype,"extent",null),u([d({readOnly:!0})],V0.prototype,"noDataValue",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],V0.prototype,"spatialReference",void 0),u([d({constructOnly:!0})],V0.prototype,"view",void 0),V0=u([P("esri.views.support.GroundViewElevationSampler")],V0);const W7e=V0;let B0=class extends Se{constructor(e){super(e),this.handles=new jt,this.view=null,this.layerViews=new it}initialize(){this.handles.add(vo(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new W7e({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>se(()=>e.updating,()=>this._updateUpdating(),Ki)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],B0.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],B0.prototype,"updating",null),u([d({constructOnly:!0})],B0.prototype,"view",void 0),u([d({type:it,readOnly:!0})],B0.prototype,"layerViews",void 0),u([d({readOnly:!0})],B0.prototype,"suspended",null),B0=u([P("esri.views.GroundView")],B0);const X7e=B0,Y7e=e=>{let t=class extends e{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:xAe([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:_(s)?s.event:null,signal:_(s)?s.signal:null,defaultPopupTemplateEnabled:!!_(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(_(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const{results:s,mapPoint:n}=await this.popupHitTest(i),o=s.filter(l=>l.type==="graphic"&&this._isValidPopupGraphic(l.graphic,r)),a=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(l=>l.graphic),queryArea:n,location:n||a}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),_(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return _(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([P("esri.views.PopupView")],t),t};async function dZ(e,t){return await e.load(),Z7e(e,t)}async function Z7e(e,t){const i=[],r=(...n)=>{for(const o of n)M(o)||(Array.isArray(o)?r(...o):it.isCollection(o)?o.forEach(a=>r(a)):um.isLoadable(o)&&i.push(o))};t(r);let s=null;if(await u5e(i,async n=>{(await Ac(Q7e(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function Q7e(e){return"loadAll"in e&&typeof e.loadAll=="function"}async function J7e(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,i=await Ofe("esri/t9n/basemaps");return i[e]||i[t]}const qj={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Li("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Li("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Li("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Li("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Li("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Li("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Li("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Li("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Li("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Li("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Li("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Li("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Li("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Li("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Li("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Li("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}},K7e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),eje=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function tje(e){return e.layerContainerType==="basemap"?K7e:e.layerContainerType==="operational-layers"?eje:null}function ije(e,t){if(t.restrictedWebMapWriting){const i=tje(t);return!_(i)||i.has(e.type)&&!WX(e)}return!0}function rje(e,t){if(WX(e)){const i=VE("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&K6(e,r)}else e.type==="stream"?K6(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&K6(e,t)}function K6(e,t){"maxScale"in e&&(t.maxScale=wF(e.maxScale)),"minScale"in e&&(t.minScale=wF(e.minScale))}function sje(e,t){if(rje(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=wF(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(WX(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function Are(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new q("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(ije(e,i)){const r={};return e.write(r,i)?r:null}return _(t)&&sje(e,t=ie(t)),t}var rN;let nje=0;const eV=ge.getLogger("esri.Basemap");let dh=rN=class extends $P(um){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+nje++,this.baseLayers=new it,this.referenceLayers=new it;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&eV.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{eV.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const e=this.baseLayers.removeAll();for(const r of e)r.destroy();const t=this.referenceLayers.removeAll();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set baseLayers(e){this._set("baseLayers",ly(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i=me(F({},i),{layerContainerType:"basemap"}),this.baseLayers.forEach(s=>{const n=Are(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=Are(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&(n.isReference=!0,r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",ly(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return dZ(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new rN({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t=F({origin:"web-map"},t)),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=ie(i);return r.url&&cm(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&cm(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;ci(e);const r=[];if(t){const s=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;r.push(J7e(n).then(o=>{o&&this.read({title:o},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await import("./layersCreator.bf495c80.js"),a=[];if(ci(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=o(this.baseLayers,e.baseMapLayers.filter(p=>!p.isReference),l);a.push(c);const h=o(this.referenceLayers,e.baseMapLayers.filter(p=>p.isReference),l);a.push(h)}await Sn(a)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=xn(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||mo.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||mo.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=qj[e];if(t){if(t.deprecated){let i=null;e==="dark-gray"?i="dark-gray-vector":e==="gray"?i="gray-vector":e==="streets"?i="streets-vector":e==="topo"&&(i="topo-vector"),xhe(eV,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return rN.fromJSON(t)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:it}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],dh.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],dh.prototype,"id",void 0),u([d({type:eE})],dh.prototype,"portalItem",void 0),u([d()],dh.prototype,"referenceLayers",null),u([d({readOnly:!0})],dh.prototype,"resourceInfo",void 0),u([d({type:Ze})],dh.prototype,"spatialReference",void 0),u([d()],dh.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],dh.prototype,"title",void 0),u([Be("title")],dh.prototype,"writeTitle",null),dh=rN=u([P("esri.Basemap")],dh);const tE=dh;var oje=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:tE}),Wj;let sN=Wj=class extends ve{constructor(e){super(e),this.type="none"}clone(){return new Wj({type:this.type})}};u([ut({none:"none",stayAbove:"stay-above"})],sN.prototype,"type",void 0),sN=Wj=u([P("esri.ground.NavigationConstraint")],sN);var Xj;const Mre=ge.getLogger("esri.Ground");let cg=Xj=class extends $P(um){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new it;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&Mre.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{Mre.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set layers(e){this._set("layers",ly(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r=me(F({},r),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){const o={};oBe(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new q("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return dZ(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.4995702b.js");ci(t);const r=new i,s=this.layers.filter(Ore).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.4995702b.js");ci(t);const r=new i,s=this.layers.filter(Ore).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:ie(this.surfaceColor),navigationConstraint:ie(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new Xj({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return import("./layersCreator.bf495c80.js").then(({populateOperationalLayers:o})=>{ci(i);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return Sn(a)}).then(()=>{})}};function aje(e){return e&&"createElevationSampler"in e}function Ore(e){return e.type==="elevation"||aje(e)}u([d({json:{read:!1}})],cg.prototype,"layers",null),u([Be("layers")],cg.prototype,"writeLayers",null),u([d({readOnly:!0})],cg.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Sr,read:{reader:N2,source:"transparency"},write:{writer:(e,t)=>{t.transparency=FP(e)},target:"transparency"}}})],cg.prototype,"opacity",void 0),u([d({type:We,json:{type:[Sr],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],cg.prototype,"surfaceColor",void 0),u([d({type:sN,json:{write:!0}})],cg.prototype,"navigationConstraint",void 0),cg=Xj=u([P("esri.Ground")],cg);const AR=cg;let ZT=class extends hx(it){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(Rhe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=_(this.getCollections)?this.getCollections():null;if(M(e))return void this.removeAll();let t=0;for(const i of e)_(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new it(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:r=>!!r;for(const r of t)if(r){if(i(r)){const s=this.indexOf(r,e);s>=0?s!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(r);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([d()],ZT.prototype,"getCollections",void 0),u([d()],ZT.prototype,"getChildrenFunction",void 0),u([d()],ZT.prototype,"itemFilterFunction",void 0),ZT=u([P("esri.core.CollectionFlattener")],ZT);const iE=ZT;function lje(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&((t=e==null?void 0:e.capabilities)==null?void 0:t.operations)&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const Rre=ge.getLogger("esri.support.basemapUtils");function cje(){return{}}function uje(e){for(const t in e){const i=e[t];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete e[t]}}function pZ(e,t){let i;if(typeof e=="string"){if(!(e in qj)){const r=Object.entries(qj).filter(([s,n])=>ki.apiKey&&!n.classic||!ki.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return Rre.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${r}`),null}t&&(i=t[e]),i||(i=tE.fromId(e),t&&(t[e]=i))}else i=ns(tE,e);return(i==null?void 0:i.destroyed)&&(Rre.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function hje(e,t=null){const i=pZ(e);if(!i)return null;const r=new tE({id:i.id,title:i.title,baseLayers:i.baseLayers.slice(),referenceLayers:i.referenceLayers.slice()});return t&&(r.baseLayers=Pre(r.baseLayers,t.baseLayers),r.referenceLayers=Pre(r.referenceLayers,t.referenceLayers)),r.load().catch(()=>{}),r.portalItem=i.portalItem,r}function Pre(e,t){const i=new it;return e.forEach(r=>{const s=t.find(n=>dje(Ire(r),Ire(n)))||r;i.includes(s)?i.push(r):i.push(s)}),i}function Ire(e){var t,i;return{type:e.type,url:pje("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||!_(e.sublayers)||(t=e.sublayers)==null?void 0:t.map(r=>({id:r.id,visible:r.visible})),activeLayerId:e.type==="wmts"?(i=e.activeLayer)==null?void 0:i.id:void 0}}function dje(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(_(e.activeLayerId)||_(t.activeLayerId))return e.activeLayerId===t.activeLayerId;if(_(e.sublayers)||_(t.sublayers)){if(M(e.sublayers)||M(t.sublayers)||e.sublayers.length!==t.sublayers.length)return!1;for(let i=0;i<e.sublayers.length;i++){const r=e.sublayers.at(i),s=t.sublayers.at(i);if(r.id!==s.id||r.visible!==s.visible)return!1}}return!0}function pje(e){return e?jh(e).replace(/^\s*https?:/i,"").toLowerCase():""}function fje(e){return new iE({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return i&&"tables"in i&&i.tables.includes(t)}})}const mje=ge.getLogger("esri.support.groundUtils"),$re={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function gje(e){let t=null;if(typeof e=="string")if(e in $re){const i=$re[e];t=new AR({resourceInfo:{data:{layers:[i]}}})}else mje.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=ns(AR,e);return t}function Yj(e,t,i){let r,s;if(e)for(let n=0,o=e.length;n<o;n++){if(r=e.getItemAt(n),r[t]===i)return r;if((r==null?void 0:r.type)==="group"&&(s=Yj(r.layers,t,i),s))return s}}const Dre=ge.getLogger("esri.support.LayersMixin"),yje=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new it;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||Dre.error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",ly(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof TR){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Bu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):Dre.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;r=s.getNextIndex(r),i.slice().forEach(n=>{n.parent!==this?(s.add(n,r),r+=1):this.reorder(n,r)})}findLayerById(i){return Yj(this.layers,"id",i)}findLayerByUid(i){return Yj(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([d()],t.prototype,"layers",null),t=u([P("esri.support.LayersMixin")],t),t},N_e="esri.support.TablesMixin",vje=ge.getLogger(N_e);function Zj(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const n=e.getItemAt(r);if(n[t]===i)return n;if((n==null?void 0:n.type)==="group"){const o=Zj(n.tables,t,i);if(o)return o}}}const _je=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new it,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&vje.error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",ly(i,this._get("tables")))}findTableById(i){return Zj(this.tables,"id",i)}findTableByUid(i){return Zj(this.tables,"uid",i)}};return u([d()],t.prototype,"tables",null),t=u([P(N_e)],t),t};let df=class extends _je(yje(as.EventedMixin(Se))){constructor(e){super(e),this.allLayers=new iE({getCollections:()=>{var t,i,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=fje(this),this.basemap=null,this.editableLayers=new iE({getCollections:()=>[this.allLayers],itemFilterFunction:lje}),this.ground=new AR,this._basemapCache=cje()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),uje(this._basemapCache),this._basemapCache=null}castBasemap(e){return pZ(e,this._basemapCache)}castGround(e){const t=gje(e);return M(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],df.prototype,"allLayers",void 0),u([d({readOnly:!0})],df.prototype,"allTables",void 0),u([d({type:tE})],df.prototype,"basemap",void 0),u([Rt("basemap")],df.prototype,"castBasemap",null),u([d({readOnly:!0})],df.prototype,"editableLayers",void 0),u([d({type:AR,nonNullable:!0})],df.prototype,"ground",void 0),u([Rt("ground")],df.prototype,"castGround",null),df=u([P("esri.Map")],df);const F_e=df;let EO=class extends uO{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([FW({Type:Ga,ensureType:ns(Ga)})],EO.prototype,"itemType",void 0),EO=u([P("esri.support.GraphicsCollection")],EO);let G0=class extends Se{constructor(e){super(e),this.view=null,this.baseLayerViews=new it,this.referenceLayerViews=new it,this._loadingHandle=se(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap},t=>{t&&t.load().catch(()=>{})},At)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,i;if(this.view&&this.view.suspended)return!1;const e=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([d({constructOnly:!0})],G0.prototype,"view",void 0),u([d({readOnly:!0})],G0.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],G0.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],G0.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],G0.prototype,"updating",null),G0=u([P("esri.views.BasemapView")],G0);const bje=ge.getLogger("esri.views.LayerViewManager");class wje{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=r_(),this._started=!1,this.done=!1,ha(this._controller.signal,()=>{const s=new q("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:t}),"prefetchResources"in i&&await i.prefetchResources({signal:t}),i.createLayerView)o=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new q("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(i);ci(t),o="default"in h?new h.default({layer:i,view:r}):new h({layer:i,view:r})}const l=()=>{a=Vs(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=ha(t,l),ci(t);try{await o.when()}catch(h){throw l(),h}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new q("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new q("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}}let ph=class extends Aw{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new Zf,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const t=(i=this.view.map)==null?void 0:i.allLayers;if(t)for(const r of t)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(M(this._workPromise)&&(this._workPromise=r_()),this.handles.remove("reschedule"),this.handles.add(ix(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var n,o,a;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),M(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const i=new iE({getCollections:()=>this._rootCollectionNames.map(l=>this.get(l)),getChildrenFunction:l=>l&&"layers"in l?l.layers:null});if(!i)return this._workPromise.resolve(),void(this._workPromise=null);for(const l of i)this._createLayerView(l);this._refreshCollections();for(const[l,c]of this._layerLayerViewInfoMap)i.includes(l)||(this._layerLayerViewInfoMap.delete(c.layer),c.destroy());const r=i.filter(l=>l.type==="group").map(l=>l.layers),s=[(n=t==null?void 0:t.ground)==null?void 0:n.layers,(o=t==null?void 0:t.basemap)==null?void 0:o.baseLayers,(a=t==null?void 0:t.basemap)==null?void 0:a.referenceLayers,t==null?void 0:t.layers,...r].filter(l=>!!l);this.handles.add(s.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([En(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),se(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),wr)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return _(this._workPromise)||this._watchUpdatingTracking.updating||on(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new q("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=i,t.getItemAt(r)!==o&&t.splice(r,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new wje(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{var r,s;i&&(Qr(i)||i.name==="cancelled:layerview-create")||bje.error(`Failed to create layerview for layer title:'${(r=e.title)!=null?r:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],ph.prototype,"_workPromise",void 0),u([d({readOnly:!0})],ph.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],ph.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],ph.prototype,"_rootCollectionNames",null),u([d()],ph.prototype,"layerViewImporter",void 0),u([d()],ph.prototype,"supportsGround",void 0),u([d({readOnly:!0})],ph.prototype,"updating",null),u([d({readOnly:!0})],ph.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],ph.prototype,"view",void 0),ph=u([P("esri.views.LayerViewManager")],ph);const xje=ph;let Zc=class extends Se{constructor(e){super(e),this.factor=1.5,this.offset=Tp(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],Zc.prototype,"factor",void 0),u([d({nonNullable:!0})],Zc.prototype,"offset",void 0),u([d()],Zc.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],Zc.prototype,"size",void 0),u([d()],Zc.prototype,"maskUrl",void 0),u([d()],Zc.prototype,"maskEnabled",void 0),u([d()],Zc.prototype,"overlayUrl",void 0),u([d()],Zc.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],Zc.prototype,"version",null),u([d({type:Boolean})],Zc.prototype,"visible",void 0),Zc=u([P("esri.views.Magnifier")],Zc);const k_e=Zc;let nN=class extends Se{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.push(new Lre(r,s,e,t,i)))}unshift(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.unshift(new Lre(r,s,e,t,i)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const i=nn(t.signal);if(i&&!t.abortCallback)t.reject(hi());else{const r=i?t.abortCallback(hi()):t.callback(e);Bu(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(i){t.reject(i)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=hi();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};u([d()],nN.prototype,"running",void 0),nN=u([P("esri.layers.support.PromiseQueue")],nN);class Lre{constructor(t,i,r,s,n){this.resolve=t,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}}let AM=class extends Se{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],AM.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],AM.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),AM=u([P("esri.views.support.DebugFlags")],AM);const Tje=new AM,Sje=ge.getLogger("esri.views.support.Scheduler");function Eje(){return new m4.Scheduler}var yt;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(yt||(yt={}));const If=0,Nre=new Map([[yt.RESOURCE_CONTROLLER,If],[yt.SLIDE,If],[yt.STREAM_DATA_LOADER,If],[yt.ELEVATION_QUERY,If],[yt.TERRAIN_SURFACE,1],[yt.SURFACE_GEOMETRY_UPDATES,1],[yt.GRAPHICS_CORE,2],[yt.I3S_CONTROLLER,2],[yt.POINT_CLOUD_LAYER,2],[yt.FEATURE_TILE_FETCHER,2],[yt.OVERLAY,4],[yt.STAGE,4],[yt.GRAPHICS_DECONFLICTOR,4],[yt.FILTER_VISIBILITY,4],[yt.SCALE_VISIBILITY,4],[yt.FRUSTUM_VISIBILITY,4],[yt.POINT_OF_INTEREST_FREQUENT,6],[yt.POINT_OF_INTEREST_INFREQUENT,30],[yt.LABELER,8],[yt.FEATURE_QUERY_ENGINE,8],[yt.FEATURE_TILE_TREE,16],[yt.FEATURE_TILE_TREE_ACTIVE,If],[yt.ELEVATION_ALIGNMENT,12],[yt.TEXT_TEXTURE_ATLAS,12],[yt.CLOUDS_GENERATOR,12],[yt.TEXTURE_UNLOAD,12],[yt.LINE_OF_SIGHT_TOOL,16],[yt.LINE_OF_SIGHT_TOOL_INTERACTIVE,If],[yt.SNAPPING,If],[yt.SHADOW_ACCUMULATOR,30]]);function Fre(e){return Nre.has(e)?Nre.get(e):typeof e=="number"?e:1}var Nn;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Nn||(Nn={}));const kre=6.5,Ure=1,Cje=30,zre=1e3/30,Vre=100,Bre=.9;var m4,q_;(function(e){let t=class extends Se{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new Gv("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Nn.INTERACTING,this._tasks=new Gt,this._runQueue=new Gt,this._load=0,this._idleStateCallbacks=new Gt,this._idleUpdatesStartFired=!1,this._maxReschedule=WI,this._forceTask=!1,this._debug=!1,this._debugHandle=se(()=>Tje.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,At);for(const o of Object.keys(yt))this.performanceInfo.tasks.set(yt[o],new Gv(yt[o]));let s;const n=this;this._test={get state(){return ft(s,n._state)},set state(o){s=o},FRAME_SAFETY_BUDGET:kre,INTERACTING_BUDGET:zre,IDLE_BUDGET:Vre,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),Vs(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=WI,this._schedule(),this.frame()))}))}registerTask(s,n){const o=Fre(s),a=new i(this,s,n,o);return this._tasks.push(a),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new Gv(s)),a}registerIdleStateCallbacks(s,n){const o={idleBegin:s,idleEnd:n};this._idleStateCallbacks.push(o),this.state===Nn.IDLE&&this._idleUpdatesStartFired&&o.idleBegin();const a=this;return{remove:()=>this._removeIdleStateCallbacks(o),set idleBegin(l){a._idleUpdatesStartFired&&(o.idleEnd(),a._state===Nn.IDLE&&l()),o.idleBegin=l},set idleEnd(l){o.idleEnd=l}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Nn.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(n=>n.idleEnd())))}get state(){return M(this._test.state)?this._state:this._test.state}updateBudget(s){this._test.usedBudget=0;let n=kre,o=s.frameDuration,a=Ure;switch(this.state){case Nn.IDLE:n=0,o=Math.max(Vre,s.frameDuration),a=Cje;break;case Nn.INTERACTING:o=Math.max(zre,s.frameDuration);case Nn.ANIMATING:}return o=o-s.elapsedFrameTime-n,this.state!==Nn.IDLE&&o<Ure&&!this._forceTask?(this._forceTask=!0,!1):(o=Math.max(o,a),this._budget.reset(o,this.state),this._maxReschedule=WI,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Nn.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Nn.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s)}_updateTask(s){this._tasks.forAll(n=>{n.name===s&&n.setPriority(s)})}_getState(s){if(this._runQueue.some(o=>o.name===s))return q_.SCHEDULED;let n=q_.IDLE;return this._tasks.forAll(o=>{o.name===s&&o.needsUpdate&&(o.schedulePriority<=1?n=q_.READY:n!==q_.READY&&(n=q_.WAITING))}),n}_getRuntime(s){let n=0;return this._tasks.forAll(o=>{o.name===s&&(n+=o.runtime)}),n}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(o=>{o.needsUpdate&&s.set(o.name,(s.get(o.name)||0)+1)}),s.size===0)return null;let n="";return s.forEach((o,a)=>{n+=o>1?` ${o}x ${a}`:` ${a}`}),n}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((n,o)=>o.needsUpdate?++n:n,0);this._load=this._load*Bre+s*(1-Bre)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===If&&s.needsUpdate&&!this._runQueue.includes(s)&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,n=0;if(this._tasks.forAll(o=>{o.needsUpdate&&o.schedulePriority!==0&&o.basePriority!==If&&(s=!0,n=Math.max(n,o.basePriority),o.schedulePriority===1?(o.schedulePriority=0,this._runQueue.push(o)):--o.schedulePriority)}),!s)return this.updating=!1,!1;this._maxReschedule===WI&&(this._maxReschedule=n),--this._maxReschedule}return this.updating=!0,!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)}catch(l){Sje.error(`Exception in task "${o.name}"`,l)}o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",o.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(l=>l.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this.updating=this._tasks.some(n=>n.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(yt))this._frameTaskTimes.set(yt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((n,o)=>this.performanceInfo.tasks.get(o).record(n)),this.performanceInfo.total.record(s)}get test(){return this._test}};u([d()],t.prototype,"updating",void 0),t=u([P("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends Se{constructor(s,n,o,a){super({}),this._scheduler=s,this.name=n,this._basePriority=a,this.runtime=0,this._queue=new nN,this._handles=new jt,this.schedulePriority=this._basePriority,this.task=_(o)?o:this._queue,this._handles.add(vo(()=>this.task.running,()=>s.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(lC),this._scheduler.removeTask(this),this.schedule=rE.schedule,this.reschedule=rE.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const n=Fre(s);this._basePriority!==If&&this.schedulePriority===0||(this.schedulePriority=n),this._basePriority=n}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,n,o){return this._queue.push(s,n,o)}reschedule(s,n,o){return this._queue.unshift(s,n,o)}processQueue(s){this._queue.runTask(s)}};u([d({constructOnly:!0})],i.prototype,"task",void 0),u([d({readOnly:!0})],i.prototype,"updating",null),i=u([P("esri.views.support.SchedulerTask")],i);class r{constructor(){this._begin=typeof performance!="undefined"?performance.now():0,this._budget=0,this._state=Nn.IDLE,this._didWork=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r})(m4||(m4={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(q_||(q_={}));const lC=(()=>{const e=new m4.Budget;return e.enabled=!1,e})();class Aje{remove(){}processQueue(){}schedule(t,i,r){try{if(nn(i)){const s=hi();return r?Promise.resolve(r(s)):Promise.reject(s)}return F8(t(lC))}catch(s){return Promise.reject(s)}}reschedule(t,i,r){return this.schedule(t,i,r)}}const rE=new Aje,WI=Number.MAX_SAFE_INTEGER;let PS=class extends Se{constructor(e,t){var i;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i=t==null?void 0:t.registerTask(yt.TEXTURE_UNLOAD))!=null?i:rE}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return _(t)?`${e}.${t}px`:e}};u([d()],PS.prototype,"_frameTask",void 0),u([d()],PS.prototype,"updating",null),PS=u([P("esri.views.3d.support.TextureCollection")],PS);var Gre;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(Gre||(Gre={}));const U_e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],z_e={};function V_e(e){return!!z_e[e]}function Mje(e){for(const t of e)if(!V_e(t))return!1;return!0}U_e.forEach(e=>{z_e[e]=!0});class Oje{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:i,priority:r},s)=>this.inputManager.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this.handlers.forEach((t,i)=>this.inputManager.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,i,r,s){const n=Array.isArray(t)?t:t.split(",");if(!Mje(n))return n.some(V_e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s!=null?s:Yv.DEFAULT;const l=this._createUniqueGroupName(),c=new Rje(this.view,n,a,o);this.handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this.handlerCounts.get(h)||0;this.handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,i){if(this.handlers.has(t)){this.handlers.delete(t);for(const r of i){const s=this.handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this.handlerCounts.delete(r):this.handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class Rje extends Go{constructor(t,i,r,s){super(!0),this.view=t;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:Tp(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(Tp(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this.latestDragStart=i),!this.latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=t,f={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return n==="end"&&(this.latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:Sc(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:m}=t;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var MR,jre,Hre;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(MR||(MR={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(jre||(jre={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(Hre||(Hre={}));const Pje=ge.getLogger("esri.views.interactive.interactiveToolUtils");function Ije(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return Pje.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.visible=!1,i.active&&(i.view.activeTool=null),i.destroy()})]}function g4(e){return e.visible&&e.getEditableFlag(MR.USER)&&e.getEditableFlag(MR.MANAGER)}function pf(e){return Tp(e.x,e.y)}function ESt(e){return Yr(e.x,e.y)}function B_e(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return Tp(t.clientX-i.left,t.clientY-i.top)}function qre(e,t){return t instanceof Event?B_e(e,t):pf(t)}function Wre(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class $je{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":Xre(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Yre(t))break;const s=pf(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(M(n))break;const o=this._findToolAndManipulatorByKey(n,i.forEachTool,XI),a=Qi(o,c=>c.manipulator),l=Qi(o,c=>c.tool);!(_(a)&&_(l)&&a.interactive)||a.grabbable&&a.grabbableForEvent(t)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,l,t),_(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(t)&&!a.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool!==n.tool&&(this._currentlyActiveTool=i.activeTool,this._revertToActiveTool=!0,i.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!Yre(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),o=Qi(s||n,({key:h})=>h),a=this._findManipulatorByKey(o,i.forEachTool);if(M(a))break;const l=pf(t);l.x=De(l.x,0,i.view.width),l.y=De(l.y,0,i.view.height);const c=(s||n).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(a.dragging=!0,n?a.events.emit("drag",{action:"update",start:c,screenPoint:l}):a.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:o,start:c}));break;case"end":a.dragging=!1,n&&a.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=pf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findToolAndManipulatorByKey(n,i.forEachTool,XI);if(Dje(t)||i.forEachTool(h=>{if((!_(o)||o.tool!==h||h.automaticManipulatorSelection)&&h.manipulators){let p=!1;h.manipulators.forEach(({manipulator:f})=>{f.selected&&(f.selected=!1,p=!0)}),p&&h.manipulatorSelectionChanged&&h.manipulatorSelectionChanged()}}),M(o))break;const{manipulator:a,tool:l}=o;if(!a.interactive)break;a.selectable&&l.automaticManipulatorSelection&&(a.selected=!a.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=t.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:r});break}case"click":{const s=pf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(M(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{const s=pf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(M(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=pf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(M(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:pf(r)}),this._grabbedManipulators.forEach(({key:s},n)=>{s.tool===i&&i.manipulators.findById(s.manipulatorId)===t&&this._grabbedManipulators.delete(n)})}_handlePointerEnd(t,i){const r=Qi(this._grabbedManipulators.get(t.pointerId),({key:n})=>n),s=this._findManipulatorByKey(r,i.forEachTool);_(s)&&!s.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(i.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:pf(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,i){let r=null;return on(t,({key:s})=>{const n=this._findManipulatorByKey(s,i);return!!(_(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(r=n.cursor,!0)}),r}_onFocusChange(t){this._updateCursor(t),this._updateFocusedManipulatorTools(t)}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const i=new Set;this._grabbedManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),this._hoveredManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),t(r=>{r.hasFocusedManipulators=i.has(r)})}clearPointers(t,i,r=!0,s){const n=o=>o.tool===t&&(M(s)||o.manipulatorId===s);this._grabbedManipulators.forEach(({key:o,pointerType:a},l)=>{if(n(o)){this._grabbedManipulators.delete(l);const c=this._findManipulatorByKey(o,i);_(c)&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:a}))}}),this._draggedManipulators.forEach(({key:o},a)=>{if(n(o)){this._draggedManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}}),r&&this._hoveredManipulators.forEach(({key:o},a)=>{if(n(o)){this._hoveredManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.hovering=!1)}}),this._onFocusChange(i)}_intersect(t,i,r){let s=null;return r(n=>{if(n.manipulators==null||!g4(n))return!1;const o=n.manipulators.intersect(t,i);return!M(o)&&(s={manipulatorId:o.id,tool:n},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Tp(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!Xre(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(pf(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){const n=this._intersect(t,r,s);let o=this._findManipulatorByKey(n,s);const a=Qi(this._hoveredManipulators.get(i),({key:c})=>c),l=this._findManipulatorByKey(a,s);_(o)&&!o.interactive&&(o=null),l!==o&&(_(l)&&(l.hovering=!1),_(o)?(o.hovering=!0,this._hoveredManipulators.set(i,{key:n})):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_findManipulatorByKey(t,i){return this._findToolAndManipulatorByKey(t,i,XI)?XI.manipulator:null}_findToolAndManipulatorByKey(t,i,r){return M(t)?null:(r.tool=null,r.manipulator=null,i(s=>{if(s!==t.tool||s.manipulators==null||!g4(s))return!1;const n=s.manipulators.findById(t.manipulatorId);return!!_(n)&&(r.manipulator=n,r.tool=s,!0)}),r.manipulator?r:null)}}function Xre(e){return e==="mouse"}function Yre(e){return e.pointerType!=="mouse"||e.button===0}function Dje(e){return!!e.native.shiftKey}const XI={manipulator:null,tool:null},Lje=ge.getLogger("esri.views.ToolViewManager"),Zre="attached",tV="tools";let ug=class extends Aw{constructor(e){super(e),this._manipulatorState=new $je,this.tools=new it,this.cursor=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.handles.add([this.view.on(U_e,e=>{this._handleInputEvent(e)},Yv.TOOL),...Ije(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(_(e)&&!this.view.ready)return void Lje.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),_(t)&&t.deactivate(),_(e)&&e.activate(),this._removeIncompleteTools(e);const i=M(this.activeTool);for(const r of this.tools){r.setEditableFlag(MR.MANAGER,i||r===this.activeTool);const s=g4(r);!i&&s||this._manipulatorState.clearPointers(r,this._forEachTool,!s)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){this.view.type==="3d"?(this._set("textures",new PS(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([se(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),Yh(()=>this._set("textures",lt(this.textures)))],Zre)):this.handles.add(se(()=>this.view.extent,()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){_(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Zre)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i=me(F({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});_(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:r=>{this.activeTool=r},view:this.view}),!t&&_(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(tV),this._forEachTool(e=>{if(e instanceof Se){const t=se(()=>[e.cursor,e.visible,e.editable],()=>{g4(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,tV)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:i})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,i)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),tV)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool(i=>!(!_(i.cursor)||!i.visible||!M(e)&&i.preferManipulatorCursor)&&(t=i.cursor,!0)),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter(t=>(M(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([d({constructOnly:!0,nonNullable:!0})],ug.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],ug.prototype,"textures",void 0),u([d({value:null})],ug.prototype,"activeTool",null),u([d({readOnly:!0,type:it})],ug.prototype,"tools",void 0),u([d({readOnly:!0})],ug.prototype,"cursor",void 0),u([d({readOnly:!0})],ug.prototype,"updating",null),ug=u([P("esri.views.ToolViewManager")],ug);const Nje=ug;let QT=class extends Se{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Fje.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return kje[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],QT.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],QT.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],QT.prototype,"axisThreshold",null),QT=u([P("esri.views.input.gamepad.GamepadInputDevice")],QT);const Fje=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),kje={standard:.15,spacemouse:.025,unknown:0},fZ=QT;let MM=class extends Se{constructor(...e){super(...e),this.devices=new it,this.enabledFocusMode="document"}};u([d({type:it.ofType(fZ),readOnly:!0})],MM.prototype,"devices",void 0),u([d({type:["document","view","none"]})],MM.prototype,"enabledFocusMode",void 0),MM=u([P("esri.views.input.gamepad.GamepadSettings")],MM);const Uje=MM;let oN=class extends Se{constructor(){super(...arguments),this.gamepad=new Uje}};u([d({readOnly:!0})],oN.prototype,"gamepad",void 0),oN=u([P("esri.views.input.Input")],oN);const zje=oN;let j0=class extends Se{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],j0.prototype,"enabled",void 0),u([d({type:fZ})],j0.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],j0.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],j0.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],j0.prototype,"velocityFactor",void 0),j0=u([P("esri.views.navigation.gamepad.GamepadSettings")],j0);const G_e=j0;let eb=class extends Se{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new G_e,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],eb.prototype,"browserTouchPanEnabled",void 0),u([d({type:G_e,nonNullable:!0})],eb.prototype,"gamepad",void 0),u([d({type:Boolean})],eb.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],eb.prototype,"mouseWheelZoomEnabled",void 0),eb=u([P("esri.views.navigation.Navigation")],eb);const j_e=eb;function Vje(e,t){if(!e)return null;if(!Qj(e))return new q("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});const i=e.heightUnit,r=O_.deriveUnitFromSR(e,t).heightUnit;return i!==r?new q("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function CSt(e,t,i){const r=H_e(e),s=t,n=Bje(r,s,i);if(r){const o=O_.deriveUnitFromSR(r,e.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new q("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new q("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!Gje(e)||n===rc.Unsupported)return new q("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case rc.Units:{const o=r.heightUnit||"unknown",a=s.heightUnit||"unknown",l=new q("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new q("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case rc.HeightModel:{const o=r.heightModel||"unknown",a=s.heightModel||"unknown",l=new q("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new q("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case rc.CRS:{const o=r.vertCRS||"unknown",a=s.vertCRS||"unknown",l=new q("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new q("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function Bje(e,t,i){if(!Qj(e)||!Qj(t))return rc.Unsupported;if(e==null||t==null)return rc.Ok;if(!i&&e.heightUnit!==t.heightUnit)return rc.Units;if(e.heightModel!==t.heightModel)return rc.HeightModel;switch(e.heightModel){case"gravity-related-height":return rc.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?rc.Ok:rc.CRS;default:return rc.Unsupported}}var rc;function Qj(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function Gje(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!X_e(e)}function H_e(e){const t=e.url&&K2(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&_(t)&&t.serverType==="ImageServer")&&q_e(e)&&e.heightModelInfo?e.heightModelInfo:X_e(e)?O_.deriveUnitFromSR(Hje,e.spatialReference):null}function q_e(e){return"heightModelInfo"in e}function W_e(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function X_e(e){return W_e(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Y_e(e)}function jje(e){return e.layers!=null||Y_e(e)||W_e(e)||q_e(e)}function Y_e(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(rc||(rc={}));const Hje=new O_({heightModel:"gravity-related-height"});var Ve;function Qre(e){return e==="global"?Ve.Global:Ve.Local}function iV(e){return e===Ve.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(Ve||(Ve={}));let Jj,rV=null;async function qje(e){rV||(rV=Promise.resolve().then(function(){return zut}).then(t=>Jj=t)),await rV,ci(e)}async function Z_e(e,t,i,r){if(!e)return null;const s=e.spatialReference;return EX()||cy(s,t)?GP(e,t):Jj?Jj.projectGeometry(e,t,i,r):(await Promise.race([qje(r),BF(r)]),Z_e(e,t,i,r))}let Dr=class extends Se{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Xh(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return _(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return M(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,r,s,n;const e=(i=this.map)==null?void 0:i.call(this),t=[];return _(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(r=e==null?void 0:e.basemap)==null?void 0:r.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);_(a)&&(i=a)}if(_(i)&&i.length===1)break}if(t&&(M(i)||i.length!==1))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:_(r)?r.spatialReference:null,viewingMode:_(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,r,s,n,o,a,l,c;if(!this.required.tileInfo)return(i=this._get("_tileInfoTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var i,r,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))==null?void 0:i.heightModelInfo))return(r=this._get("_heightModelInfoTask"))!=null?r:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(jje(o)){const a=H_e(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var r,s;if(this.suspended||!this.required.extent)return(r=this._get("_extentCandidatesTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(_(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)i.push({extent:c,layer:n})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(M(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:_(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(_(this._projectExtentTask.task)&&(this._projectExtentTask.task=Xh(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:RP(async s=>{try{const n=await Z_e(i.extent,r,i.layer.portalItem,s);this._projectExtentTask=me(F({},this._projectExtentTask),{task:null,output:n})}catch{if(nn(s))return;this._projectExtentTask=me(F({},this._projectExtentTask),{task:null})}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(M(e))return t;const i=[],r=(s,n)=>_(s)?_(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=r(s.viewingMode,n.viewingMode);if(o!==!1){i.push({spatialReference:s.spatialReference,viewingMode:o});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return M(e)||e.length<1?_(t)?{spatialReference:t,viewingMode:null}:null:(_(t)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==Ve.Local)&&(e=e.filter(({viewingMode:i})=>i!==Ve.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const r of t){const s=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(_(s)){const n=_(s.constraints)?s.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||M(this.userSpatialReference)||o.equals(this.userSpatialReference))&&i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const r of e)if(this._collectCollection(r,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load(),"loading"):e.loadStatus:"loaded"}};u([d()],Dr.prototype,"required",void 0),u([d({constructOnly:!0})],Dr.prototype,"map",void 0),u([d({constructOnly:!0})],Dr.prototype,"getSpatialReferenceSupport",void 0),u([d()],Dr.prototype,"defaultSpatialReference",void 0),u([d()],Dr.prototype,"userSpatialReference",void 0),u([d()],Dr.prototype,"sourcePreloadCount",void 0),u([d()],Dr.prototype,"priorityCollection",void 0),u([d()],Dr.prototype,"requiresExtentInSpatialReference",void 0),u([d()],Dr.prototype,"suspended",void 0),u([d({readOnly:!0})],Dr.prototype,"ready",null),u([d({readOnly:!0})],Dr.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],Dr.prototype,"spatialReference",null),u([d({readOnly:!0})],Dr.prototype,"extent",null),u([d({readOnly:!0})],Dr.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Dr.prototype,"vcsWkid",null),u([d({readOnly:!0})],Dr.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],Dr.prototype,"viewingMode",null),u([d({readOnly:!0})],Dr.prototype,"tileInfo",null),u([d({readOnly:!0})],Dr.prototype,"mapCollections",null),u([d({readOnly:!0})],Dr.prototype,"_allLayers",null),u([d({readOnly:!0})],Dr.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],Dr.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],Dr.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],Dr.prototype,"_extentCandidatesTask",null),u([d()],Dr.prototype,"_extentTask",null),u([d()],Dr.prototype,"_projectExtentTask",void 0),Dr=u([P("esri.views.support.DefaultsFromMap")],Dr);var aN;const YI=ge.getLogger("esri.views.View");let Pt=aN=class extends hx(as.EventedMixin(UP(Se))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new iE({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new EO,this.analyses=new W2,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new it,this.magnifier=new k_e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new zje,this.navigation=new j_e,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Oje(this),this.persistableViewModels=new it,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(se(()=>this.preconditionsReady,t=>{var i,r;t?(this._currentSpatialReference=this.spatialReference,aN.views.add(this)):(this._currentSpatialReference=null,aN.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((i=this.layerViewManager)==null||i.clear(),(r=this.toolViewManager)==null||r.detach(),_(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),_(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Ki))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,hR(()=>this.ready)))),this.basemapView=new G0({view:this}),this.layerViewManager=new xje({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Nje({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([se(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=me(F({},this.defaultsFromMap.required),{extent:e}),{sync:!0,initial:!0}),se(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),se(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([se(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(t&&!this.spatialReference&&i){if(_(e))return;const s=Yh(()=>e=Xh(e));e=RP(async n=>{try{await S2(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}YI.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=lt(this.graphics),this.analyses=lt(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),lt(this.analysisViewManager),this.toolViewManager=lt(this.toolViewManager),this.layerViewManager=lt(this.layerViewManager),this.basemapView=lt(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return YI.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Dr(F({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e)},this._defaultsFromMapSettings))}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||um.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)==null?void 0:e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&((e==null?void 0:e.destroyed)&&(YI.warn("#map","The provided map is already destroyed",{map:e}),e=null),um.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,i;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((i=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:i.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!Rc(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return _(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,i;return(i=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?i:null}importLayerView(e){throw new q("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return _(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&YI.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(vo(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Pt.views=new it,u([d()],Pt.prototype,"_userSpatialReference",void 0),u([qe("toolViewManager.activeTool")],Pt.prototype,"activeTool",void 0),u([d({readOnly:!0})],Pt.prototype,"allLayerViews",void 0),u([d()],Pt.prototype,"groundView",void 0),u([d()],Pt.prototype,"animation",void 0),u([d()],Pt.prototype,"basemapView",void 0),u([d({readOnly:!0})],Pt.prototype,"_defaultsFromMapSettings",null),u([d()],Pt.prototype,"defaultsFromMap",null),u([d()],Pt.prototype,"fatalError",void 0),u([d({type:ui})],Pt.prototype,"extent",void 0),u([d(AG(EO,"graphics"))],Pt.prototype,"graphics",void 0),u([d(AG(W2,"analyses"))],Pt.prototype,"analyses",void 0),u([d({readOnly:!0,type:O_})],Pt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Pt.prototype,"interacting",null),u([d({readOnly:!0})],Pt.prototype,"navigating",void 0),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Pt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Pt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:it,readOnly:!0})],Pt.prototype,"layerViews",void 0),u([d({type:k_e})],Pt.prototype,"magnifier",void 0),u([d({value:null,type:F_e})],Pt.prototype,"map",null),u([d()],Pt.prototype,"padding",void 0),u([d({readOnly:!0})],Pt.prototype,"ready",void 0),u([d({type:Ze})],Pt.prototype,"spatialReference",null),u([d()],Pt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Pt.prototype,"stationary",null),u([d({readOnly:!0})],Pt.prototype,"supportsGround",void 0),u([d({type:Em})],Pt.prototype,"timeExtent",void 0),u([qe("toolViewManager.tools")],Pt.prototype,"tools",void 0),u([d()],Pt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Pt.prototype,"type",void 0),u([d({type:Number})],Pt.prototype,"scale",void 0),u([d({readOnly:!0})],Pt.prototype,"updating",void 0),u([d({readOnly:!0})],Pt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Pt.prototype,"initialExtent",null),u([d()],Pt.prototype,"cursor",null),u([d({readOnly:!0})],Pt.prototype,"input",void 0),u([d({type:j_e,nonNullable:!0})],Pt.prototype,"navigation",void 0),u([d()],Pt.prototype,"layerViewManager",void 0),u([d()],Pt.prototype,"analysisViewManager",void 0),u([d()],Pt.prototype,"width",void 0),u([d()],Pt.prototype,"height",void 0),u([d({readOnly:!0})],Pt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Pt.prototype,"size",null),u([d({readOnly:!0})],Pt.prototype,"suspended",void 0),u([d({readOnly:!0})],Pt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Pt.prototype,"persistableViewModels",void 0),u([d()],Pt.prototype,"_isValid",void 0),u([d()],Pt.prototype,"_readyCycleForced",void 0),u([d()],Pt.prototype,"_currentSpatialReference",void 0),Pt=aN=u([P("esri.views.View")],Pt);const Wje=Pt;let H0=class extends IF{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new q("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=Bu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],H0.prototype,"done",null),u([d({readOnly:!0,type:String})],H0.prototype,"state",void 0),u([d()],H0.prototype,"target",void 0),H0=u([P("esri.views.ViewAnimation")],H0),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(H0||(H0={}));const sE=H0,VC=()=>import("./TileLayerView3D.c83356a6.js"),Jre=()=>import("./ElevationLayerView3D.824cd5b8.js"),Kre={"base-dynamic":()=>import("./BaseDynamicLayerView3D.8fb1ff13.js"),"base-elevation":Jre,"base-tile":VC,"bing-maps":VC,"building-scene":()=>import("./BuildingSceneLayerView3D.ef76b74a.js"),csv:()=>import("./CSVLayerView3D.893f5be0.js"),elevation:Jre,feature:()=>import("./FeatureLayerView3D.210fbe0e.js"),geojson:()=>import("./GeoJSONLayerView3D.2e145e61.js"),graphics:()=>import("./GraphicsLayerView3D.87758d3d.js"),group:()=>import("./GroupLayerView.032ed206.js"),imagery:()=>import("./ImageryLayerView3D.21c2b42d.js"),"integrated-mesh":()=>import("./IntegratedMeshLayerView3D.26f1cccd.js"),"line-of-sight":()=>import("./LineOfSightLayerView3D.19a8d683.js"),"map-image":()=>import("./MapImageLayerView3D.5f685ef2.js"),media:()=>import("./MediaLayerView3D.5debc6f3.js"),"ogc-feature":()=>import("./OGCFeatureLayerView3D.716c2abc.js"),"open-street-map":VC,"point-cloud":()=>import("./PointCloudLayerView3D.ec1da80a.js").then(function(e){return e.P}),voxel:()=>import("./VoxelLayerView3D.e43f3e31.js"),route:()=>import("./RouteLayerView3D.e5ebbfc6.js"),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?import("./SceneLayerView3D.355e9aa5.js"):import("./SceneLayerGraphicsView3D.0391f432.js"),stream:()=>import("./StreamLayerView3D.efaea31b.js"),tile:VC,"imagery-tile":()=>import("./ImageryTileLayerView3D.0970c848.js"),"vector-tile":()=>import("./VectorTileLayerView3D.afbb3c66.js"),wcs:()=>import("./ImageryTileLayerView3D.0970c848.js"),"web-tile":VC,wfs:()=>import("./WFSLayerView3D.7c6e0f69.js"),wms:()=>import("./WMSLayerView3D.d2546402.js"),wmts:()=>import("./WMTSLayerView3D.d4e37215.js"),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function Xje(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new q(`${i}:view-not-supported`,`${t} is not supported in 3D`)}const ese={hasLayerViewModule:e=>_(Kre[e.type]),importLayerView:e=>{const t=Kre[e.type];if(M(t))throw Xje(e);return t(e)}},Yje=ge.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),tse="analyses-owner-handles";var IS,Ob;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(IS||(IS={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(Ob||(Ob={}));let tb=class extends Aw{constructor(e){super(e),this._allAnalysisViews=new it,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=bp(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(hi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(hi()),this._attachedToViewResolver=bp(),this._attachedToViewResolver.promise.catch(()=>{})}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(M(t)||t.state.list===Ob.REMOVED)throw new q("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),tse)}_disconnectOwners(){this.handles.remove(tse),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return{remove:()=>{t.remove(),i.remove();for(const r of e)this._removeAnalysis(r)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const i={state:{view:IS.PENDING,list:Ob.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=RP(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=Ob.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=Ob.REMOVED,this._scheduleUpdate()):Yje.error("Trying to remove analysis which was not added")}_scheduleUpdate(){_(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=ix(()=>this._update()))}_update(){this._scheduledUpdateHandle=Vs(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Ob.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case IS.PENDING:e.createAnalysisViewTask=Xh(e.createAnalysisViewTask);break;case IS.CREATED:_(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=lt(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,M(s.module))try{s.module=await this._loadAnalysisModule(r)}catch(o){throw this._creatingViewCount-=1,o}if(nn(t))throw this._creatingViewCount-=1,hi("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(nn(t))throw this._creatingViewCount-=1,n.destroy(),hi("AnalysisView creation aborted");return e.view=n,e.state.view=IS.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return import("./AreaMeasurementAnalysisView3D.600dd275.js").then(function(t){return t.A});case"dimensioning":return import("./DimensioningAnalysisView3D.39949aa9.js").then(function(t){return t.D});case"direct-line-measurement":return import("./DirectLineMeasurementAnalysisView3D.3817779f.js").then(function(t){return t.D});case"line-of-sight":return import("./LineOfSightAnalysisView3D.06dcdc19.js");case"slice":return import("./SliceAnalysisView3D.0fbf66a2.js").then(function(t){return t.S})}}};u([d()],tb.prototype,"updating",null),u([d({constructOnly:!0})],tb.prototype,"view",void 0),u([d()],tb.prototype,"_allAnalysisViews",void 0),u([d()],tb.prototype,"_creatingViewCount",void 0),tb=u([P("esri.views.3d.analysis.AnalysisViewManager3D")],tb);const Zje=tb,Qje=ge.getLogger("esri.views.3d.state.Constraints");let hg=class extends Se{constructor(e){super(e),this.collision=new OM,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===Ve.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ve.Local?this._set("altitude",e):Qje.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?De(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return De(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ve.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=sV)=>(i.min=Lo.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?EL([[4e3,Lo.max],[1e4,Dt(88)],[6e6,Dt(88)]]):()=>Lo.max;return(t,i=sV)=>(i.min=Lo.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?EL([[4e3,Lo.max],[5e4,Dt(88)],[6e6,Dt(88)],[2e7,Lo.min]]):EL([[3e5,Lo.max],[3e6,Dt(88)],[6e6,Dt(88)],[2e7,Lo.min]]);return(t,i=sV)=>(i.min=Lo.min,i.max=e(t),i)}};function Jje(e){return{min:-2e5,max:4*e.radius}}u([d()],hg.prototype,"altitude",null),u([d({readOnly:!0})],hg.prototype,"collision",void 0),u([d()],hg.prototype,"distance",void 0),u([d({readOnly:!0})],hg.prototype,"minimumPoiDistance",void 0),u([d()],hg.prototype,"tilt",void 0),u([d({constructOnly:!0})],hg.prototype,"mode",void 0),hg=u([P("esri.views.3d.state.Constraints")],hg);const ise=Jje(Ri),Lo={min:Dt(.5),max:Dt(179.5)},sV={min:0,max:0};let OM=class extends Se{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],OM.prototype,"enabled",void 0),u([d({type:Number})],OM.prototype,"elevationMargin",void 0),OM=u([P("esri.views.3d.state.Constraints.CollisionConstraint")],OM);let $S=class extends Se{constructor(){super(...arguments),this.min=ise.min,this.max=ise.max}};u([d({type:Number})],$S.prototype,"min",void 0),u([d({type:Number})],$S.prototype,"max",void 0),$S=u([P("esri.views.3d.constraints.AltitudeConstraint")],$S);let Cg=class extends Se{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],Cg.prototype,"near",null),u([Rt("near")],Cg.prototype,"castNear",null),u([d({type:Number,value:1e-8})],Cg.prototype,"far",null),u([Rt("far")],Cg.prototype,"castFar",null),u([d({type:["auto","manual"]})],Cg.prototype,"mode",void 0),Cg=u([P("esri.views.3d.constraints.ClipDistanceConstraint")],Cg);const Kj={min:Sc(Lo.min),max:Sc(Lo.max)};let Rb=class extends Se{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return De(e,Kj.min,Kj.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],Rb.prototype,"mode",void 0),u([d({type:Number,value:Kj.max})],Rb.prototype,"max",null),u([Rt("max")],Rb.prototype,"castMax",null),Rb=u([P("esri.views.3d.constraints.TiltConstraint")],Rb);let Pb=class extends Se{constructor(){super(...arguments),this.tilt=new Rb,this.altitude=new $S,this.clipDistance=new Cg}};u([d({type:Rb})],Pb.prototype,"tilt",void 0),u([d({type:$S})],Pb.prototype,"altitude",void 0),u([d({type:Cg})],Pb.prototype,"clipDistance",void 0),Pb=u([P("esri.views.3d.constraints.Constraints")],Pb);var eH;let fh=eH=class extends ve{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new eH(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],fh.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],fh.prototype,"date",void 0),u([Ue("date",["datetime"])],fh.prototype,"readDate",null),u([Be("date")],fh.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],fh.prototype,"directShadowsEnabled",void 0),u([Ue("directShadowsEnabled",["directShadows"])],fh.prototype,"readDirectShadowsEnabled",null),u([Be("directShadowsEnabled")],fh.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],fh.prototype,"displayUTCOffset",void 0),u([Be("displayUTCOffset")],fh.prototype,"writeDisplayUTCOffset",null),fh=eH=u([P("esri.webscene.SunLighting")],fh);const Dw=fh;var JT;let ff=JT=class extends as.EventedMixin(Dw){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new JT(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=JT.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=JT.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(nV.target=this,nV.timezoneOffset=s,this.emit("timezone-will-change",nV)),e!=null)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new JT(me(F({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};u([d({type:Boolean})],ff.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],ff.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],ff.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],ff.prototype,"defaultDate",null),u([d({type:Date})],ff.prototype,"date",null),ff=JT=u([P("esri.views.3d.environment.SunLighting")],ff),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(ff||(ff={}));const nV={target:null,timezoneOffset:0},$f=ff;var tH;let RM=tH=class extends ve{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new tH(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],RM.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],RM.prototype,"directShadowsEnabled",void 0),RM=tH=u([P("esri.webscene.VirtualLighting")],RM);const r3=RM;var lN;let PM=lN=class extends as.EventedMixin(r3){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new lN(me(F({},this.cloneConstructProperties()),{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}))}static fromWebsceneLighting(e){return new lN(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};u([d({type:Boolean})],PM.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],PM.prototype,"waterReflectionEnabled",void 0),PM=lN=u([P("esri.views.3d.environment.VirtualLighting")],PM);const DS=PM,Kje={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:$f,virtual:DS}};var iH;let CO=iH=class extends Se{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new iH({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],CO.prototype,"quality",null),CO=iH=u([P("esri.views.3d.environment.SceneViewAtmosphere")],CO);var rH;let IM=rH=class extends ve{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new rH({cloudCover:this.cloudCover})}};u([ut({sunny:"sunny"})],IM.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],IM.prototype,"cloudCover",void 0),IM=rH=u([P("esri.views.3d.environment.SunnyWeather")],IM);const OR=IM;var sH;let $M=sH=class extends ve{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new sH({cloudCover:this.cloudCover})}};u([ut({cloudy:"cloudy"})],$M.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$M.prototype,"cloudCover",void 0),$M=sH=u([P("esri.views.3d.environment.CloudyWeather")],$M);const Q_e=$M;var nH;let DM=nH=class extends ve{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new nH({fogStrength:this.fogStrength})}};u([ut({foggy:"foggy"})],DM.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],DM.prototype,"fogStrength",void 0),DM=nH=u([P("esri.views.3d.environment.FoggyWeather")],DM);const J_e=DM;var oH;let KT=oH=class extends ve{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new oH({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([ut({rainy:"rainy"})],KT.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],KT.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],KT.prototype,"precipitation",void 0),KT=oH=u([P("esri.views.3d.environment.RainyWeather")],KT);const K_e=KT;var aH;let ib=aH=class extends ve{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new aH({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([ut({snowy:"snowy"})],ib.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ib.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ib.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],ib.prototype,"snowCover",void 0),ib=aH=u([P("esri.views.3d.environment.SnowyWeather")],ib);const e1e=ib,mZ={key:"type",base:OR,typeMap:{sunny:OR,cloudy:Q_e,rainy:K_e,snowy:e1e,foggy:J_e}},t1e=Object.keys(mZ.typeMap);function i1e(e,t){return!!t1e.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const Ah=1e4,r1e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Dw,virtual:r3}};let cN=class extends ve{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],cN.prototype,"type",void 0),cN=u([P("esri.webscene.background.Background")],cN);const s1e=cN;var lH;const eHe=me(F({},xy),{nonNullable:!0});let LM=lH=class extends s1e{constructor(e){super(e),this.type="color",this.color=new We([0,0,0,1])}clone(){return new lH(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([ut({color:"color"},{readOnly:!0})],LM.prototype,"type",void 0),u([d(eHe)],LM.prototype,"color",void 0),LM=lH=u([P("esri.webscene.background.ColorBackground")],LM);const n1e=LM,rse={base:s1e,key:"type",typeMap:{color:n1e}};function tHe(e){return(t,i,r)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,r),n}}}const iHe={types:rse,json:{read:tHe(rse),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var cH;const rHe=ge.getLogger("esri.webscene.Environment"),sse=(e,t,i)=>({enabled:!i||!i.isPresentation});let q0=cH=class extends ve{constructor(e){super(e),this.lighting=new Dw,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){i1e(e==null?void 0:e.type,rHe)&&this._set("weather",e)}clone(){return new cH(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?r3.prototype.clone.call(this.lighting):Dw.prototype.clone.call(this.lighting),background:ie(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:r1e,nonNullable:!0,json:{write:!0}})],q0.prototype,"lighting",void 0),u([d(iHe)],q0.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:sse}}})],q0.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:sse}}})],q0.prototype,"starsEnabled",void 0),u([d({types:mZ,nonNullable:!0,json:{write:!0},value:new OR})],q0.prototype,"weather",null),q0=cH=u([P("esri.webscene.Environment")],q0);const nE=q0;var NM;let eS=NM=class extends nE{constructor(e){super(e),this.atmosphere=new CO,this.lighting=new $f}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new NM(me(F({},t),{lighting:t.lighting.type==="virtual"?DS.fromWebsceneLighting(t.lighting):$f.fromWebsceneLighting(t.lighting)}))}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof $f||e instanceof DS?e:e instanceof Dw?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e):new $f(e.cloneConstructProperties()):e instanceof r3?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new DS(e.cloneConstructProperties()):wp(Kje,e):new $f}clone(){return new NM({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ie(this.background)})}cloneWithWebsceneEnvironment(e){return new NM(me(F({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ie(this.background)},e.cloneConstructProperties()),{lighting:this._getLighting(e)}))}_getLighting(e){return e.lighting.type==="sun"?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):$f.fromWebsceneLighting(e.lighting):e.lighting.type==="virtual"?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):DS.fromWebsceneLighting(e.lighting):$f.fromWebsceneLighting(e.lighting)}};u([d({type:CO,json:{read:!1},nonNullable:!0})],eS.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],eS.prototype,"lighting",void 0),u([Rt("lighting")],eS.prototype,"castLighting",null),eS=NM=u([P("esri.views.3d.environment.SceneViewEnvironment")],eS);const tS=eS;function _o(e,t){return e[0]=t[0],e[1]=t[1],e}function di(e,t,i){return e[0]=t,e[1]=i,e}function Wd(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function zf(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function o1e(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function a1e(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function sHe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function nHe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function oHe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function aHe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function lHe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function dc(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function cHe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function gZ(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function y4(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function yZ(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function l1e(e){const t=e[0],i=e[1];return t*t+i*i}function vZ(e,t){return e[0]=-t[0],e[1]=-t[1],e}function uHe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function RR(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function en(e,t){return e[0]*t[0]+e[1]*t[1]}function hHe(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function iS(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function dHe(e,t){t=t||1;const i=2*sp()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function uH(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function rb(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function pHe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function fHe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function mHe(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function gHe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function yHe(e){return"vec2("+e[0]+", "+e[1]+")"}function c1e(e,t){return e[0]===t[0]&&e[1]===t[1]}function vHe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];return Math.abs(i-s)<=Et*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=Et*Math.max(1,Math.abs(r),Math.abs(n))}function _He(e,t,i,r,s){let n=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const bHe=yZ,wHe=zf,xHe=o1e,THe=a1e,u1e=gZ,SHe=y4,EHe=l1e;Object.freeze(Object.defineProperty({__proto__:null,copy:_o,set:di,add:Wd,subtract:zf,multiply:o1e,divide:a1e,ceil:sHe,floor:nHe,min:oHe,max:aHe,round:lHe,scale:dc,scaleAndAdd:cHe,distance:gZ,squaredDistance:y4,length:yZ,squaredLength:l1e,negate:vZ,inverse:uHe,normalize:RR,dot:en,cross:hHe,lerp:iS,random:dHe,transformMat2:uH,transformMat2d:rb,transformMat3:pHe,transformMat4:fHe,rotate:mHe,angle:gHe,str:yHe,exactEquals:c1e,equals:vHe,projectAndScale:_He,len:bHe,sub:wHe,mul:xHe,div:THe,dist:u1e,sqrDist:SHe,sqrLen:EHe},Symbol.toStringTag,{value:"Module"}));function h1e(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const hH=1e4,Ox=Fe(5802e-9,13558e-9,331e-7),oV=3,aV=Fe(65e-8*oV,1881e-9*oV,85e-9*oV),CHe=3996e-9,AHe=.085,uN=1e5;class Ys{}function x(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}(function(e){function t(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}e.int=t,e.float=i})(x||(x={}));var O;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(O||(O={}));var ln;function Yg(e,t){switch(t.textureCoordinateType){case ln.Default:return e.attributes.add(O.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case ln.Atlas:return e.attributes.add(O.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(O.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case ln.None:return void e.vertex.code.add(x`void forwardTextureCoordinates() {}`);default:t.textureCoordinateType;case ln.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(ln||(ln={}));function $c(e){e.code.add(x`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function zu(e){e.include($c),e.code.add(x`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function Vk(e){e.fragment.code.add(x`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Ui;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(Ui||(Ui={}));class Jr{constructor(t,i,r,s,n=null){this.name=t,this.type=i,this.arraySize=n,this.bind={[Ui.Pass]:null,[Ui.Draw]:null},_(r)&&_(s)&&(this.bind[r]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class pi extends Jr{constructor(t,i){super(t,"vec2",Ui.Pass,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class Zg extends Jr{constructor(t){super(t,"vec2")}}class xt extends Jr{constructor(t,i){super(t,"vec3",Ui.Pass,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class xl extends Jr{constructor(t){super(t,"vec3")}}class Ua extends Jr{constructor(t){super(t,"vec4")}}class Fi extends Jr{constructor(t){super(t,"float")}}class Er extends Jr{constructor(t,i){super(t,"mat4",Ui.Pass,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}const MHe=ge.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class d1e{constructor(){this.includedModules=new Map}include(t,i){if(this.includedModules.has(t)){const r=this.includedModules.get(t);if(r!==i){MHe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))r[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${t[n]}`))}}else this.includedModules.set(t,i),t(this.builder,i)}}class qi extends d1e{constructor(){super(...arguments),this.vertex=new nse,this.fragment=new nse,this.attributes=new PHe,this.varyings=new IHe,this.extensions=new oE,this.constants=new ws}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const i=this.extensions.generateSource(t),r=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?DHe:$He,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a)=>{for(let l=0;l<n;++l)s[l](i,o,a)}}}class OHe{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const i of t)this._add(i)}_add(t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new q(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}generateSource(){return Array.from(this._entries.values()).map(t=>_(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class RHe{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class nse extends d1e{constructor(){super(...arguments),this.uniforms=new OHe,this.code=new RHe,this.constants=new ws}get builder(){return this}}class PHe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(t){return t==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}}class IHe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class oE{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const i=t==="vertex"?oE.ALLOWLIST_VERTEX:oE.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}}oE.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],oE.ALLOWLIST_VERTEX=[];class ws{constructor(){this._entries=new Set}add(t,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=ws._numberToFloatStr(r);break;case"int":s=ws._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${ws._numberToFloatStr(r[0])},                            ${ws._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${ws._numberToFloatStr(r[0])},                            ${ws._numberToFloatStr(r[1])},                            ${ws._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${ws._numberToFloatStr(r[0])},                            ${ws._numberToFloatStr(r[1])},                            ${ws._numberToFloatStr(r[2])},                            ${ws._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${ws._numberToIntStr(r[0])},                             ${ws._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${ws._numberToIntStr(r[0])},                             ${ws._numberToIntStr(r[1])},                             ${ws._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${ws._numberToIntStr(r[0])},                             ${ws._numberToIntStr(r[1])},                             ${ws._numberToIntStr(r[2])},                             ${ws._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>ws._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const $He=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,DHe=`precision highp float;
precision highp sampler2D;`;class Vr extends Jr{constructor(t){super(t,"sampler2D")}}function LHe(e){const t=new qi;t.attributes.add(O.POSITION,"vec2"),t.include(Yg,{textureCoordinateType:ln.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Er("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Er("inverseViewMatrix",(s,n)=>vs(NHe,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new xt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Zg("radii"),new Fi("scaleHeight"),new xl("cameraPosition"),new Ua("heightParameters"),new Fi("innerFadeDistance"),new Fi("altitudeFade"),new Vr("depthTex"),new xl("betaRayleigh"),new xl("betaCombined"),new Fi("betaMie"),new Fi("hazeStrength")]),t.include(Vk),e.haze&&(r.include(zu),r.uniforms.add(new pi("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(x`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(x`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?x`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?x``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":x`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?x`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?x`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:x`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?x`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:x`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":x`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const NHe=Ae(),FHe=Object.freeze(Object.defineProperty({__proto__:null,build:LHe},Symbol.toStringTag,{value:"Module"}));class sr{constructor(t,i){this._module=t,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var tr,It,Me,py,wt,hp,aE,dt,yr,os,tt,bt,mt,ze,gt,St,La,_i,gu,Fn,ss,Ai;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(tr||(tr={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(It||(It={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Me||(Me={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(py||(py={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(wt||(wt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(hp||(hp={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(aE||(aE={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(dt||(dt={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(yr||(yr={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(os||(os={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(tt||(tt={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(bt||(bt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(mt||(mt={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ze||(ze={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(gt||(gt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(St||(St={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(La||(La={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(_i||(_i={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(gu||(gu={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Fn||(Fn={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(ss||(ss={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Ai||(Ai={}));const lV=33984;var Tn,su;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(Tn||(Tn={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(su||(su={}));const ose=33306;var is,ase,lse,cse,v4,dH,use;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(is||(is={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(ase||(ase={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(lse||(lse={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(cse||(cse={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(v4||(v4={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(dH||(dH={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(use||(use={}));class fr{constructor(t,i,r){this.release=r,i&&(this.initializeConfiguration(t,i),this._configuration=i.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=Qe(this._program),this._pipeline=this._configuration=null}reload(t){Qe(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(t,i){this.program.bindPass(t,i)}bindDraw(t,i){this.program.bindDraw(t,i),this.program.rebindTextures()}bindPipelineState(t,i=null,r){t.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return It.TRIANGLES}getPipelineState(t,i){return this._pipeline}initializeConfiguration(t,i){}}const zi=new Map([[O.POSITION,0],[O.NORMAL,1],[O.UV0,2],[O.COLOR,3],[O.SIZE,4],[O.TANGENT,4],[O.AUXPOS1,5],[O.SYMBOLCOLOR,5],[O.AUXPOS2,6],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.MODEL,8],[O.MODELNORMAL,12],[O.MODELORIGINHI,11],[O.MODELORIGINLO,15]]),kHe=ge.getLogger("esri/views/webgl");function UHe(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const p1e=!!he("enable-feature:webgl-debug");function xh(){return p1e}function PR(){return p1e}function Nv(e){if(xh()){const t=e.getError();if(t){const i=UHe(e,t),r=new Error().stack;kHe.error(new q("webgl-error","WebGL error occured",{message:i,stack:r}))}}}class nr{constructor(t,i,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Gt({deallocator:null}),this._glProgram=t.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(Ui.Pass,this),this.bindDraw=i.generateBind(Ui.Draw,this),this._fragmentUniforms=xh()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,i){this._glProgram.setUniform1i(t,i?1:0)}setUniform1i(t,i){this._glProgram.setUniform1i(t,i)}setUniform1f(t,i){this._glProgram.setUniform1f(t,i)}setUniform2f(t,i,r){this._glProgram.setUniform2f(t,i,r)}setUniform2fv(t,i){this._glProgram.setUniform2fv(t,i)}setUniform3f(t,i,r,s){this._glProgram.setUniform3f(t,i,r,s)}setUniform3fv(t,i){this._glProgram.setUniform3fv(t,i)}setUniform4f(t,i,r,s,n){this._glProgram.setUniform4f(t,i,r,s,n)}setUniform4fv(t,i){this._glProgram.setUniform4fv(t,i)}setUniformMatrix3fv(t,i){this._glProgram.setUniformMatrix3fv(t,i)}setUniformMatrix4fv(t,i){this._glProgram.setUniformMatrix4fv(t,i)}setUniform1fv(t,i){this._glProgram.setUniform1fv(t,i)}setUniform1iv(t,i){this._glProgram.setUniform1iv(t,i)}setUniform2iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform3iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform4iv(t,i){this._glProgram.setUniform4iv(t,i)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,i){if(M(i)||i.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let r=this._textures.get(t);return r==null?(r=this._allocTextureUnit(i),this._textures.set(t,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,i)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(i,t.unit)}),_(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var dr,Lw,Ib,vt,ks,ac,Cl,lE,fy,Al,Zv,cE,ur,Nw;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(dr||(dr={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(Lw||(Lw={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(Ib||(Ib={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(vt||(vt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(ks||(ks={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(ac||(ac={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Cl||(Cl={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(lE||(lE={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(fy||(fy={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(Al||(Al={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(Zv||(Zv={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(cE||(cE={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(ur||(ur={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(Nw||(Nw={}));function Am(e,t,i=py.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function bo(e,t,i,r,s=py.ADD,n=py.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const _Z={face:hp.BACK,mode:aE.CCW},f1e={face:hp.FRONT,mode:aE.CCW},Bk=e=>e===dr.Back?_Z:e===dr.Front?f1e:null,Il={zNear:0,zFar:1},ti={r:!0,g:!0,b:!0,a:!0};function zHe(e){return XHe.intern(e)}function VHe(e){return YHe.intern(e)}function BHe(e){return ZHe.intern(e)}function GHe(e){return QHe.intern(e)}function jHe(e){return JHe.intern(e)}function HHe(e){return KHe.intern(e)}function qHe(e){return eqe.intern(e)}function WHe(e){return tqe.intern(e)}function Ut(e){return iqe.intern(e)}class Cy{constructor(t,i){this.makeKey=t,this.makeRef=i,this.interns=new Map}intern(t){if(!t)return null;const i=this.makeKey(t),r=this.interns;return r.has(i)||r.set(i,this.makeRef(t)),r.get(i)}}function Ay(e){return"["+e.join(",")+"]"}const XHe=new Cy(m1e,e=>F({__tag:"Blending"},e));function m1e(e){return e?Ay([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const YHe=new Cy(g1e,e=>F({__tag:"Culling"},e));function g1e(e){return e?Ay([e.face,e.mode]):null}const ZHe=new Cy(y1e,e=>F({__tag:"PolygonOffset"},e));function y1e(e){return e?Ay([e.factor,e.units]):null}const QHe=new Cy(v1e,e=>F({__tag:"DepthTest"},e));function v1e(e){return e?Ay([e.func]):null}const JHe=new Cy(_1e,e=>F({__tag:"StencilTest"},e));function _1e(e){return e?Ay([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const KHe=new Cy(b1e,e=>F({__tag:"DepthWrite"},e));function b1e(e){return e?Ay([e.zNear,e.zFar]):null}const eqe=new Cy(w1e,e=>F({__tag:"ColorWrite"},e));function w1e(e){return e?Ay([e.r,e.g,e.b,e.a]):null}const tqe=new Cy(x1e,e=>F({__tag:"StencilWrite"},e));function x1e(e){return e?Ay([e.mask]):null}const iqe=new Cy(rqe,e=>({blending:zHe(e.blending),culling:VHe(e.culling),polygonOffset:BHe(e.polygonOffset),depthTest:GHe(e.depthTest),stencilTest:jHe(e.stencilTest),depthWrite:HHe(e.depthWrite),colorWrite:qHe(e.colorWrite),stencilWrite:WHe(e.stencilWrite)}));function rqe(e){return e?Ay([m1e(e.blending),g1e(e.culling),y1e(e.polygonOffset),v1e(e.depthTest),_1e(e.stencilTest),b1e(e.depthWrite),w1e(e.colorWrite),x1e(e.stencilWrite)]):null}class sqe{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,i,r,s){return(r||t!==i)&&(s(t),this._pipelineInvalid=!0),t}}class IR extends fr{initializeProgram(t){const i=IR.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return this.configuration.haze?Ut({blending:bo(Me.ONE,Me.ZERO,Me.ONE_MINUS_SRC_COLOR,Me.ONE),colorWrite:ti}):Ut({blending:bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:yr.LEQUAL},colorWrite:ti})}}IR.shader=new sr(FHe,()=>import("./ChapmanAtmosphere.glsl.055e2942.js"));class Ha{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,i={key:this.key};for(const r of t)i[r]=this[r];return i}}function j(e={}){return(t,i)=>{var r,s;if(t._parameterNames=(r=t._parameterNames)!=null?r:[],t._parameterNames.push(i),e.constValue!=null)Object.defineProperty(t,i,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,i,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<h&p,typeof f!="number"&&typeof f!="boolean"))throw"Configuration value for "+i+" must be boolean or number, got "+typeof f}})}}}class T1e extends Ha{constructor(){super(...arguments),this.haze=!1}}u([j()],T1e.prototype,"haze",void 0);class go{constructor(t,i,r,s,n,o=!1,a=0){this.name=t,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new go(O.POSITION,3,dt.FLOAT,0,12);new go(O.POSITION,3,dt.FLOAT,0,20),new go(O.UV0,2,dt.FLOAT,12,20);new go(O.POSITION,3,dt.FLOAT,0,32),new go(O.NORMAL,3,dt.FLOAT,12,32),new go(O.UV0,2,dt.FLOAT,24,32);new go(O.POSITION,3,dt.FLOAT,0,16),new go(O.COLOR,4,dt.UNSIGNED_BYTE,12,16);const bZ=[new go(O.POSITION,2,dt.FLOAT,0,8)],s3=[new go(O.POSITION,2,dt.FLOAT,0,16),new go(O.UV0,2,dt.FLOAT,8,16)];var li;function nqe(e,t,i={}){const r=S1e(e);for(;r.length>1;){const s=_4(t,r.shift(),i);if(_(s))return s}return oqe(t,r.shift(),i)}function S1e(e){const t=he("esri-force-webgl");if(t===li.WEBGL1||t===li.WEBGL2)return[t];switch(e){case"2d":return he("mac")&&he("chrome")?[li.WEBGL1,li.WEBGL2]:[li.WEBGL2,li.WEBGL1];case"3d":return[li.WEBGL2,li.WEBGL1]}}function oqe(e,t,i={}){if(!window.WebGLRenderingContext)return hse(e,aqe),null;const r=_4(e,t,i);return M(r)&&hse(e,lqe),r}function _4(e,t,i={}){const r=t===li.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=e.getContext(n,i)}catch{}if(s)break}return s}function hse(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(li||(li={}));const aqe='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',lqe=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,Nc=ge.getLogger("esri.views.webgl.BufferObject");function cqe(e){return ICe(e)}class si{constructor(t,i,r,s){this._context=t,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(Tn.BufferObject,this),this._glName=this._context.gl.createBuffer(),Nv(this._context.gl),s&&this.setData(s)}static createIndex(t,i,r){return new si(t,wt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(t,i,r){return new si(t,wt.ARRAY_BUFFER,i,r)}static createUniform(t,i,r){if(t.type!==li.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new si(t,wt.UNIFORM_BUFFER,i,r)}static createPixelPack(t,i=_i.STREAM_READ,r){if(t.type!==li.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new si(t,wt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(t,i=_i.STREAM_DRAW,r){if(t.type!==li.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new si(t,wt.PIXEL_UNPACK_BUFFER,i,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER?this._indexType===dt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER||this.bufferType===wt.ARRAY_BUFFER}dispose(){var t;((t=this._context)==null?void 0:t.gl)?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Tn.BufferObject,this),this._context=null):this._glName&&Nc.warn("Leaked WebGL buffer object")}setSize(t,i=null){if(t<=0&&Nc.error("Buffer size needs to be positive!"),this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&_(i))switch(this._indexType=i,i){case dt.UNSIGNED_SHORT:t*=2;break;case dt.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let i=t.byteLength;this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&(oF(t)&&(i/=2,this._indexType=dt.UNSIGNED_SHORT),aF(t)&&(i/=4,this._indexType=dt.UNSIGNED_INT)),this._setBufferData(i,t)}_setBufferData(t,i=null){this._size=t;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;_(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,t,this.usage),Nv(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(t,i=0,r=0,s=t.byteLength){if(!t)return;(i<0||i>=this._size)&&Nc.error("offset is out of range!");let n=i,o=r,a=s,l=t.byteLength;this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&(oF(t)?(l/=2,n*=2,o*=2,a*=2):aF(t)&&(l/=4,n*=4,o*=4,a*=4)),s===void 0&&(s=l-1),r>=s&&Nc.error("end must be bigger than start!"),i+r-s>this._size&&Nc.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,p=ArrayBuffer.isView(t)?t.buffer:t,f=o===0&&a===t.byteLength?p:p.slice(o,a);h.bufferSubData(this.bufferType,n,f),Nv(h),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(t,i,r,s){if(!t)return;(i<0||i>=this._size)&&Nc.error("offset is out of range!"),r>=s&&Nc.error("end must be bigger than start!"),i+r-s>this._size&&Nc.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===li.WEBGL2)o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,t,r,s-r);else{const a=r===0&&s===t.length?t:t.subarray(r,s);o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,a)}Nv(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,i=0,r,s){if(this._context.type!==li.WEBGL2)return void Nc.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void Nc.error("Problem getting subdata: offset and length were less than zero!");const n=cqe(t)?t.BYTES_PER_ELEMENT:1;if(n*((r!=null?r:0)+(s!=null?s:0))>t.byteLength)return void Nc.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s!=null?s:0)>this.byteSize&&Nc.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,wt.COPY_READ_BUFFER),o.getBufferSubData(wt.COPY_READ_BUFFER,i,t,r,s),this._context.unbindBuffer(wt.COPY_READ_BUFFER)}async getSubDataAsync(t,i=0,r,s){this._context.type===li.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,i,r,s)):Nc.error("Get buffer subdata is supported in WebGL2 only!")}}function zn(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const dse=4;class ot{constructor(t,i,r=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(Tn.Texture,this),this._descriptor=F({target:mt.TEXTURE_2D,samplingMode:tt.LINEAR,wrapMode:bt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},i),t.type!==li.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),W_(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===mt.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Tn.Texture,this))}release(){this.dispose()}resize(t,i){const r=this._descriptor;if(r.width!==t||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=t,r.height=i,this._descriptor.target===mt.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let i=mt.TEXTURE_CUBE_MAP_POSITIVE_X;i<=mt.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(t,i)}setData(t){this._setData(t)}_setData(t,i){var c;if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),t===void 0&&(t=null);const s=this._descriptor;i!=null||(i=s.target);const n=W_(i);t===null&&(s.width=s.width||dse,s.height=s.height||dse,n&&(s.depth=(c=s.depth)!=null?c:1));const o=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),ot._validateTexture(this._context,s),this._configurePixelStorage();const a=s.pixelFormat;let l=s.internalFormat?s.internalFormat:this._deriveInternalFormat(a,s.dataType);if(cV(t)){let h=t.width,p=t.height;const f=1;t instanceof HTMLVideoElement&&(h=t.videoWidth,p=t.videoHeight),s.width&&s.height,n&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),this._texImage(i,0,l,h,p,f,t),Nv(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),n&&s.depth===void 0&&(s.depth=f)}else{const{width:h,height:p,depth:f}=s;if(h!=null&&p!=null||console.error("Width and height must be specified!"),n&&f==null&&console.error("Depth must be specified!"),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),r.DEPTH24_STENCIL8&&l===r.DEPTH_STENCIL&&(l=r.DEPTH24_STENCIL8),hN(t)){const m=t.levels,y=pse(i,h,p,f),v=Math.min(y-1,m.length-1);zn(r)?r.texParameteri(s.target,r.TEXTURE_MAX_LEVEL,v):s.hasMipmap=s.hasMipmap&&y===m.length;const w=l;if(!hqe(w))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((b,S,T,E)=>{const C=m[Math.min(b,m.length-1)];this._compressedTexImage(i,b,w,S,T,E,C)},v)}else _(t)?(this._texImage(i,0,l,h,p,f,t),Nv(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,y,v,w)=>{this._texImage(i,m,l,y,v,w,null),Nv(r)})}ot._applySamplingMode(r,this._descriptor),ot._applyWrapMode(r,this._descriptor),ot._applyAnisotropicFilteringParameters(this._context,this._descriptor),Nv(r),this._context.bindTexture(o,ot.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,i,r,s,n,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,internalFormat:h,dataType:p,isImmutable:f,target:m}=l;if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const y=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);(i<0||r<0||s>l.width||n>l.height||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),cV(o)?a.texSubImage2D(m,t,i,r,c,p,o):hN(o)?a.compressedTexSubImage2D(m,t,i,r,s,n,h,o.levels[t]):a.texSubImage2D(m,t,i,r,s,n,c,p,o),this._context.bindTexture(y,ot.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!zn(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:y,internalFormat:v}=h;if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");W_(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const w=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>h.width||o>h.height||a>h.depth||i+n>h.width||r+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),hN(l))l=l.levels[t],c.compressedTexSubImage3D(y,t,i,r,s,n,o,a,v,l);else{const b=l;c.texSubImage3D(y,t,i,r,s,n,o,a,p,f,b)}this._context.bindTexture(w,ot.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,ot._validateTexture(this._context,t)}t.samplingMode===tt.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=tt.LINEAR_MIPMAP_NEAREST):t.samplingMode===tt.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=tt.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(i,ot.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,ot._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(ot._applySamplingMode(t,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(ot._applyWrapMode(t,i),this._wrapModeDirty=!1)}_deriveInternalFormat(t,i){if(this._context.type===li.WEBGL1)return t;switch(i){case St.FLOAT:switch(t){case ze.RGBA:return gt.RGBA32F;case ze.RGB:return gt.RGB32F;default:throw new Error("Unable to derive format")}case St.UNSIGNED_BYTE:switch(t){case ze.RGBA:return gt.RGBA8;case ze.RGB:return gt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,i,r,s,n,o){const a=this._context.gl;if(!zn(a))throw new Error("Immutable textures are not supported in WebGL1");if(!uqe(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?pse(t,s,n,o):1;W_(t)?a.texStorage3D(t,l,i,s,n,o):a.texStorage2D(t,l,i,s,n),this._wasImmutablyAllocated=!0}_texImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===li.WEBGL2,p=W_(t),{isImmutable:f,pixelFormat:m,dataType:y}=this._descriptor;if(h&&(c=l),h||!cV(a))if(f){if(_(a)){const v=a;p?c.texSubImage3D(t,i,0,0,0,s,n,o,m,y,v):l.texSubImage2D(t,i,0,0,s,n,m,y,v)}}else{const v=a;p?c.texImage3D(t,i,r,s,n,o,0,m,y,v):l.texImage2D(t,i,r,s,n,0,m,y,v)}else l.texImage2D(t,0,r,m,y,a)}_compressedTexImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=W_(t),p=this._descriptor.isImmutable;if(h){if(this._context.type!==li.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}p?_(a)&&(h?c.compressedTexSubImage3D(t,i,0,0,0,s,n,o,r,a):l.compressedTexSubImage2D(t,i,0,0,s,n,r,a)):h?c.compressedTexImage3D(t,i,r,s,n,o,0,a):l.compressedTexImage2D(t,i,r,s,n,0,a)}_forEachMipmapLevel(t,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===mt.TEXTURE_3D;for(let c=0;t(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(t,i){(i.width<0||i.height<0||i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=zn(t.gl),s=A2(i.width)&&A2(i.height);r||!i.isImmutable&&!W_(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==bt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===bt.CLAMP_TO_EDGE&&i.wrapMode.t===bt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,i){let r=i.samplingMode,s=i.samplingMode;r===tt.LINEAR_MIPMAP_NEAREST||r===tt.LINEAR_MIPMAP_LINEAR?(r=tt.LINEAR,i.hasMipmap||(s=tt.LINEAR)):r!==tt.NEAREST_MIPMAP_NEAREST&&r!==tt.NEAREST_MIPMAP_LINEAR||(r=tt.NEAREST,i.hasMipmap||(s=tt.NEAREST)),t.texParameteri(i.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(i.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,i){typeof i.wrapMode=="number"?(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode)):(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode.s),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,i){var s;const r=t.capabilities.textureFilterAnisotropic;!r||t.gl.texParameterf(i.target,r.TEXTURE_MAX_ANISOTROPY,(s=i.maxAnisotropy)!=null?s:1)}}function uqe(e){return e in gt}function hqe(e){return e in is}function hN(e){return _(e)&&"type"in e&&e.type==="compressed"}function dqe(e){return _(e)&&"byteLength"in e}function cV(e){return _(e)&&!hN(e)&&!dqe(e)}function W_(e){return e===mt.TEXTURE_3D||e===mt.TEXTURE_2D_ARRAY}function pse(e,t,i,r=1){let s=Math.max(t,i);return e===mt.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}ot.TEXTURE_UNIT_FOR_UPDATES=0;function fse(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function ko(e,t){return e.vertexBuffers[t].size/pqe(e.layout[t])}function pqe(e){return e[0].stride}function wZ(e,t,i,r,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function xZ(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const o of r){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(wt.ARRAY_BUFFER)}function E1e(e){switch(e){case ze.ALPHA:case ze.LUMINANCE:case ze.RED:case ze.RED_INTEGER:case gt.R8:case gt.R8I:case gt.R8UI:case gt.R8_SNORM:case La.STENCIL_INDEX8:return 1;case ze.LUMINANCE_ALPHA:case ze.RG:case ze.RG_INTEGER:case gt.RGBA4:case gt.R16F:case gt.R16I:case gt.R16UI:case gt.RG8:case gt.RG8I:case gt.RG8UI:case gt.RG8_SNORM:case gt.RGB565:case gt.RGB5_A1:case La.DEPTH_COMPONENT16:return 2;case ze.DEPTH_COMPONENT:case ze.RGB:case ze.RGB_INTEGER:case gt.RGB8:case gt.RGB8I:case gt.RGB8UI:case gt.RGB8_SNORM:case gt.SRGB8:case La.DEPTH_COMPONENT24:return 3;case ze.DEPTH_STENCIL:case ze.RGBA:case ze.RGBA_INTEGER:case gt.RGBA8:case gt.R32F:case gt.R11F_G11F_B10F:case gt.RG16F:case gt.R32I:case gt.R32UI:case gt.RG16I:case gt.RG16UI:case gt.RGBA8I:case gt.RGBA8UI:case gt.RGBA8_SNORM:case gt.SRGB8_ALPHA8:case gt.RGB9_E5:case gt.RGB10_A2UI:case gt.RGB10_A2:case La.DEPTH_STENCIL:case La.DEPTH_COMPONENT32F:case La.DEPTH24_STENCIL8:return 4;case La.DEPTH32F_STENCIL8:return 5;case gt.RGB16F:case gt.RGB16I:case gt.RGB16UI:return 6;case gt.RG32F:case gt.RG32I:case gt.RG32UI:case gt.RGBA16F:case gt.RGBA16I:case gt.RGBA16UI:return 8;case gt.RGB32F:case gt.RGB32I:case gt.RGB32UI:return 12;case gt.RGBA32F:case gt.RGBA32I:case gt.RGBA32UI:return 16;case is.COMPRESSED_RGB_S3TC_DXT1_EXT:case is.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case is.COMPRESSED_RGBA_S3TC_DXT3_EXT:case is.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case is.COMPRESSED_R11_EAC:case is.COMPRESSED_SIGNED_R11_EAC:case is.COMPRESSED_RGB8_ETC2:case is.COMPRESSED_SRGB8_ETC2:case is.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case is.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case is.COMPRESSED_RG11_EAC:case is.COMPRESSED_SIGNED_RG11_EAC:case is.COMPRESSED_RGBA8_ETC2_EAC:case is.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function Fw(e){if(M(e))return 0;if("descriptor"in e)return e.glName?Fw(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return E1e(t)*r*i}const X_=ge.getLogger("esri.views.webgl.VertexArrayObject");class qs{constructor(t,i,r,s,n=null){this._context=t,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(Tn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,i)=>t+this._buffers[i].size,_(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){var i,r;if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&X_.warn("Leaked WebGL VAO"));if(this._glName){const s=(r=(i=this._context)==null?void 0:i.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):X_.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const s in this._buffers)this._buffers[s].dispose(),delete this._buffers[s];this._indexBuffer=Qe(this._indexBuffer)}this._context.instanceCounter.decrement(Tn.VertexArrayObject,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const i=t.createVertexArray();t.bindVertexArray(i),this._bindLayout(),t.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:i,_indexBuffer:r}=this;t||X_.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const o=t[n];o||X_.error("Vertex buffer is uninitialized!");const a=i[n];a||X_.error("Vertex element descriptor is empty!"),wZ(this._context,this._locations,o,a)}_(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:i}=this;t||X_.error("Vertex buffer dictionary is empty!");for(const r in t){const s=t[r];s||X_.error("Vertex buffer is uninitialized!");const n=i[r];xZ(this._context,this._locations,s,n)}_(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function qa(e,t=bZ,i=zi,r=-1,s=1){let n=null;return t===s3?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new qs(e,i,{geometry:t},{geometry:si.createVertex(e,_i.STATIC_DRAW,n)})}function fqe(e,t=bZ,i=zi){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new qs(e,i,{geometry:t},{geometry:si.createVertex(e,_i.STATIC_DRAW,r)})}const C1e=4;function A1e(e,t=C1e){return new ot(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:t,height:t})}function mqe(e,t,i=C1e){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*t[0],r[s+1]=255*t[1],r[s+2]=255*t[2],r[s+3]=255*t[3];return new ot(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:i,height:i},r)}function M1e(e){return new ot(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class mse{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=R(),this._heightParameters=Ht(),this._betasRayleigh=R(),this._betasCombined=R(),this._scaleHeight=0,this._radii=st(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=Ri.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(Ri.radius)}destroy(){this._atmosphereTechnique=er(this._atmosphereTechnique),this._atmosphereHazeTechnique=er(this._atmosphereHazeTechnique),this._vao=Qe(this._vao),this._handles=lt(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const i=t.renderContext.rctx,r=this._handles=new jt,s=this._view.basemapTerrain;_(s.rootTiles)&&this._updateElevation({spatialReference:s.spatialReference,tile:s.rootTiles[0],extent:s.rootTiles[0].extent,context:"ground"}),r.add(En(()=>this._view.basemapTerrain,"elevation-change",o=>this._updateElevation(o),{onListenerAdd:()=>this._updateElevation()})),r.add(En(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const n=new T1e;n.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(IR,n),n.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(IR,n),this._vao=qa(i,s3),this._scaleHeight=AHe*uN,ne(this._betasRayleigh,Ox[0],Ox[1],Ox[2]),ne(this._betasCombined,Ox[0]+aV[0],Ox[1]+aV[1],Ox[2]+aV[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,i){this._darkenHaze=i,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,i,r){this._update(t.bindParameters.camera);const s=t.rctx.bindTechnique(i,gqe,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{s.bindTexture("depthTex",r),this._renderCommon(i.program,t)})}_renderCommon(t,i){if(M(this._vao))return;const r=i.rctx;t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",CHe),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),r.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(It.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const i=t?t.tile:ft(this._view.basemapTerrain.rootTiles,[null])[0];if(M(i)||i.level!==0)return;const r=this._adjustRadiusForTesselation(Ri.radius+i.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(Ri.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,di(this._radii,t,t+uN),this._innerFadeDistance=2*Math.sqrt((2*t-hH)*hH)}_update(t){if(M(t))return;this._cameraHeight=Oe(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const i=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/uN));this._heightParameters=mi(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,i),le(this._cameraPosition,t.eye),this._altitudeFade=h1e(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?qt(.6,1,M2(9500,10500,this._cameraHeight-Ri.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}const gqe=new Ys;function yqe(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function O1e(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function R1e(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Et?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function TZ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-r*c,e[2]=n*h+o*c+r*l-s*a,e[3]=o*h-r*a-s*l-n*c,e}function vqe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e}function _qe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e}function bqe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function wqe(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e}function dN(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,f,m=i[0],y=i[1],v=i[2],w=i[3];return c=s*m+n*y+o*v+a*w,c<0&&(c=-c,m=-m,y=-y,v=-v,w=-w),1-c>Et?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(p=1-r,f=r),e[0]=p*s+f*m,e[1]=p*n+f*y,e[2]=p*o+f*v,e[3]=p*a+f*w,e}function xqe(e){const t=sp(),i=sp(),r=sp(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e}function Tqe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e}function my(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function P1e(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*n+o]-t[3*o+n])*r,e[n]=(t[3*n+s]+t[3*s+n])*r,e[o]=(t[3*o+s]+t[3*s+o])*r}return e}function Sqe(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function Eqe(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const n3=np,Cqe=Ji,Aqe=_W,Mqe=TZ,Oqe=IP,Rqe=ade,Pqe=F5,I1e=bW,Iqe=I1e,$1e=wW,$qe=$1e,SZ=ode,Dqe=eR,Lqe=lde;function Nqe(e,t,i){const r=Te(t,i);return r<-.999999?(ct(Lp,Fqe,t),vW(Lp)<1e-6&&ct(Lp,kqe,t),we(Lp,Lp),O1e(e,Lp,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(ct(Lp,t,i),e[0]=Lp[0],e[1]=Lp[1],e[2]=Lp[2],e[3]=1+r,SZ(e,e))}const Lp=R(),Fqe=Fe(1,0,0),kqe=Fe(0,1,0);function Uqe(e,t,i,r,s,n){return dN(gse,t,s,n),dN(yse,i,r,n),dN(e,gse,yse,2*n*(1-n)),e}const gse=Sy(),yse=Sy();function zqe(e,t,i,r){const s=Vqe;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],SZ(e,P1e(e,s))}const Vqe=Pr();Object.freeze(Object.defineProperty({__proto__:null,identity:yqe,setAxisAngle:O1e,getAxisAngle:R1e,multiply:TZ,rotateX:vqe,rotateY:_qe,rotateZ:bqe,calculateW:wqe,slerp:dN,random:xqe,invert:Tqe,conjugate:my,fromMat3:P1e,fromEuler:Sqe,str:Eqe,copy:n3,set:Cqe,add:Aqe,mul:Mqe,scale:Oqe,dot:Rqe,lerp:Pqe,length:I1e,len:Iqe,squaredLength:$1e,sqrLen:$qe,normalize:SZ,exactEquals:Dqe,equals:Lqe,rotationTo:Nqe,sqlerp:Uqe,setAxes:zqe},Symbol.toStringTag,{value:"Module"}));function cC(e=Gqe){return[e[0],e[1],e[2],e[3]]}function $R(e,t){return Bqe(e[0],e[1],e[2],t,LX.get())}function Bqe(e,t,i,r,s=cC()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function DR(e,t,i=cC()){return ct(i,e,t),we(i,i),i[3]=kX(e,t),i}const Gqe=[0,0,1,0];class jqe{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=R(),this.parallax={anchorPointClouds:R(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.parallaxNew={anchorPointClouds:R(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:so.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:Th.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:Qv.FINISHED,factor:-1}}}var Th,so,Qv;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(Th||(Th={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(so||(so={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(Qv||(Qv={}));function Ci(){return new Float32Array(3)}function b4(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function $i(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function D1e(e,t){return new Float32Array(e,t,3)}function EZ(){return Ci()}function L1e(){return $i(1,1,1)}function N1e(){return $i(1,0,0)}function F1e(){return $i(0,1,0)}function k1e(){return $i(0,0,1)}const Hqe=EZ(),qqe=L1e(),Wqe=N1e(),Xqe=F1e(),Yqe=k1e();Object.freeze(Object.defineProperty({__proto__:null,create:Ci,clone:b4,fromValues:$i,createView:D1e,zeros:EZ,ones:L1e,unitX:N1e,unitY:F1e,unitZ:k1e,ZEROS:Hqe,ONES:qqe,UNIT_X:Wqe,UNIT_Y:Xqe,UNIT_Z:Yqe},Symbol.toStringTag,{value:"Module"}));function U1e(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function CZ(e,t){switch(e.include(Yg,t),e.fragment.code.add(x`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case ln.Default:return void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case ln.Atlas:return e.include(U1e),void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case ln.None:case ln.COUNT:return}}class Va extends Jr{constructor(t,i){super(t,"vec3",Ui.Draw,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class AZ extends Jr{constructor(t,i){super(t,"vec2",Ui.Draw,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class MZ extends Jr{constructor(t,i){super(t,"sampler2D",Ui.Draw,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function AO(e,t,i){const r=[new MZ(e,t)];if(i){const s=e+"Size";r.push(new AZ(s,(n,o)=>{const a=t(n,o);return _(a)?di(Zqe,a.descriptor.width,a.descriptor.height):Zh}))}return r}const Zqe=st();class Vt extends Jr{constructor(t,i){super(t,"sampler2D",Ui.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function pN(e,t,i){const r=[new Vt(e,t)];if(i){const s=e+"Size";r.push(new pi(s,(n,o)=>{const a=t(n,o);return _(a)?di(Qqe,a.descriptor.width,a.descriptor.height):Zh}))}return r}const Qqe=st();class I_{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,i,r=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(r,i),this._technique),this._technique}ensureResources(t){return ac.LOADED}}class OZ extends I_{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,i=>this._texture=i),this._acquire(t.normalTextureId,i=>this._textureNormal=i),this._acquire(t.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(t.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(t.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=er(this._texture),this._textureNormal=er(this._textureNormal),this._textureEmissive=er(this._textureEmissive),this._textureOcclusion=er(this._textureOcclusion),this._textureMetallicRoughness=er(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?ac.LOADED:ac.LOADING}get textureBindParameters(){return new z1e(_(this._texture)?this._texture.glTexture:null,_(this._textureNormal)?this._textureNormal.glTexture:null,_(this._textureEmissive)?this._textureEmissive.glTexture:null,_(this._textureOcclusion)?this._textureOcclusion.glTexture:null,_(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(M(this._texture)||t!==this._texture.id)&&(this._texture=er(this._texture),this._textureId=t,this._acquire(this._textureId,i=>this._texture=i))}_acquire(t,i){if(M(t))return void i(null);const r=this._textureRepository.acquire(t);if(Bu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return er(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}}class z1e extends Ys{constructor(t=null,i=null,r=null,s=null,n=null){super(),this.texture=t,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const ASt=$i(0,.6,.2);var Ot;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(Ot||(Ot={}));function RZ(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===Ot.Normal&&r&&e.include(CZ,t),t.pbrMode!==Ot.Schematic)if(t.pbrMode!==Ot.Disabled){if(t.pbrMode===Ot.Normal){i.code.add(x`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas,n=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add(n===Ui.Pass?pN("texMetallicRoughness",o=>o.textureMetallicRoughness,s):AO("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),i.code.add(x`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(n===Ui.Pass?pN("texEmission",o=>o.textureEmissive,s):AO("texEmission",o=>o.textureEmissive,s)),i.code.add(x`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(n===Ui.Pass?pN("texOcclusion",o=>o.textureOcclusion,s):AO("texOcclusion",o=>o.textureOcclusion,s)),i.code.add(x`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(x`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===Ui.Pass?[new xt("emissionFactor",o=>o.emissiveFactor),new xt("mrrFactors",o=>o.mrrFactors)]:[new Va("emissionFactor",o=>o.emissiveFactor),new Va("mrrFactors",o=>o.mrrFactors)]),i.code.add(x`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(x`float getBakedOcclusion() { return 1.0; }`);else i.code.add(x`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}class ri extends Jr{constructor(t,i){super(t,"vec4",Ui.Pass,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}function PZ(e,t){const i=e.fragment,r=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new xt("lightingAmbientSH0",(s,n)=>ne(vse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new ri("lightingAmbientSH_R",(s,n)=>Ji(Fm,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new ri("lightingAmbientSH_G",(s,n)=>Ji(Fm,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new ri("lightingAmbientSH_B",(s,n)=>Ji(Fm,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new xt("lightingAmbientSH0",(s,n)=>ne(vse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new ri("lightingAmbientSH_R1",(s,n)=>Ji(Fm,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new ri("lightingAmbientSH_G1",(s,n)=>Ji(Fm,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new ri("lightingAmbientSH_B1",(s,n)=>Ji(Fm,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new ri("lightingAmbientSH_R2",(s,n)=>Ji(Fm,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new ri("lightingAmbientSH_G2",(s,n)=>Ji(Fm,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new ri("lightingAmbientSH_B2",(s,n)=>Ji(Fm,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||i.code.add(x`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const vse=R(),Fm=Ht();class Xe extends Jr{constructor(t,i){super(t,"float",Ui.Pass,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function IZ(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new Xe("lightingFixedFactor",(r,s)=>(1-s.lighting.groundLightingFactor)*(1-s.lighting.globalFactor))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new xt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection),new xt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(x`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function Gk(e){e.vertex.code.add(x`const float PI = 3.141592653589793;`),e.fragment.code.add(x`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}class kw extends Jr{constructor(t,i){super(t,"bool",Ui.Pass,(r,s,n)=>r.setUniform1b(t,i(s,n)))}}class Jqe extends Jr{constructor(t,i){super(t,"samplerCube",Ui.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function V1e(e){const t=e.fragment;t.uniforms.add([new Er("rotationMatrixClouds",(i,r)=>r.clouds.parallax.transform),new Er("rotationMatrixCloudsCrossFade",(i,r)=>r.clouds.parallaxNew.transform),new xt("anchorPosition",(i,r)=>r.clouds.parallax.anchorPointClouds),new xt("anchorPositionCrossFade",(i,r)=>r.clouds.parallaxNew.anchorPointClouds),new pi("cloudVariables",(i,r)=>_(r.clouds.data)?di(Kqe,r.clouds.data.coverage,r.clouds.data.absorption):Zh),new Xe("cloudsHeight",(i,r)=>r.clouds.parallax.cloudsHeight),new Xe("radiusCurvatureCorrectionFactor",(i,r)=>r.clouds.parallax.radiusCurvatureCorrectionFactor),new Xe("totalFadeInOut",(i,r)=>r.clouds.fadeInOut.stage===so.FINISHED?r.clouds.fadeInOutHeight.factor+Math.max(De(r.clouds.fadeIn.factor,0,1)):r.clouds.fadeInOutHeight.factor+Math.max(De(r.clouds.fadeInOut.factor,0,1))),new Xe("crossFadeAnchorFactor",(i,r)=>De(r.clouds.crossFade.factor,0,1)),new Jqe("cubeMap",(i,r)=>_(r.clouds.data)?r.clouds.data.cubeMap.colorTexture:null),new kw("crossFade",(i,r)=>r.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",Ri.radius),t.code.add(x`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(x`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(x`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new xt("lightingMainDirection",(i,r)=>r.lighting.lightingMainDirection),new xt("lightingMainIntensity",(i,r)=>r.lighting.mainLight.intensity)]),t.code.add(x`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(x`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(x`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(x`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(x`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const Kqe=st();function Mm(e){e.code.add(x`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function eWe(){const e=new qi;e.attributes.add(O.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:i}=e;return t.uniforms.add([new Er("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new Er("inverseViewMatrix",(r,s)=>vs(tWe,s.camera.viewMatrix))]),t.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(Mm),i.include($c),e.include(PZ,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Gk),e.include(Vk),e.include(IZ,{isGround:!1}),e.include(V1e,{instancedDoublePrecision:!1,isGround:!1}),i.uniforms.add([new xt("cameraPosition",(r,s)=>s.camera.eye)]),i.code.add(x`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const tWe=Ae(),iWe=Object.freeze(Object.defineProperty({__proto__:null,build:eWe},Symbol.toStringTag,{value:"Module"}));class jk extends fr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=jk.shader.get().build();return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:Am(Me.ONE,Me.SRC_ALPHA),depthTest:{func:yr.LEQUAL},colorWrite:ti})}}jk.shader=new sr(iWe,()=>import("./CloudsComposition.glsl.1381adb5.js"));function rWe(e){return _(e)&&_(e.cubeMap)&&e.coverage>0}function _se(e){return _(e)&&!e.running}let sb=class extends Se{constructor(e){super(e),this._technique=new jk(e),this._vao=qa(e.rctx)}destroy(){this._technique=er(this._technique),this._vao=Qe(this._vao)}render(e,t){const i=e.bindParameters.clouds;if(M(this._vao)||M(i.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(i,e.bindParameters.camera.eye,t);const r=e.rctx.bindTechnique(this._technique,cWe,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(It.TRIANGLE_STRIP,0,4),lWe(i)&&this.requestRender()}_setFadeInStage(e,t){const i=performance.now(),r=e.parallax.anchorPointClouds;e.fadeIn.stage===Th.FINISHED&&(e.fadeIn.factor=1,le(r,Np),e.fadeIn.stage=Th.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=so.FINISHED);const s=xse(e,t);e.fadeIn.stage===Th.CHANGE_ANCHOR&&s&&_se(e.data)&&(le(r,Np),e.fadeIn.stage=Th.FADE_IN,e.startTime=i),e.fadeIn.factor>0&&e.fadeIn.stage===Th.FADE_IN&&(e.fadeIn.factor=1-(i-e.startTime)/wse),e.fadeIn.factor<=0&&e.fadeIn.stage===Th.FADE_IN&&(e.fadeIn.stage=Th.FINISHED,e.fadeIn.factor=0)}_setCrossFadingStage(e){const t=performance.now(),{crossFade:i}=e,r=e.parallax.anchorPointClouds;e.crossFade.enabled||(le(e.parallaxNew.anchorPointClouds,Np),e.startTime=t,i.factor=0,e.crossFade.enabled=!0),i.factor<1&&e.crossFade.enabled&&(i.factor=(t-e.startTime)/oWe),i.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,i.factor=1,le(r,e.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e,t){const i=performance.now(),{fadeInOut:r,crossFade:s}=e;r.stage===so.FINISHED&&(e.startTime=i,r.factor=0,r.stage=so.FADE_OUT),r.factor<1&&r.stage===so.FADE_OUT&&(r.factor=(i-e.startTime)/nWe),r.factor>=1&&r.stage===so.FADE_OUT&&(r.factor=1,le(e.parallax.anchorPointClouds,Np)),r.factor>=1&&r.stage===so.FADE_OUT&&xse(e,t)&&(r.factor=1,r.stage=so.SWITCH,e.crossFade.enabled=!1,s.factor=1),_se(e.data)&&r.stage===so.SWITCH&&(e.startTime=i,r.factor=1,r.stage=so.FADE_IN,le(e.parallax.anchorPointClouds,Np),e.crossFade.enabled=!1,s.factor=1),r.factor>0&&r.stage===so.FADE_IN&&(r.factor=1-(i-e.startTime)/wse),r.factor<=0&&r.stage===so.FADE_IN&&(r.stage=so.FINISHED,r.factor=0)}_setFadeInOutHeight(e,t){const i=performance.now(),r=e.fadeInOutHeight,s=(i-(r.stage===Qv.FINISHED?i:e.startTimeHeightFade))/aWe;r.factor+=t?-s:s,e.startTimeHeightFade=i,r.factor=De(r.factor,0,1),r.stage=Qv.HEIGHT_FADE}_setParallaxParameters(e,t,i){const{parallax:r}=e;e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=Oe(t)-this.planetRadius>Ah?1:0),we(Np,t),ce(Np,Np,this.planetRadius),r.anchorPointClouds[0]===0&&r.anchorPointClouds[1]===0&&r.anchorPointClouds[2]===0&&le(r.anchorPointClouds,Np);const s=Oe(pe(sWe,r.anchorPointClouds,Np));let n=!0;s>e.fadeIn.distanceThresholdFactor*r.cloudsHeight||e.fadeIn.stage!==Th.FINISHED?this._setFadeInStage(e,t):s>e.fadeInOut.distanceThresholdFactor*r.cloudsHeight||e.fadeInOut.stage!==so.FINISHED?this._setFadeInOutStage(e,t):s>e.crossFade.distanceThresholdFactor*r.cloudsHeight&&!i||e.crossFade.enabled?this._setCrossFadingStage(e):n=!1;const o=Oe(t),a=o-this.planetRadius;if((a>1.7*Ah||a<-Ah)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(a>Ah||a<-.35*Ah)&&e.fadeInOutHeight.factor<1?this._setFadeInOutHeight(e,!1):a<Ah&&a>-.35*Ah&&e.fadeInOutHeight.factor>0?this._setFadeInOutHeight(e,!0):e.fadeInOutHeight.stage=Qv.FINISHED,r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(o*o-this.planetRadius*this.planetRadius,0))/o,DR(bse,r.anchorPointClouds,Rx),r.transform=Ae(),mc(r.transform,r.transform,Rx[3],Rx),n){const{parallaxNew:l}=e;DR(bse,l.anchorPointClouds,Rx),l.transform=Ae(),mc(l.transform,l.transform,Rx[3],Rx)}le(e.cameraPositionLastFrame,t)}};u([d({constructOnly:!0})],sb.prototype,"rctx",void 0),u([d({constructOnly:!0})],sb.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],sb.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],sb.prototype,"requestRender",void 0),sb=u([P("esri.views.3d.environment.CloudsComposition")],sb);const bse=Fe(0,0,1),Rx=cC(),Np=R(),sWe=R(),wse=500,nWe=250,oWe=500,aWe=500;function lWe(e){return e.crossFade.enabled||e.fadeInOut.stage!==so.FINISHED||e.fadeIn.stage!==Th.FINISHED||e.fadeInOutHeight.stage!==Qv.FINISHED}function xse(e,t){return _w(e.cameraPositionLastFrame,t)}const cWe=new Ys;function Jh(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function uWe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function $Z(e,t,i,r,s,n,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function DZ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Kh(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function yx(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=i*p+r*f+s*m;return y?(y=1/y,e[0]=p*y,e[1]=(-h*r+s*c)*y,e[2]=(a*r-s*o)*y,e[3]=f*y,e[4]=(h*i-s*l)*y,e[5]=(-a*i+s*n)*y,e[6]=m*y,e[7]=(-c*i+r*l)*y,e[8]=(o*i-r*n)*y,e):null}function hWe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-r*h,e[2]=r*a-s*o,e[3]=a*l-n*h,e[4]=i*h-s*l,e[5]=s*n-i*a,e[6]=n*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*n,e}function dWe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function Hk(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1],y=i[2],v=i[3],w=i[4],b=i[5],S=i[6],T=i[7],E=i[8];return e[0]=f*r+m*o+y*c,e[1]=f*s+m*a+y*h,e[2]=f*n+m*l+y*p,e[3]=v*r+w*o+b*c,e[4]=v*s+w*a+b*h,e[5]=v*n+w*l+b*p,e[6]=S*r+T*o+E*c,e[7]=S*s+T*a+E*h,e[8]=S*n+T*l+E*p,e}function w4(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*r+m*o+c,e[7]=f*s+m*a+h,e[8]=f*n+m*l+p,e}function LZ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=Math.sin(i),m=Math.cos(i);return e[0]=m*r+f*o,e[1]=m*s+f*a,e[2]=m*n+f*l,e[3]=m*o-f*r,e[4]=m*a-f*s,e[5]=m*l-f*n,e[6]=c,e[7]=h,e[8]=p,e}function NZ(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function pWe(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function fWe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function mWe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function gWe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function yWe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function qk(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,v=n*o,w=n*a,b=n*l;return e[0]=1-p-y,e[3]=h-b,e[6]=f+w,e[1]=h+b,e[4]=1-c-y,e[7]=m-v,e[2]=f-w,e[5]=m+v,e[8]=1-c-p,e}function B1e(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=i*p+r*f+s*m;if(!y)return null;const v=1/y;return e[0]=p*v,e[1]=(-h*r+s*c)*v,e[2]=(a*r-s*o)*v,e[3]=f*v,e[4]=(h*i-s*l)*v,e[5]=(-a*i+s*n)*v,e[6]=m*v,e[7]=(-c*i+r*l)*v,e[8]=(o*i-r*n)*v,e}function uE(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],w=t[14],b=t[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,C=r*l-s*a,A=r*c-n*a,I=s*c-n*l,L=h*v-p*y,D=h*w-f*y,U=h*b-m*y,z=p*w-f*v,V=p*b-m*v,X=f*b-m*w;let Z=S*X-T*V+E*z+C*U-A*D+I*L;return Z?(Z=1/Z,e[0]=(a*X-l*V+c*z)*Z,e[1]=(l*U-o*X-c*D)*Z,e[2]=(o*V-a*U+c*L)*Z,e[3]=(s*V-r*X-n*z)*Z,e[4]=(i*X-s*U+n*D)*Z,e[5]=(r*U-i*V-n*L)*Z,e[6]=(v*I-w*A+b*C)*Z,e[7]=(w*E-y*I-b*T)*Z,e[8]=(y*A-v*E+b*S)*Z,e):null}function vWe(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function _We(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function bWe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function wWe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function G1e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function xWe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function TWe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function SWe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function EWe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],f=t[1],m=t[2],y=t[3],v=t[4],w=t[5],b=t[6],S=t[7],T=t[8];return Math.abs(i-p)<=Et*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=Et*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=Et*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=Et*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-v)<=Et*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-w)<=Et*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-b)<=Et*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-S)<=Et*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-T)<=Et*Math.max(1,Math.abs(h),Math.abs(T))}function FZ(e){const t=Et,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const CWe=Hk,AWe=G1e;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:Jh,copy:uWe,set:$Z,identity:DZ,transpose:Kh,invert:yx,adjoint:hWe,determinant:dWe,multiply:Hk,translate:w4,rotate:LZ,scale:NZ,scaleByVec2:pWe,fromTranslation:fWe,fromRotation:mWe,fromScaling:gWe,fromMat2d:yWe,fromQuat:qk,normalFromMat4Legacy:B1e,normalFromMat4:uE,projection:vWe,str:_We,frob:bWe,add:wWe,subtract:G1e,multiplyScalar:xWe,multiplyScalarAndAdd:TWe,exactEquals:SWe,equals:EWe,isOrthoNormal:FZ,mul:CWe,sub:AWe},Symbol.toStringTag,{value:"Module"}));function kZ(){return new Float32Array(2)}function MWe(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function Na(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function OWe(e,t){return new Float32Array(e,t,2)}function j1e(){return kZ()}function H1e(){return Na(1,1)}function q1e(){return Na(1,0)}function W1e(){return Na(0,1)}const RWe=j1e(),PWe=H1e(),IWe=q1e(),$We=W1e();Object.freeze(Object.defineProperty({__proto__:null,create:kZ,clone:MWe,fromValues:Na,createView:OWe,zeros:j1e,ones:H1e,unitX:q1e,unitY:W1e,ZEROS:RWe,ONES:PWe,UNIT_X:IWe,UNIT_Y:$We},Symbol.toStringTag,{value:"Module"}));var ep;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(ep||(ep={}));class X1e extends Ha{constructor(){super(...arguments),this.steps=ep.SIXTEEN}}u([j({count:ep.COUNT})],X1e.prototype,"steps",void 0);const Mh=he("esri-mobile")?64:128,DWe=Mh/128,zd=Math.ceil(Math.sqrt(Mh)),Yd=(Mh+2)*zd,LWe=1e5,uV=128,NWe=Yd/1560;function $_(e,t=!0){e.attributes.add(O.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(x`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?x`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class LR extends Jr{constructor(t,i){super(t,"mat3",Ui.Draw,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class Y1e extends Ys{constructor(){super(...arguments),this.viewMatrix=Pr()}}function FWe(e){const t=new qi;return t.include($_,!1),t.fragment.uniforms.add(new Fi("cloudRadius")),t.fragment.uniforms.add(new Fi("halfCubeMapSize")),t.fragment.uniforms.add(new Fi("power")),t.fragment.uniforms.add(new Fi("sigmaE")),t.fragment.uniforms.add(new Fi("density")),t.fragment.uniforms.add(new Fi("cloudSize")),t.fragment.uniforms.add(new Fi("detailSize")),t.fragment.uniforms.add(new Fi("smoothness")),t.fragment.uniforms.add(new Fi("cloudHeight")),t.fragment.uniforms.add(new Fi("coverage")),t.fragment.uniforms.add(new LR("view",i=>i.viewMatrix)),t.fragment.uniforms.add(new Vr("cloudShapeTexture")),t.fragment.code.add(x`
    const int STEPS = ${e.steps===ep.SIXTEEN?x`16`:e.steps===ep.HUNDRED?x`100`:x`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(x`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${x.float(Yd)};
      const float dataWidth = ${x.float(Yd)};
      const float tileRows = ${x.float(zd)};
      const vec3 atlasDimensions = vec3(${x.float(Mh)}, ${x.float(Mh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${x.float(DWe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${x.float(NWe)} * p) / ${x.float(Yd)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.fragment.code.add(x`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(x`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(x`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(x`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(x`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const kWe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:Y1e,build:FWe},Symbol.toStringTag,{value:"Module"}));class BC{constructor(t,i,r,s,n,o,a,l,c=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingStepType=l,this.median=c}}const Z1e={sunny:new BC([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],ep.SIXTEEN),cloudy:new BC([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],ep.TWOHUNDRED,.6),rainy:new BC([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],ep.TWOHUNDRED,.4),snowy:new BC([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],ep.HUNDRED,.65),foggy:new BC([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],ep.SIXTEEN)};class Wk extends fr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=Wk.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:bo(Me.ONE,Me.ONE,Me.ZERO,Me.ZERO),depthTest:{func:yr.LEQUAL},colorWrite:ti})}}Wk.shader=new sr(kWe,()=>import("./Clouds.glsl.264d4cf6.js"));var _u;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(_u||(_u={}));class pH extends Ha{constructor(){super(...arguments),this.mode=_u.Full}}u([j({count:_u.COUNT})],pH.prototype,"mode",void 0);function UWe(e){const t=new qi;return t.include($_,!1),t.fragment.code.add(x`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.fragment.uniforms.add(new Zg("weatherTile")),e.mode===_u.Full&&t.fragment.code.add(x`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${x.float(zd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${x.float(8)});

      float worley0 = worley(p, ${x.float(2)} * 2.0);
      float worley1 = worley(p, ${x.float(2)} * 8.0);
      float worley2 = worley(p, ${x.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${x.float(2)});
      float worley1 = worley(p, ${x.float(2)} * 2.0);
      float worley2 = worley(p, ${x.float(2)} * 4.0);
      float worley3 = worley(p, ${x.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.code.add(x`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${x.float(uV)});

      // Get global coordinates of p
      p += weatherTile * ${x.float(uV)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${x.float(LWe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(x`void main() {`),e.mode===_u.Full&&t.fragment.code.add(x`
        float padWidth = 1.0;
        float paddedSize = ${x.float(Mh)} + 2.0 * padWidth;
        float tileCount = ${x.float(zd)} * ${x.float(zd)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${x.float(Mh)};
          }

          if (startPadY) {
            pixel.y += ${x.float(Mh)};
          }

          if (endPadX) {
            pixel.x -= ${x.float(Mh)};
          }

          if (endPadY) {
            pixel.y -= ${x.float(Mh)};
          }

          uv = vec2(pixel.xy / ${x.float(Mh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${x.float(Mh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${x.float(zd)} * ${x.float(zd)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${x.float(zd)} * ${x.float(zd)});
        p = p_;
        p.z /= (${x.float(zd)} * ${x.float(zd)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(x`
      vec2 mapUV = ${x.float(uV)} * (gl_FragCoord.xy / ${x.float(Yd)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===_u.Full?x`gl_FragColor.ba = vec2(0.0, map);`:x`gl_FragColor = vec4(map);`};
    }
  `),t}const zWe=Object.freeze(Object.defineProperty({__proto__:null,build:UWe},Symbol.toStringTag,{value:"Module"}));class NR extends fr{initializeProgram(t){const i=NR.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:this.configuration.mode===_u.Full?Am(Me.ONE,Me.ZERO):bo(Me.ZERO,Me.ONE,Me.ONE,Me.ZERO),depthTest:{func:yr.ALWAYS},colorWrite:ti})}}NR.shader=new sr(zWe,()=>import("./NoiseTextureAtlas.glsl.4e4655fe.js"));class rS{constructor(t,i){this._context=t,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(Tn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==li.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,i=this._context.parameters.maxSamples;return t?Math.min(t,i):i}resize(t,i){const r=this._desc;if(r.width===t&&r.height===i)return;r.width=t,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Tn.Renderbuffer,this),this._context=null)}}const VWe=ge.getLogger("esri.views.webgl.FrameBufferObject");class Or{constructor(t,i,r=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=F({},i),t.instanceCounter.increment(Tn.FramebufferObject,this),_(r)){Array.isArray(r)||(r=[r]);for(let o=0;o<r.length;++o){const a=r[o],l=su.COLOR_ATTACHMENT0+o;let c;Sse(a)?(dg(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new ot(this._context,c))),ZI(c,this._desc)):(Tse(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new rS(this._context,c))),hV(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(_(s)){let o,a;if(Sse(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),dg(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new ot(this._context,a)),ZI(a,this._desc);else{Tse(s)?(a=s.descriptor,o=s):(a=s,o=new rS(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:Ai.DEPTH_STENCIL_RENDER_BUFFER;l===Ai.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===Ai.DEPTH_RENDER_BUFFER||l===Ai.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),hV(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(Tn.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(su.COLOR_ATTACHMENT0);return t&&dg(t)?t:null}get colorAttachment(){return this._colorAttachments.get(su.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[i,r])=>t+Fw(r),0)+Fw(this.depthStencilAttachment)}getColorTexture(t){const i=this._colorAttachments.get(t);return i&&dg(i)?i:null}attachColorTexture(t,i=su.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(i),ZI(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,i)),this._colorAttachments.set(i,t))}detachColorTexture(t=su.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);if(dg(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}}setColorTextureTarget(t,i=su.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);dg(r)&&this._framebufferTexture2D(r.glName,i,t)}attachDepthStencilTexture(t){if(M(t))return;const i=t.descriptor;i.pixelFormat!==ze.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==St.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),ZI(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Ai.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Ai.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,ose)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,ose)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(M(t))return;const i=t.descriptor;if(i.internalFormat!==La.DEPTH_STENCIL&&i.internalFormat!==La.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),hV(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===La.DEPTH_STENCIL?Ai.DEPTH_STENCIL_RENDER_BUFFER:Ai.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===Ai.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(Fn.FRAMEBUFFER,s,r.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Ai.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Fn.FRAMEBUFFER,r,t.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((t,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,i,r,s,n,o,a){(t<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==mt.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,ot.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(mt.TEXTURE_2D,0,n,o,t,i,r,s),h.bindTexture(p,ot.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,i,r,s,n,o,a)}async readPixelsAsync(t,i,r,s,n,o,a){if(this._context.type!==li.WEBGL2)return xh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,i,r,s,n,o,a);const l=this._context.gl,c=si.createPixelPack(this._context,_i.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,i,r,s,n,o,0),this._context.unbindBuffer(wt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,i){const r=this._desc;if(r.width!==t||r.height!==i){if(!this._initialized)return r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,i));r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,i),this._stencilAttachment&&this._stencilAttachment.resize(t,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=Fn.FRAMEBUFFER){var h,p,f,m;const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(t,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,s=i.createFramebuffer(),n=this._desc,o=(h=n.colorTarget)!=null?h:ss.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(f=n.height)!=null?f:1;if(i.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===ss.TEXTURE||o===ss.CUBEMAP)this._colorAttachments.set(su.COLOR_ATTACHMENT0,BWe(r,n,this.descriptor.colorTarget===ss.CUBEMAP?mt.TEXTURE_CUBE_MAP:mt.TEXTURE_2D));else{const y=new rS(r,{internalFormat:gt.RGBA4,width:a,height:l});this._colorAttachments.set(su.COLOR_ATTACHMENT0,y)}this._colorAttachments.forEach((y,v)=>{y&&(dg(y)?this._framebufferTexture2D(y.glName,v,Ese(y),t):i.framebufferRenderbuffer(t,v,i.RENDERBUFFER,y.glName))});const c=(m=n.depthStencilTarget)!=null?m:Ai.NONE;switch(c){case Ai.DEPTH_RENDER_BUFFER:case Ai.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new rS(r,{internalFormat:n.depthStencilTarget===Ai.DEPTH_RENDER_BUFFER?La.DEPTH_COMPONENT16:La.DEPTH_STENCIL,width:a,height:l}));const y=c===Ai.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(t,y,i.RENDERBUFFER,this._depthAttachment.glName);break}case Ai.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new rS(r,{internalFormat:La.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(t,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case Ai.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const y={target:mt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:St.UNSIGNED_INT_24_8,samplingMode:tt.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new ot(r,y)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,Ese(this._depthStencilTexture),t)}PR()&&i.checkFramebufferStatus(t)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,i=su.COLOR_ATTACHMENT0,r=mt.TEXTURE_2D,s=Fn.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,t,n)}_detachColorAttachment(t){xh()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(t);return dg(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(Fn.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._colorAttachments.delete(t),r}_disposeColorAttachments(){this._colorAttachments.forEach((t,i)=>{this._detachColorAttachment(i),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Ai.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Fn.FRAMEBUFFER,i,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(Fn.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(Or._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;Or._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else Or._MAX_COLOR_ATTACHMENTS=1}const i=t-su.COLOR_ATTACHMENT0;i+1>Or._MAX_COLOR_ATTACHMENTS&&VWe.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${Or._MAX_COLOR_ATTACHMENTS} color attachments`)}}function dg(e){return"type"in e&&e.type==="texture"}function Tse(e){return"type"in e&&e.type==="renderbuffer"}function Sse(e){return dg(e)||"pixelFormat"in e}function BWe(e,t,i){return new ot(e,{target:i,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:t.width,height:t.height})}function ZI(e,t){e.target!==mt.TEXTURE_2D&&e.target!==mt.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function hV(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function Ese(e){return e.descriptor.target===mt.TEXTURE_CUBE_MAP?mt.TEXTURE_CUBE_MAP_POSITIVE_X:mt.TEXTURE_2D}Or._MAX_COLOR_ATTACHMENTS=-1;class Q1e extends Se{constructor(t){let i;super(t),this._weatherTile=Na(0,0),this._needsRender=!0,this._frameBuffer=new Or(t.context.renderContext.rctx,{colorTarget:ss.TEXTURE,width:Yd,height:Yd},{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,hasMipmap:!1,width:Yd,height:Yd}),this._vao=qa(t.context.renderContext.rctx),this._shaderTechniqueRepository=t.context.shaderTechniqueRepository,this._ensureRendered=()=>(_(i)?_(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(i=this._render(t.context.renderContext.rctx,_u.WeatherMap)):_(this.fullTechnique)&&this.fullTechnique.compiled&&(i=this._render(t.context.renderContext.rctx,_u.Full)),i)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(t){this._weatherTile[0]===t[0]&&this._weatherTile[1]===t[1]||(this._weatherTile=t,this._setDirty())}destroy(){this._fullTechnique=er(this._fullTechnique),this._weatherMapTechnique=er(this._weatherMapTechnique),this._frameBuffer=Qe(this._frameBuffer),this._vao=Qe(this._vao)}get fullTechnique(){if(M(this._fullTechnique)){const t=new pH;t.mode=_u.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(NR,t)}return this._fullTechnique}get weatherMapTechnique(){if(M(this._weatherMapTechnique)){const t=new pH;t.mode=_u.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(NR,t)}return this._weatherMapTechnique}_render(t,i){if(M(this._vao)||M(this._frameBuffer))return null;const r=i===_u.Full?this.fullTechnique:this.weatherMapTechnique;if(M(r))return null;const s=t.getViewport();t.setViewport(0,0,Yd,Yd),t.bindFramebuffer(this._frameBuffer);const n=t.bindTechnique(r);return n.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),t.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}}u([d({constructOnly:!0})],Q1e.prototype,"context",void 0);function J1e(e){e.include(zu),e.uniforms.add([new Vt("geometryDepthTexture",(t,i)=>i.multipassGeometry.linearDepthTexture),new pi("nearFar",(t,i)=>i.camera.nearFar)]),e.code.add(x`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class GWe{constructor(){this.enabled=!1}}function Vu(e,t){t.hasMultipassTerrain&&(e.fragment.include(zu),e.fragment.uniforms.add(new Vt("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new pi("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.uniforms.add(new pi("inverseViewport",(i,r)=>r.inverseViewport)),e.fragment.code.add(x`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class jWe{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function HWe(e,t){const i=e.fragment.uniforms;i.add(new pi("nearFar",(r,s)=>s.camera.nearFar)),i.add(new Vt("depthMap",(r,s)=>s.linearDepthTexture)),i.add(new Er("view",(r,s)=>s.ssr.camera.viewMatrix)),i.add(new Er("proj",(r,s)=>s.ssr.camera.projectionMatrix)),i.add(new Xe("invResolutionHeight",(r,s)=>1/s.ssr.camera.height)),i.add(new Vt("lastFrameColorMap",(r,s)=>s.ssr.lastFrameColorTexture)),i.add(new Er("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),e.fragment.include(zu),e.fragment.code.add(x`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class qWe{constructor(){this.reprojectionMatrix=Ae()}}var Ee;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Ee||(Ee={}));class UZ{constructor(t=R()){this.intensity=t}}class K1e{constructor(t=R(),i=Fe(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class fH{constructor(t=R(),i=Fe(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=t,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}class ebe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function WWe(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function dV(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function a2(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function tbe(e){return(e+1)*(e+1)}function XWe(e){return De(Math.floor(Math.sqrt(e)-1),0,2)}function ibe(e,t,i){const r=e[0],s=e[1],n=e[2],o=i||[];return o.length=tbe(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function YWe(e,t){const i=tbe(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function ZWe(e,t){const i=XWe(t.r.length);for(const r of e)ca(mH,r.direction),ibe(mH,i,Fg),WWe(Fg,fN),dV(Fg,r.intensity[0],Px),a2(t.r,Px),dV(Fg,r.intensity[1],Px),a2(t.g,Px),dV(Fg,r.intensity[2],Px),a2(t.b,Px);return t}function QWe(e,t){ibe(mH,0,Fg);for(const i of e)t.r[0]+=Fg[0]*fN[0]*i.intensity[0]*4*Math.PI,t.g[0]+=Fg[0]*fN[0]*i.intensity[1]*4*Math.PI,t.b[0]+=Fg[0]*fN[0]*i.intensity[2]*4*Math.PI;return t}function JWe(e,t,i,r){YWe(t,r),ne(i.intensity,0,0,0);let s=!1;const n=KWe,o=eXe,a=tXe;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof fH&&!s?(le(i.direction,l.direction),le(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof fH||l instanceof K1e?n.push(l):l instanceof UZ?o.push(l):l instanceof ebe&&a.push(l);ZWe(n,r),QWe(o,r);for(const l of a)a2(r.r,l.r),a2(r.g,l.g),a2(r.b,l.b)}const KWe=[],eXe=[],tXe=[],Fg=[0],Px=[0],mH=R(),fN=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],uC=.4;class iXe{constructor(){this._shOrder=2,this._oldSunlight={direction:R(),ambient:{color:R(),intensity:1},diffuse:{color:R(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new ebe,this._mainLight={intensity:R(),direction:Fe(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(t){JWe(t,this._shOrder,this._mainLight,this._sphericalHarmonics),le(this._oldSunlight.direction,this._mainLight.direction);const i=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,ce(this._oldSunlight.diffuse.color,this._mainLight.intensity,i),le(QI,this._oldSunlight.diffuse.color),ce(QI,QI,uC*this.globalFactor),de(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,QI)}get old(){return this._oldSunlight}}const QI=R();class Xk{constructor(t,i,r){this.shadowMap=t,this.ssaoHelper=i,this.slicePlane=r,this.slot=Ee.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=st(),this.lighting=new iXe,this.ssr=new qWe,this.multipassTerrain=new jWe,this.multipassGeometry=new GWe,this.clouds=new jqe,this.overlays=[]}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}let Sa=class extends Se{constructor(e){super(e),this._frameTask=null,this._handles=new jt,this._cubeMapSize=he("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new X1e,this._bindParameters=new Xk(null,null,null),this._drawParameters=new Y1e,this._weatherTile=Na(0,0),this._weatherTileCount=128,this.coverage=qt(Wa.coverage[0],Wa.coverage[1],.5),this.density=qt(Wa.density[0],Wa.density[1],.5),this.absorption=qt(Wa.absorption[0],Wa.absorption[1],.5),this.cloudSize=qt(Wa.cloudSize[0],Wa.cloudSize[1],.5),this.detailSize=qt(Wa.detailSize[0],Wa.detailSize[1],.5),this.smoothness=qt(Wa.smoothness[0],Wa.smoothness[1],.5),this.cloudHeight=qt(Wa.cloudHeight[0],Wa.cloudHeight[1],.5),this.raymarchingStepType=Wa.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=Ae(),this._cameraPositionLastFrame=R(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new Wk({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let i=Na((e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*i[0]-1));i=Na(Math.floor(2*this._weatherTileCount*i[0]),Math.floor(4*(this._weatherTileCount-r)*i[1]));let s=0,n=0;if(_(this.view.environment)&&this.view.environment.lighting.type==="sun"&&_(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}return i[0]=(i[0]+s)%(2*this._weatherTileCount),i[1]=(i[1]+n%100)%(4*this._weatherTileCount),i}initialize(){this._vao=qa(this.context.renderContext.rctx);const e=bi(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(se(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),At))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>er(e)),this._techniques=null,this._frameBufferCube=Qe(this._frameBufferCube),this._vao=Qe(this._vao),this._noiseTexture=lt(this._noiseTexture)}_ensureNoiseTexture(){if(M(this._noiseTexture)){const e=this.context;this._noiseTexture=new Q1e({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile)}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();_(this._noiseTexture)&&_(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty())}get frameBufferCube(){if(M(this._frameBufferCube)){const e={target:mt.TEXTURE_CUBE_MAP,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new Or(this.context.renderContext.rctx,{colorTarget:ss.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===so.FADE_OUT||e.fadeInOutHeight.stage!==Qv.FINISHED}applyPreset(e,t){const i=e.median,r=s=>{const n=qt(s[0],s[1],i);return t<.5?qt(s[0],n,2*t):qt(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||M(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!_w(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void le(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const i=this._ensureNoiseTexture();if(M(i))return;const r=this.context.renderContext.rctx,s=r.bindTechnique(t),n=1+this.absorption,o=qt(35,120,this.absorption);s.bindTexture("cloudShapeTexture",i),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",o),s.setUniform1f("sigmaE",n),s.setUniform1f("density",qt(0,.3,this.density)),s.setUniform1f("cloudSize",qt(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",qt(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",qt(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",qt(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const a=r.getViewport();r.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),r.bindFramebuffer(this.frameBufferCube);for(let l=0;l<5;l++){const c=rXe[l],h=sXe[l];Yfe(this._viewMatrix,nXe,c,h),Jh(this._drawParameters.viewMatrix,this._viewMatrix);const p=mt.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.frameBufferCube.setColorTextureTarget(p),s.bindDraw(this._drawParameters,this._bindParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush()}this.running=!1,r.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),e.madeProgress()}};u([d({constructOnly:!0})],Sa.prototype,"context",void 0),u([d({constructOnly:!0})],Sa.prototype,"view",void 0),u([d({constructOnly:!0})],Sa.prototype,"requestRender",void 0),u([d()],Sa.prototype,"_frameTask",void 0),u([d()],Sa.prototype,"coverage",void 0),u([d()],Sa.prototype,"density",void 0),u([d()],Sa.prototype,"absorption",void 0),u([d()],Sa.prototype,"cloudSize",void 0),u([d()],Sa.prototype,"detailSize",void 0),u([d()],Sa.prototype,"smoothness",void 0),u([d()],Sa.prototype,"cloudHeight",void 0),u([d()],Sa.prototype,"raymarchingStepType",void 0),u([d()],Sa.prototype,"running",void 0),Sa=u([P("esri.views.3d.environment.CloudsGenerator")],Sa);const rXe=[$i(1,0,0),$i(-1,0,0),$i(0,1,0),$i(0,-1,0),$i(0,0,1)],sXe=[$i(0,1,0),$i(0,1,0),$i(0,0,-1),$i(0,0,1),$i(0,1,0)],nXe=EZ(),Wa=Z1e.sunny;function oXe(e){const t=new qi;t.attributes.add(O.POSITION,"vec2"),t.include(Yg,{textureCoordinateType:ln.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Er("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Er("inverseViewMatrix",(s,n)=>vs(aXe,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Fi("atmosphereC")),r.uniforms.add(new xl("cameraPosition")),r.uniforms.add(new pi("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new Vr("depthTex")),r.uniforms.add(new Fi("fogStrength")),r.uniforms.add(new Fi("fogAmount")),r.uniforms.add(new xl("fogColor")),t.include(Vk),r.include(zu),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(x`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?x`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const aXe=Ae(),lXe=Object.freeze(Object.defineProperty({__proto__:null,build:oXe},Symbol.toStringTag,{value:"Module"}));class FR extends fr{initializeProgram(t){const i=FR.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return this.configuration.haze?Ut({blending:bo(Me.ONE,Me.ZERO,Me.ONE_MINUS_SRC_COLOR,Me.ONE),colorWrite:ti}):Ut({blending:bo(Me.SRC_ALPHA,Me.ZERO,Me.ONE_MINUS_SRC_ALPHA,Me.ONE),colorWrite:ti})}}FR.shader=new sr(lXe,()=>import("./Fog.glsl.4372c243.js"));class gH extends Ha{constructor(){super(...arguments),this.haze=!1}}u([j()],gH.prototype,"haze",void 0);let FM=class extends Se{constructor(e){super(e),this._fogColor=Ci(),this._fogColorAtNight=Ci(),this._cameraDirection=Ci(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=qa(t,s3);const i=bi(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+uN}destroy(){this._hazeFogTechnique=er(this._hazeFogTechnique),this._thickFogTechnique=er(this._thickFogTechnique),this._vao=Qe(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(M(this._thickFogTechnique)){const e=new gH;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(FR,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(M(this._hazeFogTechnique)){const e=new gH;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(FR,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,i){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,i),this._fogAmount<=0))return;const r=t?this.thickFogTechnique:this.hazeFogTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,n=e.rctx.bindTechnique(r,cXe,e.bindParameters);s.renderDepthDetached(()=>{n.bindTexture("depthTex",s.depthTexture),this._renderFog(r.program,e)})}_renderFog(e,t){if(M(this._vao))return!1;const i=t.rctx,r=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",r.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(It.TRIANGLE_STRIP,0,4),!0}_update(e,t,i){const r=e.bindParameters.camera,s=t?.1:0;i?ne(this._fogColor,.5,.5,.5):t?ne(this._fogColor,1.5,1.5,1.5):ne(this._fogColor,.24,.44,.8),ce(this._fogColorAtNight,this._fogColor,s),we(this._cameraDirection,r.eye);const n=Math.max(0,Te(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));dn(this._fogColor,this._fogColorAtNight,this._fogColor,n);const o=Oe(r.eye),a=o*o;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-M2(this._foggyFadeStart*Ah,this._foggyFadeEnd*Ah,Math.abs(o-this._planetRadius)):1-M2(this._hazeFadeStart*Ah,this._hazeFadeEnd*Ah,Math.abs(o-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],FM.prototype,"context",void 0),u([d({constructOnly:!0})],FM.prototype,"view",void 0),FM=u([P("esri.views.3d.environment.Fog")],FM);const cXe=new Ys;async function Cp(e,t){const{data:i}=await gr(e,F({responseType:"image"},t));return i}var fm;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(fm||(fm={}));class x4 extends Ha{constructor(){super(...arguments),this.geometry=fm.Cone}}u([j({count:fm.COUNT})],x4.prototype,"geometry",void 0);function Uo(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class u_ extends Jr{constructor(t){super(t,"mat4")}}class zZ extends Ys{}function uXe(e){const t=new qi,{vertex:i,fragment:r}=t;if(e.geometry===fm.Underground)t.attributes.add(O.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add([new xt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new xl("cameraPosition"),new Fi("undergroundFadeAlpha")]),i.code.add(x`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(x`void main() {
gl_FragColor = color;
}`);else{t.include(Uo),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===fm.Cylinder;i.uniforms.add([new Er("proj",(a,l)=>l.camera.projectionMatrix),new u_("view"),new xt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)]),s||(t.varyings.add("innerFactor","float"),i.uniforms.add(new xl("silCircleCenter")),i.uniforms.add(new xl("silCircleV1")),i.uniforms.add(new xl("silCircleV2")),i.uniforms.add(new Zg("texV")),i.uniforms.add(new Fi("innerScale")));const n=6.2831853,o=1/128;i.code.add(x`
		void main(void) {
      ${s?x`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:x`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${x.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${x.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new Vt("tex",a=>a.texture)),s||r.uniforms.add(new Fi("altitudeFade")),r.code.add(x`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?x`gl_FragColor = atmosphereColor;`:x`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const hXe=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:zZ,build:uXe},Symbol.toStringTag,{value:"Module"}));class hE extends fr{initializeProgram(t){const i=hE.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return this.configuration.geometry===fm.Cylinder?Ut({blending:bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),culling:_Z,depthTest:{func:yr.LEQUAL},colorWrite:ti}):Ut({blending:bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:yr.LEQUAL},colorWrite:ti})}}hE.shader=new sr(hXe,()=>import("./SimpleAtmosphere.glsl.07ace4ee.js"));const rbe="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function Dc(e,t=0){const i=e.stride;return e.fieldNames.filter(r=>{const s=e.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,o=dXe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new go(r,n,o,a,i,l,t)})}function dXe(e){const t=pXe[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const pXe={u8:dt.UNSIGNED_BYTE,u16:dt.UNSIGNED_SHORT,u32:dt.UNSIGNED_INT,i8:dt.BYTE,i16:dt.SHORT,i32:dt.INT,f32:dt.FLOAT};class VZ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}VZ.ElementCount=9;class BZ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}BZ.ElementCount=16;class My{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,i){this.typedBuffer[t*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}}My.ElementCount=1;class Oy{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,di(i,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t]=i[1]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Oy.ElementCount=2;class Ry{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,ne(i,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t]=i[2]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t]=s}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Ry.ElementCount=3;class Py{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,Ji(i,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t++]=i[2],this.typedBuffer[t]=i[3]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Py.ElementCount=4;class o3 extends My{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}static fromTypedArray(t,i){return new o3(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}o3.ElementType="f32";class ed extends Oy{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(ed,t,i)}static fromTypedArray(t,i){return new ed(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ed.ElementType="f32";class Hi extends Ry{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Hi,t,i)}static fromTypedArray(t,i){return new Hi(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Hi.ElementType="f32";class jn extends Py{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(jn,t,i)}static fromTypedArray(t,i){return new jn(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}jn.ElementType="f32";class Ap extends VZ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Ap,t,i)}static fromTypedArray(t,i){return new Ap(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Ap.ElementType="f32";class h_ extends VZ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(h_,t,i)}static fromTypedArray(t,i){return new h_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}h_.ElementType="f64";class dE extends BZ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(dE,t,i)}static fromTypedArray(t,i){return new dE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}dE.ElementType="f32";class d_ extends BZ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(d_,t,i)}static fromTypedArray(t,i){return new d_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}d_.ElementType="f64";class pE extends My{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(pE,t,i)}static fromTypedArray(t,i){return new pE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}pE.ElementType="f64";class fE extends Oy{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(fE,t,i)}static fromTypedArray(t,i){return new fE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}fE.ElementType="f64";class Cs extends Ry{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Cs,t,i)}static fromTypedArray(t,i){return new Cs(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Cs.ElementType="f64";class Uw extends Py{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Uw,t,i)}static fromTypedArray(t,i){return new Uw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Uw.ElementType="f64";class gy extends My{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(gy,t,i)}static fromTypedArray(t,i){return new gy(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}gy.ElementType="u8";class zw extends Oy{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(zw,t,i)}static fromTypedArray(t,i){return new zw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}zw.ElementType="u8";class p_ extends Ry{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(p_,t,i)}static fromTypedArray(t,i){return new p_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}p_.ElementType="u8";class $l extends Py{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer($l,t,i)}static fromTypedArray(t,i){return new $l(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}$l.ElementType="u8";class Vw extends My{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(Vw,t,i)}static fromTypedArray(t,i){return new Vw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Vw.ElementType="u16";class mE extends Oy{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(mE,t,i)}static fromTypedArray(t,i){return new mE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}mE.ElementType="u16";class Bw extends Ry{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(Bw,t,i)}static fromTypedArray(t,i){return new Bw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Bw.ElementType="u16";class f_ extends Py{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(f_,t,i)}static fromTypedArray(t,i){return new f_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}f_.ElementType="u16";class Gw extends My{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(Gw,t,i)}static fromTypedArray(t,i){return new Gw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Gw.ElementType="u32";class gE extends Oy{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(gE,t,i)}static fromTypedArray(t,i){return new gE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}gE.ElementType="u32";class kR extends Ry{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(kR,t,i)}static fromTypedArray(t,i){return new kR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}kR.ElementType="u32";class UR extends Py{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(UR,t,i)}static fromTypedArray(t,i){return new UR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}UR.ElementType="u32";class yE extends My{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(yE,t,i)}static fromTypedArray(t,i){return new yE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}yE.ElementType="i8";class jw extends Oy{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(jw,t,i)}static fromTypedArray(t,i){return new jw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}jw.ElementType="i8";class zR extends Ry{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(zR,t,i)}static fromTypedArray(t,i){return new zR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}zR.ElementType="i8";class VR extends Py{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(VR,t,i)}static fromTypedArray(t,i){return new VR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}VR.ElementType="i8";class BR extends My{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(BR,t,i)}static fromTypedArray(t,i){return new BR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}BR.ElementType="i16";class Hw extends Oy{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(Hw,t,i)}static fromTypedArray(t,i){return new Hw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Hw.ElementType="i16";class GR extends Ry{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(GR,t,i)}static fromTypedArray(t,i){return new GR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}GR.ElementType="i16";class jR extends Py{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(jR,t,i)}static fromTypedArray(t,i){return new jR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}jR.ElementType="i16";class HR extends My{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(HR,t,i)}static fromTypedArray(t,i){return new HR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}HR.ElementType="i32";class qR extends Oy{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(qR,t,i)}static fromTypedArray(t,i){return new qR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}qR.ElementType="i32";class WR extends Ry{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(WR,t,i)}static fromTypedArray(t,i){return new WR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}WR.ElementType="i32";class XR extends Py{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(XR,t,i)}static fromTypedArray(t,i){return new XR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}XR.ElementType="i32";function sbe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function fXe(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function mXe(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function gXe(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class T4{constructor(t,i){this.layout=t,this.buffer=typeof i=="number"?new ArrayBuffer(i*t.stride):i;for(const r of t.fieldNames){const s=t.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,i){const r=this[t];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(t,i){return new T4(this.layout,this.buffer.slice(t*this.stride,i*this.stride))}copyFrom(t,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}}class GZ{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,i){return this._appendField(t,ed,i),this}vec2f64(t,i){return this._appendField(t,fE,i),this}vec3f(t,i){return this._appendField(t,Hi,i),this}vec3f64(t,i){return this._appendField(t,Cs,i),this}vec4f(t,i){return this._appendField(t,jn,i),this}vec4f64(t,i){return this._appendField(t,Uw,i),this}mat3f(t,i){return this._appendField(t,Ap,i),this}mat3f64(t,i){return this._appendField(t,h_,i),this}mat4f(t,i){return this._appendField(t,dE,i),this}mat4f64(t,i){return this._appendField(t,d_,i),this}vec4u8(t,i){return this._appendField(t,$l,i),this}f32(t,i){return this._appendField(t,o3,i),this}f64(t,i){return this._appendField(t,pE,i),this}u8(t,i){return this._appendField(t,gy,i),this}u16(t,i){return this._appendField(t,Vw,i),this}i8(t,i){return this._appendField(t,yE,i),this}vec2i8(t,i){return this._appendField(t,jw,i),this}vec2i16(t,i){return this._appendField(t,Hw,i),this}vec2u8(t,i){return this._appendField(t,zw,i),this}vec4u16(t,i){return this._appendField(t,f_,i),this}u32(t,i){return this._appendField(t,Gw,i),this}_appendField(t,i,r){const s=i.ElementCount*sbe(i.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new T4(this,t)}createView(t){return new T4(this,t)}clone(){const t=new GZ;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((i,r)=>t.fields.set(r,i)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function ls(){return new GZ}var yH;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=i,e.scale=r,e.add=s,e.subtract=n})(yH||(yH={}));const ma=Ht();class yXe{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function pt(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new yXe(t)}function Ix(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function Cse(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],h=(r[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function JI(e,t,i,r,s,n=st()){const o=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),a=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function Ase(e,t,i,r,s){s||(s=e),ma[0]=e[0],ma[1]=e[1],ma[2]=e[2],ma[3]=1,xu(ma,ma,t),s.length>2&&(s[2]=-ma[2]),xu(ma,ma,i),pt(ma[3]!==0),s[0]=ma[0]/ma[3],s[1]=ma[1]/ma[3],s[2]=ma[2]/ma[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function vXe(e,t){return Math.log(e)/Math.log(t)}function nbe(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function obe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function _Xe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function bXe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function wXe(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function xXe(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}class Yk{constructor(t,i,r,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this.center=R(),pt(t.length>=1),pt(r.length%this._numIndexPerPrimitive==0),pt(r.length>=t.length*this._numIndexPerPrimitive),pt(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*r[this._numIndexPerPrimitive*t[0]];Y_.clear(),Y_.push(l),this.bbMin=Fe(n[l],n[l+1],n[l+2]),this.bbMax=Bs(this.bbMin);for(let h=0;h<a;++h){const p=this._numIndexPerPrimitive*t[h];for(let f=0;f<this._numIndexPerPrimitive;++f){l=o*r[p+f],Y_.push(l);let m=n[l];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=n[l+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=n[l+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}}dn(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let h=0;h<Y_.length;++h){l=Y_.getItemAt(h);const p=n[l]-this.center[0],f=n[l+1]-this.center[1],m=n[l+2]-this.center[2],y=p*p+f*f+m*m;if(y<=c)continue;const v=Math.sqrt(y),w=.5*(v-this.radius);this.radius=this.radius+w,c=this.radius*this.radius;const b=w/v;this.center[0]+=p*b,this.center[1]+=f*b,this.center[2]+=m*b}Y_.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Gs(this.bbMin,this.bbMax)>1){const t=dn(R(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],v=n[f+2];for(let w=1;w<this._numIndexPerPrimitive;++w){f=o*this.indices[p+w];const b=n[f],S=n[f+1],T=n[f+2];b<m&&(m=b),S<y&&(y=S),T<v&&(v=T)}m<t[0]&&(h|=1),y<t[1]&&(h|=2),v<t[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new Yk(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){Y_.prune()}}const Y_=new Gt({deallocator:null});class a3{constructor(){this.id=Tl()}unload(){}}var Mp;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(Mp||(Mp={}));function Mse(e,t,i){const r=t[0]-e[0],s=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return .5*Math.abs(r*o-s*n)}function TXe(e,t,i){return pe(pV,t,e),pe(Ose,i,e),Oe(ct(pV,pV,Ose))/2}new Ty(Sm);new Ty(()=>({p0:null,p1:null,p2:null}));const pV=R(),Ose=R();let lv=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const abe=new Uint16Array([0]),S4=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function vE(e){if(e===1)return abe;if(e<S4.length)return new Uint16Array(S4.buffer,0,e);if(e>lv.length){const t=Math.max(2*lv.length,e);lv=new Uint32Array(t);for(let i=0;i<lv.length;i++)lv[i]=i}return new Uint32Array(lv.buffer,0,e)}function MSt(e){if(e===1)return new Uint16Array(abe);if(e<S4.length)return new Uint16Array(S4.slice(0,e));if(e>lv.length){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}return new Uint32Array(lv.slice(0,e))}function lbe(e,t,i){if(!e)return!1;const{size:r,data:s}=e;ne(i,0,0,0),ne(Sh,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*r,c=t[a+1]*r,h=t[a+2]*r;ne(kn,s[l+0],s[l+1],s[l+2]),ne(kg,s[c+0],s[c+1],s[c+2]),ne(KI,s[h+0],s[h+1],s[h+2]);const p=TXe(kn,kg,KI);p?(de(kn,kn,kg),de(kn,kn,KI),ce(kn,kn,1/3*p),de(i,i,kn),n+=p):(de(Sh,Sh,kn),de(Sh,Sh,kg),de(Sh,Sh,KI),o+=3)}return(o!==0||n!==0)&&(n!==0?(ce(i,i,1/n),!0):o!==0&&(ce(i,Sh,1/o),!0))}function cbe(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;ne(i,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&ce(i,i,1/o),o>0}function jZ(e,t,i,r){if(!e)return!1;const{size:s,data:n}=e;ne(r,0,0,0),ne(Sh,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(t?t[p]:p)*s,y=(t?t[f]:f)*s;kn[0]=n[m+0],kn[1]=n[m+1],kn[2]=n[m+2],kg[0]=n[y+0],kg[1]=n[y+1],kg[2]=n[y+2],ce(kn,de(kn,kn,kg),.5);const v=gW(kn,kg);v>0?(de(r,r,ce(kn,kn,v)),o+=v):(de(Sh,Sh,kn),a++)}return o!==0?(ce(r,r,1/o),!0):a!==0&&(ce(r,Sh,1/a),!0)}const kn=R(),kg=R(),KI=R(),Sh=R();class kr extends a3{constructor(t,i=[],r=Al.Triangle,s=-1){super(),this._primitiveType=r,this.edgeIndicesLength=s,this.type=Mp.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,o]of t)o&&this._vertexAttributes.set(n,F({},o));if(i==null||i.length===0){const n=SXe(this._vertexAttributes),o=vE(n);this.edgeIndicesLength=this.edgeIndicesLength<0?n:this.edgeIndicesLength;for(const a of this._vertexAttributes.keys())this._indices.set(a,o)}else for(const[n,o]of i)o&&(this._indices.set(n,EXe(o)),n===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new kr([],void 0,this._primitiveType,void 0),{_vertexAttributes:i,_indices:r}=t;return this._vertexAttributes.forEach((s,n)=>{i.set(n,s)}),this._indices.forEach((s,n)=>{r.set(n,s)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const i=this._vertexAttributes.get(t);return i&&!i.exclusive&&(i.data=Array.from(i.data),i.exclusive=!0),i}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return M(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===Al.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const i=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);return lbe(r,i,t)}_computeAttachmentOriginPoints(t){const i=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);return cbe(r,i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(O.POSITION);if(t.length===0)return null;const i=this.primitiveType===Al.Triangle?3:1;pt(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const r=vE(t.length/i),s=this.vertexAttributes.get(O.POSITION);return new Yk(r,i,t,s)}}function SXe(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function EXe(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const $x=yH;var fV,mV,gV,vH;(function(e){const i=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let c=0;c<6;c++)for(let h=0;h<6;h++)o[6*c+h]=c;const a=new Uint16Array(36);for(let c=0;c<6;c++)a[6*c+0]=0,a[6*c+1]=1,a[6*c+2]=2,a[6*c+3]=2,a[6*c+4]=3,a[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const h=new Array(24);for(let p=0;p<8;p++)h[3*p]=i[p][0]*c[0],h[3*p+1]=i[p][1]*c[1],h[3*p+2]=i[p][2]*c[2];return new kr([[O.POSITION,{size:3,data:h,exclusive:!0}],[O.NORMAL,{size:3,data:r}],[O.UV0,{size:2,data:s}]],[[O.POSITION,n],[O.NORMAL,o],[O.UV0,a]])}e.createGeometry=l})(fV||(fV={})),function(e){const i=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(a){Array.isArray(a)||(a=[a,a,a]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=i[c][0]*a[0],l[3*c+1]=i[c][1]*a[1],l[3*c+2]=i[c][2]*a[2];return new kr([[O.POSITION,{size:3,data:l,exclusive:!0}],[O.NORMAL,{size:3,data:r}]],[[O.POSITION,s],[O.NORMAL,n]])}e.createGeometry=o}(mV||(mV={})),function(e){const r=$i(-.5,0,-.5),s=$i(.5,0,-.5),n=$i(0,0,.5),o=$i(0,0+.5,0),a=Ci(),l=Ci(),c=Ci(),h=Ci(),p=Ci();pe(a,r,o),pe(l,r,s),ct(c,a,l),we(c,c),pe(a,s,o),pe(l,s,n),ct(h,a,l),we(h,h),pe(a,n,o),pe(l,n,r),ct(p,a,l),we(p,p);const f=[r,s,n,o],m=[0,-1,0,c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function w(b){Array.isArray(b)||(b=[b,b,b]);const S=new Array(12);for(let T=0;T<4;T++)S[3*T]=f[T][0]*b[0],S[3*T+1]=f[T][1]*b[1],S[3*T+2]=f[T][2]*b[2];return new kr([[O.POSITION,{size:3,data:S,exclusive:!0}],[O.NORMAL,{size:3,data:m}]],[[O.POSITION,new Uint16Array(y)],[O.NORMAL,new Uint16Array(v)]])}e.createGeometry=w}(gV||(gV={})),function(e){function t(T,E,C,A={uv:!0}){const I=-Math.PI,L=2*Math.PI,D=-Math.PI/2,U=Math.PI,z=Math.max(3,Math.floor(E)),V=Math.max(2,Math.floor(C)),X=(z+1)*(V+1),Z=new Float32Array(3*X),ae=new Float32Array(3*X),re=new Float32Array(2*X),$=[];let k=0;for(let ee=0;ee<=V;ee++){const G=[],te=ee/V,fe=D+te*U,xe=Math.cos(fe);for(let Le=0;Le<=z;Le++){const _e=Le/z,ye=I+_e*L,Ce=Math.cos(ye)*xe,Pe=Math.sin(fe),xi=-Math.sin(ye)*xe;Z[3*k]=Ce*T,Z[3*k+1]=Pe*T,Z[3*k+2]=xi*T,ae[3*k]=Ce,ae[3*k+1]=Pe,ae[3*k+2]=xi,re[2*k]=_e,re[2*k+1]=te,G.push(k),++k}$.push(G)}const B=new Uint32Array(2*z*(V-1)*3);k=0;for(let ee=0;ee<V;ee++)for(let G=0;G<z;G++){const te=$[ee][G],fe=$[ee][G+1],xe=$[ee+1][G+1],Le=$[ee+1][G];ee===0?(B[k++]=te,B[k++]=xe,B[k++]=Le):ee===V-1?(B[k++]=te,B[k++]=fe,B[k++]=xe):(B[k++]=te,B[k++]=fe,B[k++]=xe,B[k++]=xe,B[k++]=Le,B[k++]=te)}const H=[[O.POSITION,B],[O.NORMAL,B]],Y=[[O.POSITION,{size:3,data:Z,exclusive:!0}],[O.NORMAL,{size:3,data:ae,exclusive:!0}]];return A.uv&&(Y.push([O.UV0,{size:2,data:re,exclusive:!0}]),H.push([O.UV0,B])),A.offset&&(H[0][0]=O.OFFSET,Y[0][0]=O.OFFSET,H.push([O.POSITION,new Uint32Array(B.length)]),Y.push([O.POSITION,{size:3,data:Float64Array.from(A.offset),exclusive:!0}])),new kr(Y,H)}function i(T,E,C){const A=T;let I,L;if(C)I=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],L=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const Z=A*(1+Math.sqrt(5))/2;I=[-A,Z,0,A,Z,0,-A,-Z,0,A,-Z,0,0,-A,Z,0,A,Z,0,-A,-Z,0,A,-Z,Z,0,-A,Z,0,A,-Z,0,-A,-Z,0,A],L=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let Z=0;Z<I.length;Z+=3)$x.scale(I,Z,T/$x.length(I,Z));let D={};function U(Z,ae){Z>ae&&([Z,ae]=[ae,Z]);const re=Z.toString()+"."+ae.toString();if(D[re])return D[re];let $=I.length;return I.length+=3,$x.add(I,3*Z,I,3*ae,I,$),$x.scale(I,$,T/$x.length(I,$)),$/=3,D[re]=$,$}for(let Z=0;Z<E;Z++){const ae=L.length,re=new Uint32Array(4*ae);for(let $=0;$<ae;$+=3){const k=L[$],B=L[$+1],H=L[$+2],Y=U(k,B),ee=U(B,H),G=U(H,k),te=4*$;re[te]=k,re[te+1]=Y,re[te+2]=G,re[te+3]=B,re[te+4]=ee,re[te+5]=Y,re[te+6]=H,re[te+7]=G,re[te+8]=ee,re[te+9]=Y,re[te+10]=ee,re[te+11]=G}L=re,D={}}const z=new Float32Array(I);for(let Z=0;Z<z.length;Z+=3)$x.normalize(z,Z);const V=[[O.POSITION,L],[O.NORMAL,L]],X=[[O.POSITION,{size:3,data:new Float32Array(I),exclusive:!0}],[O.NORMAL,{size:3,data:z,exclusive:!0}]];return new kr(X,V)}function r(T,E,C,A,I,L,D){const U=E?[E[0],E[1],E[2]]:[0,0,0],z=T?[T[0],T[1],T[2]]:[0,0,1];L=L||[0,0];const V=C?[255*C[0],255*C[1],255*C[2],C.length>3?255*C[3]:255]:[255,255,255,255],X=A!=null&&A.length===2?A:[1,1],Z=[[O.POSITION,{size:3,data:U,exclusive:!0}],[O.NORMAL,{size:3,data:z,exclusive:!0}],[O.UV0,{size:L.length,data:L}],[O.COLOR,{size:4,data:V,exclusive:!0}],[O.SIZE,{size:2,data:X}]];if(I!=null){const ae=new Float32Array([I[0],I[1],I[2],I[3]]);Z.push([O.AUXPOS1,{size:4,data:ae}])}if(D!=null){const ae=new Float32Array([D[0],D[1],D[2],D[3]]);Z.push([O.AUXPOS2,{size:4,data:ae}])}return new kr(Z,null,Al.Point)}function s(T,E,C,A,I,L,D,U){if(T!=null){const{data:z}=U.getMutableAttribute(O.NORMAL);z[0]=T[0],z[1]=T[1],z[2]=T[2]}if(E!=null){const{data:z}=U.getMutableAttribute(O.POSITION);z[0]=E[0],z[1]=E[1],z[2]=E[2]}if(C!=null){const{data:z}=U.getMutableAttribute(O.COLOR);z[0]=C[0],z[1]=C[1],z[2]=C[2],z[3]=C[3]}if(A!=null){const{data:z}=U.getMutableAttribute(O.SIZE);z[0]=A[0],z[1]=A[1]}if(I!=null){const{data:z}=U.getMutableAttribute(O.AUXPOS1);z[0]=I[0],z[1]=I[1],z[2]=I[2],z[3]=I[3]}if(L!=null){const{data:z}=U.getMutableAttribute(O.UV0);z[0]=L[0],z[1]=L[1]}if(D!=null){const{data:z}=U.getMutableAttribute(O.AUXPOS2);z[0]=D[0],z[1]=D[1],z[2]=D[2],z[3]=D[3]}}function n(T,E){const C=new Float32Array(3*T.length),A=new Float32Array(E?3*T.length:3),I=new Uint32Array(T.length),L=new Uint32Array(T.length);for(let V=0;V<T.length;V++)C[3*V]=T[V][0],C[3*V+1]=T[V][1],C[3*V+2]=T[V][2],E&&(A[3*V]=E[V][0],A[3*V+1]=E[V][1],A[3*V+2]=E[V][2]),I[V]=V,L[V]=0;E||(A[0]=0,A[1]=1,A[2]=0);const D=[0,0],U=[[O.POSITION,I],[O.NORMAL,E?I:L],[O.UV0,L]],z=[[O.POSITION,{size:3,data:C,exclusive:!0}],[O.NORMAL,{size:3,data:A,exclusive:!0}],[O.UV0,{size:2,data:D,exclusive:!0}]];return new kr(z,U,Al.Point)}function o(){const T=[0,0,0,0,0,100,100,0,0],E=new Uint16Array([0,1,2]),C=[0,1,0],A=new Uint16Array([0,0,0]),I=[0,0],L=new Uint16Array([0,0,0]),D=[[O.POSITION,E],[O.NORMAL,A],[O.UV0,L]],U=[[O.POSITION,{size:3,data:T,exclusive:!0}],[O.NORMAL,{size:3,data:C,exclusive:!0}],[O.UV0,{size:2,data:I,exclusive:!0}]];return new kr(U,D)}e.createBoxGeometry=fV.createGeometry,e.createDiamondGeometry=mV.createGeometry,e.createTetrahedronGeometry=gV.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=s,e.createPointArrayGeometry=n,e.createTriangleGeometry=o;const a=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function l(T=a){const E=new Array(12);for(let V=0;V<4;V++)for(let X=0;X<3;X++)E[3*V+X]=T[V][X];const C=new Uint32Array([0,1,2,2,3,0]),A=[0,0,1],I=new Uint32Array([0,0,0,0,0,0]),L=[0,0,1,0,1,1,0,1],D=[255,255,255,255],U=[[O.POSITION,C],[O.NORMAL,I],[O.UV0,C],[O.COLOR,I]],z=[[O.POSITION,{size:3,data:E,exclusive:!0}],[O.NORMAL,{size:3,data:A,exclusive:!0}],[O.UV0,{size:2,data:L,exclusive:!0}],[O.COLOR,{size:4,data:D,exclusive:!0}]];return new kr(z,U)}function c(T,E,C,A,I=!0,L=!0){let D=0;const U=E,z=T;let V=$i(0,D,0),X=$i(0,D+z,0),Z=$i(0,-1,0),ae=$i(0,1,0);A&&(D=z,X=$i(0,0,0),V=$i(0,D,0),Z=$i(0,1,0),ae=$i(0,-1,0));const re=[X,V],$=[Z,ae],k=C+2,B=Math.sqrt(z*z+U*U);if(A)for(let _e=C-1;_e>=0;_e--){const ye=_e*(2*Math.PI/C),Ce=$i(Math.cos(ye)*U,D,Math.sin(ye)*U);re.push(Ce);const Pe=$i(z*Math.cos(ye)/B,-U/B,z*Math.sin(ye)/B);$.push(Pe)}else for(let _e=0;_e<C;_e++){const ye=_e*(2*Math.PI/C),Ce=$i(Math.cos(ye)*U,D,Math.sin(ye)*U);re.push(Ce);const Pe=$i(z*Math.cos(ye)/B,U/B,z*Math.sin(ye)/B);$.push(Pe)}const H=new Uint32Array(2*(C+2)*3),Y=new Uint32Array(2*(C+2)*3);let ee=0,G=0;if(I){for(let _e=3;_e<re.length;_e++)H[ee++]=1,H[ee++]=_e-1,H[ee++]=_e,Y[G++]=0,Y[G++]=0,Y[G++]=0;H[ee++]=re.length-1,H[ee++]=2,H[ee++]=1,Y[G++]=0,Y[G++]=0,Y[G++]=0}if(L){for(let _e=3;_e<re.length;_e++)H[ee++]=_e,H[ee++]=_e-1,H[ee++]=0,Y[G++]=_e,Y[G++]=_e-1,Y[G++]=1;H[ee++]=0,H[ee++]=2,H[ee++]=re.length-1,Y[G++]=1,Y[G++]=2,Y[G++]=$.length-1}const te=new Float32Array(3*k);for(let _e=0;_e<k;_e++)te[3*_e]=re[_e][0],te[3*_e+1]=re[_e][1],te[3*_e+2]=re[_e][2];const fe=new Float32Array(3*k);for(let _e=0;_e<k;_e++)fe[3*_e]=$[_e][0],fe[3*_e+1]=$[_e][1],fe[3*_e+2]=$[_e][2];const xe=[[O.POSITION,H],[O.NORMAL,Y]],Le=[[O.POSITION,{size:3,data:te,exclusive:!0}],[O.NORMAL,{size:3,data:fe,exclusive:!0}]];return new kr(Le,xe)}function h(T,E,C,A,I,L){const D=A?b4(A):$i(1,0,0),U=I?b4(I):$i(0,0,0);L=L==null||L;const z=Ci();we(z,D);const V=Ci();ce(V,z,Math.abs(T));const X=Ci();ce(X,V,-.5),de(X,X,U);const Z=$i(0,1,0);Math.abs(1-Te(z,Z))<.2&&ne(Z,0,0,1);const ae=Ci();ct(ae,z,Z),we(ae,ae),ct(Z,ae,z);const re=2*C+(L?2:0),$=C+(L?2:0),k=new Float32Array(3*re),B=new Float32Array(3*$),H=new Float32Array(2*re),Y=new Uint32Array(3*C*(L?4:2)),ee=new Uint32Array(3*C*(L?4:2));L&&(k[3*(re-2)+0]=X[0],k[3*(re-2)+1]=X[1],k[3*(re-2)+2]=X[2],H[2*(re-2)]=0,H[2*(re-2)+1]=0,k[3*(re-1)+0]=k[3*(re-2)+0]+V[0],k[3*(re-1)+1]=k[3*(re-2)+1]+V[1],k[3*(re-1)+2]=k[3*(re-2)+2]+V[2],H[2*(re-1)]=1,H[2*(re-1)+1]=1,B[3*($-2)+0]=-z[0],B[3*($-2)+1]=-z[1],B[3*($-2)+2]=-z[2],B[3*($-1)+0]=z[0],B[3*($-1)+1]=z[1],B[3*($-1)+2]=z[2]);const G=(ye,Ce,Pe)=>{Y[ye]=Ce,ee[ye]=Pe};let te=0;const fe=Ci(),xe=Ci();for(let ye=0;ye<C;ye++){const Ce=ye*(2*Math.PI/C);ce(fe,Z,Math.sin(Ce)),ce(xe,ae,Math.cos(Ce)),de(fe,fe,xe),B[3*ye+0]=fe[0],B[3*ye+1]=fe[1],B[3*ye+2]=fe[2],ce(fe,fe,E),de(fe,fe,X),k[3*ye+0]=fe[0],k[3*ye+1]=fe[1],k[3*ye+2]=fe[2],H[2*ye+0]=ye/C,H[2*ye+1]=0,k[3*(ye+C)+0]=k[3*ye+0]+V[0],k[3*(ye+C)+1]=k[3*ye+1]+V[1],k[3*(ye+C)+2]=k[3*ye+2]+V[2],H[2*(ye+C)+0]=ye/C,H[2*ye+1]=1;const Pe=(ye+1)%C;G(te++,ye,ye),G(te++,ye+C,ye),G(te++,Pe,Pe),G(te++,Pe,Pe),G(te++,ye+C,ye),G(te++,Pe+C,Pe)}if(L){for(let ye=0;ye<C;ye++){const Ce=(ye+1)%C;G(te++,re-2,$-2),G(te++,ye,$-2),G(te++,Ce,$-2)}for(let ye=0;ye<C;ye++){const Ce=(ye+1)%C;G(te++,ye+C,$-1),G(te++,re-1,$-1),G(te++,Ce+C,$-1)}}const Le=[[O.POSITION,Y],[O.NORMAL,ee],[O.UV0,Y]],_e=[[O.POSITION,{size:3,data:k,exclusive:!0}],[O.NORMAL,{size:3,data:B,exclusive:!0}],[O.UV0,{size:2,data:H,exclusive:!0}]];return new kr(_e,Le)}function p(T,E,C,A,I){C=C||10,A=A==null||A,pt(T.length>1);const L=[[0,0,0]],D=[],U=[];for(let z=0;z<C;z++){D.push([0,-z-1,-(z+1)%C-1]);const V=z/C*2*Math.PI;U.push([Math.cos(V)*E,Math.sin(V)*E])}return e.createPathExtrusionGeometry(U,T,L,D,A,I)}function f(T,E,C,A,I,L=$i(0,0,0)){const D=T.length,U=new Float32Array(E.length*D*3+(6*C.length||0)),z=new Float32Array(E.length*D*3+(C?6:0)),V=(E.length-1)*D*6+3*A.length*2,X=new Uint32Array(V),Z=new Uint32Array(V);let ae=0,re=0,$=0,k=0;const B=Ci(),H=Ci(),Y=Ci(),ee=Ci(),G=Ci(),te=Ci(),fe=Ci(),xe=R(),Le=Ci(),_e=Ci(),ye=Ci(),Ce=Ci(),Pe=Ci(),xi=vi();ne(Le,0,1,0),pe(H,E[1],E[0]),we(H,H),I?(de(xe,E[0],L),we(Y,xe)):ne(Y,0,0,1),S(H,Y,Le,Le,G,Y,Rse),le(ee,Y),le(Ce,G);for(let Ye=0;Ye<C.length;Ye++)ce(te,G,C[Ye][0]),ce(xe,Y,C[Ye][2]),de(te,te,xe),de(te,te,E[0]),U[ae++]=te[0],U[ae++]=te[1],U[ae++]=te[2];z[re++]=-H[0],z[re++]=-H[1],z[re++]=-H[2];for(let Ye=0;Ye<A.length;Ye++)X[$++]=A[Ye][0]>0?A[Ye][0]:-A[Ye][0]-1+C.length,X[$++]=A[Ye][1]>0?A[Ye][1]:-A[Ye][1]-1+C.length,X[$++]=A[Ye][2]>0?A[Ye][2]:-A[Ye][2]-1+C.length,Z[k++]=0,Z[k++]=0,Z[k++]=0;let Ti=C.length;const Xt=C.length-1;for(let Ye=0;Ye<E.length;Ye++){let Wi=!1;Ye>0&&(le(B,H),Ye<E.length-1?(pe(H,E[Ye+1],E[Ye]),we(H,H)):Wi=!0,de(_e,B,H),we(_e,_e),de(ye,E[Ye-1],ee),q2(E[Ye],_e,xi),dx(xi,Uu(ye,B),xe)?(pe(xe,xe,E[Ye]),we(Y,xe),ct(G,_e,Y),we(G,G)):S(_e,ee,Ce,Le,G,Y,Rse),le(ee,Y),le(Ce,G)),I&&(de(xe,E[Ye],L),we(Pe,xe));for(let Zs=0;Zs<D;Zs++)if(ce(te,G,T[Zs][0]),ce(xe,Y,T[Zs][1]),de(te,te,xe),we(fe,te),z[re++]=fe[0],z[re++]=fe[1],z[re++]=fe[2],de(te,te,E[Ye]),U[ae++]=te[0],U[ae++]=te[1],U[ae++]=te[2],!Wi){const wo=(Zs+1)%D;X[$++]=Ti+Zs,X[$++]=Ti+D+Zs,X[$++]=Ti+wo,X[$++]=Ti+wo,X[$++]=Ti+D+Zs,X[$++]=Ti+D+wo;for(let An=0;An<6;An++)Z[k++]=X[$-6+An]-Xt}Ti+=D}const Pi=E[E.length-1];for(let Ye=0;Ye<C.length;Ye++)ce(te,G,C[Ye][0]),ce(xe,Y,C[Ye][1]),de(te,te,xe),de(te,te,Pi),U[ae++]=te[0],U[ae++]=te[1],U[ae++]=te[2];const Yt=re/3;z[re++]=H[0],z[re++]=H[1],z[re++]=H[2];const Si=Ti-D;for(let Ye=0;Ye<A.length;Ye++)X[$++]=A[Ye][0]>=0?Ti+A[Ye][0]:-A[Ye][0]-1+Si,X[$++]=A[Ye][2]>=0?Ti+A[Ye][2]:-A[Ye][2]-1+Si,X[$++]=A[Ye][1]>=0?Ti+A[Ye][1]:-A[Ye][1]-1+Si,Z[k++]=Yt,Z[k++]=Yt,Z[k++]=Yt;const Ir=[[O.POSITION,X],[O.NORMAL,Z]],Hr=[[O.POSITION,{size:3,data:U,exclusive:!0}],[O.NORMAL,{size:3,data:z,exclusive:!0}]];return new kr(Hr,Ir)}function m(T,E,C){pt(T.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),pt(T[0].length===3,"createPolylineGeometry(): malformed vertex"),pt(E==null||E.length===T.length,"createPolylineGeometry: need same number of points and normals"),pt(E==null||E[0].length===3,"createPolylineGeometry(): malformed normal");const A=new Float64Array(3*T.length),I=new Uint32Array(2*(T.length-1));let L=0,D=0;for(let V=0;V<T.length;V++){for(let X=0;X<3;X++)A[L++]=T[V][X];V>0&&(I[D++]=V-1,I[D++]=V)}const U=[],z=[];if(U.push([O.POSITION,I]),z.push([O.POSITION,{size:3,data:A,exclusive:!0}]),E){const V=new Float32Array(3*E.length);let X=0;for(let Z=0;Z<T.length;Z++)for(let ae=0;ae<3;ae++)V[X++]=E[Z][ae];U.push([O.NORMAL,I]),z.push([O.NORMAL,{size:3,data:V,exclusive:!0}])}return C&&(z.push([O.COLOR,{size:4,data:C}]),U.push([O.COLOR,vE(C.length/4)])),new kr(z,U,Al.Line)}function y(T,E,C,A,I=0){const L=new Array(18),D=[[-E,I,A/2],[C,I,A/2],[0,T+I,A/2],[-E,I,-A/2],[C,I,-A/2],[0,T+I,-A/2]],U=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let z=0;z<6;z++)L[3*z]=D[z][0],L[3*z+1]=D[z][1],L[3*z+2]=D[z][2];return new kr([[O.POSITION,{size:3,data:L,exclusive:!0}]],[[O.POSITION,U]])}function v(T,E){const C=T.getMutableAttribute(O.POSITION).data;for(let A=0;A<C.length;A+=3){const I=C[A],L=C[A+1],D=C[A+2];ne(Dx,I,L,D),ke(Dx,Dx,E),C[A]=Dx[0],C[A+1]=Dx[1],C[A+2]=Dx[2]}}function w(T,E=T){const C=T.vertexAttributes,A=C.get(O.POSITION).data,I=C.get(O.NORMAL).data;if(I){const L=E.getMutableAttribute(O.NORMAL).data;for(let D=0;D<I.length;D+=3){const U=I[D+1];L[D+1]=-I[D+2],L[D+2]=U}}if(A){const L=E.getMutableAttribute(O.POSITION).data;for(let D=0;D<A.length;D+=3){const U=A[D+1];L[D+1]=-A[D+2],L[D+2]=U}}return E}function b(T,E,C,A,I){return!(Math.abs(Te(E,T))>I)&&(ct(C,T,E),we(C,C),ct(A,C,T),we(A,A),!0)}function S(T,E,C,A,I,L,D){return b(T,E,I,L,D)||b(T,C,I,L,D)||b(T,A,I,L,D)}e.createSquareGeometry=l,e.createConeGeometry=c,e.createCylinderGeometry=h,e.createTubeGeometry=p,e.createPathExtrusionGeometry=f,e.createPolylineGeometry=m,e.createExtrudedTriangle=y,e.transformInPlace=v,e.cgToGIS=w,e.makeOrthoBasisDirUp=b,e.makeOrthoBasisDirUpFallback=S}(vH||(vH={}));const Rse=.99619469809,Dx=Ci(),sc=vH,CXe=ge.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class AXe{constructor(){this.type="panoramic",this._techniqueConfig=new x4,this._passParameters=new zZ,this._readyResolver=bp(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=Qe(this._passParameters.texture),this._vao=Qe(this._vao),this._readyController=Xh(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=fm.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(hE,this._techniqueConfig);const i=t.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=ko(this._vao,"geometry"),Cp(rbe,{signal:this._readyController.signal}).then(r=>{this._passParameters.texture=new ot(i,{pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!0},r),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(r=>{Qr(r)||CXe.error("Unable to initialize atmosphere: image request failed",r),this._readyResolver.reject()})}get canRender(){return this._passParameters.texture!=null}render(t){const i=t.rctx,r=i.bindTechnique(this._technique,this._passParameters,t.bindParameters);MXe(Pse,t.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",Pse),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(It.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const i=sc.createPolySphereGeometry(1,2,!1),r=i.indices.get(O.POSITION);for(let a=0;a<r.length;a+=3){const l=r[a];r[a]=r[a+2],r[a+2]=l}const s=i.vertexAttributes.get(O.POSITION).data,n=Ise.createBuffer(r.length),o=n.position;for(let a=0;a<r.length;++a){const l=3*r[a];o.set(a,0,s[l]),o.set(a,1,s[l+1]),o.set(a,2,s[l+2])}return new qs(t,zi,{geometry:Dc(Ise)},{geometry:si.createVertex(t,_i.STATIC_DRAW,n.buffer)})}}function MXe(e,t){Ts(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const Pse=Ae(),Ise=ls().vec3f(O.POSITION);var m_;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(m_||(m_={}));class _H extends Ha{constructor(){super(...arguments),this.type=m_.Rain}}u([j({count:m_.COUNT})],_H.prototype,"type",void 0);function OXe(e){const t=new qi;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new xl("cameraPosition")),t.vertex.uniforms.add(new xl("offset")),t.vertex.uniforms.add(new Fi("width")),t.vertex.uniforms.add(new Er("proj",(i,r)=>r.camera.projectionMatrix)),t.vertex.uniforms.add(new u_("view")),t.vertex.uniforms.add(new Fi("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(x`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===m_.Rain?x`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:x`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new Fi("opacity")),t.fragment.uniforms.add(new xl("particleColor")),t.fragment.code.add(x`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===m_.Rain?x`d = 0.35 * smoothstep(0.5, 0.0, d);`:x`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const RXe=Object.freeze(Object.defineProperty({__proto__:null,build:OXe},Symbol.toStringTag,{value:"Module"}));class PXe extends Ys{constructor(){super(...arguments),this.time=0,this.radius=1}}class Vg extends fr{initializeProgram(t){const i=Vg.shader.get().build(this.configuration);return new nr(t.rctx,i,Vg.attributeLocation)}initializePipeline(){return Ut({blending:bo(Me.ONE,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:yr.LEQUAL},colorWrite:ti})}}Vg.shader=new sr(RXe,()=>import("./Precipitation.glsl.c591c51b.js")),Vg.attributeLocation=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);class ube{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return _(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let nb=class extends Se{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=R(),this._tile=R(),this._particleColor=Ci(),this._particleColorAtNight=Ci(),this._nightMultiplier=.7,this._cameraDirection=Ci(),this._renderParameters=new PXe,this._animation=new ube,this._updatingTracking=new Zf,this._renderParameters.time=0,this._renderParameters.radius=bi(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=er(this._snowTechnique),this._rainTechnique=er(this._rainTechnique),this._vao=Qe(this._vao),this._instanceIdBuffer=Qe(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(M(this._rainTechnique)){const e=new _H;e.type=m_.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(Vg,e)}return this._rainTechnique}get snowTechnique(){if(M(this._snowTechnique)){const e=new _H;e.type=m_.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(Vg,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,i){const r=i==="rainy",s=r?this.rainTechnique:this.snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),M(s)||M(this._vao)||M(this._instanceIdBuffer)||(_(e.bindParameters.clouds.data)&&(this._opacity=1-e.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0))return;const o=.35;t=t<.5?qt(0,o,2*t):qt(o,1,2*(t-.5));const a=n.bindTechnique(s);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(r?this._rainSpeed:this._snowSpeed)*lW(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(a,i,e),n.bindVAO(this._vao);const l=Vg.attributeLocation;a.assertCompatibleVertexAttributeLocations(this._vao),wZ(n,l,this._instanceIdBuffer,$se,0),n.capabilities.instancing.drawArraysInstanced(It.TRIANGLES,0,3,this._numParticles*t),xZ(n,l,this._instanceIdBuffer,$se)}_update(e,t,i){const r=i.bindParameters.camera,s=r.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",r.viewMatrix),e.setUniform3fv("cameraPosition",s),e.bindPass(null,i.bindParameters),e.setUniform1f("time",this._renderParameters.time),t==="rainy"?ne(this._particleColor,.85,.85,.85):ne(this._particleColor,1,1,1),ce(this._particleColorAtNight,this._particleColor,this._nightMultiplier),we(this._cameraDirection,s);const n=Math.max(0,Te(this._cameraDirection,i.bindParameters.lighting.lightingMainDirection));dn(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){M(this._vao)&&(this._vao=this._createVertexArrayObject(e)),M(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let i=0;i<this._numParticles;i++)t.push(i);return si.createVertex(e,_i.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new qs(e,Vg.attributeLocation,{geometry:Dc(IXe)},{geometry:si.createVertex(e,_i.STATIC_DRAW,t)})}};u([d({constructOnly:!0})],nb.prototype,"context",void 0),u([d({constructOnly:!0})],nb.prototype,"view",void 0),u([d({readOnly:!0})],nb.prototype,"updating",null),u([d()],nb.prototype,"_updatingTracking",void 0),nb=u([P("esri.views.3d.environment.Precipitation")],nb);const IXe=ls().vec3f(O.POSITION),$se=Dc(ls().f32(O.INSTANCEFEATUREATTRIBUTE),1),$Xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",DXe=ge.getLogger("esri.views.3d.environment.SimpleAtmosphere"),e$=128,Dse=-hH,Lse=0,yV=50,LXe=()=>1-511/512,NXe=EL([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class FXe{constructor(t){this.view=t,this.type="simple",this._renderData={texV:st(),silCircleCenter:R(),silCircleV1:R(),silCircleV2:R(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new zZ,this._fadeVaoCount=0,this._readyResolver=bp(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=_m(t.spatialReference);const i=bi(t.spatialReference);this.planetRadius=i.radius,this.outerRimWidth=i.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+Dse)/this.planetRadius,this.middleRimFactor=(this.planetRadius+Lse)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=Lse/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=Vs(this._cameraChangeHandle),this._passParameters.texture=Qe(this._passParameters.texture),this._fadeVao=Qe(this._fadeVao),this._vao=Qe(this._vao),this._readyController=Xh(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const i=t.renderContext.rctx;this._cameraChangeHandle=se(()=>{var n;return(n=this.view.state)==null?void 0:n.camera},()=>t.requestRender(),wr),this._vao=this._createRibbon(i),this._vaoCount=ko(this._vao,"geometry"),this._fadeVao=qa(i),this._fadeVaoCount=ko(this._fadeVao,"geometry");const r=this.isOnMars?$Xe:rbe,s=this._readyController.signal;try{const n=await Cp(r,{signal:s});ci(s),this._passParameters.texture=new ot(i,{pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!0},n),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(n){Qr(n)||DXe.error("Unable to initialize simple atmosphere: image request failed",n),this._readyResolver.reject(n)}}get coneTechnique(){if(M(this._coneTechnique)){const t=new x4;t.geometry=fm.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(hE,t)}return this._coneTechnique}get undergroundTechnique(){if(M(this._undergroundTechnique)){const t=new x4;t.geometry=fm.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(hE,t)}return this._undergroundTechnique}render(t){const i=t.bindParameters.camera;this._update(i);const r=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const s=r.bindTechnique(this.coneTechnique,this._passParameters,t.bindParameters);s.setUniformMatrix4fv("proj",i.projectionMatrix),s.setUniformMatrix4fv("view",i.viewMatrix),s.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),s.setUniform3fv("silCircleV1",this._renderData.silCircleV1),s.setUniform3fv("silCircleV2",this._renderData.silCircleV2),s.setUniform2fv("texV",this._renderData.texV),s.setUniform1f("altitudeFade",this._renderData.altitudeFade),s.setUniform1f("innerScale",this._renderData.innerScale),r.bindVAO(this._vao),r.drawArrays(It.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const s=r.bindTechnique(this.undergroundTechnique,this._passParameters,t.bindParameters);s.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),s.setUniform3fv("cameraPosition",i.eye),r.bindVAO(this._fadeVao),r.drawArrays(It.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const i=R(),r=this.planetRadius,s=Oe(t.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=m}else this._renderData.undergroundFadeAlpha=0;const o=Math.max(yV,n),a=r+Dse;this._renderData.innerScale=kXe(r+o,r,a)-1,this._renderData.altitudeFade=h1e(n),ce(i,t.eye,(r+yV)/s),Nse(i,t.center,t.up,r,this._renderData);const l=this._computeScreenRimWidth(t,i,t.up,this._renderData),c=LXe(),h=NXe(n);let p=this.texV0+c*this.texVScale,f=this.texV0+l*h*this.texVScale;if(n>yV){Nse(t.eye,t.center,t.up,r,this._renderData);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),y=De((m-1.5)/(l-1.5),0,1);p=this.texV0+y*c*this.texVScale,f=this.texV0+qt(this.texV1,l*h,y)*this.texVScale}di(this._renderData.texV,p,f)}_createRibbon(t){const i=new Float32Array(3+3*e$*3),r=new Uint32Array(3*e$*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<e$;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this.innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this.middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this.outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===e$-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=Fse.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new qs(t,zi,{geometry:Dc(Fse)},{geometry:si.createVertex(t,_i.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,i,r,s){return de(GC,s.silCircleCenter,s.silCircleV2),ce(_V,GC,this.outerRimFactor),rk(vV,i,GC,r),Ase(GC,vV,t.projectionMatrix,t.viewport),Ase(_V,vV,t.projectionMatrix,t.viewport),hr(GC,_V)/t.height}}function Nse(e,t,i,r,s){const n=Oe(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.silCircleV1,c=s.silCircleV2;return ce(s.silCircleCenter,e,a/n),ct(l,e,t),Fa(l)<1&&ct(l,e,i),ce(l,l,o/Oe(l)),ct(c,l,e),ce(c,c,o/Oe(c)),o}const vV=Ae(),GC=R(),_V=R();function kXe(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const Fse=ls().vec3f(O.POSITION);function HZ(e){const t=x`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=x`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function UXe(){const e=new qi;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new Er("transform",(t,i)=>zXe(t,i)),new ri("viewport",(t,i)=>i.camera.fullViewport),new Xe("pixelRatio",(t,i)=>i.camera.pixelRatio)]),e.include(HZ),e.vertex.code.add(x`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(x`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function zXe(e,t){return Ts(Hy,t.camera.projectionMatrix),Hy[10]=24e-8-1,Hy[11]=-1,Hy[14]=(24e-8-2)*t.camera.near,jr(Hy,Hy,t.camera.viewMatrix),jr(Hy,Hy,e.modelMatrix)}const Hy=Ae(),VXe=Object.freeze(Object.defineProperty({__proto__:null,build:UXe},Symbol.toStringTag,{value:"Module"}));class BXe extends Ys{constructor(){super(...arguments),this.modelMatrix=Ae()}}class Zk extends fr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=Zk.shader.get().build();return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:yr.LEQUAL},colorWrite:ti})}}Zk.shader=new sr(VXe,()=>import("./Stars.glsl.1e68422c.js"));const GXe=ge.getLogger("esri.views.3d.environment.Stars");let W0=class extends Se{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new BXe,this._updatingTracking=new Zf}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return _(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Xh(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=er(this._technique),this._vao=Qe(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),M(this._technique)||M(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(It.POINTS,0,this._numPoints)}_ensureResources(e){if(_(this._technique)||M(Lx))return;this._technique=new Zk({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Lx.byteLength/kse;const t=new Float32Array(Lx,0,2*this._numPoints),i=new Uint8Array(Lx,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type==="sun"?this.view.environment.lighting.date:null,r=>this._update(r),At)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=Ts(this._renderParameter.modelMatrix,qXe);B2(r,r,-i*Math.PI),jr(r,HXe,r),B2(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=Use.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[l]),f=this._hexToRGB(jXe[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new qs(e,zi,{geometry:Dc(Use)},{geometry:si.createVertex(e,_i.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(_(Lx))return null;const e=RP(async t=>{const{data:i}=await TIe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(i),Lx=i});return e.promise.catch(t=>{Qr(t)||GXe.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new q("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/kse;if(t%1!=0||t>5e4||t<5e3)throw new q("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],W0.prototype,"view",void 0),u([d({constructOnly:!0})],W0.prototype,"requestRender",void 0),u([d({readOnly:!0})],W0.prototype,"updating",null),u([d()],W0.prototype,"_loadDataTask",void 0),u([d()],W0.prototype,"_updatingTracking",void 0),W0=u([P("esri.views.3d.environment.Stars")],W0);const jXe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],HXe=$X(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),qXe=$X(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),kse=9,Use=ls().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let Lx=null;var je;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"})(je||(je={}));var kM;const WXe=[Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE,Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let zse,Ea=kM=class extends Se{constructor(e){super(e),this._handles=new jt,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(WXe,this)}destroy(){var e;this._pendingAtmosphere=lt(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=lt(this._handles),this._set("view",null)}get atmosphereType(){return _(this._pendingAtmosphere)?this._pendingAtmosphere.type:_(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!!((e=this.view.basemapTerrain)==null?void 0:e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!_(this._precipitation)&&this._precipitation.update(e)}get updating(){return _(this._pendingAtmosphere)||_(this._stars)&&this._stars.updating||_(this._clouds)&&this._clouds.running}get weatherVisible(){return Oe(this.view.state.camera.eye)-bi(this.view.spatialReference).radius<=Ah}get _stars(){var r,s;const e=this.view,t=(s=(r=e.environment)==null?void 0:r.starsEnabled)!=null?s:!1,i=this._get("_stars");return!t||M(this._context)?(lt(i),null):_(i)?i:new W0({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||M(this._context))return lt(e),null;const t=this.view,i=this._context;return _(e)&&e.context===i?e:(lt(e),new nb({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||M(this._context))return lt(e),null;if(_(e))return e;const t=this.view,i=this._context;return lt(e),new Sa({context:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||M(this._context))return lt(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=bi(this.view.spatialReference).radius;return _(e)&&e.viewingMode===t&&e.planetRadius===r?e:(lt(e),new sb({rctx:i,viewingMode:t,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||M(this._context))return lt(e),null;if(_(e))return e;const t=this.view,i=this._context;return lt(e),new FM({context:i,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)==null?void 0:t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e,this._handles.add([vo(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),wr),se(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),wr),se(()=>this._stars,()=>this._setNeedsRender()),se(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),At),se(()=>this._precipitation,()=>this._setNeedsRender()),se(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),At),se(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},wr)])}uninitializeRenderContext(){this._context=null,this._atmosphere=lt(this._atmosphere),this._set("_stars",lt(this._stars)),this._set("_precipitation",lt(this._precipitation)),this._set("_clouds",lt(this._clouds)),this._set("_cloudsComposition",lt(this._cloudsComposition)),this._set("_fog",lt(this._fog))}prepareRender(e){e.bindParameters.clouds.data=rWe(this._clouds)?this._clouds:null}render(e){if(e.pass===je.MATERIAL)switch(e.bindParameters.slot){case Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE:_(this._stars)&&this._stars.render(e),_(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),_(this._cloudsComposition)&&_(e.bindParameters.clouds.data)&&(this.weatherVisible&&_(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,_(this.view.animation))));break;case Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(_(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),_(this._fog)){const i=t==="foggy"||t==="rainy"||t==="snowy";(i||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,i,t==="rainy")}if(_(this._precipitation)){const i=this.view.environment.weather;i.type!=="rainy"&&i.type!=="snowy"||this._precipitation.render(e,i.precipitation,i.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return M(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){M(e)||M(this._clouds)||(this._clouds.applyPreset(Z1e[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){_(this._context)&&this._context.requestRender()}_updateFog(e){if(!M(this._fog)&&!M(e))switch(e.type){case"foggy":this._fog.strength=qt(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=qt(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;_(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return _(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);_(this._context)&&i.initializeRenderContext(this._context),M(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then(()=>{_(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return mse;case"panoramic":return AXe;case"simple":return FXe;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||t==null||bm(this.view.spatialReference)?"none":i==="local"?"panoramic":t==="high"&&_(this._context)&&mse.isSupported(this._context)&&O2(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=_(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{zse=kM.prototype._getAtmosphereClass,kM.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{kM.prototype._getAtmosphereClass=zse}}}};u([d({constructOnly:!0})],Ea.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],Ea.prototype,"updating",null),u([d({readOnly:!0})],Ea.prototype,"weatherVisible",null),u([d()],Ea.prototype,"_context",void 0),u([d()],Ea.prototype,"_pendingAtmosphere",void 0),u([d({readOnly:!0})],Ea.prototype,"_stars",null),u([d({readOnly:!0})],Ea.prototype,"_precipitation",null),u([d({readOnly:!0})],Ea.prototype,"_clouds",null),u([d({readOnly:!0})],Ea.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Ea.prototype,"_fog",null),u([d({readOnly:!0})],Ea.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Ea.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Ea.prototype,"_weatherUpdateParameters",null),Ea=kM=u([P("esri.views.3d.environment.EnvironmentRenderer")],Ea);function Vse(e,t,i){return XXe(e,t.longitude,t.latitude,i.longitude,i.latitude)}function XXe(e,t,i,r,s){const n=Dt(i),o=Dt(s),a=n-o,l=Dt(t)-Dt(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*xp(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function YXe(e,t,i){const r=t.spatialReference,s=bi(r),n=new at(t.x,e.y,r),o=new at(i.x,e.y,r),a=new at(e.x,t.y,r),l=new at(e.x,i.y,r);return{lon:Vse(s.radius,n,o),lat:Vse(s.radius,a,l)}}function ZXe(e,t,i){const r=t/i,s=Dt(e),n=Math.sin(r/2),o=Math.cos(s),a=2*xp(Math.sqrt(n*n/(o*o)));return Sc(a)}function QXe(e,t){let i=e/15;return t||(i=Math.round(i)),i}function bH(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=QXe(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}var Bse,Gse,jse,hbe={exports:{}};Bse=hbe,Gse=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f($){return $.valueOf()/l-.5+c}function m($){return new Date(($+.5-c)*l)}function y($){return f($)-h}var v=23.4397*a;function w($,k){return n(t($)*i(v)-r(k)*t(v),i($))}function b($,k){return s(t(k)*i(v)+i(k)*t(v)*t($))}function S($,k,B){return n(t($),i($)*t(k)-r(B)*i(k))}function T($,k,B){return s(t(k)*t(B)+i(k)*i(B)*i($))}function E($,k){return a*(280.16+360.9856235*$)-k}function C($){return a*(357.5291+.98560028*$)}function A($){return a*(1.9148*t($)+.02*t(2*$)+3e-4*t(3*$))}function I($,k){return $+k+102.9372*a+e}function L($,k){var B=C($),H=I(B,A(B));return k||(k={dec:0,ra:0}),k.dec=b(H,0),k.ra=w(H,0),k}var D={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function($,k,B,H){var Y=a*-B,ee=a*k,G=y($),te=L(G,p),fe=E(G,Y)-te.ra;return H||(H={azimuth:0,altitude:0}),H.azimuth=S(fe,ee,te.dec),H.altitude=T(fe,ee,te.dec),H}},U=[[-.83,"sunrise","sunset"]];D.addTime=function($,k,B){U.push([$,k,B])};var z=9e-4;function V($,k){return Math.round($-z-k/(2*e))}function X($,k,B){return z+($+k)/(2*e)+B}function Z($,k,B){return h+$+.0053*t(k)-.0069*t(2*B)}function ae($,k,B){return o((t($)-t(k)*t(B))/(i(k)*i(B)))}function re($){var k=a*(134.963+13.064993*$),B=a*(93.272+13.22935*$),H=a*(218.316+13.176396*$)+6.289*a*t(k),Y=5.128*a*t(B),ee=385001-20905*i(k);return{ra:w(H,Y),dec:b(H,Y),dist:ee}}return D.getTimes=function($,k,B){var H=a*-B,Y=a*k,ee=V(y($),H),G=X(0,H,ee),te=C(G),fe=A(te),xe=I(te,fe),Le=b(xe,0),_e=Z(G,te,xe);function ye(Si){return Z(X(ae(Si,Y,Le),H,ee),te,xe)}function Ce(Si){var Ir=(t(Si)-t(Y)*t(Le))/(i(Y)*i(Le));return Ir<-1?D.PolarException.MIDNIGHT_SUN:Ir>1?D.PolarException.POLAR_NIGHT:D.PolarException.NORMAL}var Pe,xi,Ti,Xt,Pi,Yt={solarNoon:m(_e),nadir:m(_e-.5),polarException:D.PolarException.NORMAL};for(Pe=0,xi=U.length;Pe<xi;Pe+=1)Pi=_e-((Xt=ye((Ti=U[Pe])[0]*a))-_e),Yt[Ti[1]]=m(Pi),Yt[Ti[2]]=m(Xt);return Yt.polarException=Ce(U[0][0]*a),Yt},D.getMoonPosition=function($,k,B){var H=a*-B,Y=a*k,ee=y($),G=re(ee),te=E(ee,H)-G.ra,fe=T(te,Y,G.dec);return fe+=.017*a/r(fe+10.26*a/(fe+5.1*a)),{azimuth:S(te,Y,G.dec),altitude:fe,distance:G.dist}},D.getMoonFraction=function($){var k=y($),B=L(k),H=re(k),Y=149598e3,ee=o(t(B.dec)*t(H.dec)+i(B.dec)*i(H.dec)*i(B.ra-H.ra)),G=n(Y*t(ee),H.dist-Y*i(ee));return(1+i(G))/2},D},(jse=Gse())!==void 0&&(Bse.exports=jse);const g_=hbe.exports,Df={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function JXe(e,t,i,r,s,n,o){ne(o.ambient.color,1,1,1),o.ambient.intensity=Df.global.ambient,ne(o.direct.color,1,1,1),o.direct.intensity=Df.global.direct;const a=t[2],l=De((Math.abs(a)-Df.local.altitude)/(Df.global.altitude-Df.local.altitude),0,1);let c;if(o.globalFactor=l,n==="sun"&&(c=g_.getTimes(e,t[1],t[0])),l<1){let h;if(n==="sun")h=oYe(e,c,r);else{const p=pbe(r);h={direct:{intensity:Df.local.directAtNoon*p.direct,color:Fe(1,1,1)},ambient:{intensity:Df.local.ambientAtNoon*p.ambient,color:Fe(1,1,1)},timeOfDay:"early afternoon"}}dn(o.ambient.color,h.ambient.color,o.ambient.color,l),o.ambient.intensity=qt(h.ambient.intensity,o.ambient.intensity,l),dn(o.direct.color,h.direct.color,o.direct.color,l),o.direct.intensity=qt(h.direct.intensity,o.direct.intensity,l),o.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,o.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}o.noonFactor=n==="sun"?nYe(e,c):1,n==="sun"?eYe(e,t,i,o.direct.directionToLightSource):KXe(s,i,o.direct.directionToLightSource)}function KXe(e,t,i){t===Ve.Global?we(bV,e.eye):ne(bV,0,0,1),ce(wV,e.viewForward,-1);const r=SL(wV,bV),s=Math.max(r-2*xV,0),n=.85*s/(s+1),o=Math.max(xV,r-xV-n);Fu(qse,-o,e.viewRight),ke(i,wV,qse),de(i,i,ce(aYe,e.viewRight,lYe)),we(i,i)}function eYe(e,t,i,r){const s=sYe,n=dm(rYe);if(i===Ve.Global)g_.getPosition(e,0,0,s),ne(r,0,0,-1),V2(n,n,-s.azimuth),tk(n,n,-s.altitude),ke(r,r,n);else{const o=Df.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=De(c,0,1),c<1?(g_.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),ne(r,0,-1,0),B2(n,n,-s.azimuth),V2(n,n,-s.altitude),ke(r,r,n)}}function tYe(e,t){if(t===Ve.Global)return!0;const i=Df.planarDirection;return Math.abs(e)<i.localAltitude}const iYe=Fe(.5773502691896258,-.5773502691896258,.5773502691896258);class dbe{constructor(){this.ambient={color:Fe(1,1,1),intensity:.55},this.direct={color:Fe(1,1,1),intensity:.55,directionToLightSource:Bs(iYe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const rYe=Ae(),sYe={azimuth:0,altitude:0};function nYe(e,t){const i=e.valueOf();let r,s;t.polarException===g_.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===g_.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-De(Math.abs(i-n)/432e5,0,1)}function pbe(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function Hse(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function oYe(e,t,i){const r=e.valueOf();let s,n;t.polarException===g_.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===g_.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,v=n+p/2,w=Df.local,b=[.01,w.ambientAtNight],S=[.8,.8,1],T=[.01,.01,.01],E=[w.directAtTwilight,w.ambientAtTwilight],C=[1,.6,.5],A=[.8,.8,1],I=[.9*w.directAtNoon,w.ambientAtNoon],L=[1,.98,.98],D=[.98,.98,1],U=[w.directAtNoon,w.ambientAtNoon],z=[1,1,1],V=[1,1,1],X=I,Z=L,ae=D,re=E,$=C,k=A;let B,H,Y=[0,0],ee=[0,0,0],G=[0,0,0];r<f||r>v?(Y=b,ee=T,G=S,H="night"):r<m?(B=m-f,Y=Eo(r-f,B,b,E),ee=Eo(r-f,B,T,C),G=Eo(r-f,B,S,A),H="sun rising"):r<c?(B=c-m,Y=Eo(r-m,B,E,I),ee=Eo(r-m,B,C,L),G=Eo(r-m,B,A,D),H="early morning"):r<a?(B=a-c,Y=Eo(r-c,B,I,U),ee=Eo(r-c,B,L,z),G=Eo(r-c,B,D,V),H="late morning"):r<h?(B=h-a,Y=Eo(r-a,B,U,X),ee=Eo(r-a,B,z,Z),G=Eo(r-a,B,V,ae),H="early afternoon"):r<y?(B=y-h,Y=Eo(r-h,B,X,re),ee=Eo(r-h,B,Z,$),G=Eo(r-h,B,ae,k),H="late afternoon"):r<v&&(B=v-y,Y=Eo(r-y,B,re,b),ee=Eo(r-y,B,$,T),G=Eo(r-y,B,k,S),H="sun setting");let te=0;switch(i){case"rainy":case"foggy":te=.9;case"snowy":te=.5}te>0&&(ee=Hse(ee,te),G=Hse(G,te));const fe=Fe(ee[0],ee[1],ee[2]),xe=Fe(G[0],G[1],G[2]),Le=pbe(i);return{direct:{intensity:Y[0]*Le.direct,color:fe},ambient:{intensity:Y[1]*Le.ambient,color:xe},timeOfDay:H}}function Eo(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}const qse=Ae(),bV=R(),wV=R(),aYe=R(),xV=.25,lYe=.2;let Ld=class extends as.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new jt,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new fH,this._ambientLight=new UZ,this._moonLight=new K1e,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)==null?void 0:e.updating))}get weatherEnabled(){var e,t,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(t=this._view)==null?void 0:t.state)==null?void 0:i.viewingMode)===Ve.Global&&O2(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Ea({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler(),r=()=>this._updateLighting();this._viewHandles.add([se(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Ki),se(()=>e.environment.lighting.type==="sun"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Ki),se(()=>e.stationary,()=>this._interactingStationaryHandler()),se(()=>e.environment.lighting.directShadowsEnabled,t,Ki),se(()=>e.environment.lighting.ambientOcclusionEnabled,t,Ki),se(()=>e.environment.lighting.waterReflectionEnabled,t,Ki),se(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,Ki),se(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Ki),se(()=>e.environment.weather.type,r,Ki),se(()=>this.weatherEnabled,r,Ki),se(()=>e.viewingMode,()=>this._resetReferencePosition(!0),wr),se(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),wr),se(()=>e.state.camera,i,wr),se(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=lt(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type==="sun"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!Ow(i)){const r=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(r))return void this._requestReferencePositionUpdate(r)}if(this._preupdateTracking(e),_(this._referencePosWGS84Comparable)){const r=bH(this._referencePosWGS84Comparable,Wse);_(r)&&(t.autoUpdate(null,r),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=O2(this._view.spatialReference);if(i&&!Ow(this._view.spatialReference))return!1;const r=e.position;return M(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=R()),i?Z$e(r,this._referencePosWGS84Comparable):ne(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,i=e||(t.environment.lighting.type==="sun"?t.environment.lighting.date:null),r=this._referencePosWGS84Comparable,s=_(r)?cYe:uYe;if(_(r)){const h=this.weatherVisible?t.environment.weather.type:"disabled";JXe(i,r,t.state.viewingMode,h,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,o=s.direct;ce(n.intensity,o.color,o.intensity*Math.PI),le(n.direction,o.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const a=this._ambientLight;ce(a.intensity,s.ambient.color,s.ambient.intensity);const l=this._moonLight;dn(l.intensity,dYe,pYe,s.globalFactor);const c=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));ce(l.intensity,l.intensity,c),le(l.direction,o.directionToLightSource),t._stage.renderView.updateLightSources([n,a,l],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||M(e))return!1;const i=hYe;i.setTime((t||this._view.environment.lighting.date).getTime());const r=bH(e,Wse);if(M(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=fu(this._referencePosWGS84Comparable,!0,s=>tYe(s[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof n1e?{type:"color",color:DX(We.toUnitRGBA(i.color))}:{type:"color",color:mi(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=S2(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),r=this._referencePosUpdateTimer=S2(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===r&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const i=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[t[0],t[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([d({type:Boolean,readOnly:!0})],Ld.prototype,"updating",null),u([d()],Ld.prototype,"disableQueries",void 0),u([d()],Ld.prototype,"_disableWeather",void 0),u([d()],Ld.prototype,"weatherEnabled",null),u([d()],Ld.prototype,"weatherVisible",null),u([d()],Ld.prototype,"referencePositionWGS84Comparable",null),u([d()],Ld.prototype,"_renderer",void 0),u([d()],Ld.prototype,"_referencePosWGS84Comparable",void 0),Ld=u([P("esri.views.3d.environment.SceneViewEnvironmentManager")],Ld);const cYe=new dbe,uYe=new dbe,hYe=new Date,Wse={hours:0,minutes:0,seconds:0},dYe=Fe(.22,.22,.33),pYe=Fe(.22,.22,.22);function YR(e,t){return(e&t)!=0}function E4(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var zt,xr,Bn;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(zt||(zt={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(xr||(xr={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(Bn||(Bn={}));const y_={selection:xr.NONE,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE};function fbe(e,t,i,r){return t=t||e.viewForward,le(r,t),ce(r,r,Math.sign(Te(t,i))),r}function fYe(e,t,i,r){return _Ye(e,t,i,yYe(r,t,i,!0))}function mYe(e,t,i,r){const s=Te(i,pe(e,r,t));return de(e,t,ce(e,i,s))}const gYe={dir:R(),len:0,clip:st()};function yYe(e,t,i,r){const s=gYe;return e?(i&&r&&(s.len=hr(t,i)),le(s.dir,e)):r?(s.len=hr(t,i),pe(s.dir,i,t),ce(s.dir,s.dir,1/s.len)):(pe(s.dir,i,t),we(s.dir,s.dir)),s}function vYe(e,t,i){const r=Te(e,i.dir),s=-cr(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function _Ye(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!vYe(e[s],t,r))return!1;return!0}function bYe(e,t,i=y_){const r=qZ(e,t,i);if(r===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=fbe(t,i.interactionDirection,TYe(e,t,Math.sign(r),AYe),CYe),a=le(MYe,t.viewForward),l=s.intersectInfiniteManifold(Uu(t.eye,o),n,TV);return t.eye=_(l)?l:s.setAltitude(TV,n,t.eye),t.center=mYe(TV,t.eye,a,t.center),!0}function qZ(e,t,i=y_){if(!wYe(e,i))return 0;const r=SYe(e.state.constraints.altitude,EYe);xYe(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=De(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function wYe(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==zt.TUMBLE||!YR(t.selection,xr.TILT))}function xYe(e,t,i){const r=t.interactionType;if(r===zt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===zt.TUMBLE||r===zt.ZOOM,c=qZ(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,E4(c,h,l,a,.05*h,i)}function TYe(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),ce(r,r,i),r}function SYe(e,t){return t.min=e.min,t.max=e.max,t}const EYe={min:0,max:0},CYe=R(),AYe=R(),MYe=R(),TV=R();function WZ(e,t,i=y_){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;t$.min=0,t$.max=r,RYe(e,i,t$);const s=XZ(e,t),n=t$.max-s;return n>=-1e-6?0:n}function OYe(e,t,i=y_){const r=WZ(e,t,i);if(r===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=XZ(e,t)+r,o=le(IYe,t.eye),a=fbe(t,i.interactionDirection,PYe(e,t,LYe),DYe);if(!R_(zme(s.renderLocation,n),Uu(t.eye,a),i$))return!1;t.eye=i$;const l=pe($Ye,t.eye,o);t.center=de(i$,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,i$);return _(h)&&(t.center=h),!0}function RYe(e,t,i){const r=t.interactionType;if(r===zt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===zt.ZOOM||r===zt.PAN,c=WZ(e,o),h=c===0?0:XZ(e,o);i.min=s,i.max=n,E4(c,h,l,a,.05*h,i)}function XZ(e,t){const i=e.pointsOfInterest.surfaceOrigin;return hr(t.eye,i.renderLocation)}function PYe(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return wy(i,t.eye,r.renderLocation)}const t$={min:0,max:0},IYe=R(),$Ye=R(),DYe=R(),LYe=R(),i$=R();var Br,yo;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(Br||(Br={}));class NYe{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=yo.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(yo||(yo={}));function Om(e){return _(e)&&_(e.dist)}function Xse(e){return(t,i,r)=>(dn(Yse,t,i,r),!GX(e,Yse))}function Qk(e){return Om(e)&&e.intersector===Br.OBJECT&&!!e.target}function Jk(e){return Om(e)&&e.intersector===Br.HUD&&!!e.target&&_(e.target.center)}const Yse=R();class FYe{constructor(){this._transform=Ae(),this._transformInverse=new r$({value:this._transform},vs,Ae),this._transformInverseTranspose=new r$(this._transformInverse,Pl,Ae),this._transformTranspose=new r$({value:this._transform},Pl,Ae),this._transformInverseRotation=new r$({value:this._transform},B1e,Pr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Ts(this._transform,t)}multiplyTransform(t){jr(this._transform,this._transform,t)}set(t){Ts(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}}class r${constructor(t,i,r){this.original=t,this.update=i,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class kYe{constructor(t=0){this.offset=t,this.tmpVertex=R()}applyToVertex(t,i,r){const s=t+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)qy[n]=t[0+n]+this.localOrigin[n],s$[n]=t[3+n]+this.localOrigin[n],Nx[n]=qy[n];const i=this.applyToVertex(qy[0],qy[1],qy[2]);for(let n=0;n<3;++n)t[n]=i[n],t[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)Nx[o]=(n&1<<o)==0?qy[o]:s$[o];r(Nx)}let s=0;for(let n=0;n<3;++n)qy[n]*s$[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?Nx[o]=0:Nx[o]=(n&1<<o)!=0?qy[o]:s$[o];r(Nx)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const qy=R(),s$=R(),Nx=R();class UYe{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=R(),this._mbs=Cn(),this._obb={center:R(),halfSize:Ci(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,i,r){const s=t,n=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=i+n*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(t){const i=t[0],r=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return t[0]-=i<0?this._totalOffset:0,t[1]-=r<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const f=Math.max(Math.abs(i),Math.abs(n)),m=Math.max(Math.abs(r),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),v=Math.sqrt(f*f+m*m+y*y),w=this._totalOffset/v,b=this._totalOffset/p;return t[0]+=i*(i>0?w:b),t[1]+=r*(r>0?w:b),t[2]+=s*(s>0?w:b),t[3]+=n*(n<0?w:b),t[4]+=o*(o<0?w:b),t[5]+=a*(a<0?w:b),t}applyToMbs(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this._totalOffset/i;return this._mbs[0]=t[0]+t[0]*r,this._mbs[1]=t[1]+t[1]*r,this._mbs[2]=t[2]+t[2]*r,this._mbs[3]=t[3]+t[3]*this._totalOffset/i,this._mbs}applyToObb(t){const i=t.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,Eu(this._obb.halfSize,t.halfSize,t.quaternion),de(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,pe(this._obb.halfSize,this._obb.halfSize,t.center),my(Kse,t.quaternion),Eu(this._obb.halfSize,this._obb.halfSize,Kse),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class zYe{constructor(t=0){this.offset=t,this.sphere=Cn(),this.tmpVertex=R()}applyToVertex(t,i,r){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*i+s[8]*r+s[12],o=s[1]*t+s[5]*i+s[9]*r+s[13],a=s[2]*t+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,i){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(t){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}}const Zse=new zYe;function wH(e){return _(e)?(Zse.offset=e,Zse):null}const Qse=new UYe;function VYe(e){return _(e)?(Qse.offset=e,Qse):null}const Jse=new kYe;function BYe(e){return _(e)?(Jse.offset=e,Jse):null}const tp="terrain",Kse=Sy();function xH(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function GYe(e,t){const i=e.length;for(let r=0;r<i;++r)LS[0]=e[r],t[r]=LS[0];return t}function jYe(e,t){const i=e.length;for(let r=0;r<i;++r)LS[0]=e[r],LS[1]=e[r]-LS[0],t[r]=LS[1];return t}const LS=new Float32Array(2);function TH(e,t){return M(e)&&(e=[]),e.push(t),e}function SH(e,t){if(M(e))return null;const i=e.filter(r=>r!==t);return i.length===0?null:i}function l3(e){return!!_(e)&&!e.visible}function HYe(e,t,i){const r=e.origin.vec3;nbe(SV,-r[0],-r[1],-r[2]),_(e.transformation)?jr(t,SV,e.transformation):Ts(t,SV),i&&(vs(i,t),Pl(i,i))}function qYe(e,t,i,r,s){n$[0]=e.get(t,0),n$[1]=e.get(t,1),n$[2]=e.get(t,2),xH(n$,Z_,3),i.set(s,0,Z_[0]),r.set(s,0,Z_[1]),i.set(s,1,Z_[2]),r.set(s,1,Z_[3]),i.set(s,2,Z_[4]),r.set(s,2,Z_[5])}const n$=new Float64Array(3),Z_=new Float32Array(6),SV=Ae(),_E=1e-5;class WYe{constructor(t){this.options=new NYe,this._results=new XYe,this.transform=new FYe,this.tolerance=_E,this.verticalOffset=null,this._ray=uo(),this._rayEnd=R(),this._rayBeginTransformed=R(),this._rayEndTransformed=R(),this.viewingMode=t==null?Ve.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,i,r){this.resetWithRay(SDe(t,i,this._ray),r)}resetWithRay(t,i){this.camera=i,t!==this._ray&&jF(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ve.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,de(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r==null?_E:r;const o=wH(this.verticalOffset);if(_(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();_(c)?(_(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const i=t.geometryRecords;if(!i)return;const r=t.transformation,s=wH(this.verticalOffset);for(const n of i){const{geometry:o,material:a,instanceParameters:l}=n;if(l3(l))continue;const c=o.id;this.transform.setAndInvalidateLazyTransforms(r,n.getShaderTransformation()),ke(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ke(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;_(s)&&(s.objectTransform=this.transform),a.intersect(o,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(p,f,m,y,v,w)=>{if(p>=0){if(_(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,p))return;const b=y?this._results.hud:this._results,S=y?T=>{const E={object:t,geometryId:c,triangleNr:m,center:_(w)?[w[0],w[1],w[2]]:null};T.set(Br.HUD,E,p,f,hn,v)}:T=>T.set(Br.OBJECT,{object:t,geometryId:c,triangleNr:m},p,f,h,v);if((b.min.drapedLayerOrder==null||v>=b.min.drapedLayerOrder)&&(b.min.dist==null||p<b.min.dist)&&S(b.min),this.options.store!==yo.MIN&&(b.max.drapedLayerOrder==null||v<b.max.drapedLayerOrder)&&(b.max.dist==null||p>b.max.dist)&&S(b.max),this.options.store===yo.ALL)if(y){const T=new EH(this._ray);S(T),this._results.hud.all.push(T)}else{const T=new l2(this._ray);S(T),this._results.all.push(T)}}},n.shaderTransformation)}}sortResults(t=this._results.all){t.sort((i,r)=>i.dist!==r.dist?ft(i.dist,0)-ft(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?ft(i.drapedLayerOrder,Number.MAX_VALUE)-ft(r.drapedLayerOrder,Number.MAX_VALUE):ft(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-ft(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function td(e){return new WYe(e)}class XYe{constructor(){this.min=new l2(uo()),this.max=new l2(uo()),this.hud={min:new EH(uo()),max:new EH(uo()),all:new Array},this.ground=new l2(uo()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class l2{constructor(t){this.intersector=Br.OBJECT,this.normal=R(),this.transformation=Ae(),this._ray=uo(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return _(this.dist)?(ce(o$,this.ray.direction,this.dist),Oe(o$)):null}getIntersectionPoint(t){return!!Om(this)&&(ce(o$,this.ray.direction,this.dist),de(t,this.ray.origin,o$),!0)}getTransformedNormal(t){return le(jC,this.normal),jC[3]=0,xu(jC,jC,this.transformation),le(t,jC),we(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Br.OBJECT,jF(t,this._ray)}set(t,i,r,s,n,o,a){this.intersector=t,this.dist=r,le(this.normal,ft(s,Khe)),Ts(this.transformation,ft(n,hn)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){jF(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,le(this.normal,t.normal),Ts(this.transformation,t.transformation)}}class EH extends l2{constructor(){super(...arguments),this.intersector=Br.HUD}}function YZ(e){return new l2(e)}const o$=R(),jC=Ht();function mbe(e,t,i,r){return _(e.renderCoordsHelper.fromRenderCoords(t.eye,C4,r))&&Ope(i,C4)}function Kk(e,t){return e.elevationProvider?ft(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function vx(e,t,i,r){const s=e.state.camera.clone();t&&(s.eye=t,s.center=i,s.up=r),YYe(e,s.ray,Wy)||le(Wy,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(Gs(s.eye,Wy)<o){const a=n.collision.enabled;le(Q_,s.viewForward),ce(Q_,Q_,o),a?s.eye=pe(C4,Wy,Q_):de(Wy,s.eye,Q_);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(pe(Q_,Wy,s.eye),s.eye=l.setAltitude(C4,h,s.eye),de(Wy,s.eye,Q_))}return s.center=Wy,s}function ene(e,t,i){if(!e.state.isGlobal)return!1;const r=Kk(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,QYe),o=n*n;return Gs(t,i)>o}function YYe(e,t,i){let r=tne[e.viewingMode];r||(r=td(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,tne[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||ene(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||ene(e,t.origin,i))||!!s&&ZYe(t,i,bi(e.spatialReference).radius)}function ZYe(e,t,i){const r=Te(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return ce(t,e.direction,s/Oe(e.direction)),de(t,t,e.origin),!0}const tne={},C4=R(),Wy=R(),Q_=R(),QYe={near:0,far:0};function hC(e,t,i=Bh.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=Kk(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Oe(t.eye);if(pe(a$,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(JYe,o,t.eye),i===Bh.EYE_AND_CENTER)t.center=de(a$,t.eye,a$);else if(i===Bh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=ce(a$,t.center,l)}return!0}var Bh;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Bh||(Bh={}));const a$=R(),JYe=R();function v_(e,t,i){e.worldUpAtPosition(t,ine),pe(EV,i,t);const r=Oe(EV);return r===0?0:pn(Te(EV,ine)/r)}const ine=R(),EV=R();function gbe(e,t,i=y_,r=!0){HC.eyeCenterDistance=0,HC.requiresTwoSteps=!1;const s=ZZ(e,t,i,void 0,HC);if(s===0)return!1;switch(Fu(l$,-s,t.viewRight),i.tiltMode){case Bn.LOOK_AROUND:ke(Xy,t.viewForward,l$),ce(Xy,Xy,HC.eyeCenterDistance),t.center=de(gv,t.eye,Xy);break;case Bn.TUMBLE:pe(Xy,t.center,t.eye),ke(Xy,Xy,l$),t.eye=pe(gv,t.center,Xy);break;default:i.tiltMode}return t.up=ke(gv,t.up,l$),!HC.requiresTwoSteps||!r||gbe(e,t,i,!1)}function ZZ(e,t,i=y_,r=y_,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,lZe);return aZe(e,i,o),r.interactionType===zt.TUMBLE&&YR(r.selection,xr.ALTITUDE)&&ybe(e,r.interactionStartCamera,o),i.tiltMode===Bn.LOOK_AROUND||r.tiltMode===Bn.LOOK_AROUND?eZe(e,t,o,s):KYe(e,t,o)}function KYe(e,t,i){const r=v_(e.renderCoordsHelper,t.center,t.eye),s=r-De(r,i.min,i.max);return ZR(s)?s:0}function eZe(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return iZe(e,t,i,r);case"local":return tZe(e,t,i,r);default:return void(e.viewingMode,void 0)}}function tZe(e,t,i,r){const s=v_(e.renderCoordsHelper,t.center,t.eye),n=De(s,i.min,i.max),o=s-n;if(!ZR(o))return 0;if(r){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=t.distance}return o}function iZe(e,t,i,r){const s=rZe(e,t,cZe),n=De(s.tiltAtCenter,i.min,i.max);if(!ZR(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=sZe(s),a=nZe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=oZe(s,o)),r&&(r.eyeCenterDistance=CH(s,o)),a}function rZe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+bi(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,gv);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,_(n)?(i.eyeCenterDistance=hr(t.eye,n),i.tiltAtCenter=v_(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=v_(e.renderCoordsHelper,t.center,t.eye):(QE(ak(lk,s),t.ray,gv),i.eyeCenterDistance=hr(t.eye,gv),i.tiltAtCenter=pn(-Te(t.viewForward,we(gv,gv)))),i.radius=s,i.eyeRadius=Oe(t.eye),i.constraints=e.state.constraints,i}function ZR(e){return Math.abs(e)>1e-9}function sZe(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const o=CH(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&ZR(n-s);){const l=(s+n)/2,c=CH(e,l);ZR(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function CH(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-De(t,0,Math.PI),r=xp(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function nZe(e,t){const i=xp(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=xp(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function oZe(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function aZe(e,t,i){if(t.interactionType===zt.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t,{min:n,max:o}=i,a=ZZ(e,r,y_,t),l=a===0?0:v_(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===zt.TUMBLE?(YR(t.selection,xr.ALTITUDE)&&ybe(e,r,i),E4(a,l,!0,s,rne,i)):E4(a,l,!1,s,rne,i)}function ybe(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const s=Fa(t.center),n=Math.sqrt(s),o=t.distance,a=bi(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-pn(p),i.max)),i.max=Math.min(i.max,Math.PI-pn(h))}const Xy=R(),l$=Ae(),gv=R(),rne=Dt(5),lZe={min:0,max:0},cZe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},HC={eyeCenterDistance:0,requiresTwoSteps:!1};function uZe(e){return e}const eU=e=>e*e,QZ=e=>1-eU(1-e),hZe=e=>e<.5?eU(2*e)/2:(QZ(2*(e-.5))+1)/2,JZ=e=>e*e*e,vbe=e=>1-JZ(1-e),_be=e=>e<.5?JZ(2*e)/2:(vbe(2*(e-.5))+1)/2,KZ=e=>e*e*e*e,bbe=e=>1-KZ(1-e),dZe=e=>e<.5?KZ(2*e)/2:(bbe(2*(e-.5))+1)/2,eQ=e=>e*e*e*e*e,wbe=e=>1-eQ(1-e),pZe=e=>e<.5?eQ(2*e)/2:(wbe(2*(e-.5))+1)/2,tQ=e=>1-Math.cos(e*Math.PI/2),xbe=e=>1-tQ(1-e),fZe=e=>e<.5?tQ(2*e)/2:(xbe(2*(e-.5))+1)/2,iQ=e=>2**(10*(e-1)),c3=e=>1-iQ(1-e),mZe=e=>e<.5?iQ(2*e)/2:(c3(2*(e-.5))+1)/2,rQ=e=>-(Math.sqrt(1-e*e)-1),Tbe=e=>1-rQ(1-e),gZe=e=>e<.5?rQ(2*e)/2:(Tbe(2*(e-.5))+1)/2;function ad(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function ld(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const yZe=ld(ad(1),1),vZe=ld(ad(1),0),Sbe=ld(ad(1),.5),_Ze=ld(ad(2),1),bZe=ld(ad(2),0),wZe=ld(ad(2),.5),xZe=ld(ad(3),1),TZe=ld(ad(3),0),SZe=ld(ad(3),.5),EZe=ld(ad(4),1),CZe=ld(ad(4),0),AZe=ld(ad(4),.5),MZe={linear:uZe,"in-quad":eU,"out-quad":QZ,"in-out-quad":hZe,"in-coast-quad":yZe,"out-coast-quad":vZe,"in-out-coast-quad":Sbe,"in-cubic":JZ,"out-cubic":vbe,"in-out-cubic":_be,"in-coast-cubic":_Ze,"out-coast-cubic":bZe,"in-out-coast-cubic":wZe,"in-quart":KZ,"out-quart":bbe,"in-out-quart":dZe,"in-coast-quart":xZe,"out-coast-quart":TZe,"in-out-coast-quart":SZe,"in-quint":eQ,"out-quint":wbe,"in-out-quint":pZe,"in-coast-quint":EZe,"out-coast-quint":CZe,"in-out-coast-quint":AZe,"in-sine":tQ,"out-sine":xbe,"in-out-sine":fZe,"in-expo":iQ,"out-expo":c3,"in-out-expo":mZe,"in-circ":rQ,"out-circ":Tbe,"in-out-circ":gZe};function gs(e,t,i=IZe,r=t){let s=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let a=0;a<$Ze;a++){let l=0;for(const c of PZe)if(YR(i.selection,c.type)){const h=Math.abs(c.error(e,r,i));c.apply(e,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=YR(i.selection,xr.COLLISION),o=OZe(i.interactionType,e);return n&&hC(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function OZe(e,t){switch(e){case zt.PAN:return Bh.EYE_AND_CENTER;case zt.ASCEND:return t.state.isGlobal?Bh.EYE_AND_CENTER_SCALE:Bh.EYE_AND_CENTER;default:return Bh.EYE}}function Zd(e,t){const i=typeof e=="number"?e:gZ(e,t),r=Math.min(1,i/150);return _be(r)}function RZe(e,t,i){return ZZ(e,t,i)*t.distance}const PZe=[{type:xr.TILT,error:RZe,apply:gbe},{type:xr.ALTITUDE,error:qZ,apply:bYe},{type:xr.DISTANCE,error:WZ,apply:OYe}],IZe={selection:xr.ALL,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE},$Ze=5,Fc=R(),Fl=R(),Yy=R(),Wo=R(),J_=R(),DZe=R(),kc={upward:Fe(0,0,1),forward:Fe(0,1,0),sideway:Fe(1,0,0)},sne=Pr();class nne{constructor(t=Ve.Global){this.viewingMode=t,this.center=R(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Bs(kc.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ve.Global){const n=(Oe(this.center)+Oe(t.center))/2;i.pan=SL(this.center,t.center)*n}else i.pan=hr(this.center,t.center);let r=Math.abs(t.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(t,i,r){this.viewingMode===Ve.Global?GDe(t.center,i.center,r.pan,this.center):dn(this.center,t.center,i.center,r.pan),this.distance=qt(t.distance,i.distance,r.zoom),this.pitch=qt(t.pitch,i.pitch,r.rotate);let s=t.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=qt(s,n,r.rotate)}copyFrom(t){le(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,le(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,sne);le(this.center,t.center),pe(Wo,t.center,t.eye),fc(Wo,Wo,i),fc(J_,t.up,i),this.distance=Oe(Wo),Wo[0]/=this.distance,Wo[1]/=this.distance,Wo[2]/=this.distance,this.pitch=this._eyeUpToPitch(Wo),this.yaw=this._eyeUpToYaw(Wo,J_),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,sne);Kh(i,i),this._axisAngleVec3(kc.sideway,this.pitch-Math.PI/2,kc.forward,Wo),this._axisAngleVec3(kc.upward,this.yaw,Wo),this._axisAngleVec3(kc.sideway,this.pitch-Math.PI/2,kc.upward,J_),this._axisAngleVec3(kc.upward,this.yaw,J_),ce(Wo,Wo,this.distance),fc(Wo,Wo,i),fc(J_,J_,i),t.center=this.center,t.eye=pe(Wo,this.center,Wo),t.up=J_}_axisAngleVec3(t,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return ce(Fc,r,n),ct(Fl,t,r),ce(Fl,Fl,o),ce(Yy,t,(1-n)*Te(t,r)),de(s,de(s,Fc,Fl),Yy)}_lookAtOrientation(t,i=Pr()){return this._upAtLookAt(t,Yy),ct(Fc,this.lookAtDirection,Yy),we(Fc,Fc),Fc[0]===0&&Fc[1]===0&&Fc[2]===0&&le(Fc,kc.sideway),ct(Fl,Yy,Fc),we(Fl,Fl),i[0]=Fc[0],i[1]=Fl[0],i[2]=Yy[0],i[3]=Fc[1],i[4]=Fl[1],i[5]=Yy[1],i[6]=Fc[2],i[7]=Fl[2],i[8]=Yy[2],i}_upAtLookAt(t,i){return this.viewingMode===Ve.Local?le(i,kc.upward):we(i,t)}_eyeUpToPitch(t){return Math.PI-SL(kc.upward,t)}_eyeUpToYaw(t,i){const r=DZe;return Math.abs(i[2])<.5?(le(r,i),t[2]>0&&ce(r,r,-1)):le(r,t),ct(Fl,r,kc.upward),we(Fl,Fl),SL(kc.sideway,Fl,kc.upward)}}function sQ(e){return e?{ray:uo(e.ray),c0:e.c0,c1:e.c1}:{ray:uo(),c0:0,c1:Number.MAX_VALUE}}function LZe(e,t=sQ()){return jF(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function NZe(e,t,i=sQ()){const r=Oe(e.vector);return Ume(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function OSt(e,t){return Ebe(e,e.c0,t)}function RSt(e,t){return Ebe(e,e.c1,t)}function Ebe(e,t,i){return de(i,e.ray.origin,ce(i,e.ray.direction,t))}new Ty(()=>({c0:0,c1:0,ray:null}));function QR(e){return e?[vi(e[0]),vi(e[1]),vi(e[2]),vi(e[3]),vi(e[4]),vi(e[5])]:[vi(),vi(),vi(),vi(),vi(),vi()]}function Cbe(){return[R(),R(),R(),R(),R(),R(),R(),R()]}function A4(e,t){for(let i=0;i<yy.NUM;i++)ck(e[i],t[i])}function Abe(e,t,i,r=BZe){const s=jr(NX.get(),t,e);vs(s,s);for(let n=0;n<AH.NUM;++n){const o=xu(LX.get(),VZe[n],s);ne(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Mbe(i,r)}function Mbe(e,t){na(t[et.FAR_BOTTOM_LEFT],t[et.NEAR_BOTTOM_LEFT],t[et.NEAR_TOP_LEFT],e[lr.LEFT]),na(t[et.NEAR_BOTTOM_RIGHT],t[et.FAR_BOTTOM_RIGHT],t[et.FAR_TOP_RIGHT],e[lr.RIGHT]),na(t[et.FAR_BOTTOM_LEFT],t[et.FAR_BOTTOM_RIGHT],t[et.NEAR_BOTTOM_RIGHT],e[lr.BOTTOM]),na(t[et.NEAR_TOP_LEFT],t[et.NEAR_TOP_RIGHT],t[et.FAR_TOP_RIGHT],e[lr.TOP]),na(t[et.NEAR_BOTTOM_LEFT],t[et.NEAR_BOTTOM_RIGHT],t[et.NEAR_TOP_RIGHT],e[lr.NEAR]),na(t[et.FAR_BOTTOM_RIGHT],t[et.FAR_BOTTOM_LEFT],t[et.FAR_TOP_LEFT],e[lr.FAR])}function Fv(e,t){for(let i=0;i<yy.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function FZe(e,t){return Rbe(e,LZe(t,Pbe.get()))}function PSt(e,t){for(let i=0;i<yy.NUM;i++){const r=e[i];if(!QDe(r,t))return!1}return!0}function kZe(e,t,i){return Rbe(e,NZe(t,i,Pbe.get()))}function Obe(e,t){for(let i=0;i<yy.NUM;i++)if(cr(e[i],t)>0)return!1;return!0}function UZe(e,t){for(let i=0;i<yy.NUM;i++)if(YDe(e[i],t))return!1;return!0}function Rbe(e,t){for(let i=0;i<yy.NUM;i++)if(!ZDe(e[i],t))return!1;return!0}var lr,et;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(lr||(lr={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(et||(et={}));const zZe={bottom:[et.FAR_BOTTOM_RIGHT,et.NEAR_BOTTOM_RIGHT,et.NEAR_BOTTOM_LEFT,et.FAR_BOTTOM_LEFT],near:[et.NEAR_BOTTOM_LEFT,et.NEAR_BOTTOM_RIGHT,et.NEAR_TOP_RIGHT,et.NEAR_TOP_LEFT],far:[et.FAR_BOTTOM_RIGHT,et.FAR_BOTTOM_LEFT,et.FAR_TOP_LEFT,et.FAR_TOP_RIGHT],right:[et.NEAR_BOTTOM_RIGHT,et.FAR_BOTTOM_RIGHT,et.FAR_TOP_RIGHT,et.NEAR_TOP_RIGHT],left:[et.FAR_BOTTOM_LEFT,et.NEAR_BOTTOM_LEFT,et.NEAR_TOP_LEFT,et.FAR_TOP_LEFT],top:[et.FAR_TOP_LEFT,et.NEAR_TOP_LEFT,et.NEAR_TOP_RIGHT,et.FAR_TOP_RIGHT]};var yy,AH;(function(e){e[e.NUM=6]="NUM"})(yy||(yy={})),function(e){e[e.NUM=8]="NUM"}(AH||(AH={}));const VZe=[mi(-1,-1,-1,1),mi(1,-1,-1,1),mi(1,1,-1,1),mi(-1,1,-1,1),mi(-1,-1,1,1),mi(1,-1,1,1),mi(1,1,1,1),mi(-1,1,1,1)],Pbe=new Ty(sQ),BZe=Cbe(),GZe=ge.getLogger("esri.views.3d.webgl-engine.lib.Camera");class ir{constructor(t=null,i=null,r=null){this._viewUp=R(),this._viewForward=R(),this._viewRight=R(),this._ray=uo(),this._viewport=mi(0,0,1,1),this._padding=mi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Ni(1,1e3),this._viewDirty=!0,this._viewMatrix=Ae(),this._projectionDirty=!0,this._projectionMatrix=Ae(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ae(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ae(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=QR(),this._fullViewport=Ht(),this._pixelRatio=1,this.relativeElevation=0,_(t)&&le(this._ray.origin,t),this._center=_(i)?Bs(i):R(),this._up=_(r)?Bs(r):Fe(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return pe(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Ts(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[Ct.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[Ct.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[Ct.RIGHT]+this._padding[Ct.LEFT]}set fullWidth(t){this.width=t-(this._padding[Ct.RIGHT]+this._padding[Ct.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Ct.TOP]+this._padding[Ct.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Ct.TOP]+this._padding[Ct.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Ct.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Ct.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[Ct.TOP]===t[Ct.TOP]&&this._padding[Ct.RIGHT]===t[Ct.RIGHT]&&this._padding[Ct.BOTTOM]===t[Ct.BOTTOM]&&this._padding[Ct.LEFT]===t[Ct.LEFT]||(this._viewport[0]+=t[Ct.LEFT]-this._padding[Ct.LEFT],this._viewport[1]+=t[Ct.BOTTOM]-this._padding[Ct.BOTTOM],this._viewport[2]-=t[Ct.RIGHT]+t[Ct.LEFT]-(this._padding[Ct.RIGHT]+this._padding[Ct.LEFT]),this._viewport[3]-=t[Ct.TOP]+t[Ct.BOTTOM]-(this._padding[Ct.TOP]+this._padding[Ct.BOTTOM]),np(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(jr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,r=this.near*Math.tan(this.fovY/2),s=r*this.aspect;Xfe(this._projectionMatrix,-s*(1+2*this._padding[Ct.LEFT]/t),s*(1+2*this._padding[Ct.RIGHT]/t),-r*(1+2*this._padding[Ct.BOTTOM]/i),r*(1+2*this._padding[Ct.TOP]/i),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return M(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Ae()),this._inverseProjectionDirty&&vs(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){Ts(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return wXe(this._fov,this.width,this.height)}set fovX(t){this._fov=_Xe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return xXe(this._fov,this.width,this.height)}set fovY(t){this._fov=bXe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return hr(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(vs(this._viewInverseTransposeMatrix,this.viewMatrix),Pl(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){le(this._ray.origin,t.eye),le(this._center,t.center),le(this._up,t.up),np(this._viewport,t.viewport),np(this._padding,t.padding),_o(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(Ts(this._viewMatrix,t.viewMatrix),le(this._viewRight,t.viewRight),le(this._viewUp,t.viewUp),le(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(Ts(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(A4(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Ts(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),np(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new ir().copyFrom(this)}equals(t){return bl(this.eye,t.eye)&&bl(this._center,t.center)&&bl(this._up,t.up)&&eR(this._viewport,t.viewport)&&eR(this._padding,t.padding)&&c1e(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const i=5e-4,r=1-1e-10;Tc(Xo,t.eye,t.center),Tc(CV,this.eye,this._center);const s=Te(Xo,CV),n=Q8(Xo),o=Q8(CV);return s*s>=r*n*o&&yW(t.eye,this.eye)<Math.max(n,o)*i*i&&TF(t.padding,this._padding)<.5&&TF(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(pO(this.viewForward,pe(Xo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=Yr()){return t[0]=(this.padding[Ct.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[Ct.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,i=.5,r=.5){return t[0]=this.padding[Ct.LEFT]+this.width*i,t[1]=this.padding[Ct.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const i=this.viewport,r=this.padding;t.setViewport(i[0]-r[3],i[1]-r[2],i[2]+r[1]+r[3],i[3]+r[0]+r[2])}applyProjection(t,i){t!==Bt&&le(Bt,t),Bt[3]=1,xu(Bt,Bt,this.projectionMatrix);const r=Math.abs(Bt[3]);ce(Bt,Bt,1/r);const s=this.fullViewport;i[0]=qt(0,s[0]+s[2],.5+.5*Bt[0]),i[1]=qt(0,s[1]+s[3],.5+.5*Bt[1]),i[2]=.5*(Bt[2]+1),i[3]=r}unapplyProjection(t,i){const r=this.fullViewport;Bt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Bt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Bt[2]=(2*t[2]-1)*t[3],Bt[3]=t[3],xu(Bt,Bt,this.inverseProjectionMatrix),i[0]=Bt[0],i[1]=Bt[1],i[2]=Bt[2]}projectToScreen(t,i){this.projectToRenderScreen(t,AV),this.renderToScreen(AV,i)}projectToRenderScreen(t,i){if(Bt[0]=t[0],Bt[1]=t[1],Bt[2]=t[2],Bt[3]=1,xu(Bt,Bt,this.viewProjectionMatrix),Bt[3]===0)return null;ce(Bt,Bt,1/Math.abs(Bt[3]));const r=this.fullViewport;return"x"in i?(i.x=qt(0,r[0]+r[2],.5+.5*Bt[0]),i.y=qt(0,r[1]+r[3],.5+.5*Bt[1])):(i[0]=qt(0,r[0]+r[2],.5+.5*Bt[0]),i[1]=qt(0,r[1]+r[3],.5+.5*Bt[1]),i.length>2&&(i[2]=.5*(Bt[2]+1))),i}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,AV),i)}unprojectFromRenderScreen(t,i){if(jr(c$,this.projectionMatrix,this.viewMatrix),!vs(c$,c$))return null;const r=this.fullViewport;return Bt[0]=2*(t[0]-r[0])/r[2]-1,Bt[1]=2*(t[1]-r[1])/r[3]-1,Bt[2]=2*t[2]-1,Bt[3]=1,xu(Bt,Bt,c$),Bt[3]===0?null:(i[0]=Bt[0]/Bt[3],i[1]=Bt[1]/Bt[3],i[2]=Bt[2]/Bt[3],i)}constrainWindowSize(t,i,r,s=r){const n=t*this._pixelRatio,o=i*this._pixelRatio,a=Math.max(n-r/2,0),l=Math.max(this.fullHeight-o-s/2,0),c=-Math.min(n-r/2,0),h=-Math.min(this.fullHeight-o-s/2,0);return[a,l,r-c- -Math.min(this.fullWidth-n-r/2,0),s-h- -Math.min(o-s/2,0)]}computeUp(t){t===Ve.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,i){const r=t[0]*this._pixelRatio,s=this.fullHeight-t[1]*this._pixelRatio;return i[0]=r,i[1]=s,i}renderToScreen(t,i){const r=t[0]/this._pixelRatio,s=(this.fullHeight-t[1])/this._pixelRatio;i[0]=r,i[1]=s}_computeUpGlobal(){pe(Xo,this.center,this.eye);const t=Oe(this.center);t<1?(ne(this._up,0,0,1),this._markViewDirty()):Math.abs(Te(Xo,this.center))>.9999*Oe(Xo)*t||(ct(this._up,Xo,this.center),ct(this._up,this._up,Xo),we(this._up,this._up),this._markViewDirty())}_computeUpLocal(){wy(Xo,this.eye,this.center),Math.abs(Xo[2])<=.9999&&(ce(Xo,Xo,Xo[2]),ne(this._up,-Xo[0],-Xo[1],1-Xo[2]),we(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,i){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?bl(t,i)||(le(i,t),this._markViewDirty()):GZe.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Abe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(rk(this._viewMatrix,this.eye,this._center,this._up),ne(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ne(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ne(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const Bt=Ht(),c$=Ae(),Xo=R(),CV=R(),AV=Fo();var Ct;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(Ct||(Ct={}));const M4={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class nQ{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:M4.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new nQ(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:M4.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class jZe{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,i)=>t+i.time,0)}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),t*=this.time;let r=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(t<=a.time||o===this.segments.length-1){i=this.segmentInterpolateComponentsAt(a,t/a.time,i),n.hasPan?i.pan=(r+l.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate?i.rotate=(s+l.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1;const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?i.zoom=(c-h)/(p-h):i.zoom=1,i}t-=a.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(t,i,r){return t.interpolateComponentsAt(i,r)}}class MV{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);const n=(t.source.pixelsPerRotateAtZoom(r)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const r=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}}function HZe(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function qZe(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function WZe(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function XZe(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function YZe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function ZZe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function QZe(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function JZe(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function KZe(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function eQe(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function tQe(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function iQe(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function rQe(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function sQe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function nQe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function oQe(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}function aQe(e,t){let i=lQe(e,t);const r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?XZe:HZe,a=s?YZe:qZe,l=s?ZZe:WZe,c=n?rQe:eQe,h=n?sQe:tQe,p=n?nQe:iQe,f=E=>o(e,E,r)+QZe(e,E,r)+c(e,E,r),m=E=>a(e,E,r)+JZe(e,E,r)+h(e,E,r),y=E=>l(e,E,r)+KZe(e,E,r)+p(e,E,r);let v=f(i);const w=oQe(e);let b;const S=t.maximumIterations||20,T=t.maximumDistance!=null?t.maximumDistance:1/0;for(b=0;b<S;b++){const C=(m(i)+1e-6)/y(i);if(isNaN(C)||i>=T&&C<0){if(!isFinite(T))return null;i=T,v=f(i);break}if(i-=C,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const A=f(i);if(Math.abs(A-v)/v<=.005)break;v=A}return v>w*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function lQe(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class cQe extends jZe{constructor(t,i){super(),this._preallocSegments=[new MV,new MV,new MV],this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=null;i&&i.apex&&(r=aQe(t,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i.apex)}segmentInterpolateComponentsAt(t,i,r){return r=t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=QZ(r.zoom):t===this._descensionSegment&&(r.zoom=eU(r.zoom)),r}_updateWithApex(t,i){const[r,s,n]=this._preallocSegments,o=i.ascensionFactor!=null?i.ascensionFactor:.5,a=Math.min(1-o,i.ascensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const uQe={zoom:0,pan:0,rotate:0};class hQe{constructor(t){this.createCamera=t,this._time=0,this.definition=new nQ(t),this.path=new cQe}get time(){return this._time}update(t,i,r){this.definition.update(t,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(She(this.path.time),r),this._easing=r.easing?r.easing:this._time>=1e3?Sbe:c3}cameraAt(t,i){i=i||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const r=this.path.interpolateComponentsAt(t,uQe);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(t){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(t,this._time)-i)/(r-i)}_applyTimeSettings(t,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?t=i.duration:i.speedFactor!=null&&(t=t/r);const s=i.minDuration!=null?i.minDuration:M4.minDuration/r,n=i.maxDuration!=null?i.maxDuration:M4.maxDuration/r;return Math.min(Math.max(s,t),n)}}const dQe=R();class pQe{constructor(t){this.currentTime=0,this._animation=new hQe(()=>new nne(t)),this._current=new nne(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=pe(dQe,i.center,t.center),a=Oe(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),le(s.lookAtDirection,o),le(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new ir,this._current.copyToRenderCamera(i),i}step(t,i){return this.finished||(this.currentTime=this.currentTime+She(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}}var zr;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(zr||(zr={}));let Xb=class extends Se{constructor(){super(...arguments),this.state=zr.Ready}get active(){return this.state===zr.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=zr.Stopped,!0)}finishController(){this.state=zr.Finished}get steppingFinished(){return!1}};u([d({readOnly:!0})],Xb.prototype,"active",null),u([d()],Xb.prototype,"state",void 0),Xb=u([P("esri.views.3d.state.controllers.CameraController")],Xb);let JR=class extends Xb{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(hi()),this._asyncResult=null),this.state===zr.Finished||this.state===zr.Stopped?this.state===zr.Finished?e.resolve():e.reject(hi()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=zr.Running,_(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!_(this.viewAnimation)||this.state!==zr.Ready&&this.state!==zr.Running||(this.viewAnimation.state===sE.State.FINISHED?this.finish():this.viewAnimation.state===sE.State.STOPPED&&(this.state=zr.Stopped))}onControllerEnd(){_(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===zr.Finished?this.viewAnimation.finish():this.state===zr.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===zr.Finished?this._asyncResult.resolve():this._asyncResult.reject(hi()))}finish(){this.finishController()}};JR=u([P("esri.views.3d.state.controllers.AnimationController")],JR);let Bg=class extends JR{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new pQe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new sE}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);u$.copyFrom(this.view.state.camera);const r=td(this.view.state.viewingMode);this.intersectionHelper.intersectRay(u$.ray,r,one)&&(u$.center=one),this.animation.update(u$,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return me(F({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},e),{easing:typeof e.easing=="string"?MZe[e.easing]:e.easing})}};u([d({constructOnly:!0})],Bg.prototype,"view",void 0),u([d({constructOnly:!0})],Bg.prototype,"mode",void 0),Bg=u([P("esri.views.3d.state.controllers.PointToPointAnimationController")],Bg);const u$=new ir,one=R();function Ibe(e,t,i){return fQe(e,e.screenToRender(t,He.get()),i)}function fQe(e,t,i){const r=_o(He.get(),t);if(r[2]=0,!e.unprojectFromRenderScreen(r,i.origin))return null;const s=_o(He.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,He.get());return M(n)?null:(pe(i.direction,n,i.origin),i)}function dC(e,t,i){return oQ(e,e.screenToRender(t,He.get()),i)}function oQ(e,t,i){le(i.origin,e.eye);const r=ne(He.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(r,He.get());return M(s)?null:(pe(i.direction,s,i.origin),i)}function aQ(e,t,i,r){const s=dC(t,i,mQe);return R_(e,s,r)}const mQe=uo();var bE;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(bE||(bE={}));const $be=30,O4=[1,3e8],Dbe=70;function dw(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function MH(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function __(e,t,i){const r=Fu(NX.get(),i[3],i);M(r)||(pe(Gi,e.eye,t),ke(Gi,Gi,r),e.eye=de(Gi,Gi,t),pe(Gi,e.center,t),ke(Gi,Gi,r),e.center=de(Gi,Gi,t),e.up=ke(Gi,e.up,r))}function gQe(e,t,i,r){return dx(e,Ibe(t,i,uQ),r)}function OH(e,t,i,r){return dx(e,dC(t,i,uQ),r)}function lQ(e,t,i,r){const s=He.get();let n=1-i;pe(s,t,e.eye);const o=Oe(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ce(s,s,n),e.eye=de(Gi,e.eye,s),e.center=dn(Gi,e.center,t,n))}function Lbe(e,t,i){t.getScreenCenter(ane),aQ(e,t,ane,Gi)&&(t.center=Gi);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=ce(He.get(),t.viewForward,s);t.eye=pe(Gi,t.center,n)}const ane=Yr();function OV(e,t){ne(t,0,0,0);for(const i of e)de(t,t,i);ce(t,t,1/e.length)}function mN(e,t,i,r){return Math.sin(e/Oe(t))*(i+r.radius)}function lne(e,t,i,r){return mN(Math.PI/2,t,i,r)+(e-Math.PI/2)}var ho;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(ho||(ho={}));const cne={Elevation:3e4,Angle:Dt(6)},MO={Pole:.95,Angle:Dt(18),Tilt:45},Nbe=Dt(80);function Fbe(e,t,i,r,s,n){const o=R(),a=Cn();let l=!0,c=!0;return e.intersectScreen(i,o,n)?a[3]=Oe(o):(c=!1,t.aboveGround&&s!==bE.Ellipsoid?a[3]=Math.max(Oe(t.center),.9*r.radius):a[3]=Oe(t.eye)-t.relativeElevation,s===bE.Silhouette?KR(a,t,i,o):l=aQ(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function tU(e,t,i,r){return Oe(e.eye)-r.radius>cne.Elevation?ho.Horizontal:i?(dC(e,t,yne),-Math.sign(e.relativeElevation)*(.5*Math.PI+kX(e.eye,yne.direction))<cne.Angle?ho.Vertical:ho.Horizontal):ho.Vertical}function kbe(e,t,i){pe(RV,i,t),e.eye=pe(Gi,e.eye,RV),e.center=pe(Gi,e.center,RV)}const RV=R();function KR(e,t,i,r){const s=dC(t,i,uQ);return!M(s)&&(QE(e,s,h$),R_(e,s,r)?!(Gs(h$,s.origin)<Gs(r,s.origin))||(le(r,h$),!1):(pe(Fx,t.eye,t.center),we(Fx,Fx),Xme(Fx,-Te(we(Fx,Fx),h$),une),dx(une,s,r),!1))}const h$=R(),Fx=R(),une=vi();function Ube(e,t,i,r,s,n){let o;if(ct(I4,e,t),pe(m$,e,t),Oe(e)<=s||!r.aboveGround){ct(i,m$,r.eye);const a=Te(e,t)/(Oe(e)*Oe(t)),l=Math.cos(De(n_.normalize(Dt(n)),0,Nbe));o=-pn(a)-Math.max(0,Oe(t)-s)/(l*s)}else pe(hne,r.eye,r.center),ct(i,m$,hne),o=-Oe(m$)/s;return we(i,i),ce(i,i,Oe(I4)),o}const hne=R();function dne(e,t,i,r){let s,n;const o=Math.cos(De(n_.normalize(Dt(r)),0,Nbe));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):pn(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):pn(e/i),(n-s)*i}function yQe(e,t,i,r,s,n,o,a,l,c){const h=dne(e[2],t[2],o[3],l),p=c?dne(e[0],t[0],o[3],180):t[0]-e[0],f=Math.sin(a)*p-Math.cos(a)*h,m=Math.cos(a)*p+Math.sin(a)*h;we(Gi,s);const y=c?f/Math.sqrt(Math.abs(o[3]**2-Te(i,Gi)**2)):f/o[3],v=m/Math.sqrt(Math.abs(o[3]**2-Te(i,r)**2));di(n,y,v)}function zbe(e,t,i,r,s,n,o,a,l,c){ct(I4,e,t),qG(n.up,n.eye,d$,p$,f$),qG([0,0,1],n.eye,Qg,Jv,jbe),le(i,Jv),le(r,Qg),we(i,i),ce(i,i,Oe(I4)),Oee(e,we(p$,p$),we(f$,f$),we(d$,d$),pne),Oee(t,p$,f$,d$,fne),yQe(pne,fne,e,Qg,Jv,s,o,a,l,c)}function vQe(e,t,i,r,s,n,o){Fu(R4,s,r),Fu(P4,o,n),jr(NS,R4,P4),pe(t,e,i),ke(t,t,NS),de(t,t,i)}function Vbe(e,t,i,r,s,n){Fu(R4,r,i),Fu(P4,n,s),jr(NS,R4,P4),pe(Gi,e.eye,t),ke(Gi,Gi,NS),e.eye=de(Gi,Gi,t),pe(Gi,e.center,t),ke(Gi,Gi,NS),e.center=de(Gi,Gi,t),pe(Gi,e.up,t),ke(Gi,Gi,NS),e.up=de(Gi,Gi,t)}function cQ(e,t,i,r,s,n,o=MO.Pole,a=MO.Angle){const l=Math.abs(r)>Math.PI-a||Math.abs(r)<a,c=Math.abs(e[2])<i*o||Math.abs(t)>i;return!!(l&&c&&n.aboveGround&&s<MO.Tilt)}function Bbe(e,t,i,r,s,n){if(n)DR(i,r,mne),__(t,e,mne);else{const o=Ube(i,r,gne,t,e[3],s);__(t,e,$R(gne,o))}}function Gbe(e,t,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;le(K_,r),g$.copyFrom(t);for(let p=0;p<a&&Gs(i,K_)>l&&(c=Gs(i,K_),zbe(i,K_,Jv,Qg,qC,g$,e,s,n,o),Vbe(g$,e,Qg,qC[1],Jv,qC[0]),vQe(K_,K_,e,Qg,qC[1],Jv,qC[0]),h=Gs(i,K_),h<c||p===0);p++)t.copyFrom(g$)}function _Qe(e,t,i,r,s,n,o){cQ(i,Te(t.up,i),e[3],-n_.normalize(Dt(s)),n,t,MO.Pole,MO.Angle)?Gbe(e,t,i,r,-n_.normalize(Dt(s)),n,o):Bbe(e,t,i,r,n,o)}function bQe(e,t,i,r,s,n){const{eye:o}=e;qG([0,0,1],o,Qg,Jv,jbe);const a=t.translation[0]*i.pan,l=s.mode==="zoom"?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Te(e.center,Qg)**2/Oe(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(mc(r.pan.matrix,r.pan.matrix,h,Qg),r.pan.enabled=!0,s.mode){case"pan":mc(r.pan.matrix,r.pan.matrix,p,Jv),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function wQe(e,t,i,r,s){const{eye:n,viewRight:o}=e,a=ct(He.get(),o,n),l=t.translation[0]*i.pan;switch(l!==0&&(mc(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*i.pan;c!==0&&(mc(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function xQe(e,t,i,r,s,n,o,a,l){cQ(e.center,Te(e.up,e.center),Oe(e.center),-n_.normalize(Dt(n)),o,t)?bQe(t,i,r,a,l,-n_.normalize(Dt(s))):wQe(t,i,r,a,l)}const Qg=R(),Jv=R(),jbe=R(),d$=R(),p$=R(),f$=R(),pne=R(),fne=R(),qC=st(),mne=cC(),R4=Ae(),P4=Ae(),NS=Ae(),K_=R(),Gi=R(),m$=R(),g$=new ir,I4=R(),gne=R(),uQ={origin:R(),direction:R()},yne={origin:R(),direction:R()},vne=.6,PV=4,TQe=12,SQe=60,EQe=200;let $4=class extends Bg{constructor(){super(...arguments),this.zoomLocation=R(),this.tmpCamera=new ir,this.tmpViewDir=R(),this.tmpRayDir={origin:R(),direction:R()},this.targetOnSphere=R(),this.tmpCenter=R(),this.constraintOptions={selection:xr.ALL_EXCEPT_COLLISION,interactionType:zt.ZOOM,interactionFactor:null,interactionStartCamera:new ir,interactionDirection:null,tiltMode:Bn.TUMBLE},this.sphere=Cn()}initialize(){this.intersector=td(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation,this.view.map.ground.opacity===0?CQe:{})&&(s=e>0,n=!0),this.tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:le(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:c3}}_updateCamera(e,t,i,r,s){const n=bi(this.view.spatialReference),o=tU(e,r,s,n);let a;this.view.camera.position.hasZ&&(a=Math.abs(this.view.camera.position.z)),we(v$,e.eye),ce(v$,v$,-1),dC(e,r,this.tmpRayDir),we(this.tmpRayDir.direction,this.tmpRayDir.direction);const l=Math.max(Math.min(TQe,1/Math.abs(Te(v$,this.tmpRayDir.direction)))*a,EQe);if(o===ho.Horizontal){let c=vne**t;this.sphere[3]=Oe(i),pe(this.tmpViewDir,e.center,e.eye);const h=Math.min(Oe(this.tmpViewDir),l);let p=h*c;if(c<=1&&p<PV&&(p=PV,c=p/h),Math.abs(h-p)<1e-6)return;const f=Oe(e.center);if(this.sphere[3]!==f){const m=this.sphere[3]+c*(f-this.sphere[3]);e.center=ce(y$,e.center,m/f)}ce(this.tmpViewDir,this.tmpViewDir,-c),e.eye=de(y$,e.center,this.tmpViewDir),gs(this.view,e,this.constraintOptions),Gs(i,e.center)>1e-12&&aQ(this.sphere,e,r,this.targetOnSphere)&&_Qe(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=vne**Math.abs(t);const h=t>0?1:-1;pe(this.tmpViewDir,i,e.eye);const p=Oe(this.tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,SQe);let m=f?Math.min(l,f):l;m=s?Math.min(m,p):m,ce(this.tmpRayDir.direction,this.tmpRayDir.direction,m),de(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let y=m*c;const v=Math.max(PV,1.01*e.nearFar[0]);if(t>0&&y<v&&(y=v,c=y/m),Math.abs(m-y)<1e-6)return;ce(this.tmpRayDir.direction,this.tmpRayDir.direction,h*(1-c)),e.eye=de(y$,e.eye,this.tmpRayDir.direction),e.center=de(y$,e.center,this.tmpRayDir.direction)}hC(this.view,e)}};$4=u([P("esri.views.3d.state.controllers.global.ZoomStepController")],$4);const y$=R(),v$=R(),CQe={exclude:new Set([tp])},AQe=.6,MQe=4,OQe=60,RQe=14,PQe=200;let D4=class extends Bg{constructor(){super(...arguments),this.zoomLocation=R(),this.tmpCamera=new ir,this.tmpRayDir=R(),this.tmpCenter=R(),this.constraintOptions={selection:xr.ALL,interactionType:zt.ZOOM,interactionFactor:null,interactionStartCamera:new ir,interactionDirection:null,tiltMode:Bn.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const s=td(this.view.state.viewingMode);e>0?(this.view.map.ground.opacity===0?this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation,$Qe):this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:le(this.zoomLocation,this.tmpCamera.center);const n=AQe**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,OQe);pe(_$,this.tmpCamera.eye,this.zoomLocation),we(_$,_$);const a=Math.max(Math.min(RQe,1/Math.abs(Te(IQe,_$)))*Math.abs(this.view.camera.position.z),PQe);if(o=o?Math.min(o,a):a,o){const l=R();pe(l,this.zoomLocation,this.tmpCamera.eye),o<Oe(l)&&(we(l,l),de(this.zoomLocation,this.tmpCamera.eye,ce(l,l,o)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:c3}}_updateCamera(e,t,i){pe(this.tmpRayDir,i,e.eye);const r=Oe(this.tmpRayDir);let s=r*t;const n=t<=1,o=Math.max(MQe,1.01*e.nearFar[0]);n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||(ce(this.tmpRayDir,this.tmpRayDir,t),e.eye=pe(_ne,i,this.tmpRayDir),e.center=dn(_ne,e.center,i,1-t),gs(this.view,e,this.constraintOptions))}};D4=u([P("esri.views.3d.state.controllers.local.ZoomStepController")],D4);const _ne=R(),IQe=Fe(0,0,1),_$=R(),$Qe={exclude:new Set([tp])};function DQe(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function hQ(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class LQe extends Go{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){const i=t.data;if(DQe(i,"primary")){const r=this.view.state.isGlobal?new $4({view:this.view,mode:"animation"}):new D4({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Yr(i.x,i.y)),t.stopPropagation()}}}let b_=class extends Xb{constructor(){super(...arguments),this.startCamera=new ir,this.currentCamera=new ir}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=zr.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};b_=u([P("esri.views.3d.state.controllers.InteractiveController")],b_);var nc;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(nc||(nc={}));const NQe=7,IV=90;let FS=class extends b_{constructor(e){super(e),this.view=null,this.pivot=nc.CENTER,this.lastPoint=st(),this.tmpWorldUp=R(),this.tmpViewDir=R(),this.tmpRotCurPoint=st(),this.tmpTransf=Ae(),this.tmpAxis=R(),this.tmpPivotPoint=R(),this.pivotPos=R(),this.constraintOptions={selection:xr.ALL,interactionType:zt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===nc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case nc.EYE:le(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=zt.LOOK_AROUND,this.constraintOptions.tiltMode=Bn.LOOK_AROUND,this.constraintOptions.selection=xr.NONE;break;case nc.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||le(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=zt.TUMBLE,this.constraintOptions.tiltMode=Bn.TUMBLE,this.constraintOptions.selection=xr.ALL&~xr.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,dw(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=R();pe(r,this.pivotPos,i.eye);const s=Oe(r);let n=Math.min(s,NQe*Math.abs(this.view.camera.position.z));const o=bi(this.view.spatialReference),a=Yr(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=tU(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*IV,IV),h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,IV);c===void 0&&h===void 0||(c=c===void 0?h:c,h=h===void 0||l===ho.Horizontal?c:h,n=c>h?h:c,n=t?Math.min(n,s):n),we(r,r),le(this.pivotPos,de(this.tmpPivotPoint,i.eye,ce(this.tmpPivotPoint,r,n)))}update(e){if(this.active){switch(this.pivot){case nc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case nc.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}gs(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),dw(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;pe(this.tmpViewDir,i,r);const o=Oe(this.tmpViewDir),a=pn(Te(this.tmpViewDir,this.tmpWorldUp)/o);if(this.pivot===nc.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=De(s+a,Lo.min,Lo.max)-a,ct(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===nc.CENTER&&(n=-n),Fu(this.tmpTransf,n,this.tmpWorldUp),mc(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),ke(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=ke($V,e.up,this.tmpTransf),de($V,r,this.tmpViewDir),_o(this.lastPoint,this.tmpRotCurPoint),$V}};u([d({constructOnly:!0})],FS.prototype,"view",void 0),u([d()],FS.prototype,"pivot",void 0),FS=u([P("esri.views.3d.state.controllers.RotateController")],FS);const $V=R();class DV extends Go{constructor(t,i,r,s){super(!0),this.view=t,this.pointerAction=i,this.pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!hQ(t.data,this.pointerAction))return;const r=Yr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new FS({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let gN=class extends b_{constructor(e){super(e),this.view=null,this.pickPoint=R(),this.tmpP0=st(),this.panAxisAngle=cC(),this.tmpRayDir=R(),this.tmpRayDirPick=R(),this.targetOnSphere=R(),this.tmpRay={origin:R(),direction:R()},this.dragBeginPoint=Yr(),this.normalizedAnchorPoint=st(),this.constraintOptions={selection:xr.ALL_EXCEPT_COLLISION,interactionType:zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE},this.sphere=Cn(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;_o(this.dragBeginPoint,e),dw(this.startCamera,e,this.normalizedAnchorPoint);const t=bi(this.view.spatialReference),i=Fbe(this.intersectionHelper,this.startCamera,e,t,bE.Ellipsoid,this.view.map.ground.opacity===0?FQe:{});if(this.navMode=tU(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===ho.Horizontal)this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let r,s;dC(this.startCamera,e,this.tmpRay),we(this.tmpRay.direction,this.tmpRay.direction),i.scenePickPoint&&(pe(this.tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Oe(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let n=De($be*r,O4[0],O4[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,Dbe);n=o?Math.min(n,o):n,n=i.scenePickPoint?Math.min(n,s):n,this.hasPickPoint=!0,ce(this.tmpRay.direction,this.tmpRay.direction,n),de(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===ho.Horizontal){pe(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Oe(this.tmpRayDir);dw(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const n=1-(1-r/t)*(1-this.sphere[3]/Oe(this.currentCamera.center));this.currentCamera.center=ce(b$,this.currentCamera.center,n)}ce(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=de(b$,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=Zd(this.dragBeginPoint,e),gs(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(KR(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),DR(this.pickPoint,this.targetOnSphere,this.panAxisAngle),__(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Oe(this.tmpRay.direction);dw(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;ce(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=de(b$,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=de(b$,this.currentCamera.center,this.tmpRayDir)}hC(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],gN.prototype,"view",void 0),gN=u([P("esri.views.3d.state.controllers.global.ZoomController")],gN);const b$=R(),FQe={exclude:new Set([tp])};let yN=class extends b_{constructor(e){super(e),this.view=null,this.tmpP=R(),this.tmpDir=R(),this.tmpN=R(),this.tmpP0=st(),this.tmpPoi=R(),this.tmpRayDir=R(),this.dragBeginPoint=Yr(),this.normalizedAnchorPoint=st(),this.constraintOptions={selection:xr.ALL,interactionType:zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:R(),tiltMode:Bn.TUMBLE},this.plane=vi()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;_o(this.dragBeginPoint,e),dw(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP,this.view.map.ground.opacity===0?kQe:{});pe(this.tmpDir,this.tmpP,this.startCamera.eye);const i=Oe(this.tmpDir);let r;we(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=De($be*r,O4[0],O4[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,Dbe);s=n?Math.min(s,n):s,s=t?Math.min(s,i):s,ce(this.tmpDir,this.tmpDir,s),de(this.tmpP,this.startCamera.eye,this.tmpDir),pe(this.tmpN,this.startCamera.eye,this.startCamera.center),we(this.tmpN,this.tmpN),this.tmpN[1]<0&&ca(this.tmpN,this.tmpN),q2(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;gQe(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||le(this.tmpPoi,this.currentCamera.center),dw(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);_o(this.normalizedAnchorPoint,this.tmpP0),pe(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=Oe(this.tmpRayDir);let r=i*(1-t);le(this.constraintOptions.interactionDirection,this.tmpRayDir),ce(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(ce(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=de(e1,this.currentCamera.eye,this.tmpRayDir),dn(e1,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?e1[2]=Math.max(this.startCamera.center[2],e1[2]):e1[2]=Math.min(this.startCamera.center[2],e1[2]),this.currentCamera.center=e1,this.constraintOptions.interactionFactor=Zd(this.dragBeginPoint,e),gs(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],yN.prototype,"view",void 0),yN=u([P("esri.views.3d.state.controllers.local.ZoomController")],yN);const e1=R(),kQe={exclude:new Set([tp])};class UQe extends Go{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!hQ(t.data,this.pointerAction))return;const r=Yr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new gN({view:this.view}):this.cameraController=new yN({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const zQe=R(),w$=R();function dQ(){return{direction:R(),up:R()}}function Hbe(e,t,i,r,s){let n=we(zQe,e),o=Te(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Te(t,r)),o<.99?(le(n,t),a&&ce(n,n,-1)):n=null);let l=0;if(n){ce(w$,r,Te(r,n)),pe(n,n,w$);const h=Te(n,s)/(Oe(n)*Oe(s));ct(w$,n,s),l=(Te(w$,r)>0?1:-1)*Sc(pn(h))}const c=Sc(pn(-Te(r,e)/Oe(e)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const qbe=Fe(0,1,0),Wbe=Fe(0,0,1),WC=Ae(),km=R(),Um=R();function Xbe(e,t,i,r=dQ()){const{direction:s,up:n}=r;return Hfe(WC,-Dt(t)),V2(WC,WC,Dt(i)),ke(s,Wbe,WC),ce(s,s,-1),ke(n,qbe,WC),r}function VQe(e,t,i,r){return Hbe(t,i,r,Wbe,qbe)}function BQe(e,t,i,r){const s=Xbe(e,i,r),n=R();return ce(n,s.direction,-t),de(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}}function GQe(e){return Sc(e)}function jQe(e){return Dt(e)}function Ybe(e,t,i,r,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return Gn(t,km,n),Gn(t,Um,n),km[0]-=i/2,Um[0]+=i/2,km[1]-=r/2,Um[1]+=r/2,un(km,n,km,o),un(Um,n,Um,o),s?(s.xmin=km[0],s.ymin=km[1],s.xmax=Um[0],s.ymax=Um[1],s.spatialReference=o):s=new ui(km[0],km[1],Um[0],Um[1],o),s}const HQe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:Xbe,directionToHeadingTilt:VQe,eyeForCenterWithHeadingTilt:BQe,lookAtTiltToEyeTilt:GQe,eyeTiltToLookAtTilt:jQe,toExtent:Ybe},Symbol.toStringTag,{value:"Module"})),Zbe=Fe(0,0,1),Qbe=we(R(),Fe(1,1,1)),qQe=new s_(-180,180),XC=Ae(),cv=R(),kx=R();function Jbe(e,t,i,r=dQ()){ct(cv,e,Zbe),Te(cv,cv)===0&&ct(cv,e,Qbe),Fu(XC,-Dt(t),e),mc(XC,XC,-Dt(i),cv);const{up:s,direction:n}=r;return ct(s,cv,e),we(s,s),ke(s,s,XC),we(n,e),ca(n,n),ke(n,n,XC),r}function WQe(e,t,i,r){const s=cv,n=kx;return we(s,e),ct(kx,s,Zbe),Te(kx,kx)===0&&ct(kx,s,Qbe),ct(n,kx,s),Hbe(t,i,r,s,n)}function XQe(e,t,i,r){const s={eye:R(),up:null,tilt:r,heading:i},n=cv;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Dt(i),l=Dt(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Oe(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const re=m/p,$=xp(o/re),k=Math.PI-l-$;y=re*Math.sin(k)}const v=f*o,w=o*o*(p*p),b=h*h*w,S=y-v,T=S*S,E=b*(b+T-n[1]*n[1]);if(E<0)return ce(s.eye,n,y/m),s.tilt=0,s;const C=Math.sqrt(E),A=n[1]*S,I=b+T;let L;if(L=h>0?-C+A:C+A,Math.abs(I)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ce(s.eye,n,y/m),s.tilt=0,LV(s.eye),NV(s,e);s.eye[1]=L/I;const D=c*c*w,U=p*o,z=h*U*s.eye[1],V=s.eye[1]*s.eye[1],X=1-V,Z=Math.sqrt(X),ae=b*V+D-2*z*Z*S+X*T;return Math.abs(ae)<1e-8?(ce(s.eye,n,y/m),s.tilt=0,LV(s.eye),NV(s,e)):(s.eye[0]=(X*(y*n[0]-v*n[0])-U*Z*(n[0]*s.eye[1]*h+n[2]*c))/ae,s.eye[2]=(X*(y*n[2]-v*n[2])-U*Z*(n[2]*s.eye[1]*h-n[0]*c))/ae,ce(s.eye,s.eye,y),LV(s.eye),NV(s,e))}function LV(e){const t=e[1];e[1]=-e[2],e[2]=t}function NV(e,t){const i=Jbe(t,e.heading,e.tilt);return e.up=i.up,e}function YQe(e,t,i){const r=Oe(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=xp(i/(s/Math.sin(e)));return Sc(e-n)}function ZQe(e,t,i){const r=Dt(e),s=Oe(t);return xp(i/(s/Math.sin(r)))+r}function Kbe(e,t,i,r,s){let n,o,a,l;const c=t.latitude,h=bi(e.spatialReference).radius,p=t.longitude,f=ZXe(c,i,h)/2;n=p-f,o=p+f;const m=Dt(c),y=(1+Math.sin(m))/(1-Math.sin(m)),v=(y+1)*Math.tan(r/h/2),w=v*v;function b(T){const E=Math.PI/2;return(T=oOe.normalize(T,-E))>E&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*y+w))),l=a+r/h,a=b(a),l=b(l),l<a){const T=l;l=a,a=T}if(a=Math.max(Sc(a),-90),l=Math.min(Sc(l),90),o=qQe.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const S=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:Ze.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=S):s=new ui(n,a,o,l,S),e.spatialReference&&e.spatialReference.isWebMercator&&qg(s,!1,s),s}const QQe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:Jbe,directionToHeadingTilt:WQe,eyeForCenterWithHeadingTilt:XQe,lookAtTiltToEyeTilt:YQe,eyeTiltToLookAtTilt:ZQe,toExtent:Kbe},Symbol.toStringTag,{value:"Module"}));function L4(e){return e.type==="point"}class ewe{constructor(t,i=null,r=0){this.array=t,this.spatialReference=i,this.offset=r}}function twe(e){return"array"in e}function qf(e,t,i="ground"){if(L4(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(twe(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,ft(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}function wE(e,t){return e!=null&&(t==null||(t===Ve.Local?!e.isGeographic||e.isWGS84||e.wkid===Nh.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===Nh.CGCS2000||e.wkid===Nh.GCSMARS2000||e.wkid===Nh.GCSMARS2000_SPHERE||e.wkid===Nh.GCSMOON2000))}const iwe=ge.getLogger("esri.views.3d.support.cameraUtils"),rwe=39.37,swe=96,RH=1,JQe=8,KQe=5,nwe=1,bne=R(),x$=R(),eJe={heading:0,tilt:0},$g=new at,tJe=new s_(-20037508342788905e-9,20037508342788905e-9),iJe=new s_(-180,180);var zo;function u3(e){return e.spatialReference||Ze.WGS84}function pC(e){return e.viewingMode==="global"?QQe:HQe}function rJe(e,t,i,r,s){return pC(e).headingTiltToDirectionUp(t,i,r,s)}function Ag(e,t){if(M(t))return null;const i=e.renderSpatialReference,r=pC(e).headingTiltToDirectionUp,s=R();if(!Gn(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);ce(n.direction,n.direction,e.state.camera.distance),de(n.direction,n.direction,s);const o=vx(e,s,n.direction,n.up);return o.fov=Dt(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(zo||(zo={}));const Ux=R();function xE(e,t,i){const r=e.renderSpatialReference,s=iU(e,t.eye,t.viewForward,t.up,eJe);let n=u3(e);return un(t.eye,r,Ux,n)||(n=Ze.WGS84,un(t.eye,r,Ux,n)),M(i)?new Cc(new at(Ux,n),s.heading,s.tilt,Sc(t.fov)):(i.position.x=Ux[0],i.position.y=Ux[1],i.position.z=Ux[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Sc(t.fov),i)}function pQ(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===Ve.Global&&i!=null&&(t*=Math.cos(Dt(i))),t/=e.renderCoordsHelper.unitInMeters,s/(swe*rwe/t)/Math.tan(r.fovX/2)}function qw(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=swe*rwe/(n/s);return e.renderCoordsHelper.viewingMode===Ve.Global&&(o/=Math.cos(Dt(i))),o*=e.renderCoordsHelper.unitInMeters,o}function owe(e,t,i,r,s,n){return awe(e,t,pQ(e,i,t.latitude),r,s,n)}function awe(e,t,i,r,s,n){if(pw(n)){const a=new fC(n.signal);return eP(e,r.heading,r.tilt,t,i,s,a),void a.resolver.promise.then(l=>{const c=F4(e,l,r.fov);if(!M(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=eP(e,r.heading,r.tilt,t,i,s);return F4(e,o,r.fov,n)}function iU(e,t,i,r,s){return pC(e).directionToHeadingTilt(t,i,r,s)}function sJe(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,$g,e.spatialReference)&&ft(qf(e.elevationProvider,$g),0)>$g.z-nwe)}async function nJe(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,$g,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation($g.x,$g.y,$g.z,$g.spatialReference,"ground",i);return ft(r,0)>$g.z-nwe}async function oJe(e,t,i){const r=R();if(t)if(t instanceof at){if(Gn(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return _(s)&&e.renderCoordsHelper.setAltitude(r,s),r}}else le(r,t);else le(r,e.state.camera.center);return r}function aJe(e,t){const i=R();if(t&&t instanceof at){if(Gn(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const r=qf(e.elevationProvider,t);_(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else le(i,t||e.state.camera.center);return i}function eP(e,t,i,r,s,n,o){const a=r&&r instanceof at?r:null;if(pw(o))return oJe(e,r,o.signal).then(c=>{PH(e,t,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=aJe(e,r);return PH(e,t,i,a,l,s,n,o)}function PH(e,t,i,r,s,n,o,a){if(M(r)){const p=e.renderSpatialReference;if(r=a_(s,p,u3(e)),M(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=uJe(e,t,i,s,n,o),c=(0,pC(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===zo.ADJUST&&e.viewingMode==="global"&&i>0){const p=()=>{const m=lwe(e,s,n,dJe(e,n,i,s));return o=i-m<1?zo.LOCKED:zo.ADJUST,PH(e,t,m,r,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(sJe(e,c.eye))return p();if(pw(a))return nJe(e,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:Bs(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||pw(a)?{center:R(),eye:R(),up:R(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=Bs(s),h.heading=c.heading,h.tilt=c.tilt,pw(a)&&a.resolver.resolve(h),h}function OO(e,t,i,r,s,n=null){const o=t.zmax!=null&&t.zmin!=null;let a,l,c;if(e.state.isGlobal){if(!wE(t.spatialReference,Ve.Global))return pw(n)&&n.resolver.reject(),null;const b=new at(t.xmin,t.ymin,t.spatialReference),S=new at(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?iJe:tJe;a=new at({x:T.center(b.x,S.x),y:(S.y+b.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const E=bi(t.spatialReference),C=YXe(a,b,S);l=C.lon,c=C.lat,T.diff(b.x,S.x)>T.range/2&&(l+=E.halfCircumference),l=Math.min(l,E.halfCircumference),c=Math.min(c,E.halfCircumference)}else{const b=ft(e.renderSpatialReference,t.spatialReference);b.equals(t.spatialReference)||(t=GP(t,b)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const S=o?(t.zmax+t.zmin)/2:null;a=new at({x:t.xmin+.5*l,y:t.ymin+.5*c,z:S,spatialReference:b})}const h=o?t.zmax-t.zmin:0,p=e.state.camera,f=1/Math.tan(p.fovX/2),m=1/Math.tan(p.fovY/2),y=1/Math.tan(p.fov/2),v=Math.max(.5*l*f,.5*c*m,.5*h*y)/RH;if(pw(n)){const b=new fC(n.signal);return eP(e,i,r,a,v,s,b),void b.resolver.promise.then(S=>{const T=F4(e,S,e.camera.fov);if(!M(T))return n.resolver.resolve(T);n.resolver.reject()},S=>n.resolver.reject(S))}const w=eP(e,i,r,a,v,s);return F4(e,w,e.camera.fov,n)}function lJe(e,t,i){const r=e.renderSpatialReference,s=a_(i,r,u3(e));if(M(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=gW(t.eye,i),l=2*a*n*RH,c=2*a*o*RH;return e.viewingMode==="global"?Kbe(e,s,l,c):Ybe(e,s,l,c)}function cJe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>JQe)return!0;const s=e.renderSpatialReference,n=u3(e),o=a_(t,s,n),a=a_(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(M(o)||M(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return a.distance(o)/l>KQe}function uJe(e,t,i,r,s,n){let o=0;return n===zo.ADJUST&&cJe(e,r,s)?(t=0,o=hJe(e,s,i,r)):o=fQ(e,r,s,i),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:i=lwe(e,r,s,o)}}const N4=.7;function hJe(e,t,i,r){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-N4)+s.max*N4,o=fQ(e,r,t,i);return Math.min(o,n)}function dJe(e,t,i,r){const s=e.state.constraints.tilt(t);let n=fQ(e,r,t,i);return n=Math.min(n,.5*Math.PI),s.min*(1-N4)+n*N4}function lwe(e,t,i,r){return pC(e).lookAtTiltToEyeTilt(r,t,i)}function fQ(e,t,i,r){return pC(e).eyeTiltToLookAtTilt(r,t,i)}function F4(e,t,i,r){if(M(t))return null;const s=e.renderSpatialReference,n=a_(t.eye,s,u3(e));return M(n)?null:_(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new Cc(n,t.heading,t.tilt,i)}function cwe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(t);iwe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function uwe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(t);iwe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function pJe(e,t){return e.spatialReference?pge(t,e.spatialReference):void 0}function hwe(e,t,i){const r=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=Ze.WGS84;return t instanceof Cc?(s=t.position.latitude,Gn(t.position,bne,r),Gn(i,x$,r),n=hr(bne,x$)):(un(t.center,r,x$,o),s=x$[1],n=t.distance),qw(e,n,s)}class fC{constructor(t){this.signal=t,this.resolver=bp()}}function pw(e){return e&&"resolver"in e}function md(e){let t=e*e;return e<0&&(t*=-1),t}function wne(e,t,i){const r=i,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=md(s.axes[0]),r.translation[1]=md(s.axes[1]),r.translation[2]=md(s.buttons[7])-md(s.buttons[6]),r.heading=md(s.axes[2]),r.tilt=md(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*md(s.axes[0]),r.translation[1]=1.2*md(s.axes[1]),r.translation[2]=2*-md(s.axes[2]),r.heading=1.2*md(s.axes[5]),r.tilt=1.2*md(s.axes[3])),r.tilt*=o,ce(r.translation,r.translation,a),r}function xne(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function FV(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let yv=class extends b_{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new ir,this.constraintOptions={selection:xr.ALL,interactionType:zt.NONE,interactionStartCamera:new ir,interactionFactor:0,interactionDirection:null,tiltMode:Bn.LOOK_AROUND}}handleEventGamepad(e){const t=wne(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||FV(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,xne(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=xne(this.keysButtonState,this.transformation);FV(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,t1),this._applyDisabledMovementTypes(t1),this._applyPan(t1.pan),this._applyRotate(t1.rotate),this._applyZoom(t1.zoom),this._applyAscend(t1.ascend),this.constraintOptions.interactionType=zt.NONE,this.constraintOptions.selection=xr.COLLISION,gs(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;pe(Xa,t.center,t.eye),ke(Xa,Xa,e.matrix),t.center=de(Xa,Xa,t.eye),t.up=ke(Xa,t.up,e.matrix),this.constraintOptions.interactionType=zt.LOOK_AROUND,this.constraintOptions.selection=xr.ALL_EXCEPT_COLLISION,gs(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=ke(Xa,t.eye,e.matrix),t.center=ke(Xa,t.center,e.matrix),this.view.state.isGlobal&&(t.up=ke(Xa,t.up,e.matrix)),this.constraintOptions.interactionType=zt.PAN,this.constraintOptions.selection=xr.ALL,gs(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=de(Xa,this.currentCamera.eye,ce(He.get(),t,e)),le(YC,t),ca(YC,YC),this.constraintOptions.interactionDirection=YC,this.constraintOptions.interactionType=zt.ZOOM,this.constraintOptions.selection=xr.ALL_EXCEPT_COLLISION,gs(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,He.get());if(this.constraintOptions.interactionDirection=le(YC,t),this.view.state.isGlobal){const i=Oe(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=ce(Xa,this.currentCamera.eye,r),this.currentCamera.center=ce(Xa,this.currentCamera.center,r)}else{const i=ce(He.get(),t,e);this.currentCamera.eye=de(Xa,this.currentCamera.eye,i),this.currentCamera.center=de(Xa,this.currentCamera.center,i)}this._updateCameraCenter(),this.constraintOptions.interactionType=zt.ASCEND,this.constraintOptions.selection=xr.COLLISION,gs(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=xr.ALL_EXCEPT_COLLISION,gs(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){bJe(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,Xa)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=ne(He.get(),s[0],s[1],0);we(a,a);const l=n.translation[0]*e.pan;if(l!==0){const y=ce(He.get(),r,l);ja(i.pan.matrix,i.pan.matrix,y),i.pan.enabled=!0}switch(o.mode){case"pan":{const y=-n.translation[1]*e.pan;if(y!==0){const v=ce(He.get(),a,y);ja(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(mc(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,He.get())),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=v_(this.view.renderCoordsHelper,t.center,t.eye),m=De(f+p,Lo.min,Lo.max)-f;m&&(mc(i.rotate.matrix,i.rotate.matrix,m,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=ct(He.get(),s,r);we(a,a),ca(a,a),xQe(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,o),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(t1.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(mc(i.rotate.matrix,i.rotate.matrix,h,this.tmpCamera.eye),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(mc(i.rotate.matrix,i.rotate.matrix,f,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=bi(this.view.spatialReference),s=mN(Lo.min,t.origin,i,r);let n=0,o=0;const a=He.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){const l=v_(this.view.renderCoordsHelper,a,t.origin);n=mN(l,t.origin,i,r),o=mN(Lo.max,t.origin,i,r)}else{QE(ak(lk,i+r.radius),t,a);const l=pn(-Te(t.direction,we(a,a)));n=lne(l,t.origin,i,r),o=lne(Lo.max,t.origin,i,r)}return De(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=rJe(this.view,t,0,dwe,_Je),n=i.intersectManifoldClosestSilhouette(Uu(t,s),e,He.get()),o=hr(t,n),a=i.intersectManifoldClosestSilhouette(Uu(t,wy(He.get(),t,r.center)),e,He.get()),l=hr(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,He.get());if(s){const o=pe(He.get(),e,n),a=Oe(o);ce(o,o,1/a);const l=we(He.get(),e),c=pn(Te(l,o));return a*Math.sin(Math.min(mJe,c))}{const o=le(He.get(),e);return t.setAltitude(o,this.filteredSurfaceElevation),hr(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:gJe}_computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+bi(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=He.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,c=Tne*r.width,h=Tne*r.width,p=a*Math.tan(.5*r.fovX)/l,f=p/i,m=p/this._computeHeadingRotateRadius(n),y=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*y-y),zoom:2**(c*e/l)*a-a,rotate:De(m*h,yJe,vJe)*e}}_applyDisabledMovementTypes(e){!_(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&dm(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&dm(e.rotate.matrix))}static activatesFor(e,t){const i=wne(t,e.navigation.gamepad,fJe);return!(t.action==="end"||FV(i))}};u([d({constructOnly:!0})],yv.prototype,"view",void 0),u([d({constructOnly:!0})],yv.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],yv.prototype,"disableMovements",void 0),yv=u([P("esri.views.3d.state.controllers.GamepadKeyboardController")],yv);const fJe={translation:[0,0,0],heading:0,tilt:0,zoom:0},dwe=80,mJe=Dt(dwe),Tne=.75,gJe=5,yJe=Dt(30),vJe=Dt(80),t1={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ae()},rotate:{enabled:!1,matrix:Ae()}},Xa=R(),YC=R(),_Je=dQ();function bJe(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,dm(e.pan.matrix),e.rotate.enabled=!1,dm(e.rotate.matrix)}class wJe extends Go{constructor(t){super(!0),this.view=t,this.watchHandles=new jt,this.handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([se(()=>this.view.navigation.gamepad.enabled,i=>{i?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},At),se(()=>this.view.navigation.gamepad.device,i=>{this.cameraControllerGamepad&&i&&this.cameraControllerGamepad.gamepadDevice!==i&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const i=this.view.navigation.gamepad.device;if(i&&t.data.device!==i)return;const r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||yv.activatesFor(this.view,t.data)){if(!r){const s=new yv({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(s)&&(this.cameraControllerGamepad=s)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var Kl;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(Kl||(Kl={}));class xJe extends Go{constructor(t,i){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ve.Local},this.keyToNumber={[i.left]:Kl.LEFT,[i.right]:Kl.RIGHT,[i.forward]:Kl.FORWARD,[i.backward]:Kl.BACKWARD,[i.up]:Kl.UP,[i.down]:Kl.DOWN,[i.headingLeft]:Kl.HEADINGLEFT,[i.headingRight]:Kl.HEADINGRIGHT,[i.tiltUp]:Kl.TILTUP,[i.tiltDown]:Kl.TILTDOWN,[i.zoomIn]:Kl.ZOOMIN,[i.zoomOut]:Kl.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new yv({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(i),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(i),t.stopPropagation())}}class TJe extends Go{constructor(t,i){super(!0),this.view=t,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const i=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new $4({view:this.view,mode:"interaction"}):new D4({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*i.deltaY,Yr(i.x,i.y)),t.preventDefault(),t.stopPropagation()}}class k4{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let Kv=class extends JR{constructor(e){super(e),this.view=null,this.beginCamera=new ir,this.elapsedTimeSec=0,this.constraintOptions={selection:xr.ALL,interactionType:zt.PAN,interactionFactor:0,interactionStartCamera:new ir,interactionDirection:null,tiltMode:Bn.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new sE}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),gs(this.view,t,this.constraintOptions)}};u([d({constructOnly:!0})],Kv.prototype,"view",void 0),Kv=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Kv);let RO=class extends Kv{constructor(e){super(e),this.interactionType=zt.PAN,this.tmpPan=R()}momentumStep(e,t){const i=this.momentum.value(e);ce(this.tmpPan,this.momentum.direction,i),t.eye=pe(Sne,t.eye,this.tmpPan),t.center=pe(Sne,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};u([d({constructOnly:!0})],RO.prototype,"momentum",void 0),RO=u([P("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],RO);const Sne=R(),SJe=R(),T$=R();let vN=class extends Kv{constructor(e){super(e),this.interactionType=zt.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);le(T$,t.eye),we(T$,T$),ct(this.momentum.axis2,T$,this.momentum.axis1),Vbe(t,SJe,this.momentum.axis1,i,this.momentum.axis2,r)}};u([d({constructOnly:!0})],vN.prototype,"momentum",void 0),vN=u([P("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],vN);let $b=class extends Kv{constructor(e){super(e),this.interactionType=zt.TUMBLE}set center(e){this._set("center",Bs(e))}set axis(e){this._set("axis",Bs(e))}momentumStep(e,t){const i=this.momentum.value(e);__(t,this.center,$R(this.axis,i))}};u([d({constructOnly:!0})],$b.prototype,"momentum",void 0),u([d({constructOnly:!0})],$b.prototype,"center",null),u([d({constructOnly:!0})],$b.prototype,"axis",null),$b=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],$b);let kS=class extends Kv{constructor(e){super(e),this.interactionType=zt.ZOOM,this.constraintOptions.interactionDirection=R()}set zoomCenter(e){this._set("zoomCenter",Bs(e))}momentumStep(e,t){le(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);lQ(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=wy(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};u([d({constructOnly:!0})],kS.prototype,"momentum",void 0),u([d({constructOnly:!0})],kS.prototype,"zoomCenter",null),kS=u([P("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],kS);let ob=class extends Kv{constructor(e){super(e),this.interactionType=zt.ZOOM,this.radius=0,this.tmpSceneCenter=R(),this.tmpZoomAxisAngle=cC(),this.sphere=Cn()}set screenCenter(e){this._set("screenCenter",Yr(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Bs(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);Lbe(this.sphere,t,i),this.constraintOptions.interactionType=zt.ZOOM,gs(this.view,t,this.constraintOptions),KR(this.sphere,t,this.screenCenter,this.tmpSceneCenter),DR(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),__(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=zt.PAN}};u([d({constructOnly:!0})],ob.prototype,"momentum",void 0),u([d({constructOnly:!0})],ob.prototype,"screenCenter",null),u([d({constructOnly:!0})],ob.prototype,"sceneCenter",null),u([d({constructOnly:!0})],ob.prototype,"radius",void 0),ob=u([P("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],ob);class Qd{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class rU{constructor(t,i,r){this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const r=this.value(t);return this.value(t+i)-r}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const r=1-this.friction;return t*(r**i-1)/Math.log(r)}}class EJe extends rU{constructor(t,i,r,s,n){super(t,i,r),this.sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class pwe{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.time=new Qd(.6),this.screen=[new Qd(.4),new Qd(.4)],this.scene=[new Qd(.6),new Qd(.6),new Qd(.6)],this.tmpDirection=R()}add(t,i,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(i[0]),this.scene[1].update(i[1]),this.scene[2].update(i[2]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){ne(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=Oe(this.tmpDirection);s>0&&ce(this.tmpDirection,this.tmpDirection,1/s);const n=s/this.time.filteredDelta;return new EJe(t,i,r,n,this.tmpDirection)}}class Ene{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const Cne=1e-5;class CJe extends rU{constructor(t,i,r,s,n,o=0,a){super(t,i,r),this.angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class AJe{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.tmpAxis1=R(),this.tmpAxis2=R(),this.tmpAngles=st(),this.time=new Qd(.3),this.screen=[new Qd(.4),new Qd(.4)],this.angle1=new Ene(.6),this.angle2=new Ene(.6),this.axis1=R(),this.axis2=R(),this.lastScene=R()}addMomentumDirectRotation(t,i,r,s,n,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;let a=Ube(this.lastScene,i,this.tmpAxis2,s,n,o);this.angle2.update(0),Fa(this.tmpAxis2)<Cne?a=0:we(this.axis1,this.tmpAxis2),this.angle1.update(a),le(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,o,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;zbe(this.lastScene,i,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,s,n,o,a,!1),Fa(this.tmpAxis2)<Cne?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),we(this.axis1,this.tmpAxis1),we(this.axis2,this.tmpAxis2)),le(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){const s=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new CJe(t,i,r,s,this.axis1,n,this.axis2)}}class fwe{constructor(t=2.5,i=.01,r=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.maxVelocity=s,this.enabled=!0,this.value=new Qd(.8),this.time=new Qd(.3)}add(t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=De(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,i,r){return new rU(t,i,r)}}class mwe extends fwe{constructor(t=3,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){if(this.value.hasLastValue){const r=this.value.lastValue;let s=t-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=r+s}super.add(t,i)}}class MJe extends rU{constructor(t,i,r){super(t,i,r)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const r=super.value(t),s=super.value(t+i)-r;return Math.exp(s)}}class gwe extends fwe{constructor(t=2.5,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,r){return new MJe(t,i,r)}}let _N=class extends b_{constructor(e){super(e),this.view=null,this.smoothRotation=new k4(.05),this.rotationAxis=R(),this.panningPlane=vi(),this.smoothScaling=new k4(.05),this.zoomCenterScreen=Yr(),this.zoomMomentumEstimator=new gwe,this.rotationMomentumEstimator=new mwe,this.panSphericalMomentumEstimator=new AJe,this.panPlanarMomentumEstimator=new pwe,this.adjustedSphere=Cn(),this.tmp3d=R(),this.tmpScreenPointArray=Yr(),this.beginScreenPoint=Yr(),this.beginScenePoint=R(),this.screenPickPoint=Yr(),this.navMode=ho.Horizontal,this.tmpInteractionDirection=R(),this.constraintOptions={selection:xr.ALL,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:new ir,interactionDirection:null,tiltMode:Bn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-n_.normalize(Dt(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),Lg(e.center,this.screenPickPoint),_o(this.beginScreenPoint,this.screenPickPoint);const i=bi(this.view.spatialReference),r=Fbe(this.intersectionHelper,this.startCamera,this.screenPickPoint,i,bE.Silhouette);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,le(this.beginScenePoint,this.scenePickPoint),this.navMode=tU(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===ho.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=ca(this.tmp3d,this.startCamera.viewForward);q2(this.scenePickPoint,t,this.panningPlane);const i=Yr(this.screenPickPoint[0],0),r=R(),s=Oe(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],KR(this.adjustedSphere,this.startCamera,i,r);const n=Fo();this.startCamera.projectToRenderScreen(r,n);const o=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],o);const a=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);a&&q2(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=R(),c=R(),h=R(),p=80,f=5,m=50;pe(l,this.scenePickPoint,this.currentCamera.eye);const y=Oe(l);we(l,l);const v=f*Math.max(Math.abs(this.view.camera.position.z),m),w=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,p);let b=w?Math.min(w,v):v;b=a?Math.min(b,y):b,le(h,de(c,this.currentCamera.eye,ce(c,l,b))),this.panningPlane[3]=-Te(this.panningPlane,h),this.startCamera.center=de(c,this.startCamera.eye,ce(c,this.startCamera.viewForward,b));const S=Lg(e.center,this.tmpScreenPointArray);OH(this.panningPlane,this.startCamera,S,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===ho.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===ho.Horizontal?new ob({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new kS({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new $b({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===ho.Horizontal){const r=this.panSphericalMomentumEstimator.evaluateMomentum();if(r)return new vN({view:this.view,momentum:r})}else{const r=this.panPlanarMomentumEstimator.evaluateMomentum();if(r)return new RO({view:this.view,momentum:r})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),Lbe(this.sphere,this.currentCamera,this.smoothScaling.value),Lg(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=zt.ZOOM,this.constraintOptions.interactionFactor=Zd(e.radius-this.beginRadius),gs(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=Lg(e.center,this.tmpScreenPointArray);KR(this.sphere,this.currentCamera,t,this.tmp3d),cQ(this.beginScenePoint,Te(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(Gbe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(Bbe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=zt.PAN,this.constraintOptions.interactionFactor=Zd(this.screenPickPoint,t),gs(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){we(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||ca(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+MH(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),__(this.currentCamera,this.sphere,$R(this.rotationAxis,s)),this.constraintOptions.interactionType=zt.TUMBLE,this.constraintOptions.interactionFactor=Zd(e.radius*i),gs(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=Lg(e.center,this.tmpScreenPointArray);OH(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(kbe(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=zt.PAN,this.constraintOptions.interactionFactor=Zd(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),gs(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),lQ(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=zt.ZOOM,this.constraintOptions.interactionFactor=Zd(e.radius-this.beginRadius),gs(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){le(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||ca(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=MH(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),__(this.currentCamera,this.sphere,$R(this.rotationAxis,n)),this.constraintOptions.interactionType=zt.TUMBLE,this.constraintOptions.interactionFactor=Zd(e.radius*n),gs(this.view,this.currentCamera,this.constraintOptions)}};u([d({constructOnly:!0})],_N.prototype,"view",void 0),_N=u([P("esri.views.3d.state.controllers.global.PinchAndPanController")],_N);const Ane=Fe(0,0,1),OJe={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},RJe=80;let bN=class extends b_{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new k4(.05),this.scalingValueSmooth=new k4(.05),this.planeHorizontal=vi(),this.planeVertical=vi(),this.rotationMomentumEstimator=new mwe,this.panMomentumEstimator=new pwe(300,12,.9),this.zoomMomentumEstimator=new gwe,this.beginCenter=R(),this.tmpPoints=[],this.beginCenterScreen=Yr(),this.tmpCentroid3d=R(),this.tmpCentroid2d=Yr(),this.tmp2d=Yr(),this.constraintOptions={selection:xr.ALL,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:new ir,interactionDirection:null,tiltMode:Bn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),Lg(e.center,this.beginCenterScreen),Xme(Ane,0,this.planeHorizontal);const i=R(),r=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i),s=R();ca(s,this.startCamera.viewForward);const n=R();le(n,Ane);const o=Te(s,n),a=xp(o<0?-o:o);if(this.panMode=a>=OJe.ANGLE_THRESHOLD?ho.Horizontal:ho.Vertical,GG(this.planeHorizontal,this.planeHorizontal,i),this.startCamera.aboveGround||jG(this.planeHorizontal,this.planeHorizontal),this.panMode===ho.Vertical){ce(n,n,o),pe(this.planeVertical,s,n),we(this.planeVertical,this.planeVertical),GG(this.planeVertical,this.planeVertical,i);const l=R(),c=R(),h=R();pe(l,i,this.currentCamera.eye);const p=Oe(l);we(l,l);const f=5*Math.max(Math.abs(this.view.camera.position.z),50),m=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,RJe);let y=m?Math.min(m,f):f;y=r?Math.min(y,p):y,le(h,de(c,this.currentCamera.eye,ce(c,l,y))),this.planeVertical[3]=-Te(this.planeVertical,h),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),OV(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),OV(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===ho.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const s=this.beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=n,this.scalingValueSmooth.update(s),lQ(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=zt.ZOOM,this.constraintOptions.interactionFactor=Zd(Math.abs(e.radius-this.beginRadius)),gs(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),OV(this.tmpPoints,this.tmpCentroid3d),Lg(e.center,this.tmpCentroid2d),kbe(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=zt.PAN,this.constraintOptions.interactionFactor=Zd(this.beginCenterScreen,this.tmpCentroid2d),gs(this.view,this.currentCamera,this.constraintOptions),t){const s=this.planeHorizontal,n=r,o=this.rotationValueSmooth.value,a=o+MH(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=l,this.rotationValueSmooth.update(a);const c=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*e.timestamp),__(this.currentCamera,n,$R(s,c)),this.constraintOptions.interactionType=zt.TUMBLE,this.constraintOptions.interactionFactor=Zd(Math.abs(e.radius*c)),gs(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new kS({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new $b({view:this.view,momentum:i,center:this.beginCenter,axis:this.planeHorizontal});const r=this.panMomentumEstimator.evaluateMomentum();return r?new RO({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const s=this.tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,r[n]===void 0&&(r[n]=R()),OH(t,i,s,r[n]),n+=1}),r}};u([d({constructOnly:!0})],bN.prototype,"view",void 0),bN=u([P("esri.views.3d.state.controllers.local.PinchAndPanController")],bN);class Mne extends Go{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!hQ(t.data,this.pointerAction))return;const i=t.timestamp-this.lastEndTimestamp,r=40,s=this.momentum&&this.momentum.active&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const r=this.controller.end(t.data);i&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new _N({view:this.view}):new bN({view:this.view})}}class PJe extends Go{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}}class ywe extends Go{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class IJe extends ywe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class $Je extends ywe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class DJe extends Go{constructor(t,i=!1){super(!0),this.view=t,this.invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){var s,n,o;const i=this.invert?-1:1,r=Yr(0,t.data.delta*i);switch(t.data.action){case"begin":(s=this.cameraController)==null||s.end(),this.cameraController=new FS({view:this.view,pivot:nc.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":(n=this.cameraController)==null||n.update(r);break;case"end":(o=this.cameraController)==null||o.end(),this.cameraController=null}}}function One(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:t.axes.map(i=>FJe(i,e.axisThreshold))}:{buttons:[],axes:[]}}function LJe(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function NJe(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function FJe(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}class kJe{constructor(t,i){this.element=t,this.input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this.inputDevices[a];l&&(this._emitGamepadEvent(o,One(l),!1),this.inputDevices.splice(a,1),this.latestUpdate.splice(a,1),this.input.gamepad.devices.remove(l),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const i=new fZ(t);i.deviceType!=="unknown"&&(this.inputDevices[t.index]=i,this.input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=vw({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this.element.contains(document.activeElement),r=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this.inputDevices[s.index];if(!n)return;const o=this.latestUpdate[s.index],a=One(n),l=r||NJe(a);o&&(o.timestamp===s.timestamp||!o.active&&l||LJe(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this.callback&&this.callback({device:this.inputDevices[t.index],state:i,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}}const Rne=he("trident"),Pne=he("edge"),UJe=he("chrome"),zJe=he("ff"),VJe=he("safari"),zx={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class sU{constructor(t,i){this.input=i,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new kJe(t,this.input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const r=this._active[i];this._element.removeEventListener(kV[i],r),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&kV[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(kV[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,i){i?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?zx.touchNone:zx.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?zx.touchPan:zx.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(zx.touchNone),this._element.classList.remove(zx.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=B_e(this._element,t);return sU.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const r=u7e(i);r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:(Rne||Pne)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Rne||Pne?r*=.7:UJe||VJe?r*=.6:zJe&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,o)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}sU.test={disableSubpixelCoordinates:!1};const kV={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class BJe extends Go{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function vwe(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function GJe(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function jJe(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:Tp()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[T,E]=e,[C,A]=[E.x-T.x,E.y-T.y];return t.radius=Math.sqrt(C*C+A*A)/2,t.center.x=(T.x+E.x)/2,t.center.y=(T.y+E.y)/2,t}let i=0,r=0;for(let T=0;T<e.length;T++)i+=e[T].x,r+=e[T].y;i/=e.length,r/=e.length;const s=e.map(T=>T.x-i),n=e.map(T=>T.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let T=0;T<s.length;T++){const E=s[T],C=n[T],A=E*E,I=C*C;o+=A,a+=I,l+=E*C,c+=A*E,h+=I*C,p+=E*I,f+=C*A}const m=.5*(c+p),y=.5*(h+f),v=o*a-l*l,w=(m*a-y*l)/v,b=(o*y-l*m)/v,S=Tp(w+i,b+r);return{radius:Math.sqrt(w*w+b*b+(o+a)/e.length),center:S}}class HJe extends Go{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:i.buttons,timestamp:s,pointers:qJe(this.activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=S$(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(i,s);const n=wN(s,_we(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this.activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=S$(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=S$(this.activePointerMap);this.activePointerMap.forEach(r=>{r.initialAngle=wN(r,i)-t,r.lastAngle=wN(r,i)-t})}_emitEvent(t,i,r){const s=S$(this.activePointerMap);this.drag.emit(this._createPayload(t,i,s,r),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this.activePointerMap.get(i)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this.isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(r),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function _we(e){const t=[];return e.forEach(i=>{t.push(Tp(i.event.x,i.event.y))}),jJe(t)}function S$(e){const t=_we(e);let i=0;return e.forEach(r=>{let s=wN(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s,i+=s-r.initialAngle}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function qJe(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function wN(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var Ine;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(Ine||(Ine={}));const kv={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class WJe extends Go{constructor(t=kv.maximumDoubleClickDelay,i=kv.maximumDoubleClickDistance,r=kv.maximumDoubleTouchDelay,s=kv.maximumDoubleTouchDistance,n=O5){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=Vs(t.doubleClickTimeout))}get hasPendingInputs(){return on(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_handleImmediateClick(t){const i=t.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s){const n=i.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;vwe(s.event.data,i)>n?(this._clearDoubleClickTimeout(r,!0),this._startClick(t)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const i=this._pointerId(t.data),r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(i,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(i),r)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const i=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(i,!0)}_handleDrag(t){const i=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(i,!0)}_clearDoubleClickTimeout(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,i&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class XJe extends Go{constructor(t=kv.maximumDoubleClickDelay,i=kv.maximumDoubleClickDistance,r=kv.maximumDoubleTouchDelay,s=kv.maximumDoubleTouchDistance,n=O5){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=this._pointerId(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerLoss(t,i){const r=t.data,s=this._pointerId(r),n=this._pointerState.get(s);if(n&&i==="pointer-up"&&n.downButton===r.native.button){const o=n.immediateDoubleClick;if(o){o.timeoutHandle.remove();const a=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;vwe(o,t.data)>a?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,o.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_removeState(t){const i=this._pointerId(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const ZC={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class YJe extends Go{constructor(t=ZC.maximumClickDelay,i=ZC.movementUntilMouseDrag,r=ZC.movementUntilPenDrag,s=ZC.movementUntilTouchDrag,n=ZC.holdDelay,o=O5){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=i,this.movementUntilPenDrag=r,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):GJe(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}}class ZJe{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this.currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class QJe extends Go{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new ZJe({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this.dragEventSeparator.handle(r))}get failed(){return this.state==="failed"}_observeStart(t,i){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;i.pointers.forEach(v=>{r=Math.max(r,v.x),s=Math.min(s,v.x),n=Math.max(n,v.y),o=Math.min(o,v.y)});let a=-1/0,l=1/0,c=-1/0,h=1/0;t.pointers.forEach(v=>{a=Math.max(a,v.x),l=Math.min(l,v.x),c=Math.max(c,v.y),h=Math.min(h,v.y)});const p=r-s,f=n-o,m=a-l,y=c-h;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}}let mf=class extends Se{constructor(){super(...arguments),this._handles=new jt}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return(e=this._inputManager)==null?void 0:e.hasPendingInputs}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new sU(this.view.surface,e.input);const t=[new XJe,new YJe,new WJe,new HJe(this.view.navigation),new QJe],i=new U0({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new BJe],Yv.INTERNAL),this._modeDragPan=new Mne(e,"primary"),this._modeDragRotate=new DV(e,"secondary",nc.CENTER),this._modeDragZoom=new UQe(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new PJe(e),new LQe(e),new wJe(e),new xJe(e,r.pan),new TJe(e),new $Je(e,r.resetTilt),new IJe(e,r.resetHeading),new DV(e,"primary",nc.EYE,[r.lookAround]),new DV(e,"secondary",nc.CENTER,[r.lookAround]),new Mne(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new DJe(e)],Yv.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(se(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},At))}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=IH.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],mf.prototype,"view",void 0),u([d({value:"pan"})],mf.prototype,"primaryDragAction",null),u([d({value:"default"})],mf.prototype,"mode",null),u([d({readOnly:!0})],mf.prototype,"hasPendingInputs",null),u([d()],mf.prototype,"latestPointerType",null),u([d()],mf.prototype,"latestPointerLocation",null),u([d()],mf.prototype,"_inputManager",void 0),mf=u([P("esri.views.3d.input.SceneInputManager")],mf);const IH=new Map,UV=new Map,zV=new Map;UV.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),UV.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),zV.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),zV.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),IH.set("default",UV),IH.set("pro",zV);const JJe=mf;let hs=class extends Se{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],hs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],hs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],hs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],hs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],hs.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],hs.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],hs.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],hs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],hs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],hs.prototype,"SHOW_POI",void 0),u([d()],hs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],hs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],hs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],hs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],hs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],hs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],hs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],hs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],hs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],hs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],hs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],hs.prototype,"LINE_WIREFRAMES",void 0),hs=u([P("esri.views.3d.support.DebugFlags")],hs);const ji=new hs;let ou,c2,$H=!1,DH=!1,LH=!1,NH=!1,PO=null;function KJe(e,t){if(!DH||!c2)return;bwe();const i=c2;let r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];r+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),wwe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function eKe(e){LH=ji.DECONFLICTOR_SHOW_VISIBLE,NH=ji.DECONFLICTOR_SHOW_INVISIBLE,$H=LH||NH,DH=ji.DECONFLICTOR_SHOW_GRID,PO=null,$H||DH?PO=()=>tKe(e):ou&&(ou.parentElement.removeChild(ou),ou=null)}function bwe(){PO&&(PO(),PO=null)}function tKe(e){ou==null&&(ou=document.createElement("canvas"),ou.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(ou));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;ou.setAttribute("width",`${o}px`),ou.setAttribute("height",`${a}px`),ou.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),c2=ou.getContext("2d"),c2.clearRect(0,0,s,n),c2.font="12px Arial"}function wwe(e,t,i,r,s){bwe();const n=ou.height,o=c2;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function iKe(e,t){$H&&(t&&LH||!t&&NH)&&wwe(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var lo,bu;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(lo||(lo={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(bu||(bu={}));function xwe(e,t){return new nU(e,Cwe,t)}function rKe(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=Cwe;return new nU(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:VV.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:VV.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:VV.minPixelSize},t)}function sKe(e){return Math.abs(e*e*e)}function Twe(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return QC.scale=Math.min(r.divisor/(t-r.offset),1),QC.factor=sKe(e),QC.minPixelSize=r.minPixelSize,QC.paddingPixels=s,QC}function Swe(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function mQ(e,t){return Math.max(qt(e*t.scale,e,t.factor),Swe(e,t))}function nKe(e,t,i){const r=Twe(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,mQ(1,r)}function $ne(e,t,i,r){r.scale=nKe(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function Ewe(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,Swe(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function oKe(e,t,i,r){return mQ(e,Twe(t,i,r))}class nU{constructor(t,i,r,s=aKe(),n){this.viewingMode=t,this.description=i,this.ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this.viewingMode===Ve.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new nU(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this.description,{fovY:a,distance:l}=t,c=this.calculateCurvatureDependentParameters(t,i),h=this.coverageCompensation(t,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),v=m/Math.cos(y),w=y+a*n*h,b=(v-f*(m/Math.cos(w)))/(1-f);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=b,r.divisor=v-b,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(t,i,r=Dne){return r.tiltAngle=this.description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,i,r=Dne){const s=this.description.curvatureDependent,n=1+t.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=De((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return r.tiltAngle=qt(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=qt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(t,i,r){return(t.fovY-r.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}}const Cwe={curvatureDependent:{min:{curvature:Dt(10),tiltAngle:Dt(12),scaleFallOffFactor:.5},max:{curvature:Dt(70),tiltAngle:Dt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},VV={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function aKe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const QC={scale:0,factor:0,minPixelSize:0,paddingPixels:0},Dne={tiltAngle:0,scaleFallOffFactor:0};function lKe(e){return e instanceof Float32Array&&e.length>=16}function cKe(e){return Array.isArray(e)&&e.length>=16}function uKe(e){return lKe(e)||cKe(e)}var K;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(K||(K={}));function gQ(e){e.vertex.code.add(x`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(x`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(x`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(x`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(x`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(x`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(x`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function hKe(e){e.uniforms.add(new ri("screenSizePerspective",t=>Awe(t.screenSizePerspective)))}function oU(e){e.uniforms.add(new ri("screenSizePerspectiveAlignment",t=>Awe(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function Awe(e){return Ji(dKe,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const dKe=Ht();class FH extends Jr{constructor(t,i){super(t,"mat4",Ui.Draw,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}function mm(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",za):e.uniforms.add(new Va("cameraPosition",(i,r)=>ne(Mwe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Ru(e,t){if(e.vertex.uniforms.add(new Er("proj",(r,s)=>s.camera.projectionMatrix)),t.instancedDoublePrecision){const r=(n,o)=>ne(Mwe,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new Er("view",(n,o)=>ja(Lne,o.camera.viewMatrix,r(n,o))));const s=new xt("localOrigin",r);return e.vertex.uniforms.add(s),s}e.vertex.uniforms.add(new FH("view",(r,s)=>ja(Lne,s.camera.viewMatrix,r.origin)));const i=new Va("localOrigin",r=>r.origin);return e.vertex.uniforms.add(i),i}const Lne=WP(),Mwe=R();function Owe(e,t){const i=e.vertex;t.hasVerticalOffset?(Rwe(i),t.hasScreenSizePerspective&&(e.include(gQ),oU(i),mm(e.vertex,t)),i.code.add(x`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?x`vec3 worldNormal = normalize(worldPos + localOrigin);`:x`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?x`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:x`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(x`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const pKe=Ht();function Rwe(e){e.uniforms.add(new ri("verticalOffset",(t,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Ji(pKe,n*a,o,r,s)}))}var Eh;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(Eh||(Eh={}));var _l;function Pwe(e,t){e.include(gQ),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.NORMAL,"vec3"),e.attributes.add(O.AUXPOS1,"vec4");const i=e.vertex;Ru(e,t),mm(i,t),i.uniforms.add([new ri("viewport",(r,s)=>s.camera.fullViewport),new Xe("polygonOffset",r=>r.shaderPolygonOffset),new Xe("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1),new Xe("renderTransparentlyOccludedHUD",(r,s)=>s.renderTransparentlyOccludedHUD===Eh.Occluded?1:s.renderTransparentlyOccludedHUD===Eh.NotOccluded?0:.75),new Vt("hudVisibilityTexture",(r,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&Rwe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(x`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(x`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new Er("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),t.isDraped||(i.uniforms.add(new Xe("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(x`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===_l.Screen&&i.uniforms.add(new Xe("pixelRatio",(r,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&oU(i),i.code.add(x`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===_l.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?x`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==_l.Screen?x`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===_l.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===_l.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(x`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(_l||(_l={}));const E$=Hs();function aU(e,t,i,r,s,n,o){if(!l3(t))if(e.boundingInfo){pt(e.primitiveType===Al.Triangle);const a=i.tolerance;Iwe(e.boundingInfo,r,s,a,n,o)}else{const a=e.indices.get(O.POSITION),l=e.vertexAttributes.get(O.POSITION);h3(r,s,0,a.length/3,a,l,void 0,n,o)}}const fKe=R();function Iwe(e,t,i,r,s,n){if(M(e))return;const o=Dwe(t,i,fKe);if(Ipe(E$,e.getBBMin()),$pe(E$,e.getBBMax()),_(s)&&s.applyToAabb(E$),vQ(E$,t,o,r)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>_Ke){const p=e.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&Iwe(p[f],t,i,r,s,n);return}}h3(t,i,0,h,l,c,a,s,n)}}const $we=R();function h3(e,t,i,r,s,n,o,a,l){if(o)return mKe(e,t,i,r,s,n,o,a,l);const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],y=t[0]-p,v=t[1]-f,w=t[2]-m;for(let b=i,S=3*i;b<r;++b){let T=h*s[S++],E=c[T++],C=c[T++],A=c[T];T=h*s[S++];let I=c[T++],L=c[T++],D=c[T];T=h*s[S++];let U=c[T++],z=c[T++],V=c[T];_(a)&&([E,C,A]=a.applyToVertex(E,C,A,b),[I,L,D]=a.applyToVertex(I,L,D,b),[U,z,V]=a.applyToVertex(U,z,V,b));const X=I-E,Z=L-C,ae=D-A,re=U-E,$=z-C,k=V-A,B=v*k-$*w,H=w*re-k*y,Y=y*$-re*v,ee=X*B+Z*H+ae*Y;if(Math.abs(ee)<=Number.EPSILON)continue;const G=p-E,te=f-C,fe=m-A,xe=G*B+te*H+fe*Y;if(ee>0){if(xe<0||xe>ee)continue}else if(xe>0||xe<ee)continue;const Le=te*ae-Z*fe,_e=fe*X-ae*G,ye=G*Z-X*te,Ce=y*Le+v*_e+w*ye;if(ee>0){if(Ce<0||xe+Ce>ee)continue}else if(Ce>0||xe+Ce<ee)continue;const Pe=(re*Le+$*_e+k*ye)/ee;Pe>=0&&l(Pe,yQ(X,Z,ae,re,$,k,$we),b,!1)}}function mKe(e,t,i,r,s,n,o,a,l){const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],y=t[0]-p,v=t[1]-f,w=t[2]-m;for(let b=i;b<r;++b){const S=o[b];let T=3*S,E=h*s[T++],C=c[E++],A=c[E++],I=c[E];E=h*s[T++];let L=c[E++],D=c[E++],U=c[E];E=h*s[T];let z=c[E++],V=c[E++],X=c[E];_(a)&&([C,A,I]=a.applyToVertex(C,A,I,b),[L,D,U]=a.applyToVertex(L,D,U,b),[z,V,X]=a.applyToVertex(z,V,X,b));const Z=L-C,ae=D-A,re=U-I,$=z-C,k=V-A,B=X-I,H=v*B-k*w,Y=w*$-B*y,ee=y*k-$*v,G=Z*H+ae*Y+re*ee;if(Math.abs(G)<=Number.EPSILON)continue;const te=p-C,fe=f-A,xe=m-I,Le=te*H+fe*Y+xe*ee;if(G>0){if(Le<0||Le>G)continue}else if(Le>0||Le<G)continue;const _e=fe*re-ae*xe,ye=xe*Z-re*te,Ce=te*ae-Z*fe,Pe=y*_e+v*ye+w*Ce;if(G>0){if(Pe<0||Le+Pe>G)continue}else if(Pe>0||Le+Pe<G)continue;const xi=($*_e+k*ye+B*Ce)/G;xi>=0&&l(xi,yQ(Z,ae,re,$,k,B,$we),S,!1)}}const Nne=R(),Fne=R();function yQ(e,t,i,r,s,n,o){return ne(Nne,e,t,i),ne(Fne,r,s,n),ct(o,Nne,Fne),we(o,o),o}function Dwe(e,t,i){return ne(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function vQ(e,t,i,r){return _Q(e,t,i,r,1/0)}function _Q(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-r-t[2])*i[2],f=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function Lwe(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;_(s)&&(n=oKe(n,r,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return De(o*t,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function Nwe(e,t){const i=t?Nwe(t):{};for(const r in e){let s=e[r];s&&s.forEach&&(s=vKe(s)),s==null&&r in i||(i[r]=s)}return i}function gKe(e,t){let i=!1;for(const r in t){const s=t[r];s!==void 0&&(Array.isArray(s)?e[r]===null?(e[r]=s.slice(),i=!0):Kq(e[r],s)&&(i=!0):e[r]!==s&&(i=!0,e[r]=s))}return i}function yKe(e,t,i,r,s,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(O.POSITION).data,a=e.vertexAttributes.get(O.SIZE),l=a&&a.data[0],c=r[0],h=r[1],p=((l+s)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],w=o[y+1],b=c-v,S=h-w,T=o[y+3]-v,E=o[y+4]-w,C=De((T*b+E*S)/(T*T+E*E),0,1),A=T*C-b,I=E*C-S,L=A*A+I*I;L<f&&(f=L,m=y/3)}f<p*p&&n(i.dist,i.normal,m,!1)}function vKe(e){const t=[];return e.forEach(i=>t.push(i)),t}const Fwe={multiply:1,ignore:2,replace:3,tint:4},_Ke=1e3;class Rm extends a3{constructor(t,i){super(),this.type=Mp.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=zi,this._parameters=Nwe(t,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,i=!0){gKe(this._parameters,t)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){_(this.repository)&&this.repository.materialChanged(this)}}var Fr;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(Fr||(Fr={}));class mC extends Ys{constructor(){super(...arguments),this.renderOccluded=Fr.Occlude}}function ISt(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=t[e[l]],r+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function bKe(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let a=0;a<o;++a){const l=2*e[a];s[r]=t[l],s[r+1]=t[l+1],r+=n}}function kwe(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}}function TE(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}}function lU(e,t,i,r,s,n=1){if(!i)return void kwe(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,c=i[0],h=i[1],p=i[2],f=i[4],m=i[5],y=i[6],v=i[8],w=i[9],b=i[10],S=i[12],T=i[13],E=i[14];if(s*=a,n===1)for(let C=0;C<l;++C){const A=3*e[C],I=t[A],L=t[A+1],D=t[A+2];o[s]=c*I+f*L+v*D+S,o[s+1]=h*I+m*L+w*D+T,o[s+2]=p*I+y*L+b*D+E,s+=a}else for(let C=0;C<l;++C){const A=3*e[C],I=t[A],L=t[A+1],D=t[A+2],U=c*I+f*L+v*D+S,z=h*I+m*L+w*D+T,V=p*I+y*L+b*D+E;for(let X=0;X<n;++X)o[s]=U,o[s+1]=z,o[s+2]=V,s+=a}}function bQ(e,t,i,r,s,n=1){if(!i)return void kwe(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],v=o[6],w=o[8],b=o[9],S=o[10],T=!SX(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const I=3*e[A],L=t[I],D=t[I+1],U=t[I+2];let z=h*L+m*D+w*U,V=p*L+y*D+b*U,X=f*L+v*D+S*U;if(T){const Z=z*z+V*V+X*X;if(Z<C&&Z>E){const ae=1/Math.sqrt(Z);z*=ae,V*=ae,X*=ae}}a[s+0]=z,a[s+1]=V,a[s+2]=X,s+=l}else for(let A=0;A<c;++A){const I=3*e[A],L=t[I],D=t[I+1],U=t[I+2];let z=h*L+m*D+w*U,V=p*L+y*D+b*U,X=f*L+v*D+S*U;if(T){const Z=z*z+V*V+X*X;if(Z<C&&Z>E){const ae=1/Math.sqrt(Z);z*=ae,V*=ae,X*=ae}}for(let Z=0;Z<n;++Z)a[s+0]=z,a[s+1]=V,a[s+2]=X,s+=l}}function wKe(e,t,i,r,s,n=1){if(!i)return void TE(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],v=o[6],w=o[8],b=o[9],S=o[10],T=!SX(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const I=4*e[A],L=t[I],D=t[I+1],U=t[I+2],z=t[I+3];let V=h*L+m*D+w*U,X=p*L+y*D+b*U,Z=f*L+v*D+S*U;if(T){const ae=V*V+X*X+Z*Z;if(ae<C&&ae>E){const re=1/Math.sqrt(ae);V*=re,X*=re,Z*=re}}a[s+0]=V,a[s+1]=X,a[s+2]=Z,a[s+3]=z,s+=l}else for(let A=0;A<c;++A){const I=4*e[A],L=t[I],D=t[I+1],U=t[I+2],z=t[I+3];let V=h*L+m*D+w*U,X=p*L+y*D+b*U,Z=f*L+v*D+S*U;if(T){const ae=V*V+X*X+Z*Z;if(ae<C&&ae>E){const re=1/Math.sqrt(ae);V*=re,X*=re,Z*=re}}for(let ae=0;ae<n;++ae)a[s+0]=V,a[s+1]=X,a[s+2]=Z,a[s+3]=z,s+=l}}function U4(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,n===1){if(i===4)for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else if(i===4)for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}function cU(e,t,i,r,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case O.POSITION:{pt(a.size===3);const c=s.getField(o,Hi);c&&lU(l,a.data,i,c,n);break}case O.NORMAL:{pt(a.size===3);const c=s.getField(o,Hi);c&&bQ(l,a.data,r,c,n);break}case O.UV0:{pt(a.size===2);const c=s.getField(o,ed);c&&bKe(l,a.data,c,n);break}case O.COLOR:{pt(a.size===3||a.size===4);const c=s.getField(o,$l);c&&U4(l,a.data,a.size,c,n);break}case O.SYMBOLCOLOR:{pt(a.size===3||a.size===4);const c=s.getField(o,$l);c&&U4(l,a.data,a.size,c,n);break}case O.TANGENT:{pt(a.size===4);const c=s.getField(o,jn);c&&wKe(l,a.data,r,c,n);break}}}}function tP(e,t,i=0){const r=De(e,0,SKe);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*EKe(r*xKe[s]))}function wQ(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*TKe[r];return i}const xKe=[1,256,65536,16777216],TKe=[1/256,1/65536,1/16777216,1/4294967296],SKe=wQ(new Uint8ClampedArray([255,255,255,255]));function EKe(e){return e-Math.floor(e)}function CKe(){if(M(BV)){const e=t=>Li(`esri/libs/basisu/${t}`);BV=import("./basis_transcoder.3f8e35cf.js").then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(i=>(i.initializeBasis(),delete i.then,i)))}return BV}let BV;var Db;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(Db||(Db={}));let gp=null,C$=null;async function Uwe(){return M(C$)&&(C$=CKe(),gp=await C$),C$}function AKe(e,t){if(M(gp))return e.byteLength;const i=new gp.BasisFile(new Uint8Array(e)),r=Vwe(i)?zwe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function MKe(e,t){if(M(gp))return e.byteLength;const i=new gp.KTX2File(new Uint8Array(e)),r=Bwe(i)?zwe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function zwe(e,t,i,r,s){const n=E1e(t?is.COMPRESSED_RGBA8_ETC2_EAC:is.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function Vwe(e){return e.getNumImages()>=1&&!e.isUASTC()}function Bwe(e){return e.getFaces()>=1&&e.isETC1S()}async function OKe(e,t,i){M(gp)&&(gp=await Uwe());const r=new gp.BasisFile(new Uint8Array(i));if(!Vwe(r))return null;r.startTranscoding();const s=Gwe(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function RKe(e,t,i){M(gp)&&(gp=await Uwe());const r=new gp.KTX2File(new Uint8Array(i));if(!Bwe(r))return null;r.startTranscoding();const s=Gwe(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function Gwe(e,t,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?r?[Db.ETC2_RGBA,is.COMPRESSED_RGBA8_ETC2_EAC]:[Db.ETC1_RGB,is.COMPRESSED_RGB8_ETC2]:c?r?[Db.BC3_RGBA,is.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Db.BC1_RGB,is.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Db.RGBA32,ze.RGBA],f=t.hasMipmap?i:Math.min(1,i),m=[];for(let b=0;b<f;b++)m.push(new Uint8Array(o(b,h))),a(b,h,m[b]);const y=m.length>1,v=y?tt.LINEAR_MIPMAP_LINEAR:tt.LINEAR,w=me(F({},t),{samplingMode:v,hasMipmap:y,internalFormat:p,width:s,height:n});return new ot(e,w,{type:"compressed",levels:m})}const JC=ge.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),PKe=542327876,IKe=131072,$Ke=4;function xQ(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function DKe(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const LKe=xQ("DXT1"),NKe=xQ("DXT3"),FKe=xQ("DXT5"),kKe=31,UKe=0,zKe=1,VKe=2,BKe=3,GKe=4,jKe=7,HKe=20,qKe=21;function WKe(e,t,i){const{textureData:r,internalFormat:s,width:n,height:o}=XKe(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?tt.LINEAR_MIPMAP_LINEAR:tt.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new ot(e,t,r)}function XKe(e,t){const i=new Int32Array(e,0,kKe);if(i[UKe]!==PKe)return JC.error("Invalid magic number in DDS header"),null;if(!(i[HKe]&$Ke))return JC.error("Unsupported format, must contain a FourCC code"),null;const r=i[qKe];let s,n;switch(r){case LKe:s=8,n=is.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case NKe:s=16,n=is.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case FKe:s=16,n=is.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return JC.error("Unsupported FourCC code:",DKe(r)),null}let o=1,a=i[GKe],l=i[BKe];(3&a)==0&&(3&l)==0||(JC.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;i[VKe]&IKe&&t!==!1&&(o=Math.max(1,i[jKe])),o===1||A2(a)&&A2(l)||(JC.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=i[zKe]+4;const y=[];for(let v=0;v<o;++v)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}class Ns extends a3{constructor(t,i){super(),this.data=t,this.type=Mp.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new as,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:bt.REPEAT,t:bt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||Zv.STRETCH,this.estimatedTexMemRequired=Ns._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;M(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(k2(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const i=!t.paused;if(t.src=t.src,i&&t.autoplay){const r=()=>{t.removeEventListener("canplay",r),t.play()};t.addEventListener("canplay",r)}}}_startPreloadImageElement(t){xm(t.src)||k2(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,i){if(M(t))return 0;if(vC(t)||bb(t))return i.encoding===Ns.KTX2_ENCODING?MKe(t,i.mipmap):i.encoding===Ns.BASIS_ENCODING?AKe(t,i.mipmap):t.byteLength;const{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?Ns._getDataDimensions(t):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var i;return{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?tt.LINEAR_MIPMAP_LINEAR:tt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(i=this.params.maxAnisotropy)!=null?i:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,i){if(_(this._glTexture))return this._glTexture;if(_(this._loadingPromise))return this._loadingPromise;const r=this.data;return M(r)?(this._glTexture=new ot(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,i,r):r instanceof Image?this._loadFromImageElement(t,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,i):(vC(r)||bb(r))&&this.params.encoding===Ns.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,r)):(vC(r)||bb(r))&&this.params.encoding===Ns.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,r)):(vC(r)||bb(r))&&this.params.encoding===Ns.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,r)):bb(r)?this._loadFromPixelData(t,r):vC(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,i,r){if(!(this.data instanceof HTMLVideoElement)||M(this._glTexture)||this.data.readyState<IO.HAVE_CURRENT_DATA||r===this.data.currentTime)return r;if(_(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this.data),this._drawStretchedTexture(t,i,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this.data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(t,i){return this._glTexture=WKe(t,this._createDescriptor(t),i),this._glTexture}_loadFromKTX2(t,i){return this._loadAsync(()=>RKe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(t,i){return this._loadAsync(()=>OKe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(t,i){pt(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=this.params.components===1?ze.LUMINANCE:this.params.components===3?ze.RGB:ze.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new ot(t,r,i),this._glTexture}_loadFromURL(t,i,r){return this._loadAsync(async s=>{const n=await Cp(r,{signal:s});return ci(s),this._loadFromImage(t,n,i)})}_loadFromImageElement(t,i,r){return r.complete?this._loadFromImage(t,r,i):this._loadAsync(async s=>{const n=await Kpe(r,r.src,!1,s);return ci(s),this._loadFromImage(t,n,i)})}_loadFromVideoElement(t,i,r){return r.readyState>=IO.HAVE_CURRENT_DATA?this._loadFromImage(t,r,i):this._loadFromVideoElementAsync(t,i,r)}_loadFromVideoElementAsync(t,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),Vs(h)},l=()=>{r.readyState>=IO.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,r,i)))},c=p=>{a(),o(p||new q("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=ha(s,()=>c(hi()))}))}_loadFromImage(t,i,r){const s=Ns._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?ze.RGB:ze.RGBA,!this._requiresPowerOfTwo(t,n)||A2(s.width)&&A2(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new ot(t,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,i,s,n,r),this._glTexture)}_loadAsync(t){const i=new AbortController;this._loadingController=i;const r=t(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(t,i){const r=bt.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return!zn(t.gl)&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(t,i,r,s,n){const{width:o,height:a}=r,l=C2(o),c=C2(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case Zv.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new ot(t,s),h.updateData(0,0,0,o,a,i);break;case Zv.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,i,r,s){const n=new ot(t,r),o=new Or(t,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE},n),a=new ot(t,{target:mt.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=qa(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,i,r,s,n,o){t.bindFramebuffer(r);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height);const l=t.bindTechnique(i);l.setUniform4f("uColor",1,1,1,1),l.bindTexture("tex",n),t.bindVAO(s),t.drawArrays(It.TRIANGLE_STRIP,0,ko(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height)}unload(){if(_(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(_(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),_(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var IO;Ns.DDS_ENCODING="image/vnd-ms.dds",Ns.KTX2_ENCODING="image/ktx2",Ns.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(IO||(IO={}));const iP=128,TQ=.5;function jwe(e,t=iP,i=t*TQ,r=0){const s=YKe(e,t,i,r);return new Ns(s,{mipmap:!1,wrap:{s:bt.CLAMP_TO_EDGE,t:bt.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function YKe(e,t=iP,i=t*TQ,r=0){switch(e){case"circle":default:return ZKe(t,i);case"square":return QKe(t,i);case"cross":return KKe(t,i,r);case"x":return eet(t,i,r);case"kite":return JKe(t,i);case"triangle":return tet(t,i);case"arrow":return iet(t,i)}}function ZKe(e,t){const i=e/2-.5;return d3(e,Wwe(i,i,t/2))}function QKe(e,t){return Hwe(e,t,!1)}function JKe(e,t){return Hwe(e,t,!0)}function KKe(e,t,i=0){return qwe(e,t,!1,i)}function eet(e,t,i=0){return qwe(e,t,!0,i)}function tet(e,t){return d3(e,Xwe(e/2,t,t/2))}function iet(e,t){const i=t,r=t/2,s=e/2,n=.8*i,o=Wwe(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),a=Xwe(s,i,r);return d3(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function Hwe(e,t,i){return i&&(t/=Math.SQRT2),d3(e,(r,s)=>{let n=r-.5*e+.25,o=.5*e-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function qwe(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return d3(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function Wwe(e,t,i){return(r,s)=>{const n=r-e,o=s-t;return Math.sqrt(n*n+o*o)-i}}function Xwe(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const o=Math.abs(s-e)-i,a=n-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function d3(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const n=s+e*r;let o=t(s,r);o=o/e+.5,tP(o,i,4*n)}return i}class $St extends Ys{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function ret(e,t){Ywe(e,t,[new xt("slicePlaneOrigin",(i,r)=>Kwe(t,i,r)),new xt("slicePlaneBasis1",(i,r)=>{var s;return z4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new xt("slicePlaneBasis2",(i,r)=>{var s;return z4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function ys(e,t){Ywe(e,t,[new Va("slicePlaneOrigin",(i,r)=>Kwe(t,i,r)),new Va("slicePlaneBasis1",(i,r)=>{var s;return z4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Va("slicePlaneBasis2",(i,r)=>{var s;return z4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function Ywe(e,t,i){if(!t.hasSlicePlane){const o=x`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=x`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=x`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?x`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:x`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function Zwe(e,t,i){return e.instancedDoublePrecision?ne(set,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function Qwe(e,t){return _(e)?pe(V4,t.origin,e):t.origin}function Jwe(e,t,i){return e.hasSliceTranslatedView?_(t)?ja(net,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function Kwe(e,t,i){if(M(i.slicePlane))return za;const r=Zwe(e,t,i),s=Qwe(r,i.slicePlane),n=Jwe(e,r,i);return _(n)?ke(V4,s,n):s}function z4(e,t,i,r){if(M(r)||M(i.slicePlane))return za;const s=Zwe(e,t,i),n=Qwe(s,i.slicePlane),o=Jwe(e,s,i);return _(o)?(de(KC,r,n),ke(V4,n,o),ke(KC,KC,o),pe(KC,KC,V4)):r}const set=R(),V4=R(),KC=R(),net=Ae();function oet(e,t){const{vertex:i,fragment:r}=e;t.hasMultipassGeometry&&i.include(J1e),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(x`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?x`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&r.include(zu),t.hasMultipassTerrain&&r.uniforms.add([new Vt("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new pi("nearFar",(s,n)=>n.camera.nearFar),new pi("inverseViewport",(s,n)=>n.inverseViewport)]),r.include($c),r.code.add(x`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?x`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const aet=mi(1,1,0,1),exe=mi(1,0,1,1);function Iy(e){e.fragment.uniforms.add(new Vt("depthTex",(t,i)=>i.highlightDepthTexture)),e.fragment.uniforms.add(new pi("highlightViewportPixelSz",(t,i)=>i.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",aet).add("unoccludedHighlightFlag","vec4",exe),e.fragment.code.add(x`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}class uU extends Jr{constructor(t,i,r){super(t,"vec4",Ui.Pass,(s,n,o)=>s.setUniform4fv(t,i(n,o)),r)}}class aa extends Jr{constructor(t,i,r){super(t,"float",Ui.Pass,(s,n,o)=>s.setUniform1fv(t,i(n,o)),r)}}class p3 extends Jr{constructor(t,i){super(t,"mat3",Ui.Pass,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class SQ extends mC{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Fe(1,1,1),this.vvSizeMaxSize=Fe(100,100,100),this.vvSizeOffset=Fe(0,0,0),this.vvSizeFactor=Fe(1,1,1),this.vvSizeValue=Fe(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Pr()}}const yp=8;function u2(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new xt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new xt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new xt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new xt("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new p3("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new xt("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(x`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(x`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?x`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(x`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",yp),t.hasVvInstancing&&i.uniforms.add([new aa("vvColorValues",r=>r.vvColorValues,yp),new uU("vvColorColors",r=>r.vvColorColors,yp)]),i.code.add(x`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?x`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(x`vec4 vvColor() { return vec4(1.0); }`)}const B4=.1,Vo=.001;function cet(e){const t=new qi,i=e.signedDistanceFieldEnabled;if(t.include(HZ),t.include(Pwe,e),t.include(ys,e),e.output===K.Occlusion)return t.include(oet,e),t;const{vertex:r,fragment:s}=t;t.include(gQ),s.include($c),s.include(Mm),t.include(u2,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),r.uniforms.add([new ri("viewport",(c,h)=>h.camera.fullViewport),new pi("screenOffset",(c,h)=>di(txe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new pi("anchorPosition",c=>G4(c)),new ri("materialColor",c=>c.color),new Xe("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new ri("outlineColor",c=>c.outlineColor)),s.uniforms.add([new ri("outlineColor",c=>kne(c)?c.outlineColor:Qf),new Xe("outlineSize",c=>kne(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(hKe(r),oU(r)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"vec2"),t.attributes.add(O.AUXPOS2,"vec4"),r.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?x`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=x`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?i?x`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x`posProj += quadOffset;`;e.vvColor&&r.uniforms.add([new uU("vvColorColors",c=>c.vvColorColors,yp),new aa("vvColorValues",c=>c.vvColorValues,yp)]),r.uniforms.add(new pi("textureCoordinateScaleFactor",c=>_(c.texture)&&_(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:Ome)),r.code.add(x`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${x.float(Vo)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.float(Vo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?x`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Vt("tex",c=>c.texture));const a=e.debugDrawLabelBorder?x`(isBorder > 0.0 ? 0.0 : ${x.float(B4)})`:x.float(B4),l=x`
    ${e.debugDrawLabelBorder?x`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?x`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${x.float(iP)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.float(Vo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?x`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===K.Alpha&&s.code.add(x`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===K.Color&&s.code.add(x`
    void main() {
      ${l}
      ${e.transparencyPassType===vt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===K.Highlight&&(t.include(Iy),s.code.add(x`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?x`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function kne(e){return e.outlineColor[3]>0&&e.outlineSize>0}function G4(e,t=txe){return e.textureIsSignedDistanceField?uet(e.anchorPosition,e.distanceFieldBoundingBox,t):_o(t,e.anchorPosition),t}function uet(e,t,i){_(t)?di(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):di(i,0,0)}const txe=st(),het=Object.freeze(Object.defineProperty({__proto__:null,build:cet,calculateAnchorPosForRendering:G4},Symbol.toStringTag,{value:"Module"})),Pu=bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),det=Am(Me.ONE,Me.ONE),ixe=Am(Me.ZERO,Me.ONE_MINUS_SRC_ALPHA);function $y(e){return e===vt.FrontFace?null:e===vt.Alpha?ixe:det}function hU(e){return e===vt.FrontFace?Il:null}const dU=5e5,pU={factor:-1,units:-2};function fU(e){return e?pU:null}function D_(e,t=yr.LESS){return e===vt.NONE||e===vt.FrontFace?t:yr.LEQUAL}class f3 extends fr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global}initializeProgram(t){const i=f3.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}_setPipelineState(t){const i=this.configuration,r=t===vt.NONE,s=t===vt.FrontFace,n=this.configuration.hasPolygonOffset&&pet,o=(r||s)&&i.output!==K.Highlight?(i.depthEnabled||i.output===K.Occlusion)&&Il:null;return Ut({blending:i.output===K.Color||i.output===K.Alpha||i.output===K.Highlight?r?fet:$y(t):null,depthTest:{func:yr.LEQUAL},depthWrite:o,colorWrite:ti,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===K.Occlusion?It.POINTS:It.TRIANGLES}}f3.shader=new sr(het,()=>import("./HUDMaterial.glsl.79fc918d.js"));const pet={factor:0,units:-4},fet=Am(Me.ONE,Me.ONE_MINUS_SRC_ALPHA);class la extends Ha{}u([j({constValue:!0})],la.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],la.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],la.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!1})],la.prototype,"isGround",void 0),u([j({constValue:Ui.Pass})],la.prototype,"pbrTextureBindType",void 0);class Rs extends la{constructor(){super(...arguments),this.output=K.Color,this.screenCenterOffsetUnitsEnabled=_l.World,this.transparencyPassType=vt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],Rs.prototype,"output",void 0),u([j({count:_l.COUNT})],Rs.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j({count:vt.COUNT})],Rs.prototype,"transparencyPassType",void 0),u([j()],Rs.prototype,"spherical",void 0),u([j()],Rs.prototype,"occlusionTestEnabled",void 0),u([j()],Rs.prototype,"signedDistanceFieldEnabled",void 0),u([j()],Rs.prototype,"vvSize",void 0),u([j()],Rs.prototype,"vvColor",void 0),u([j()],Rs.prototype,"hasVerticalOffset",void 0),u([j()],Rs.prototype,"hasScreenSizePerspective",void 0),u([j()],Rs.prototype,"debugDrawLabelBorder",void 0),u([j()],Rs.prototype,"binaryHighlightOcclusionEnabled",void 0),u([j()],Rs.prototype,"hasSlicePlane",void 0),u([j()],Rs.prototype,"hasPolygonOffset",void 0),u([j()],Rs.prototype,"depthEnabled",void 0),u([j()],Rs.prototype,"pixelSnappingEnabled",void 0),u([j()],Rs.prototype,"isDraped",void 0),u([j()],Rs.prototype,"hasMultipassGeometry",void 0),u([j()],Rs.prototype,"hasMultipassTerrain",void 0),u([j()],Rs.prototype,"cullAboveGround",void 0),u([j({constValue:!0})],Rs.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Rs.prototype,"hasVvInstancing",void 0);class SE extends Rm{constructor(t){super(t,new Eet),this.techniqueConfig=new Rs}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?_l.Screen:_l.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===K.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===K.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=i.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedHudGeometry(t,o,a,l,c):this._intersectHudGeometry(t,i,r,s,a,l)}_intersectDrapedHudGeometry(t,i,r,s,n){const o=t.vertexAttributes.get(O.POSITION),a=t.vertexAttributes.get(O.SIZE),l=this.parameters,c=G4(l);let h=1,p=1;if(_(s)){const m=s(Vne);h=m[0],p=m[5]}h*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const f=xet*t.screenToWorldRatio;for(let m=0;m<o.data.length/o.size;m++){const y=m*o.size,v=o.data[y],w=o.data[y+1],b=m*a.size;let S;Zy[0]=a.data[b]*h,Zy[1]=a.data[b+1]*p,l.textureIsSignedDistanceField&&(S=l.outlineSize*t.screenToWorldRatio/2),Une(i,v,w,Zy,f,S,l,c)&&r(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(t,i,r,s,n,o){if(!s.options.selectionMode||!s.options.hud||l3(i))return;const a=this.parameters;let l=1,c=1;if(Jh(jV,r),_(o)){const S=o(Vne);l=S[0],c=S[5],yet(jV)}const h=t.vertexAttributes.get(O.POSITION),p=t.vertexAttributes.get(O.SIZE),f=t.vertexAttributes.get(O.NORMAL),m=t.vertexAttributes.get(O.AUXPOS1);pt(h.size>=3);const y=s.point,v=s.camera,w=G4(a);l*=v.pixelRatio,c*=v.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let S=0;S<h.data.length/h.size;S++){const T=S*h.size;ne(Yo,h.data[T],h.data[T+1],h.data[T+2]),ke(Yo,Yo,r);const E=S*p.size;Zy[0]=p.data[E]*l,Zy[1]=p.data[E+1]*c,ke(Yo,Yo,v.viewMatrix);const C=S*m.size;if(ne(Uc,m.data[C+0],m.data[C+1],m.data[C+2]),!b&&(Yo[0]+=Uc[0],Yo[1]+=Uc[1],Uc[2]!==0)){const I=Uc[2];we(Uc,Yo),pe(Yo,Yo,ce(Uc,Uc,I))}const A=S*f.size;if(ne(eA,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(eA,jV,v,HV),this._applyVerticalOffsetTransformationView(Yo,HV,v,GV),v.applyProjection(Yo,ga),ga[0]>-1){ga[0]=Math.floor(ga[0]),ga[1]=Math.floor(ga[1]),b&&(Uc[0]||Uc[1])&&(ga[0]+=Uc[0],Uc[1]!==0&&(ga[1]+=mQ(Uc[1],GV.factorAlignment)),v.unapplyProjection(ga,Yo)),ga[0]+=this.parameters.screenOffset[0],ga[1]+=this.parameters.screenOffset[1],Ewe(Zy,GV.factor,Zy);const I=wet*v.pixelRatio;let L;if(a.textureIsSignedDistanceField&&(L=a.outlineSize*v.pixelRatio/2),Une(y,ga[0],ga[1],Zy,I,L,a,w)){const D=s.ray;if(ke(zne,Yo,vs(bet,v.viewMatrix)),ga[0]=y[0],ga[1]=y[1],v.unprojectFromRenderScreen(ga,Yo)){const U=R();le(U,D.direction);const z=1/Oe(U);ce(U,U,z),n(hr(D.origin,Yo)*z,U,-1,!0,1,zne)}}}}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(O.POSITION),n=t.indices.get(O.POSITION);return cbe(s,n,i)}createBufferWriter(){return new Aet(this)}_normalAndViewAngle(t,i,r,s){return uKe(i)&&(i=Jh(_et,i)),fc(s.normal,t,i),ke(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=Te(sxe,Tet),s}_updateScaleInfo(t,i,r){const s=this.parameters;_(s.screenSizePerspective)?$ne(r,i,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),_(s.screenSizePerspectiveAlignment)?$ne(r,i,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,HV);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,i,r,s,n){return this._applyCenterOffsetNDC(t,i,r,s),_(n)&&le(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(t,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return le(n,t);const c=De(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ce(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,i,r,s){const n=Oe(t),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=ce(Yo,i.normal,o*a);return de(s,t,l),s}_applyVerticalOffsetTransformationView(t,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Oe(t);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Oe(t),a=ft(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=Lwe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),ce(i.normal,i.normal,l),de(t,t,i.normal)}_applyCenterOffsetView(t,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==t&&le(r,t),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(we(eA,r),de(r,r,ce(eA,eA,i[2])))),r}_applyCenterOffsetNDC(t,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&le(s,t),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(t,i,r,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&le(s,t),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(t){if(t===Ee.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:r}=this.parameters;return t===(i?Ee.LABEL_MATERIAL:Ee.HUD_MATERIAL)||r&&t===Ee.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha?new met(t):t.output===K.Highlight?new rxe(t):null}calculateRelativeScreenBounds(t,i,r=Nt()){return get(this.parameters,t,i,r),r[2]=r[0]+t[0],r[3]=r[1]+t[1],r}}class rxe extends OZ{constructor(t){super(F(F({},t),t.material.parameters))}selectProgram(t){return this.ensureTechnique(f3,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}class met extends rxe{_isOcclusionSlot(t){return t.slot===Ee.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===K.Color||this._output===K.Alpha)}selectProgram(t){return this.ensureTechnique(f3,t,this._isOcclusionSlot(t)?K.Occlusion:this._output)}}function get(e,t,i,r=vet){return _o(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function yet(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function Une(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&_(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const GV={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},vet=st(),Yo=R(),eA=R(),ga=Ht(),sxe=R(),zne=R(),jV=Pr(),_et=Pr(),bet=Ae(),Uc=R(),HV={normal:sxe,cosAngle:0},Vne=Ae(),wet=1,xet=2,Zy=[0,0],Tet=Fe(0,0,1);class Eet extends z1e{constructor(){super(...arguments),this.renderOccluded=Fr.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Ni(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const Cet=ls().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.AUXPOS1).vec4f(O.AUXPOS2);class Aet{constructor(t){this.material=t,this.vertexBufferLayout=Cet}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(O.POSITION).length}write(t,i,r,s){lU(i.indices.get(O.POSITION),i.vertexAttributes.get(O.POSITION).data,t.transformation,r.position,s,6),bQ(i.indices.get(O.NORMAL),i.vertexAttributes.get(O.NORMAL).data,t.invTranspTransformation,r.normal,s,6);{const n=i.vertexAttributes.get(O.UV0).data;let o,a,l,c;if(n==null||n.length<4){const m=this.material.parameters;o=0,a=0,l=m.texCoordScale[0],c=m.texCoordScale[1]}else o=n[0],a=n[1],l=n[2],c=n[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);const h=i.indices.get(O.POSITION).length,p=r.uv0;let f=s;for(let m=0;m<h;++m)p.set(f,0,o),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,a),f+=1}U4(i.indices.get(O.COLOR),i.vertexAttributes.get(O.COLOR).data,4,r.color,s,6);{const n=i.indices.get(O.SIZE),o=i.vertexAttributes.get(O.SIZE).data,a=n.length,l=r.size;let c=s;for(let h=0;h<a;++h){const p=o[2*n[h]],f=o[2*n[h]+1];for(let m=0;m<6;++m)l.set(c,0,p),l.set(c,1,f),c+=1}}i.indices.get(O.AUXPOS1)&&i.vertexAttributes.get(O.AUXPOS1)&&TE(i.indices.get(O.AUXPOS1),i.vertexAttributes.get(O.AUXPOS1).data,r.auxpos1,s,6),i.indices.get(O.AUXPOS2)&&i.vertexAttributes.get(O.AUXPOS2)&&TE(i.indices.get(O.AUXPOS2),i.vertexAttributes.get(O.AUXPOS2).data,r.auxpos2,s,6)}}const Fp=R(),Vx=Ht(),tA=Ht(),qV=R(),Met=Ae(),Oet=Cn(),WV=uo(),Ret=R(),Pet=Nt();class Iet{constructor(){this.aabr=Nt(),this.distance=0,this.culled=!1,this.visible=!1}}class $et{constructor(t,i,r={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info=r}}class Det{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class Let{}class Net{constructor(){this.sortArray=new Gt({allocator:t=>t||new Let})}}var tc;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(tc||(tc={}));class nxe{constructor(){this.camera=new ir,this.slicePlane=P_(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),px(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let US=class extends Se{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new nxe,this._state=tc.Idle,this.graphics=new Det,this.iterators=new Net,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==tc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/tc.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case tc.Idle:this._startUpdate(),e.madeProgress();case tc.Process:if(this._state=tc.Process,!this._processActiveGraphics(e))return;case tc.Sort:if(this._state=tc.Sort,!this._sortVisibleGraphics(e))return;case tc.Deconflict:if(this._state=tc.Deconflict,!this._deconflictVisibleGraphics(e))return;default:KJe(this,this.graphics.visible),this._state=tc.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(M(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof SE}_startUpdate(){eKe(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new Iet,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),Fet(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=vs(Met,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Oet:null;let s=0;for(_(r)&&(ke(r,za,this._runningViewState.camera.viewMatrix),r[3]=bi(this.view.spatialReference).radius,s=jme(r,za));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===lo.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),iKe(n,a)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=Bne(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=Bne(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=ket(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(lo.GRAPHIC,bu.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Lu(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(M(a)){if(a=this._getProjectionInfo(l,t,Vet),a.isOutsideScreen||this._isCulledBySlice(e,Fp)||_(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!ji.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}M(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;ke(Fp,a,r.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(O.NORMAL).data,h=l.get(O.AUXPOS1).data;return o.applyShaderOffsetsView(Fp,c,s.transformation,h,r,i.scaleInfo,Fp),Ji(Vx,Fp[0],Fp[1],Fp[2],1),xu(tA,Vx,r.projectionMatrix),ce(i.positionNDC,tA,1/tA[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,qV),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(qV[2]),i.distance=qV[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Ji(tA,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),xu(Vx,tA,t),IP(Vx,Vx,1/Vx[3]),ne(i.positionView,Fp[0],Fp[1],Fp[2]),i}_isCulledByHorizon(e,t,i){return le(WV.direction,e.positionView),ne(WV.origin,0,0,0),!!R_(t,WV,Ret)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&GX(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(Uet);Ewe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=OF(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,Pet),qt(0,n.fullWidth,.5+.5*r[0]),qt(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(vu(a),Sp(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}rw(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this.accBinsSizeX);r<=Math.floor(i.aabr[2]/this.accBinsSizeX);r++)if(!(r<0||r>=this.accBinsNumX))for(let s=Math.floor(i.aabr[1]/this.accBinsSizeY);s<=Math.floor(i.aabr[3]/this.accBinsSizeY);s++){if(s<0||s>=this.accBinsNumY)continue;const n=this.accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,kP(l.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let i=0;i<this.accBinsNumX;i++){this.accBins.push([]);const r=this.accBins[this.accBins.length-1];for(let s=0;s<this.accBinsNumY;s++)r.push(new Gt)}}else for(let i=0;i<this.accBinsNumX;i++)for(let r=0;r<this.accBinsNumY;r++)this.accBins[i][r].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this.accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this.accBinsNumY||this.accBins[o][a].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(bu.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===lo.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function Fet(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(bu.DECONFLICTION,t)}function*Bne(e){if(Map.prototype.entries){const t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*ket(e,t,i){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.prio=s.info?-s.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([d({constructOnly:!0})],US.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],US.prototype,"updating",null),US=u([P("esri.views.3d.layers.graphics.Deconflictor")],US);const Uet=st();class zet{constructor(){this.positionView=R(),this.positionNDC=R(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const Vet=new zet,Bet=2e3;let xN=class extends US{constructor(){super(...arguments),this.visibilityGroup=lo.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===Nn.IDLE||t-this._lastDeconfliction>Bet)&&(super.runTask(e),this.state===tc.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};u([d({constructOnly:!0})],xN.prototype,"parent",void 0),xN=u([P("esri.views.3d.layers.graphics.LabelDeconflictor")],xN);let kH=class extends US{constructor(){super(...arguments),this._handles=new jt,this._contexts=new Map,this._viewState=new nxe,this.visibilityGroup=lo.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([se(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),se(()=>{var e,t,i;return(i=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:i.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),se(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},At)]),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.GRAPHICS_DECONFLICTOR,this),this._labels=new xN({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&XV(e));t.setVisibilityFlag(bu.DECONFLICTION,i,lo.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;_(e)&&nge(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=_(e)}_slicePlaneChanged(){on(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new $et(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),XV(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=XV(e);i||Get(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function XV(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function Get(e){const t=e.graphics3DGraphics;t&&t.forEach(i=>i.clearVisibilityFlag(bu.DECONFLICTION))}kH=u([P("esri.views.3d.layers.graphics.GraphicsDeconflictor")],kH);const EQ=(e,t,i)=>[t,i],EE=(e,t,i)=>[t,i,e[2]],CQ=(e,t,i)=>[t,i,e[2],e[3]];function DSt(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:_(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function jet({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function Het({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function oxe({scale:e,translate:t},i){return i*e[0]+t[0]}function axe({scale:e,translate:t},i){return t[1]-i*e[1]}function lxe(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=oxe(e,i[0][0]),a=axe(e,i[0][1]);r[0]=t(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=t(c,o,a)}return r}function cxe(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=lxe(e,t,i[s]);return r}function qet(e,t,i,r){return lxe(e,i?r?CQ:EE:r?EE:EQ,t)}function Wet(e,t,i,r){return cxe(e,i?r?CQ:EE:r?EE:EQ,t)}function Xet(e,t,i,r){return cxe(e,i?r?CQ:EE:r?EE:EQ,t)}function LSt(e,t,i,r,s){return t.x=jet(e,i.x),t.y=Het(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function uxe(e,t,i,r,s){return _(i)&&(t.points=qet(e,i.points,r,s)),t}function hxe(e,t,i,r,s){return M(i)||(t.x=oxe(e,i.x),t.y=axe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m))),t}function dxe(e,t,i,r,s){return _(i)&&(t.rings=Xet(e,i.rings,r,s)),t}function pxe(e,t,i,r,s){return _(i)&&(t.paths=Wet(e,i.paths,r,s)),t}function fxe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],s=t[i];if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==s[n])return!1}return!0}function mxe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!fxe(e[i],t[i]))return!1;return!0}function Yet(e,t){return!!m3(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function Zet(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!m3(e.spatialReference,t.spatialReference)&&mxe(e.paths,t.paths)}function Qet(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!m3(e.spatialReference,t.spatialReference)&&mxe(e.rings,t.rings)}function Jet(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!m3(e.spatialReference,t.spatialReference)&&fxe(e.points,t.points)}function Ket(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!m3(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}function m3(e,t){return e===t||e&&t&&e.equals(t)}function ett(e,t){if(e===t)return!0;if(M(e)||M(t)||e.type!==t.type)return!1;switch(e.type){case"point":return Yet(e,t);case"extent":return Ket(e,t);case"polyline":return Zet(e,t);case"polygon":return Qet(e,t);case"multipoint":return Jet(e,t);case"mesh":return!1;default:return}}function ttt(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i)if(e[s]!==t[s])return!1;return!0}function NSt(e,t){return e===t||e!=null&&t!=null&&e.objectId===t.objectId&&!!ett(e.geometry,t.geometry)&&!!ttt(e.attributes,t.attributes)}class FSt{constructor(t,i,r){this.uid=t,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function kSt(e){return _(e.geometry)}class USt{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function zSt(e){const t=zde.fromJSON(e.geometryType),i=Ze.fromJSON(e.spatialReference),r=e.transform,s=e.features.map(n=>{const o=itt(n,t,i,e.objectIdFieldName),a=o.geometry;if(_(a)&&r)switch(a.type){case"point":o.geometry=hxe(r,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=uxe(r,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=dxe(r,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=pxe(r,a,a,a.hasZ,a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map(n=>YP.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function itt(e,t,i,r){return{uid:Tl(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:rtt(e.geometry,t,i),visible:!0}}function rtt(e,t,i){if(M(e))return null;switch(t){case"point":{const r=e;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=e;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=e;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=e;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function Dy(e,t,i,r){return{x:e,y:t,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function stt(e){if(M(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)i+=n.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=X3(e.vertexAttributes.position),t+=X3(e.vertexAttributes.normal),t+=X3(e.vertexAttributes.uv),t+=X3(e.vertexAttributes.tangent)}return t}function VSt(e){let t=32;return t+=bme(e.attributes),t+=3,t+=8+stt(e.geometry),t}function ntt(e){if(M(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function BSt(e){if(M(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function GSt(e,t){switch(mr(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)jz(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)jz(t,e.rings[i],e.hasZ);break;case"multipoint":jz(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function ott(e,t){switch(Lu(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Gz(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Gz(t,e.rings[i]);break;case"multipoint":Gz(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function jSt(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}Hs();Nt();function gxe(e){return"declaredClass"in e}function Gne(e){return"declaredClass"in e}function att(e){return"declaredClass"in e}function ltt(e,t){if(!e)return null;if(att(e))return e;const i=new Ga({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=ie(e.symbol),i.attributes=ie(e.attributes),i.geometry=yxe(e.geometry),i}function yxe(e){return M(e)?null:gxe(e)?e:sm(ctt(e))}function ctt(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:jne(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:jne(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:_xe(i)?vxe(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}function jne(e){return utt(e)?e.map(t=>vxe(t)):e}function vxe(e){return e.map(t=>VCe(t))}function utt(e){for(const t of e)if(t.length!==0)return _xe(t);return!1}function _xe(e){return e.length&&(the(e[0])||ihe(e[0]))}function htt(e,t){if(!e)return null;let i;if(Gne(e)){if(t==null)return e.clone();if(Gne(t))return t.copy(e)}return t!=null?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Dy(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}const YV=ge.getLogger("esri.layers.support.labelFormatUtils"),Hne={type:"simple",evaluate:()=>null},dtt={getAttribute:(e,t)=>e.field(t)};async function bxe(e,t,i){if(!e||!e.symbol)return Hne;const r=e.where,s=Fk(e),n=r?await import("./WhereClause.c045f23c.js"):null;let o;if(s.type==="arcade"){const a=await hRe(s.expression,i,t);o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{YV.error(new q("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>eZ(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":wxe(p,h)})};if(r){let a;try{a=n.WhereClause.create(r,t)}catch(c){return YV.error(new q("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),Hne}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:dtt;try{if(a.testFeature(c,h))return l(c)}catch(p){YV.error(new q("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function wxe(e,t){if(e==null)return"";const i=t.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=e;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+e,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=e;return t.type==="date"||t.type==="esriFieldTypeDate"?r=Ls(r,U5("short-date")):k5(t)&&(r=om(+r)),r||""}var HSt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createLabelFunction:bxe,formatField:wxe});function AQ(e,t){if(e.type==="point")return Qy(e,t,!1);if(gxe(e))switch(e.type){case"extent":return Qy(e.center,t,!1);case"polygon":return Qy(e.centroid,t,!1);case"polyline":return Qy(qne(e),t,!0);case"mesh":return Qy(e.origin,t,!1)}else switch(e.type){case"extent":return Qy(ptt(e),t,!0);case"polygon":return Qy(ftt(e),t,!0);case"polyline":return Qy(qne(e),t,!0)}}function qne(e){const t=e.paths[0];if(!t||t.length===0)return null;const i=Ede(t,Sde(t)/2);return Dy(i[0],i[1],i[2],e.spatialReference)}function ptt(e){const t=isFinite(e.zmin);return Dy(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function ftt(e){const t=e.rings[0];if(!t||t.length===0)return null;const i=Cde(e.rings,e.hasZ);return Dy(i[0],i[1],i[2],e.spatialReference)}function Qy(e,t,i){const r=i?e:htt(e);return t&&e?q$e(e,r,t)?r:null:r}function qSt(e,t,i,r=0){if(e){t||(t=Nt());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Ji(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function xxe(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(O.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function $O(e,t){const i=ok(Fh);return _(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),_(t)?i[3]=t:_(e)&&e.length>3&&(i[3]=e[3]),i}function WSt(e,t,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)_(e)&&e[o]!=null?n[o]=e[o]:_(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return _(t)?n[3]=t:_(r)?n[3]=r:n[3]=s[3],n}function Wne(e=Gf,t,i,r=1){const s=new Array(3);if(M(t)||M(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=i[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return pl(s)}function mtt(e){return e.isPrimitive!=null}function mU(e){return mtt(e)&&(e=[e.width,e.depth,e.height]),j4(e)?null:"Symbol sizes may not be negative values"}function j4(e){if(Array.isArray(e)){for(const t of e)if(!j4(t))return!1;return!0}return e==null||e>=0}function gtt(e,t,i,r=Ae()){const s=e||0,n=t||0,o=i||0;return s!==0&&B2(r,r,-s/180*Math.PI),n!==0&&V2(r,r,n/180*Math.PI),o!==0&&tk(r,r,o/180*Math.PI),r}function MQ(e,t){return t.minDemResolution!=null?t.minDemResolution:H5(e)?t.minDemResolutionForPoints:.01*TPe(e)}function Txe(e,t,i,r,s,n,o,a,l,c,h){const p=Stt[h.mode];let f,m,y=0;if(pr(e,t,i,r,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),pr(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function vy(e,t,i,r,s){const n=(L4(e)?e.z:twe(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const o=ft(qf(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=ft(qf(t,e,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=ft(qf(t,e,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=ft(qf(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return i.mode,void(s.z=0)}}function ytt(e,t,i,r){return vy(e,t,i,r,zS),zS.z}function g3(e,t,i){return t==null||i==null?e.definedChanged:t==="on-the-ground"&&i==="on-the-ground"?e.staysOnTheGround:t===i||t!=="on-the-ground"&&i!=="on-the-ground"?Zr.UPDATE:e.onTheGroundChanged}function id(e){return e==="relative-to-ground"||e==="relative-to-scene"}function w_(e){return e!=="absolute-height"}function vtt(e,t,i,r,s){vy(t,i,s,r,zS),xxe(e,zS.verticalDistanceToGround);const n=zS.sampledElevation,o=Ts(Ett,e.transformation);return A$[0]=t.x,A$[1]=t.y,A$[2]=zS.z,ku(t.spatialReference,A$,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function _tt(e,t,i,r,s,n){let o=0;const a=n.spatialReference;t*=3,r*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],f=ft(n.getElevation(c,h,p,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,t+=3,r+=3}return o/s}function btt(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],v=e[t+2],w=ft(n.getElevation(m,y,v,p,"ground"),0);l+=w,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?v+w+c:w+c,t+=3,r+=3}return l/s}function wtt(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],v=e[t+2],w=ft(n.getElevation(m,y,v,p,"scene"),0);l+=w,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?v+w+c:w+c,t+=3,r+=3}return l/s}function xtt(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return t!==0||i!=null}function Ttt(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<s;++h){const p=e[t+0],f=e[t+1],m=e[t+2];i[r+0]=p,i[r+1]=f,i[r+2]=c==null?m+l:l,t+=3,r+=3}return 0}class y3{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var Zr;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(Zr||(Zr={}));const Stt={"absolute-height":{applyElevationAlignmentBuffer:Ttt,requiresAlignment:xtt},"on-the-ground":{applyElevationAlignmentBuffer:_tt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:btt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:wtt,requiresAlignment:()=>!0}},Ett=Ae(),zS=new y3,A$=R();function Sxe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const a of n){const{update:l,averageGeometrySampledElevation:c}=Cxe(a,t,i,r);o+=c,l&&s.geometryVertexAttrsUpdated(a)}return o/n.length}function rP(e,t,i,r){const s=e.stageObject,n=t.centerPointInElevationSR;let o=0;s.metadata.usesVerticalDistanceToGround?(vy(n,i,t,r,yl),xxe(s,yl.verticalDistanceToGround),o=yl.sampledElevation):(vy(n,i,t,r,yl),t.mode!=="absolute-height"&&(o=yl.sampledElevation));const a=Ts(Ctt,s.transformation),l=ne(Exe,a[12],a[13],a[14]);ji.TESTS_DISABLE_OPTIMIZATIONS?(gl[0]=n.x,gl[1]=n.y,gl[2]=yl.z,ku(n.spatialReference,gl,a,r.spatialReference)&&(s.transformation=a)):r.setAltitudeOfTransformation(yl.z,a);const c=OQ/r.unitInMeters;return(Math.abs(a[12]-l[0])>=c||Math.abs(a[13]-l[1])>=c||Math.abs(a[14]-l[2])>=c)&&(s.transformation=a),o}const Ctt=Ae();function Att(e,t,i,r){const s=e.graphics3DSymbolLayer.lodRenderer;if(M(s))return 0;const n=t.centerPointInElevationSR;vy(n,i,t,r,yl);const o=t.mode!=="absolute-height"?yl.sampledElevation:0,a=s.instanceData,l=e.instanceIndex,c=Ott;a.getGlobalTransform(l,c);const h=ne(Exe,c[12],c[13],c[14]);ji.TESTS_DISABLE_OPTIMIZATIONS?(gl[0]=n.x,gl[1]=n.y,gl[2]=yl.z,ku(n.spatialReference,gl,c,r.spatialReference)&&a.setGlobalTransform(l,c)):r.setAltitudeOfTransformation(yl.z,c);const p=OQ/r.unitInMeters;return(ji.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&a.setGlobalTransform(l,c),o}function Mtt(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let o=0,a=null,l=0,c=!1;for(const h of n){const p=h.geometry.vertexAttributes.get(O.POSITION);if(p!==a){const{update:f,averageGeometrySampledElevation:m}=Cxe(h,t,i,r);l=m,a=p,c=f}c&&s.geometryVertexAttrsUpdated(h),o+=l}return o/n.length}const OQ=.01,gl=R(),Yu=R(),Bx=R(),Ott=Ae(),Exe=R(),yl=new y3;function Cxe(e,t,i,r){let s=!1;const n=i.spatialReference,o=e.geometry,a=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;Yu[0]=a[12],Yu[1]=a[13],Yu[2]=a[14],o.invalidateBoundingInfo();const c=o.getMutableAttribute(O.POSITION),h=c.data,p=o.vertexAttributes.get(O.MAPPOS).data,f=c.size,m=h.length/f,y=new ewe(p,n);let v=0,w=0;for(let b=0;b<m;b++){if(Bx[0]=h[v],Bx[1]=h[v+1],Bx[2]=h[v+2],vy(y,i,t,r,yl),l&&(w+=yl.sampledElevation),ji.TESTS_DISABLE_OPTIMIZATIONS)h[v]=y.array[y.offset],h[v+1]=y.array[y.offset+1],h[v+2]=yl.z,pr(h,n,v,h,r.spatialReference,v,1),h[v]-=Yu[0],h[v+1]-=Yu[1],h[v+2]-=Yu[2],s=!0;else{gl[0]=h[v]+Yu[0],gl[1]=h[v+1]+Yu[1],gl[2]=h[v+2]+Yu[2],r.setAltitude(gl,yl.z),h[v]=gl[0]-Yu[0],h[v+1]=gl[1]-Yu[1],h[v+2]=gl[2]-Yu[2];const S=OQ/r.unitInMeters;(Math.abs(Bx[0]-h[v])>=S||Math.abs(Bx[1]-h[v+1])>=S||Math.abs(Bx[2]-h[v+2])>=S)&&(s=!0)}v+=f,y.offset+=3}return w/=m,{update:s,averageGeometrySampledElevation:w}}const Rtt=ge.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Ptt(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function XSt(e){const t=e&&e.expression;if(typeof t=="string"){const i=Oxe(t);if(i!=null)return{cachedResult:i}}return null}async function YSt(e,t,i){const r=e&&e.expression;if(typeof r!="string")return null;const s=Oxe(r);if(s!=null)return{cachedResult:s};const n=await nm(),o=n.arcadeUtils,a=o.createSyntaxTree(r);return o.dependsOnView(a)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(a),context:o.createExecContext(null,{sr:t}),modules:n}}}function Axe(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function RQ(e,t){if(e!=null&&!Mxe(e)){if(!t||!e.arcade)return void Rtt.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=yxe(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function Itt(e){if(e!=null){if(Mxe(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof i!="number"&&(e.cachedResult=0,i=0),i}return 0}function ZSt(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||r==="0"||(i=null),i}const $tt={cachedResult:0};function Mxe(e){return e.cachedResult!=null}function Oxe(e){return e==="0"?0:null}class Gu{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=z8e(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:t+r}calculateOffsetRenderUnits(t){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Itt(r)*this._metersPerElevationInfoUnit),i/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=U8e(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=ft(t.offset,0)}updateFeatureExpressionInfoContext(t,i,r){if(M(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&_(i)&&_(r)?(this._featureExpressionInfoContext=Ptt(t),RQ(this._featureExpressionInfoContext,Axe(s.modules,i,r))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const i=new Gu;return _(t)&&i.setFromElevationInfo(t),i}}var $t;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})($t||($t={}));class Pm{constructor(t,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=i}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,i){this._stageLayer=i,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),_(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,i){if(M(this._edgeState))return;const r=Xne(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,i){M(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!i),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),_(this._edgeState))){const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(t,i,r,s){this.elevationAligner!=null&&(_(r)&&RQ(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,i),this._resetEdgeObject(s))}getCenterObjectSpace(t=R()){return le(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=Hs()){const i=this.stageObject.boundingVolumeObjectSpace;return Ipe(t,i.min),$pe(t,i.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;t.render.origin[0]+=i[12],t.render.origin[1]+=i[13],t.render.origin[2]+=i[14],t.render.num++}else for(const i of this.stageObject.geometryRecords)i.computeAttachmentOrigin(zm)&&(ke(zm,zm,this.stageObject.transformation),de(t.render.origin,t.render.origin,zm),t.render.num++)}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Dtt,l=H5(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];Jy[0]=o[p[0]],Jy[1]=o[p[1]],Jy[2]=o[p[2]],ke(Jy,Jy,this.stageObject.transformation),i1[3*h+0]=Jy[0],i1[3*h+1]=Jy[1],i1[3*h+2]=Jy[2]}if(!t(i1,0,l))return null;mr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],i1[h+p]),o[p+3]=Math.max(o[p+3],i1[h+p]);c&&r.push({location:i1.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){op(o,zm);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=ft(i.service.getElevation(zm[0],zm[1],h),0);else try{const f=MQ(o,i);p=ft(await i.service.queryElevation(zm[0],zm[1],s,f,h),0)}catch{}Ppe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,i){t===fy.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),t===fy.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(M(this._edgeState))return;const i=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,t):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,i){const r=this._edgeState;if(M(r))return;const s=Xne(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function Xne(e){return e.isVisible?e.parameters.transparent?$t.TRANSPARENT:$t.OPAQUE:$t.INVISIBLE}const i1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Jy=R(),zm=R(),Dtt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var cn;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(cn||(cn={}));class PQ{constructor(t){this.schedule=t,this._loadStatus=du.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,i){return this._loadStatus===du.LOADED?(t&&t(),this._loader):this._loadStatus===du.FAILED?(i&&i(this._loadError),this._loader):(M(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=du.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=du.FAILED,!Qr(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(t,i).catch(()=>{}),this._loader)}abortLoad(){_(this._abortController)?this._abortController=Xh(this._abortController):this._loadStatus===du.LOADING&&(this._loadStatus=du.FAILED),this._loader=null}}var du;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(du||(du={}));function Ltt(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Rxe(e,t){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&sc.cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>sc.createPolySphereGeometry(.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>sc.createBoxGeometry(1));case"cone":return i(ZV,r=>sc.createConeGeometry(1,.5,r,!1),!0);case"inverted-cone":return i(ZV,r=>sc.createConeGeometry(1,.5,r,!0),!0);case"cylinder":return i(ZV,r=>sc.createCylinderGeometry(1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>sc.createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>sc.createDiamondGeometry(1),!0);default:return}}const ZV=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function Ntt(e){return e.type==="fill"}function Ftt(e){return e.type==="extrude"}function ktt(e){return e&&e.enabled&&(Ftt(e)||Ntt(e))&&_(e.edges)}function Utt(e){return e&&e.enabled&&e.edges||null}function Pxe(e,t){return Ixe(Utt(e),t)}function Ixe(e,t){if(M(e))return null;const i=_(e.color)?DX(We.toUnitRGBA(e.color)):mi(0,0,0,0),r=fo(e.size),s=fo(e.extensionLength);switch(e.type){case"solid":return $xe(F({color:i,size:r,extensionLength:s},t));case"sketch":return ztt(F({color:i,size:r,extensionLength:s},t));default:return}}function $xe(e){return me(F(F({},Vtt),e),{type:"solid"})}function ztt(e){return me(F(F({},Btt),e),{type:"sketch"})}const Vtt={color:mi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:$t.OPAQUE,hasSlicePlane:!1},Btt={color:mi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:$t.OPAQUE,hasSlicePlane:!1};function M$(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.material)})}),AP(t)}function Gtt(e){const t=new Array;return e.levels.forEach(i=>{i.components.forEach(r=>{r.textures&&t.push(...r.textures)})}),AP(t)}function IQ(e){const t=[];return e.components.forEach(i=>{t.push(i.geometry)}),AP(t)}function jtt(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.geometry)})}),AP(t)}function Htt(e){return IQ(e).reduce((t,i)=>t+i.indexCount/3,0)}const $Q={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function QSt(e){return e.type==="web-style"?$Q:DQ(e.symbolLayers.toArray().map(t=>Dxe(e,t)))}function DQ(e){let t=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)M(a)||(t+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function JSt(e){const t=DQ(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Yne={};function Dxe(e,t){const i=Lxe(e,t),r=ktt(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:_(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:me(F({},qtt(t.resource&&t.resource.primitive||rfe)),{memory:i});case"path":{let a=0,l=0;switch(t.profile){case"circle":a=10;break;case"quad":a=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*a,h=a*l*2;let p=-2*h-c;switch(t.cap){case"none":break;case"butt":case"square":p+=2*(a-1);break;case"round":p+=2*(a*(3-1)*2+a);break;default:return}return{primitivesPerFeature:p,primitivesPerCoordinate:h+c,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function Lxe(e,t){const i=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Ya.EXTRUDE_EDGES:Ya.EXTRUDE;case"fill":return _(t.outline)&&t.outline.size>0?Ya.FILL_OUTLINE:Ya.FILL;case"water":return Ya.FILL;case"line":return t.join==="round"?Ya.LINE_ROUND:Ya.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Ya.PATH_ROUND_CIRCLE;case"quad":return Ya.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return Ya.PATH_MITER_CIRCLE;case"quad":return Ya.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return i?Ya.OBJECT_POINT:Ya.OBJECT_POLYGON;case"icon":case"text":return i?Ya.ICON_POINT:Ya.ICON_POLYGON;default:return}}function qtt(e){let t=Yne[e];if(t)return t;const i=Rxe(e,null);return t={primitivesPerFeature:IQ(i.levels[0]).reduce((r,s)=>r+s.indices.get(O.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Yne[e]=t,t}const Ya={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},O$=ge.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class Im extends PQ{constructor(t,i,r,s){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=O$,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=i,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Gu,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Zne(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=Zne(t);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,i,r,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!i.length||i.length===1&&!i[0].length?l=`${a} (no ${r} were defined)`:Array.isArray(i)&&Array.isArray(i[0])?o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (${r} should be defined as a 2D array)`:l=`${a} (failed to project geometry to view spatial reference)`,l&&O$.warnOncePerTick(l)}_validateGeometry(t,i=null,r=null){if(_(i)&&!i.includes(t.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return O$.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Wtt}_defaultElevationInfoZ(){return Xtt}_updateElevationContext(){_(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,i=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,i){const r=t.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=ft(this._elevationContext.meterUnitOffset,ft(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?$tt:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,t,this._context.layer),i}prepareSymbolLayerPatch(t){}updateGeometry(t,i){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,i=Qne){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(_(t)?r*=t.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(t,i=Qne){const r=this._getCombinedOpacity(t,i);if(this._drivenProperties.color)return $O(null,r);const s=_(t)?We.toUnitRGB(t):Gf;return $O(s,r)}_getVertexOpacityAndColor(t,i=null){const r=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=$O(r,s);return _(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return Dxe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,i,r){switch(t){case"opacity":return this.layerOpacityChanged(i,r);case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Zr.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,i,r){let s=Zr.UPDATE;return t.forEach(n=>{const o=i(n);if(_(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Zr.RECREATE}),s}applyRendererDiff(t,i){return cn.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?Jg(i.size.field,t):0,s=i.color?Jg(i.color.field,t):0,n=i.opacity?Jg(i.opacity.field,t):0;return mi(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&O$.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var i,r,s,n,o,a,l,c,h,p,f,m,y,v,w,b;return{size:(n=(s=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(f=(p=(h=this._fastUpdates)==null?void 0:h.visualVariables)==null?void 0:p.opacity)==null?void 0:f.field)!=null?m:null,rotation:(b=(w=(v=(y=this._fastUpdates)==null?void 0:y.visualVariables)==null?void 0:v.rotation)==null?void 0:w.field)!=null?b:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function Jg(e,t){const i=e!=null?t.attributes[e]:0;return i!=null&&isFinite(i)?i:0}function Zne(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(i=>{switch(i.type){case"color":if(t.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const Wtt={mode:"on-the-ground",offset:0,unit:"meters"},Xtt={mode:"absolute-height",offset:0,unit:"meters"},Qne={hasIntrinsicColor:!1};class Ww{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,i,r,s,n,o){this.id=Tl(),this.geometry=t,this.material=i,this.transformation=r,this.instanceParameters=s,this.origin=n,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return _(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(ke(t,t,this.getStaticTransformation()),!0)}}Ww.pool=new Es(Ww);class H4{constructor(t){this.channel=t,this.id=Tl()}}class Ly extends a3{constructor(t={}){super(),this.type=Mp.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Ae(),this._bvObjectSpace=new Jne,this._bvWorldSpace=new Jne,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new Nxe),this.transformation=Ae();const{geometries:i,materials:r,transformations:s,origins:n}=t;if(Array.isArray(i)){pt(r.length===i.length,"Object3D: materials don't match geometries"),pt(s.length===i.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=i.length,this._geometries.length=i.length;for(let o=0;o<i.length;o++)this._geometries[o]=i[o],this._geometryRecords[o]=Ww.pool.acquire(i[o],r[o],lw(s[o]),{highlights:null,occludees:null,visible:this._visible},n&&n[o])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){Ts(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){pt(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,i,r,s,n){r=r||hn,this._geometries.push(t);const o=Ww.pool.acquire(t,i,r,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||_(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const i=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=_(i.shaderTransformation)?this._geometryRecords.some(r=>_(r.shaderTransformation)):this._hasVolatileTransformation,i.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:i}),this._invalidateBoundingVolume(),i}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const i of this._geometryRecords)i.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new H4(fy.MaskOccludee);for(const i of this._geometryRecords)i.instanceParameters.occludees=TH(i.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const i of this._geometryRecords)i.instanceParameters.occludees=SH(i.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new H4(fy.Highlight);for(const i of this._geometryRecords)i.instanceParameters.highlights=TH(i.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const i of this._geometryRecords)i.instanceParameters.highlights=SH(i.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,i){return jr(ft(i,Ae()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,i){return i=i||Ae(),jr(i,this.transformation,t.getShaderTransformation()),i}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],o=this._geometryRecords[s],a=n.boundingInfo;_(a)&&(this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,o.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this._getCombinedShaderTransformation(o)))}dn(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),dn(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=R(),i=R(),r=Rw(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(M(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),a=Rw(o);ke(t,n.getCenter(),o);const l=hr(t,this._bvObjectSpace.bounds),c=n.getBSRadius()*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),ke(i,t,this.transformation);const h=hr(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,i,r){const s=t.getBBMin(),n=t.getBBMax(),o=Bs(s),a=Bs(n);ke(o,o,r),ke(a,a,r);for(let l=0;l<3;++l)i.min[l]=Math.min(i.min[l],o[l],a[l]),i.max[l]=Math.max(i.max[l],o[l],a[l]);for(let l=0;l<3;++l){le(o,s),le(a,n),o[l]=n[l],a[l]=s[l],ke(o,o,r),ke(a,a,r);for(let c=0;c<3;++c)i.min[c]=Math.min(i.min[c],o[c],a[c]),i.max[c]=Math.max(i.max[c],o[c],a[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,_(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,i){_(this._parentLayer)&&this._parentLayer.events.emit(t,i)}get test(){const t=this;return{hasGeometry:i=>t._geometries.includes(i),getGeometryIndex:i=>t._geometries.indexOf(i)}}}class Nxe{constructor(){this.min=Fe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Fe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Jne extends Nxe{constructor(){super(...arguments),this.bounds=Cn()}init(){ne(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ne(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Vme(this.bounds)}}const Uv=R();function LQ(e,t,i,r,s,n,o,a){const l=i?i.length:0,c=e.clippingExtent;if(Gn(t,Uv,e.elevationProvider.spatialReference),_(c)&&!ZW(c,Uv))return null;Gn(t,Uv,e.renderCoordsHelper.spatialReference);const h=e.localOriginFactory.getOrigin(Uv),p=new Ly({castShadow:!1,metadata:{layerUid:n,graphicUid:o,usesVerticalDistanceToGround:!0}});for(let f=0;f<l;f++){const m=hn;p.addGeometry(i[f],r[f],m,h,a)}return{object:p,sampledElevation:vtt(p,t,e.elevationProvider,e.renderCoordsHelper,s)}}function sP(e,t,i){const r=e.elevationContext,s=i.spatialReference;Gn(t,Uv,s),r.centerPointInElevationSR=Dy(Uv[0],Uv[1],t.hasZ?Uv[2]:0,s)}function nP(e){switch(e.type){case"point":return e;case"polygon":case"extent":return AQ(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const i=Ede(t,Sde(t)/2);return Dy(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function Ytt(e){const t=new qi;t.include(HZ),t.include(Pwe,e),t.include(ys,e),t.attributes.add(O.UV0,"vec2");const{vertex:i,fragment:r}=t;return i.uniforms.add([new ri("viewport",(s,n)=>n.camera.fullViewport),new Xe("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new pi("pixelToNDC",(s,n)=>di(eoe,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Xe("borderSize",(s,n)=>_(s.borderColor)?n.camera.pixelRatio:0),new pi("screenOffset",(s,n)=>di(eoe,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&oU(i),i.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?x`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?x`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?x`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?x`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new ri("uColor",s=>Kne(s.color)),new ri("borderColor",s=>Kne(s.borderColor))]),e.hasMultipassGeometry&&(r.include(J1e,e),r.uniforms.add(new pi("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(x`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?x`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function Kne(e){return _(e)?e:Qf}const eoe=st(),Ztt=Object.freeze(Object.defineProperty({__proto__:null,build:Ytt},Symbol.toStringTag,{value:"Module"}));class gU extends fr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global}initializeProgram(t){const i=gU.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}setPipelineState(t){const i=t?yr.ALWAYS:yr.LESS;return this.configuration.depthHudEnabled?Ut({depthTest:{func:i},depthWrite:Il}):Ut({blending:bo(Me.ONE,Me.SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:ti})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}gU.shader=new sr(Ztt,()=>import("./LineCallout.glsl.8f7b622e.js"));class mh extends la{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=_l.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([j({count:_l.COUNT})],mh.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j()],mh.prototype,"spherical",void 0),u([j()],mh.prototype,"occlusionTestEnabled",void 0),u([j()],mh.prototype,"hasVerticalOffset",void 0),u([j()],mh.prototype,"hasScreenSizePerspective",void 0),u([j()],mh.prototype,"depthHudEnabled",void 0),u([j()],mh.prototype,"depthHudAlignStartEnabled",void 0),u([j()],mh.prototype,"hasSlicePlane",void 0),u([j()],mh.prototype,"hasMultipassGeometry",void 0),u([j({constValue:!0})],mh.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],mh.prototype,"isDraped",void 0);class Yb extends Rm{constructor(t){super(t,new Jtt),this.techniqueConfig=new mh,this._uniqueMaterialIdentifier=Yb.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,i){const r=(i==null?void 0:i.slot)!==Ee.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?_l.Screen:_l.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!i&&i.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case Ee.LINE_CALLOUTS:case Ee.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===K.Color?new Qtt(t):null}createBufferWriter(){return new eit}validateParameters(t){const i=Yb.uniqueMaterialIdentifier(t);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class Qtt extends I_{beginSlot(t){return this.ensureTechnique(gU,t)}}class Jtt extends mC{constructor(){super(...arguments),this.screenOffset=Zh,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Ktt=ls().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.AUXPOS1),toe=[Na(0,0),Na(1,0),Na(0,1),Na(1,0),Na(1,1),Na(0,1)];class eit{constructor(){this.vertexBufferLayout=Ktt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(O.POSITION).length}write(t,i,r,s){lU(i.indices.get(O.POSITION),i.vertexAttributes.get(O.POSITION).data,t.transformation,r.position,s,6),bQ(i.indices.get(O.NORMAL),i.vertexAttributes.get(O.NORMAL).data,t.invTranspTransformation,r.normal,s,6),TE(i.indices.get(O.AUXPOS1),i.vertexAttributes.get(O.AUXPOS1).data,r.auxpos1,s,6);for(let n=0;n<toe.length;++n)r.uv0.setVec(s+n,toe[n])}}class yU extends Im{constructor(t,i){super(t,null,i,rit),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new Yb(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const i=this.materialParameters;return i.screenOffset=t.screenOffset||Zh,i.centerOffsetUnits=t.centerOffsetUnits||"world",i}get materialParameters(){const t=this.symbol,i=t.callout,r=_(i.color)?We.toUnitRGBA(i.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const s=fo(i.size||0);let n=null;if(t.verticalOffset){const{screenLength:p,minWorldLength:f,maxWorldLength:m}=t.verticalOffset;n={screenLength:fo(p),minWorldLength:f||0,maxWorldLength:m!=null?m:1/0}}const o=_(i.border)&&_(i.border.color)?We.toUnitRGBA(i.border.color):null,a=t.symbolLayers.getItemAt(0).type==="object",l=!a,c=a?0:void 0,h=t.type==="label-3d";return{color:r,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:o,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:h,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:Fr.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return iit}createGraphics3DGraphic(t){const i=t.renderingInfo,r=t.graphic,s=this.setGraphicElevationContext(r,new Gu,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!cfe(l)))return null;const a=AQ(r.geometry);return M(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){return M(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=g3(yU.elevationModeChangeTypes,r,s);return n!==Zr.UPDATE||t.forEach(o=>{const a=i(o);_(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return M(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=id(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:$Q.memory}}_createVertexData(t){const{translation:i,centerOffset:r}=t,s=i?{size:3,data:[i[0],i[1],i[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[O.POSITION,s],[O.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[O.AUXPOS1,n]]}_getOrCreateMaterial(t){const i=this._perInstanceMaterialParameters(t),r=Yb.uniqueMaterialIdentifier(i);if(_(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(r);return M(s)&&(s=new Yb(i),t.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new Yb(i),isUnique:!0}}_createAs3DShape(t,i,r,s){const n=[new kr(this._createVertexData(r),tit,Al.Point)],o=this._getOrCreateMaterial(r),a=LQ(this._context,t,n,[o.material],i,this._context.layer.uid,s);if(a===null)return null;const l=new Pm(this,a.object,n,o.isUnique?[o.material]:null,null,rP,i);return l.metadata={elevationOffset:r.elevationOffset||0},l.alignedSampledElevation=a.sampledElevation,l.needsElevationUpdates=id(i.mode),sP(l,t,this._context.elevationProvider),l}}yU.elevationModeChangeTypes={definedChanged:Zr.UPDATE,staysOnTheGround:Zr.UPDATE,onTheGroundChanged:Zr.RECREATE};const QV=new Uint16Array([0]),tit=[[O.POSITION,QV],[O.NORMAL,QV],[O.AUXPOS1,QV]],iit={mode:"relative-to-ground",offset:0},rit={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},ioe=ge.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function sit(e,t){if(!gX(e))return ioe.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=nit[e.callout.type];return i?new i(e,t):(ioe.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const nit={line:yU};class oit{constructor(t,i,r){this.graphic=t,this.renderingInfo=i,this.layer=r}}const roe=new Es(Array,e=>j5(e,Dpe),null,10,5),ait=Nt();class lit{constructor(t,i,r,s,n){this.graphic=t,this.graphics3DSymbol=i,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=cit(lo._COUNT,bu._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?Axe(n,t,s):null;for(const o of r)_(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,i){this._layer=i,this._stage=t,this._forEachSymbolLayerGraphic(r=>{r.initialize(t,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,i,r){this._labelGraphics.push(t),t.initialize(i,r),t.setVisibility(this.isVisible(lo.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(t=!0)}),t}isVisible(t=lo.GRAPHIC,i){for(let r=0;r<=t;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(t,i){return this._visibilityFlags[i][t]!=null}setVisibilityFlag(t,i,r){const s=this.isVisible(r);this._visibilityFlags[r][t]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===lo.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(lo.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,i=lo.GRAPHIC){return this.setVisibilityFlag(t,void 0,i)}computeExtent(t){if(!this._extent){const i=this.graphic.geometry;if(M(i))return!1;this._extent=Nt(),ott(i,this._extent);const r=i.spatialReference;if(!r.equals(t)&&!sk(this._extent,r,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,i){return _(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,i),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,i,r){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=$u.fromExtent(s.type==="mesh"?s.extent:s)),LUe(s,i,r)}get usedMemory(){let t=bme(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(M(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=ntt(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:R(),num:0},draped:{origin:st(),num:0}};for(const i of this.graphics)M(i)||i.computeAttachmentOrigin(t);return t.render.num&&ce(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&dc(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?mr(n.boundingBox):n.boundingBox=mr(),n.requiresDrapedElevation=!1,await _k(this.graphics,async o=>{if(M(o))return;const a=o.type==="draped"?i:t,l=roe.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&F2(n.boundingBox,l),roe.release(l)}),xPe(n.boundingBox)||z9(QW(n.boundingBox,ait))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(_(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,i,this._featureExpressionFeature,r)})}addObjectStateSet(t,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(t,i))}removeObjectState(t){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(t))}_forEachGraphicList(t,i){t.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function cit(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var soe,noe,ooe,Fxe={exports:{}};soe=Fxe,noe=function(){function e($,k,B){B=B||2;var H,Y,ee,G,te,fe,xe,Le=k&&k.length,_e=Le?k[0]*B:$.length,ye=t($,0,_e,B,!0),Ce=[];if(!ye||ye.next===ye.prev)return Ce;if(Le&&(ye=l($,k,ye,B)),$.length>80*B){H=ee=$[0],Y=G=$[1];for(var Pe=B;Pe<_e;Pe+=B)(te=$[Pe])<H&&(H=te),(fe=$[Pe+1])<Y&&(Y=fe),te>ee&&(ee=te),fe>G&&(G=fe);xe=(xe=Math.max(ee-H,G-Y))!==0?1/xe:0}return r(ye,Ce,B,H,Y,xe),Ce}function t($,k,B,H,Y){var ee,G;if(Y===re($,k,B,H)>0)for(ee=k;ee<B;ee+=H)G=X(ee,$[ee],$[ee+1],G);else for(ee=B-H;ee>=k;ee-=H)G=X(ee,$[ee],$[ee+1],G);if(G&&C(G,G.next)){var te=G.next;Z(G),G=te}return G}function i($,k){if(!$)return $;k||(k=$);var B,H=$;do if(B=!1,H.steiner||!C(H,H.next)&&E(H.prev,H,H.next)!==0)H=H.next;else{var Y=H.prev;if(Z(H),(H=k=Y)===H.next)break;B=!0}while(B||H!==k);return k}function r($,k,B,H,Y,ee,G){if($){!G&&ee&&y($,H,Y,ee);for(var te,fe,xe=$;$.prev!==$.next;)if(te=$.prev,fe=$.next,ee?n($,H,Y,ee):s($))k.push(te.i/B),k.push($.i/B),k.push(fe.i/B),Z($),$=fe.next,xe=fe.next;else if(($=fe)===xe){G?G===1?r($=o(i($),k,B),k,B,H,Y,ee,2):G===2&&a($,k,B,H,Y,ee):r(i($),k,B,H,Y,ee,1);break}}}function s($){var k=$.prev,B=$,H=$.next;if(E(k,B,H)>=0)return!1;for(var Y=$.next.next;Y!==$.prev;){if(S(k.x,k.y,B.x,B.y,H.x,H.y,Y.x,Y.y)&&E(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function n($,k,B,H){var Y=$.prev,ee=$,G=$.next;if(E(Y,ee,G)>=0)return!1;for(var te=Y.x<ee.x?Y.x<G.x?Y.x:G.x:ee.x<G.x?ee.x:G.x,fe=Y.y<ee.y?Y.y<G.y?Y.y:G.y:ee.y<G.y?ee.y:G.y,xe=Y.x>ee.x?Y.x>G.x?Y.x:G.x:ee.x>G.x?ee.x:G.x,Le=Y.y>ee.y?Y.y>G.y?Y.y:G.y:ee.y>G.y?ee.y:G.y,_e=w(te,fe,k,B,H),ye=w(xe,Le,k,B,H),Ce=$.prevZ,Pe=$.nextZ;Ce&&Ce.z>=_e&&Pe&&Pe.z<=ye;){if(Ce!==$.prev&&Ce!==$.next&&S(Y.x,Y.y,ee.x,ee.y,G.x,G.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0||(Ce=Ce.prevZ,Pe!==$.prev&&Pe!==$.next&&S(Y.x,Y.y,ee.x,ee.y,G.x,G.y,Pe.x,Pe.y)&&E(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;Ce&&Ce.z>=_e;){if(Ce!==$.prev&&Ce!==$.next&&S(Y.x,Y.y,ee.x,ee.y,G.x,G.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.prevZ}for(;Pe&&Pe.z<=ye;){if(Pe!==$.prev&&Pe!==$.next&&S(Y.x,Y.y,ee.x,ee.y,G.x,G.y,Pe.x,Pe.y)&&E(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function o($,k,B){var H=$;do{var Y=H.prev,ee=H.next.next;!C(Y,ee)&&A(Y,H,H.next,ee)&&U(Y,ee)&&U(ee,Y)&&(k.push(Y.i/B),k.push(H.i/B),k.push(ee.i/B),Z(H),Z(H.next),H=$=ee),H=H.next}while(H!==$);return i(H)}function a($,k,B,H,Y,ee){var G=$;do{for(var te=G.next.next;te!==G.prev;){if(G.i!==te.i&&T(G,te)){var fe=V(G,te);return G=i(G,G.next),fe=i(fe,fe.next),r(G,k,B,H,Y,ee),void r(fe,k,B,H,Y,ee)}te=te.next}G=G.next}while(G!==$)}function l($,k,B,H){var Y,ee,G,te=[];for(Y=0,ee=k.length;Y<ee;Y++)(G=t($,k[Y]*H,Y<ee-1?k[Y+1]*H:$.length,H,!1))===G.next&&(G.steiner=!0),te.push(b(G));for(te.sort(c),Y=0;Y<te.length;Y++)B=i(B=p(te[Y],B),B.next);return B}function c($,k){return $.x-k.x}function h($){if($.next.prev===$)return $;let k=$;for(;;){const B=k.next;if(B.prev===k||B===k||B===$)break;k=B}return k}function p($,k){var B=f($,k);if(!B)return k;var H=V(B,$),Y=i(B,B.next);let ee=h(H);return i(ee,ee.next),Y=h(Y),h(k===B?Y:k)}function f($,k){var B,H=k,Y=$.x,ee=$.y,G=-1/0;do{if(ee<=H.y&&ee>=H.next.y&&H.next.y!==H.y){var te=H.x+(ee-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(te<=Y&&te>G){if(G=te,te===Y){if(ee===H.y)return H;if(ee===H.next.y)return H.next}B=H.x<H.next.x?H:H.next}}H=H.next}while(H!==k);if(!B)return null;if(Y===G)return B;var fe,xe=B,Le=B.x,_e=B.y,ye=1/0;H=B;do Y>=H.x&&H.x>=Le&&Y!==H.x&&S(ee<_e?Y:G,ee,Le,_e,ee<_e?G:Y,ee,H.x,H.y)&&(fe=Math.abs(ee-H.y)/(Y-H.x),U(H,$)&&(fe<ye||fe===ye&&(H.x>B.x||H.x===B.x&&m(B,H)))&&(B=H,ye=fe)),H=H.next;while(H!==xe);return B}function m($,k){return E($.prev,$,k.prev)<0&&E(k.next,$,$.next)<0}function y($,k,B,H){var Y=$;do Y.z===null&&(Y.z=w(Y.x,Y.y,k,B,H)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==$);Y.prevZ.nextZ=null,Y.prevZ=null,v(Y)}function v($){var k,B,H,Y,ee,G,te,fe,xe=1;do{for(B=$,$=null,ee=null,G=0;B;){for(G++,H=B,te=0,k=0;k<xe&&(te++,H=H.nextZ);k++);for(fe=xe;te>0||fe>0&&H;)te!==0&&(fe===0||!H||B.z<=H.z)?(Y=B,B=B.nextZ,te--):(Y=H,H=H.nextZ,fe--),ee?ee.nextZ=Y:$=Y,Y.prevZ=ee,ee=Y;B=H}ee.nextZ=null,xe*=2}while(G>1);return $}function w($,k,B,H,Y){return($=1431655765&(($=858993459&(($=252645135&(($=16711935&(($=32767*($-B)*Y)|$<<8))|$<<4))|$<<2))|$<<1))|(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k=32767*(k-H)*Y)|k<<8))|k<<4))|k<<2))|k<<1))<<1}function b($){var k=$,B=$;do(k.x<B.x||k.x===B.x&&k.y<B.y)&&(B=k),k=k.next;while(k!==$);return B}function S($,k,B,H,Y,ee,G,te){return(Y-G)*(k-te)-($-G)*(ee-te)>=0&&($-G)*(H-te)-(B-G)*(k-te)>=0&&(B-G)*(ee-te)-(Y-G)*(H-te)>=0}function T($,k){return $.next.i!==k.i&&$.prev.i!==k.i&&!D($,k)&&(U($,k)&&U(k,$)&&z($,k)&&(E($.prev,$,k.prev)||E($,k.prev,k))||C($,k)&&E($.prev,$,$.next)>0&&E(k.prev,k,k.next)>0)}function E($,k,B){return(k.y-$.y)*(B.x-k.x)-(k.x-$.x)*(B.y-k.y)}function C($,k){return $.x===k.x&&$.y===k.y}function A($,k,B,H){var Y=L(E($,k,B)),ee=L(E($,k,H)),G=L(E(B,H,$)),te=L(E(B,H,k));return Y!==ee&&G!==te||!(Y!==0||!I($,B,k))||!(ee!==0||!I($,H,k))||!(G!==0||!I(B,$,H))||!(te!==0||!I(B,k,H))}function I($,k,B){return k.x<=Math.max($.x,B.x)&&k.x>=Math.min($.x,B.x)&&k.y<=Math.max($.y,B.y)&&k.y>=Math.min($.y,B.y)}function L($){return $>0?1:$<0?-1:0}function D($,k){var B=$;do{if(B.i!==$.i&&B.next.i!==$.i&&B.i!==k.i&&B.next.i!==k.i&&A(B,B.next,$,k))return!0;B=B.next}while(B!==$);return!1}function U($,k){return E($.prev,$,$.next)<0?E($,k,$.next)>=0&&E($,$.prev,k)>=0:E($,k,$.prev)<0||E($,$.next,k)<0}function z($,k){var B=$,H=!1,Y=($.x+k.x)/2,ee=($.y+k.y)/2;do B.y>ee!=B.next.y>ee&&B.next.y!==B.y&&Y<(B.next.x-B.x)*(ee-B.y)/(B.next.y-B.y)+B.x&&(H=!H),B=B.next;while(B!==$);return H}function V($,k){var B=new ae($.i,$.x,$.y),H=new ae(k.i,k.x,k.y),Y=$.next,ee=k.prev;return $.next=k,k.prev=$,B.next=Y,Y.prev=B,H.next=B,B.prev=H,ee.next=H,H.prev=ee,H}function X($,k,B,H){var Y=new ae($,k,B);return H?(Y.next=H.next,Y.prev=H,H.next.prev=Y,H.next=Y):(Y.prev=Y,Y.next=Y),Y}function Z($){$.next.prev=$.prev,$.prev.next=$.next,$.prevZ&&($.prevZ.nextZ=$.nextZ),$.nextZ&&($.nextZ.prevZ=$.prevZ)}function ae($,k,B){this.i=$,this.x=k,this.y=B,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function re($,k,B,H){for(var Y=0,ee=k,G=B-H;ee<B;ee+=H)Y+=($[G]-$[ee])*($[ee+1]+$[G+1]),G=ee;return Y}return e.deviation=function($,k,B,H){var Y=k&&k.length,ee=Y?k[0]*B:$.length,G=Math.abs(re($,0,ee,B));if(Y)for(var te=0,fe=k.length;te<fe;te++){var xe=k[te]*B,Le=te<fe-1?k[te+1]*B:$.length;G-=Math.abs(re($,xe,Le,B))}var _e=0;for(te=0;te<H.length;te+=3){var ye=H[te]*B,Ce=H[te+1]*B,Pe=H[te+2]*B;_e+=Math.abs(($[ye]-$[Pe])*($[Ce+1]-$[ye+1])-($[ye]-$[Ce])*($[Pe+1]-$[ye+1]))}return G===0&&_e===0?0:Math.abs((_e-G)/G)},e.flatten=function($){for(var k=$[0][0].length,B={vertices:[],holes:[],dimensions:k},H=0,Y=0;Y<$.length;Y++){for(var ee=0;ee<$[Y].length;ee++)for(var G=0;G<k;G++)B.vertices.push($[Y][ee][G]);Y>0&&(H+=$[Y-1].length,B.holes.push(H))}return B},e},(ooe=noe())!==void 0&&(soe.exports=ooe);const CE=Fxe.exports,vU=ge.getLogger("esri.views.3d.support.buffer.math");function v3(e,t,i){if(e.count!==t.count)return void vU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],f=i[10],m=i[12],y=i[13],v=i[14],w=e.typedBuffer,b=e.typedBufferStride,S=t.typedBuffer,T=t.typedBufferStride;for(let E=0;E<r;E++){const C=E*b,A=E*T,I=S[A],L=S[A+1],D=S[A+2];w[C]=s*I+a*L+h*D+m,w[C+1]=n*I+l*L+p*D+y,w[C+2]=o*I+c*L+f*D+v}}function x_(e,t,i){if(e.count!==t.count)return void vU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,w=t.typedBufferStride;for(let b=0;b<r;b++){const S=b*y,T=b*w,E=v[T],C=v[T+1],A=v[T+2];m[S]=s*E+a*C+h*A,m[S+1]=n*E+l*C+p*A,m[S+2]=o*E+c*C+f*A}}function UH(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function NQ(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function uit(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:v3,transformMat3:x_,scale:UH,normalize:NQ,shiftRight:uit},Symbol.toStringTag,{value:"Module"}));function _U(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&_(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function hit(e,t){if(_(e.symbol))return e.symbol;const i=_U(e,t);return _(i)&&i.type!=="dot-density"?i.getSymbol(e,t):null}function KSt(e,t){const i=_U(e,t),r=hit(e,t);if(M(r))return null;const s={renderer:i,symbol:r};if(M(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=UY(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function dit(e,t){if(_(e.symbol))return e.symbol;const i=_U(e,t);return _(i)&&i.getSymbolAsync(e,t)}async function e2t(e,t){const i=_U(e,t),r=await dit(e,t);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=UY(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=We.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function pit(e,t=0){const i=e[t];return typeof i=="number"&&isFinite(i)?i:null}function fit(e){for(let t=0;t<3;t++){const i=e[t];if(typeof i=="number")return isFinite(i)?i:0}return 0}function kxe(e,t,i){var C;const r=e.byteLength/(4*t),s=new Uint32Array(e,0,r*t);let n=new Uint32Array(r);const o=(C=i==null?void 0:i.minReduction)!=null?C:0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const I=c[A+1]-c[A];I>h&&(h=I)}else h=r;const p=Math.floor(1.1*h)+1;(kp==null||kp.length<2*p)&&(kp=new Uint32Array(C2(2*p)));for(let A=0;A<2*p;A++)kp[A]=0;let f=0;const m=!!c&&!!a,y=m?l:r,v=m?new Uint32Array(l):null,w=1.96;let b=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,S=1,T=c?c[1]:y;for(let A=0;A<y;A++){if(A===b){const V=1-f/A;if(V+w*Math.sqrt(V*(1-V)/A)<o)return null;b*=2}if(A===T){for(let V=0;V<2*p;V++)kp[V]=0;if(a)for(let V=c[S-1];V<c[S];V++)v[V]=n[a[V]];T=c[++S]}const I=m?a[A]:A,L=I*t,D=yit(s,L,t);let U=D%p,z=f;for(;kp[2*U+1]!==0;){if(kp[2*U]===D){const V=kp[2*U+1]-1;if(mit(s,L,V*t,t)){z=n[V];break}}U++,U>=p&&(U-=p)}z===f&&(kp[2*U]=D,kp[2*U+1]=I+1,f++),n[I]=z}if(o!==0&&1-f/r<o)return null;if(m){for(let A=c[S-1];A<v.length;A++)v[A]=n[a[A]];n=v}const E=new Uint32Array(t*f);f=0;for(let A=0;A<y;A++)n[A]===f&&(git(s,(m?a[A]:A)*t,E,f*t,t),f++);if(a&&!m){const A=new Uint32Array(l);for(let I=0;I<A.length;I++)A[I]=n[a[I]];n=A}return{buffer:E.buffer,indices:n,uniqueCount:f}}function mit(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function git(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function yit(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let kp=null;function t2t(e){const t=_3(e.rings,e.hasZ,gm.CCW_IS_HOLE),i=[];let r=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(CE(h,p,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=vit(i,r,s),o=kxe(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function vit(e,t,i){if(e.length===1)return e[0];const r=new Float64Array(t),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function _3(e,t,i){const r=e.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let m=0;m<r;++m)h+=e[m].length;const p=new Float64Array(3*h);let f=0;for(let m=r-1;m>=0;m--){const y=e[m],v=i===gm.CCW_IS_HOLE&&_it(y);if(v&&r!==1)s[a++]=y;else{let w=y.length;for(let S=0;S<a;++S)w+=s[S].length;const b={index:f,pathLengths:new Array(a+1),count:w,holeIndices:new Array(a)};b.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=v?R$(y,y.length-1,-1,p,f,y.length,t):R$(y,0,1,p,f,y.length,t);for(let S=0;S<a;++S){const T=s[S];b.holeIndices[S]=f,b.pathLengths[S+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=R$(T,0,1,p,f,T.length,t)}a=0,b.count>0&&(n[l++]=b)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=R$(y,0,1,p,f,y.length,t)}return l<r&&(n.length=l),c<r&&(o.length=c),{position:p,polygons:n,outlines:o}}function R$(e,t,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,t+=i}return s/3}function _it(e){return!RW(e,!1,!1)}var gm;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(gm||(gm={}));var DO,zH;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(DO||(DO={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(zH||(zH={}));var Ur,Ih,kt,AE,xs,Vn;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(Ur||(Ur={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Ih||(Ih={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(kt||(kt={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(AE||(AE={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(xs||(xs={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(Vn||(Vn={}));class bit{constructor(t,i){this.vec3=t,this.id=i}}function LO(e,t,i,r){return new bit(Fe(e,t,i),r)}var $a;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})($a||($a={}));class aoe{constructor(t,i){this.index=t,this.renderTargets=i,this._extent=Nt(),this.resolution=0,this.renderLocalOrigin=LO(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new xit,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const i=t===$a.ColorAndWater?this.renderTargets.getTarget(xs.Color):t===$a.Highlight?this.renderTargets.getTarget(xs.Highlight):this.renderTargets.getTarget(xs.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(xs.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(xs.Color):null}getNormalTexture(t){const i=t===$a.ColorAndWater?this.renderTargets.getTarget(xs.Water):null;return i?i.getTexture():null}draw(t,i){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==xs.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,i):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?cE.CHANGED:cE.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[xs.Color]|+t[xs.ColorNoRasterImage]<<1|+t[xs.Highlight]<<2|+t[xs.Water]<<3|+t[xs.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const i=.001*t.range;if(this._extent[0]-i<=t.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];OF(this._extent,t.range,0,r)}if(this._extent[2]+i>=t.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];OF(this._extent,-t.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,ay(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const i=this.canvasGeometries.extents[t];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===Ur.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function wit(e,t,i){return Math.min(C2(Math.max(e,t)+256),i)}class xit{constructor(){this.extents=[Nt(),Nt(),Nt()],this.numViews=0}}class Uxe{constructor(t,i){this.size=kZ(),this._fbo=null,this._fbo=new Or(t,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE},{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Qe(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,i){this.size[0]=t,this.size[1]=i,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,i;return(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0}}class Tit{constructor(t){const i=(r,s,n=!0)=>({type:s,fbo:new Uxe(t,n),renderPass:r,valid:!1,lastUsed:1/0});this.renderTargets=[i(je.MATERIAL,xs.Color),i(je.MATERIAL,xs.ColorNoRasterImage),i(je.MATERIAL_HIGHLIGHT,xs.Highlight,!1),i(je.MATERIAL_NORMAL,xs.Water),i(je.MATERIAL,xs.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,i,r){if(t)i.lastUsed=r;else if(r-i.lastUsed>Sit)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,i)=>t+i.fbo.gpuMemoryUsage,0)}}const Sit=1e3;class FQ{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,i){var r;return(r=this._outer.get(t))==null?void 0:r.get(i)}set(t,i,r){const s=this._outer.get(t);s?s.set(i,r):this._outer.set(t,new Map([[i,r]]))}delete(t,i){const r=this._outer.get(t);r&&(r.delete(i),r.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((i,r)=>t(i,r))}}class zxe{constructor(t){this._context=t,this._perConstructorInstances=new FQ,this._frameCounter=0,this._keepAliveFrameCount=loe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,i){const r=i.key;let s=this._perConstructorInstances.get(t,r);if(M(s)){const n=new t(this._context,i,()=>this.release(n));s=new Eit(n),this._perConstructorInstances.set(t,r,s)}return++s.refCount,s.technique}releaseAndAcquire(t,i,r){if(_(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(t,i)}release(t){if(M(t)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(t.constructor,t.key);M(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==loe&&this._perConstructorInstances.forEach((t,i)=>{t.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>{l.technique.reload(this._context)}))};t.push(s(i,r))}),await Promise.all(t)}}class Eit{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const loe=-1,bU=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var r;for(const s of(r=this._managedDisposables)!=null?r:[]){const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class wU extends bU(class{}){}function Io(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(r=(i=e._managedDisposables)==null?void 0:i.slice())!=null?r:[]),e._managedDisposables.unshift(t)}}const Cit=ge.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class Vxe{constructor(t,i,r,s){this._textureRepository=t,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new FQ}dispose(){this._textureRepository.dispose()}acquire(t,i){this._ownMaterial(t);let r=this._id2glMaterialRef.get(i,t.id);if(M(r)){const s=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});r=new Ait(s),this._id2glMaterialRef.set(i,t.id,r)}return r.ref(),r.glMaterial}release(t,i){const r=this._id2glMaterialRef.get(i,t.id);_(r)&&(r.unref(),r.referenced||(Qe(r.glMaterial),this._id2glMaterialRef.delete(i,t.id)))}_ownMaterial(t){_(t.repository)&&t.repository!==this&&Cit.error("Material is already owned by a different material repository"),t.repository=this}}class Ait{constructor(t){this.glMaterial=t,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,pt(this.refCnt>=0)}get referenced(){return this.refCnt>0}}const Mit={orderedRepackingEnabled:!1},Oit={rootOrigin:null},Rit=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class ME{constructor(t,i){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new ts,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),ts.clearPool(),VH[0]=null,r1.prune(),ab.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);const r=ts.acquire();for(let s=0;s<i;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}ts.release(r)}remove(t,i=null){this._objectCount-=t.length;const r=ts.acquire();for(const s of t){const n=_(i)?i:H2(this._objectToBoundingSphere(s),Lit);UM(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}ts.release(r),this._shrink()}update(t,i){if(!UM(i[3])&&this._isDegenerate(t))return;const r=Dit(t);this.remove(r,i),this.add(r)}forEachAlongRay(t,i,r){const s=Uu(t,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(t,i,r,s){const n=Uu(t,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(t){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(t),r.residents!==null&&r.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=JV(t,i),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!Fv(r,f))return;const m=uv(t,i,f),y=m-f[3],v=m+f[3];y<o&&(o=y,a=v,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!Fv(r,p.bounds)||(ce(Zu,c,p.halfSize),de(Zu,Zu,p.bounds),uv(t,i,Zu)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},t,i),l}forEachInDepthRange(t,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:v=>{r===ME.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,v.near),c=Math.min(c,v.far)):(l=Math.max(l,-v.far),c=Math.min(c,-v.near))}};h.setRange(s);const p=uv(i,r,t),f=JV(i,r),m=JV(i,-r),y=v=>{if(!a(v))return;const w=this._objectToBoundingSphere(v),b=w,S=uv(i,r,b)-p,T=S-w[3],E=S+w[3];T>c||E<l||!Fv(o,w)||n(v,h)};this._forEachNodeDepthOrdered(this._root,v=>{if(!Fv(o,v.bounds)||(ce(Zu,f,v.halfSize),de(Zu,Zu,v.bounds),uv(i,r,Zu)-p>c)||(ce(Zu,m,v.halfSize),de(Zu,Zu,v.bounds),uv(i,r,Zu)-p<l))return!1;const w=v.node;return w.terminals.forAll(b=>y(b)),w.residents!==null&&w.residents.forAll(b=>y(b)),!0},i,r)}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize))}forEachNeighbor(t,i){const r=Wg(i),s=i,n=o=>{const a=this._objectToBoundingSphere(o),l=Wg(a),c=r+l;Gs(a,s)-c*c<=0&&t(o)};this._forEachNode(this._root,o=>{const a=Wg(o.bounds),l=r+a;if(Gs(o.bounds,s)-l*l>0)return!1;const c=o.node;return c.terminals.forAll(h=>n(h)),c.residents!==null&&c.residents.forAll(h=>n(h)),!0}),this.forEachDegenerateObject(n)}_intersectsNode(t,i){return P$(i.bounds,2*-i.halfSize,au),P$(i.bounds,2*i.halfSize,lu),Cse(t.origin,t.direction,au,lu)}_intersectsNodeWithOffset(t,i,r){return P$(i.bounds,2*-i.halfSize,au),P$(i.bounds,2*i.halfSize,lu),r.applyToMinMax(au,lu),Cse(t.origin,t.direction,au,lu)}_intersectsObject(t,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||VG(r,t)}_intersectsObjectWithOffset(t,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||VG(r.applyToBoundingSphere(s),t)}_forEachNode(t,i){let r=ts.acquire().init(t);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(ts.acquire().init(r).advance(n));ts.release(r)}}_forEachNodeDepthOrdered(t,i,r,s=ME.DepthOrder.FRONT_TO_BACK){let n=ts.acquire().init(t);const o=[n];for($it(r,s,hoe);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=hoe[a];n.node.children[l]&&o.push(ts.acquire().init(n).advance(l))}ts.release(n)}}_remove(t,i,r){r1.clear();const s=r.advanceTo(i,(n,o)=>{r1.push(n.node),r1.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=r1.length-2;n>=0;n-=2){const o=r1.data[n],a=r1.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Gt({shrink:!0})),!0)}_add(t,i){i.advanceTo(this._objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){const i=t.node.residents;t.node.residents=null;for(let r=0;r<i.length;r++){const s=ts.acquire().init(t);this._add(i.getItemAt(r),s),ts.release(s)}}_grow(t,i){if(i!==0&&(coe(t,i,r=>this._objectToBoundingSphere(r),Up),UM(Up[3])&&!this._fitsInsideTree(Up)))if(this._nodeIsEmpty(this._root.node))H2(Up,this._root.bounds),this._root.halfSize=1.25*Up[3];else{const r=this._rootBoundsForRootAsSubNode(Up);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(Up,r):this._growRootAsSubNode(r),ts.release(r)}}_rebuildTree(t,i){le(eB,i.bounds),eB[3]=i.halfSize,coe([t,eB],2,s=>s,tB);const r=ts.acquire().init(this._root);this._root.initFrom(null,tB,1.25*tB[3]),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),ts.release(r)}_placingRootViolatesMaxDepth(t){const i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const i=t[3],r=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let a=0;a<3;a++){const l=n[a]-o-(r[a]-i),c=r[a]+i-(n[a]+o),h=Math.max(0,Math.ceil(l/(2*o))),p=Math.max(0,Math.ceil(c/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),I$[a].min=h,I$[a].max=p}for(let a=0;a<3;a++){let l=I$[a].min,c=I$[a].max;const h=(s-(l+c))/2;l+=Math.ceil(h),c+=Math.floor(h);const p=n[a]-o-l*o*2;KV[a]=p+(c+l)*o}return KV[3]=s*o*Gxe,ts.acquire().initFrom(null,KV,s*o,0)}_growRootAsSubNode(t){const i=this._root.node;le(Up,this._root.bounds),Up[3]=this._root.halfSize,this._root.init(t),t.advanceTo(Up,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&t==null;)r=s++,t=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(t){return!UM(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const i=this._root.bounds,r=this._root.halfSize;return t[3]<=r&&t[0]>=i[0]-r&&t[0]<=i[0]+r&&t[1]>=i[1]-r&&t[1]<=i[1]+r&&t[2]>=i[2]-r&&t[2]<=i[2]+r}}class ts{constructor(){this.bounds=Cn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,r,s=this.depth){return this.node=_(t)?t:ts.createEmptyNode(),_(i)&&H2(i,this.bounds),this.halfSize=r,this.depth=s,this}advance(t){let i=this.node.children[t];i||(i=ts.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;const r=Bxe[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*Gxe,this}advanceTo(t,i,r=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const i=this.bounds;return(i[0]<t[0]?1:0)+(i[1]<t[1]?2:0)+(i[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Gt({shrink:!0}),residents:new Gt({shrink:!0})}}static acquire(){return ts._pool.acquire()}static release(t){ts._pool.release(t)}static clearPool(){ts._pool.prune()}}function Pit(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function Iit(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function P$(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function coe(e,t,i,r){if(t===1){const s=i(e[0]);H2(s,r)}else{au[0]=1/0,au[1]=1/0,au[2]=1/0,lu[0]=-1/0,lu[1]=-1/0,lu[2]=-1/0;for(let s=0;s<t;s++){const n=i(e[s]);UM(n[3])&&(Pit(au,n),Iit(lu,n))}dn(r,au,lu,.5),r[3]=Math.max(lu[0]-au[0],lu[1]-au[1],lu[2]-au[2])/2}}function $it(e,t,i){if(!ab.length)for(let r=0;r<8;++r)ab.push({index:0,distance:0});for(let r=0;r<8;++r){const s=Bxe[r];ab.data[r].index=r,ab.data[r].distance=uv(e,t,s)}ab.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=ab.data[r].index}function JV(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=uv(e,t,uoe[s]);n<i&&(i=n,r=uoe[s])}return r}function uv(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function UM(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}ts._pool=new Es(ts),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(ME||(ME={}));const Bxe=[Fe(-1,-1,-1),Fe(1,-1,-1),Fe(-1,1,-1),Fe(1,1,-1),Fe(-1,-1,1),Fe(1,-1,1),Fe(-1,1,1),Fe(1,1,1)],uoe=[Fe(-1,-1,-1),Fe(-1,-1,1),Fe(-1,1,-1),Fe(-1,1,1),Fe(1,-1,-1),Fe(1,-1,1),Fe(1,1,-1),Fe(1,1,1)],Gxe=Math.sqrt(3),VH=[null];function Dit(e){return VH[0]=e,VH}const KV=Cn(),Zu=R(),au=R(),lu=R(),r1=new Gt,Lit=Cn(),Up=Cn(),eB=Cn(),tB=Cn(),I$=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],ab=new Gt,hoe=[0,0,0,0,0,0,0,0],dp=ME;class jxe extends a3{constructor(t,i=""){var r,s,n;super(),this.apiLayerUid=i,this.type=Mp.Layer,this.events=new as,this.isSliceable=!1,this._objects=new Gt,this._stageHandles=new jt,this.apiLayerUid=i,this.isVisible=(r=t==null?void 0:t.isVisible)!=null?r:!0,this.isPickable=(s=t==null?void 0:t.isPickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:lE.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const i of Rit)this._stageHandles.add(this.events.on(i,r=>t.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),_(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),_(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const i of t)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),_(this._octree)&&this._octree.add(t)}removeMany(t){const i=new Array;if(this._objects.removeUnorderedMany(t,t.length,i),i.length!==0){for(const r of i)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),_(this._octree)&&this._octree.remove(i)}}sync(){_(this._stage)&&this.updatePolicy!==lE.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,i){_(this._octree)&&this._octree.update(t,i)}getSpatialQueryAccelerator(){return M(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=lt(this._octree)}_createOctree(){this._octree=new dp(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function q4(e){return _(e)&&e.type===Mp.Layer}class Hxe{constructor(t,i){this._material=t,this._repository=i,this._map=new Map}destroy(){this._map.forEach((t,i)=>{_(t)&&this._repository.release(this._material,Xw(i))})}load(t,i){this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,Xw(i)));const r=this._map.get(i);if(_(r)){if(r.ensureResources(t)===ac.LOADED)return r;this._repository.requestRender()}return null}}function Xw(e){switch(e){case je.MATERIAL:return K.Color;case je.MATERIAL_ALPHA:return K.Alpha;case je.MATERIAL_DEPTH:return K.Depth;case je.MATERIAL_NORMAL:return K.Normal;case je.MATERIAL_DEPTH_SHADOWMAP_ALL:return K.Shadow;case je.MATERIAL_HIGHLIGHT:return K.Highlight;case je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return K.Shadow}}const doe=8;function qxe(e,t){const i=e.vertex;i.uniforms.add(new Xe("intrinsicWidth",r=>r.width)),t.vvSize?(e.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new xt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new xt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new xt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new xt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(O.SIZE,"float"),i.code.add(x`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new aa("vvOpacityValues",r=>r.vvOpacityValues,doe),new aa("vvOpacityOpacities",r=>r.vvOpacityOpacities,doe)]),i.code.add(x`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(x`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",yp),i.uniforms.add(new aa("vvColorValues",r=>r.vvColorValues,yp)),i.uniforms.add(new uU("vvColorColors",r=>r.vvColorColors,yp)),i.code.add(x`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(O.COLOR,"vec4"),i.code.add(x`vec4 getColor(){
return applyOpacity(color);
}`))}function L_(e,t){e.fragment.include($c),t.output===K.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===K.Depth&&e.fragment.code.add(x`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function Nit(e){return M(e)?Qf:e.length===4?e:Ji(Fit,e[0],e[1],e[2],1)}const Fit=Ht();function Wxe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?kit(e,t):Uit(e)}function kit(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:r,fragment:s}=e;s.include($c),r.uniforms.add(new Fi("stipplePatternPixelSize")),t.draped||(mm(r,t),r.uniforms.add(new Xe("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(x`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),r.code.add(x`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${zit};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(x`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(x`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new Xe("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(x`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?x`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new Vr("stipplePatternTexture")),s.uniforms.add(new Fi("stipplePatternSDFNormalizer")),s.uniforms.add(new Fi("stipplePatternTextureSize")),s.uniforms.add(new Fi("stipplePatternPixelSizeInv")),s.code.add(x`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),s.code.add(x`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?x`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:x`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?x`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?x`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:x`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?x`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:x`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new ri("stippleOffColor",n=>Nit(n.stippleOffColor))),s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Uit(e){e.fragment.code.add(x`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const zit=x.float(.4);var qh;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(qh||(qh={}));class qr extends la{constructor(){super(...arguments),this.output=K.Color,this.capType=qh.BUTT,this.transparencyPassType=vt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}u([j({count:K.COUNT})],qr.prototype,"output",void 0),u([j({count:qh.COUNT})],qr.prototype,"capType",void 0),u([j({count:vt.COUNT})],qr.prototype,"transparencyPassType",void 0),u([j()],qr.prototype,"occluder",void 0),u([j()],qr.prototype,"hasSlicePlane",void 0),u([j()],qr.prototype,"hasPolygonOffset",void 0),u([j()],qr.prototype,"writeDepth",void 0),u([j()],qr.prototype,"draped",void 0),u([j()],qr.prototype,"stippleEnabled",void 0),u([j()],qr.prototype,"stippleOffColorEnabled",void 0),u([j()],qr.prototype,"stippleScaleWithLineWidth",void 0),u([j()],qr.prototype,"stipplePreferContinuous",void 0),u([j()],qr.prototype,"roundJoins",void 0),u([j()],qr.prototype,"vvSize",void 0),u([j()],qr.prototype,"vvColor",void 0),u([j()],qr.prototype,"vvOpacity",void 0),u([j()],qr.prototype,"falloffEnabled",void 0),u([j()],qr.prototype,"innerColorEnabled",void 0),u([j()],qr.prototype,"hasOccludees",void 0),u([j()],qr.prototype,"hasMultipassTerrain",void 0),u([j()],qr.prototype,"cullAboveGround",void 0),u([j()],qr.prototype,"wireframe",void 0),u([j({constValue:!0})],qr.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!0})],qr.prototype,"stippleRequiresStretchMeasure",void 0),u([j({constValue:!0})],qr.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],qr.prototype,"hasSliceTranslatedView",void 0);const W4=1;function Vit(e){const t=new qi,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(Gk),t.include(qxe,e),t.include(Wxe,e),e.output===K.Depth&&t.include(L_,e),Ru(t,e);const{vertex:r,fragment:s}=t;r.uniforms.add([new Er("inverseProjectionMatrix",(f,m)=>m.camera.inverseProjectionMatrix),new pi("nearFar",(f,m)=>m.camera.nearFar),new Xe("miterLimit",f=>f.join!=="miter"?0:f.miterLimit),new ri("viewport",(f,m)=>m.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.SUBDIVISIONFACTOR,"float"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),t.attributes.add(O.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float");const n=e.capType===qh.ROUND,o=e.stippleEnabled&&e.stippleScaleWithLineWidth||n;o&&t.varyings.add("vLineWidth","float");const a=e.stippleEnabled&&e.stippleScaleWithLineWidth;a&&t.varyings.add("vLineSizeInv","float");const l=e.innerColorEnabled||n;l&&t.varyings.add("vLineDistance","float");const c=e.stippleEnabled&&n,h=e.falloffEnabled||c;h&&t.varyings.add("vLineDistanceNorm","float"),n&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(x`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${i?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new Xe("pixelRatio",(f,m)=>m.camera.pixelRatio)),r.code.add(x`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${o?x`vLineWidth = lineWidth;`:""}
      ${a?x`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||n)&&r.code.add(x`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${n?x`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(x`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(x`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?x`min(1.0, subdivisionFactor * ${x.float((W4+2)/(W4+1))})`:x`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(x`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=e.capType!==qh.BUTT;return r.code.add(x`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?x`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(x`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${h||l?x`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${l?x`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${h?x`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),n&&r.code.add(x`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new Xe("worldToScreenRatio",(f,m)=>1/m.screenToPCSRatio)):r.code.add(x`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(x`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(x`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(x`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.code.add(x`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(x`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),i&&t.include(Vu,e),t.include(ys,e),s.include(Mm),s.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?s.code.add(x`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(n&&s.code.add(x`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${x.float(Vo)}) {
        discard;
      }
    `),c?s.code.add(x`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${x.float(Vo)}, stippleCoverage);
      `):s.code.add(x`float stippleAlpha = getStippleAlpha();`),s.uniforms.add(new ri("intrinsicColor",f=>f.color)),s.code.add(x`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(s.uniforms.add(new ri("innerColor",f=>ft(f.innerColor,f.color))),s.uniforms.add(new Xe("innerWidth",(f,m)=>f.innerWidth*m.camera.pixelRatio)),s.code.add(x`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),s.code.add(x`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(s.uniforms.add(new Xe("falloff",f=>f.falloff)),s.code.add(x`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),s.code.add(x`
    if (finalColor.a < ${x.float(Vo)}) {
      discard;
    }

    ${e.output===K.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===vt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),t}const Bit=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:W4,build:Vit},Symbol.toStringTag,{value:"Module"})),kQ={func:yr.LESS},X4={func:yr.ALWAYS},ym={mask:255},Xxe={mask:0},Git=e=>({function:{func:yr.NOTEQUAL,ref:e,mask:e},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.KEEP}}),jit=e=>({function:{func:yr.ALWAYS,ref:e,mask:e},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.REPLACE}}),N_={function:{func:yr.ALWAYS,ref:Cl.OutlineVisualElementMask,mask:Cl.OutlineVisualElementMask},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.ZERO}},T_={function:{func:yr.ALWAYS,ref:Cl.OutlineVisualElementMask,mask:Cl.OutlineVisualElementMask},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.REPLACE}},Yxe={function:{func:yr.EQUAL,ref:Cl.OutlineVisualElementMask,mask:Cl.OutlineVisualElementMask},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.KEEP}},Zxe={function:{func:yr.NOTEQUAL,ref:Cl.OutlineVisualElementMask,mask:Cl.OutlineVisualElementMask},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.KEEP}},Qxe=new Map([[O.POSITION,0],[O.SUBDIVISIONFACTOR,1],[O.UV0,2],[O.AUXPOS1,3],[O.AUXPOS2,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7]]);class xU extends fr{constructor(t,i,r){super(t,i,r),this.stippleTextureRepository=t.stippleTextureRepository}initializeProgram(t){const i=xU.shader.get().build(this.configuration);return new nr(t.rctx,i,Qxe)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}_makePipelineState(t,i){const r=this.configuration,s=t===vt.NONE,n=t===vt.FrontFace;return Ut({blending:r.output===K.Color||r.output===K.Alpha?s?Pu:$y(t):null,depthTest:{func:D_(t)},depthWrite:s?r.writeDepth&&Il:hU(t),colorWrite:ti,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?T_:N_:null,polygonOffset:s||n?r.hasPolygonOffset&&poe:pU})}initializePipeline(){const t=this.configuration;if(t.occluder){const i=t.hasPolygonOffset&&poe;this._occluderPipelineTransparent=Ut({blending:Pu,polygonOffset:i,depthTest:X4,depthWrite:null,colorWrite:ti,stencilWrite:null,stencilTest:Zxe}),this._occluderPipelineOpaque=Ut({blending:Pu,polygonOffset:i,depthTest:X4,depthWrite:null,colorWrite:ti,stencilWrite:Xxe,stencilTest:Yxe}),this._occluderPipelineMaskWrite=Ut({blending:null,polygonOffset:i,depthTest:kQ,depthWrite:null,colorWrite:null,stencilWrite:ym,stencilTest:T_})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?It.LINES:It.TRIANGLE_STRIP}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}xU.shader=new sr(Bit,()=>import("./RibbonLine.glsl.930083bb.js"));const poe={factor:0,units:-4},Hit=ge.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var ec;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(ec||(ec={}));class VS extends Rm{constructor(t){super(t,new Wit),this._vertexAttributeLocations=Qxe,this.techniqueConfig=new qr,this.layout=this.createLayout()}isClosed(t,i){return Jxe(this.parameters,t,i)}getConfiguration(t,i){this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Ee.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern)&&t!==K.Highlight;return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&_(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===Fr.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedLineGeometry(t,s,c,o,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectDrapedLineGeometry(t,i,r,s,n){if(!i.options.selectionMode)return;const o=t.vertexAttributes.get(O.POSITION).data,a=t.vertexAttributes.get(O.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const y=t.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0];l*=De(this.parameters.vvSizeOffset[0]+y*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=s[0],h=s[1],p=(l/2+4)*t.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],w=o[y+1],b=c-v,S=h-w,T=o[y+3]-v,E=o[y+4]-w,C=De((T*b+E*S)/(T*T+E*E),0,1),A=T*C-b,I=E*C-S,L=A*A+I*I;L<f&&(f=L,m=y/3)}f<p*p&&n(r.dist,r.normal,m,!1)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||l3(i))return;if(!obe(r))return void Hit.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes,a=o.get(O.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const b=o.get(O.SIZEFEATUREATTRIBUTE).data[0];l*=De(this.parameters.vvSizeOffset[0]+b*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(O.SIZE)&&(l*=o.get(O.SIZE).data[0]);const c=s.camera,h=Yit;_o(h,s.point);const p=l*c.pixelRatio/2+4*c.pixelRatio;ne(iA[0],h[0]-p,h[1]+p,0),ne(iA[1],h[0]+p,h[1]+p,0),ne(iA[2],h[0]+p,h[1]-p,0),ne(iA[3],h[0]-p,h[1]-p,0);for(let b=0;b<4;b++)if(!c.unprojectFromRenderScreen(iA[b],Vm[b]))return;na(c.eye,Vm[0],Vm[1],rB),na(c.eye,Vm[1],Vm[2],sB),na(c.eye,Vm[2],Vm[3],nB),na(c.eye,Vm[3],Vm[0],oB);let f=Number.MAX_VALUE,m=0;const y=BH(this.parameters,o,t.indices)?a.length-2:a.length-5;for(let b=0;b<y;b+=3){Za[0]=a[b]+r[12],Za[1]=a[b+1]+r[13],Za[2]=a[b+2]+r[14];const S=(b+3)%a.length;if(Qa[0]=a[S]+r[12],Qa[1]=a[S+1]+r[13],Qa[2]=a[S+2]+r[14],cr(rB,Za)<0&&cr(rB,Qa)<0||cr(sB,Za)<0&&cr(sB,Qa)<0||cr(nB,Za)<0&&cr(nB,Qa)<0||cr(oB,Za)<0&&cr(oB,Qa)<0)continue;if(c.projectToRenderScreen(Za,n1),c.projectToRenderScreen(Qa,o1),n1[2]<0&&o1[2]>0){pe(zp,Za,Qa);const E=c.frustum,C=-cr(E[lr.NEAR],Za)/Te(zp,E[lr.NEAR]);ce(zp,zp,C),de(Za,Za,zp),c.projectToRenderScreen(Za,n1)}else if(n1[2]>0&&o1[2]<0){pe(zp,Qa,Za);const E=c.frustum,C=-cr(E[lr.NEAR],Qa)/Te(zp,E[lr.NEAR]);ce(zp,zp,C),de(Qa,Qa,zp),c.projectToRenderScreen(Qa,o1)}else if(n1[2]<0&&o1[2]<0)continue;n1[2]=0,o1[2]=0;const T=FX(cw(n1,o1,goe),h);T<f&&(f=T,le(foe,Za),le(moe,Qa),m=b/3)}const v=s.rayBegin,w=s.rayEnd;if(f<p*p){let b=Number.MAX_VALUE;if(Fme(cw(foe,moe,goe),cw(v,w,Zit),s1)){pe(s1,s1,v);const S=Oe(s1);ce(s1,s1,1/S),b=S/hr(v,w)}n(b,s1,m,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=t.indices,n=r.get(O.POSITION);return jZ(n,s?s.get(O.POSITION):null,s&&BH(this.parameters,r,s),i)}createLayout(){const t=ls().vec3f(O.POSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0).vec3f(O.AUXPOS1).vec3f(O.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(O.SIZEFEATUREATTRIBUTE):t.f32(O.SIZE),this.parameters.vvColorEnabled?t.f32(O.COLORFEATUREATTRIBUTE):t.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&t.f32(O.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Xit(this.layout,this.parameters)}requiresSlot(t,i){if(t===Ee.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Fr.OccludeAndTransparentStencil)return t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL;const r=Xw(i);return r===K.Color||r===K.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new qit(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0)}}class qit extends I_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(xU,t)}}class Wit extends SQ{constructor(){super(...arguments),this.width=0,this.color=Fh,this.join="miter",this.cap=qh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class Xit{constructor(t,i){this.parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const r=i.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=W4+r}}_isClosed(t){return BH(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const r=t.indices.get(O.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(t,i,r,s){var V;const n=Qit,o=Jit,a=Kit,l=i.vertexAttributes.get(O.POSITION).data,c=i.indices&&i.indices.get(O.POSITION),h=(V=i.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:V.data;c&&c.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,f=0;this.parameters.vvSizeEnabled?f=i.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.SIZE)&&(p=i.vertexAttributes.get(O.SIZE).data[0]);let m=[1,1,1,1],y=0;this.parameters.vvColorEnabled?y=i.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.COLOR)&&(m=i.vertexAttributes.get(O.COLOR).data);let v=0;this.parameters.vvOpacityEnabled&&(v=i.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const w=l.length/3,b=t.transformation,S=new Float32Array(r.buffer),T=this.vertexBufferLayout.stride/4;let E=s*T;const C=E;let A=0;const I=h?(X,Z,ae)=>A=h[ae]:(X,Z,ae)=>A+=hr(X,Z),L=(X,Z,ae,re,$,k,B)=>{if(S[E++]=Z[0],S[E++]=Z[1],S[E++]=Z[2],S[E++]=re,S[E++]=B,S[E++]=$,S[E++]=X[0],S[E++]=X[1],S[E++]=X[2],S[E++]=ae[0],S[E++]=ae[1],S[E++]=ae[2],this.parameters.vvSizeEnabled?S[E++]=f:S[E++]=p,this.parameters.vvColorEnabled)S[E++]=y;else{const H=Math.min(4*k,m.length-4);S[E++]=m[H+0],S[E++]=m[H+1],S[E++]=m[H+2],S[E++]=m[H+3]}this.parameters.vvOpacityEnabled&&(S[E++]=v)};E+=T,ne(o,l[0],l[1],l[2]),b&&ke(o,o,b);const D=this._isClosed(i);if(D){const X=l.length-3;ne(n,l[X],l[X+1],l[X+2]),b&&ke(n,n,b)}else ne(a,l[3],l[4],l[5]),b&&ke(a,a,b),L(o,o,a,1,ec.LEFT_CAP_START,0,0),L(o,o,a,1,ec.RIGHT_CAP_START,0,0),le(n,o),le(o,a);const U=D?0:1,z=D?w:w-1;for(let X=U;X<z;X++){const Z=(X+1)%w*3;ne(a,l[Z+0],l[Z+1],l[Z+2]),b&&ke(a,a,b),I(n,o,X),L(n,o,a,0,ec.LEFT_JOIN_END,X,A),L(n,o,a,0,ec.RIGHT_JOIN_END,X,A);const ae=this.numJoinSubdivisions;for(let re=0;re<ae;++re){const $=(re+1)/(ae+1);L(n,o,a,$,ec.LEFT_JOIN_END,X,A),L(n,o,a,$,ec.RIGHT_JOIN_END,X,A)}L(n,o,a,1,ec.LEFT_JOIN_START,X,A),L(n,o,a,1,ec.RIGHT_JOIN_START,X,A),le(n,o),le(o,a)}D?(ne(a,l[3],l[4],l[5]),b&&ke(a,a,b),A=I(n,o,z),L(n,o,a,0,ec.LEFT_JOIN_END,U,A),L(n,o,a,0,ec.RIGHT_JOIN_END,U,A)):(A=I(n,o,z),L(n,o,o,0,ec.LEFT_CAP_END,z,A),L(n,o,o,0,ec.RIGHT_CAP_END,z,A)),iB(S,C+T,S,C,T),E=iB(S,E-T,S,E,T),this.parameters.wireframe&&this._addWireframeVertices(r,C,E,T)}_addWireframeVertices(t,i,r,s){const n=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=iB(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function iB(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function BH(e,t,i){return Jxe(e,t.get(O.POSITION).data,i?i.get(O.POSITION):null)}function Jxe(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const Za=R(),Qa=R(),zp=R(),s1=R(),Yit=R(),n1=Fo(),o1=Fo(),foe=R(),moe=R(),goe=Sm(),Zit=Sm(),Qit=R(),Jit=R(),Kit=R(),iA=[Fo(),Fo(),Fo(),Fo()],Vm=[R(),R(),R(),R()],rB=vi(),sB=vi(),nB=vi(),oB=vi();class UQ{constructor(t,i=125e4){this._originSR=t,this._gridSize=i,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Tl()}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(i==null){const h=Oit.rootOrigin;if(_(h))return this._origins.set(this._rootOriginId,LO(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(t);const p=LO(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),o=Math.round(t[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(pe(qn,t,i.vec3),qn[0]=Math.abs(qn[0]),qn[1]=Math.abs(qn[1]),qn[2]=Math.abs(qn[2]),qn[0]<c&&qn[1]<c&&qn[2]<c){if(l){const h=Math.max(...qn);if(pe(qn,t,l.vec3),qn[0]=Math.abs(qn[0]),qn[1]=Math.abs(qn[1]),qn[2]=Math.abs(qn[2]),Math.max(...qn)<h)return l}return i}return l||(l=LO(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(t,i=mi(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new VS({width:2,color:i}),s.add(this._material);const m=new jxe({isPickable:!1}),y=new Ly({castShadow:!1});s.add(y),m.add(y),s.add(m),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Uint16Array(2*(l-1)),p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&a[m]?p:-p),c[3*m+1]=t[1]+(2&a[m]?p:-p),c[3*m+2]=t[2]+(4&a[m]?p:-p),m>0&&(h[2*m+0]=m-1,h[2*m+1]=m);pr(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new kr([[O.POSITION,{size:3,data:c,exclusive:!0}]],[[O.POSITION,h]],Al.Line);s.add(f),o.addGeometry(f,this._material,hn)}}const qn=R();class Kxe{constructor(t,i,r,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new ir,this.pass=je.MATERIAL,this.renderOccludedMask=yoe,this.bindParameters=new Xk(i,r,_(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=yoe}get isHighlightPass(){return this.pass===je.MATERIAL_HIGHLIGHT}}class ert extends Kxe{constructor(t,i,r,s,n){super(t,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n}}const yoe=Fr.Occlude|Fr.OccludeAndTransparent|Fr.OccludeAndTransparentStencil;var OE;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(OE||(OE={}));class $${constructor(){this.camera=new ir,this.lightMat=Ae()}}class zQ{constructor(t,i,r=0){this.rctx=t,this.viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Ht(),this._cascades=[new $$,new $$,new $$,new $$],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=r}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return Ji(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=De(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&_(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const i=this._snapshots.length;if(t>i){const r=t-i;this._snapshots.length=t;for(let s=0;s<r;++s)this._snapshots[i+s]=null}else if(t<this.snapshotCount){const r=i-t;for(let s=0;s<r;++s)this._discardSnapshot(t+s);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)lB[t]=this._cascades[t];return lB.length=this.numCascades,lB}start(t,i,r){pt(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(t,i);const o=t.viewMatrix,a=t.projectionMatrix;for(let l=0;l<this.numCascades;++l)this._constructCascade(l,a,o,i);this.lastOrigin=null,this.clear()}finish(t){pt(this.enabled),this.rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this.lastOrigin||!bl(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||R(),le(this.lastOrigin,t);for(let i=0;i<this.numCascades;++i){ja(Aoe,this._cascades[i].lightMat,t);for(let r=0;r<16;++r)Moe[16*i+r]=Aoe[r]}}return Moe}takeCascadeSnapshotTo(t,i){pt(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this.rctx,n=s.bindTexture(r,ot.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(mt.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,ot.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(tr.COLOR_BUFFER_BIT|tr.DEPTH_BUFFER_BIT)}_computeTextureSize(t,i){const r=.5*Math.log(t*t+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(_(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new ot(this.rctx,t),this._fbo=new Or(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let i=this._snapshots[t];if(_(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(t);const r={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new ot(this.rctx,r),this._snapshots[t]=i,i}_discardDepthTexture(){this._fbo=Qe(this._fbo),this._depthTexture=Qe(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=Qe(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,i,r,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);pt(l<c);for(let p=0;p<8;++p){Ji(woe,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:c,1),xu(Zl[p],woe,boe);for(let f=0;f<3;++f)Zl[p][f]/=Zl[p][3]}ca(aB,Zl[0]),ja(voe,Coe,aB),n.camera.viewMatrix=voe;for(let p=0;p<8;++p)ke(Zl[p],Zl[p],n.camera.viewMatrix);le(Vp,Zl[0]),le(Bp,Zl[0]);for(let p=1;p<8;++p)for(let f=0;f<3;++f)Vp[f]=Math.min(Vp[f],Zl[p][f]),Bp[f]=Math.max(Bp[f],Zl[p][f]);Vp[2]-=200,Bp[2]+=200,n.camera.near=-Bp[2],n.camera.far=-Vp[2],this.warp?this._constructTrapezoidalProjection(r,s,n):this._constructOrthogonalProjection(n),jr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureSize/2;n.camera.viewport[0]=t%2==0?0:h,n.camera.viewport[1]=Math.floor(t/2)===0?0:h,n.camera.viewport[2]=h,n.camera.viewport[3]=h}_constructOrthogonalProjection(t){TX(t.camera.projectionMatrix,Vp[0],Bp[0],Vp[1],Bp[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,i,r){const s=1/Zl[0][3],n=1/Zl[4][3];pt(s<n);let o=s+Math.sqrt(s*n);const a=Math.sin(pn(t[2]*i[0]+t[6]*i[1]+t[10]*i[2]));o/=a,irt(Zl,o,a,xoe,Toe,trt,Soe,Eoe),rrt(xoe,Toe,Soe,Eoe,r.camera.projectionMatrix),r.camera.projectionMatrix[10]=2/(Vp[2]-Bp[2]),r.camera.projectionMatrix[14]=-(Vp[2]+Bp[2])/(Vp[2]-Bp[2])}_setupMatrices(t,i){jr(_oe,t.projectionMatrix,t.viewMatrix),vs(boe,_oe);const r=this.viewingMode===Ve.Global?t.eye:ne(aB,0,0,1);rk(Coe,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(t){let{near:i,far:r}=t;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(t,i){this.numCascades=Math.min(1+Math.floor(vXe(t/i,4)),this.maxNumCascades);const r=(t-i)/this.numCascades,s=(t/i)**(1/this.numCascades);let n=i,o=i;for(let a=0;a<this.numCascades+1;++a)this._cascadeDistances[a]=qt(n,o,this.splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var t,i;return this._snapshots.reduce((r,s)=>r+Fw(s),(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){t.splitSchemeLambda=i},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(i){t.warp=i},get warp(){return t.warp}}}}const voe=Ae(),_oe=Ae(),boe=Ae(),woe=Ht(),Zl=[];for(let e=0;e<8;++e)Zl.push(Ht());const Vp=R(),Bp=R(),xoe=st(),Toe=st(),trt=st(),Soe=st(),Eoe=st(),Coe=Ae(),aB=R(),lB=[],Aoe=Ae(),Moe=new Float32Array(64),zc=st(),Gx=st(),a1=[st(),st(),st(),st()],fn=st(),cB=st(),Ky=st(),rA=st(),jx=st(),Hx=st(),D$=st();function irt(e,t,i,r,s,n,o,a){di(zc,0,0);for(let C=0;C<4;++C)Wd(zc,zc,e[C]);dc(zc,zc,.25),di(Gx,0,0);for(let C=4;C<8;++C)Wd(Gx,Gx,e[C]);dc(Gx,Gx,.25),iS(a1[0],e[4],e[5],.5),iS(a1[1],e[5],e[6],.5),iS(a1[2],e[6],e[7],.5),iS(a1[3],e[7],e[4],.5);let l=0,c=y4(a1[0],zc);for(let C=1;C<4;++C){const A=y4(a1[C],zc);A<c&&(c=A,l=C)}zf(fn,a1[l],e[l+4]);const h=fn[0];let p,f;fn[0]=-fn[1],fn[1]=h,zf(cB,Gx,zc),en(cB,fn)<0&&vZ(fn,fn),iS(fn,fn,cB,i),RR(fn,fn),p=f=en(zf(Ky,e[0],zc),fn);for(let C=1;C<8;++C){const A=en(zf(Ky,e[C],zc),fn);A<p?p=A:A>f&&(f=A)}_o(r,zc),dc(Ky,fn,p-t),Wd(r,r,Ky);let m=-1,y=1,v=0,w=0;for(let C=0;C<8;++C){zf(rA,e[C],r),RR(rA,rA);const A=fn[0]*rA[1]-fn[1]*rA[0];A>0?A>m&&(m=A,v=C):A<y&&(y=A,w=C)}Ix(m>0,"leftArea"),Ix(y<0,"rightArea"),dc(jx,fn,p),Wd(jx,jx,zc),dc(Hx,fn,f),Wd(Hx,Hx,zc),D$[0]=-fn[1],D$[1]=fn[0];const b=JI(r,e[w],Hx,Wd(Ky,Hx,D$),1,s),S=JI(r,e[v],Hx,Ky,1,n),T=JI(r,e[v],jx,Wd(Ky,jx,D$),1,o),E=JI(r,e[w],jx,Ky,1,a);Ix(b,"rayRay"),Ix(S,"rayRay"),Ix(T,"rayRay"),Ix(E,"rayRay")}function ai(e,t){return 3*t+e}const Ooe=st();function kl(e,t){return di(Ooe,e[t],e[t+3]),Ooe}const Ja=st(),Ke=Pr();function rrt(e,t,i,r,s){zf(Ja,i,r),dc(Ja,Ja,.5),Ke[0]=Ja[0],Ke[1]=Ja[1],Ke[2]=0,Ke[3]=Ja[1],Ke[4]=-Ja[0],Ke[5]=0,Ke[6]=Ja[0]*Ja[0]+Ja[1]*Ja[1],Ke[7]=Ja[0]*Ja[1]-Ja[1]*Ja[0],Ke[8]=1,Ke[ai(0,2)]=-en(kl(Ke,0),e),Ke[ai(1,2)]=-en(kl(Ke,1),e);let n=en(kl(Ke,0),i)+Ke[ai(0,2)],o=en(kl(Ke,1),i)+Ke[ai(1,2)],a=en(kl(Ke,0),r)+Ke[ai(0,2)],l=en(kl(Ke,1),r)+Ke[ai(1,2)];n=-(n+a)/(o+l),Ke[ai(0,0)]+=Ke[ai(1,0)]*n,Ke[ai(0,1)]+=Ke[ai(1,1)]*n,Ke[ai(0,2)]+=Ke[ai(1,2)]*n,n=1/(en(kl(Ke,0),i)+Ke[ai(0,2)]),o=1/(en(kl(Ke,1),i)+Ke[ai(1,2)]),Ke[ai(0,0)]*=n,Ke[ai(0,1)]*=n,Ke[ai(0,2)]*=n,Ke[ai(1,0)]*=o,Ke[ai(1,1)]*=o,Ke[ai(1,2)]*=o,Ke[ai(2,0)]=Ke[ai(1,0)],Ke[ai(2,1)]=Ke[ai(1,1)],Ke[ai(2,2)]=Ke[ai(1,2)],Ke[ai(1,2)]+=1,n=en(kl(Ke,1),t)+Ke[ai(1,2)],o=en(kl(Ke,2),t)+Ke[ai(2,2)],a=en(kl(Ke,1),i)+Ke[ai(1,2)],l=en(kl(Ke,2),i)+Ke[ai(2,2)],n=-.5*(n/o+a/l),Ke[ai(1,0)]+=Ke[ai(2,0)]*n,Ke[ai(1,1)]+=Ke[ai(2,1)]*n,Ke[ai(1,2)]+=Ke[ai(2,2)]*n,n=en(kl(Ke,1),t)+Ke[ai(1,2)],o=en(kl(Ke,2),t)+Ke[ai(2,2)],a=-o/n,Ke[ai(1,0)]*=a,Ke[ai(1,1)]*=a,Ke[ai(1,2)]*=a,s[0]=Ke[0],s[1]=Ke[1],s[2]=0,s[3]=Ke[2],s[4]=Ke[3],s[5]=Ke[4],s[6]=0,s[7]=Ke[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Ke[6],s[13]=Ke[7],s[14]=0,s[15]=Ke[8]}class eTe{constructor(){this.adds=new Gt,this.removes=new Gt,this.updates=new Gt({allocator:t=>t||new srt,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class srt{}class nrt{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var ei;(function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"})(ei||(ei={}));function tTe(e){const t=new Map,i=r=>{let s=t.get(r);return s||(s=new nrt,t.set(r,s)),s};return e.removes.forAll(r=>{uB(r)&&i(r.material).removes.push(r)}),e.adds.forAll(r=>{uB(r)&&i(r.material).adds.push(r)}),e.updates.forAll(r=>{uB(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),t}function uB(e){return e.data.indexCount>=1}function ort(e){const t=x`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function TU(e,t){t.normalType===Rr.Attribute&&(e.attributes.add(O.NORMAL,"vec3"),e.vertex.code.add(x`vec3 normalModel() {
return normal;
}`)),t.normalType===Rr.CompressedAttribute&&(e.include(ort),e.attributes.add(O.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(x`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===Rr.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var Rr;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(Rr||(Rr={}));function SU(e){e.attributes.add(O.POSITION,"vec3"),e.vertex.code.add(x`vec3 positionModel() { return position; }`)}function Y4({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(x`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(x`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function b3(e){return!!he("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function h2(e,t){e.include(SU);const i=e.vertex;i.include(Y4,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new xt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new xt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new p3("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Er("transformProjFromView",r=>r.transformProjFromView),new LR("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Va("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Va("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(x`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(x`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?x`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:x`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new xt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class iTe extends Ys{constructor(){super(...arguments),this.transformWorldFromViewTH=R(),this.transformWorldFromViewTL=R(),this.transformViewFromCameraRelativeRS=Pr(),this.transformProjFromView=Ae()}}class rTe extends Ys{constructor(){super(...arguments),this.transformWorldFromModelRS=Pr(),this.transformWorldFromModelTH=Ci(),this.transformWorldFromModelTL=Ci()}}function EU(e,t){t.normalType===Rr.Attribute||t.normalType===Rr.CompressedAttribute?(e.include(TU,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new LR("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new p3("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),e.vertex.code.add(x`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===Rr.Ground?(e.include(h2,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(x`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?x`normalize(vPositionWorldCameraRelative);`:x`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(x`void forwardNormal() {}`)}class sTe extends iTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Pr()}}class nTe extends rTe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Pr(),this.toMapSpace=Ht()}}class GH extends nTe{constructor(t=R()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function w3(e,t){t.output===K.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(x`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===K.Depth||t.output===K.Shadow?(e.include(h2,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new pi("nearFar",(i,r)=>r.camera.nearFar)),e.vertex.code.add(x`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(x`void forwardLinearDepth() {}`)}function zv(e,t){t.spherical?e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class x3 extends Jr{constructor(t,i){super(t,"int",Ui.Pass,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}class oTe extends Jr{constructor(t,i,r,s){switch(i){case Ui.Pass:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s);case Ui.Draw:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s)}}}class aTe extends Ys{constructor(){super(...arguments),this.origin=R()}}function CU(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new oTe("shadowMapMatrix",Ui.Pass,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),lTe(e))}function Yw(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new oTe("shadowMapMatrix",Ui.Draw,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),lTe(e))}function lTe(e){const t=e.fragment;t.include($c),t.uniforms.add([new Vt("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new x3("numCascades",(i,r)=>r.shadowMap.numCascades),new ri("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances),new Xe("depthHalfPixelSz",(i,r)=>.5/r.shadowMap.textureSize)]),t.code.add(x`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function art(e){e.fragment.code.add(x`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function lrt(e){e.fragment.code.add(x`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function crt(e){const t=e.fragment.code;t.add(x`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(x`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(x`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function AU(e,t){const i=e.fragment.code;e.include(Gk),t.pbrMode===Ot.Water||t.pbrMode===Ot.WaterOnIntegratedMesh?(i.add(x`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(x`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(x`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(x`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(x`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||(e.include(crt),i.add(x`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(x`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(x`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(x`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(x`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(x`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function cTe(e,t){e.include(AU,t),e.include(Vk),e.include(lrt),t.hasCloudsReflections&&e.include(V1e,t),t.hasScreenSpaceReflections&&e.include(HWe,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(x`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new Xe("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Xe("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(x`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?i.code.add(x`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(x`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(x`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor;
}`)}function Roe(e){e.fragment.uniforms.add(new Vr("texWaveNormal")),e.fragment.uniforms.add(new Vr("texWavePerturbation")),e.fragment.uniforms.add([new ri("waveParams",t=>Ji(urt,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new pi("waveDirection",t=>di(hrt,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(art),e.fragment.code.add(x`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const urt=Ht(),hrt=st();function drt(e){const t=new qi,{vertex:i,fragment:r}=t,s=Ru(t,e);return t.include(Uo),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),i.uniforms.add(new ri("waterColor",n=>n.color)),e.output!==K.Color&&e.output!==K.Alpha||(t.include(zv,e),t.include(w3,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),r.uniforms.add(s),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Vo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===K.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(Vu,e),e.output===K.Alpha&&(t.include(ys,e),r.uniforms.add(new Ua("waterColor")),r.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===K.Color&&(t.include(IZ,{isGround:!1}),t.include(PZ,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(Roe),t.include(ys,e),t.include(Yw,e),t.include(cTe,e),r.uniforms.add([new Ua("waterColor"),new xt("lightingMainDirection",(n,o)=>o.lighting.lightingMainDirection),new xt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity),new Xe("timeElapsed",n=>n.timeElapsed),new u_("view")]),mm(r,e),r.include(Mm),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?x`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===vt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===K.Normal&&(t.include(zv,e),t.include(Roe,e),t.include(ys,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Vo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Xe("timeElapsed",n=>n.timeElapsed)),r.code.add(x`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===K.Draped&&(t.varyings.add("vpos","vec3"),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Vo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Ua("waterColor")),r.code.add(x`void main() {
gl_FragColor = waterColor;
}`)),e.output===K.Highlight&&(t.include(Iy),t.varyings.add("vpos","vec3"),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Vo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(ys,e),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const prt=Object.freeze(Object.defineProperty({__proto__:null,build:drt},Symbol.toStringTag,{value:"Module"}));class MU extends fr{constructor(t,i,r){super(t,i,r),this._textureRepository=t.waterTextureRepository}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global,i.doublePrecisionRequiresObfuscation=b3(t.rctx)}initializeProgram(t){const i=MU.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}bindPass(t,i){this.program.bindPass(t,i),this.configuration.output!==K.Color&&this.configuration.output!==K.Normal||this._textureRepository.bind(this.program)}_setPipelineState(t){const i=this.configuration,r=t===vt.NONE,s=t===vt.FrontFace;return Ut({blending:i.output!==K.Normal&&i.output!==K.Highlight&&i.transparent?r?Pu:$y(t):null,depthTest:{func:D_(t)},depthWrite:r?i.writeDepth&&Il:hU(t),colorWrite:ti,polygonOffset:r||s?null:fU(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}MU.shader=new sr(prt,()=>import("./WaterSurface.glsl.fc2b3bfb.js"));class eo extends la{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=vt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],eo.prototype,"output",void 0),u([j({count:vt.COUNT})],eo.prototype,"transparencyPassType",void 0),u([j()],eo.prototype,"spherical",void 0),u([j()],eo.prototype,"receiveShadows",void 0),u([j()],eo.prototype,"hasSlicePlane",void 0),u([j()],eo.prototype,"transparent",void 0),u([j()],eo.prototype,"enableOffset",void 0),u([j()],eo.prototype,"writeDepth",void 0),u([j()],eo.prototype,"hasScreenSpaceReflections",void 0),u([j()],eo.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],eo.prototype,"hasCloudsReflections",void 0),u([j()],eo.prototype,"isDraped",void 0),u([j()],eo.prototype,"hasMultipassTerrain",void 0),u([j()],eo.prototype,"cullAboveGround",void 0),u([j({constValue:Ot.Water})],eo.prototype,"pbrMode",void 0),u([j({constValue:!0})],eo.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!0})],eo.prototype,"highStepCount",void 0),u([j({constValue:!1})],eo.prototype,"useFillLights",void 0);class Poe extends I_{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const i=_(t.clouds.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(t){const i=this._techniqueRepository.constructionContext.waterTextureRepository;return i.resourceState===ac.NOT_LOADED&&i.loadTextures(t),i.resourceState}beginSlot(t){return this._output===K.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this.ensureTechnique(MU,t)}}const frt=ls().vec3f(O.POSITION),mrt=ls().vec3f(O.POSITION).vec2f(O.UV0),uTe=ls().vec3f(O.POSITION).vec4u8(O.COLOR);class OU{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,i,r,s){cU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}class hTe extends Rm{constructor(t){super(t,new dTe),this._techniqueConfig=new eo,this.animation=new ube}getConfiguration(t,i){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=i.transparencyPassType,this._techniqueConfig.enableOffset=i.camera.relativeElevation<dU,this._techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<grt;const r=this.animation.advance(t);return this.setParameters({timeElapsed:lW(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}intersect(t,i,r,s,n,o,a){aU(t,i,s,n,o,void 0,a)}requiresSlot(t,i){switch(Xw(i)){case K.Normal:return t===Ee.DRAPED_WATER;case K.Color:if(this.parameters.isDraped)return t===Ee.DRAPED_MATERIAL;break;case K.Highlight:return t===Ee.OPAQUE_MATERIAL||t===Ee.DRAPED_MATERIAL}let r=Ee.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===r}createGLMaterial(t){if(t.output===K.Color&&this.parameters.isDraped)return t.output=K.Draped,new Poe(t);switch(t.output){case K.Color:case K.Normal:case K.Highlight:case K.Alpha:return new Poe(t)}return null}createBufferWriter(){return new OU(mrt)}}class dTe extends mC{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Ni(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=mi(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const grt=35e3;class Ioe{constructor(t){this.first=t.from,this.count=t.to-t.from}}class sS{constructor(t=0,i=0){this.from=t,this.to=i}}class yrt extends sS{constructor(t,i,r,s,n,o){super(i,r),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=o}}function $oe(e){return Array.from(e.values()).sort(vrt)}function vrt(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function L$(e,t){if(e.length===0)return void e.push(new Ioe(t));const i=e[e.length-1];if(_rt(i,t)){const r=t.from-i.first+t.to-t.from;i.count=r}else e.push(new Ioe(t))}function _rt(e,t){return e.first+e.count>=t.from}class brt{constructor(t,i){this._pool=t,this._size=0,this._buffer=t.newBuffer(jH(i))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,i){let r;const s=wrt(this._buffer.length,this._size,t);if(this._buffer.length!==s){const o=this._pool.newBuffer(s);i&&(o.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),o.vao.vertexBuffers.geometry.setSubData(o.array,0,0,o.array.byteLength)),r=this._buffer,this._buffer=o}const n=this._size;return this._size=t,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(o,a,l)=>this._buffer.array.set(r.array.subarray(a,l),o),hasNewBuffer:!0}:{dispose:()=>{},copy:(o,a,l)=>{o!==a&&this._buffer.array.copyWithin(o,a,l)},hasNewBuffer:!1}}erase(t,i){this._buffer.array.fill(0,t,i)}}const Doe=65536;function jH(e){return Math.ceil(e/Doe)*Doe}function wrt(e,t,i){return t<=i?e>=i?e:jH(Math.max(2*e,i)):e<=2*i?e:jH(i)}class xrt{constructor(t,i,r,s){this.vao=new qs(t,i,{geometry:r},{geometry:si.createVertex(t,_i.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const Trt=RL+1;class Srt{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${Tl()}`,Ert)}dispose(){this._cache.destroy()}newBuffer(t){const i=t.toString(),r=this._cache.pop(i);if(_(r)){const s=r.pop();return r.length>0&&this._cache.put(i,r,s.array.byteLength*r.length,Trt),s}return new xrt(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const i=t.array.byteLength,r=t.array.length.toString(),s=this._cache.pop(r);return _(s)?(s.push(t),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[t],i,-1),null}}function Ert(e,t){if(t===Ig.ALL)return void e.forEach(s=>s.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}class pTe{constructor(t,i,r){this._rctx=t,this._materialRepository=i,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new Gt,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Hxe(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new Srt(t,r.vertexAttributeLocations,Dc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof hTe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==Fr.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,i){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,o=Art(t,i);o.forEach((a,l)=>{o.delete(l);const c=a.toAdd.reduce((b,S)=>b+r.elementCount(S.data),0);let h=n.get(l);if(h==null)pt(a.toRemove.length===0),h=new Ort(a.origin,new brt(this._bufferPool,c*s)),n.set(l,h);else if(a.toAdd.length===0&&h.instances.size===a.toRemove.length)return h.buffer.dispose(),void n.delete(l);let p=0;h.instances.forEach(b=>p+=b.to-b.from);const f=a.toRemove.reduce((b,S)=>b+r.elementCount(S.data),0),m=h.buffer.size,y=(p+c-f)*s,v=Prt;if(y<m/2?this._removeAndRebuild(h,a.toRemove,s,y,v):a.toRemove.length>0&&this._remove(h,a.toRemove,s,v),a.toAdd.length>0){const b=Irt;nbe(b,-a.origin[0],-a.origin[1],-a.origin[2]),this._add(h,a.toAdd,s,b,v)}const w=h.buffer.vao.vertexBuffers.geometry;Foe(v),v.forAll(({from:b,to:S})=>{if(b<S){const T=h.buffer.array,E=4,C=b*E,A=S*E;w.setSubData(T,C,C,A)}}),v.clear(),h.drawCommandsDirty=!0})}_updateGeometries(t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.origin.id),a=o&&o.instances.get(n.id);if(!a)return;const l=s.updateType;if(l&ei.State.VISIBILITIES&&(a.isVisible=n.instanceParameters.visible),l&(ei.State.HIGHLIGHTS|ei.State.VISIBILITIES)){const c=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&c}if(l&ei.State.OCCLUDEES&&(a.hasOccludees=!!n.instanceParameters.occludees),l&(ei.State.VERTEXATTRS|ei.State.TRANSFORMATION)){const{array:c,vao:h}=o.buffer;HYe(n,hB,sA),i.write({transformation:hB,invTranspTransformation:sA},n.data,i.vertexBufferLayout.createView(c.buffer),a.from),pt(a.from+i.elementCount(n.data)===a.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(c,a.from*r*4,a.from*r*4,a.to*r*4)}o.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(i=>{i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,on(i.instances,r=>(r.isVisible?(r.hasHighlights&&(this._hasHighlights=!0,i.hasHighlights=!0),r.hasOccludees&&(this._hasOccludees=!0,i.hasOccludees=!0)):i.hasHiddenInstances=!0,i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees))});const t=i=>{if(i.drawCommandsDefault=null,i.drawCommandsHighlight=null,i.drawCommandsOccludees=null,i.drawCommandsShadowHighlightRest=null,i.instances.size===0)return;if(!Noe(i)){const s=this._bufferWriter.vertexBufferLayout.stride,n=4*i.buffer.size/s;return void(i.drawCommandsDefault=[{first:0,count:n}])}const r=$oe(i.instances);i.drawCommandsDefault=[],i.drawCommandsHighlight=[],i.drawCommandsOccludees=[],i.drawCommandsShadowHighlightRest=[];for(const s of r)s.isVisible&&(s.hasOccludees?L$(i.drawCommandsOccludees,s):L$(i.drawCommandsDefault,s),s.hasHighlights?L$(i.drawCommandsHighlight,s):L$(i.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(i=>{i.drawCommandsDirty&&(t(i),i.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,i){return t==null||this._material.requiresSlot(t,i)}render(t,i){if(!this.requiresSlot(i.slot,t))return!1;const r=t===je.MATERIAL_HIGHLIGHT||t===je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(r&&!this._hasHighlights)return!1;const s=t===je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(r||s);if(this._dataByOrigin.forEach(c=>{if(r&&!c.hasHighlights)return;const h=(r?c.drawCommandsHighlight:s&&Noe(c)?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,p=n&&c.drawCommandsOccludees||null;(_(h)||_(p))&&this._renderCommandData.push(new Rrt(c.origin,c.buffer,h,p))}),this._renderCommandData.length===0)return!1;const o=this._rctx,a=this._glMaterials.load(o,t);if(M(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(i);return o.bindTechnique(l,this._material.parameters,i,!1),this._renderCommandData.forAll(c=>{l.bindDraw(c,i);const{buffer:h,renderCommands:p,occludeeCommands:f}=c;l.ensureAttributeLocations(h.vao),o.bindVAO(h.vao);const m=l.primitiveType;_(p)&&this._renderCommands(o,m,p),_(f)&&(l.bindPipelineState(o,i.slot,!0),this._renderCommands(o,m,f),l.bindPipelineState(o,i.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,i,r){for(let s=0;s<r.length;s++)t.drawArrays(i,r[s].first,r[s].count)}_removeAndRebuild(t,i,r,s,n){for(const h of i)t.instances.delete(h.id);const o=$oe(t.instances);t.instances.clear();const a=t.buffer.size,l=t.buffer.alloc(s);let c=0;for(const h of o){const p=h.from*r,f=h.to*r;l.copy(c,p,f),h.from=c/r,c+=f-p,h.to=c/r,t.instances.set(h.id,h)}n.push(new sS(0,l.hasNewBuffer?t.buffer.array.length:a)),l.dispose(),t.buffer.erase(c,n.back().to),t.holes.clear()}_remove(t,i,r,s){for(const n of i){const o=n.id,a=t.instances.get(o),l=a.from*r,c=a.to*r;t.buffer.erase(l,c),t.holes.push(new sS(a.from,a.to)),t.instances.delete(o),s.push(new sS(l,c))}Foe(t.holes)}_add(t,i,r,s,n){if(i.length===0)return;const o=this._bufferWriter;let a=o.vertexBufferLayout.createView(t.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const p of i){const f=_(p.transformation)?jr(hB,s,p.transformation):s;vs(sA,f);const m=Pl(sA,sA),y=o.elementCount(p.data),v=y*r;let w=Mrt(t.holes,y);M(w)&&(w=t.buffer.size/r,t.buffer.grow(v),a=o.vertexBufferLayout.createView(t.buffer.array.buffer)),o.write({transformation:f,invTranspTransformation:m},p.data,a,w);const b=p.instanceParameters.visible,S=!!p.instanceParameters.highlights&&b,T=!!p.instanceParameters.occludees,E=new yrt(p.id,w,w+y,b,S,T);pt(t.instances.get(p.id)==null),t.instances.set(p.id,E),l?n.push(new sS(E.from*r,E.to*r)):(c=Math.min(E.from,c),h=Math.max(E.to,h))}l||n.push(new sS(c*r,h*r))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Crt{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function Art(e,t){const i=new Map;for(const r of e)Loe(i,r,!0);for(const r of t)Loe(i,r,!1);return i}function Loe(e,t,i){const r=t.origin;if(M(r))return;let s=e.get(r.id);s==null&&(s=new Crt(r.vec3),e.set(r.id,s)),i?s.toAdd.push(t):s.toRemove.push(t)}function Noe(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function Mrt(e,t){let i;if(!e.some(s=>!(s.to-s.from<t)&&(i=s,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function Foe(e){const t=new Map;e.forAll(r=>t.set(r.from,r));let i=!0;for(;i;)i=!1,e.forEach(r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)})}class Ort{constructor(t,i){this.origin=t,this.buffer=i,this.instances=new Map,this.holes=new Gt({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class Rrt extends GH{constructor(t,i,r,s){super(t),this.buffer=i,this.renderCommands=r,this.occludeeCommands=s}}const Prt=new Gt({deallocator:null}),Irt=Ae(),hB=Ae(),sA=Ae();let Of=class extends Se{constructor(e){super(e),this._pending=new $rt,this._changes=new eTe,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Gt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return on(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=tTe(this._changes);let t=!1,i=!1,r=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new pTe(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,i=!0,r=!0),!o)return;const a=i||o.hasHighlights,l=r||o.hasWater;o.modify(s),i=i||a!==o.hasHighlights,r=r||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=on(this._materialRenderers,s=>s.hasHighlights)),r&&(this._hasWater=on(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const r=this._pending.empty;for(const s of i)this._pending.adds.add(s);r&&this.notifyChange("updating"),t===ei.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const s of e)r.has(s)?(this._pending.removed.add(s),r.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===ei.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=this._changes.updates.length===0;for(const r of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(r),s.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case ei.State.TRANSFORMATION:case ei.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case ei.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,s){return this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,i)=>{const r=i.material.renderPriority-t.material.renderPriority;return r!==0?r:t.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.instanceParameters.visible)return;let o=0;_(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),N$[0]=i[0]-r,N$[1]=i[1]-o,N$[2]=1,F$[0]=i[0]-r,F$[1]=i[1]-o,F$[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,N$,F$,(a,l,c)=>{Drt(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(M(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}}_notifyGraphicVisibilityChanged(e){if(M(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return M(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],Of.prototype,"drapeSource",void 0),u([d()],Of.prototype,"updating",null),u([d()],Of.prototype,"rctx",null),u([d()],Of.prototype,"rendererContext",void 0),u([d()],Of.prototype,"_materialRepository",null),u([d()],Of.prototype,"_localOriginFactory",null),Of=u([P("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Of);class $rt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function Drt(e,t,i,r,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=c=>{c.set(Br.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==yo.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===yo.ALL){const c=YZ(s.ray);l(c),s.results.all.push(c)}}const N$=R(),F$=R();function RU(e){e.fragment.uniforms.add(new ri("projInfo",(t,i)=>Lrt(i))),e.fragment.uniforms.add(new pi("zScale",(t,i)=>fTe(i))),e.fragment.code.add(x`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Lrt(e){const t=e.camera.projectionMatrix;return t[11]===0?Ji(koe,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):Ji(koe,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const koe=Ht();function fTe(e){return e.camera.projectionMatrix[11]===0?di(Uoe,0,1):di(Uoe,1,0)}const Uoe=st();var S_;(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(S_||(S_={}));class mTe extends Ha{constructor(){super(...arguments),this.output=S_.SSAO}}u([j({count:S_.COUNT})],mTe.prototype,"output",void 0);const nA={samples:16,filterRadius:4};function Nrt(e){const t=new qi,i=t.fragment;if(t.include($_),e.output===S_.Blur){const r=(nA.filterRadius+1)/2,s=1/(2*r*r);i.include(zu),i.uniforms.add([new Vr("normalMap"),new Vr("depthMap"),new Vr("tex"),new Zg("blurSize"),new Fi("projScale"),new pi("nearFar",(n,o)=>o.camera.nearFar)]),i.code.add(x`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${x.float(s)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(x`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${x.int(nA.filterRadius)}; r <= ${x.int(nA.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===S_.SSAO&&(i.include(zu),t.include(RU),i.uniforms.add(new Vr("normalMap")),i.uniforms.add(new Vr("depthMap")),i.uniforms.add(new Vr("rnm")),i.uniforms.add(new Fi("intensity")),i.uniforms.add(new Fi("projScale")),i.uniforms.add(new Fi("radius")),i.uniforms.add(new pi("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new Zg("screenSize")),i.uniforms.add(new Zg("rnmScale")),i.code.add(x`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(x`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new pi("zScale",(r,s)=>fTe(s))),i.code.add(x`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${x.int(nA.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${x.int(nA.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const Frt=Object.freeze(Object.defineProperty({__proto__:null,build:Nrt},Symbol.toStringTag,{value:"Module"}));class oP extends fr{initializeProgram(t){const i=oP.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({colorWrite:ti})}}oP.shader=new sr(Frt,()=>import("./SSAO.glsl.8c63f3a9.js"));class gTe{constructor(t,i,r){this._techniqueRep=t,this._rctx=i,this._requestRender=r,this._enabled=!1,this._ssaoTechniqueConfig=new mTe,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Qe(this.quadVAO)}disposeOffscreenBuffers(){Qi(this._ssaoFBO,t=>t.resize(0,0)),Qi(this._blur0FBO,t=>t.resize(0,0)),Qi(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&_(this._noiseTexture)&&_(this._ssaoFBO)&&_(this._blur0FBO)&&_(this._blur1FBO)}get colorTexture(){return _(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return _(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return _(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,i,r){if(!this.enabled||M(i)||M(r)||M(this._noiseTexture)||M(this._ssaoFBO)||M(this._blur0FBO)||M(this._blur1FBO))return;const s=this._rctx,n=t.camera,o=n.fullViewport,a=o[2],l=o[3],c=a/this._blurSizePx,h=l/this._blurSizePx;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);const p=1,f=1,m=a*p,y=l*f;s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l);const v=s.bindTechnique(this._ssaoTechnique,zoe,t);v.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);let w=1/n.computeRenderPixelSizeAtDist(1);v.setUniform1f("projScale",w*p),v.setUniform2f("screenSize",m,y);const b=hr(n.eye,n.center);let S=20*n.computeRenderPixelSizeAtDist(b);S=Math.max(.1,S),v.setUniform1f("radius",S),v.setUniform1f("intensity",4*this._attenuation/S**6),v.bindTexture("rnm",this._noiseTexture),v.bindTexture("normalMap",r),v.bindTexture("depthMap",i),M(this.quadVAO)&&(this.quadVAO=qa(this._rctx)),s.bindVAO(this.quadVAO),s.drawArrays(It.TRIANGLE_STRIP,0,ko(this.quadVAO,"geometry"));const T=s.bindTechnique(this._blurTechnique,zoe,t);T.bindTexture("tex",this._ssaoFBO.colorTexture),T.bindTexture("normalMap",r),T.bindTexture("depthMap",i),s.setViewport(0,0,m/this._blurSizePx,y/this._blurSizePx),s.bindFramebuffer(this._blur0FBO),T.setUniform2f("screenSize",m,y),T.setUniform2f("blurSize",0,this._blurSizePx*p/y),b>5e4&&(w=Math.max(0,w-(b-5e4))),T.setUniform1f("projScale",w),s.drawArrays(It.TRIANGLE_STRIP,0,ko(this.quadVAO,"geometry")),T.setUniform2f("blurSize",this._blurSizePx*f/m,0),s.bindFramebuffer(this._blur1FBO),T.bindTexture("tex",this._blur0FBO.colorTexture),s.drawArrays(It.TRIANGLE_STRIP,0,ko(this.quadVAO,"geometry")),s.setViewport(o[0],o[1],o[2],o[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=S_.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(oP,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=S_.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(oP,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():import("./SSAOHelperData.08f44d75.js").then(i=>{this._data=i,t()})}_initialize(){const t={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE};Cp(this._data.noiseTexture).then(r=>{this._enabled&&(this._ssaoFBO=new Or(this._rctx,i,t),this._blur0FBO=new Or(this._rctx,i,t),this._blur1FBO=new Or(this._rctx,i,t),this._noiseTexture=new ot(this._rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,hasMipmap:!0,width:r.width,height:r.height},r),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Qe(this._noiseTexture),this._blur1FBO=Qe(this._blur1FBO),this._blur0FBO=Qe(this._blur0FBO),this._ssaoFBO=Qe(this._ssaoFBO)}get gpuMemoryUsage(){return(_(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(_(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(_(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const zoe=new Ys;function krt(){const e=new qi;return e.include($_),e.fragment.uniforms.add([new Vr("tex"),new Ua("uColor")]),e.fragment.code.add(x`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const Urt=Object.freeze(Object.defineProperty({__proto__:null,build:krt},Symbol.toStringTag,{value:"Module"}));class T3 extends fr{initializeProgram(t){const i=T3.shader.get().build();return new nr(t.rctx,i,zi)}initializePipeline(){return this.configuration.hasAlpha?Ut({blending:bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),colorWrite:ti}):Ut({colorWrite:ti})}}T3.shader=new sr(Urt,()=>import("./TextureOnly.glsl.9f928b71.js"));class VQ extends Ha{constructor(){super(...arguments),this.hasAlpha=!1}}u([j()],VQ.prototype,"hasAlpha",void 0);class yTe{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=Qe(t.texture)),this.cache.clear()}_acquire(t){if(M(t))return null;const i=this._patternId(t),r=this.cache.get(i);if(r)return r.refCount++,r.bind;const s=t.pixelRatio,{encodedData:n,sdfNormalizer:o,pixels:a,paddedPixels:l}=zrt(t.pattern,s),c=a/s,h={refCount:1,texture:null,bind:p=>(M(h.texture)&&(h.texture=new ot(this._rctx,{width:l,height:1,internalFormat:ze.RGBA,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE},n)),p.bindTexture("stipplePatternTexture",h.texture),{pixelSize:c,sdfNormalizer:o,pixels:a})};return this.cache.set(i,h),h.bind}release(t){if(M(t))return;const i=this._patternId(t),r=this.cache.get(i);r&&(r.refCount--,r.refCount===0&&(_(r.texture)&&r.texture.dispose(),this.cache.delete(i)))}swap(t,i){const r=this._acquire(i);return this.release(t),r}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function zrt(e,t){const i=e.map(y=>Math.round(y*t)),r=1/t,s=Math.floor(i.reduce((y,v)=>y+v)),n=i.reduce((y,v)=>Math.max(y,v)),o=(Math.floor(.5*(n-1))+.5)*r,a=[];let l=1;for(const y of i){for(let v=0;v<y;v++){const w=l*(Math.min(v,y-1-v)+.5)*r/o*.5+.5;a.push(w)}l=-l}const c=Math.round(i[0]/2),h=[...a.slice(c),...a.slice(0,c)],p=s+2,f=new Uint8Array(4*p);let m=4;for(const y of h)tP(y,f,m),m+=4;return f.copyWithin(0,m-4,m),f.copyWithin(m,4,8),{encodedData:f,sdfNormalizer:o,paddedPixels:p,pixels:s}}var pc,No;(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(pc||(pc={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(No||(No={}));class TN extends Ha{constructor(){super(...arguments),this.function=pc.Standard,this.alphaMode=No.None,this.hasOpacityFactor=!1}}u([j({count:pc.COUNT})],TN.prototype,"function",void 0),u([j({count:No.COUNT})],TN.prototype,"alphaMode",void 0),u([j()],TN.prototype,"hasOpacityFactor",void 0);let Nd=class extends bU(Se){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new jt,this._frameTask=rE,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new Gt,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new as,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new yTe(e.renderingContext),this._shaderTechniqueRepository=new zxe({rctx:this._rctx,viewingMode:Ve.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new Kxe(this._rctx,new zQ(this._rctx,this.view.state.viewingMode),new gTe(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([se(()=>t.updating,()=>this.events.emit("content-changed"),wr),se(()=>this.spatialReference,i=>this._localOriginFactory=new UQ(i),wr),En(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new Vxe(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&Z4)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ee.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=M1e(this._rctx),this._bindParameters.camera=Zb,this._bindParameters.transparencyPassType=vt.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new UZ(Fe(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=er(this._debugTextureTechnique),this._debugPatternTexture=Qe(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Qe(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Qe(this._shaderTechniqueRepository),this._temporaryFBO=Qe(this._temporaryFBO),this._quadVAO=Qe(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||on(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return _(this._overlays)&&_(this._overlayRenderTarget)}get gpuMemoryUsage(){return _(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Of)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);_(r)&&r.destroy();const s=new t(me(F({},i),{rendererContext:this,drapeSource:e}));return this._drapeSourceRenderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(se(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(M(e))return;const t=this._drapeSourceRenderers.get(e);M(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(_(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return ft(this._overlays,[])}ensureDrapeTargets(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=JD(e,i=>i.drapeTargetType===zH.WithoutRasterImage)})}ensureDrapeSources(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=JD(e,i=>i.drapeSourceType===DO.Features),t.hasDrapedRasterSource=JD(e,i=>i.drapeSourceType===DO.RasterImage)})}ensureOverlays(e,t){M(this._overlays)&&(this._overlayRenderTarget=new Tit(this._rctx),this._overlays=[new aoe(Ur.INNER,this._overlayRenderTarget),new aoe(Ur.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Qe(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&(_(this._overlays)&&this._drapeSourceRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(lC,e=>e.updatePolicy===lE.SYNC)}isEmpty(){if(ji.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(r.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===je.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===je.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;Zb.pixelRatio=e.pixelRatio*i,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===je.MATERIAL_NORMAL?Ee.DRAPED_WATER:Ee.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===Ur.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(tr.COLOR_BUFFER_BIT));const c=t.type===xs.ColorNoRasterImage?hv.ExcludeRasterImage:t.type===xs.Occluded?hv.OccludedOnly:hv.Normal;if(c===hv.OccludedOnly&&(this._renderContext.renderOccludedMask=Z4),ji.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==hv.OccludedOnly)for(let h=0;h<r.numViews;h++)this._setViewParameters(r.extents[h],e,Zb),this._drawDebugTexture(e.resolution,Brt[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:h,renderer:p})=>{if(c===hv.ExcludeRasterImage&&h.drapeSourceType===DO.RasterImage)return;const{fullOpacity:f}=h,m=_(f)&&f<1&&s===je.MATERIAL;m&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(tr.COLOR_BUFFER_BIT));for(let y=0;y<r.numViews;y++)this._setViewParameters(r.extents[y],e,Zb),p.render(this._renderContext,this._bindParameters);m&&_(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),No.PremultipliedAlpha,f,pc.OverlayWithTransparency,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){M(this._temporaryFBO)&&(this._temporaryFBO=new Uxe(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){var n,o;let s=0;for(const a of this._drapeSourceRenderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,i,r,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),this._drapeSourceRenderers.size===0))return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new Vrt(i,t,r<0?1/0:r))}),this._sortedDrapeSourceRenderers.sort((t,i)=>t.index-i.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,TX(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),ik(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=on(this._drapeSourceRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=on(this._drapeSourceRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=on(this._drapeSourceRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays(It.TRIANGLE_STRIP,0,ko(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let o=0;o<e;o++){const a=Math.floor(o/10),l=Math.floor(n/10);a<2||l<2||10*a>e-20||10*l>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&a&&1&l?1&o^1&n?0:255:1&a^1&l?0:128)}this._debugPatternTexture=new ot(this._rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:e,height:t},i);const s=new VQ;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(T3,s),this._quadVAO=qa(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var hv;u([d()],Nd.prototype,"_frameTask",void 0),u([d()],Nd.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([Io()],Nd.prototype,"_shaderTechniqueRepository",void 0),u([Io()],Nd.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],Nd.prototype,"view",void 0),u([d()],Nd.prototype,"worldToPCSRatio",void 0),u([d()],Nd.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],Nd.prototype,"updating",null),Nd=u([P("esri.views.3d.terrain.OverlayRenderer")],Nd),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(hv||(hv={}));class Vrt{constructor(t,i,r){this.drapeSource=t,this.renderer=i,this.index=r}}const Brt=[[1,.5,.5],[.5,.5,1]],Zb=new ir;Zb.near=1,Zb.far=1e4,Zb.relativeElevation=null;const BQ=-2,Z4=Fr.OccludeAndTransparent;function Voe(e){const t=[[O.POSITION,e.indices]],i=[[O.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return _(e.attributeData.color)&&(i.push([O.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([O.COLOR,new Uint32Array(e.indices.length)])),_(e.attributeData.uvMapSpace)&&(i.push([O.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([O.UVMAPSPACE,e.indices])),_(e.attributeData.boundingRect)&&(i.push([O.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([O.BOUNDINGRECT,e.indices])),_(e.attributeData.mapPosition)&&(i.push([O.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([O.MAPPOS,e.indices])),new kr(i,t)}function Boe(e){const t=[[O.POSITION,e.indices],[O.UV0,e.indices]],i=[[O.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[O.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return _(e.attributeData.mapPosition)&&(i.push([O.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([O.MAPPOS,e.indices])),new kr(i,t)}function aP(e){switch(e.type){case"extent":if(e instanceof ui)return $u.fromExtent(e);break;case"polygon":return e}return null}function GQ(e,t,i,r){const s=_3(e.rings,e.hasZ,gm.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=Txe(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),a=o!=null;return{position:s.position,mapPosition:n,polygons:bTe(s.polygons,s.position,n),outlines:_Te(s.outlines,s.position,n),projectionSuccess:a,sampledElevation:o}}function vTe(e,t){const i=_3(e.rings,!1,gm.CCW_IS_HOLE),r=pr(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=BQ;return{position:i.position,polygons:bTe(i.polygons,i.position),outlines:_Te(i.outlines,i.position),projectionSuccess:r}}function _Te(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({index:s,count:n,position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function bTe(e,t,i){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=l+3*n,h=o.map(p=>p-s);r.push({index:s,count:n,holeIndices:h,pathLengths:a,position:t.subarray(l,c),mapPosition:i?i.subarray(l,c):void 0})}return r}function wTe(e,t){const i=e.fragment;switch(i.code.add(x`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Gr.None:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Gr.View:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Gr.WindingOrder:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Gr.COUNT:}}var Gr;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Gr||(Gr={}));function xTe(e){e.vertex.code.add(x`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function TTe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(O.MODELORIGINHI,"vec3"),e.attributes.add(O.MODELORIGINLO,"vec3"),e.attributes.add(O.MODEL,"mat3"),e.attributes.add(O.MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include(Y4,t),i.uniforms.add(new Va("viewOriginHi",(r,s)=>GYe(ne(k$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),k$))),i.uniforms.add(new Va("viewOriginLo",(r,s)=>jYe(ne(k$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),k$)))),i.code.add(x`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(x`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?x`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(x`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===K.Normal&&(i.uniforms.add(new Er("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),i.code.add(x`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(x`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const k$=R();var Ss;function STe(e){switch(e){case"multiply":default:return Ss.Multiply;case"ignore":return Ss.Ignore;case"replace":return Ss.Replace;case"tint":return Ss.Tint}}function ETe(e,t,i){if(M(e)||t===Ss.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=De(Math.round(e[3]*Q4),0,Q4),s=r===0||t===Ss.Tint?0:t===Ss.Replace?Grt:jrt;i[0]=De(Math.round(e[0]*qx),0,qx),i[1]=De(Math.round(e[1]*qx),0,qx),i[2]=De(Math.round(e[2]*qx),0,qx),i[3]=r+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(Ss||(Ss={}));const qx=255,Q4=85,Grt=Q4,jrt=2*Q4;function CTe(e){e.vertex.code.add(x`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${x.int(Ss.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${x.int(Ss.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${x.int(Ss.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${x.int(Ss.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function ATe(e,t){t.hasSymbolColors?(e.include(CTe),e.attributes.add(O.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(x`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new x3("colorMixMode",i=>Fwe[i.colorMixMode])),e.vertex.code.add(x`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function _x(e,t){t.hasVertexColors?(e.attributes.add(O.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(x`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(x`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(x`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Hrt(e){e.fragment.code.add(x`
    #define discardOrAdjustAlpha(color) { if (color.a < ${x.float(Vo)}) { discard; } }
  `)}class MTe extends Jr{constructor(t,i){super(t,"float",Ui.Draw,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function fw(e,t){OTe(e,t,new Xe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function qrt(e,t){OTe(e,t,new MTe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function OTe(e,t,i){const r=e.fragment;switch(t.alphaDiscardMode!==ur.Mask&&t.alphaDiscardMode!==ur.MaskBlend||r.uniforms.add(i),t.alphaDiscardMode){case ur.Blend:return e.include(Hrt);case ur.Opaque:r.code.add(x`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case ur.Mask:r.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case ur.MaskBlend:e.fragment.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function RTe(e,t){const i=e.vertex.code,r=e.fragment.code,s=t.hasModelTransformation;t.output!==K.Depth&&t.output!==K.Shadow||(Ru(e,t),e.include(Uo,{linearDepth:!0,hasModelTransformation:s}),e.include(Yg,t),e.include(u2,t),e.include(L_,t),e.include(ys,t),e.vertex.uniforms.add(new pi("nearFar",(n,o)=>o.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new Vt("tex",n=>n.texture)),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(fw,t),r.add(x`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===K.Normal&&(Ru(e,t),e.include(Uo,{linearDepth:!1,hasModelTransformation:s}),e.include(TU,t),e.include(EU,t),e.include(Yg,t),e.include(u2,t),t.hasColorTexture&&e.fragment.uniforms.add(new Vt("tex",n=>n.texture)),e.varyings.add("vPositionView","vec3"),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===Rr.Attribute?x`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(ys,t),e.include(fw,t),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===Rr.ScreenDerivative?x`
            vec3 normal = screenDerivativeNormal(vPositionView);`:x`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===K.Highlight&&(Ru(e,t),e.include(Uo,{linearDepth:!1,hasModelTransformation:s}),e.include(Yg,t),e.include(u2,t),t.hasColorTexture&&e.fragment.uniforms.add(new Vt("tex",n=>n.texture)),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(ys,t),e.include(fw,t),e.include(Iy),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function PTe(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(O.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Gr.WindingOrder?i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==ln.None){e.include(CZ,t);const r=t.supportsTextureAtlas;i.uniforms.add(t.pbrTextureBindType===Ui.Pass?pN("normalTexture",s=>s.textureNormal,r):AO("normalTexture",s=>s.textureNormal,r)),i.code.add(x`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function S3(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add([new Vt("ssaoTex",(r,s)=>s.ssaoHelper.colorTexture),new ri("viewportPixelSz",(r,s)=>Ji(Wrt,s.camera.fullViewport[0],s.camera.fullViewport[1],1/s.ssaoHelper.width,1/s.ssaoHelper.height))]),i.code.add(x`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):i.code.add(x`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const Wrt=Ht();function Zw(e,t){const i=e.fragment;e.include(S3,t),t.pbrMode!==Ot.Disabled&&e.include(AU,t),e.include(PZ,t),i.constants.add("ambientBoostFactor","float",uC),e.include(Gk),i.code.add(x`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===Ot.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.uniforms.add(new xt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection)),i.code.add(x`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?x`normalize(vPosWorld)`:x`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.uniforms.add([new Xe("lightingGlobalFactor",(r,s)=>s.lighting.globalFactor),new xt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(x`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===Ot.Disabled||t.pbrMode===Ot.WaterOnIntegratedMesh?(e.include(IZ,t),i.code.add(x`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||(i.code.add(x`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(x`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new kw("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(x`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new Xe("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Xe("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(x`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===Ot.Schematic?x`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:x`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function ITe(e,t){const i=x`
  /*
  *  ${t.name}
  *  ${t.output===K.Color?"RenderOutput: Color":t.output===K.Depth?"RenderOutput: Depth":t.output===K.Shadow?"RenderOutput: Shadow":t.output===K.Normal?"RenderOutput: Normal":t.output===K.Highlight?"RenderOutput: Highlight":""}
  */
  `;PR()&&(e.fragment.code.add(i),e.vertex.code.add(i))}function lP(e){e.include(Mm),e.code.add(x`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${x.int(Ss.Multiply)}) {
        return allMixed;
      }
      if (mode == ${x.int(Ss.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Ss.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${x.int(Ss.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Ss.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Xrt(e){const t=new qi,i=t.vertex.code,r=t.fragment.code;t.include(ITe,{name:"Default Material Shader",output:e.output});const s=Ru(t,e);return t.include(SU),t.varyings.add("vpos","vec3"),t.include(u2,e),t.include(TTe,e),t.include(Owe,e),e.output!==K.Color&&e.output!==K.Alpha||(mm(t.vertex,e),t.include(TU,e),t.include(Uo,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===Rr.Attribute&&e.offsetBackfaces&&t.include(xTe),t.include(PTe,e),t.include(EU,e),e.instancedColor&&t.attributes.add(O.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(Yg,e),t.include(w3,e),t.include(ATe,e),t.include(_x,e),t.vertex.uniforms.add(new ri("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new Er("model",n=>_(n.modelTransformation)?n.modelTransformation:hn)),i.add(x`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${x.float(Vo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===Rr.Attribute?x`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===Rr.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===K.Alpha&&(t.include(ys,e),t.include(fw,e),t.include(Vu,e),t.fragment.uniforms.add([new Xe("opacity",n=>n.opacity),new Xe("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new Vt("tex",n=>n.texture)),t.fragment.include(lP),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(ys,e),t.include(Zw,e),t.include(S3,e),t.include(fw,e),t.include(e.instancedDoublePrecision?CU:Yw,e),t.include(Vu,e),mm(t.fragment,e),t.fragment.uniforms.add([s,new xt("ambient",n=>n.ambient),new xt("diffuse",n=>n.diffuse),new Xe("opacity",n=>n.opacity),new Xe("layerOpacity",n=>n.layerOpacity),new Xe("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new xt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",uC),e.hasColorTexture&&t.fragment.uniforms.add(new Vt("tex",n=>n.texture)),t.include(RZ,e),t.include(AU,e),t.fragment.include(lP),t.include(wTe,e),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===Rr.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(localvpos);`:x`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?x`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:x`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?x`normalize(vpos + localOrigin);`:x`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?x`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?x`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===vt.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(RTe,e),t}const Yrt=Object.freeze(Object.defineProperty({__proto__:null,build:Xrt},Symbol.toStringTag,{value:"Module"}));class Zrt extends sTe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Fe(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=dr.Back,this.emissiveFactor=Fe(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Fe(.2,.2,.2),this.diffuse=Fe(.8,.8,.8),this.externalColor=mi(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=R(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Pr(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Lw.Less,this.textureAlphaMode=ur.Blend,this.textureAlphaCutoff=B4,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Fr.Occlude}}class Qrt extends nTe{constructor(){super(...arguments),this.origin=R(),this.slicePlaneLocalOrigin=this.origin}}class E3 extends fr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global,i.doublePrecisionRequiresObfuscation=b3(t.rctx),i.textureCoordinateType=i.hasColorTexture||i.hasMetalnessAndRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?ln.Default:ln.None}initializeProgram(t){return this._initializeProgram(t,E3.shader)}_initializeProgram(t,i){const r=i.get().build(this.configuration);return new nr(t.rctx,r,zi)}_convertDepthTestFunction(t){return t===Lw.Lequal?yr.LEQUAL:yr.LESS}_setPipeline(t,i){const r=this.configuration,s=t===vt.NONE,n=t===vt.FrontFace;return Ut({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.transparent?null:s?Pu:$y(t),culling:Jrt(r)&&Bk(r.cullFace),depthTest:{func:D_(t,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:s||n?r.writeDepth&&Il:null,colorWrite:ti,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?T_:N_:null,polygonOffset:s||n?null:fU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}function Jrt(e){return e.cullFace!==dr.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}E3.shader=new sr(Yrt,()=>import("./DefaultMaterial.glsl.ffd81b24.js"));class Jt extends la{constructor(){super(...arguments),this.output=K.Color,this.alphaDiscardMode=ur.Opaque,this.doubleSidedMode=Gr.None,this.pbrMode=Ot.Disabled,this.cullFace=dr.None,this.transparencyPassType=vt.NONE,this.normalType=Rr.Attribute,this.textureCoordinateType=ln.None,this.customDepthTest=Lw.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}u([j({count:K.COUNT})],Jt.prototype,"output",void 0),u([j({count:ur.COUNT})],Jt.prototype,"alphaDiscardMode",void 0),u([j({count:Gr.COUNT})],Jt.prototype,"doubleSidedMode",void 0),u([j({count:Ot.COUNT})],Jt.prototype,"pbrMode",void 0),u([j({count:dr.COUNT})],Jt.prototype,"cullFace",void 0),u([j({count:vt.COUNT})],Jt.prototype,"transparencyPassType",void 0),u([j({count:Rr.COUNT})],Jt.prototype,"normalType",void 0),u([j({count:ln.COUNT})],Jt.prototype,"textureCoordinateType",void 0),u([j({count:Lw.COUNT})],Jt.prototype,"customDepthTest",void 0),u([j()],Jt.prototype,"spherical",void 0),u([j()],Jt.prototype,"hasVertexColors",void 0),u([j()],Jt.prototype,"hasSymbolColors",void 0),u([j()],Jt.prototype,"hasVerticalOffset",void 0),u([j()],Jt.prototype,"hasSlicePlane",void 0),u([j()],Jt.prototype,"hasSliceHighlight",void 0),u([j()],Jt.prototype,"hasColorTexture",void 0),u([j()],Jt.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([j()],Jt.prototype,"hasEmissionTexture",void 0),u([j()],Jt.prototype,"hasOcclusionTexture",void 0),u([j()],Jt.prototype,"hasNormalTexture",void 0),u([j()],Jt.prototype,"hasScreenSizePerspective",void 0),u([j()],Jt.prototype,"hasVertexTangents",void 0),u([j()],Jt.prototype,"hasOccludees",void 0),u([j()],Jt.prototype,"hasMultipassTerrain",void 0),u([j()],Jt.prototype,"hasModelTransformation",void 0),u([j()],Jt.prototype,"offsetBackfaces",void 0),u([j()],Jt.prototype,"vvSize",void 0),u([j()],Jt.prototype,"vvColor",void 0),u([j()],Jt.prototype,"receiveShadows",void 0),u([j()],Jt.prototype,"receiveAmbientOcclusion",void 0),u([j()],Jt.prototype,"textureAlphaPremultiplied",void 0),u([j()],Jt.prototype,"instanced",void 0),u([j()],Jt.prototype,"instancedColor",void 0),u([j()],Jt.prototype,"instancedDoublePrecision",void 0),u([j()],Jt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Jt.prototype,"writeDepth",void 0),u([j()],Jt.prototype,"transparent",void 0),u([j()],Jt.prototype,"enableOffset",void 0),u([j()],Jt.prototype,"cullAboveGround",void 0),u([j()],Jt.prototype,"snowCover",void 0),u([j({constValue:!0})],Jt.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],Jt.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Jt.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!0})],Jt.prototype,"useFillLights",void 0);function Krt(e){const t=new qi,i=t.vertex.code,r=t.fragment.code,s=Ru(t,e);return t.include(SU),t.varyings.add("vpos","vec3"),t.include(u2,e),t.include(TTe,e),t.include(Owe,e),e.output!==K.Color&&e.output!==K.Alpha||(mm(t.vertex,e),t.include(TU,e),t.include(Uo),e.offsetBackfaces&&t.include(xTe),e.instancedColor&&t.attributes.add(O.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(Yg,e),t.include(w3,e),t.include(ATe,e),t.include(_x,e),t.vertex.uniforms.add(new ri("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),i.add(x`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${x.float(Vo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?x`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===K.Alpha&&(t.include(ys,e),t.include(fw,e),t.include(Vu,e),t.fragment.uniforms.add([new Xe("opacity",n=>n.opacity),new Xe("layerOpacity",n=>n.layerOpacity),new u_("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new Vt("tex",n=>n.texture)),t.fragment.include(lP),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(ys,e),t.include(Zw,e),t.include(S3,e),t.include(fw,e),t.include(e.instancedDoublePrecision?CU:Yw,e),t.include(Vu,e),mm(t.fragment,e),t.fragment.uniforms.add([s,new xt("ambient",n=>n.ambient),new xt("diffuse",n=>n.diffuse),new Xe("opacity",n=>n.opacity),new Xe("layerOpacity",n=>n.layerOpacity),new u_("view"),new Xe("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new xt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",uC),e.hasColorTexture&&t.fragment.uniforms.add(new Vt("tex",n=>n.texture)),t.include(RZ,e),t.include(AU,e),t.fragment.include(lP),t.extensions.add("GL_OES_standard_derivatives"),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?x`albedo = mix(albedo, vec3(1), 0.9);`:x``}
        ${x`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?e.spherical?x`vec3 normalGround = normalize(vpos + localOrigin);`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:x``}
        ${e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?x`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===vt.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:x``}
      }
    `)),t.include(RTe,e),t}const est=Object.freeze(Object.defineProperty({__proto__:null,build:Krt},Symbol.toStringTag,{value:"Module"}));class PU extends E3{initializeConfiguration(t,i){super.initializeConfiguration(t,i),i.hasMetalnessAndRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=Rr.Attribute,i.doubleSidedMode=Gr.WindingOrder,i.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,PU.shader)}}PU.shader=new sr(est,()=>import("./RealisticTree.glsl.f360462b.js"));class Qw extends Rm{constructor(t){super(t,rst),this.supportsEdges=!0,this.techniqueConfig=new Jt,this.vertexBufferLayout=nst(this.parameters),this.instanceBufferLayout=t.instanced?$Te(this.parameters):null}isVisibleInPass(t){return t!==je.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=t,o=_(i)&&i.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType=this.parameters.normals==="screenDerivative"?Rr.ScreenDerivative:Rr.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,_(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?dr.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=_(this.parameters.modelTransformation),t!==K.Color&&t!==K.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=Gr.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Gr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Gr.WindingOrder:Gr.None,this.techniqueConfig.instancedColor=_(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Ot.Schematic:Ot.Normal:Ot.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<dU,this.techniqueConfig.snowCover=this.hasSnowCover(i)),this.techniqueConfig}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,i,r,s,n,o,a){if(_(this.parameters.verticalOffset)){const l=s.camera;ne(pB,r[12],r[13],r[14]);let c=null;switch(s.viewingMode){case Ve.Global:c=we(Goe,pB);break;case Ve.Local:c=le(Goe,lst)}let h=0;const p=pe(cst,pB,l.eye),f=Oe(p),m=ce(p,p,1/f);let y=null;this.parameters.screenSizePerspective&&(y=Te(c,m)),h+=Lwe(l,f,this.parameters.verticalOffset,y,this.parameters.screenSizePerspective),ce(c,c,h),fc(dB,c,s.transform.inverseRotation),n=pe(ost,n,dB),o=pe(ast,o,dB)}aU(t,i,s,n,o,wH(s.verticalOffset),a)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Shadow||t.output===K.Highlight?new tst(t):null}createBufferWriter(){return new sst(this.vertexBufferLayout,this.instanceBufferLayout)}}class tst extends OZ{constructor(t){super(F(F({},t),t.material.parameters))}_updateParameters(t){const i=this._material.parameters;this.updateTexture(i.textureId);const r=t.camera.viewInverseTransposeMatrix;return ne(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?PU:E3,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class ist extends Zrt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const rst=new ist;class sst{constructor(t,i){this.vertexBufferLayout=t,this.instanceBufferLayout=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,i,r,s){cU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}function nst(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=ls().vec3f(O.POSITION).vec3f(O.NORMAL);return e.hasVertexTangents&&i.vec4f(O.TANGENT),t&&i.vec2f(O.UV0),e.hasVertexColors&&i.vec4u8(O.COLOR),e.hasSymbolColors&&i.vec4u8(O.SYMBOLCOLOR),i}function $Te(e){let t=ls();return t=e.instancedDoublePrecision?t.vec3f(O.MODELORIGINHI).vec3f(O.MODELORIGINLO).mat3f(O.MODEL).mat3f(O.MODELNORMAL):t.mat4f(O.MODEL).mat4f(O.MODELNORMAL),_(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(O.INSTANCECOLOR)),_(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t}const ost=R(),ast=R(),lst=Fe(0,0,1),Goe=R(),dB=R(),pB=R(),cst=R(),ust=["polygon","extent"];class hst extends Im{constructor(t,i,r,s){super(t,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=mU(this._getSymbolSize());if(a)throw new q("graphics3dextrudesymbollayer:invalid-size",a)}const t=rs(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),r=pl(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?dr.None:dr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new Qw(o),this._bottomMaterial=new Qw(me(F({},o),{cullFace:dr.Back})),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,ust,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Gu);return this._createAs3DShape(i,t.renderingInfo,r,s,i.uid)}layerOpacityChanged(t,i){const r=rs(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();return t.forEach(a=>{const l=i(a);_(l)&&l.layerOpacityChanged(o,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,w_)}slicePlaneEnabledChanged(t,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){var r;let i;return i=t.size&&this._drivenProperties.size?(r=pit(t.size,2))!=null?r:0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(t,i){return this._drivenPropertiesChanged(i)?cn.Recreate_Symbol:cn.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,i,r,s,n){const o=aP(t.geometry);if(M(o))return null;const a=GQ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer"),o.rings.length===0||!o.rings.some(ae=>ae.length>0))return null;const l=AQ(o);if(M(l))return null;const c=new Array,h=new Array,p=new Array,f=Hs(),m=Ae(),y=R(),v=this._context.renderCoordsHelper.viewingMode===Ve.Global;v||this._context.renderCoordsHelper.worldUpAtPosition(null,y),ku(o.spatialReference,[l.x,l.y,0],m,this._context.renderCoordsHelper.spatialReference);const w=Ae();vs(w,m);const b=Pr();uE(b,w);const{polygons:S,mapPosition:T,position:E}=a,C=E.length/3,A=new Float64Array(3*C*6),I=new Float64Array(3*C*6),L=new Float64Array(3*C*6),D=new Float64Array(1*C*6);let U=0;for(let ae=0;ae<S.length;++ae){const re=S[ae],$=re.count;if(this._context.clippingExtent&&(mr(f),Su(f,re.mapPosition),!ap(f,this._context.clippingExtent)))continue;const k=CE(re.mapPosition,re.holeIndices,3);if(k.length===0)continue;const B=3*$*2+k.length,H=new Uint32Array(B),Y=new Uint32Array(k.length),ee=6*$,G=3*A.BYTES_PER_ELEMENT,te=new Cs(A.buffer,U*G,G,(U+ee)*G),fe=3*I.BYTES_PER_ELEMENT,xe=new Cs(I.buffer,U*fe,fe,(U+ee)*fe),Le=new Float64Array(L.buffer,3*U*L.BYTES_PER_ELEMENT,3*ee),_e=new Float64Array(D.buffer,1*U*D.BYTES_PER_ELEMENT,1*ee),ye=this._getExtrusionSize(i);dst(E,T,k,re,te.typedBuffer,Le,xe.typedBuffer,_e,0,H,Y,ye,y,v),v3(te,te,w),x_(xe,xe,b),U+=6*$;const Ce=joe(H,H.length-Y.length,{positions:te.typedBuffer,elevation:Le,normals:xe.typedBuffer,heights:_e},r);c.push(Ce),h.push(this._material),p.push(hn);const Pe=joe(Y,0,{positions:te.typedBuffer,elevation:Le,normals:xe.typedBuffer,heights:_e},r);c.push(Pe),h.push(this._bottomMaterial),p.push(hn)}if(c.length===0)return null;const z=new Ly({geometries:c,materials:h,transformations:p,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});z.transformation=m;const V=Pxe(this.symbolLayer,{opacity:this._getLayerOpacity()}),X=_(V)?{baseMaterial:this._material,edgeMaterials:[V],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,Z=new Pm(this,z,c,null,null,mst,s,X);return Z.alignedSampledElevation=a.sampledElevation,Z.needsElevationUpdates=w_(s.mode),Z}}function joe(e,t,i,r){const s=new Uint32Array(e.length),n=[[O.POSITION,{size:3,data:i.positions,exclusive:!0}],[O.NORMAL,{size:3,data:i.normals,exclusive:!0}],[O.COLOR,{size:4,data:r,exclusive:!0}],[O.SIZE,{size:1,data:i.heights,exclusive:!0}]],o=[[O.POSITION,e],[O.NORMAL,e],[O.COLOR,s]];return i.elevation&&(n.push([O.MAPPOS,{size:3,data:i.elevation}]),o.push([O.MAPPOS,e])),new kr(n,o,Al.Triangle,t)}function dst(e,t,i,r,s,n,o,a,l,c,h,p,f,m){const y=i.length/3;let v=0,w=2*r.count;pst(e,t,r.index,r.count,i,0,y,s,n,o,a,l,c,h,w,p,f,m),l+=2*r.count,w=0,Hoe(s,n,a,o,v,r.pathLengths[0],r.count,l,c,w,p),l+=4*r.pathLengths[0],w+=2*r.pathLengths[0],v+=r.pathLengths[0];for(let b=1;b<r.pathLengths.length;++b)Hoe(s,n,a,o,v,r.pathLengths[b],r.count,l,c,w,p),l+=4*r.pathLengths[b],w+=2*r.pathLengths[b],v+=r.pathLengths[b]}function pst(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v,w,b){le(Ka,w);const S=v>0?1:-1;let T=3*i,E=p,C=3*E,A=p+r,I=3*A;for(let U=0;U<r;++U)b&&(Ka[0]=e[T+0],Ka[1]=e[T+1],Ka[2]=e[T+2],we(Ka,Ka)),a[C+0]=e[T+0],a[C+1]=e[T+1],a[C+2]=e[T+2],l[C+0]=t[T+0],l[C+1]=t[T+1],l[C+2]=t[T+2],c[C+0]=-S*Ka[0],c[C+1]=-S*Ka[1],c[C+2]=-S*Ka[2],h[E]=0,a[I+0]=e[T+0]+v*Ka[0],a[I+1]=e[T+1]+v*Ka[1],a[I+2]=e[T+2]+v*Ka[2],l[I+0]=t[T+0],l[I+1]=t[T+1],l[I+2]=t[T+2],c[I+0]=S*Ka[0],c[I+1]=S*Ka[1],c[I+2]=S*Ka[2],h[A]=v,C+=3,I+=3,T+=3,E+=1,A+=1;T=3*n,C=0,I=3*y;const L=v<0?Qoe:Zoe,D=v<0?Zoe:Qoe;for(let U=0;U<o;++U)m[C+0]=s[T+L[0]],m[C+1]=s[T+L[1]],m[C+2]=s[T+L[2]],f[I+0]=s[T+D[0]]+r,f[I+1]=s[T+D[1]]+r,f[I+2]=s[T+D[2]]+r,C+=3,I+=3,T+=3}function U$(e,t,i,r,s,n,o){r[n]=r[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const oA=R();function Hoe(e,t,i,r,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,v=a,w=a+1,b=a+2*n,S=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),fst(e,p,f,m,oA),U$(e,t,r,i,oA,v,p),U$(e,t,r,i,oA,w,f),U$(e,t,r,i,oA,b,m),U$(e,t,r,i,oA,S,y),l[c++]=v,l[c++]=b,l[c++]=S,l[c++]=v,l[c++]=S,l[c++]=w,p++,f++,m++,y++,v+=2,w+=2,b+=2,S+=2}const fB=R(),qoe=R(),Woe=R(),Xoe=R(),Yoe=R();function fst(e,t,i,r,s){t*=3,i*=3,r*=3,ne(fB,e[t++],e[t++],e[t++]),ne(qoe,e[i++],e[i++],e[i++]),ne(Woe,e[r++],e[r++],e[r++]),pe(Xoe,qoe,fB),pe(Yoe,Woe,fB),ct(s,Yoe,Xoe),we(s,s)}const Wx=R();function mst(e,t,i,r){const s=e.stageObject,n=s.geometryRecords,o=n.length,a=t.mode!=="absolute-height";let l=0;const c=s.transformation,h=vs(Ae(),c);for(let p=0;p<o;p+=2){const f=n[p].geometry,m=f.getMutableAttribute(O.POSITION).data,y=f.vertexAttributes.get(O.SIZE).data,v=f.vertexAttributes.get(O.MAPPOS).data,w=new ewe(v),b=m.length/3;let S=0,T=!1,E=0;const C=i.spatialReference;for(let A=0;A<b;A++){Wx[0]=m[S],Wx[1]=m[S+1],Wx[2]=m[S+2],vy(w,i,t,r,z$),a&&(E+=z$.sampledElevation),ji.TESTS_DISABLE_OPTIMIZATIONS?(ne(Ul,w.array[w.offset+0],w.array[w.offset+1],z$.z+y[S/3]),r.toRenderCoords(Ul,C,Ul),ke(Ul,Ul,h)):(ne(Ul,m[S+0],m[S+1],m[S+2]),ke(Ul,Ul,c),r.setAltitude(Ul,z$.z+y[S/3]),ke(Ul,Ul,h)),m[S]=Ul[0],m[S+1]=Ul[1],m[S+2]=Ul[2];const I=gst/r.unitInMeters;(Math.abs(Wx[0]-m[S])>=I||Math.abs(Wx[1]-m[S+1])>=I||Math.abs(Wx[2]-m[S+2])>=I)&&(T=!0),w.offset+=3,S+=3}T&&(f.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p]),n[p+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p+1])),l+=E/b}return l/o}const Ul=R(),Ka=R(),z$=new y3,Zoe=[0,2,1],Qoe=[0,1,2],gst=.01;function yst(e,t,i,r,s){const n=e.referencesGeometry()&&s?vst(t,r,s):t,o=e.repurposeFeature(n);try{return e.evaluate(me(F({},i),{$feature:o}))}catch(a){return ge.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const mB=new Map;function vst(e,t,i){const{transform:r,hasZ:s,hasM:n}=i;mB.has(t)||mB.set(t,_st(t));const o=mB.get(t)(e.geometry,r,s,n);return me(F({},e),{geometry:o})}function _st(e){const t={};switch(e){case"esriGeometryPoint":return(i,r,s,n)=>hxe(r,t,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>dxe(r,t,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>pxe(r,t,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>uxe(r,t,i,s,n);default:return ge.getLogger("esri.views.2d.support.arcadeOnDemand").error(new q("mapview-arcade",`Unable to handle geometryType: ${e}`)),i=>i}}const i2t=1.2,bst=Qf,wst=Fh;class IU{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ei.Geometry.ADD);if(t||this._addedToStage){for(const i of this.renderGeometries)i.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ei.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ei.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=R()){return ne(t,0,0,0)}getBoundingBoxObjectSpace(t=Hs()){return mr(t)}addObjectState(t,i){t===fy.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ei.State.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(i=>{t.removeRenderGeometry(i)})}removeRenderGeometryObjectState(t,i){t.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ei.State.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const i of this.renderGeometries)i.computeAttachmentOrigin(Xx)&&(t.draped.origin[0]+=Xx[0],t.draped.origin[1]+=Xx[1],t.draped.num++)}async getProjectedBoundingBox(t,i,r,s,n){mr(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,Joe,r),wPe(n,Joe)}if(i){let o;op(n,Xx);const a=MQ(n,i);try{o=await i.service.queryElevation(Xx[0],Xx[1],s,a,"ground")}catch{}_(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,i,r,s){if(this.boundingBox)j5(Gp,this.boundingBox);else{const n=t.boundingSphere,o=n[3];Gp[0]=n[0]-o,Gp[1]=n[1]-o,Gp[2]=n[2]-o,Gp[3]=n[0]+o,Gp[4]=n[1]+o,Gp[5]=n[2]+o}return i(Gp,0,2),this.calculateRelativeScreenBounds&&s.push({location:op(Gp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),QW(Gp,r)}}const Joe=Nt(),Gp=Hs(),Xx=R();class DTe{constructor(t,i,r,s=2048){this.text=t,this._alignment=i,this._parameters=r,this.maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),i=this.lineHeight;return Math.ceil(t+i+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*xst}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(M(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case e_.Left:return this.backgroundHorizontalPadding;case e_.Center:return(this.displayWidth-this._lineWidths[t])/2;case e_.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,i=0,r=0){t.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this.haloSize,a=this.firstLineYOffset;i+=o,r+=a+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,i+p,r),this._renderLineDecoration(t,i+p,r,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(t,i+p,r,this._textWidths[c]),r+=this.lineSpacing}if(ji.TEXT_SHOW_BASELINE){t.strokeStyle=Koe,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this.baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this.lineSpacing}}if(ji.TEXT_SHOW_BORDER&&(t.strokeStyle=Koe,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this.hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this.baselinePosition}const l=n?this.haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),t.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),t.stroke()}_roundedRect(t,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=De(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(i,r+s),t.arcTo(i,r,i+s,r,s),t.lineTo(i+n-s,r),t.arcTo(i+n,r,i+n,r+s,s),t.lineTo(i+n,r+o-s),t.arcTo(i+n,r+o,i+n-s,r+o,s),t.lineTo(i+s,r+o),t.arcTo(i,r+o,i,r+o-s,s),t.closePath()):t.rect(i,r,n,o)}_renderHalo(t,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=SN(gB,Math.max(o,Yx),Math.max(a,Yx)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this.baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),t.globalAlpha=1}_renderHaloEmulated(t,i,r){r+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of LTe)this._fillText(t,n,i+o+this.haloSize*a,r+this.haloSize*l);r+=this.lineSpacing}}_renderHaloNative(t,i,r){const s=2*this.haloSize;r+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,i+a,r)}r+=this.lineSpacing}}_setFontProperties(t,i){t.font=this._parameters.fontString(i),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(_(this._displayWidth))return this._displayWidth;const t=SN(gB,Yx,Yx).getContext("2d");this._setFontProperties(t,this.fontSize);let i=2*this.haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const o=t.measureText(n).width,a=o+i;this._textWidths.push(o),this._lineWidths.push(a),s=Math.max(s,a)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(M(this._heightMetrics)){const t=SN(gB,Yx,Yx).getContext("2d");this._setFontProperties(t,this.fontSize);const i=t.measureText(this.text+Tst),r=this.hasBackground?t.measureText(this._lines[0]):i,s=this._lines.length===1?r:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):i,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;this._heightMetrics={paddingTop:i.actualBoundingBoxAscent-r.actualBoundingBoxAscent,paddingBottom:i.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:i.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,i,r,s){t.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(t,i,r,s){t.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(t,i,r){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.stroke()}_drawBox(t,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const LTe=[];for(let t=0;t<360;t+=360/16)LTe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var e_;function SN(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(e_||(e_={}));const gB={canvas:null},xst=.2,Yx=512,Koe="rgb(255, 0, 255, 0.5)",Tst=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),Sst={left:0,center:.5,right:1},EN={"bottom-left":Ni(0,0),bottom:Ni(.5,0),"bottom-right":Ni(1,0),left:Ni(0,.5),center:Ni(.5,.5),right:Ni(1,.5),"top-left":Ni(0,1),top:Ni(.5,1),"top-right":Ni(1,1)};function NTe(e){switch(e){case"left":return e_.Left;case"right":return e_.Right;default:return e_.Center}}function eae(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Est(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Cst(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function Ast(e){return e==="middle"?"center":e}var oa,tae,J4;function aA(e){return e!=null}function Zx(e){return typeof e=="number"}function $U(e){return typeof e=="string"}function Mst(e){return e==null||$U(e)}function an(e,t){e&&e.push(t)}function Ost(e,t,i,r=Ae()){const s=e||0,n=t||0,o=i||0;return s!==0&&B2(r,r,-s/180*Math.PI),n!==0&&V2(r,r,n/180*Math.PI),o!==0&&tk(r,r,o/180*Math.PI),r}function e0(e,t,i,r,s){const n=e.minSize,o=e.maxSize;if(e.expression)return an(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=r.symbolSize[i];return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=oa.DefinedSize,!0}if(aA(e.field))return aA(e.stops)?e.stops.length===2&&Zx(e.stops[0].size)&&Zx(e.stops[1].size)?(iae(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=oa.DefinedSize,!0):(an(s,"Could not convert size info: stops only supported with 2 elements"),!1):Zx(n)&&Zx(o)&&aA(e.minDataValue)&&aA(e.maxDataValue)?(iae(n,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=oa.DefinedSize,!0):Q2[e.valueUnit]!=null?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/Q2[e.valueUnit],t.type[i]=oa.DefinedSize,!0):e.valueUnit==="unknown"?(an(s,"Could not convert size info: proportional size not supported"),!1):(an(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!aA(e.field)){if(e.stops&&e.stops[0]&&Zx(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=oa.DefinedSize,!0;if(Zx(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=oa.DefinedSize,!0}return an(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function iae(e,t,i,r,s,n){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-i*o,s.factor[n]=o}function Rst(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return an(r,"Could not convert size info: unsupported property"),null;if(!Mst(e.field))return an(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return an(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[oa.Undefined,oa.Undefined,oa.Undefined]};let s;switch(e.axis){case"width":return s=e0(e,t.size,0,i,r),s?t:null;case"height":return s=e0(e,t.size,2,i,r),s?t:null;case"depth":return s=e0(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=e0(e,t.size,0,i,r),s&&e0(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=e0(e,t.size,0,i,r),s=s&&e0(e,t.size,1,i,r),s=s&&e0(e,t.size,2,i,r),s?t:null;default:return an(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function Pst(e,t,i){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===oa.DefinedSize&&(n*=t.modelSize[s],e.type[s]=oa.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let r;if(e.type[0]!==oa.Undefined)r=0;else if(e.type[1]!==oa.Undefined)r=1;else{if(e.type[2]===oa.Undefined)return an(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===oa.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}function rae(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function Ist(e,t,i){if(e.normalizationField)return an(i,"Could not convert color info: unsupported property"),null;if($U(e.field)){if(!e.stops)return an(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return an(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.color.values[s]=n.value,rae(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return an(i,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,rae(t.color.colors,s,r)}}return t}function $st(e,t,i){if(e.normalizationField)return an(i,"Could not convert opacity info: unsupported property"),null;if($U(e.field)){if(!e.stops)return an(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return an(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return an(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=r}}return t}function yB(e,t,i){const r=i===2&&e.rotationType==="arithmetic";t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function Dst(e,t,i){if(!$U(e.field))return an(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return an(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return yB(e,t.rotation,0),t;case"roll":return yB(e,t.rotation,1),t;case null:case void 0:case"heading":return yB(e,t.rotation,2),t;default:return an(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function FTe(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return an(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?Rst(c,l,t,i):l;case"color":return s?Ist(c,l,i):l;case"opacity":return o?$st(c,l,i):null;case"rotation":return n?Dst(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!Pst(a.size,t,i)?null:a:null}function jQ(e){return e&&e.size!=null}function cP(e,t){if(!e)return{enabled:!1};if(ji.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=FTe(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:kTe(i,t),requiresShaderTransformation:jQ(i)}:{enabled:!1}}function uP(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=FTe(t.visualVariables,i);return!!s&&!!(V$(r.size,s.size,"size")&&V$(r.color,s.color,"color")&&V$(r.rotation,s.rotation,"rotation")&&V$(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=kTe(s,i),e.requiresShaderTransformation=jQ(s),!0)}function V$(e,t,i){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&i==="rotation"){const r=e,s=t;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function kTe(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=jQ(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=Pr(),dm(NO),Ost(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],NO),Jh(i.vvSymbolRotationMatrix,NO)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(oa||(oa={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(tae||(tae={})),function(e){const t=Ae(),i=R();function r(n,o,a){if(!n.vvSizeEnabled)return a;Ts(t,a);const l=n.vvSymbolRotationMatrix;Tm(NO,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),jr(t,t,NO);for(let c=0;c<3;++c){const h=n.vvSizeOffset[c]+o[0]*n.vvSizeFactor[c];i[c]=De(h,n.vvSizeMinSize[c],n.vvSizeMaxSize[c])}return ek(t,t,i),ja(t,t,n.vvSymbolAnchor),t}function s(n,o,a){if(!o.vvSizeEnabled)return ne(n,1,1,1);for(let l=0;l<3;++l){const c=o.vvSizeOffset[l]+a[0]*o.vvSizeFactor[l];n[l]=De(c,o.vvSizeMinSize[l],o.vvSizeMaxSize[l])}return n}e.evaluateModelTransform=r,e.evaluateModelTransformScale=s}(J4||(J4={}));const NO=Ae(),HH=J4.evaluateModelTransform,Lst=J4.evaluateModelTransformScale;class Nst{constructor(){this.visible=!0}}class RE{constructor(t,i,r={}){this.data=t,this.material=i,this.boundingSphere=Ht(),this.instanceParameters=new Nst,this._transformation=Ae(),this._shaderTransformationDirty=!0,this.layerUid=ft(r.layerUid,null),this.graphicUid=ft(r.graphicUid,null),this.id=r.id?r.id:Tl(),this.boundingInfo=ft(r.boundingInfo,null),this.calculateShaderTransformation=ft(r.calculateShaderTransformation,null),this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,i,r=Rw(t)){M(this.boundingInfo)||(ke(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return _(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return M(this.calculateShaderTransformation)?ft(this.transformation,hn):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ae()),Ts(this._shaderTransformation,this.calculateShaderTransformation(ft(this.transformation,hn))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(_(this._transformation)&&ke(t,t,this._transformation),!0);const i=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);return!!lbe(r,i,t)&&(_(this._transformation)&&ke(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new H4(fy.Highlight),i=this.instanceParameters;return i.highlights=TH(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=SH(i.highlights,t)}}const Fst=Ae(),sae=Fe(0,0,1),kst=16,Ust=1.5,Qb=TQ,zst=[Qb/2,Qb/2,1-Qb/2,1-Qb/2],Vst=[iP*Qb,iP*Qb];class hP extends Im{constructor(t,i,r,s){super(t,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(_(r))this._prepareResourcesPrimitive(i,r);else{const s=ike(this.symbol,this.symbolLayer),n=Y5(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),t):await this._prepareResourcesHref(i,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=mU(this._getIconSize());if(t)throw new q("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,i=Math.round(t.size!=null?fo(t.size):kst);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(t){const i=this._getGraphicHash(t);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:Zv.PAD};r=new Ns(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(t,i){const r=t.width/t.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(Bst(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;t.verticalOffset={screenLength:fo(r),minWorldLength:s||0,maxWorldLength:n!=null?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,i){const r=this._getOutlineSize();if(vB(i)&&r===0)throw new Error("Nothing to render");this._outlineSize=r,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const s=this._context.sharedResources.textures.fromData(i,()=>jwe(i));this._texture=s.texture,this._releaseTexture=s,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=zst,t.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/Qb,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,i,r){if(!he("esri-canvas-svg-support")&&oX(i))throw new q("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.pixelRatio,o=await Ac(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw by(o.error),new q("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,i,r){const s=new qE({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await import("./CIMSymbolRasterizer.5e1830f1.js")).CIMSymbolRasterizer;ci(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await dRe(p,this._context.layer.spatialReference,n);a=(m,y,v)=>{const w=yst(f,m,{$view:v},"esriGeometryPoint",y);return w!==null?w:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];ci(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||g3e}_getOutlineSize(){let t=0;const i=this.symbolLayer;return _(i.outline)&&i.outline.size!=null?Math.max(fo(i.outline.size),0):(t=vB(this._getPrimitive())?Ust:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),i=this.symbolLayer,r=rs(i,"outline","color");if(_(r)){const s=We.toUnitRGB(r),n=r.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(vB(this._getPrimitive()))return bst;const t=M(this._getPrimitive()),i=rs(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:t})}_getAnchorPos(t,i){return t==="relative"?Ni((i.x||0)+.5,.5-(i.y||0)):t in EN?EN[t]:EN.center}_createMaterialAndAddToStage(t,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=cP(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let r=_(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return r||(r=new SE(t),this._cimSymbolMaterials.set(ft(t.textureId,0),r),i.add(r)),r}return this._material=new SE(t),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=er(this._releaseTexture)}_getScaleFactor(t,i){if(this._drivenProperties.size&&t.size){for(let r=0;r<3;r++){const s=t.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[r]=fo(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/i;if(isFinite(+t.size[2]))return+t.size[2]/i}return 1}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),f=F({textureId:p.id},this._cimMaterialParametersInfo);s=this._createMaterialAndAddToStage(f,this._context.stage),r=[p.params.width,p.params.height]}else r=this._size,s=this._material;const n=nP(i.geometry);if(M(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=[r[0]*l,r[1]*l],h=this.setGraphicElevationContext(i,new Gu);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,s,a,c,t.layer.uid):this._createAs3DShape(i,n,s,a,c,h,i.uid)}layerOpacityChanged(){const t=this._getFillColor(),i=this._getOutlineColor();return this._forEachMaterial(r=>{r.setParameters({color:t}),r.setParameters({outlineColor:i})}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=g3(hP.elevationModeChangeTypes,r,s);if(n!==Zr.UPDATE)return n;const o=id(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!uP(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return cn.Recreate_Symbol;_(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return cn.Fast_Update}_defaultElevationInfoNoZ(){return Gst}_createAs3DShape(t,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?m=>HH(this._fastUpdates.materialParameters,l,m):null,h=[sc.createPointGeometry(sae,null,s,n,jst,null,l)],p=LQ(this._context,i,h,[r],o,this._context.layer.uid,a,c);if(p===null)return null;const f=new Pm(this,p.object,h,null,null,rP,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=id(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=m=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,m),sP(f,i,this._context.elevationProvider),f}_createAsOverlay(t,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=Ht();Gn(i,a,this._context.overlaySR),a[2]=BQ;const l=this._context.clippingExtent;if(_(l)&&!ZW(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?y=>HH(this._fastUpdates.materialParameters,c,y):null,p=sc.createPointGeometry(sae,a,s,n,null,null,c),f=new RE(p,r,{layerUid:o,graphicUid:t.uid,calculateShaderTransformation:h});a[3]=0,np(f.boundingSphere,a);const m=new IU(this,[f],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,h),m.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,y),m}_createScreenSizeGetter(t,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=st())=>{const a=i(Fst);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=t[0]/this._symbolTextureRatio+r,n=t[1]/this._symbolTextureRatio+r;return(o=st())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Fe(t,t,t),r=Du(1),s=t*r;return{modelSize:i,symbolSize:Fe(s,s,s),unitInMeters:r,transformation:{anchor:za,scale:Gf,rotation:za}}}_getGraphicHash(t){let i="";for(const r of this._cimRequiredFields)i+=r+t.attributes[r];return i}_forEachMaterial(t){_(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return me(F({},super.test()),{material:this._material})}}function Bst(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function vB(e){return!M(e)&&(e==="cross"||e==="x")}hP.PRIMITIVE_SIZE=Vst,hP.elevationModeChangeTypes={definedChanged:Zr.UPDATE,staysOnTheGround:Zr.NONE,onTheGroundChanged:Zr.RECREATE};const Gst={mode:"relative-to-ground",offset:0},jst=mi(0,0,0,1);function qH(e){const t=[],i=[];Wst(e,i,t);const r=i[0][1].data,s=t[0][1].length,n=new Uint16Array(s);return Xst(e,i,t),Yst(e,i,t,n),Qst(e,i,t,n),Zst(e,i,t,n),Jst(e,i,t,n),Kst(e,i,t,n),ent(e,i,t,r),new kr(i,t,Al.Line)}function Hst(e,t,i,r){const s=e.type==="polygon"?gm.CCW_IS_HOLE:gm.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=_3(n,e.hasZ,s),l=new Float64Array(o.length),c=Txe(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),h=c!=null;return{lines:h?UTe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function UTe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function qst(e,t){const i=e.type==="polygon"?gm.CCW_IS_HOLE:gm.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=_3(r,!1,i),o=pr(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=BQ;return{lines:o?UTe(n,s):[],projectionSuccess:o}}function Wst(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=e,n=tnt(r)&&s===Jw.REMOVE,o=r.length/3-(n?1:0),a=new Uint32Array(2*(o-1)),l=n?tW(r,0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([O.POSITION,{size:3,data:l,exclusive:n}]),i.push([O.POSITION,a])}function Xst(e,t,i){const r=e.attributeData.mapPosition;M(r)||(i.push([O.MAPPOS,i[0][1]]),t.push([O.MAPPOS,{size:3,data:r}]))}function Yst(e,t,i,r){if(_(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([O.COLOR,{size:4,data:ft(s,wst)}]),i.push([O.COLOR,r])}function Zst(e,t,i,r){const s=e.attributeData.colorFeature;M(s)||(t.push([O.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([O.COLOR,r]))}function Qst(e,t,i,r){if(_(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([O.SIZE,{size:1,data:[ft(s,1)]}]),i.push([O.SIZE,r])}function Jst(e,t,i,r){const s=e.attributeData.sizeFeature;M(s)||(t.push([O.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([O.SIZEFEATUREATTRIBUTE,r]))}function Kst(e,t,i,r){const s=e.attributeData.opacityFeature;M(s)||(t.push([O.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([O.OPACITYFEATUREATTRIBUTE,r]))}function ent(e,t,i,r){if(M(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==Ve.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(r.length),n=bi(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)AX(r,f,s,f,n);const o=r.length/3,a=new Float32Array(o+1);let l=int,c=rnt,h=0,p=0;ne(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),ne(c,s[p++],s[p++],s[p++]),h+=u1e(l,c),a[f]=h,[l,c]=[c,l];t.push([O.DISTANCETOSTART,{size:1,data:a}]),i.push([O.DISTANCETOSTART,i[0][1]])}function tnt(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var Jw;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(Jw||(Jw={}));const int=R(),rnt=R();function WH(e){switch(e){case"butt":return qh.BUTT;case"square":return qh.SQUARE;case"round":return qh.ROUND;default:return null}}const K4=64,zTe=K4/2,VTe=zTe/5;function snt(e,t){return _(t)?nnt(e,ont(t.style)):null}function nnt(e,t){return e.fromData(t,()=>jwe(t,K4,zTe,VTe))}function ont(e){return e==="diamond"?"kite":e}function ant(e){const t=new qi,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(qxe,e),e.output===K.Depth&&t.include(L_,e);const{vertex:r,fragment:s}=t;return s.include($c),Ru(t,e),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float"),r.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),r.uniforms.add([new pi("nearFar",(n,o)=>o.camera.nearFar),new ri("viewport",(n,o)=>o.camera.fullViewport)]),r.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(x`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(r.uniforms.add(new Er("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix)),r.code.add(x`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),r.code.add(x`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),r.uniforms.add(new Xe("perScreenPixelRatio",(n,o)=>o.camera.perScreenPixelRatio)),r.code.add(x`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),r.uniforms.add(new Xe("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(x`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${x.float(K4/VTe)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||r.code.add(x`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),r.code.add(x`
        ${i?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&t.include(Vu,e),t.include(ys,e),s.uniforms.add([new ri("intrinsicColor",n=>n.color),new Vt("tex",n=>n.texture)]),s.include(Mm),s.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${x.float(1/K4)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${x.float(Vo)}) {
      discard;
    }

    ${e.output===K.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===vt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),t}const lnt=Object.freeze(Object.defineProperty({__proto__:null,build:ant},Symbol.toStringTag,{value:"Module"})),BTe=new Map([[O.POSITION,0],[O.UV0,2],[O.AUXPOS1,3],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.OPACITYFEATUREATTRIBUTE,7]]);class DU extends fr{initializeProgram(t){const i=DU.shader.get().build(this.configuration);return new nr(t.rctx,i,BTe)}_makePipelineState(t,i){const r=this.configuration,s=t===vt.NONE;return Ut({blending:r.output===K.Color||r.output===K.Alpha?s?Pu:$y(t):null,depthTest:{func:D_(t)},depthWrite:s?r.writeDepth&&Il:hU(t),colorWrite:ti,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?T_:N_:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ut({blending:Pu,depthTest:X4,depthWrite:null,colorWrite:ti,stencilWrite:null,stencilTest:Zxe}),this._occluderPipelineOpaque=Ut({blending:Pu,depthTest:X4,depthWrite:null,colorWrite:ti,stencilWrite:Xxe,stencilTest:Yxe}),this._occluderPipelineMaskWrite=Ut({blending:null,depthTest:kQ,depthWrite:null,colorWrite:null,stencilWrite:ym,stencilTest:T_})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}DU.shader=new sr(lnt,()=>import("./LineMarker.glsl.fe6239fe.js"));class Ca extends la{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=vt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],Ca.prototype,"output",void 0),u([j({count:vt.COUNT})],Ca.prototype,"transparencyPassType",void 0),u([j()],Ca.prototype,"occluder",void 0),u([j()],Ca.prototype,"hasSlicePlane",void 0),u([j()],Ca.prototype,"writeDepth",void 0),u([j()],Ca.prototype,"draped",void 0),u([j()],Ca.prototype,"hasCap",void 0),u([j()],Ca.prototype,"vvSize",void 0),u([j()],Ca.prototype,"vvColor",void 0),u([j()],Ca.prototype,"vvOpacity",void 0),u([j()],Ca.prototype,"hasOccludees",void 0),u([j()],Ca.prototype,"hasMultipassTerrain",void 0),u([j()],Ca.prototype,"cullAboveGround",void 0),u([j({constValue:!0})],Ca.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],Ca.prototype,"hasSliceTranslatedView",void 0);class cnt extends Rm{constructor(t){super(t,new hnt),this._vertexAttributeLocations=BTe,this.techniqueConfig=new Ca,this.layout=this.createLayout()}dispose(){}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Ee.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==qh.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===Fr.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=ls().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(O.SIZEFEATUREATTRIBUTE):t.f32(O.SIZE),this.parameters.vvColorEnabled?t.f32(O.COLORFEATUREATTRIBUTE):t.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&t.f32(O.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new dnt(this.layout,this.parameters)}requiresSlot(t,i){if(t===Ee.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Fr.OccludeAndTransparentStencil)return t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL;const r=Xw(i);return r===K.Color||r===K.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new unt(t):null}}class unt extends OZ{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(DU,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class hnt extends SQ{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=qh.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class dnt{constructor(t,i){this.vertexBufferLayout=t,this.parameters=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,i,r,s){const n=i.vertexAttributes.get(O.POSITION).data,o=n.length/3;let a=1,l=0;this.parameters.vvSizeEnabled?l=i.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.SIZE)&&(a=i.vertexAttributes.get(O.SIZE).data[0]);let c=[1,1,1,1],h=0;this.parameters.vvColorEnabled?h=i.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.COLOR)&&(c=i.vertexAttributes.get(O.COLOR).data);let p=0;this.parameters.vvOpacityEnabled&&(p=i.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const f=t.transformation,m=new Float32Array(r.buffer);let y=s*(this.vertexBufferLayout.stride/4);const v=(T,E,C,A)=>{if(m[y++]=T[0],m[y++]=T[1],m[y++]=T[2],m[y++]=C[0],m[y++]=C[1],m[y++]=E[0],m[y++]=E[1],m[y++]=E[2],this.parameters.vvSizeEnabled?m[y++]=l:m[y++]=a,this.parameters.vvColorEnabled)m[y++]=h;else{const I=Math.min(4*A,c.length-4);m[y++]=c[I+0],m[y++]=c[I+1],m[y++]=c[I+2],m[y++]=c[I+3]}this.parameters.vvOpacityEnabled&&(m[y++]=p)};let w;(function(T){T[T.ASCENDING=1]="ASCENDING",T[T.DESCENDING=-1]="DESCENDING"})(w||(w={}));const b=(T,E)=>{const C=ne(pnt,n[3*T],n[3*T+1],n[3*T+2]),A=fnt;let I=T+E;do ne(A,n[3*I],n[3*I+1],n[3*I+2]),I+=E;while(_w(C,A)&&I>=0&&I<o);f&&(ke(C,C,f),ke(A,A,f)),v(C,A,[-1,-1],T),v(C,A,[1,-1],T),v(C,A,[1,1],T),v(C,A,[-1,-1],T),v(C,A,[1,1],T),v(C,A,[-1,1],T)},S=this.parameters.placement;S!=="begin"&&S!=="begin-end"||b(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||b(o-1,w.DESCENDING)}}const pnt=R(),fnt=R(),Zo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},mnt={dash:Zo.dash,"dash-dot":[...Zo.dash,...Zo.dot],dot:Zo.dot,"long-dash":Zo["long-dash"],"long-dash-dot":[...Zo["long-dash"],...Zo.dot],"long-dash-dot-dot":[...Zo["long-dash"],...Zo.dot,...Zo.dot],none:null,"short-dash":Zo["short-dash"],"short-dash-dot":[...Zo["short-dash"],...Zo["short-dot"]],"short-dash-dot-dot":[...Zo["short-dash"],...Zo["short-dot"],...Zo["short-dot"]],"short-dot":Zo["short-dot"],solid:null},gnt=8;function ynt(e,t=2){return M(e)?e:{pattern:e.slice(),pixelRatio:t}}function r2t(e,t=2){return{pattern:[e,e],pixelRatio:t}}function GTe(e){return _(e)&&e.type==="style"?vnt(e.style):null}function vnt(e){return _(e)?ynt(mnt[e],gnt):null}const _nt=["polyline","polygon","extent"];class LU extends Im{constructor(t,i,r,s){super(t,i,r,s),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=cP(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:Du(1);if(t<0)throw new q("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=snt(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,i=!1){var n;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:WH(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:GTe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?F(F({},s),this._fastUpdates.materialParameters):s}get _materialColor(){return Qi(this.symbolLayer.material,t=>t.color)}get _markerColor(){return Qi(this.symbolLayer.marker,t=>t.color)}get lineMaterial(){return M(this._lineMaterial)&&(this._lineMaterial=new VS(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return M(this._ringMaterial)&&(this._ringMaterial=new VS(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return M(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new VS(me(F({},this._getMaterialParameters(!1)),{wireframe:!0})),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return M(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new VS(me(F({},this._getMaterialParameters(!0)),{wireframe:!0})),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return M(this._markerMaterial)&&_(this.symbolLayer.marker)&&_(this._markerTexture)&&(this._markerMaterial=new cnt(me(F({},this._getMaterialParameters(!1,!0)),{placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id})),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=er(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?fo(fit(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Jg(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const i=mi(1,1,1,1);return this._drivenProperties.color&&t.color&&(i[0]=t.color[0],i[1]=t.color[1],i[2]=t.color[2],t.color.length>0&&(i[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(i[3]=t.opacity),i}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Jg(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Jg(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,_nt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Gu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,r,i.uid)}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!uP(this._fastUpdates,i,this._vvConvertOptions))return cn.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return cn.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const i=t.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=WH(ft(i.cap.newValue,"butt")),delete i.cap);const s=this._prepareMarkerPatch(t,i);this._prepareMaterialPatch(t,i,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){return this._forEachMaterial((t,i)=>this._updateMaterialLayerOpacity(t,i)),!0}_forEachMaterial(t){_(this._lineMaterial)&&t(this._lineMaterial),_(this._ringMaterial)&&t(this._ringMaterial),_(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),_(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),_(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,i=!1){const r=t.parameters.color,s=rs(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=mi(r[0],r[1],r[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=g3(LU.elevationModeChangeTypes,r,s);if(n!==Zr.UPDATE)return n;const o=id(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof ui)return $u.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,i,r){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=new Array,c=new Array,h=Hs(),p=Hst(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,o,f,"LineSymbol3DLayer");for(let v=0;v<p.lines.length;v++){const{position:w,mapPosition:b}=p.lines[v];if(_(this._context.clippingExtent)&&(mr(h),Su(h,b),!ap(h,this._context.clippingExtent)))continue;const S=this._createGeometry(t,w,b,n.type,FO.ELEVATED);a.push(S),l.push(n.type==="polygon"?this.ringMaterial:this.lineMaterial),c.push(hn),ji.LINE_WIREFRAMES&&(a.push(S.cloneShallow()),l.push(n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(hn));const T=this.markerMaterial;_(T)&&(a.push(S.cloneShallow()),l.push(T),c.push(hn))}if(a.length===0)return null;const m=new Ly({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),y=new Pm(this,m,a,null,null,Mtt,i);return y.alignedSampledElevation=p.sampledElevation,y.needsElevationUpdates=id(i.mode),y}_createGeometry(t,i,r,s,n){const o=s==="polygon"?Jw.REMOVE:Jw.KEEP,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return qH({overlayInfo:n===FO.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:o,uniformSize:this._uniformSize,attributeData:{position:i,mapPosition:r,size:l?null:this._getDrivenSize(t.renderingInfo),color:a?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,i){const r=t.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const a=ji.LINE_WIREFRAMES?s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;_(a)&&(a.renderPriority=this._renderPriority-.001),_(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=Hs(),p=mr(),f=qst(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if(mr(h),Su(h,y.position),!ap(h,this._context.clippingExtent))continue;F2(p,h);const v=this._createGeometry(t,y.position,null,s.type,FO.DRAPED),w=S=>{const T=new RE(v,S,{layerUid:i,graphicUid:r.uid});return c.push(T),T};if(_(l)){const S=w(l),T=this.symbolLayer.marker.placement;T!=="begin"&&T!=="begin-end"||Su(h,y.position,0,1),T!=="end"&&T!=="begin-end"||Su(h,y.position,y.position.length-3,1),this._updateBoundingSphere(S,h)}const b=w(o);if(this._updateBoundingSphere(b,h),ji.LINE_WIREFRAMES){const S=w(a);this._updateBoundingSphere(S,h)}}return new IU(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,i){Ji(t.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return _(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=ft(t,Du(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?fo(1):1:fo(t)}_prepareMaterialPatch(t,i,r){const s=i.material;if(M(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,t));if(s.type==="collection")return;const n=s.type==="complete"?Qi(s.newValue,a=>a.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(ok(o),this._markerMaterial,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterial,t),delete i.material}_prepareMarkerPatch(t,i){const r=i.marker;if(M(r)||r.type!=="partial"||_(r.diff.style)||_(r.diff.placement)||_(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:M(this._markerColor)};const s=r.diff.color;if(M(s))return delete i.marker,{changed:!1,useMaterialColor:M(this._markerColor)};const n=s.newValue;return M(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,t),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,i,r){M(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:t}))}}var FO;LU.elevationModeChangeTypes={definedChanged:Zr.RECREATE,staysOnTheGround:Zr.NONE,onTheGroundChanged:Zr.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(FO||(FO={}));const nae=2048,bnt=1.5,wnt=8;function xnt(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},o=HQ(e,t.padding),a=$nt(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=Int(e,a),h=Nnt(i),p=Vnt[h];return{format:h,quality:De(r!=null?r:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function Tnt(e,t){const i=xnt(e,t),r=i.area,s=i.width/r.width,n=HQ(i,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],m=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:y}}function Snt(e,t,i){const{ctx:r,canvas:s}=jTe(e,i),n=r.getImageData(0,0,e.width,e.height),o=Ant(s,t);return HTe(s),{dataUrl:o,data:n}}function Ent(e,t){const{ctx:i,canvas:r}=jTe(e,t),s=i.getImageData(0,0,e.width,e.height);return HTe(r),s}function jTe(e,t){const i=Cnt();t.premultipliedAlpha&&knt(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d");return r.putImageData(e,0,0),t.flipY&&Fnt(r),{ctx:r,canvas:i}}function HTe(e){e.width=0,e.height=0}function Cnt(){return M(_B)&&(_B=document.createElement("canvas")),_B}let _B=null;function Ant(e,t){const i=Unt[t.format],r=t.quality/100;return e.toDataURL(i,r)}function bB(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(e5)try{return new ImageData(e,t)}catch{e5=!1}return qTe(e,t,i)}function Mnt(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(e5)try{return new ImageData(e,t,i)}catch{e5=!1}const s=qTe(t,i,r);return s.data.set(e,0),s}function Ont(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,f=n/c,m=o/h,y=Math.ceil(f/2),v=Math.ceil(m/2),w=e.width;for(let b=0;b<h;b++)for(let S=0;S<c;S++){const T=4*(S+(a?h-b-1:b)*c);let E=0,C=0,A=0,I=0,L=0,D=0;const U=(b+.5)*m;for(let z=Math.floor(b*m);z<(b+1)*m;z++){const V=Math.abs(U-(z+.5))/v,X=(S+.5)*f,Z=V*V;for(let ae=Math.floor(S*f);ae<(S+1)*f;ae++){const re=Math.abs(X-(ae+.5))/y,$=Math.sqrt(Z+re*re);if($>=1)continue;let k=2*$*$*$-3*$*$+1;const B=4*(r+ae+(s+z)*w);D+=k*l[B+3],C+=k,!i&&l[B+3]<255&&(k=k*l[B+3]/255),A+=k*l[B],I+=k*l[B+1],L+=k*l[B+2],E+=k}}p[T]=A/E,p[T+1]=I/E,p[T+2]=L/E,p[T+3]=D/C}return t}function Rnt(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,a=HQ(e,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=s-c,f=Math.min(wnt,Math.min((nae-l)/h,(nae-c)/p));return f<bnt?e:me(F({},e),{framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}})}function qTe(e,t,i){return i||(i=Pnt()),i.getContext("2d").createImageData(e,t)}let lA=null,e5=!0;function Pnt(){return lA||(lA=document.createElement("canvas"),lA.width=1,lA.height=1),lA}function Int(e,t){if(!e)return t;const i=e.width,r=e.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return t;const s=t.width/t.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function $nt(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(i.x=Math.floor(e.area.x)),e.area.y!=null&&(i.y=Math.floor(e.area.y));const r=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return Dnt(Lnt(i,e),t)}function Dnt(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function Lnt(e,t){if(!t||t.width==null||t.height==null)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const n=Math.floor(e.height*i);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}function HQ(e,t){return!t||e&&e.ignorePadding?Bnt:t}function Nnt(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return znt}}function Fnt(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function knt(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s!==255&&s>0){const n=255/s;t[r+0]=t[r+0]*n,t[r+1]=t[r+1]*n,t[r+2]=t[r+2]*n}}}const Unt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},oae=98,znt="png",Vnt={png:100,jpg:oae,jpeg:oae},Bnt={top:0,right:0,bottom:0,left:0};var nS;const wB=new WeakMap;let Gnt=0,gf=nS=class extends ve{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:Cw(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[i]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:Cw(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[i]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const i=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(wB.has(this.data)||wB.set(this.data,++Gnt),t(wB.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new nS(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return Mnt(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new nS({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new nS({data:e}):E2(nS,e)}};u([d({type:String,json:{write:o_}})],gf.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],gf.prototype,"data",null),u([Be("data")],gf.prototype,"writeData",null),u([Ue("data")],gf.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],gf.prototype,"transparent",null),u([d({json:{write:!0}})],gf.prototype,"wrap",void 0),u([d({readOnly:!0})],gf.prototype,"contentHash",null),gf=nS=u([P("esri.geometry.support.MeshTexture")],gf);const kO=gf;var XH;let pg=XH=class extends ve{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new XH(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:_(this.color)?this.color.clone():null,colorTexture:_(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:_(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};u([d({type:We,json:{write:!0}})],pg.prototype,"color",void 0),u([d({type:kO,json:{write:!0}})],pg.prototype,"colorTexture",void 0),u([d({type:kO,json:{write:!0}})],pg.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],pg.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],pg.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],pg.prototype,"doubleSided",void 0),pg=XH=u([P("esri.geometry.support.MeshMaterial")],pg);const qQ=pg;var YH;let fg=YH=class extends qQ{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new YH(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return me(F({},super.clonePropertiesWithDeduplication(e)),{emissiveColor:_(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:_(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:_(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:_(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null})}};u([d({type:We,json:{write:!0}})],fg.prototype,"emissiveColor",void 0),u([d({type:kO,json:{write:!0}})],fg.prototype,"emissiveTexture",void 0),u([d({type:kO,json:{write:!0}})],fg.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],fg.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],fg.prototype,"roughness",void 0),u([d({type:kO,json:{write:!0}})],fg.prototype,"metallicRoughnessTexture",void 0),fg=YH=u([P("esri.geometry.support.MeshMaterialMetallicRoughness")],fg);const WTe=fg;var CN;const Qx=ge.getLogger("esri.geometry.support.MeshVertexAttributes");let Qu=CN=class extends ve{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return oS(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},Qx)}castPosition(e){return e&&e instanceof Float32Array&&Qx.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),oS(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},Qx)}castUv(e){return oS(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},Qx)}castNormal(e){return oS(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},Qx)}castTangent(e){return oS(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},Qx)}clone(){const e={position:ie(this.position),uv:ie(this.uv),normal:ie(this.normal),tangent:ie(this.tangent),color:ie(this.color)};return new CN(e)}clonePositional(){const e={position:ie(this.position),normal:ie(this.normal),tangent:ie(this.tangent),uv:this.uv,color:this.color};return new CN(e)}};function xB(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function oS(e,t,i,r,s){if(!e)return e;if(e instanceof t)return xB(e,r,t,s);for(const n of i)if(e instanceof n)return xB(new t(e),r,t,s);if(Array.isArray(e))return xB(new t(e),r,t,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function cA(e,t,i){t[i]=jnt(e)}function jnt(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}u([d({json:{write:cA}})],Qu.prototype,"color",void 0),u([Rt("color")],Qu.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:cA}})],Qu.prototype,"position",void 0),u([Rt("position")],Qu.prototype,"castPosition",null),u([d({json:{write:cA}})],Qu.prototype,"uv",void 0),u([Rt("uv")],Qu.prototype,"castUv",null),u([d({json:{write:cA}})],Qu.prototype,"normal",void 0),u([Rt("normal")],Qu.prototype,"castNormal",null),u([d({json:{write:cA}})],Qu.prototype,"tangent",void 0),u([Rt("tangent")],Qu.prototype,"castTangent",null),Qu=CN=u([P("esri.geometry.support.MeshVertexAttributes")],Qu);var zM;const Hnt=ge.getLogger("esri.geometry.support.MeshComponent");let mg=zM=class extends ve{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return E2(zM,e)}castFaces(e){return oS(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Hnt)}castMaterial(e){return E2(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?WTe:qQ,e)}clone(){return new zM({faces:ie(this.faces),shading:this.shading,material:ie(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:ie(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new zM(i)}};u([d({json:{write:!0}})],mg.prototype,"faces",void 0),u([Rt("faces")],mg.prototype,"castFaces",null),u([d({type:qQ,json:{write:!0}})],mg.prototype,"material",void 0),u([Rt("material")],mg.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],mg.prototype,"shading",void 0),u([d({type:Boolean})],mg.prototype,"trustSourceNormals",void 0),mg=zM=u([P("esri.geometry.support.MeshComponent")],mg);const qnt=mg,NU=ge.getLogger("esri.geometry.support.meshUtils.normalProjection");function Wnt(e,t,i,r,s){return kU(r)?(FU(Kg.TO_PCPF,Hi.fromTypedArray(e),Cs.fromTypedArray(t),Cs.fromTypedArray(i),r,Hi.fromTypedArray(s)),s):(NU.error("Cannot convert spatial reference to PCPF"),s)}function s2t(e,t,i,r,s){return kU(r)?(FU(Kg.FROM_PCPF,Hi.fromTypedArray(e),Cs.fromTypedArray(t),Cs.fromTypedArray(i),r,Hi.fromTypedArray(s)),s):(NU.error("Cannot convert to spatial reference from PCPF"),s)}function n2t(e,t,i){return pr(e,t,0,i,hm(t),0,e.length/3),i}function o2t(e,t,i){return pr(e,hm(i),0,t,i,0,e.length/3),t}function Xnt(e,t,i){if(M(e))return t;const r=Cs.fromTypedArray(e),s=Cs.fromTypedArray(t);return v3(s,r,i),t}function Ynt(e,t,i){if(M(e))return t;uE(Ln,i);const r=Hi.fromTypedArray(e),s=Hi.fromTypedArray(t);return x_(s,r,Ln),FZ(Ln)||NQ(s,s),t}function Znt(e,t,i){if(M(e))return t;uE(Ln,i);const r=Hi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=Hi.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(x_(s,r,Ln),FZ(Ln)||NQ(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function Qnt(e,t,i,r,s){if(!kU(r))return NU.error("Cannot convert spatial reference to PCPF"),s;FU(Kg.TO_PCPF,Hi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),Cs.fromTypedArray(t),Cs.fromTypedArray(i),r,Hi.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function a2t(e,t,i,r,s){if(!kU(r))return NU.error("Cannot convert to spatial reference from PCPF"),s;FU(Kg.FROM_PCPF,Hi.fromTypedArray(e,16),Cs.fromTypedArray(t),Cs.fromTypedArray(i),r,Hi.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function FU(e,t,i,r,s,n){if(!t)return;const o=i.count,a=hm(s);if(XTe(s))for(let l=0;l<o;l++)r.getVec(l,B$),t.getVec(l,jp),ku(a,B$,G$,a),Jh(Ln,G$),e===Kg.FROM_PCPF&&Kh(Ln,Ln),fc(jp,jp,Ln),n.setVec(l,jp);else for(let l=0;l<o;l++){r.getVec(l,B$),t.getVec(l,jp),ku(a,B$,G$,a),Jh(Ln,G$);const c=SF(i.get(l,1));let h=Math.cos(c);e===Kg.TO_PCPF&&(h=1/h),Ln[0]*=h,Ln[1]*=h,Ln[2]*=h,Ln[3]*=h,Ln[4]*=h,Ln[5]*=h,e===Kg.FROM_PCPF&&Kh(Ln,Ln),fc(jp,jp,Ln),we(jp,jp),n.setVec(l,jp)}return n}function kU(e){return XTe(e)||Jnt(e)}function XTe(e){return e.isWGS84||_de(e)||_m(e)||bm(e)}function Jnt(e){return e.isWebMercator}var Kg;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(Kg||(Kg={}));const B$=R(),jp=R(),G$=Ae(),Ln=Pr();function Knt(e){const t=new qi;t.include(Uo),t.include(_x,e),t.include(Wxe,e),Ru(t,e);const{vertex:i,fragment:r}=t;return e.stippleEnabled&&(t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),i.uniforms.add(new ri("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(x`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(x`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new Xe("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):i.code.add(x`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(x`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(x`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(x`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(x`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(x`}`),e.output===K.Highlight&&t.include(Iy),t.include(ys,e),r.uniforms.add(new Xe("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||r.uniforms.add(new ri("constantColor",s=>s.color)),r.code.add(x`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${x.float(Vo)}) {
      discard;
    }

    ${e.output===K.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Highlight?x`outputHighlight();`:""}
  }
  `),t}const eot=Object.freeze(Object.defineProperty({__proto__:null,build:Knt},Symbol.toStringTag,{value:"Module"}));class UU extends fr{constructor(t,i,r){super(t,i,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==K.Highlight}initializeProgram(t){const i=UU.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}initializePipeline(){const t=this.configuration,i=bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Ut({blending:n,depthTest:kQ,depthWrite:o,colorWrite:ti,stencilWrite:t.hasOccludees?ym:null,stencilTest:t.hasOccludees?s?T_:N_:null});return t.output===K.Color?(this._occludeePipelineState=r(!0,t.transparent||this.stippleEnabled?i:null,Il),r(!1,t.transparent||this.stippleEnabled?i:null,Il)):r(!1)}get primitiveType(){return It.LINES}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}UU.shader=new sr(eot,()=>import("./NativeLine.glsl.943c70a0.js"));class Qc extends la{constructor(){super(...arguments),this.output=K.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([j({count:K.COUNT})],Qc.prototype,"output",void 0),u([j()],Qc.prototype,"hasSlicePlane",void 0),u([j()],Qc.prototype,"hasVertexColors",void 0),u([j()],Qc.prototype,"transparent",void 0),u([j()],Qc.prototype,"draped",void 0),u([j()],Qc.prototype,"stippleEnabled",void 0),u([j()],Qc.prototype,"stippleOffColorEnabled",void 0),u([j()],Qc.prototype,"stipplePreferContinuous",void 0),u([j()],Qc.prototype,"hasOccludees",void 0),u([j({constValue:!1})],Qc.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!1})],Qc.prototype,"stippleScaleWithLineWidth",void 0),u([j({constValue:!1})],Qc.prototype,"stippleRequiresStretchMeasure",void 0);const tot=ge.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var t5;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(t5||(t5={}));class aae extends Rm{constructor(t){super(t,new sot),this._techniqueConfig=new Qc}getConfiguration(t,i){this._techniqueConfig.output=t,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=i.slot===Ee.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?yKe(t,s,c,o,1,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||l3(i))return;if(!obe(r))return void tot.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes.get(O.POSITION).data,a=s.camera,l=oot;_o(l,s.point);const c=2;ne(uA[0],l[0]-c,l[1]+c,0),ne(uA[1],l[0]+c,l[1]+c,0),ne(uA[2],l[0]+c,l[1]-c,0),ne(uA[3],l[0]-c,l[1]-c,0);for(let y=0;y<4;y++)if(!a.unprojectFromRenderScreen(uA[y],Bm[y]))return;na(a.eye,Bm[0],Bm[1],TB),na(a.eye,Bm[1],Bm[2],SB),na(a.eye,Bm[2],Bm[3],EB),na(a.eye,Bm[3],Bm[0],CB);let h=Number.MAX_VALUE,p=0;for(let y=0;y<o.length-5;y+=3){if(Aa[0]=o[y]+r[12],Aa[1]=o[y+1]+r[13],Aa[2]=o[y+2]+r[14],Ma[0]=o[y+3]+r[12],Ma[1]=o[y+4]+r[13],Ma[2]=o[y+5]+r[14],cr(TB,Aa)<0&&cr(TB,Ma)<0||cr(SB,Aa)<0&&cr(SB,Ma)<0||cr(EB,Aa)<0&&cr(EB,Ma)<0||cr(CB,Aa)<0&&cr(CB,Ma)<0)continue;if(a.projectToRenderScreen(Aa,c1),a.projectToRenderScreen(Ma,u1),c1[2]<0&&u1[2]>0){pe(Hp,Aa,Ma);const w=a.frustum,b=-cr(w[lr.NEAR],Aa)/Te(Hp,w[lr.NEAR]);ce(Hp,Hp,b),de(Aa,Aa,Hp),a.projectToRenderScreen(Aa,c1)}else if(c1[2]>0&&u1[2]<0){pe(Hp,Ma,Aa);const w=a.frustum,b=-cr(w[lr.NEAR],Ma)/Te(Hp,w[lr.NEAR]);ce(Hp,Hp,b),de(Ma,Ma,Hp),a.projectToRenderScreen(Ma,u1)}else if(c1[2]<0&&u1[2]<0)continue;c1[2]=0,u1[2]=0;const v=FX(cw(c1,u1,uae),l);v<h&&(h=v,le(lae,Aa),le(cae,Ma),p=y/3)}const f=s.rayBegin,m=s.rayEnd;if(h<c*c){let y=Number.MAX_VALUE;if(Fme(cw(lae,cae,uae),cw(f,m,not),l1)){pe(l1,l1,f);const v=Oe(l1);ce(l1,l1,1/v),y=v/hr(f,m)}n(y,l1,p,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(O.POSITION);return jZ(s,null,!1,i)}requiresSlot(t){return t===Ee.OPAQUE_MATERIAL||t===Ee.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Highlight?new iot(t):null}createBufferWriter(){const t=this.parameters.hasVertexColors?uTe:frt;return M(this.parameters.stipplePattern)?new OU(t):new rot(t.clone().vec3f(O.AUXPOS1).vec2f(O.UV0))}}class iot extends I_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output===K.Color&&this._updateOccludeeState(t),this.ensureTechnique(UU,t)}}class rot{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,i,r,s){cU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s),this._writeAuxpos1(t,i,r,s),this._writeUV0(t,i,r,s)}_writeAuxpos1(t,i,r,s){const n=r.getField(O.AUXPOS1,Hi),o=i.indices.get(O.POSITION),a=i.vertexAttributes.get(O.POSITION).data,l=t.transformation,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],v=a[m+1],w=a[m+2],b=l[0]*y+l[4]*v+l[8]*w+l[12],S=l[1]*y+l[5]*v+l[9]*w+l[13],T=l[2]*y+l[6]*v+l[10]*w+l[14];h[s]=b,h[s+1]=S,h[s+2]=T,s+=c}}_writeUV0(t,i,r,s){var E;const n=r.getField(O.UV0,ed),o=i.indices.get(O.POSITION),a=i.vertexAttributes.get(O.POSITION).data,l=(E=i.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:E.data,c=t.transformation,h=n.typedBufferStride,p=n.typedBuffer;let f=0;p[s*=h]=t5.START,p[s+1]=f,s+=h;const m=3*o[0],y=ne(Aa,a[m],a[m+1],a[m+2]);c&&ke(y,y,c);const v=Ma,w=o.length-1;let b=1;const S=l?(C,A,I)=>f=l[I]:(C,A,I)=>f+=hr(C,A);for(let C=1;C<w;C+=2){const A=3*o[C];ne(v,a[A],a[A+1],a[A+2]),c&&ke(v,v,c),S(y,v,b++);for(let I=0;I<2;++I)p[s]=1-I,p[s+1]=f,s+=h;le(y,v)}const T=3*o[w];ne(v,a[T],a[T+1],a[T+2]),c&&ke(v,v,c),S(y,v,b),p[s]=t5.END,p[s+1]=f}}class sot extends mC{constructor(){super(...arguments),this.color=Fh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const Aa=R(),Ma=R(),Hp=R(),l1=R(),c1=Fo(),u1=Fo(),lae=R(),cae=R(),uae=Sm(),not=Sm(),oot=R(),uA=[Fo(),Fo(),Fo(),Fo()],Bm=[R(),R(),R(),R()],TB=vi(),SB=vi(),EB=vi(),CB=vi(),aot=["mesh"];class lot extends Im{constructor(t,i,r,s){super(t,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){ji.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new aae({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new aae({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,aot,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new Gu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(t,i){const r=this._getLayerOpacity();return this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=i(s);_(n)&&n.layerOpacityChanged(r,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,w_)}slicePlaneEnabledChanged(t,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return M(t)?"-":t instanceof We?t.toHex():t.contentHash}_materialPropertiesDefault(t,i){const r=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(t,i,r){const s=this._materialPropertiesDefault(t,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,i.material instanceof WTe){const{metallic:y,roughness:v,metallicRoughnessTexture:w,emissiveColor:b,emissiveTexture:S,occlusionTexture:T}=i.material,E=this._colorOrTextureUid(w),C=this._colorOrTextureUid(b),A=this._colorOrTextureUid(S),I=this._colorOrTextureUid(T);s.metallic=y,s.roughness=v,s.metallicRoughnessTexture=w,s.emissiveColor=b,s.emissiveTexture=S,s.occlusionTexture=T,s.uid=`${s.uid},mrm:${y},mrr:${v},mrt:${E},emuid:${C},etmuid:${A},otmuid:${I}`}return s}_setInternalColorValueParameters(t,i){i.diffuse=We.toUnitRGB(t),i.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const i=this._getInternalTexture(t,ur.Opaque);return _(i)?i.id:null}_getInternalTexture(t,i){const r=this._getLoadableTextureResource(t);if(!r)return null;const s=`${t.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new Ns(r,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:i!==ur.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const i=this._castTextureWrapIndividual(t);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return bt.CLAMP_TO_EDGE;case"mirror":return bt.MIRRORED_REPEAT;default:return bt.REPEAT}}_setInternalMaterialParameters(t,i){if(_(t.color)&&this._setInternalColorValueParameters(t.color,i),_(t.colorTexture)){const r=this._getInternalTexture(t.colorTexture,i.textureAlphaMode);_(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}_(t.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(t.normalTexture)),_(t.emissiveColor)&&(i.emissiveFactor=We.toUnitRGB(t.emissiveColor)),_(t.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),_(t.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),_(t.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const i=this._drivenProperties.color;let r=_(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)t.externalColor=Fh;else{const s=_(this.symbolLayer.material)?this.symbolLayer.material.color:null;_(s)?t.externalColor=We.toUnitRGBA(s):(r=null,t.externalColor=Fh)}r&&(t.colorMixMode=r),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const i=t.vertexAttributes.color;if(M(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(t,i){var y,v,w;const r=(y=i.material)==null?void 0:y.color,s=(v=i.material)==null?void 0:v.colorTexture,n=(w=i.material)==null?void 0:w.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||_(r)&&r.a<1||_(s)&&s.transparent||o),l=this._materialProperties(t,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:za,diffuse:Gf,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:dr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?dr.None:dr.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new Qw(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,i){t.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,i.alphaMode==="auto"?t.textureAlphaMode=t.transparent?ur.MaskBlend:ur.Opaque:t.textureAlphaMode=i.alphaMode==="opaque"?ur.Opaque:i.alphaMode==="mask"?ur.Mask:ur.Blend}_addDebugNormals(t,i,r,s){const n=i.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],c=[],h=[],p=[];for(let y=0;y<n;y++){const v=i[y],w=v.vertexAttributes.get(O.POSITION),b=v.vertexAttributes.get(O.NORMAL),S=v.indices.get(O.POSITION),T=v.indices.get(O.NORMAL),E=w.data,C=b.data;for(let A=0;A<S.length;A++){const I=3*S[A],L=3*T[A];for(let D=0;D<3;D++)l.push(E[I+D]);for(let D=0;D<3;D++)l.push(E[I+D]+C[L+D]*a);if(c.push(c.length),c.push(c.length),A%3==0){this._calculateFaceNormal(E,S,A,eT),this._getFaceVertices(E,S,A,Co,Jx,Kx),de(Co,Co,Jx),de(Co,Co,Kx),ce(Co,Co,1/3);for(let D=0;D<3;D++)h.push(Co[D]);for(let D=0;D<3;D++)h.push(Co[D]+eT[D]*a);p.push(p.length),p.push(p.length)}}}const f=new kr([[O.POSITION,{data:l,size:3,exclusive:!0}]],[[O.POSITION,new Uint32Array(c)]],Al.Line);i.push(f),r.push(this._debugVertexNormalMaterial),s.push(lw(s[0]));const m=new kr([[O.POSITION,{data:h,size:3,exclusive:!0}]],[[O.POSITION,new Uint32Array(p)]],Al.Line);i.push(m),r.push(this._debugFaceNormalMaterial),s.push(lw(s[0]))}_createAs3DShape(t,i,r,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:h}=o;ji.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const p=new Ly({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});p.transformation=h;const f=this._createEdgeMaterial(),m=_(f)?{baseMaterial:l[0],edgeMaterials:[f],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,y=new Pm(this,p,a,null,null,rP,r,m);return y.needsElevationUpdates=w_(r.mode),y.useObjectOriginAsAttachmentOrigin=!0,y.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(p),y.alignedSampledElevation=rP(y,y.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),y}_getCenterPointInElevationSR(t){const i=Dy(0,0,0,this._context.elevationProvider.spatialReference);return ame([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(t,i,r,s){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(t,i,r,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,i,r,s){if(M(i))return this._createComponentNormalsFlat(t,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,eT);for(let a=0;a<3;a++){const l=3*s[o+a];Co[0]=i[l+0],Co[1]=i[l+1],Co[2]=i[l+2],Te(eT,Co)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return{normals:i,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,i){const r=new Float32Array(i.length),s=new Uint32Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(t,i,n,eT);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return{normals:r,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(t,i,o,eT);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:R(),count:0},r[c]=h),de(h.normal,h.normal,a),h.count++}}const s=new Float32Array(3*i.length),n=new Uint32Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(we(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,i,r,s){return this._getFaceVertices(t,i,r,Co,Jx,Kx),pe(Jx,Jx,Co),pe(Kx,Kx,Co),ct(Co,Jx,Kx),we(s,Co),s}_getOrCreateComponents(t){return ft(t.components,cot)}_createPositionBuffer(t,i){let r=t.vertexAttributes.position;const s=i.reprojection===tu.ECEF?i.transformBeforeProject:null;if(_(s)&&(r=Xnt(r,new Float64Array(r.length),s)),i.reprojection===tu.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=_(s)?r:new Float64Array(r.length);return pr(r,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(t,i,r){let s=t.vertexAttributes.normal;if(M(s))return null;const n=r.reprojection===tu.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=Ynt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===tu.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return Wnt(s,o,i,t.spatialReference,a)}_createTangentBuffer(t,i,r){let s=t.vertexAttributes.tangent;if(M(s))return null;const n=r.reprojection===tu.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=Znt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===tu.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return Qnt(s,o,i,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(t),r=STe(rs(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return ETe(i,r,s),s}return null}_createBuffers(t,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(_(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(_(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(_(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===tu.NONE&&_(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===tu.NONE&&_(a.geometryTransformation)?a.geometryTransformation:Ae()}}_computeReprojectionInfo(t){const i=_(t.transform),r=i&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===Ve.Local?tu.NONE:tu.ECEF;if(i){if(r===tu.NONE){const n=Ae();return ku(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:lw(t.transform.localMatrix),needsBufferCopy:!1}}const s=ik(Ae(),t.transform.origin);return jr(s,s,t.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(t,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;j$[0]=o.x,j$[1]=o.y,j$[2]=o.z;const a=Ae();ku(t.spatialReference,j$,a,n);const l=Cs.fromTypedArray(i);if(vs(hae,a),v3(l,l,hae),_(r)||_(s)){if(Jh(hA,a),Kh(hA,hA),_(r)){const c=Hi.fromTypedArray(r);x_(c,c,hA)}if(_(s)){const c=Hi.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);x_(c,c,hA)}}return a}_validateFaces(t,i){const r=t.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,i){return i.faces?i.faces:vE(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return t.spatialReference.equals(r)?s=i:(s=new Float64Array(i.length),pr(t.vertexAttributes.position,t.spatialReference,0,s,r,0,n)),mr(AB),Su(AB,s,0,n),!ap(AB,this._context.clippingExtent)}_createGeometryInfo(t,i){if(!cy(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const r=this._createBuffers(t,i);if(M(r))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:h,geometryTransformation:p}=r,f=this._getOrCreateComponents(t),m=[],y=[],v=[];let w=!1;for(const b of f){if(!this._validateFaces(t,b))return null;const S=this._getOrCreateFaces(t,b);if(S.length===0)continue;const T=this._createComponentNormals(s,l,b,S);T.didFlipNormals&&(w=!0);const E=[[O.POSITION,{size:3,data:s,exclusive:!0}],[O.NORMAL,{size:3,data:T.normals,exclusive:!0}]],C=[[O.POSITION,S],[O.NORMAL,T.indices]];_(o)&&(E.push([O.COLOR,{size:4,data:o,exclusive:!0}]),C.push([O.COLOR,S])),_(a)&&(E.push([O.SYMBOLCOLOR,{size:4,data:a,exclusive:!0}]),C.push([O.SYMBOLCOLOR,new Uint16Array(S.length)])),_(n)&&(E.push([O.UV0,{size:2,data:n,exclusive:!0}]),C.push([O.UV0,S])),_(c)&&(E.push([O.TANGENT,{size:4,data:c,exclusive:!0}]),C.push([O.TANGENT,S]));const A=new kr(E,C);m.push(A),y.push(p),v.push(this._getOrCreateMaterial(t,b))}return w&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:m,transformations:y,materials:v,objectTransformation:h}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return Pxe(this.symbolLayer,t)}}const j$=R(),Co=R(),Jx=R(),Kx=R(),eT=R(),hae=Ae(),hA=Pr(),AB=Hs(),cot=[new qnt];var tu;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(tu||(tu={}));class uot{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const i=this.lodRenderer.instanceData;t!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,i,r){if(this.elevationAligner){RQ(this.elevationContext.featureExpressionInfoContext,r);const s=this.elevationAligner(this,this.elevationContext,t,i);_(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=R()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,qp),ke(t,this.lodRenderer.baseBoundingSphere.center,qp)}getBoundingBoxObjectSpace(t=Hs()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,qp);const i=this.lodRenderer.baseBoundingBox;mr(t);for(let r=0;r<8;++r)ne(Ju,(1&r)==0?i[0]:i[3],(2&r)==0?i[1]:i[4],(4&r)==0?i[2]:i[5]),ke(Ju,Ju,qp),lm(t,Ju);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,qp),t.render.origin[0]+=qp[12],t.render.origin[1]+=qp[13],t.render.origin[2]+=qp[14],t.render.num++}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=hot,l=H5(o)?1:a.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,qp);for(let h=0;h<l;h++){const p=a[h];Ju[0]=o[p[0]],Ju[1]=o[p[1]],Ju[2]=o[p[2]],ke(Ju,Ju,qp),h1[3*h+0]=Ju[0],h1[3*h+1]=Ju[1],h1[3*h+2]=Ju[2]}if(!t(h1,0,l))return null;mr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],h1[h+p]),o[p+3]=Math.max(o[p+3],h1[h+p]);c&&r.push({location:h1.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(op(o,MB),this.elevationContext.mode!=="absolute-height")){let h;const p=MQ(o,i);try{h=await i.service.queryElevation(MB[0],MB[1],s,p,"ground")}catch{}_(h)&&Ppe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,i){if(t===fy.Highlight){const r=new H4(t);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(t){this._highlights.forEach(i=>t.remove(i))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const h1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ju=R(),MB=R(),hot=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],qp=Ae();function dot(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const s=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:s,geometry:i,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function pot(e){return{levels:e.map(t=>dot(t))}}function fot(e,t=got){const i=Htt(e);return Math.sqrt(i/(t*Math.PI))}function mot(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=fot(t))})}const got=.05;function l2t(e){return e=e||globalThis.location.hostname,vot.some(t=>(e==null?void 0:e.match(t))!=null)}function yot(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(YTe)!=null||t.match(QTe)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(ZTe)!=null||t.match(JTe)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const YTe=/^devext.arcgis.com$/,ZTe=/^qaext.arcgis.com$/,QTe=/^[\w-]*\.mapsdevext.arcgis.com$/,JTe=/^[\w-]*\.mapsqa.arcgis.com$/,vot=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,YTe,ZTe,/^jsapps.esri.com$/,QTe,JTe];function _ot(e,t,i){if(e.count!==t.count)return void vU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=i[9],y=i[10],v=i[11],w=i[12],b=i[13],S=i[14],T=i[15],E=e.typedBuffer,C=e.typedBufferStride,A=t.typedBuffer,I=t.typedBufferStride;for(let L=0;L<r;L++){const D=L*C,U=L*I,z=A[U],V=A[U+1],X=A[U+2],Z=A[U+3];E[D]=s*z+l*V+f*X+w*Z,E[D+1]=n*z+c*V+m*X+b*Z,E[D+2]=o*z+h*V+y*X+S*Z,E[D+3]=a*z+p*V+v*X+T*Z}}function KTe(e,t,i){if(e.count!==t.count)return void vU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,w=t.typedBufferStride;for(let b=0;b<r;b++){const S=b*y,T=b*w,E=v[T],C=v[T+1],A=v[T+2],I=v[T+3];m[S]=s*E+a*C+h*A,m[S+1]=n*E+l*C+p*A,m[S+2]=o*E+c*C+f*A,m[S+3]=I}}function bot(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function ZH(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function wot(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:_ot,transformMat3:KTe,normalize:bot,scale:ZH,shiftRight:wot},Symbol.toStringTag,{value:"Module"}));function xot(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:xot},Symbol.toStringTag,{value:"Module"}));function Tot(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Tot},Symbol.toStringTag,{value:"Module"}));function Sot(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function AN(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:Sot,makeDense:AN},Symbol.toStringTag,{value:"Module"}));function eSe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function tSe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(mXe(t.elementType)){const h=gXe(t.elementType);if(fXe(t.elementType))for(let p=0;p<a;++p)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else eSe(e,t,i);return e}function Eot(e,t,i,r){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=r==null?void 0:r.count)!=null?l:e.count;let a=((c=r==null?void 0:r.dstIndex)!=null?c:0)*n;for(let h=0;h<o;++h)s[a]=t,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:eSe,normalizeIntegerBuffer:tSe,fill:Eot},Symbol.toStringTag,{value:"Module"}));function zU(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function Cot(e,t,i,r,s){var c,h;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:zU,fill:Cot},Symbol.toStringTag,{value:"Module"}));function iSe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function rSe(e,t,i,r,s,n){var h,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(h=n==null?void 0:n.count)!=null?h:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let f=0;f<l;++f)o[c]=t,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:iSe,fill:rSe},Symbol.toStringTag,{value:"Module"}));function Lb(e,t){return new e(new ArrayBuffer(t*e.ElementCount*sbe(e.ElementType)))}class sSe{constructor(t){this.streamDataRequester=t}async loadJSON(t,i){return this._load("json",t,i)}async loadBinary(t,i){return xm(t)?(ci(i),Hpe(t)):this._load("binary",t,i)}async loadImage(t,i){return this._load("image",t,i)}async _load(t,i,r){if(M(this.streamDataRequester))return(await gr(i,{responseType:Aot[t]})).data;const s=await Ac(this.streamDataRequester.request(i,t,r));if(s.ok===!0)return s.value;throw by(s.error),new q("",`Request for resource failed: ${s.error}`)}}const Aot={image:"image",binary:"array-buffer",json:"json"},Mot=ge.getLogger("esri.views.3d.glTF");class Oot{error(t){throw new q("gltf-loader-error",t)}errorUnsupported(t){throw new q("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,i){t&&this.errorUnsupported(i)}assert(t,i){t||this.error(i)}warn(t){Mot.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,i){t&&this.warnUnsupported(i)}}function Rot(e={}){return F({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}function Pot(e,t={}){return{data:e,parameters:F({wrap:F({s:bt.REPEAT,t:bt.REPEAT},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}class E_{constructor(t,i,r=""){this.major=t,this.minor=i,this._context=r}lessThan(t,i){return this.major<t||t===this.major&&this.minor<i}since(t,i){return!this.lessThan(t,i)}validate(t){if(this.major!==t.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new q(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new E_(this.major,this.minor,this._context)}static parse(t,i=""){const[r,s]=t.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new q((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new q((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const o=parseInt(r,10),a=parseInt(s,10);return new E_(o,a,i)}}class dae{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const i=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,i,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var UO,pae;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(UO||(UO={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(pae||(pae={}));const nSe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Iot={pbrMetallicRoughness:nSe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},$ot={ESRI_externalColorMixMode:"tint"},fae=(e={})=>{const t=F(F({},nSe),e.pbrMetallicRoughness),i=Dot(F(F({},$ot),e.extras));return me(F(F({},Iot),e),{pbrMetallicRoughness:t,extras:i})};function Dot(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const Lot={magFilter:tt.LINEAR,minFilter:tt.LINEAR_MIPMAP_LINEAR,wrapS:bt.REPEAT,wrapT:bt.REPEAT},Not=e=>F(F({},Lot),e);function Fot(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(t=s||"",i=n||"","")),{dirPart:t,filePart:i}}const H$={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class Mg{constructor(t,i,r,s,n){this.context=t,this.errorContext=i,this.uri=r,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=Fot(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),i.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),i.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,i,r,s){if(xm(r)){const a=Y5(r);if(a.mediaType!=="model/gltf-binary")try{const c=JSON.parse(a.isBase64?atob(a.data):a.data);return new Mg(t,i,r,c)}catch{}const l=Hpe(r);if(Mg._isGLBData(l))return this._fromGLBData(t,i,r,l)}if(r.endsWith(".gltf")){const a=await t.loadJSON(r,s);return new Mg(t,i,r,a)}const n=await t.loadBinary(r,s);if(Mg._isGLBData(n))return this._fromGLBData(t,i,r,n);const o=await t.loadJSON(r,s);return new Mg(t,i,r,o)}static _isGLBData(t){const i=new dae(t);return i.remainingBytes()>=4&&i.readUint32()===H$.MAGIC}static async _fromGLBData(t,i,r,s){const n=await Mg._parseGLBData(i,s);return new Mg(t,i,r,n.json,n.binaryData)}static async _parseGLBData(t,i){const r=new dae(i);t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=r.readUint32(),n=r.readUint32(),o=r.readUint32();t.assert(s===H$.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(i.byteLength>=o,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,l,c=0;for(;r.remainingBytes()>=8;){const h=r.readUint32(),p=r.readUint32();c===0?(t.assert(p===H$.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(h>=0,"No JSON data found."),a=await Got(r.readUint8Array(h))):c===1?(t.errorUnsupportedIf(p!==H$.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=r.readUint8Array(h)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return a||t.error("No GLB JSON chunk detected."),{json:a,binaryData:l}}async getBuffer(t,i){const r=this.json.buffers[t],s=this.errorContext;if(r.uri==null)return s.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const n=await this._getBufferLoader(t,i);return s.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,i){const r=this.bufferLoaders.get(t);if(r)return r;const s=this.json.buffers[t],n=this.context.loadBinary(this._resolveUri(s.uri),i).then(o=>new Uint8Array(o));return this.bufferLoaders.set(t,n),n}async getAccessor(t,i){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];r.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),r.errorUnsupportedIf(s.type in[UO.MAT2,UO.MAT3,UO.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i),a=zot[s.type],l=Vot[s.componentType],c=a*l,h=n.byteStride||c;return{raw:o.buffer,byteStride:h,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:h===c,componentCount:a,componentByteSize:l,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,i){if(t.indices==null)return null;const r=await this.getAccessor(t.indices,i);if(r.isDenselyPacked)switch(r.componentType){case dt.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case dt.UNSIGNED_BYTE:return AN(this._wrapAccessor(gy,r));case dt.UNSIGNED_SHORT:return AN(this._wrapAccessor(Vw,r));case dt.UNSIGNED_INT:return AN(this._wrapAccessor(Gw,r))}}async getPositionData(t,i){const r=this.errorContext;r.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,i);return r.errorUnsupportedIf(s.componentType!==dt.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+W$[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Hi,s)}async getNormalData(t,i){const r=this.errorContext;r.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,i);return r.errorUnsupportedIf(s.componentType!==dt.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+W$[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Hi,s)}async getTangentData(t,i){const r=this.errorContext;r.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,i);return r.errorUnsupportedIf(s.componentType!==dt.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+W$[s.componentType]),r.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new jn(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,i){const r=this.errorContext;r.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,i);return r.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===dt.FLOAT?this._wrapAccessor(ed,s):(r.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),Bot(s))}async getVertexColors(t,i){const r=this.errorContext;r.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,i);if(r.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===dt.FLOAT)return this._wrapAccessor(jn,s);if(s.componentType===dt.UNSIGNED_BYTE)return this._wrapAccessor($l,s);if(s.componentType===dt.UNSIGNED_SHORT)return this._wrapAccessor(f_,s)}else if(s.componentCount===3){if(s.componentType===dt.FLOAT)return this._wrapAccessor(Hi,s);if(s.componentType===dt.UNSIGNED_BYTE)return this._wrapAccessor(p_,s);if(s.componentType===dt.UNSIGNED_SHORT)return this._wrapAccessor(Bw,s)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+W$[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,i,r){let s=this.materialCache.get(t.material);if(!s){const n=t.material!=null?fae(this.json.materials[t.material]):fae(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(t),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(n.normalTexture,i),h=r?this.getTexture(n.occlusionTexture,i):null,p=r?this.getTexture(n.emissiveTexture,i):null,f=r?this.getTexture(o.metallicRoughnessTexture,i):null,m=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:m,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(t,i){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const r=t.index,s=this.errorContext,n=this.json.textures[r],o=Not(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const a=this.json.images[n.source],l=await this._loadTextureImageData(r,n,i);return cW(this.textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>(s.error(`Unexpected TextureSampler WrapMode: ${p}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(o.wrapS)?o.wrapS:h(o.wrapS),wrapT:c(o.wrapT)?o.wrapT:h(o.wrapT),minFilter:o.minFilter,name:a.name,id:r}})}getNodeTransform(t){if(t===void 0)return Uot;let i=this.nodeTransformCache.get(t);if(!i){const r=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?i=jr(Ae(),r,s.matrix):s.translation||s.rotation||s.scale?(i=lw(r),s.translation&&ja(i,i,s.translation),s.rotation&&(q$[3]=R1e(q$,s.rotation),mc(i,i,q$[3],q$)),s.scale&&ek(i,i,s.scale)):i=r,this.nodeTransformCache.set(t,i)}return i}_wrapAccessor(t,i){return new t(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(t){return zh(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=E_.parse(this.json.asset.version,"glTF");kot.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,i=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&i.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,i)=>{t.children&&t.children.forEach(r=>{this.nodeParentMap.set(r,i)})})}async _loadTextureImageData(t,i,r){const s=this.textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(i,r);return this.textureLoaders.set(t,n),n}async _createTextureLoader(t,i){const r=this.json.images[t.source];if(r.uri)return this.context.loadImage(this._resolveUri(r.uri),i);const s=this.errorContext;s.errorUnsupportedIf(r.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(r.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[r.bufferView],o=await this.getBuffer(n.buffer,i);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),jot(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const kot=new E_(2,0,"glTF"),Uot=jfe(Ae(),Math.PI/2),q$=Sy(),zot={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Vot={[dt.BYTE]:1,[dt.UNSIGNED_BYTE]:1,[dt.SHORT]:2,[dt.UNSIGNED_SHORT]:2,[dt.FLOAT]:4,[dt.UNSIGNED_INT]:4};function Bot(e){switch(e.componentType){case dt.BYTE:return new jw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_BYTE:return new zw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.SHORT:return new Hw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_SHORT:return new mE(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_INT:return new gE(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.FLOAT:return new ed(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function Got(e){return new Promise((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function jot(e,t){return new Promise((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image;o.addEventListener("load",()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)):i(o)}),o.addEventListener("error",a=>{URL.revokeObjectURL(n),r(a)}),o.src=n})}const W$={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let Hot=0;async function oSe(e,t,i={},r=!0){const s=await Mg.load(e,MN,t,i),n="gltf_"+Hot++,o={lods:[],materials:new Map,textures:new Map,meta:qot(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await Wot(s,async(c,h,p,f)=>{var D;const m=(D=l.get(p))!=null?D:0;l.set(p,m+1);const y=c.mode!==void 0?c.mode:It.TRIANGLES,v=y===It.TRIANGLES||y===It.TRIANGLE_STRIP||y===It.TRIANGLE_FAN?y:null;if(M(v))return void MN.warnUnsupported("Unsupported primitive mode ("+Qot[y]+"). Skipping primitive.");if(!s.hasPositions(c))return void MN.warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(c,i),b=s.getMaterial(c,i,r),S=s.hasNormals(c)?s.getNormalData(c,i):null,T=s.hasTangents(c)?s.getTangentData(c,i):null,E=s.hasTextureCoordinates(c)?s.getTextureCoordinates(c,i):null,C=s.hasVertexColors(c)?s.getVertexColors(c,i):null,A=s.getIndexData(c,i),I={transform:lw(h),attributes:{position:await w,normal:S?await S:null,texCoord0:E?await E:null,color:C?await C:null,tangent:T?await T:null},indices:await A,primitiveType:v,material:Yot(o,await b,n)};let L=null;_(o.meta)&&_(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(L=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:f,lodThreshold:L},o.lods[p].parts[m]=I});for(const c of o.lods)c.parts=c.parts.filter(h=>!!h);return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{}}}function qot(e){const t=e.json;let i=null;return t.nodes.forEach(r=>{const s=r.extras;_(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function Wot(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),Xot(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=e.getNodeTransform(a);if(MN.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function Xot(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function Yot(e,t,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=Pot(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:Zot.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=Rot({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const MN=new Oot,Zot=[tt.LINEAR_MIPMAP_LINEAR,tt.LINEAR_MIPMAP_NEAREST],Qot=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function Jot(e,t=vE){return typeof e=="number"?t(e):oF(e)||bb(e)?new Uint32Array(e):e}function Kot(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function eat(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=e[0];let n=e[1],o=0;for(let a=0;a<i;++a){const l=e[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}const gg=ge.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function aSe(e,t){const i=await tat(e,t);return{resource:i,textures:await oat(i.textureDefinitions,t)}}async function tat(e,t){const i=_(t)&&t.streamDataRequester;if(i)return iat(e,i,t);const r=await Ac(gr(e,t));if(r.ok===!0)return r.value.data;by(r.error),lSe(r.error)}async function iat(e,t,i){const r=await Ac(t.request(e,"json",i));if(r.ok===!0)return r.value;by(r.error),lSe(r.error.details.url)}function lSe(e){throw new q("",`Request for object resource failed: ${e}`)}function rat(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(gg.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(gg.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(gg.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(gg.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else gg.warn("Indexed geometries must specify faces"),r=!1;break}default:gg.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(gg.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(gg.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function sat(e,t){const i=[],r=[],s=[],n=[],o=e.resource,a=E_.parse(o.version||"1.0","wosr");lat.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions,p=e.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const v=c[y];if(!rat(v))continue;const w=aat(v),b=v.params.vertexAttributes,S=[];for(const D in b){const U=b[D],z=U.values;S.push([D,{data:z,size:U.valuesPerElement,exclusive:!0}])}const T=[];if(v.params.topology!=="PerAttributeArray"){const D=v.params.faces;for(const U in D)T.push([U,new Uint32Array(D[U].values)])}const E=p&&p[w.texture];if(E&&!m.has(w.texture)){const{image:D,params:U}=E,z=new Ns(D,U);n.push(z),m.set(w.texture,z)}const C=m.get(w.texture),A=C?C.id:void 0;let I=s[w.material]?s[w.material][w.texture]:null;if(!I){const D=h[w.material.substring(w.material.lastIndexOf("/")+1)].params;D.transparency===1&&(D.transparency=0);const U=E&&E.alphaChannelUsage,z=D.transparency>0||U==="transparency"||U==="maskAndTransparency",V=E?cSe(E.alphaChannelUsage):void 0,X={ambient:pl(D.diffuse),diffuse:pl(D.diffuse),opacity:1-(D.transparency||0),transparent:z,textureAlphaMode:V,textureAlphaCutoff:.33,textureId:A,initTextureTransparent:!0,doubleSided:!0,cullFace:dr.None,colorMixMode:D.externalColorMixMode||"tint",textureAlphaPremultiplied:!!E&&!!E.params.preMultiplyAlpha};_(t)&&t.materialParamsMixin&&Object.assign(X,t.materialParamsMixin),I=new Qw(X),s[w.material]||(s[w.material]={}),s[w.material][w.texture]=I}r.push(I);const L=new kr(S,T);f+=T.position?T.position.length:0,i.push(L)}return{name:l,stageResources:{textures:n,materials:r,geometries:i},pivotOffset:o.model.pivotOffset,boundingBox:nat(i),numberOfVertices:f,lodThreshold:null}}function nat(e){const t=mr();return e.forEach(i=>{const r=i.boundingInfo;_(r)&&(lm(t,r.getBBMin()),lm(t,r.getBBMax()))}),t}async function oat(e,t){const i=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){gg.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:bt.REPEAT,t:bt.REPEAT},preMultiplyAlpha:cSe(h)!==ur.Opaque},f=_(t)&&t.disableTextures?Promise.resolve(null):Cp(l,t);i.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function cSe(e){switch(e){case"mask":return ur.Mask;case"maskAndTransparency":return ur.MaskBlend;case"none":return ur.Opaque;default:return ur.Blend}}function aat(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const lat=new E_(1,2,"wosr"),tT=2.1;async function uSe(e,t){const i=hSe(yot(e));if(i.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(i.url,t):aSe(i.url,t)),c=sat(l,t);return{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove}}const r=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):oSe(new sSe(t.streamDataRequester),i.url,t,t.usePBR)),s=rs(r.model.meta,"ESRI_proxyEllipsoid");r.meta.isEsriSymbolResource&&_(s)&&r.meta.uri.includes("/RealisticTrees/")&&hat(r,s);const n=r.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!r.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},o=me(F({},t.materialParamsMixin),{treeRendering:!!r.customMeta.esriTreeRendering});if(i.specifiedLodIndex!=null){const l=ON(r,n,o,i.specifiedLodIndex);let c=l[0].boundingBox;return i.specifiedLodIndex!==0&&(c=ON(r,n,o,0)[0].boundingBox),{lods:l,referenceBoundingBox:c,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}const a=ON(r,n,o);return{lods:a,referenceBoundingBox:a[0].boundingBox,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}function hSe(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function ON(e,t,i,r){const s=e.model,n=Pr(),o=new Array,a=new Map,l=new Map;return s.lods.forEach((c,h)=>{if(r!==void 0&&h!==r)return;const p={name:c.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:_(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:mr()};o.push(p),c.parts.forEach(f=>{const m=f.material+(f.attributes.normal?"_normal":"")+(f.attributes.color?"_color":"")+(f.attributes.texCoord0?"_texCoord0":"")+(f.attributes.tangent?"_tangent":""),y=s.materials.get(f.material),v=_(f.attributes.texCoord0),w=_(f.attributes.normal),b=cat(y.alphaMode);if(!a.has(m)){if(v){if(_(y.textureColor)&&!l.has(y.textureColor)){const re=s.textures.get(y.textureColor),$=me(F({},re.parameters),{preMultiplyAlpha:b!==ur.Opaque});l.set(y.textureColor,new Ns(re.data,$))}if(_(y.textureNormal)&&!l.has(y.textureNormal)){const re=s.textures.get(y.textureNormal);l.set(y.textureNormal,new Ns(re.data,re.parameters))}if(_(y.textureOcclusion)&&!l.has(y.textureOcclusion)){const re=s.textures.get(y.textureOcclusion);l.set(y.textureOcclusion,new Ns(re.data,re.parameters))}if(_(y.textureEmissive)&&!l.has(y.textureEmissive)){const re=s.textures.get(y.textureEmissive);l.set(y.textureEmissive,new Ns(re.data,re.parameters))}if(_(y.textureMetallicRoughness)&&!l.has(y.textureMetallicRoughness)){const re=s.textures.get(y.textureMetallicRoughness);l.set(y.textureMetallicRoughness,new Ns(re.data,re.parameters))}}const D=y.color[0]**(1/tT),U=y.color[1]**(1/tT),z=y.color[2]**(1/tT),V=y.emissiveFactor[0]**(1/tT),X=y.emissiveFactor[1]**(1/tT),Z=y.emissiveFactor[2]**(1/tT),ae=_(y.textureColor)&&v?l.get(y.textureColor):null;a.set(m,new Qw(F(me(F({},t),{transparent:b===ur.Blend,customDepthTest:Lw.Lequal,textureAlphaMode:b,textureAlphaCutoff:y.alphaCutoff,diffuse:[D,U,z],ambient:[D,U,z],opacity:y.opacity,doubleSided:y.doubleSided,doubleSidedType:"winding-order",cullFace:y.doubleSided?dr.None:dr.Back,hasVertexColors:!!f.attributes.color,hasVertexTangents:!!f.attributes.tangent,normals:w?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:_(ae)?ae.id:void 0,colorMixMode:y.colorMixMode,normalTextureId:_(y.textureNormal)&&v?l.get(y.textureNormal).id:void 0,textureAlphaPremultiplied:_(ae)&&!!ae.params.preMultiplyAlpha,occlusionTextureId:_(y.textureOcclusion)&&v?l.get(y.textureOcclusion).id:void 0,emissiveTextureId:_(y.textureEmissive)&&v?l.get(y.textureEmissive).id:void 0,metallicRoughnessTextureId:_(y.textureMetallicRoughness)&&v?l.get(y.textureMetallicRoughness).id:void 0,emissiveFactor:[V,X,Z],mrrFactors:[y.metallicFactor,y.roughnessFactor,t.mrrFactors[2]],isSchematic:!1}),i)))}const S=uat(f.indices||f.attributes.position.count,f.primitiveType),T=f.attributes.position.count,E=Lb(Hi,T);v3(E,f.attributes.position,f.transform);const C=[[O.POSITION,{data:E.typedBuffer,size:E.elementCount,exclusive:!0}]],A=[[O.POSITION,S]];if(_(f.attributes.normal)){const D=Lb(Hi,T);uE(n,f.transform),x_(D,f.attributes.normal,n),C.push([O.NORMAL,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),A.push([O.NORMAL,S])}if(_(f.attributes.tangent)){const D=Lb(jn,T);uE(n,f.transform),KTe(D,f.attributes.tangent,n),C.push([O.TANGENT,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),A.push([O.TANGENT,S])}if(_(f.attributes.texCoord0)){const D=Lb(ed,T);tSe(D,f.attributes.texCoord0),C.push([O.UV0,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),A.push([O.UV0,S])}if(_(f.attributes.color)){const D=Lb($l,T);if(f.attributes.color.elementCount===4)f.attributes.color instanceof jn?ZH(D,f.attributes.color,255):f.attributes.color instanceof $l?iSe(D,f.attributes.color):f.attributes.color instanceof f_&&ZH(D,f.attributes.color,1/256);else{rSe(D,255,255,255,255);const U=new p_(D.buffer,0,4);f.attributes.color instanceof Hi?UH(U,f.attributes.color,255):f.attributes.color instanceof p_?zU(U,f.attributes.color):f.attributes.color instanceof Bw&&UH(U,f.attributes.color,1/256)}C.push([O.COLOR,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),A.push([O.COLOR,S])}const I=new kr(C,A);p.stageResources.geometries.push(I),p.stageResources.materials.push(a.get(m)),v&&(_(y.textureColor)&&p.stageResources.textures.push(l.get(y.textureColor)),_(y.textureNormal)&&p.stageResources.textures.push(l.get(y.textureNormal)),_(y.textureOcclusion)&&p.stageResources.textures.push(l.get(y.textureOcclusion)),_(y.textureEmissive)&&p.stageResources.textures.push(l.get(y.textureEmissive)),_(y.textureMetallicRoughness)&&p.stageResources.textures.push(l.get(y.textureMetallicRoughness))),p.numberOfVertices+=T;const L=I.boundingInfo;_(L)&&(lm(p.boundingBox,L.getBBMin()),lm(p.boundingBox,L.getBBMax()))})}),o}function cat(e){switch(e){case"BLEND":return ur.Blend;case"MASK":return ur.Mask;case"OPAQUE":case null:case void 0:return ur.Opaque}}function uat(e,t){switch(t){case It.TRIANGLES:return Jot(e);case It.TRIANGLE_STRIP:return Kot(e);case It.TRIANGLE_FAN:return eat(e)}}function hat(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const s of r.parts){const n=s.attributes.normal;if(M(n))return;const o=s.attributes.position,a=o.count,l=R(),c=R(),h=R(),p=Lb($l,a),f=Lb(Hi,a),m=vs(Ae(),s.transform);for(let y=0;y<a;y++){o.getVec(y,c),n.getVec(y,l),ke(c,c,s.transform),pe(h,c,t.center),xF(h,h,t.radius);const v=h[2],w=Oe(h),b=Math.min(.45+.55*w*w,1);xF(h,h,t.radius),ke(h,h,m),we(h,h),i+1!==e.model.lods.length&&e.model.lods.length>1&&dn(h,h,l,v>-1?.2:Math.min(-4*v-3.8,1)),f.setVec(y,h),p.set(y,0,255*b),p.set(y,1,255*b),p.set(y,2,255*b),p.set(y,3,255)}s.attributes.normal=f,s.attributes.color=p}}}var c2t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetch:uSe,gltfToEngineResources:ON,parseUrl:hSe}),Mr;function dat(e){let t=ls().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.MODEL).mat3f(O.MODELNORMAL).vec2f(O.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(O.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(O.FEATUREATTRIBUTE)),t=t.u8(O.STATE).u8(O.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(Mr||(Mr={}));class pat{constructor(t){this.localTransform=t.getField(O.LOCALTRANSFORM,d_),this.globalTransform=t.getField(O.GLOBALTRANSFORM,d_),this.modelOrigin=t.getField(O.MODELORIGIN,Cs),this.model=t.getField(O.MODEL,Ap),this.modelNormal=t.getField(O.MODELNORMAL,Ap),this.modelScaleFactors=t.getField(O.MODELSCALEFACTORS,ed),this.boundingSphere=t.getField(O.BOUNDINGSPHERE,Uw),this.color=t.getField(O.COLOR,jn),this.featureAttribute=t.getField(O.FEATUREATTRIBUTE,jn),this.state=t.getField(O.STATE,gy),this.lodLevel=t.getField(O.LODLEVEL,gy)}}class fat extends as{constructor(t,i){super(),this._capacity=0,this._size=0,this._next=0,this._layout=dat(t),this._shaderTransformation=i}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,Mr.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const i=this._view.state;pt(t>=0&&t<this._capacity&&i.get(t)&Mr.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,Mr.ACTIVE)?this._setStateFlags(t,Mr.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const i=this._view.state;pt(t>=0&&t<this._capacity&&i.get(t)&Mr.ALLOCATED,"invalid instance handle"),i.set(t,0),this._size--}setLocalTransform(t,i,r=!0){this._view.localTransform.setMat(t,i),r&&this.updateModelTransform(t)}getLocalTransform(t,i){this._view.localTransform.getMat(t,i)}setGlobalTransform(t,i,r=!0){this._view.globalTransform.setMat(t,i),r&&this.updateModelTransform(t)}getGlobalTransform(t,i){this._view.globalTransform.getMat(t,i)}updateModelTransform(t){const i=this._view,r=t0,s=gd;i.localTransform.getMat(t,mae),i.globalTransform.getMat(t,OB);const n=jr(OB,OB,mae);ne(r,n[12],n[13],n[14]),i.modelOrigin.setVec(t,r),Jh(s,n),i.model.setMat(t,s);const o=VDe(t0,n);o.sort(),i.modelScaleFactors.set(t,0,o[1]),i.modelScaleFactors.set(t,1,o[2]),yx(s,s),Kh(s,s),i.modelNormal.setMat(t,s),this._setStateFlags(t,Mr.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,i){const r=this._view;r.model.getMat(t,gd),r.modelOrigin.getVec(t,t0),i[0]=gd[0],i[1]=gd[1],i[2]=gd[2],i[3]=0,i[4]=gd[3],i[5]=gd[4],i[6]=gd[5],i[7]=0,i[8]=gd[6],i[9]=gd[7],i[10]=gd[8],i[11]=0,i[12]=t0[0],i[13]=t0[1],i[14]=t0[2],i[15]=1}applyShaderTransformation(t,i){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i)}getCombinedModelTransform(t,i){return this.getModelTransform(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedLocalTransform(t,i){return this._view.localTransform.getMat(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedMaxScaleFactor(t){let i=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(t0,this,t);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(t){let i=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(t0,this,t);r.sort(),i*=r[1]}return i}getModel(t,i){this._view.model.getMat(t,i)}setFeatureAttribute(t,i){this._view.featureAttribute.setVec(t,i)}getFeatureAttribute(t,i){this._view.featureAttribute.getVec(t,i)}setColor(t,i){this._view.color.setVec(t,i)}getColor(t,i){this._view.color.getVec(t,i)}setVisible(t,i){i!==this.getVisible(t)&&(this._setStateFlag(t,Mr.VISIBLE,i),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,Mr.VISIBLE)}setHighlight(t,i){i!==this.getHighlight(t)&&(this._setStateFlag(t,Mr.HIGHLIGHT,i),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,Mr.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&t&&++i;return i}_setStateFlags(t,i){const r=this._view.state;i=r.get(t)|i,r.set(t,i)}_clearStateFlags(t,i){const r=this._view.state;i=r.get(t)&~i,r.set(t,i)}_setStateFlag(t,i,r){r?this._setStateFlags(t,i):this._clearStateFlags(t,i)}_getStateFlag(t,i){return!!(this._view.state.get(t)&i)}_grow(){const t=Math.max(mat,Math.floor(this._capacity*gat)),i=this._layout.createBuffer(t);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=t,this._buffer=i,this._view=new pat(this._buffer)}_findSlot(){const t=this._view.state;let i=this._next;for(;t.get(i)&Mr.ALLOCATED;)i=(i+1)%this._capacity;return this._next=(i+1)%this._capacity,i}}const mat=1024,gat=2,t0=R(),gd=Pr(),mae=Ae(),OB=Ae();class yat extends dp{constructor(t,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=Cn(),this._tmpMat4=Ae(),this._instanceData=t,this._boundingSphere=i}addInstance(t){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);ke(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*Rw(r),i.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class vat{constructor(t,i){this.thresholdScale=1,this._camera=new ir,this._worldSpaceRadius=t,this._thresholds=i.map(r=>r)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,i){const r=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*i/r,n=this._thresholds;let o=-1;for(let a=0;a<n.length;++a)s>=n[a]*this.thresholdScale&&(o=a);return o}}class _at{constructor(t,i){const r=t.renderContext.rctx,{geometry:s,material:n}=i;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const o=n.createBufferWriter(),a=o.vertexBufferLayout,l=o.elementCount(s),c=o.allocate(l);o.write({},s,c,0),this.geometry=s,this.material=n,this.glMaterials=new Hxe(n,this._materialRepository),this.vertexBufferLayout=a,this.vbo=si.createVertex(r,_i.STATIC_DRAW,c.buffer),this.vao=new qs(r,zi,{geometry:Dc(a)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,r,s,(h,p,f,m,y)=>{if(h>=0){if(i!=null&&!i(t.rayBegin,t.rayEnd,h))return;const v={layerUid:o.layerUid,graphicUid:o.graphicUid(n),geometryId:c,triangleNr:f,baseBoundingSphere:a,numLodLevels:l};if((t.results.min.drapedLayerOrder==null||y>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||h<t.results.min.dist)&&t.results.min.set(Br.LOD,v,h,p,t.transform.transform,y),t.options.store!==yo.MIN&&(t.results.max.drapedLayerOrder==null||y>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||h>t.results.max.dist)&&t.results.max.set(Br.LOD,v,h,p,t.transform.transform,y),t.options.store===yo.ALL){const w=YZ(t.results.min.ray);w.set(Br.LOD,v,h,p,t.transform.transform,y),t.results.all.push(w)}}})}}class WQ{constructor(t,i){this.minScreenSpaceRadius=t,this.components=i}static async create(t,i,r){const s=await Promise.allSettled(i.components.map(o=>t.schedule(()=>new _at(t,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(nn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),ci(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new WQ(i.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(t,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(M(this._boundingBox)){const t=mr();this.components.forEach(i=>{_(i.boundingInfo)&&(lm(t,i.boundingInfo.bbMin),lm(t,i.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(M(this._boundingSphere)){const t=this.boundingBox,i=R();op(t,i),this._boundingSphere={center:i,radius:.5*Rpe(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,i)=>t+i.triangleCount,0)}}class bat{constructor(t,i,r){this._elementSize=i,this._buffer=si.createVertex(t,_i.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,i,r,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(i-t)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,i){const r=t*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(this._array,r,r,s)}resize(t){const i=t*this._elementSize,r=new ArrayBuffer(i);this._array&&(t>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=t}}class wat{constructor(t){this.modelOriginHi=t.getField(O.MODELORIGINHI,Hi),this.modelOriginLo=t.getField(O.MODELORIGINLO,Hi),this.model=t.getField(O.MODEL,Ap),this.modelNormal=t.getField(O.MODELNORMAL,Ap),this.color=t.getField(O.INSTANCECOLOR,jn),this.featureAttribute=t.getField(O.INSTANCEFEATUREATTRIBUTE,jn)}}class gae{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){pt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){pt(this._updating,"not updating"),this.size<Tat*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){pt(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),pt(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){pt(this._updating,"not updating"),pt(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(yae,Math.floor(this._capacity*xat));this._resize(t)}_shrink(){const t=Math.max(yae,Math.floor(this._capacity*Sat));this._resize(t)}_resize(t){if(pt(this._updating,"not updating"),t===this._capacity)return;const i=new bat(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);pt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new wat(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,t),i-r):r>i?(this._buffer.copyRange(r,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const yae=1024,xat=2,Tat=.3,Sat=.5;let Eat=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map(r=>r.minScreenSpaceRadius);return new vat(t,i)};class Cat{constructor(t,i,r,s){this.type=Br.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new ir,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=i,this._metadata=r,this._instanceBufferLayout=$Te({instancedDoublePrecision:!0,instanced:i}),this._glInstanceBufferLayout=Dc(this._instanceBufferLayout,1),this._instanceData=new fat(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),t}get renderStats(){const t=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(t,i){this._context=t;const r=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new gae(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new gae(r,this._instanceBufferLayout)),WQ.create(t,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(nn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),ci(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=Eat(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(i=>i.material.requiresSlot(Ee.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t){if(ji.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const r=t.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(t.bindParameters.contentCamera),r||this._requestUpdateCycle()}const i=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(t.bindParameters.contentCamera,i),this.needsUpdates&&this._context.requestRender()}render(t){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;t.rctx.bindVAO();const i=t.pass!==je.MATERIAL_HIGHLIGHT&&t.pass!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,r=t.pass!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;i&&this._renderComponents(t,this._defaultRenderInstanceData),r&&this._renderComponents(t,this._highlightRenderInstanceData)}intersect(t,i,r,s){if(!this.baseMaterial.isVisible())return;const n=R();pe(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,bae),t.transform.set(bae),ke(wae,r,t.transform.inverse),ke(xae,s,t.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;pt(l&Mr.ACTIVE,"invalid instance state"),pt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(t,i,wae,xae,a,this._metadata,h)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(o):this.octree.forEachAlongRay(r,n,o)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new yat(this._instanceData,this.baseBoundingSphere),i=this._instanceData,r=i.view?i.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)r.get(s)&Mr.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const i=t.eye,r=t.viewForward,s=this.octree.findClosest(r,dp.DepthOrder.FRONT_TO_BACK,t.frustum),n=this.octree.findClosest(r,dp.DepthOrder.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,Wp),pe(Wp,Wp,i);const o=Te(Wp,r)-Wp[3];this._instanceData.view.boundingSphere.getVec(n,Wp),pe(Wp,Wp,i);const a=Te(Wp,r)+Wp[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,i){const r=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(h=>{h.beginUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.beginUpdate()});const n=this._instanceData,o=this._instanceData.view,a=n.size,l=n.capacity;let c=this._instanceIndex;i=Math.min(a,i);for(let h=0;h<i;++h){c===0&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Mr.ALLOCATED)){c=(c+1)%l,i++;continue}const m=o.lodLevel.get(c);if(p&Mr.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&Mr.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&Mr.REMOVE)n.freeInstance(c);else if(p&Mr.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,_ae),y=s.selectLevel(_ae,n.getCombinedMedianScaleFactor(c))),f=p&~(Mr.ACTIVE|Mr.TRANSFORM_CHANGED),y>=0&&(p&Mr.HIGHLIGHT?(vae(this._highlightRenderInstanceData[y],o,c),f|=Mr.HIGHLIGHT_ACTIVE):(vae(this._defaultRenderInstanceData[y],o,c),f|=Mr.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(Mr.ACTIVE|Mr.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octree){const y=!!(p&Mr.ACTIVE),v=!!(f&Mr.ACTIVE);!y&&v?this._octree.addInstance(c):y&&!v?this._octree.removeInstance(c):y&&v&&p&Mr.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%l}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>{h.endUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.endUpdate()})}_renderComponents(t,i){this.levels.forEach((r,s)=>{r.components.forEach(n=>{this._renderComponent(t,i[s],n,s)})})}_renderComponent(t,i,r,s){const n=t.bindParameters;if(i.size===0||!r.material.requiresSlot(n.slot))return;const{rctx:o,pass:a}=t,l=r.glMaterials.load(o,a);if(M(l))return;const c=l.beginSlot(n),h=o.bindTechnique(c,r.material.parameters,n);o.bindVAO(r.vao),c.ensureAttributeLocations(r.vao),c.bindDraw(Mat,n),ji.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===je.MATERIAL&&(h.setUniform4fv("externalColor",Tae[Math.min(s,Tae.length-1)]),h.setUniform1i("colorMixMode",Fwe.replace));const p=o.capabilities.instancing,f=i.capacity,m=i.headIndex,y=i.tailIndex,v=i.firstIndex,w=this._glInstanceBufferLayout,b=(S,T)=>{wZ(o,zi,i.buffer,w,S),p.drawArraysInstanced(c.primitiveType,0,r.vertexCount,T-S),xZ(o,zi,i.buffer,w)};r.material.parameters.transparent&&v!=null?m>y?(pt(v>=y&&v<=m,"invalid firstIndex"),b(v,m),b(y,v)):m<y&&(v<=m?(pt(v>=0&&v<=m,"invalid firstIndex"),b(v,m),b(y,f),b(0,v)):(pt(v>=y&&v<=f,"invalid firstIndex"),b(v,f),b(0,m),b(y,v))):m>y?b(y,m):m<y&&(b(0,m),b(y,f)),o.bindVAO(null)}}function vae(e,t,i){const r=e.allocateHead();Aat(t,i,e.view,r)}function Aat(e,t,i,r){qYe(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const _ae=R(),Wp=Ht(),bae=Ae(),wae=R(),xae=R(),Tae=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],Mat=new Qrt;class Oat extends Im{constructor(t,i,r,s){super(t,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[t,i,r]=_(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:i,height:r}}async doLoad(t){if(!this._drivenProperties.size&&mU(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this.isPrimitive){const r=i.resource?i.resource.primitive:rfe;this._resources=await this._createResourcesForPrimitive(r,t)}else this._resources=await this._createResourcesForUrl(i.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return _(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return rs(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,i=rs(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=r,t.cullFace=s?dr.None:dr.Back,t}async _createResourcesForPrimitive(t,i){if(!Ltt(t))throw new Error(`Unknown object symbol primitive: ${t}`);const r=this.symbolLayer,s=Hs(RPe(t)),n=pl(nI(s)),o=pl(Hz(n,r)),a=Oe(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Gf,diffuse:Gf,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:b,minWorldLength:S,maxWorldLength:T}=f.verticalOffset;h.verticalOffset={screenLength:fo(b),minWorldLength:S||0,maxWorldLength:T!=null?T:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Fh;else{const b=_(r.material)&&r.material.color,S=_(b)?We.toUnitRGBA(b):Fh;h.externalColor=S}this._fastUpdates=cP(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,E1)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color"));const m=new Qw(h),y=Rxe(t,m);if(!y)throw new Error(`Unknown object symbol primitive: ${t}`);const v=M$(y).map(b=>({opacity:1,transparent:b.parameters.transparent})),w=await this._createStageResources(y,p);return{lodResources:y,lodRenderer:await this._createLodRenderer(y,i),stageResources:w,symbolSize:o,extentPadding:a,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:v,physicalBasedRenderingEnabled:p,resourceBoundingBox:s,resourceSize:n,pivotOffset:E1}}async _createResourcesForUrl(t,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=cP(this._context.renderer,this._fastVisualVariableConvertOptions(E1,E1,E1,E1)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:D,minWorldLength:U,maxWorldLength:z}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:fo(D),minWorldLength:U||0,maxWorldLength:z!=null?z:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled;const o=s.usePBR,a=await uSe(t,s),l=a.isEsriSymbolResource,c=a.isWosr;this._addDisposeResource(()=>a.remove());const h=pot(a.lods);mot(h),h.levels.sort((D,U)=>D.minScreenSpaceRadius-U.minScreenSpaceRadius),h.levels[0].minScreenSpaceRadius=Math.min(2,h.levels[0].minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),y=rs(this.symbolLayer,"material","color"),v=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),w=this.needsDrivenTransparentPass,b=M$(h),S=M$(h).map(D=>({opacity:D.parameters.opacity||1,transparent:D.parameters.transparent}));b.forEach(D=>{const U=D.parameters;D.setParameters(m);const z=U.opacity*v,V=z<1||w||U.transparent;D.setParameters({opacity:z,transparent:V}),p.screenSizePerspectiveEnabled&&D.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const T=a.referenceBoundingBox,E=pl(nI(T)),C=pl(h.levels[0].pivotOffset),A=pl(Hz(E,this.symbolLayer)),I=Oe(A);uP(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,A,E,C))&&b.forEach(D=>D.setParameters(this._fastUpdates.materialParameters));const L=await this._createStageResources(h,o);return{lodResources:h,lodRenderer:await this._createLodRenderer(h,i),stageResources:L,symbolSize:A,extentPadding:I,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:S,physicalBasedRenderingEnabled:o,resourceBoundingBox:T,resourceSize:E,pivotOffset:C}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,i){const r=this._context.stage,s=M$(t);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(s),this._addDisposeResource(()=>r.removeMany(s));const n=Gtt(t);r.addMany(n),this._addDisposeResource(()=>r.removeMany(n)),await r.load(n);const o=jtt(t);return r.addMany(o),this._addDisposeResource(()=>r.removeMany(o)),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,X$),Ts(c,HH(this._fastUpdates.materialParameters,X$,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,X$),Lst(a,this._fastUpdates.materialParameters,X$))}:null,o=new Cat(t,this._optionalFields,s,n);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o)}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(t){const i={};return this._drivenProperties.color?i.externalColor=Fh:_(t)&&_(t.color)?i.externalColor=We.toUnitRGBA(t.color):(i.externalColor=Fh,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;const r=nP(i.geometry);if(M(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new Gu),n=t.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(M(this._resources))return!0;const t=this._drivenProperties.opacity,i=!this.isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=rs(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this.isPrimitive&&o.setParameters({cullFace:h?dr.None:dr.Back})}return!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,w_)}slicePlaneEnabledChanged(){if(M(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(M(this._resources))return!0;const{stageResources:t,isWosr:i}=this._resources;for(const r of t.materials)this.isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,i){if(M(this._resources))return cn.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!uP(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return cn.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return cn.Fast_Update}computeComplexity(){return M(this._resources)?super.computeComplexity():{primitivesPerFeature:IQ(this._resources.lodResources.levels[0]).reduce((t,i)=>t+i.indices.get(O.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Lxe(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return _(this._resources)}_createAs3DShape(t,i,r,s,n){if(!this._hasLodRenderer()||M(this._resources))return null;const o=this.getFastUpdateAttrValues(t),a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?$O(r.color,r.opacity):null,l=this._context.clippingExtent;if(Gn(i,iT,this._context.elevationProvider.spatialReference),_(l)&&!ZW(l,iT))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(i,s,RB,Y$),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,Sae),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,p,!1),f.setGlobalTransform(m,h),o&&f.setFeatureAttribute(m,o),a&&f.setColor(m,a);const y=new uot(this,m,Att,s);return c&&(y.alignedSampledElevation=Y$.sampledElevation),y.needsElevationUpdates=w_(s.mode),sP(y,i,this._context.elevationProvider),y}_computeGlobalTransform(t,i,r,s){return vy(t,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),iT[0]=t.x,iT[1]=t.y,iT[2]=s.z,ku(t.spatialReference,iT,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(t,i,r,s){return dm(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(t,r,s),this._applyAnchor(t,i,s),s}_applyObjectScale(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:t.symbolSize,n=Wne(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||ek(r,r,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const i=t.diff.diff;this._preparePatchTransform(t,i),this._preparePatchColor(t,i)}updateGeometry(t,i){if(M(this._resources))return!0;const r=i&&nP(i);if(M(r))return!1;const s=this.getGeometryElevationMode(i);return t.elevationContext.mode===s&&(this._computeGlobalTransform(r,t.elevationContext,RB,Y$),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=Y$.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,RB,!0),sP(t,r,this._context.elevationProvider),!0)}_preparePatchTransform(t,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||M(this._resources))return;const r=(y,v,w)=>ft(y!=null&&y.type==="complete"?y.newValue:v,w),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===du.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=pl(Hz(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((y,v)=>{const w=this._computeLocalTransform(m,f,v,Sae),b=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,w,!0)})}_preparePatchColor(t,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=_(s)?We.toUnitRGBA(s):Fh;delete r.color;const o=this._resources;M(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return gtt(t.heading,t.tilt,t.roll,r)}_computeAnchor(t,i,r){const s=R();switch(r.anchor){case"center":le(s,op(t)),ca(s,s);break;case"top":{const n=op(t);ne(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=op(t);ne(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=op(t),o=nI(t),a=r.anchorPosition,l=a?Fe(a.x,a.y,a.z):za;N5(s,o,l),de(s,s,n),ca(s,s);break}default:_(i)?ca(s,i):le(s,za)}return s}_applyAnchor(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,i);s&&ja(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,i,r,s){const n=_(t)?pl(nI(t)):Gf,o=_(t)?this._computeAnchor(t,s,this.symbolLayer):za,a=this._context.renderCoordsHelper.unitInMeters,l=Wne(_(i)?i:void 0,i,r,a),c=Fe(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:_(i)?i:Gf,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const iT=R(),Sae=Ae(),RB=Ae(),X$=Ht(),Y$=new y3;function Rat(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Pat(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function XQ(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function Iat(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function $at(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*n-s*r;return o?(o=1/o,e[0]=n*o,e[1]=-r*o,e[2]=-s*o,e[3]=i*o,e):null}function Dat(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function Lat(e){return e[0]*e[3]-e[2]*e[1]}function dSe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*a+n*l,e[1]=s*a+o*l,e[2]=r*c+n*h,e[3]=s*c+o*h,e}function Nat(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=s*l+o*a,e[2]=r*-a+n*l,e[3]=s*-a+o*l,e}function Fat(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1];return e[0]=r*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function kat(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function Uat(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function zat(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Vat(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function Bat(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function Gat(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function pSe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function jat(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Hat(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Et*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Et*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Et*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Et*Math.max(1,Math.abs(n),Math.abs(c))}function qat(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Wat(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const Xat=dSe,Yat=pSe;Object.freeze(Object.defineProperty({__proto__:null,copy:Rat,identity:Pat,set:XQ,transpose:Iat,invert:$at,adjoint:Dat,determinant:Lat,multiply:dSe,rotate:Nat,scale:Fat,fromRotation:kat,fromScaling:Uat,str:zat,frob:Vat,LDU:Bat,add:Gat,subtract:pSe,exactEquals:jat,equals:Hat,multiplyScalar:qat,multiplyScalarAndAdd:Wat,mul:Xat,sub:Yat},Symbol.toStringTag,{value:"Module"}));class Zat extends kr{constructor(t,i,r,s,n,o){super(t,i),this.path=r,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=o}}function fSe(e){return"upVectorAlignment"in e}function mSe(){return[1,0,0,1]}function Qat(e){return[e[0],e[1],e[2],e[3]]}function Jat(e,t,i,r){return[e,t,i,r]}function Kat(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:mSe,clone:Qat,fromValues:Jat,createView:Kat},Symbol.toStringTag,{value:"Module"}));function QH(){return{up:R(),right:R()}}function elt(e,t,i){ke(e.up,t.up,i),ke(e.right,t.right,i)}function tlt(e,t,i){di(e,Te(i,t.right),Te(i,t.up))}class ilt{constructor(){this.pos=R(),this.posES=R(),this.posGS=R(),this.vRight=R(),this.vLeft=R(),this.frame=QH(),this.rotationFrame=QH(),this.rotationRight=st(),this.rotationAngle=0,this.miterStretch=mSe()}setFrameFromUpVector(t){le(this.frame.up,t),de(gh,this.vLeft,this.vRight),we(gh,gh),ce(Fd,this.frame.up,Te(gh,this.frame.up)),pe(Q$,gh,Fd),we(Q$,Q$),ct(this.frame.right,Q$,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){le(this.rotationFrame.up,this.frame.up),le(this.rotationFrame.right,this.frame.right),di(this.rotationRight,1,0),ce(Fd,this.frame.up,Te(this.frame.up,this.vLeft)),pe(Fd,this.vLeft,Fd),ca(Fd,Fd),we(Fd,Fd),ce(gh,this.frame.up,Te(this.frame.up,this.vRight)),pe(gh,this.vRight,gh),we(gh,gh),ct(JH,this.rotationFrame.up,this.vLeft);const t=Math.sign(Te(JH,this.vRight));if(this.rotationAngle=t*(Math.PI-pn(Te(Fd,gh))),Math.abs(this.rotationAngle)>0){const r=J8(Math.cos(.5*this.rotationAngle));XQ(this.miterStretch,r-1+1,0,0,1)}const i=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*i))}}class dP{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,i){return this.vertices.push(aM(t)),this.vertexNormals.push(aM(i)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,i=null){return this.poles.push({position:aM(t),normal:i?aM(i):null}),this.poles.length-1}addSegment(t,i=null,r=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),i&&(this.uvIndices.push(i.v0),this.uvIndices.push(i.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,i){for(const r of this.vertices)r[0]+=t,r[1]+=i;for(const r of this.poles)r.position[0]+=t,r.position[1]+=i}static circle(t=20){const r=new dP,s={v0:0,v1:0};r.addPole(Ni(0,0));for(let a=0;a<t;++a){const l=2*a*Math.PI/t,c=Math.cos(l),h=Math.sin(l),p=Ni(c*.5,h*.5),f=Ni(c,h);r.addVertex(p,f),r.addUV(a/t)}r.addUV(1);for(let a=0;a<t-1;++a){const l={v0:a,v1:a+1},c=l;r.addSegment(l,c,s)}const n={v0:t-1,v1:0},o={v0:t-1,v1:t};return r.addSegment(n,o,s),r}static rect(){const r=new dP,s=Ni(.5*-1,.5*-1),n=Ni(.5*1,.5*-1),o=Ni(.5*1,.5*1),a=Ni(.5*-1,.5*1),l=Ni(0,-1),c=Ni(1,0),h=Ni(0,1),p=Ni(-1,0);r.addUV(0),r.addUV(1),r.addPole(Ni(0,.5*1),h),r.addPole(Ni(0,.5*1)),r.addPole(Ni(0,.5*-1)),r.addPole(Ni(0,.5*-1),l);const f={v0:0,v1:1};return r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},f,{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},f,{v0:2,v1:1}),r.addVertex(o,h),r.addVertex(a,h),r.addSegment({v0:4,v1:5},f,{v0:0,v1:0}),r.addVertex(a,p),r.addVertex(s,p),r.addSegment({v0:6,v1:7},f,{v0:1,v1:2}),r}}class rlt{constructor(t){this.vertices=[],this.offset=R(),this.xform=Ae(),this.vertices=t;const i=Math.floor((t.length-1)/2);le(this.offset,this.vertices[i].pos);for(const r of this.vertices)pe(r.pos,r.pos,this.offset);ja(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let i=this.vertices[0];i.index=0,ne(i.vLeft,0,0,0),i.vLeftLength=0,pe(i.vRight,this.vertices[1].pos,i.pos),i.vRightLength=Oe(i.vRight),we(i.vRight,i.vRight);let r=i;for(let s=1;s<t;++s)i=this.vertices[s],i.index=s,le(i.vLeft,r.vRight),i.vLeftLength=r.vRightLength,s<t-1?(pe(i.vRight,this.vertices[s+1].pos,i.pos),i.vRightLength=Oe(i.vRight),we(i.vRight,i.vRight)):(le(i.vRight,i.vLeft),i.vRightLength=i.vLeftLength),r=i}}function slt(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=R(),o=R(),a=R(),l=R(),c=R(),h=R(),p=vi();let f=e.vertices[0];le(o,t),ne(n,0,1,0),sc.makeOrthoBasisDirUpFallback(f.vRight,o,n,n,a,o,s),le(f.frame.up,o),le(f.frame.right,a),i=f;for(let m=1;m<r;++m){f=e.vertices[m],de(c,f.vLeft,f.vRight);let y=Oe(c);y>0?(y=1/Math.sqrt(y),c[0]=c[0]*y,c[1]=c[1]*y,c[2]=c[2]*y):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),de(h,i.pos,i.frame.up),q2(f.pos,c,p),dx(p,Uu(h,f.vLeft),l)?(pe(l,l,f.pos),we(o,l),ct(a,c,o),we(a,a)):sc.makeOrthoBasisDirUpFallback(c,i.frame.up,i.frame.right,n,a,o,s),le(f.frame.up,o),le(f.frame.right,a),i=f}}class nlt{numProfilesPerJoin(){return 1}extrude(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],!1)}}class PB{constructor(t=.8*Math.PI,i=1){this.cutoffAngle=t,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,i,r){const s=dlt;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){Fu(Aae,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),elt(s,t.frame,Aae);for(let o=0;o<i.vertices.length;++o)en(i.vertices[o],t.rotationRight)*t.rotationAngle>=0?r(t.index,s,i.vertices[o],i.vertexNormals[o],!1):(uH(Jb,i.vertices[o],t.miterStretch),r(t.index,t.frame,Jb,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=en(i.vertices[o],t.rotationRight)*t.rotationAngle>=0;uH(Jb,i.vertices[o],t.miterStretch),r(t.index,t.frame,Jb,i.vertexNormals[o],!a)}}}const olt={generateUV:!1};class YQ{rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],0,0)}}class Eae extends YQ{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class Z$ extends YQ{constructor(t,i=0,r=!1){super(),this.profile=t,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,i){const r=ZQ;di(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(t.index,t.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(t,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}}class Cae extends YQ{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,i){const r=t.frame,s=.5*this.sign,n=Jb,o=ZQ;di(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(t.index,r,l.position,l.normal,s,0):i(t.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(t.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];zf(n,this.profile.vertices[p],f.position),dc(n,n,c),f.normal?(Wd(n,n,f.position),i(t.index,r,n,f.normal,s*h,0)):(RR(o,n),dc(o,o,c),Wd(n,n,f.position),i(t.index,r,n,o,s*h,this.sign*h))}}}buildTopology(t,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,y=s+f*this.profile.vertices.length+a;this.flip?(i(m,p,h),i(p,m,y)):(i(h,p,m),i(y,m,p)),h=m,p=y}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}}class alt{constructor(t,i,r,s,n,o=olt){this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=i,this.path=t,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}emitTriangle(t,i,r){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=i,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[i],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=i,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}_rebuildGeometry(){const t=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const t=(o,a,l)=>this.emitTriangle(o,a,l);this._triangleCount=0;const i=this.profile.vertices.length,r=this.profile.numSegments,s=this.numExtrusionProfiles-1;let n=3*(2*(r*s));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=i*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let o=0;o<r;++o){const a=this.profile.vertexIndices[2*o],l=this.profile.vertexIndices[2*o+1];for(let c=0;c<s;++c){const h=c*i+a,p=(c+1)*i+l,f=c*i+l;t(h,(c+1)*i+a,p),t(h,p,f)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class gSe{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class ySe extends gSe{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=clt;ne(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=Fd,l=Jb,c=gh,h=JH,p=hlt;let f=0,m=0;if(ne(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),ne(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),di(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)ct(c,p,h),f=this.builder.profileRightAxisData[o+3]*t[0],m=this.builder.profileUpAxisData[o+3];else{const v=ZQ,w=ult;di(v,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const b=yZ(v);RR(v,v);const S=en(l,v);if(Math.abs(S)>b){di(w,-v[1],v[0]);const T=en(l,w);dc(v,v,b*Math.sign(S)),dc(w,w,T),Wd(l,v,w)}ne(c,0,0,0)}ne(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*f;const y=Jb;di(y,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*y[0]+p[0]*y[1]+c[0]*m,this.vertexAttributeNormal[3*i+1]=h[1]*y[0]+p[1]*y[1]+c[1]*m,this.vertexAttributeNormal[3*i+2]=h[2]*y[0]+p[2]*y[1]+c[2]*m}}createGeometryData(){const t=[[O.POSITION,this.builder.vertexIndices],[O.NORMAL,this.builder.normalIndices]],i=[[O.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[O.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;t.push([O.COLOR,new Uint32Array(r)]),i.push([O.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:i,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,i,r){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},o=s.length/3;h3(t,i,0,o,s,n,void 0,void 0,r)}}class llt extends gSe{constructor(t,i,r,s){super(t),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new ySe(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[O.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[O.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[O.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[O.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[O.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[O.POSITION,this.builder.pathVertexIndices],[O.PROFILERIGHT,this.builder.vertexIndices],[O.PROFILEUP,this.builder.vertexIndices],[O.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[O.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const clt=R(),Jb=st(),ZQ=st(),ult=st(),Fd=R(),gh=R(),JH=R(),hlt=R(),Q$=R(),dlt=QH(),Aae=Ae(),IB=8;function plt(e,t){e.attributes.add(O.FEATUREVALUE,"vec4");const i=e.vertex;i.code.add(x`bool isCapVertex() {
return featureValue.w == 1.0;
}`),i.uniforms.add(new pi("size",r=>r.size)),t.vvSize?(i.uniforms.add(new xt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new xt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new xt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new xt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):i.code.add(x`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",IB),i.uniforms.add([new aa("vvOpacityValues",r=>r.vvOpacityValues,IB),new aa("vvOpacityOpacities",r=>r.vvOpacityOpacities,IB)]),i.code.add(x`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):i.code.add(x`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",yp),i.uniforms.add([new aa("vvColorValues",r=>r.vvColorValues,yp),new uU("vvColorColors",r=>r.vvColorColors,yp)]),i.code.add(x`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):i.code.add(x`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(SU),e.attributes.add(O.PROFILERIGHT,"vec4"),e.attributes.add(O.PROFILEUP,"vec4"),e.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(x`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(x`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(x`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(x`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class flt extends SQ{constructor(){super(...arguments),this.size=Ni(1,1)}}function mlt(e){const t=new qi,i=Ru(t,e),{vertex:r,fragment:s}=t;return t.varyings.add("vpos","vec3"),t.include(plt,e),e.output!==K.Color&&e.output!==K.Alpha||(t.include(Uo),t.include(Yw,e),t.include(w3,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(x`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===K.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(Vu,e),e.output===K.Alpha&&(t.include(ys,e),s.uniforms.add(new Xe("opacity",n=>n.opacity)),s.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===K.Color&&(t.include(ys,e),t.include(Zw,e),t.include(S3,e),t.include(Yw,e),t.include(wTe,e),mm(s,e),s.uniforms.add([i,new xt("ambient",n=>n.ambient),new xt("diffuse",n=>n.diffuse),new xt("specular",n=>n.specular),new Xe("opacity",n=>n.opacity),new Xe("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new xt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),s.constants.add("ambientBoostFactor","float",uC),s.include(Mm),s.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===vt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(Uo,{hasModelTransformation:!1,linearDepth:!0}),r.uniforms.add(new pi("nearFar",(n,o)=>o.camera.nearFar)),t.varyings.add("depth","float"),r.code.add(x`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(ys,e),t.include(L_,e),s.code.add(x`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===K.Normal&&(t.include(Uo),t.include(zv,e),r.uniforms.add(new Er("viewNormal",(n,o)=>o.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(ys,e),s.uniforms.add(new Ua("waterColor")),s.code.add(x`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===K.Highlight&&(t.include(Uo),t.include(zv,e),t.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(ys,e),t.include(Iy),s.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const glt=Object.freeze(Object.defineProperty({__proto__:null,build:mlt},Symbol.toStringTag,{value:"Module"})),vSe=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4]]);class ylt extends flt{constructor(){super(...arguments),this.ambient=Fe(.2,.2,.2),this.diffuse=Fe(.8,.8,.8),this.specular=Fe(0,0,0),this.opacity=1}}class VU extends fr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global,i.doublePrecisionRequiresObfuscation=b3(t.rctx)}initializeProgram(t){const i=VU.shader.get().build(this.configuration);return new nr(t.rctx,i,vSe)}_setPipelineState(t){const i=this.configuration,r=t===vt.NONE,s=t===vt.FrontFace,n=o=>!o.hasSlicePlane&&!(o.transparent||o.doubleSidedMode===Gr.None);return Ut({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.transparent?null:r?Pu:$y(t),culling:n(i)&&f1e,depthTest:{func:D_(t)},depthWrite:r||s?Il:null,colorWrite:ti,stencilWrite:i.hasOccludees?ym:null,stencilTest:i.hasOccludees?N_:null,polygonOffset:r||s?null:pU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}VU.shader=new sr(glt,()=>import("./Path.glsl.c1ca94ed.js"));class $n extends la{constructor(){super(...arguments),this.output=K.Color,this.doubleSidedMode=Gr.None,this.transparencyPassType=vt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([j({count:K.COUNT})],$n.prototype,"output",void 0),u([j({count:Gr.COUNT})],$n.prototype,"doubleSidedMode",void 0),u([j({count:vt.COUNT})],$n.prototype,"transparencyPassType",void 0),u([j()],$n.prototype,"spherical",void 0),u([j()],$n.prototype,"receiveShadows",void 0),u([j()],$n.prototype,"receiveAmbientOcclusion",void 0),u([j()],$n.prototype,"vvSize",void 0),u([j()],$n.prototype,"vvColor",void 0),u([j()],$n.prototype,"vvOpacity",void 0),u([j()],$n.prototype,"hasSlicePlane",void 0),u([j()],$n.prototype,"transparent",void 0),u([j()],$n.prototype,"hasOccludees",void 0),u([j()],$n.prototype,"hasMultipassTerrain",void 0),u([j()],$n.prototype,"cullAboveGround",void 0),u([j()],$n.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j({constValue:Ot.Disabled})],$n.prototype,"pbrMode",void 0),u([j({constValue:!0})],$n.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],$n.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],$n.prototype,"useFillLights",void 0);class QQ extends Rm{constructor(t){super(t,new _lt),this.supportsEdges=!0,this._vertexAttributeLocations=vSe,this._configuration=new $n,this.vertexBufferLayout=QQ.getVertexBufferLayout(this.parameters)}getConfiguration(t,i){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==K.Color&&t!==K.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Gr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Gr.WindingOrder:Gr.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(t){return t!==je.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,i,r,s,n,o,a){const l=t;if(!fSe(l))return;const c=l.path,h=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,S=this.parameters.vvSizeFactor,T=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,C=c.sizeAttributeValue;h[0]*=De(b[0]+C*S[0],T[0],E[0]),h[1]*=De(b[2]+C*S[2],T[2],E[2])}const p=Math.max(h[0],h[1]),f=t.boundingInfo;if(M(f))return void this._intersectTriangles(c,h,n,o,a);const m=Ew(f.bbMin[0]-p,f.bbMin[1]-p,f.bbMin[2]-p,f.bbMax[0]+p,f.bbMax[1]+p,f.bbMax[2]+p),y=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],v=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),w=[v/y[0],v/y[1],v/y[2]];vQ(m,n,w,s.tolerance)&&this._intersectTriangles(c,h,n,o,a)}_intersectTriangles(t,i,r,s,n){t.baked.size&&t.baked.size[0]===i[0]&&t.baked.size[1]===i[1]||t.baked.bake(i),t.baked.intersect(r,s,n)}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=r.get(O.POSITION);return jZ(s,null,!1,i)}createBufferWriter(){return new blt(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?Ee.TRANSPARENT_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Highlight||t.output===K.Shadow&&this.parameters.castShadows?new vlt(t):null}static getVertexBufferLayout(t){let i=ls().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(i=i.vec4f(O.FEATUREVALUE)),i}}class vlt extends I_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(M(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(VU,t)}}class _lt extends ylt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class blt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,i,r,s){const n=o=>{if(i.vertexAttributes.has(o)){const a=i.vertexAttributes.get(o),l=i.indices.get(o);pt(a.size===4);const c=r.getField(o,jn);if(!c)throw new Error("unable to acquire view for "+o);TE(l,a.data,c,s)}};n(O.PROFILERIGHT),n(O.PROFILEUP),n(O.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(O.FEATUREVALUE)&&n(O.FEATUREVALUE),cU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}const wlt=["polyline"];class xlt extends Im{constructor(t,i,r,s){super(t,i,r,s),this._intrinsicSize=Ni(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=_(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=_(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=cP(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=dP.circle(Alt);break;case"quad":this._profile=dP.rect()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new PB(0,Clt);break;case"bevel":this._extruder=new PB(0,1);break;case"miter":this._extruder=new PB(.8*Math.PI,1);break;default:this._extruder=new nlt}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new Eae,this._endCap=new Eae;break;case"butt":default:this._startCap=new Z$(this._profile,0),this._endCap=new Z$(this._profile,0,!0);break;case"square":this._startCap=new Z$(this._profile,-.5),this._endCap=new Z$(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new Cae({profile:this._profile,flip:!1,breakNormals:m,subdivisions:Rae}),this._endCap=new Cae({profile:this._profile,flip:!0,breakNormals:m,subdivisions:Rae});break}}const a=rs(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=pl(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?dr.None:dr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(di(this._intrinsicSize,t,i),!j4(this._intrinsicSize[0])||!j4(this._intrinsicSize[1])))throw new q("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||dc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m=me(F(F({},f),this._fastUpdates.materialParameters),{size:Tme(this._intrinsicSize)});this._material=new QQ(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new Qw(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,wlt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Gu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const t=rs(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:i,transparent:r}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,w_)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!uP(this._fastUpdates,i,this._vvConvertOptions))return cn.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return cn.Fast_Update}getVertexData(t){let i=0;const r=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const m of r)i+=m.length;const l=new Float64Array(3*i),c=new Float64Array(3*i),h=new Float64Array(3*i);let p=0;for(const m of r){s.push({index:p,numVertices:m.length});for(const y of m)l[p++]=y[0],l[p++]=y[1],l[p++]=t.hasZ?y[2]:0}let f=!0;return n.equals(o)?this._copyVertices(l,0,c,0,i):f=pr(l,n,0,c,o,0,i),o.equals(a)?this._copyVertices(c,0,h,0,i):pr(c,o,0,h,a,0,i),{pathVertexDataInfos:s,vertexDataGS:l,vertexDataES:c,vertexDataRS:h,projectionSuccess:f,terrainElevation:0}}_copyVertices(t,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=t[i++],r[s++]=t[i++],r[s++]=t[i++]}_createAs3DShape(t,i,r,s){const n=t.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,h=Hs(),p=this._context.renderCoordsHelper;bSe.spatialReference=c;const f=this.getVertexData(n);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(f.pathVertexDataInfos.length>0){for(let m=0;m<f.pathVertexDataInfos.length;++m){const y=f.pathVertexDataInfos[m],v=y.index,w=y.numVertices;if(w<2||_(this._context.clippingExtent)&&(mr(h),Su(h,f.vertexDataES,3*v,w),!ap(h,this._context.clippingExtent)))continue;const b=[];for(let L=v;L<v+3*w;){const D=L++,U=L++,z=L++,V=new ilt;ne(V.posGS,f.vertexDataGS[D],f.vertexDataGS[U],f.vertexDataGS[z]),ne(V.posES,f.vertexDataES[D],f.vertexDataES[U],f.vertexDataES[z]);const X=ytt(V.posES,this._context.elevationProvider,r,p);ne(kh,f.vertexDataRS[D],f.vertexDataRS[U],f.vertexDataRS[z]),p.setAltitude(kh,X),ne(V.pos,kh[0],kh[1],kh[2]),b.push(V)}const S=new rlt(b);_Se(S,this.upVectorAlignment,this._context.renderCoordsHelper);const T=new alt(S,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const L=this._fastUpdates.visualVariables,D=L.size?Jg(L.size.field,t):0,U=L.color?Jg(L.color.field,t):0,z=L.opacity?Jg(L.opacity.field,t):0;E=new llt(T,D,U,z)}else{const L=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(L[0]*=Mae(i.size[0],i.size[2]==="symbol-value"?this.symbolLayer.height||0:i.size[2],this.symbolLayer.width||0),L[1]*=Mae(i.size[2],i.size[0]==="symbol-value"?this.symbolLayer.width||0:i.size[0],this.symbolLayer.height||0));let D=null;this._drivenProperties.color&&(D=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(D=D?[D[0],D[1],D[2],i.opacity]:[1,1,1,i.opacity]);const U=new ySe(T);U.bake(L),D&&U.bakeVertexColors(D),E=U}const{vertexAttributes:C,indices:A}=E.createGeometryData(),I=new Zat(C,A,E,c,this.upVectorAlignment,this.stencilWidth);o.push(I),a.push(this._material),l.push(E.xform)}if(o.length>0){const m={layerUid:this._context.layer.uid,graphicUid:s},y=new Ly({geometries:o,materials:a,transformations:l,metadata:m}),v=new Pm(this,y,o,null,null,Slt,r);return v.alignedSampledElevation=f.terrainElevation,v.needsElevationUpdates=w_(r.mode),v}}else n.paths.length!==0&&n.paths.some(m=>m.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function _Se(e,t,i){switch(t){case"world":for(const r of e.vertices)de(Xp,r.pos,e.offset),i.worldUpAtPosition(Xp,kh),r.setFrameFromUpVector(kh),r.computeRotationAxisAndAngleFromUpVector();break;case"path":de(Xp,e.vertices[0].pos,e.offset),i.worldUpAtPosition(Xp,kh),slt(e,kh);for(const r of e.vertices){const s=Math.sign(Te(r.frame.right,r.vRight));ct(r.rotationFrame.up,r.vRight,r.vLeft),ce(r.rotationFrame.up,r.rotationFrame.up,s),we(r.rotationFrame.up,r.rotationFrame.up);const n=Te(r.rotationFrame.up,r.frame.up),o=Te(r.rotationFrame.up,r.frame.right);if(ce(Xp,r.frame.up,-o),ce(Oae,r.frame.right,n),de(Xp,Xp,Oae),we(r.rotationFrame.right,Xp),tlt(r.rotationRight,r.frame,r.rotationFrame.right),ca(Xp,r.vLeft),r.rotationAngle=-s*(Math.PI-pn(Te(Xp,r.vRight))),Math.abs(r.rotationAngle)>0){const l=J8(Math.cos(.5*r.rotationAngle));XQ(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(Math.min(r.vLeftLength,r.vRightLength)*J8(Math.cos(.5*a)))}}}function Mae(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function Tlt(e,t,i,r){let s=0;for(const n of e.vertices)vy(n.posES,i,t,r,$B),s+=$B.sampledElevation,de(kh,n.pos,e.offset),r.setAltitude(kh,$B.z),pe(n.pos,kh,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function Slt(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;Elt.spatialReference=r.spatialReference;for(const a of n){const l=a.geometry;if(!fSe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;bSe.spatialReference=p,o+=Tlt(h,t,i,r),l.upVectorAlignment!=="world"&&_Se(h,l.upVectorAlignment,r),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(a)}return o/n.length}const Elt=Dy(0,0,0,null),bSe=Dy(0,0,0,null),kh=R(),Xp=Ci(),Oae=Ci(),$B=new y3,Clt=3,Rae=3,Alt=10;function Mlt(e,t,i,r,s=1){if(i.isGeographic&&r===Ve.Global){const a=new Float64Array(t.typedBuffer.length),l=3*t.count,c=bi(i);for(let h=0;h<l;h+=3)AX(t.typedBuffer,h,a,h,c);t=Cs.fromTypedArray(a)}di(rn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,uc),rn[0]=Math.min(rn[0],uc[0]),rn[1]=Math.min(rn[1],uc[1]);const n=rn[0]%s,o=rn[1]%s;$h[0]=rn[0]-n,$h[1]=rn[1]-o;for(let a=0;a<t.count;a++)t.getVec(a,uc),e.setValues(a,(uc[0]-$h[0])/s,(uc[1]-$h[1])/s,$h[0]/s,$h[1]/s)}function wSe(e,t,i,r,s=1){ne(d1,1,0,0),ne(p1,0,1,0),ne(rT,0,0,1),Plt(DB,t),Olt(t,Pae)&&Rlt(Pae,d1,p1,rT,i,DB),di(rn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),di(f1,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,uc);const c=Te(d1,uc),h=Te(p1,uc);rn[0]=Math.min(rn[0],c),rn[1]=Math.min(rn[1],h),f1[0]=Math.max(f1[0],c),f1[1]=Math.max(f1[1],h)}const n=Te(rT,DB);NB(i0,rn[0],rn[1],n,d1,p1,rT),NB(m1,f1[0],rn[1],n,d1,p1,rT),NB(g1,rn[0],f1[1],n,d1,p1,rT),pe(m1,m1,i0),ce(m1,m1,.5),pe(g1,g1,i0),ce(g1,g1,.5),de(i0,i0,m1),de(i0,i0,g1);const o=rn[0]%s,a=rn[1]%s;$h[0]=rn[0]-o,$h[1]=rn[1]-a;for(let l=0;l<t.count;l++){t.getVec(l,uc),e.setValues(l,(Te(d1,uc)-$h[0])/s,(Te(p1,uc)-$h[1])/s,$h[0]/s,$h[1]/s);for(let c=0;c<3;c++)r.set(l,c,i0[c]),r.set(l,c+3,m1[c]),r.set(l,c+6,g1[c])}}const DB=R(),uc=R(),Pae=vi(),d1=R(),p1=R(),rT=R(),rn=st(),f1=st(),$h=st(),i0=R(),m1=R(),g1=R();function Olt(e,t){const i=e.count-1;return Yme(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function Rlt(e,t,i,r,s,n){_(s)?(s.basisMatrixAtPosition(n,Yp),ne(J$,Yp[0],Yp[1],Yp[2]),ne(K$,Yp[4],Yp[5],Yp[6]),ne(LB,Yp[8],Yp[9],Yp[10])):(ne(J$,1,0,0),ne(K$,0,1,0),ne(LB,0,0,1));const o=e;Te(o,LB)<0&&ce(o,o,-1),le(r,o);const a=Te(o,K$),l=Te(o,J$);Math.abs(a)<Math.abs(l)?(Fb(t,J$,o,-l),we(t,t),ct(i,t,o),we(i,i),ce(i,i,-1)):(Fb(i,K$,o,-a),we(i,i),ct(t,i,o),we(t,t))}const Yp=Ae(),J$=R(),K$=R(),LB=R();function Plt(e,t){ne(eD,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,uc),de(eD,eD,uc);ce(e,eD,1/(t.count-1))}const eD=R();function NB(e,t,i,r,s,n,o){ne(e,t*s[0]+i*n[0]+r*o[0],t*s[1]+i*n[1]+r*o[1],t*s[2]+i*n[2]+r*o[2])}function Ilt(e){const t=new qi,i=e.output===K.Depth,r=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);Ru(t,e),t.include(Uo,{hasModelTransformation:!1,linearDepth:i}),t.include(_x,e),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r&&t.varyings.add("depth","float");const{vertex:s,fragment:n}=t;return i&&(t.include(L_,e),s.uniforms.add(new pi("nearFar",(o,a)=>a.camera.nearFar)),t.varyings.add("linearDepth","float")),s.code.add(x`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(ys,e),r&&t.include(Vu,e),n.include(Mm),n.uniforms.add(new ri("eColor",o=>o.color)),e.output===K.Highlight&&t.include(Iy),n.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${x.float(Vo)}) {
      discard;
    }

    ${e.output===K.Alpha?x`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===K.Color?x`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===vt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===K.Highlight?x`outputHighlight();`:""};
    ${e.output===K.Depth?x`outputDepth(linearDepth);`:""};
  }
  `),t}const $lt=Object.freeze(Object.defineProperty({__proto__:null,build:Ilt},Symbol.toStringTag,{value:"Module"}));class BU extends fr{initializeProgram(t){const i=BU.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}_createPipeline(t,i){const r=this.configuration,s=t===vt.NONE,n=t===vt.FrontFace;return Ut({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.transparent?null:s?Pu:$y(t),culling:Bk(r.cullFace),depthTest:{func:D_(t)},depthWrite:s||n?r.writeDepth&&Il:null,colorWrite:ti,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?T_:N_:null,polygonOffset:s||n?r.polygonOffset&&Dlt:fU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}BU.shader=new sr($lt,()=>import("./ColorMaterial.glsl.c91c7141.js"));const Dlt={factor:1,units:1};class Jc extends la{constructor(){super(...arguments),this.output=K.Color,this.cullFace=dr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=vt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],Jc.prototype,"output",void 0),u([j({count:dr.COUNT})],Jc.prototype,"cullFace",void 0),u([j()],Jc.prototype,"hasSlicePlane",void 0),u([j()],Jc.prototype,"hasVertexColors",void 0),u([j()],Jc.prototype,"transparent",void 0),u([j()],Jc.prototype,"polygonOffset",void 0),u([j()],Jc.prototype,"enableOffset",void 0),u([j()],Jc.prototype,"writeDepth",void 0),u([j()],Jc.prototype,"hasOccludees",void 0),u([j({count:vt.COUNT})],Jc.prototype,"transparencyPassType",void 0),u([j()],Jc.prototype,"hasMultipassTerrain",void 0),u([j()],Jc.prototype,"cullAboveGround",void 0);class Iae extends Rm{constructor(t){super(t,new Nlt),this.supportsEdges=!0,this._configuration=new Jc}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<dU,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(t,i,r,s,n,o,a){aU(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Ee.DRAPED_MATERIAL?!0:Xw(i)===K.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new Llt(t):null}createBufferWriter(){return new OU(uTe)}}class Llt extends I_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(BU,t)}}class Nlt extends mC{constructor(){super(...arguments),this.color=Qf,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=dr.None,this.hasOccludees=!1}}var co;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(co||(co={}));const KH=.70710678118,$ae=KH,Flt=.08715574274;function klt(e){const t=new qi,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const r=e.output===K.Depth,{vertex:s,fragment:n}=t;Ru(t,e),t.include(Uo,{hasModelTransformation:!1,linearDepth:r}),t.include(_x,e),r&&(t.include(L_,e),s.uniforms.add(new pi("nearFar",(a,l)=>l.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?s.uniforms.add(new Xe("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(O.BOUNDINGRECT,"mat3"),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i&&t.varyings.add("depth","float");const o=e.style===co.ForwardDiagonal||e.style===co.BackwardDiagonal||e.style===co.DiagonalCross;return o&&s.code.add(x`
      const mat2 rotate45 = mat2(${x.float(KH)}, ${x.float(-$ae)},
                                 ${x.float($ae)}, ${x.float(KH)});
    `),e.draped||(mm(s,e),s.uniforms.add(new Xe("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),s.code.add(x`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),s.code.add(x`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),s.code.add(x`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${x.float(Flt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),s.code.add(x`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${o?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${o?" * rotate45":""};

      ${e.draped?"":x`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${x.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),s.code.add(x`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${r?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(ys,e),n.include(Mm),e.draped&&n.uniforms.add(new Xe("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===K.Highlight&&t.include(Iy),i&&t.include(Vu,e),e.output!==K.Highlight&&(n.code.add(x`
      const float lineWidth = ${x.float(e.lineWidth)};
      const float spacing = ${x.float(e.patternSpacing)};
      const float spacingINV = ${x.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||n.code.add(x`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new ri("uColor",a=>a.color)),n.code.add(x`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==K.Highlight?x`color.a *= ${Ult(e)};`:""}

      if (color.a < ${x.float(Vo)}) {
        discard;
      }

      ${e.output===K.Alpha?x`gl_FragColor = vec4(color.a);`:""}

      ${e.output===K.Color?x`gl_FragColor = color; ${e.transparencyPassType===vt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===K.Highlight?x`outputHighlight();`:""}
      ${e.output===K.Depth?x`outputDepth(linearDepth);`:""};
    }
  `),t}function Ult(e){function t(i){return e.draped?x`coverage(vuv.${i}, texelSize)`:x`sample(vuv.${i})`}switch(e.style){case co.ForwardDiagonal:case co.Horizontal:return t("y");case co.BackwardDiagonal:case co.Vertical:return t("x");case co.DiagonalCross:case co.Cross:return x`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const zlt=Object.freeze(Object.defineProperty({__proto__:null,build:klt},Symbol.toStringTag,{value:"Module"}));class GU extends fr{initializeProgram(t){const i=GU.shader.get().build(this.configuration);return new nr(t.rctx,i,xSe)}_setPipelineState(t,i){const r=this.configuration,s=t===vt.NONE,n=t===vt.FrontFace;return Ut({blending:r.output===K.Color||r.output===K.Alpha?s?Pu:$y(t):null,culling:Bk(r.cullFace),depthTest:{func:D_(t)},depthWrite:s?r.writeDepth&&Il:hU(t),colorWrite:ti,stencilWrite:r.hasOccludees?ym:null,stencilTest:r.hasOccludees?i?T_:N_:null,polygonOffset:s||n?r.polygonOffset&&Vlt:fU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}GU.shader=new sr(zlt,()=>import("./Pattern.glsl.5c6d1875.js"));const Vlt={factor:1,units:1};class Oa extends la{constructor(){super(...arguments),this.output=K.Color,this.cullFace=dr.None,this.transparencyPassType=vt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],Oa.prototype,"output",void 0),u([j({count:dr.COUNT})],Oa.prototype,"cullFace",void 0),u([j({count:co.COUNT})],Oa.prototype,"style",void 0),u([j({count:vt.COUNT})],Oa.prototype,"transparencyPassType",void 0),u([j()],Oa.prototype,"hasSlicePlane",void 0),u([j()],Oa.prototype,"hasVertexColors",void 0),u([j()],Oa.prototype,"polygonOffset",void 0),u([j()],Oa.prototype,"writeDepth",void 0),u([j()],Oa.prototype,"hasOccludees",void 0),u([j()],Oa.prototype,"patternSpacing",void 0),u([j()],Oa.prototype,"lineWidth",void 0),u([j()],Oa.prototype,"enableOffset",void 0),u([j()],Oa.prototype,"draped",void 0),u([j()],Oa.prototype,"hasMultipassTerrain",void 0),u([j()],Oa.prototype,"cullAboveGround",void 0);const xSe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.BOUNDINGRECT,5]]);class JQ extends Rm{constructor(t){super(t,new jlt),this.supportsEdges=!0,this._vertexAttributeLocations=xSe,this.techniqueConfig=new Oa}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<dU,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a){aU(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Ee.DRAPED_MATERIAL?!0:Xw(i)===K.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new Blt(t):null}createBufferWriter(){const t=ls().vec3f(O.POSITION).vec4u8(O.COLOR).vec4f(O.UVMAPSPACE);return this.parameters.draped||t.mat3f(O.BOUNDINGRECT),new Glt(t)}}class Blt extends I_{_updateParameters(t){return this.ensureTechnique(GU,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class Glt extends OU{write(t,i,r,s){for(const n of this.vertexBufferLayout.fieldNames){const o=i.vertexAttributes.get(n),a=i.indices.get(n);if(o&&a)switch(n){case O.POSITION:{pt(o.size===3);const l=r.getField(n,Hi);l&&lU(a,o.data,t.transformation,l,s);break}case O.COLOR:{pt(o.size===3||o.size===4);const l=r.getField(n,$l);l&&U4(a,o.data,o.size,l,s);break}case O.UVMAPSPACE:{pt(o.size===4);const l=r.getField(n,jn);l&&TE(a,o.data,l,s);break}case O.BOUNDINGRECT:{pt(o.size===9);const l=r.getField(n,Ap);l&&this.writeBoundingRect(a,o.data,t.transformation,l,s);break}}}}writeBoundingRect(t,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],f=i[p],m=i[p+1],y=i[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let v=3;v<9;++v)a[n+v]=i[p+v];n+=l}}}class jlt extends mC{constructor(){super(...arguments),this.color=mi(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=dr.None,this.hasOccludees=!1,this.style=co.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Hlt(e,t,i){return Wlt(qlt(e),t,i)}function qlt(e){return e&&e.pattern||null}function Wlt(e,t,i){return _(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=mi(0,0,0,0),t.transparent=!0),new Iae(t)):(t.style=Xlt(e.style),t.draped=i.isDraped,new JQ(t)):new Iae(t)}function Xlt(e){switch(e){case"horizontal":return co.Horizontal;case"vertical":return co.Vertical;case"cross":return co.Cross;case"forward-diagonal":return co.ForwardDiagonal;case"backward-diagonal":return co.BackwardDiagonal;case"diagonal-cross":return co.DiagonalCross;default:return}}function Ylt(e){return e.material instanceof JQ&&!e.material.parameters.draped}function Zlt(e,t){if(Ylt(e)){const i=e.geometry.vertexAttributes,r=i.get(O.POSITION).data,s=i.get(O.UVMAPSPACE).data,n=i.get(O.BOUNDINGRECT).data;wSe(jn.fromTypedArray(s),Cs.fromTypedArray(r),t,h_.fromTypedArray(n))}}function Qlt(e,t,i,r){const s=Sxe(e,t,i,r),n=e.stageObject.geometryRecords;for(let o=0;o<n.length;o++)Zlt(n[o],r);return s}const Jlt=["polyline","polygon","extent"];class jU extends Im{constructor(t,i,r,s){super(t,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(_(this._material))return;const t=rs(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._material=Hlt(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof JQ,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(_(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const i=r=>{const s=GTe(t.pattern);return new VS({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:WH(t.patternCap||"butt")})};this._outlineMaterial=i(fo(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return _(t)&&t.size&&t.size>0&&_(t.color)&&(M(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Jlt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Gu);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(_(this._material)){const t=this._material.parameters.color,i=rs(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(_(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=g3(jU.elevationModeChangeTypes,r,s);if(n!==Zr.UPDATE)return n;const o=id(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){if(_(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),_(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=aP(t.geometry);if(M(s))return null;mn.renderData=GQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),mn.color=i;const n=mn.renderData.position.length/3;if(this._needsUV&&(mn.uvMapSpace=new Float32Array(4*n),mn.boundingRect=new Float64Array(9*n)),mn.outNum=0,mn.outGeometries=[],mn.outTransforms=[],mn.outMaterials=[],this._createAs3DShapeFill(mn),this._hasOutline&&this._createAs3DShapeOutline(mn),this._logGeometryCreationWarnings(mn.renderData,s.rings,"rings","FillSymbol3DLayer"),mn.outNum===0)return null;this._needsUV&&wSe(jn.fromTypedArray(mn.uvMapSpace),Cs.fromTypedArray(mn.renderData.position),this._context.renderCoordsHelper,h_.fromTypedArray(mn.boundingRect));const o=new Ly({geometries:mn.outGeometries,materials:mn.outMaterials,transformations:mn.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),a=new Pm(this,o,mn.outGeometries,null,null,Qlt,r);return a.alignedSampledElevation=mn.renderData.sampledElevation,a.needsElevationUpdates=id(r.mode),a}_createAs3DShapeFill(t){const i=t.renderData.polygons;for(const{position:r,mapPosition:s,holeIndices:n,index:o,count:a}of i){if(_(this._context.clippingExtent)&&(mr(ya),Su(ya,s),!ap(ya,this._context.clippingExtent)))continue;const l=CE(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=Voe({indices:c,attributeData:{position:r,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*o*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*o*t.boundingRect.BYTES_PER_ELEMENT,9*a):null}});t.outGeometries.push(h),t.outMaterials.push(this._material),t.outTransforms.push(hn),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPosition:s,position:n}=i[r];if(_(this._context.clippingExtent)&&(mr(ya),Su(ya,s),!ap(ya,this._context.clippingExtent)))continue;const o=qH({overlayInfo:null,removeDuplicateStartEnd:Jw.REMOVE,attributeData:{position:n,mapPosition:s}}),a=o.vertexAttributes.get(O.POSITION);a.data===n&&(a.data=new Float64Array(n)),t.outGeometries.push(o),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(hn),t.outNum++}}_createAsOverlay(t,i){const r=aP(t.geometry);if(M(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,_(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Ao.renderData=vTe(r,this._context.overlaySR),Ao.color=i;const s=Ao.renderData.position.length/3;return this._needsUV&&(Ao.uvMapSpace=new Float32Array(4*s)),Ao.outNum=0,Ao.outGeometries=[],Ao.outBoundingBox=mr(),Ao.layerUid=this._context.layer.uid,Ao.graphicsUid=t.uid,this._createAsOverlayFill(Ao),this._hasOutline&&this._createAsOverlayOutline(Ao),this._logGeometryCreationWarnings(Ao.renderData,r.rings,"rings","FillSymbol3DLayer"),Ao.outNum===0?null:(this._needsUV&&Mlt(jn.fromTypedArray(Ao.uvMapSpace),Cs.fromTypedArray(Ao.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),Ao.outNum>0?new IU(this,Ao.outGeometries,Ao.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(t){const i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){if(mr(ya),Su(ya,r),!ap(ya,this._context.clippingExtent))continue;const a=CE(r,s,3);if(a.length===0)continue;F2(t.outBoundingBox,ya);const l=new Uint32Array(a),c=Voe({indices:l,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null}}),h=new RE(c,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),p=ya;Ji(h.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),t.outGeometries.push(h),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(mr(ya),Su(ya,s),!ap(ya,this._context.clippingExtent))continue;F2(t.outBoundingBox,ya);const n=qH({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:Jw.REMOVE,attributeData:{position:s}}),o=new RE(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),a=ya;Ji(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o),t.outNum++}}_getOutlineOpacity(){const t=rs(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(_(t)?t.a:0)}_getOutlineColor(){const t=rs(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return $O(_(t)?We.toUnitRGB(t):null,i)}test(){return me(F({},super.test()),{createAsOverlay:(t,i)=>this._createAsOverlay(t,i),createAs3DShape:(t,i,r)=>this._createAs3DShape(t,i,r)})}}jU.elevationModeChangeTypes={definedChanged:Zr.RECREATE,staysOnTheGround:Zr.NONE,onTheGroundChanged:Zr.RECREATE};const ya=Hs(),mn={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Ao={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Klt=ge.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class HU{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const i=this.definition.font;return`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()},${t[3]})`}static async fromSymbol(t,i=1){const r=rs(t,"material","color"),s=fu(r,Qf,We.toUnitRGBA),n=fu(t.size,12,fo),o=t.lineHeight,a=_(t.background)?We.toUnitRGBA(t.background.color):Qf,l={family:fu(t.font,"sans-serif",m=>m.family),decoration:fu(t.font,"none",m=>m.decoration),weight:fu(t.font,"normal",m=>m.weight),style:fu(t.font,"normal",m=>m.style)},c=t.halo,h=_(c)&&_(c.color)&&c.size>0?{size:fo(c.size),color:We.toUnitRGBA(c.color)}:{size:0,color:Qf},p=new HU({color:s,size:n,background:{color:a,padding:_(t.background)?[.65*n,.5*n]:[0,0],borderRadius:_(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=p.fontString(n);try{await document.fonts.load(f)}catch{Klt.warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class ect{constructor(t,i,r){this._renderer=new DTe(t,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=SN(tct,this._renderer.renderedWidth,this._renderer.renderedHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new Ns(t,{wrap:{s:bt.CLAMP_TO_EDGE,t:bt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Zv.PAD})}}const tct={canvas:null},ict=[0,0,1];class rct extends Im{constructor(t,i,r,s){super(t,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=mU(this.symbolLayer.size);if(t)throw new q("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await HU.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const i=t.graphic,r=nP(i.geometry);if(M(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(M(s)||s==="")return null;const n=gX(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(_(n)&&!cfe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=me(F({},oct),{verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:Ast(this.symbolLayer.verticalAlignment)});return this._createAs3DShape(i,r,s,o)}createLabel(t,i,r,s){const n=t.graphic,o=nP(n.geometry);if(M(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,i){return Dae(t,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Zr.UPDATE}slicePlaneEnabledChanged(t,i){return Dae(t,i,r=>{for(const s of r.stageObject.geometryRecords)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=id(i.elevationContext.mode)||i.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return nct}_createAs3DShape(t,i,r,s,n,o){const a=this.setGraphicElevationContext(t,new Gu,s.elevationOffset),l=rs(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(M(o)){const V=NTe(s.horizontalPlacement);h=new ect(r,V,this._textRenderParameters);let X=null;p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{_(X)&&X.release()});const Z=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(M(Z)||Bu(Z))return p.release(),null;X=Z}const f=sct(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(_(p)&&(m.textureId=p.texture.id),_(o)&&(m.textureId=o.id),_(s.verticalOffset)){const{screenLength:V,minWorldLength:X,maxWorldLength:Z}=s.verticalOffset;m.verticalOffset={screenLength:fo(V),minWorldLength:X||0,maxWorldLength:Z!=null?Z:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:V,screenSizePerspectiveSettingsLabels:X}=this._context.sharedResources;m.screenSizePerspective=X.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=V}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,_(n)){const V=JSON.stringify(m);y=n.get(V),M(y)&&(y=new SE(m),n.add(V,y))}else y=new SE(m);const v=[y],w=s.translation,b=_(h)?[h.displayWidth,h.displayHeight]:[0,0],S=s.centerOffset,T=ict,E=[0,0],C=[sc.createPointGeometry(T,w,null,b,S,E,null)],A=this._context.layer.uid,I=LQ(this._context,i,C,v,a,A,c);if(I===null)return null;const L=new Pm(this,I.object,C,M(n)?v:null,p,rP,a);L.alignedSampledElevation=I.sampledElevation,L.needsElevationUpdates=id(a.mode)||a.mode==="absolute-height";const{displayWidth:D,displayHeight:U}=_(h)?h:s;L.getScreenSize=(V=st())=>(V[0]=D,V[1]=U,V);const z={labelText:r,elevationOffset:s.elevationOffset};return L.metadata=z,sP(L,i,this._context.elevationProvider),L}}function Dae(e,t,i){e&&e.forEach(r=>{const s=t(r);_(s)&&i(s,r.graphic)})}function sct(e,t){if(t.verticalPlacement==="baseline"){const r=Sst[t.horizontalPlacement],s=_(e)?e.baselineAnchorY:0;return Ni(r,s)}const i=Cst(t.horizontalPlacement,t.verticalPlacement);return EN[i]}const nct={mode:"relative-to-ground",offset:0},oct={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},act={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},lct=["polyline","polygon","extent"];class Nf extends Im{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,lct,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Gu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(_(this._material))return;const t=new dTe,i=this.symbolLayer.color;_(i)&&(t.color=We.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],r],t.transparent=r<1||this.needsDrivenTransparentPass,t.waveDirection=_(this.symbolLayer.waveDirection)?Nf.headingVectorFromAngle(this.symbolLayer.waveDirection):Ni(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=act[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new hTe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(M(this._material))return!0;const t=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:r}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=g3(Nf.elevationModeChangeTypes,r,s);if(n!==Zr.UPDATE)return n;const o=id(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return _(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=aP(t.geometry);if(M(s))return null;Qo.renderData=GQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);const n=Qo.renderData.position.length/3;if(Qo.uvCoords=new Float64Array(2*n),Qo.outNum=0,Qo.outGeometries=[],Qo.outTransforms=[],Qo.outMaterials=[],this._create3DShapeGeometries(Qo),this._logGeometryCreationWarnings(Qo.renderData,s.rings,"rings","WaterSymbol3DLayer"),Qo.outNum===0)return null;this._createUVCoordsFromVertices(Qo.uvCoords,Qo.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const o=new Ly({geometries:Qo.outGeometries,materials:Qo.outMaterials,transformations:Qo.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),a=new Pm(this,o,Qo.outGeometries,null,null,Sxe,i);return a.alignedSampledElevation=Qo.renderData.sampledElevation,a.needsElevationUpdates=id(i.mode),a}_createUVCoordsFromVertices(t,i,r,s){const n=Ic(s);Lu(r0);for(let l=0;l<r;l++)di(Lae,i[3*l+0],i[3*l+1]),JS(r0,Lae);IP(r0,r0,n);const o=r0[0]%Nf.unitSizeOfTexture,a=r0[1]%Nf.unitSizeOfTexture;tD[0]=r0[0]-o,tD[1]=r0[1]-a;for(let l=0;l<r;l++)t[2*l+0]=(i[3*l+0]*n-tD[0])/Nf.unitSizeOfTexture,t[2*l+1]=(i[3*l+1]*n-tD[1])/Nf.unitSizeOfTexture}_create3DShapeGeometries(t){const i=t.renderData.polygons,r=t.uvCoords;for(const{count:s,index:n,position:o,mapPosition:a,holeIndices:l}of i){if(_(this._context.clippingExtent)&&(mr(s0),Su(s0,a),!ap(s0,this._context.clippingExtent)))continue;const c=CE(a,l,3);if(c.length===0)continue;const h=new Uint32Array(c),p=new Float64Array(r.buffer,2*n*r.BYTES_PER_ELEMENT,2*s),f=Boe({indices:h,attributeData:{position:o,uv0:p,mapPosition:a}});t.outGeometries.push(f),t.outMaterials.push(this._material),t.outTransforms.push(hn),t.outNum++}}_createAsOverlay(t){const i=aP(t.geometry);if(M(i))return null;this._material.renderPriority=this._renderPriority,va.renderData=vTe(i,this._context.overlaySR);const r=va.renderData.position.length/3;return va.uvCoords=new Float64Array(2*r),va.outNum=0,va.outGeometries=[],va.outBoundingBox=mr(),va.layerUid=this._context.layer.uid,va.graphicsUid=t.uid,this._createAsOverlayWater(va),this._logGeometryCreationWarnings(va.renderData,i.rings,"rings","WaterSymbol3DLayer"),va.outNum===0?null:(this._createUVCoordsFromVertices(va.uvCoords,va.renderData.position,r,this._context.overlaySR),va.outNum>0?new IU(this,va.outGeometries,va.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(t){const i=t.uvCoords,r=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(mr(s0),Su(s0,s),!ap(s0,this._context.clippingExtent))continue;F2(t.outBoundingBox,s0);const l=CE(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=new Float64Array(i.buffer,2*o*i.BYTES_PER_ELEMENT,2*a),p=Boe({indices:c,attributeData:{position:s,uv0:h}}),f=new RE(p,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),m=s0;Ji(f.boundingSphere,.5*(m[0]+m[3]),.5*(m[1]+m[4]),0,.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]))),t.outGeometries.push(f),t.outNum++}}static headingVectorFromAngle(t){const i=st(),r=L5(t);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return me(F({},super.test()),{create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()})}}Nf.unitSizeOfTexture=100,Nf.elevationModeChangeTypes={definedChanged:Zr.RECREATE,staysOnTheGround:Zr.NONE,onTheGroundChanged:Zr.RECREATE};const tD=st(),r0=Nt(),Lae=st(),s0=Hs(),Qo={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},va={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},cct=ge.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function uct(e,t,i,r){const s=Nae[e.type]&&Nae[e.type][t.type]||hct[t.type];return s?new s(e,t,i,r):(cct.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const hct={icon:hP,object:Oat,line:LU,path:xlt,fill:jU,extrude:hst,text:rct,water:Nf},Nae={"mesh-3d":{fill:lot}};class dct extends PQ{constructor(t,i,r){super(i.schedule),this._symbol=t,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let i=0;i<t.symbolLayers.length;i++){const r=this.symbolLayers[i];M(r)||(r.symbol=t,r.symbolLayer=t.symbolLayers.items[i])}}get symbol(){return this._symbol}async doLoad(t){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;iD.renderPriority=1-(1+n)/r,iD.renderPriorityStep=1/r,iD.ignoreDrivers=o._ignoreDrivers;const a=uct(this.symbol,o,this._context,iD);s.push(I5(t,()=>{this.symbolLayers[n]=null,a.destroy()})),this.symbolLayers[n]=a}await _k(this.symbolLayers,async(n,o)=>{if(_(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}});for(const n of s)n==null||n.remove();if(s.length=0,ci(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const i=this.symbolLayers[t];return _(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,i){const r=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=_(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new lit(r,i||this,s,t.layer,n)}get complexity(){return DQ(this.symbolLayers.map(t=>rs(t,"complexity")))}globalPropertyChanged(t,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.graphics[s];return l instanceof Pm?l:null};if(_(n)&&!n.globalPropertyChanged(t,i,o))return!1}return!0}applyRendererDiff(t,i){return this.loadStatus!==du.LOADED?cn.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==cn.Recreate_Symbol&&_(s)?Math.min(r,s.applyRendererDiff(t,i)):r,cn.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===du.FAILED||t.diff.type!=="partial")return;const i=t.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(M(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.graphics[n];_(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(M(s))continue;const n=t.graphics[r];if(M(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(M(r))continue;const s=t.graphics[i];_(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,i=0,r=0;return this.symbolLayers.forEach(s=>{M(s)||(s.loadStatus===du.LOADING?t++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:t,slow:i,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)_(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const iD={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class pct extends PQ{constructor(t,i,r){super(i),this.symbol=t,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const i=await this.symbol.fetchSymbol({signal:t});i.id=this.symbol.id,this.graphics3DSymbol=this.convert(i),_(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:$Q}globalPropertyChanged(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,i)}applyRendererDiff(t,i){return _(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,i):cn.Recreate_Symbol}prepareSymbolPatch(t){_(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,i)}onRemoveGraphic(){}getFastUpdateStatus(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){_(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function KQ(e){return e instanceof pct?e.graphics3DSymbol:e instanceof dct?e:null}const pP=ge.getLogger("esri.views.3d.layers.graphics.labelPlacement");function fct(e){const t=Tct(e);if(M(t))return null;const i=mct(e,t);if(M(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return yct({anchor:r,verticalOffset:t.verticalOffset,screenOffset:st(),centerOffset:mi(0,0,0,-1),centerOffsetUnits:"world",translation:R(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function mct(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=pp[i],s=r||i5(e);return i&&!r&&pP.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),gct(s,e)}function eJ(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=KQ(t);return _(i)?i.symbol.symbolLayers.getItemAt(0):null}function gct(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(M(i))return null;if(_(t.disablePlacement))return t.labelClass.labelPlacement?(pP.warnOncePerTick(Fae(e.placement,t.disablePlacement.logEntityDescription)),i5(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return pP.warnOncePerTick(Fae(e.placement,`'${r}' geometries`)),i5(t);break;case"point":case"mesh":return e}return e}function Fae(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function i5(e){const t=e.graphics3DGraphic.graphic.geometry;if(M(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=eJ(e);return _(i)&&i.type==="extrude"?pp["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return pp["above-center"];default:return}}function yct(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(M(r))return null;switch(r.type){case"point":_ct(e,t,i);break;case"polygon":vct(e,t,i);break;case"mesh":tJ(e,t,i.graphics3DGraphic.graphics[0])}return e}function vct(e,t,i){const r=eJ(i);if(!M(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.graphics[0];_(s)?(s.getBoundingBoxObjectSpace(zO),op(zO,e.translation),e.translation[2]=C_(zO)/2):ne(e.translation,0,0,0),tJ(e,t,s);break}}}function _ct(e,t,i){const r=eJ(i);if(M(r))return;const s=i.graphics3DGraphic.graphics[0];switch(_(s)?s.getCenterObjectSpace(e.translation):ne(e.translation,0,0,0),r.type){case"icon":case"text":bct(e,t,i,s);break;case"object":tJ(e,t,s)}}function bct(e,t,i,r){const{graphics3DGraphic:s}=i,n=_(r)?r.getScreenSize():null;if(!s.isDraped&&_(n)){const o=wct(i);dA[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),dA[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=dA[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=dA[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=dA[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(pp[i.labelClass.labelPlacement]&&pP.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function wct(e,t=Sct){const{graphics3DGraphic:i}=e,r=i.graphics[0],s=_(r)?r.stageObject.geometryRecords[0].material:null;if(s&&s instanceof SE){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function tJ(e,t,i){const r=_(i)?i.getBoundingBoxObjectSpace(zO):zO,s=Fe(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Oe(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function xct(e){return e==="above-center"}function Tct(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=KQ(r.graphics3DSymbol),n=Qi(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=pp[t]||i5(e);return _(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:kae(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(M(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?xct(o.placement)?{placement:"above-center",verticalOffset:kae(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(pP.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function kae(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const pp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Uae={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in Uae){const t=Uae[e],i=pp[e];t.forEach(r=>{pp[r]=i})}Object.freeze&&(Object.freeze(pp),Object.keys(pp).forEach(e=>{Object.freeze(pp[e]),Object.freeze(pp[e].normalizedOffset)}));const dA=[0,0],Sct=[0,0],zO=Hs();class zae{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,i){this._materials.set(t,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const FB=512,kB=4096,Ect=.85,Cct=.95;let VM=class extends Se{constructor(e){super(e),this.type=Mp.Texture,this.id=Tl(),this.events=new as,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Qe(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,flipped:!0,samplingMode:tt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return _(this._glTexture)||(this._glTexture=new ot(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(yt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=Vs(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=Qe(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",FB.toString()),e.setAttribute("height",FB.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=FB){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=C2(i),i=Math.min(i,kB),i}_resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,_(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=pA,e.cursor.y=pA+Vae,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this.atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(O.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+pA,a=n+pA+Vae;if(i.cursor.x+o<i.size.width&&i.cursor.y+a<i.size.height)this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+a+i.lineHeight<i.size.height)){const l=this._getExpectedAtlasUsage(),c=l>Ect&&i.size.width<kB;return c&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!c&&l>Cct&&i.size.width===kB?(this._processRemovals(),BS.OK):(this._repack(),BS.REPACK)}i.cursor.x=pA,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return BS.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const i=this.stageObjects.get(t);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(i=>{i.geometries[0].vertexAttributes.get(O.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(O.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],i.geometryVertexAttrsUpdated(i.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if(on(this.elementsToAddOrUpdate,(s,n)=>{const o=this.elements.get(n);if(o&&o.rendered){const a=this.stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this.elements.get(n);c.get(O.UV0).data=new Float32Array(h.placement.uvMinMax),c.get(O.SIZE).data=new Float32Array([h.placement.size.displayWidth,h.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this.elementsToAddOrUpdate.get(n),t)===BS.REPACK&&(i=!0,!0)}),i)return void this.runTask(lC,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),on(this.elementsToRender,(s,n)=>(this._processRenderingRequest(s),this.elementsToRender.delete(n),r=!0,e.madeProgress(),e.done)),r&&_(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&Mit.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((i,r)=>e.push({element:i,key:r}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((i,r)=>i.key.localeCompare(r.key)),this.elements.clear();for(const{element:i,key:r}of e)this.elements.set(r,i);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,_resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([d({constructOnly:!0})],VM.prototype,"view",void 0),u([d({type:Boolean})],VM.prototype,"updating",void 0),VM=u([P("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],VM);const pA=2,Vae=2;var BS;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(BS||(BS={}));const Bae=ge.getLogger("esri.views.3d.layers.graphics.Labeler");let lb=class extends Se{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new jt,this._handles.add([se(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),se(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(yt.LABELER,this)]),this._textTextureAtlas=new VM({view:this.view}),this._hudMaterialCollection=new zae(this.view._stage),this._calloutMaterialCollection=new zae(this.view._stage)}dispose(){this._handles=lt(this._handles),this._textTextureAtlas=Qe(this._textTextureAtlas),this._hudMaterialCollection=Qe(this._hudMaterialCollection),this._calloutMaterialCollection=Qe(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,i)=>{this._labels.set(i,t),t.graphics3DGraphic.setVisibilityFlag(bu.USER_SETTING,!0,lo.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,i)=>{t.graphics3DGraphic.setVisibilityFlag(bu.USER_SETTING,!1,lo.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(Act(t)){if(!Gae(t)){if(Mct(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),UB(t)){this._dirty=!0;continue}if(!Gae(t))continue}on(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textTextureResources.initialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),ci(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter(a=>!!a.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let o=!1;await _k(s,async(a,l)=>{const c=a.symbol,h=KQ(i.getOrCreateGraphics3DSymbol(c));if(M(h))return void Bae.error("Failed to create Graphics3DSymbol for label");await h.load(),ci(t);let p=null;gX(c)&&c.hasVisibleCallout()&&(p=sit(c,i.symbolCreationContext),await p.load(),ci(t));const f=await Ac(bxe(a,e.layer.fieldsIndex,this.view.spatialReference));if(ci(t),f.ok===!0){const m=await this._createTextRenderParameters(h.symbol);ci(t),n[l]={labelClass:a,labelFunction:f.value,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:p,calloutSymbolLayerIndex:0,textRenderParameters:m}}else Bae.error(`Label expression failed to evaluate: ${f.error}`),o=!0}),ci(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Qr(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?HU.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced,i.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffsetUnits:i.centerOffsetUnits,horizontalPlacement:eae(i.anchor),verticalPlacement:Est(i.anchor),verticalOffset:i.verticalOffset,debugDrawLabelBorder:ji.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return n0.graphic=t,n0.renderingInfo=null,n0.layer=r,s.createLabel(n0,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){const n={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return n0.graphic=e,n0.renderingInfo=n,n0.layer=s,i.createGraphics3DGraphic(n0)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:i}=e,r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const o=t.graphic,a=r.layer,l=WG(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=i.textRenderers[h],f=i.labelPlacements[h];if(M(p)||M(f))continue;const m=s[h],y=m.graphics3DSymbol,v=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,w=y.symbolLayers[0];if(!w)continue;w.setElevationInfoOverride(r.elevationInfoOverride);const b=this._createTextSymbolGraphic(p,o,f,a,w);if(!b)return!1;b._labelClass=m.labelClass,b._labelIndex=h,t.addLabelGraphic(b,c,r.stageLayer),t.setVisibilityFlag(bu.USER_SETTING,l,lo.LABEL),t.clearVisibilityFlag(bu.SCALE_RANGE,lo.LABEL),t.setVisibilityFlag(bu.DECONFLICTION,!1,lo.LABEL),n=!0;const S=m.graphics3DCalloutSymbolLayer;if(S&&f.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,v,S,f,a);_(T)&&(m.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(T,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(i._labelClass==null)continue;const r=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];r!=null&&r.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?ltt(s,i.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(M(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=i.disablePlacement,y=fct({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(M(y))continue;const v=eae(y.anchor),w=NTe(v);t.textRenderers[n]=new DTe(l,w,o.textRenderParameters),t.labelPlacements[n]=y}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const i={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const r=e.labels.get(i);r&&(this._removeGraphic(e,r.graphics3DGraphic),this._addGraphic(e,r.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach(n=>{const o=n.graphics3DGraphic;r.set(o.graphic.uid,o)});const s=n=>n.labelGraphics[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const n=o=>o.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new jxe({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>WG(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textTextureResources.initialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>UB(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,i)=>t+(UB(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Act(e){return e.active&&WG(e.layer)}function UB(e){return e.labelClassPromise&&!!e.labelClassAbortController}function Gae(e){return e.labelClassContexts&&e.labelClassContexts.length}function Mct(e){return e.labelClassContexts===null}u([d({constructOnly:!0})],lb.prototype,"view",void 0),u([d({constructOnly:!0})],lb.prototype,"deconflictor",void 0),u([d()],lb.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],lb.prototype,"updating",null),lb=u([P("esri.views.3d.layers.graphics.Labeler")],lb);const n0=new oit(null,null,null);class Oct{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new jt}loadGLTF(t,i,r){const s=r?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,s,n=>oSe(new sSe(n.streamDataRequester),t,n,r),i)}loadWOSR(t,i){const r=`wosr:${t}:${i.disableTextures}`;return this._fromCache(this.wosrCache,r,s=>aSe(t,s),i)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,i,r,s){return new Promise((n,o)=>{if(nn(s))return void o(hi());const a=ha(s,()=>{this._remove(t,i),o(hi())}),l=t.get(i);if(l)return this.evictHandles.remove(i),l.refCount++,void l.item.then(n,o);const c=new AbortController,h=me(F({},s),{signal:c.signal}),p={refCount:1,abortController:c,item:r(h).then(f=>(p.abortController=null,f.remove=()=>this._remove(t,i),f))};t.set(i,p),p.item.then(f=>{_(a)&&a.remove(),n(f)},f=>{_(a)&&a.remove(),o(f)})})}_remove(t,i){const r=t.get(i);r&&(r.refCount--,r.refCount===0&&this.evictHandles.add(RCe(()=>{t.delete(i),_(r.abortController)&&r.abortController.abort()},Pct),i))}}const Rct=1e4;let Pct=Rct;class ip{constructor(t,i,r,s=null){this.lij=[0,0,0],this.extent=Nt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:ia.VISIBLE_ON_SURFACE,screenRect:Nt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,i,r,s)}acquire(t,i,r,s){this.tilingScheme=s,this.id=ip.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(i,r,s,this.tilingScheme),t[1].acquire(i,r+1,s,this.tilingScheme),t[2].acquire(i,r,s+1,this.tilingScheme),t[3].acquire(i,r+1,s+1,this.tilingScheme),t):[new ip(i,r,s,this.tilingScheme),new ip(i,r+1,s,this.tilingScheme),new ip(i,r,s+1,this.tilingScheme),new ip(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,ay(t.measures.screenRect,this.measures.screenRect)}static id(t,i,r){return`${t}/${i}/${r}`}}var ia;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(ia||(ia={}));class vv{constructor(t){this.renderCoordsHelper=t,this.frustum=QR(),this._points=Cbe(),this.lines=new Array(12),this._origin=R(),this._direction=R(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:R(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){Abe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),le(this._origin,t.eye),le(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let i=0;i<this._points.length;i++)le(this._points[i],t[i]);Mbe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return Fv(this.frustum,t)}intersectsRay(t){return FZe(this.frustum,t)}intersectsLineSegment(t,i){return kZe(this.frustum,t,i)}intersectsPoint(t){return Obe(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const r=i+4;zB(this.lines[i],t[i],t[r]),zB(this.lines[i+4],t[i],i===3?t[0]:t[i+1]),zB(this.lines[i+8],t[r],i===3?t[4]:t[r+1])}}}function zB(e,t,i){e.origin=t,e.endpoint=i,wy(e.direction,t,i)}vv.planePointIndices=zZe,vv.nearFarLineIndices=[[et.NEAR_BOTTOM_LEFT,et.FAR_BOTTOM_LEFT],[et.NEAR_BOTTOM_RIGHT,et.FAR_BOTTOM_RIGHT],[et.NEAR_TOP_RIGHT,et.FAR_TOP_RIGHT],[et.NEAR_TOP_LEFT,et.FAR_TOP_LEFT]];const TSe=.5*Math.PI,Ict=TSe/Math.PI*180;class $ct{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:R(),direction:R()};for(let i=0;i<4;i++)this.extent[i]={origin:R(),direction:R(),cap:{next:null,direction:R()}},this.planes[i]=vi();this.planes[lr.NEAR]=vi(),this.planes[lr.FAR]=vi(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,i,r,s=!0){const n=this.extent;this._toRenderBoundingExtent(t,i,r),de(this.center.origin,n[0].origin,n[2].origin),ce(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),s||ce(this.center.direction,this.center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this.renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,wy(a.cap.direction,a.origin,l.origin),fR(a.direction,a.cap.direction,a.origin,this.planes[o]),s||ce(a.direction,a.direction,-1)}fR(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[lr.NEAR]),s?jG(this.planes[lr.NEAR],this.planes[lr.FAR]):(ck(this.planes[lr.FAR],this.planes[lr.NEAR]),jG(this.planes[lr.NEAR],this.planes[lr.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=i,this.minGlobalAltitude=.9*bi(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,i,r=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===Ve.Global){const n=this.maxSpanSpatialReference.isGeographic?Ict:TSe*i;if(this.maxSpan>n)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const n=this.extent[0];return!(r||!t.intersectsRay(Uu(n.origin,n.direction)))}for(let n=0;n<this.extent.length;n++){const o=this.extent[n];if(!r&&t.intersectsRay(Uu(o.origin,o.direction))||t.intersectsLineSegment(cw(o.origin,o.cap.next,Lct),o.cap.direction))return!0}const s=r?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(fYe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,i,r){XW(t,yd),yd[2]=r,ku(i,yd,VB,this.renderCoordsHelper.spatialReference),vs(jae,VB),mr(zl);for(const{x0:n,x1:o,y0:a,y1:l}of Dct)for(let c=0;c<5;c++){const h=c/4;yd[0]=qt(t[n],t[o],h),yd[1]=qt(t[a],t[l],h),yd[2]=r,un(yd,i,yd,this.renderCoordsHelper.spatialReference),ke(yd,yd,jae),lm(zl,yd)}ne(this.extent[0].origin,zl[0],zl[1],zl[2]),ne(this.extent[1].origin,zl[3],zl[1],zl[2]),ne(this.extent[2].origin,zl[3],zl[4],zl[2]),ne(this.extent[3].origin,zl[0],zl[4],zl[2]);for(let n=0;n<4;++n)ke(this.extent[n].origin,this.extent[n].origin,VB)}_toRenderBoundingExtentLocal(t,i,r){sk(t,i,Gm,this.renderCoordsHelper.spatialReference),ne(this.extent[0].origin,Gm[0],Gm[1],r),ne(this.extent[1].origin,Gm[2],Gm[1],r),ne(this.extent[2].origin,Gm[2],Gm[3],r),ne(this.extent[3].origin,Gm[0],Gm[3],r)}_toRenderBoundingExtent(t,i,r){switch(this.renderCoordsHelper.viewingMode){case Ve.Global:this._toRenderBoundingExtentGlobal(t,i,r);break;case Ve.Local:this._toRenderBoundingExtentLocal(t,i,r);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(cr(t.planes[lr.NEAR],this.center.origin)<0&&Te(this.center.direction,t.direction)<0)return!0;for(let i=0;i<4;i++){const r=this.extent[i];if(cr(t.planes[lr.NEAR],r.origin)<0&&Te(r.direction,t.direction)<0)return!0}return!1}}const Dct=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],yd=R(),VB=Ae(),jae=Ae(),zl=Hs(),Gm=Nt(),Lct=Sm();class Nct{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new vv(t),this.extendedFrustum=new vv(t),this.intersector=new $ct({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,i){this.surfaceElevation=i,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>i,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return ia.INVISIBLE;const i=this.renderCoordsHelper.viewingMode===Ve.Global&&t.lij[0]>=Fct&&t.lij[0]<kct,r=this._getOrCalculateSingleTileVisibility(t,!i);return r!==ia.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(t):r}_shortenFrustumFarPlane(t){const i=vv.nearFarLineIndices,r=t.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];pe(Vc,l,a),ce(Vc,Vc,zct),de(r[o],a,Vc)}t.updatePoints(r)}_calculateAggregatedChildrenVisibility(t){let i=ia.INVISIBLE;const r=this.cache.get(t.id);if(r!=null)return r;const s=Xae.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==ia.INVISIBLE&&(i=o,o===ia.VISIBLE_ON_SURFACE))break}return Xae.release(s),this.cache.set(t.id,i),i}_getOrCalculateSingleTileVisibility(t,i){const r=this.cache.get(t.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(t);return i&&this.cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===Ve.Global&&t.lij[0]<Uct?this._calculateSingleTileVisibilitySided(t,!1)===ia.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,i){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,i);const r=bi(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,r)?this.intersector.isVisibleInFrustum(this.frustum,r,!0)?ia.VISIBLE_ON_SURFACE:ia.VISIBLE_WHEN_EXTENDED:ia.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const i=this.renderCoordsHelper.worldUpAtPosition(t.eye,Vc);this.aboveGround||ca(i,i);const r=pn(-Te(i,t.viewForward));if(this.allTilesInvisible=r>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=r>t.fovY/2,!this.hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this.renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this.renderCoordsHelper.worldUpAtPosition(l,Vc),a){case et.FAR_BOTTOM_LEFT:case et.FAR_TOP_LEFT:case et.NEAR_BOTTOM_LEFT:case et.NEAR_TOP_LEFT:HG(this.extendedFrustum.planes[lr.LEFT],Vc,Vc);break;case et.FAR_BOTTOM_RIGHT:case et.FAR_TOP_RIGHT:case et.NEAR_BOTTOM_RIGHT:case et.NEAR_TOP_RIGHT:HG(this.extendedFrustum.planes[lr.RIGHT],Vc,Vc)}ce(Vc,Vc,s.direction),this.renderCoordsHelper.intersectInfiniteManifold(Uu(l,Vc),s.zWithMargin,l)}}if(this.extendedFrustum.updatePoints(n),na(n[et.NEAR_BOTTOM_LEFT],n[et.NEAR_BOTTOM_RIGHT],n[et.NEAR_TOP_RIGHT],qae),na(n[et.NEAR_BOTTOM_RIGHT],n[et.NEAR_TOP_RIGHT],n[et.NEAR_TOP_LEFT],Wae),Te(qae,Wae)<0){const o=this.extendedFrustum.mutablePoints;this.aboveGround?[o[et.NEAR_BOTTOM_LEFT],o[et.NEAR_BOTTOM_RIGHT]]=[o[et.NEAR_BOTTOM_RIGHT],o[et.NEAR_BOTTOM_LEFT]]:[o[et.NEAR_TOP_LEFT],o[et.NEAR_TOP_RIGHT]]=[o[et.NEAR_TOP_RIGHT],o[et.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-Hae;return{zWithMargin:t,pointIndices:vv.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+Hae;return{zWithMargin:t,pointIndices:vv.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<t}}}const Fct=2,kct=6,Uct=12,zct=.95,Hae=1,Vc=R(),qae=vi(),Wae=vi(),Xae=new Es(Array,e=>{e.length!==4&&(e[0]=new ip,e[1]=new ip,e[2]=new ip,e[3]=new ip)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class Vct{constructor(t){this.camera=new ir,this.focusOnMap=[0,0],this.screenRect=Nt(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new Nct(t.renderCoordsHelper)}begin(t,i,r){this.camera.copyFrom(t),this.surfaceElevation=r,this.focusOnMap[0]=i.x,this.focusOnMap[1]=i.y,WW(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=vPe(t.extent,this.focusOnMap),t.measures.visibility!==ia.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const i=Bct,r=1<<i,s=t.measures.screenRect;Lu(s);let n=0;const o=t.lij[0]+i,a=t.lij[1]<<i,l=t.lij[2]<<i,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===ia.VISIBLE_WHEN_EXTENDED?this.tileSize*Gct:this.tileSize}_computeScreenArea(t,i,r,s,n){const o=t.measures.visibility===ia.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,o0),Lu(BB);for(let a=0;a<4;a++)JS(BB,o0[a]);return rw(n,BB,n),Mse(o0[0],o0[1],o0[2])+Mse(o0[0],o0[2],o0[3])}_projectToScreen(t,i,r,s,n){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,i,r,fA),this._toRenderCoords(fA,0,3,a0[0]),this._toRenderCoords(fA,2,3,a0[1]),this._toRenderCoords(fA,2,1,a0[2]),this._toRenderCoords(fA,0,1,a0[3]),s&&(this._projectToPlane(a0,this.camera.frustum[lr.NEAR]),this._projectToPlane(a0,this.camera.frustum[lr.TOP]),this._projectToPlane(a0,this.camera.frustum[lr.BOTTOM]));for(let o=0;o<4;o++)this.camera.projectToRenderScreen(a0[o],Yae),this.camera.renderToScreen(Yae,n[o])}_projectToPlane(t,i){for(let s=0;s<4;s++)gA[s]=cr(i,t[s]);const r=Math.max(gA[0],gA[1],gA[2],gA[3]);if(r>0){const s=ce(mA,i,-r);for(let n=0;n<4;n++)de(t[n],t[n],s)}}_toRenderCoords(t,i,r,s){return mA[0]=t[i],mA[1]=t[r],mA[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(mA,this.tilingScheme.spatialReference,s),s}}const BB=Nt(),Bct=2,Gct=5,o0=[Yr(),Yr(),Yr(),Yr()],fA=Nt(),mA=R(),a0=[R(),R(),R(),R()],gA=[0,0,0,0],Yae=Fo();function u2t(e,t,i){if(M(e)||M(i))return!1;let r=!0;return tn[0]=e.xmin!=null?e.xmin:0,tn[1]=e.ymin!=null?e.ymin:0,tn[2]=e.zmin!=null?e.zmin:0,r=r&&pr(tn,e.spatialReference,0,t,i,0,1),tn[0]=e.xmax!=null?e.xmax:0,tn[1]=e.ymax!=null?e.ymax:0,tn[2]=e.zmax!=null?e.zmax:0,r=r&&pr(tn,e.spatialReference,0,t,i,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),r}function SSe(e,t,i){if(M(e)||M(i))return!1;let r=!0;return tn[0]=e.xmin!=null?e.xmin:0,tn[1]=e.ymin!=null?e.ymin:0,tn[2]=e.zmin!=null?e.zmin:0,r=r&&pr(tn,e.spatialReference,0,tn,i,0,1),t[0]=tn[0],t[1]=tn[1],tn[0]=e.xmax!=null?e.xmax:0,tn[1]=e.ymax!=null?e.ymax:0,tn[2]=e.zmax!=null?e.zmax:0,r=r&&pr(tn,e.spatialReference,0,tn,i,0,1),t[2]=tn[0],t[3]=tn[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),r}const tn=R(),jct=ge.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let ro=class extends Se{constructor(e){super(e),this.tiles=new it,this.tileSize=512,this._idToTile=new Map,this._handles=new jt,this._clients=new Set,this._dirty=!1,this._newTiles=new Gt}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(_(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void jct.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||_(t)&&e&&t.equals(e))return;const i=_(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if(M(this.filterExtent)||!this.tilingScheme)return null;const e=Nt();return SSe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([se(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Ki),se(()=>{var e,t,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),wr)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(yt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Vs(this._frameWorker),this._handles=lt(this._handles)}addClient(){const e=qct();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(lC))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),_(this._frameWorker)&&(this._frameWorker.priority=yt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&_(this._frameWorker)&&(this._frameWorker.priority=yt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Vct({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new ip(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,i)=>{const r=t.measures.screenRect,s=i.measures.screenRect;return r[1]+r[3]-(s[1]+s[3])}),Lu(rD);for(let t=0;t<e.length;t++)if(rw(rD,e.data[t].measures.screenRect,rD),Sp(rD)>Wct)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!kP(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==ia.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(r=>{const s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===ia.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([d({constructOnly:!0})],ro.prototype,"scheduler",void 0),u([d({constructOnly:!0})],ro.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],ro.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],ro.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],ro.prototype,"focus",void 0),u([d({constructOnly:!0})],ro.prototype,"viewState",void 0),u([d({constructOnly:!0})],ro.prototype,"terrain",void 0),u([d()],ro.prototype,"tiles",void 0),u([d()],ro.prototype,"tileSize",void 0),u([d({readOnly:!0})],ro.prototype,"tilingScheme",null),u([d()],ro.prototype,"filterExtent",null),u([d({readOnly:!0})],ro.prototype,"filterExtentRect",null),u([d({readOnly:!0})],ro.prototype,"rootTileIds",null),u([d({value:!1})],ro.prototype,"suspended",null),u([d({readOnly:!0})],ro.prototype,"updating",null),ro=u([P("esri.views.3d.layers.support.FeatureTileTree3D")],ro);let Hct=0;function qct(){return Hct++}const rD=Nt(),Wct=10;let to=class extends Se{constructor(){super(...arguments),this._propertiesPool=new dy({camera:ir},this),this._lastSeenCameraProjectionValues=new ir,this.events=new as,this.viewingMode=Ve.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new hg({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new dy({camera:ir},this)}createInitialCamera(){if(this.viewingMode===Ve.Global){const e=bi(this.spatialReference).radius;this.camera=new ir(Fe(4*e,0,0),Fe(e,0,0),Fe(0,0,1))}else this.camera=new ir(Fe(0,0,100),Fe(0,0,0),Fe(0,1,0))}get animation(){return this.cameraController instanceof JR&&_(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Ku&&Ku.copyFrom(e),Ku.computeUp(this.viewingMode),Zae.camera=Ku,this.events.emit("before-camera-change",Zae);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Ku)&&(this._lastSeenCameraProjectionValues.copyFrom(Ku),Qae.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",Qae)),(!t||!t.equals(Ku))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Ku)),this._cameraChanged=!t||!t.almostEquals(Ku),this._cameraChanged)){const i=$he(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return _(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=_(e)?e.clone():null}get fixedContentCamera(){return _(this._contentCamera)}get isGlobal(){return this.viewingMode===Ve.Global}get isLocal(){return this.viewingMode===Ve.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(se(()=>e.state,t=>{t!==zr.Finished&&t!==zr.Stopped||(this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i)))},Ki)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=zr.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==zr.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();Ku.copyFrom(this._get("camera")),e(Ku),this.camera=Ku,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Ct.TOP]!==t.padding[Ct.TOP]||e.padding[Ct.RIGHT]!==t.padding[Ct.RIGHT]||e.padding[Ct.BOTTOM]!==t.padding[Ct.BOTTOM]||e.padding[Ct.LEFT]!==t.padding[Ct.LEFT]}};u([d({readOnly:!0,type:sE})],to.prototype,"animation",null),u([d({type:ir})],to.prototype,"camera",null),u([d()],to.prototype,"pixelRatio",null),u([d({})],to.prototype,"_contentCamera",void 0),u([d({type:ir})],to.prototype,"contentCamera",null),u([d({readOnly:!0})],to.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],to.prototype,"constraints",void 0),u([d({readOnly:!0})],to.prototype,"events",void 0),u([d({readOnly:!0})],to.prototype,"isGlobal",null),u([d({readOnly:!0})],to.prototype,"isLocal",null),u([d({readOnly:!0})],to.prototype,"viewingMode",void 0),u([d({readOnly:!0})],to.prototype,"spatialReference",void 0),u([d({readOnly:!0})],to.prototype,"navigating",null),u([d({readOnly:!0})],to.prototype,"stationary",null),u([d()],to.prototype,"_cameraChanged",void 0),u([d()],to.prototype,"cameraController",null),to=u([P("esri.views.3d.state.ViewState")],to);const Xct=to,Ku=new ir,Zae={camera:null},Qae={camera:null};function Yct(e,t,i){return e===Ve.Global?new Qct(i):new Zct(t,i)}class Zct{constructor(t,i){this.elevationProvider=t,this._referenceEllipsoid=bi(i),this.unitInMeters=Ic(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){n||(n={near:0,far:0});let o=t[2]*this.unitInMeters;const a=o,l=o-s,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(o=l>=0?a-this.unitInMeters*c.min:this.unitInMeters*c.max-a);const h={x:(r=_(r)?r:new ui({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);pe(y1,i,t),sT[0]=y1[0]>0?r.xmax:r.xmin,sT[1]=y1[1]>0?r.ymax:r.ymin,sT[2]=y1[2]>0?p/2:-p/2,pe(sT,sT,t),we(y1,y1);const f=1.1*Te(sT,y1)*this.unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),v=y*eut*this.unitInMeters,w=y*tut*this.unitInMeters;let b=De((o-w)/(v-w),0,1);b*=b*b;let S=qt(m,f,b);return S*=Math.max(Math.log(Math.abs(l)),1),S=Math.min(S,Math.max(34064e4,p)),S/=this.unitInMeters,ESe(S,Jct,this.unitInMeters,n)}}class Qct{constructor(t){this._referenceEllipsoid=bi(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});const o=Oe(t)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),c=Math.max(l,Math.abs(o));return ESe(1.2*Math.sqrt(c*(c+2*a)),De(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function ESe(e,t,i,r){const s=Kct/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const Jct=2e4,Kct=2,eut=.001,tut=1e-4,sT=R(),y1=R();let RN=class extends Se{constructor(e){super(e),this.handles=new jt}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;mbe(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{hC(this.view,e,Bh.EYE_AND_CENTER)})}};u([d({constructOnly:!0})],RN.prototype,"view",void 0),RN=u([P("esri.views.3d.state.ElevationCollisionConstraint")],RN);let BM=class extends Se{constructor(e){super(e),this._handles=new jt,this.nearFarHeuristic=Yct(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([se(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(r=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:r.far]},()=>this._clipDistanceNearFarChanged()),se(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),se(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Ki),se(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(r=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:r.max]},()=>this._updateAltitude(),Ki),se(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),Ki),se(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),Ki),se(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Ki),se(()=>{var e,t,i,r,s,n;return[(i=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:i.type,(n=(s=(r=this.view.state)==null?void 0:r.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),Ki)]),this.view.state.isLocal&&this._handles.add(se(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),At)),this._updateNearFar(),this.view.state.viewingMode!==Ve.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new RN({view:this.view}))}destroy(){this._handles=lt(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>(this._updateCameraNearFarManual(i,e),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,Kk(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var r,s,n;const e=(n=(s=(r=this.view.map)==null?void 0:r.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(xr.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ve.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Dt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Sc(i))}}_updateLocalSurfaceDistance(e){if(M(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=xr.ALL){this.view.state.updateCamera(t=>gs(this.view,t,{selection:e,interactionType:zt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE}))}};u([d({constructOnly:!0})],BM.prototype,"view",void 0),u([d({readOnly:!0})],BM.prototype,"surfaceCollisionConstraint",void 0),BM=u([P("esri.views.3d.state.ConstraintsManager")],BM);let GS=class extends Xb{constructor(e){super(e),this.handles=new jt}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=zr.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){mbe(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),hC(this.view,e,Bh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=zr.Stopped)})}};u([d({constructOnly:!0})],GS.prototype,"view",void 0),u([d({constructOnly:!0})],GS.prototype,"desiredCamera",null),GS=u([P("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],GS);const iut=.66;function CSe(e){return 360-TW.normalize(e)}function qU(e){return TW.normalize(360-e)}function sD(e){return _(e)&&e.resolver&&e.resolver.reject(),null}function rut(e,t){return _(e)&&e.resolver&&e.resolver.resolve(t),t}function iJ(e,t,i,r=null){if(!t)return sD(r);const s=e.spatialReference||Ze.WGS84;if(_(t.camera)){const c=rx(t.camera.position,s);if(M(c))return sD(r);const h=t.camera.clone();return h.position=c,rut(r,h)}if(M(t.targetGeometry))return sD(r);const n=t.get("targetGeometry.spatialReference");if(n&&!Hv(n,s))return sD(r);const o=xE(e,e.state.camera);let a=zo.ADJUST;if(t.rotation!=null&&(o.heading=CSe(t.rotation),a=zo.LOCKED),i!=null&&(o.tilt=i),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?pQ(e,t.scale,c.latitude):e.state.camera.distance,awe(e,p,h,o,a,r)}const l=t.targetGeometry.extent;return OO(e,l,o.heading,o.tilt,a,r)}function sut(e,t,i=null){return M(i)&&(i=new Rl),nJ(e,null,t.clone(),i)}async function nut(e,t,i){const r=mut(e,t);if(!r)throw new q("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Cc({fov:e.camera.fov}),n=new Rl({camera:s});if(r.target instanceof Rl)return v1(await lut(e,r.target,r,i,n));if(r.target instanceof Cc)return v1(MSe(e,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof ui){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return v1(o||c?await eq(e,r,r.target.center,s,i,n):await dut(e,r,r.target,s,i,n))}const a={boundingBox:mr(),hasZ:!1,screenSpaceObjects:[]},l=o?out(e,r):void 0;if(await ASe(e,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(op(a.boundingBox,ms),cu.x=ms[0],cu.y=ms[1],cu.z=ms[2],cu.spatialReference=e.spatialReference,isFinite(cu.z)&&a.hasZ?c=H5(a.boundingBox):(cu.z=void 0,c=_Pe(QW(a.boundingBox,yut))),o||c)return v1(await eq(e,r,cu,s,i,n));const h=gut(e,a.screenSpaceObjects);return v1(await fut(e,r,cu,a.boundingBox,h,s,i,n))}return r.position?v1(uut(e,r,s,n)):v1(await hut(e,r,s,i,n))}function rJ(e,t){return t.scale==null&&t.zoom!=null?uwe(e,t.zoom):t.scale}function out(e,t){return pJe(e,rJ(e,t))}function sJ(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=CSe(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function nJ(e,t,i,r){const s=e.spatialReference||Ze.WGS84;return t=_(t)?t:Ag(e,i),M(t)||(r.targetGeometry=a_(t.center,e.renderSpatialReference,s),r.scale=hwe(e,t),r.rotation=qU(i.heading),r.camera=i),r}function r5(e,t,i){if(!t)return;if(!Hv(t.spatialReference,e.spatialReference))throw new q("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let o;switch(t.type){case"point":o=t;break;case"multipoint":case"polyline":o=t.extent.center;break;case"mesh":o=t.origin;break;case"extent":o=t.center;break;case"polygon":o=t.centroid}o&&Hv(o,e.basemapTerrain.spatialReference)?ms[2]=ft(qf(e.elevationProvider,o),0):ms[2]=0}(0,vut[t.type])(t,o=>{r.push(o[0],o[1],o[2])},ms);const s=r.length/3;if(s===0)return;const n=new Array(r.length);if(pr(r,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(i.hasZ=!0);for(let o=0;o<n.length;o+=3)t.hasZ?(ms[0]=n[o+0],ms[1]=n[o+1],ms[2]=n[o+2]):(ms[0]=n[o+0],ms[1]=n[o+1]),lm(i.boundingBox,ms)}}async function aut(e,t,i,r){const s=await Ac(e.whenViewForGraphic(t));if(s.ok===!1||M(s.value)||!("whenGraphicBounds"in s.value))return void r5(e,t.geometry,r);const n=s.value,o=await Ac(n.whenGraphicBounds(t,{minDemResolution:i}));if(o.ok===!1)return void r5(e,t.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;F2(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function ASe(e,t,i,r){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return cu.x=s,cu.y=n,cu.z=void 0,cu.spatialReference=e.spatialReference.isGeographic?e.spatialReference:Ze.WGS84,void r5(e,cu,r)}t&&typeof t.map=="function"?await Sn(t.map(s=>ASe(e,s,i,r))):t instanceof Ec?r5(e,t,r):t instanceof Ga&&await aut(e,t,i,r)}async function lut(e,t,i,r,s){if(_(t.camera))return MSe(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=_(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=qU(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=rJ(e,i);n!=null&&(s.scale=n);const o=new fC(r);return iJ(e,s,i.tilt,o),s.camera=await o.resolver.promise,s}function MSe(e,t,i){const r=e.spatialReference,s=rx(t.position,r);return M(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,nJ(e,null,t,i))}function cut(e,t,i,r,s,n){const o=e.renderSpatialReference;return Gn(i.position,oD,o),Gn(t,GB,o),n.targetGeometry=new at(t),s.position=new at(i.position),pe(s5,GB,oD),iU(e,oD,s5,r.up,s),n.scale=qw(e,hr(oD,GB),n.targetGeometry.latitude),n.rotation=qU(s.heading),n.camera=s,n}async function eq(e,t,i,r,s,n){if(M(i))throw new q("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=vx(e);if(t.position)return cut(e,n.targetGeometry,t,o,r,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=ce(ms,o.viewForward,-l);o.eye=de(ms,o.center,c),n.scale=qw(e,l,i.latitude)}xE(e,o,r);const a=sJ(r,t)?zo.LOCKED:zo.ADJUST;if(!t.zoomFactor){n.scale=rJ(e,t),n.scale==null&&(Gn(i,ms,e.renderSpatialReference),Obe(o.frustum,ms)?n.scale=qw(e,hr(o.eye,ms),i.latitude):n.scale=hwe(e,o));const l=new fC(s);owe(e,n.targetGeometry,n.scale,r,a,l),n.camera=await l.resolver.promise}return n}function uut(e,t,i,r){const s=vx(e);return le(s5,s.viewForward),iU(e,s.eye,s5,s.up,jB),i.position=new at(t.position),i.heading=t.heading!=null?t.heading:jB.heading,i.tilt=t.tilt!=null?t.tilt:jB.tilt,nJ(e,null,i,r)}async function hut(e,t,i,r,s){const n=vx(e);return eq(e,t,a_(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}async function dut(e,t,i,r,s,n){n.targetGeometry=i.clone();const o=vx(e);xE(e,o,r);const a=sJ(r,t)?zo.LOCKED:zo.ADJUST,l=new fC(s);return OO(e,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function put(e,t,i,r,s){let n=0;i.hasZ?n=i.z:e.basemapTerrain&&(n=qf(e.elevationProvider,i)),ne(ms,i.x,i.y,n),ku(e.spatialReference,ms,Jae,e.renderSpatialReference),Jh(nD,Jae),Kh(nD,nD),mr(yA);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const v=o[y];let w=r[v[2]];isFinite(w)||(w=n),ne(ms,r[v[0]],r[v[1]],w),un(ms,e.spatialReference,ms,e.renderSpatialReference),lm(yA,fc(ms,ms,nD))}const a=ax(yA),l=C_(yA),c=lx(yA),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function fut(e,t,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=vx(e),c=put(e,l,i,r,s);xE(e,l,n);const h=sJ(n,t)?zo.LOCKED:zo.ADJUST;a.scale=qw(e,c,a.targetGeometry.latitude);const p=new fC(o);return owe(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function mut(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const r in t)i[r]=t[r];t.center&&!i.target&&(i.target=t.center)}return i}function v1(e){return e&&_(e.camera)&&(e.rotation=qU(e.camera.heading)),e}function gut(e,t){const i=iut;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}const ms=R(),Jae=Ae(),nD=Pr(),yA=Hs(),yut=Nt(),s5=R(),oD=R(),GB=R(),jB={heading:0,tilt:0},cu=new at,vut={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.hasZ?(t(ne(i,e.xmin,e.ymin,e.zmin)),t(ne(i,e.xmax,e.ymin,e.zmin)),t(ne(i,e.xmin,e.ymax,e.zmin)),t(ne(i,e.xmax,e.ymax,e.zmin)),t(ne(i,e.xmin,e.ymin,e.zmax)),t(ne(i,e.xmax,e.ymin,e.zmax)),t(ne(i,e.xmin,e.ymax,e.zmax)),t(ne(i,e.xmax,e.ymax,e.zmax))):(t(ne(i,e.xmin,e.ymin,i[2])),t(ne(i,e.xmax,e.ymin,i[2])),t(ne(i,e.xmin,e.ymax,i[2])),t(ne(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)t(ne(i,r[s+0],r[s+1],r[s+2]))}};class _ut{constructor(t,i,r){this.target=t,this.options=i,this.view=r,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((s,n)=>{this.resolveCallback=s,this.rejectCallback=n;const o=new AbortController;_(this.options.signal)&&ha(this.options.signal,()=>{this.abort()}),this.abortController=o,this.waitForReady()})}then(t,i){return this.promise.then(t,i)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(hi());break;case"wait-for-animation-finish":!t&&_(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(hi())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await hR(()=>this.view.ready,this.abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,nut(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const i=this._getCameraFromViewpoint(t);if(!M(i))if(this.options.animate){if(M(this.animationController))return;this.startAnimation(i,this.animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const i=!!(this.target instanceof Rl&&this.target.camera||this.target instanceof Cc),r=t.camera;if(M(r))return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new q("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=Ag(this.view,r);return M(s)?(this.reject(new q("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}startAnimation(t,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(M(r))return void this.reject(new q("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.active||M(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new GS({view:this.view,desiredCamera:t.camera}),hC(this.view,t.camera,Bh.EYE_AND_CENTER)):gs(this.view,t.camera),i.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Bg&&_(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):_(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!M(this.view.state))switch(i.state){case zr.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case zr.Ready:case zr.Rejected:case zr.Running:case zr.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t,i=null;const r=this.view.state.cameraController;return r instanceof Bg&&(r.updateStateFromViewAnimation(),r.active&&(t=r,i=t.viewAnimation)),t!=null||(t=new Bg({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(_(i)&&i.stop(),this.reject(new q("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const eh=ge.getLogger("esri.views.3d.state.ViewStateManager");let yn=class extends Se{constructor(e){super(e),this.propertiesPool=new dy({frustum:vv},this),this.handles=new jt,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=xE(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(Ag(this.view,e),{applyConstraints:!1})||eh.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=xE(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=Ag(this.view,e);M(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=pl(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([se(()=>this.contentCamera,()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),se(()=>this.zoom,n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),se(()=>this.view.state.camera,n=>{const o=Gs(r,n.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():eh.error("#center=","Invalid center",e):eh.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):eh.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=lJe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return _(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||eh.error("#extent=","Invalid extent",e):eh.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):eh.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return qw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||eh.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[Ct.TOP]/i),n=Math.round(t[Ct.RIGHT]/i),o=Math.round(t[Ct.BOTTOM]/i),a=Math.round(t[Ct.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,aD),this.view.state.updateCamera(t=>t.padding=aD))}_paddingToArray(e,t,i){e?Ji(i,e.top||0,e.right||0,e.bottom||0,e.left||0):Ji(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return Tp((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?sut(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||eh.error("#viewpoint=","Invalid viewpoint",e);else{const t=_(e.camera)?e.camera.position:e.targetGeometry,i=_(t)&&t.spatialReference;eh.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else eh.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?cwe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||eh.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(_(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),i!=null){const r=i/Math.max(this.view.width,this.view.height);e=Math.min(e,r)}return e}get _devicePixelRatio(){return M(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([En(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera))]),se(()=>this.view.state.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.handles.add(vw({prepare:()=>this._prepareFrame()})),this.handles.add(se(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(lD)})),this.handles.add(En(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new BM({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Ve.Local&&this.handles.add(vo(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(lD),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),lD)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(lD),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i=F({animate:!0},t);return _(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new _ut(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(vx(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera(r=>{i.stepController(e,r)}),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){_(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of xut){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(M(e)||this.cameraSetByUser)return;if(e instanceof Cc)return void this.setStateCamera(Ag(this.view,e),{applyConstraints:!1});if(e instanceof Rl){if(e.targetGeometry instanceof ui){const s=OO(this.view,e.targetGeometry,0,.5,zo.LOCKED);return void(_(s)&&this.setStateCamera(Ag(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}const t=OO(this.view,e,0,.5,zo.LOCKED);_(t)&&this.setStateCamera(Ag(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&wut.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!M(e)&&(e instanceof Rl?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Cc?this.isCompatible(e.position):e.spatialReference&&Hv(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Tut){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=l0){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=eP(this.view,r,s,e,t,zo.ADJUST);return M(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=OO(this.view,e,t,i,zo.ADJUST,Sut);return _(r)?Ag(this.view,r):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,s=pQ(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(uwe(this.view,e))}_viewpointToCamera(e){return Ag(this.view,iJ(this.view,e))}setStateCamera(e,t){return!(M(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&gs(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new GS({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._devicePixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(r!==0&&s!==0&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===r&&n.fullHeight===s&&n.pixelRatio===i||(l0.copyFrom(n),l0.pixelRatio!==i&&(this._paddingToArray(this.padding,i,aD),l0.padding=aD),l0.fullWidth=r,l0.fullHeight=s,l0.pixelRatio=i,this.view.state.camera=l0)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?Kk(this.view,e.eye):0;e.relativeElevation=i-r}};u([d({type:Cc,dependsOn:["view.state.camera","ready"]})],yn.prototype,"camera",null),u([d({type:Cc,dependsOn:["view.state.contentCamera","ready"]})],yn.prototype,"contentCamera",null),u([d({type:at})],yn.prototype,"center",null),u([d({type:ui})],yn.prototype,"extent",null),u([d({readOnly:!0})],yn.prototype,"frustum",null),u([d({readOnly:!0})],yn.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],yn.prototype,"ready",void 0),u([d({type:Number})],yn.prototype,"scale",null),u([d()],yn.prototype,"padding",null),u([d({readOnly:!0})],yn.prototype,"screenCenter",null),u([d({constructOnly:!0})],yn.prototype,"view",void 0),u([d({type:Rl})],yn.prototype,"viewpoint",null),u([d({type:Number})],yn.prototype,"zoom",null),u([d()],yn.prototype,"maximumPixelRatio",null),u([d()],yn.prototype,"_devicePixelRatio",null),u([d()],yn.prototype,"_windowDevicePixelRatio",void 0),u([d()],yn.prototype,"_devicePixelRatioOverride",void 0),u([d()],yn.prototype,"_maximumPixelRatioOverride",void 0),yn=u([P("esri.views.3d.state.ViewStateManager")],yn);const but=yn,wut=["camera","viewpoint","extent","scale","center","zoom"],xut=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Tut={heading:0,tilt:0},Sut=new Cc,l0=new ir,aD=Ht(),lD="pending-initial-view";class Eut{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this.view=r,this.externalIntersectionHandlers=new Gt,this.tolerance=_E,this.tmpRay=uo(),this.tmpRegion=Nt(),this.validateHUDIntersector=td(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,i,r){return this.intersectRay(this._getPickRay(t,this.tmpRay),Kae(this.viewingMode),i,r)}intersectScreenFreePointFallback(t,i,r){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),i,r)}intersectRayFreePointFallback(t,i,r){return this.intersectRay(t,Kae(this.viewingMode),i,r)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=yo.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(hD,r,s),hD[0]+=.0466,hD[1]-=.0123,oQ(t,hD,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this.tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){const s=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);const s=i.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||Om(s)&&s.intersector!==Br.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=_E){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===Br.TERRAIN?1:r.type===Br.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t)!=null&&this.externalIntersectionHandlers.sort((i,r)=>i.type===Br.TERRAIN?1:r.type===Br.TERRAIN?-1:0)}_getPickRay(t,i){const r=this.view.state.camera;return Ibe(r,t,i)}_intersectRayFreePointLocal(t,i){if(this.viewingMode!==Ve.Local||M(t))return!1;const r=this.view.renderDataExtent;if(M(r))return de(i,t.origin,we(He.get(),t.direction)),!0;const s={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return de(i,t.origin,we(He.get(),t.direction)),!0;const o=this.view.state.camera,a=Math.max(0,r.xmin-o.eye[0],o.eye[0]-r.xmax),l=Math.max(0,r.ymin-o.eye[1],o.eye[1]-r.ymax),c=Math.sqrt(a*a+l*l),h=Math.abs(o.relativeElevation)+Number.MIN_VALUE,p=Math.max(0,Math.log(n/h))**2;let f=n/Math.max(1,p);f=Math.max(f,Math.min(c,n));const m=ce(He.get(),t.direction,f/Oe(t.direction));return de(i,t.origin,m),!0}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){if(M(t))return null;const n=_(i)?i.mode:"absolute-height",o=_(i)?ft(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this.view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,a,uD)){const S=this.view.computeMapPointFromVec3d(uD);return S.z-=o,S}return null}const c=this.view.state.camera,h=He.get();c.projectToRenderScreen(t.origin,h);const p=new ele(null,this._forEachLayer),f=this.view.slicePlane,m=_(f)?Xse(f):null,y=td(this.viewingMode);y.options.store=yo.MIN,y.options.verticalOffset=l;const v=t.origin,w=de(He.get(),v,t.direction);y.reset(v,w,c),y.point=h;const b=_(s)?"type"in s&&s.type==="graphics"?S=>S.metadata.layerUid!==s.uid:S=>S.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const S=T=>(M(b)||b(T))&&T.metadata&&T.metadata.isElevationSource;y.intersect(p.layers,h,this.tolerance,null,S),this.externalIntersectionHandlers.forAll(T=>{if(T.type===Br.I3S||T.type===Br.TERRAIN){const E=T.slicePlaneEnabled?m:null;T.intersect(y,E,y.rayBegin,y.rayEnd,h)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(S=>{if(S.isGround){const T=S.slicePlaneEnabled?m:null;S.intersect(y,T,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(uD)){const S=this.view.computeMapPointFromVec3d(uD);return S.z=r,S}return null}computeIntersection(t,i,r){if(M(t))return;const s=this.view.state.camera,n=He.get();s.projectToRenderScreen(t.origin,n);const o=new ele(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=t.origin,l=de(He.get(),t.origin,t.direction);i.reset(a,l,s),i.intersect(o.layers,n,this.tolerance);const c=this.view.slicePlane,h=_(c)?Xse(c):null;i.intersect(o.sliceableLayers,n,this.tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this.externalIntersectionHandlers.forAll(m=>{if(i.options.isFiltered=!o.filterLayerUid(m.layerUid),m.isGround&&p||!i.options.isFiltered){const y=m.slicePlaneEnabled?h:null;m.intersect(i,y,a,l,n)}});const f=He.get();if(r&&r.enableDraped&&i.results.ground.getIntersectionPoint(f)){const m=this.view.basemapTerrain,y=m.overlayManager.renderer,v=this.view.renderCoordsHelper.spatialReference,w=He.get();this.view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=ft(this.view.elevationProvider.getElevation(f[0],f[1],f[2],v,"ground"),0),y.intersect(i,w,i.results.ground,b=>o.filterRenderGeometry(b))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){const i=t.results.hud;ay(this.tmpRegion,B9);const r=this.view.state.camera,s=[],n=this.tmpRegion,o=b=>{const S=new Aut(b);r.projectToRenderScreen(b.target.center,S.screenPoint),S.screenPoint[0]=Math.floor(S.screenPoint[0]),S.screenPoint[1]=Math.floor(S.screenPoint[1]),s.push(S),JS(n,S.screenPoint)};t.sortResults(i.all),_(i.min.dist)&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(_(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-GM),h=Math.max(0,n[1]-GM),p=Math.min(vu(n)+2*GM,a-c),f=Math.min(Sp(n)+2*GM,l-h),m=new Uint8Array(p*f*4);this.view._stage.renderView.readHUDVisibility(c,h,p,f,m);let y=!0;const v=M(t.results.max.dist);let w=0;for(const b of s)for(const S of Cut)if(m[4*(Math.min(b.screenPoint[0]+S[0],a)-n[0]+(Math.min(b.screenPoint[1]+S[1],l)-n[1])*p)]){y&&(t.results.min.copy(b.result),y=!1),v&&t.results.max.copy(b.result),t.options.store===yo.ALL&&t.results.all.splice(w++,0,b.result);break}}}const GM=1,Cut=(()=>{const e=[],t=GM;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})();class Aut{constructor(t){this.result=t,this.screenPoint=Fo()}}let cD;function Kae(e){return cD&&cD.viewingMode===e||(cD=td(e)),cD}class ele{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,i(r=>{r.isPickable&&this.filterLayerUid(r.apiLayerUid)&&(r.isSliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){const{include:i,exclude:r}=this;return M(t)?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function tle(e){return typeof e=="object"&&"intersect"in e}const uD=R(),hD=Fo();class h2t{constructor(t,i){this.spatialReference=t,this.view=i}getElevation(t,i,r){return this.view.elevationProvider.getElevation(t,i,0,this.spatialReference,r)}async queryElevation(t,i,r,s,n){return this.view.elevationProvider.queryElevation(t,i,0,this.spatialReference,n,r,s)}}class Mut{constructor(t,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=me(F({},s),{ignoreInvisibleLayers:!0}),this._frameTask=t.registerTask(yt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,r,s=0){return new Promise((n,o)=>{const a={x:t,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),ha(r,()=>{eW(this._queries,a),o(hi())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return void t.forEach(c=>c.result.reject());const r=t.map(c=>[c.x,c.y]),s=t.reduce((c,h)=>Math.min(c,h.minDemResolution),1/0),n=new sx({points:r,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,a=_(o)?o.signal:t[0].signal;if(_(o)){let c=0;t.forEach(h=>ha(h.signal,()=>{c++,h.result.reject(hi()),c===t.length&&o.abort()}))}const l=me(F({},this._queryOptions),{minDemResolution:s,signal:a});i.queryElevation(n,l).then(c=>{t.forEach((h,p)=>{_(h.signal)&&h.signal.aborted?h.result.reject(hi()):h.result.resolve(c.geometry.points[p][2])})}).catch(c=>{t.forEach(h=>h.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let jM=class extends as.EventedMixin(Se){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=lt(this._elevationQuery)}get elevationQuery(){return M(this._elevationQuery)&&(this._elevationQuery=new Mut(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&r.equals(o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=dD(n,this.im,e,t,i,r,s),M(n)&&(n=dD(n,this.ground,e,t,i,r,s)),s==="scene"&&(n=dD(n,this.scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,o=0){const a=bp();return this.elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=dD(l,this.scene,e,t,i,r,s)),a.resolve(l)}).catch(l=>{Qr(l)?a.reject(l):a.resolve(this.getElevation(e,t,i,r,s))}),a.promise}register(e,t){this.handles.set(t,t.on("elevation-change",i=>this.emit("elevation-change",i))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function dD(e,t,i,r,s,n,o){for(const a of t){const l=a.getElevation(i,r,s,n,o);_(l)&&(e=_(e)?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],jM.prototype,"view",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],jM.prototype,"spatialReference",void 0),jM=u([P("esri.views.3d.support.CombinedElevationProvider")],jM);class Vv{static isValidProfile(t){return t in Vv.profiles}static getDefaultProfile(){return he("trident")||he("esri-iPhone")?"low":"medium"}static apply(t,i){const r=Vv.profiles[t];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable;{const s=i.sceneService["3dObject"],n=r.sceneService["3dObject"];s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumRenderResolution=r.maximumRenderResolution,i.maximumPixelRatio=r.maximumPixelRatio}}function ile(){const e=!!he("esri-mobile"),t=!!he("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}Vv.debug={reset(){const e=ile();for(const t in e)Vv.profiles[t]=e[t]}},function(e){e.profiles=ile()}(Vv||(Vv={}));const PN=Vv;function oJ(){return new Float32Array(4)}function Out(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function rd(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Rut(e,t){return new Float32Array(e,t,4)}function OSe(){return oJ()}function RSe(){return rd(1,1,1,1)}function PSe(){return rd(1,0,0,0)}function ISe(){return rd(0,1,0,0)}function $Se(){return rd(0,0,1,0)}function DSe(){return rd(0,0,0,1)}const Put=OSe(),Iut=RSe(),$ut=PSe(),Dut=ISe(),Lut=$Se(),Nut=DSe();Object.freeze(Object.defineProperty({__proto__:null,create:oJ,clone:Out,fromValues:rd,createView:Rut,zeros:OSe,ones:RSe,unitX:PSe,unitY:ISe,unitZ:$Se,unitW:DSe,ZEROS:Put,ONES:Iut,UNIT_X:$ut,UNIT_Y:Dut,UNIT_Z:Lut,UNIT_W:Nut},Symbol.toStringTag,{value:"Module"}));let yf=class extends Se{constructor(){super(...arguments),this.color=new We([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new We([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=We.toUnitRGBA(e.color),i=_(e.haloColor)?We.toUnitRGBA(e.haloColor):t,r=We.toUnitRGBA(e.shadowColor);return{color:rd(t[0],t[1],t[2],t[3]),haloColor:rd(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:mi(r[0],r[1],r[2],r[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};u([d({type:We})],yf.prototype,"color",void 0),u([d({type:We})],yf.prototype,"haloColor",void 0),u([d()],yf.prototype,"haloOpacity",void 0),u([d()],yf.prototype,"fillOpacity",void 0),u([d()],yf.prototype,"shadowOpacity",void 0),u([d({type:We})],yf.prototype,"shadowColor",void 0),u([d()],yf.prototype,"shadowDifference",void 0),yf=u([P("esri.views.3d.support.HighlightOptions")],yf);const tq=yf;function Fut(e,t,i){const r=Bde(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let cb=class extends ve{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(r=>r.toJSON()),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:jE(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],cb.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],cb.prototype,"outSpatialReference",void 0),u([d()],cb.prototype,"transformation",void 0),u([d()],cb.prototype,"transformForward",void 0),cb=u([P("esri.rest.support.ProjectParameters")],cb);const aJ=cb,kut=ns(aJ);async function LSe(e,t,i){t=kut(t);const r=Fye(e),s=F(me(F({},r.query),{f:"json"}),t.toJSON()),n=t.outSpatialReference,o=jE(t.geometries[0]),a=Rke(s,i);return gr(r.path+"/project",a).then(({data:{geometries:l}})=>Fut(l,o,n))}async function lJ(e=null,t){var s,n;if(ki.geometryServiceUrl)return ki.geometryServiceUrl;if(!e)throw new q("internal:geometry-service-url-not-configured");let i;i="portal"in e?e.portal||mo.getDefault():e,await i.load({signal:t});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new q("internal:geometry-service-url-not-configured");return r}async function Uut(e,t,i=null,r){const s=await lJ(i,r),n=new aJ;n.geometries=[e],n.outSpatialReference=t;const o=await LSe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new q("internal:geometry-service-projection-failed")}var zut=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getGeometryServiceURL:lJ,projectGeometry:Uut});class Vut{constructor(t,i){this.spatialReference=i,this.unitInMeters=Ic(this.spatialReference,bi(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=lJ(t&&t.get("portalItem")).catch(()=>{throw new q("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?r=t:(r=[t],s=!1);const n=r.map(l=>l instanceof at?l:new at(l,this.spatialReference)),o=new aJ({geometries:n,outSpatialReference:Ze.WGS84}),a=(await LSe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return s?a:a[0]}}let Rf=class extends Se{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};u([d()],Rf.prototype,"minTotalNumberOfFeatures",void 0),u([d()],Rf.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],Rf.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],Rf.prototype,"snapshotAvailable",void 0),u([d()],Rf.prototype,"polygonLodFactor",void 0),u([d()],Rf.prototype,"polylineLodFactor",void 0),Rf=u([P("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Rf);let Kf=class extends Se{constructor(){super(...arguments),this.lodFactor=1}};u([d()],Kf.prototype,"lodFactor",void 0),Kf=u([P("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Kf);let n5=class extends Kf{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};n5=u([P("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],n5);let Og=class extends Se{constructor(){super(...arguments),this["3dObject"]=new n5,this.point=new Kf,this.integratedMesh=new Kf,this.pointCloud=new Kf,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:n5})],Og.prototype,"3dObject",void 0),u([d({type:Kf})],Og.prototype,"point",void 0),u([d({type:Kf})],Og.prototype,"integratedMesh",void 0),u([d({type:Kf})],Og.prototype,"pointCloud",void 0),u([d()],Og.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Og=u([P("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Og);let dv=class extends Se{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};u([d()],dv.prototype,"lodBias",void 0),u([d()],dv.prototype,"angledSplitBias",void 0),u([d()],dv.prototype,"reduceTileLevelDifferences",void 0),u([d()],dv.prototype,"textureFadeDuration",void 0),dv=u([P("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],dv);let jS=class extends Se{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],jS.prototype,"pixelRatio",void 0),u([d()],jS.prototype,"maxTotalNumberOfFeatures",void 0),jS=u([P("esri.views.3d.support.QualitySettings.HeatmapSettings")],jS);let sl=class extends Se{constructor(){super(...arguments),this.graphics3D=new Rf,this.sceneService=new Og,this.tiledSurface=new dv,this.heatmap=new jS,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};u([d({type:Rf})],sl.prototype,"graphics3D",void 0),u([d({type:Og})],sl.prototype,"sceneService",void 0),u([d({type:dv})],sl.prototype,"tiledSurface",void 0),u([d({type:jS})],sl.prototype,"heatmap",void 0),u([d()],sl.prototype,"antialiasingEnabled",void 0),u([d()],sl.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],sl.prototype,"highQualityTransparency",void 0),u([d()],sl.prototype,"memoryLimit",void 0),u([d()],sl.prototype,"additionalCacheMemory",void 0),u([d()],sl.prototype,"frameRate",void 0),u([d()],sl.prototype,"maximumRenderResolution",void 0),u([d()],sl.prototype,"maximumPixelRatio",void 0),sl=u([P("esri.views.3d.support.QualitySettings.QualitySettings")],sl);const rle=sl;class o5{constructor(t,i,r,s){this.viewingMode=t,this.spatialReference=i,this.unitInMeters=r,this.coordinateSystem=s,this._coordinateSystem=mLe(s)}set extent(t){t&&gLe(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return SLe(this.coordinateSystem,t)}setAltitude(t,i,r=t){return uge(this.coordinateSystem,r,i,t)}setAltitudeOfTransformation(t,i){ELe(this.coordinateSystem,i,t,i)}worldUpAtPosition(t,i){return bLe(this.coordinateSystem,t,i)}worldBasisAtPosition(t,i,r){return wLe(this.coordinateSystem,t,i,r)}basisMatrixAtPosition(t,i){const r=this.worldBasisAtPosition(t,Mu.X,He.get()),s=this.worldBasisAtPosition(t,Mu.Y,He.get()),n=this.worldBasisAtPosition(t,Mu.Z,He.get());return Tm(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}intersectManifoldClosestSilhouette(t,i,r){return s6(this.coordinateSystem,i,this._coordinateSystem),TLe(this._coordinateSystem,t,r),r}intersectManifold(t,i,r){s6(this.coordinateSystem,i,this._coordinateSystem);const s=He.get();return xLe(this._coordinateSystem,t,s)?le(r,s):null}intersectInfiniteManifold(t,i,r){if(this.viewingMode===Ve.Global)return this.intersectManifold(t,i,r);s6(this.coordinateSystem,i,this._coordinateSystem);const s=this._coordinateSystem.value,n=He.get();return dx(s.plane,t,n)?le(r,n):null}toRenderCoords(t,i,r){return L4(t)?Gn(t,i,this.spatialReference):un(t,i,r,this.spatialReference)}fromRenderCoords(t,i,r=null){return L4(i)?(_(r)&&(i.spatialReference=r),ame(t,this.spatialReference,i)):i instanceof Ze?a_(t,this.spatialReference,i):un(t,this.spatialReference,i,r)?i:null}static create(t,i){switch(t){case Ve.Local:return new o5(Ve.Local,i,Ic(i),_Le());case Ve.Global:return new o5(Ve.Global,i,1,vLe(i))}}static renderUnitScaleFactor(t,i){return sle(t)/sle(i)}}function sle(e){if(wE(e,Ve.Global))return 1;const t=hge(!1,e);return Ic(t)}var Vf;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(Vf||(Vf={}));const But=(()=>{const e=new Array;return e[Vf.ELEVATION]=10,e[Vf.BASEMAP]=10,e[Vf.I3S_INDEX]=10,e[Vf.I3S_DATA]=10,e[Vf.SYMBOLOGY]=5,e})(),Gut=30;function NSe(e){return typeof e.getUsedMemory=="function"}const jut=ge.getLogger("esri.views.3d.support.MemoryController");function Hut(e){return new nl({view:e})}const pD=1,HB=1,qut=.75,Wut=.6,nle=1.3;let nl=class extends Se{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new fY,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(pD),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new W5e(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Wut&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(pD);else if(e)(this._memoryPredicted>1.1*HB||this._memoryUsed>HB)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/nle),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>HB)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/nle),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<qut&&this._quality<pD){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),pD))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;_(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(NSe(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);jut.warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([d({constructOnly:!0})],nl.prototype,"view",void 0),u([d()],nl.prototype,"maxMemory",null),u([d()],nl.prototype,"additionalCacheMemory",null),u([d()],nl.prototype,"memoryFactor",null),u([d()],nl.prototype,"updating",null),u([d()],nl.prototype,"usedMemory",null),u([d()],nl.prototype,"_quality",void 0),u([d()],nl.prototype,"_memoryUsed",void 0),u([d()],nl.prototype,"_updating",void 0),u([d()],nl.prototype,"_stableQuality",void 0),u([d()],nl.prototype,"_maxMemory",void 0),u([d()],nl.prototype,"_additionalCacheMemory",void 0),nl=u([P("esri.views.3d.support.MemoryController")],nl);class Xut{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class Yut{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new Zut}}class Zut{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Qut{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new Yut(n))}hasQuota(t){const i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){const i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const i=this._clients[t.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,pt(i.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){const i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const t=this;return{set workerFunc(i){t._workerFunc=i}}}}let IN=class extends Se{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new Qut((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(yt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Vs(this._frameTask),this._tasks.forEach(e=>Xh(e.abortController)),this._loadQueue=lt(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=bp();s.__signal=_(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return ha(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){const o=new eht(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){C5(e.resolvers,t),t.reject(hi()),e.resolvers.length===0&&(e.status===bh.DOWNLOADING&&(e.status=bh.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=bh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=tht(_(r)&&r.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(pt(e.status===bh.DOWNLOADING),e.status=bh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();ci(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==bh.DOWNLOADED&&(t.err=t.err||hi()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Qr(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)Qr(t)?r.reject(t):r.reject(new q("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const s=i<=0?e.result:ie(e.result);r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===bh.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=bh.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=gr(e.url,me(F({},e.options),{responseType:r,timeout:i,signal:s}));let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===bh.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=Kut(c);if(r="image",e.size=c.byteLength,h==="unknown")return e.request=gr(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(m=>o(m.data),a);const p=new Blob([c],{type:h}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=gr(f,{responseType:r,timeout:i,signal:s}),e.request.then(m=>o(new WU(m.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],IN.prototype,"updating",void 0),IN=u([P("esri.views.3d.support.StreamDataLoader")],IN);const Jut={numRetries:0};function Kut(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class WU{constructor(t,i,r){this.image=t,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}}class eht extends Xut{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=bh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Jut.numRetries}}function tht(e,t,i){return`${e}:${t}:${i}`}var bh;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(bh||(bh={}));let fD=class extends Se{constructor(){super(...arguments),this.updating=!1}};function iht(e){return new iq.ResourceController({view:e})}var iq;u([d({readOnly:!0})],fD.prototype,"updating",void 0),fD=u([P("esri.views.3d.support.ResourceController")],fD),function(e){let t=class extends fD{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=rE,this._cameraChangeTime=0,this._handles=new jt,this._frameTask=null,this._state=Nn.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=Eje(),this._memoryController=Hut(this.view),this._streamDataLoader=new IN,this._streamDataLoader.setup(Gut,But,this._scheduler),this._handles.add([se(()=>{var r;return(r=this.view.state)==null?void 0:r.camera},(r,s)=>this._cameraChangedHandler(r,s),Ki),se(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=vw({update:r=>this._frame(r)}),this._scheduleTask=this._scheduler.registerTask(yt.RESOURCE_CONTROLLER)}destroy(){this._handles=lt(this._handles),this._scheduleTask.remove(),this._frameTask=Vs(this._frameTask),this._streamDataLoader=lt(this._streamDataLoader),this._memoryController=lt(this._memoryController),this._scheduler=lt(this._scheduler)}get updating(){var r,s,n;return!!(((r=this._memoryController)==null?void 0:r.updating)||((s=this._streamDataLoader)==null?void 0:s.updating)||((n=this._scheduleTask)==null?void 0:n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(r,s,n){return this._scheduleTask.schedule(r,s,n)}createStreamDataRequester(r){const s=this._streamDataLoader;return{request:(n,o,a)=>s.request(n,o,r,a),get busy(){return!s.hasDownloadSlots(r)}}}_frame(r){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(lW(r.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(r)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(r,s){r&&s&&r.almostEquals(s)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=Nn.ANIMATING:this.view.interacting?this._state=Nn.INTERACTING:(this._state===Nn.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=i?this._state=Nn.INTERACTING:this._state=Nn.IDLE)}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r),state:this._state}}};u([d({constructOnly:!0})],t.prototype,"view",void 0),u([d()],t.prototype,"_scheduler",void 0),u([d()],t.prototype,"_memoryController",void 0),u([d()],t.prototype,"_streamDataLoader",void 0),u([d()],t.prototype,"_scheduleTask",void 0),u([d({readOnly:!0})],t.prototype,"updating",null),t=u([P("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const i=300}(iq||(iq={}));function rht(e){return"performanceInfo"in e}const nT=R(),sht=R(),jm=R(),Hm=R();function nht(e,t,i=0){const r=e.extent;if(M(r))return!1;if(i===0)return Ope(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return yPe(r,t,i*s)}function mD(e,t,i,r){le(nT,i),nT[r]=t[r];const s=pe(nT,nT,t),n=pe(sht,e,t),o=Te(n,s),a=Te(s,s);let l;l=o<=0?t:a<=o?i:de(nT,t,ce(s,s,o/a));const c=pe(nT,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function oht(e,t,i){const r=e.extent;if(M(r))return 0;jm[0]=r[0],jm[1]=r[1],jm[2]=i,Hm[0]=r[2],Hm[1]=r[3],Hm[2]=i;let s=1/0,n=1/0;return t[0]<jm[0]?s=mD(t,jm,Hm,0):t[0]>Hm[0]&&(s=mD(t,Hm,jm,0)),t[1]<jm[1]?n=mD(t,jm,Hm,1):t[1]>Hm[1]&&(n=mD(t,Hm,jm,1)),Math.min(s,n)}function aht(e,t,i){if(M(e))return hZ();if(e.spatialReference.isGeographic&&!Ow(e.spatialReference))return new q("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=Nr.checkUnsupported(e);if(_(r))return r;if(M(i))return new q("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=lht(e,i);if(s)return s;const n=e.spatialReference;return _(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function lht(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],o=Ape(t),a=Nt();Nr.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>RS){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new q("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:RS})}return null}const cht=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:nht,tiltToExtentEdge:oht,checkIfTileInfoSupportedForViewSR:aht},Symbol.toStringTag,{value:"Module"}));function uht(){return!0}function hht(){return 0}function dht(e,t){if(M(e))return hZ();const i=e.lods.length-1,r=e.spatialReference,s=Ow(r)||_m(r)||bm(r);if(r.isWebMercator){if(!Nr.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new q("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new q("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Nr.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new q("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new q("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return _(t)&&!e.spatialReference.equals(t)?new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const pht=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:uht,tiltToExtentEdge:hht,checkIfTileInfoSupportedForViewSR:dht},Symbol.toStringTag,{value:"Module"})),fht={[Ve.Global]:pht,[Ve.Local]:cht};function Lf(e,t){e||console.warn("Terrain: "+t)}function rq(e){return XU(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function a5(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function XU(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function cJ(e){return(e==null?void 0:e.type)==="tile-3d"}function fP(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function FSe(e){return(e==null?void 0:e.type)==="wmts-3d"}function sq(e){return(e==null?void 0:e.type)==="elevation-3d"}function kSe(e){return(e==null?void 0:e.type)==="group"}function l5(e){return e&&(cJ(e)||FSe(e)||XU(e)||fP(e))}function nq(e){return e&&(cJ(e)||XU(e)||fP(e)||FSe(e))}function mP(e){return nq(e)||sq(e)}function d2t(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return e.type,!1}}function mht(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="raster-tile"}function ght(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="vector-tile"}function yht(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="tile-texture"}function vht(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return t instanceof HTMLImageElement||t instanceof WU||t instanceof HTMLCanvasElement||t instanceof ImageData}function d2(e){return _(e)&&"release"in e&&e.release(),null}function ole(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function uJ(e,t,i,r){return fht[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function YU(e,t,i){let r=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=_ht(e,t,i);r=n.tileInfo,s=n.fullExtent}else{s=a5(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=i===Ve.Local;if(a5(e))r=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!bht(t)||wht.force512VTL,a=e.tileInfo.spatialReference.isGeographic;r=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=e.tileInfo}return _(r)&&_(s)&&uJ(r,s,t,i)==null?{tileInfo:r,fullExtent:s}:null}function _ht(e,t,i){const r=CLe(e);if(_(r)){if(!it.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>uJ(n.tileInfo,n.fullExtent,t,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function bht(e){return e.isWGS84||e.isWebMercator||_de(e)||!O2(e)}const wht={force512VTL:!1};function c5(e){return e===kt.NORTH_EAST?kt.SOUTH_WEST:e===kt.NORTH_WEST?kt.SOUTH_EAST:e===kt.SOUTH_WEST?kt.NORTH_EAST:kt.NORTH_WEST}function $N(e){return e===kt.NORTH?kt.SOUTH:e===kt.EAST?kt.WEST:e===kt.SOUTH?kt.NORTH:kt.EAST}function xht(e){return e===kt.NORTH_WEST||e===kt.SOUTH_WEST}function Tht(e){return e===kt.NORTH_WEST||e===kt.NORTH_EAST}function ale(e){return e===kt.NORTH_WEST||e===kt.WEST||e===kt.SOUTH_WEST}function lle(e){return e===kt.NORTH_EAST||e===kt.EAST||e===kt.SOUTH_EAST}function cle(e){return e===kt.SOUTH_EAST||e===kt.SOUTH||e===kt.SOUTH_WEST}function ule(e){return e===kt.NORTH_EAST||e===kt.NORTH||e===kt.NORTH_WEST}const _v=[kt.NORTH,kt.EAST,kt.SOUTH,kt.WEST],u5=[kt.NORTH_EAST,kt.SOUTH_EAST,kt.SOUTH_WEST,kt.NORTH_WEST];class Sht{constructor(t,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=mP(t)?i.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),rht(t)){const r=t.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}}class Eht{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const i=t.resourceController.memoryController;this.totalMemory=i.maxMemory*j2.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const r=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=_(r)?r.usedMemory:0,t.allLayerViews.items.forEach(s=>{(NSe(s)||mP(s))&&this.layerPerformanceInfos.push(new Sht(s,t))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}}class Cht extends PS{constructor(t,i,r,s){super(i,s),this._streamDataRequester=t,this._parameters=r}async fromUrl(t,i,r){ci(r);const s=_(r)&&r.signal,n=this.makeUid(t,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a},this._textureRequests.set(n,o),o.textureAsync=l.then(async c=>{const h=this._createTexture(t,c,i);return o.texture=h,o.abortController=null,this._stage.add(h),await this._stage.load(h),{uid:n,texture:h,release:()=>this._release(n)}},c=>{throw o.abortController=null,c})}return o.referenceCount++,new Promise((a,l)=>{ha(s,()=>{l(hi())}),o.textureAsync.then(a,l)}).catch(a=>{throw this._release(n),a})}_createTexture(t,i,r){const s=me(F({},this._parameters),{powerOfTwoResizeMode:Zv.PAD});if(oX(t)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new Ns(i,s)}}class Aht{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(Vf.SYMBOLOGY),this.textures=new Cht(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:bt.CLAMP_TO_EDGE,t:bt.CLAMP_TO_EDGE}},t.resourceController.scheduler);const i=bi(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=xwe(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=rKe(t.viewingMode,i)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return Yh();this.graphicsOwners.push(t);const i=se(()=>{var r;return(r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Yh(()=>{i.remove(),C5(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new jt;const i=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([se(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Ki),this.viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;gD.distance=t.centerOnSurfaceInfrequent.distance,gD.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(gD),this.screenSizePerspectiveSettingsLabels.update(gD),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const gD={distance:0,fovY:0};class X0{constructor(t,i,r=""){this.graphics=t,this._symbol=new Av({symbolLayers:[new Cv({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new cx({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(t,i){if(M(i))return;this.hide();const r=new at({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new Ga({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){_(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let bv=class extends Se{constructor(e){super(e),this.handles=new jt}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],bv.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],bv.prototype,"surface",void 0),u([d({constructOnly:!0})],bv.prototype,"state",void 0),bv=u([P("esri.views.3d.support.PointOfInterest")],bv);const Mht=Array;let iu=class extends bv{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new dy({location:at,renderLocation:Mht},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=R(),this.tmpPoint=new at}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(En(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=hr(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return qw(i,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{Qr(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(qB,this._estimatedSurfaceAltitude,this._camera.eye),bl(this._get("renderLocation"),qB)||this._set("renderLocation",le(this._propertiesPool.get("renderLocation"),qB))}};u([d({constructOnly:!0})],iu.prototype,"scheduler",void 0),u([d({constructOnly:!0})],iu.prototype,"cache",void 0),u([d({constructOnly:!0})],iu.prototype,"task",void 0),u([d({constructOnly:!0})],iu.prototype,"cameraName",void 0),u([d({readOnly:!0})],iu.prototype,"location",null),u([d({constructOnly:!0})],iu.prototype,"map",void 0),u([d({readOnly:!0})],iu.prototype,"renderLocation",void 0),u([d({readOnly:!0})],iu.prototype,"scale",null),u([d({readOnly:!0})],iu.prototype,"updating",null),iu=u([P("esri.views.3d.support.CameraOnSurface")],iu);const qB=R(),Oht=Array;let ic=class extends bv{constructor(e){super(e),this._propertiesPool=new dy({location:at,renderLocation:Oht},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=R(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Vs(this._frameWorker),this._propertiesPool=lt(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=Pht;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=Iht;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(le(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=hr(this._camera.eye,e):(ce(e,this._camera.viewForward,this._get("distance")),de(e,e,this._camera.eye)),bl(this._get("renderLocation"),e)||this._set("renderLocation",le(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=bi(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=Fa(i.eye),o=n<s*s,a=hr(i.eye,t);if(o&&a>r/4){const l=s-Math.sqrt(n);return ce(t,i.viewForward,l),de(t,t,i.eye),!0}}else{const r=this.surface.ready?this.surface.extent:null;_(r)&&sk(r,this.surface.spatialReference,vA,this.renderCoordsHelper.spatialReference)&&(t[0]=De(t[0],vA[0],vA[2]),t[1]=De(t[1],vA[1],vA[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(ji.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=hr(i,e),s=hr(i,t);if(Math.abs(s-r)/r>Rht)return!0}return!1}};u([d({constructOnly:!0})],ic.prototype,"scheduler",void 0),u([d({constructOnly:!0})],ic.prototype,"task",void 0),u([d({constructOnly:!0})],ic.prototype,"cameraName",void 0),u([d()],ic.prototype,"distance",void 0),u([d({constructOnly:!0})],ic.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],ic.prototype,"location",null),u([d({readOnly:!0})],ic.prototype,"renderLocation",void 0),u([d()],ic.prototype,"updating",void 0),ic=u([P("esri.views.3d.support.CenterOnSurface")],ic);const Rht=.05,Pht=R(),Iht=R(),vA=Nt();class $ht{constructor(t){this.handles=new jt,this.events=new as,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this.handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Dht)}}const Dht={},Lht=Array;let vf=class extends bv{constructor(e){super(e),this._propertiesPool=new dy({location:at,renderLocation:Lht},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([se(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),se(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(yt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,hle);const s=Math.max(0,(Math.acos(Te(hle,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!_w(e,t)){const l=this._propertiesPool.get("renderLocation");le(l,t),this._set("renderLocation",l)}return}const n=1-De(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(dle);const a=this._propertiesPool.get("renderLocation");dn(a,t,dle,o),e&&_w(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(Fo());if(i[1]=t.aboveGround?t.padding[Ct.BOTTOM]:t.fullHeight-t.padding[Ct.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,_A)){pe(_A,_A,t.eye);const s=we(_A,_A);if(this.renderCoordsHelper.intersectManifold(Uu(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],vf.prototype,"_dirty",void 0),u([d({constructOnly:!0})],vf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],vf.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],vf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],vf.prototype,"updating",null),u([d({readOnly:!0})],vf.prototype,"location",null),u([d({readOnly:!0})],vf.prototype,"renderLocation",void 0),vf=u([P("esri.views.3d.support.CenterOnSurface")],vf);const hle=R(),_A=R(),dle=R();let yg=class extends Se{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new jt}get renderLocation(){if(!this.location)return null;const e=R();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([se(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),En(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||M(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=XW(this.surfaceView.extent),t=new at({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{Qr(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",t)}};u([d({constructOnly:!0})],yg.prototype,"view",void 0),u([d({constructOnly:!0})],yg.prototype,"cache",void 0),u([d({readOnly:!0,aliasOf:"view.map.ground"})],yg.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain"})],yg.prototype,"surfaceView",void 0),u([d({readOnly:!0})],yg.prototype,"location",void 0),u([d({readOnly:!0})],yg.prototype,"renderLocation",null),yg=u([P("esri.views.3d.terrain.StableSurfaceCenter")],yg);let vg=class extends Se{constructor(){super(...arguments),this.handles=new jt,this._tileGeometryUpdateExtent=Lu(),this._tileGeometryUpdateSpatialReference=null,this.events=new as,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(yt.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=lt(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Nht),Lu(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,rw(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=Fht,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,_1,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,b1,t),_1[0]<b1[0]?(r[0]=_1[0],r[2]=b1[0]):(r[0]=b1[0],r[2]=_1[0]),_1[1]<b1[1]?(r[1]=_1[1],r[3]=b1[1]):(r[1]=b1[1],r[3]=_1[1]),kP(r,e)}};u([d({constructOnly:!0})],vg.prototype,"state",void 0),u([d({constructOnly:!0})],vg.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],vg.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],vg.prototype,"scheduler",void 0),u([d({constructOnly:!0})],vg.prototype,"surface",void 0),u([d({readOnly:!0})],vg.prototype,"updating",void 0),vg=u([P("esri.views.3d.support.SurfaceGeometryUpdates")],vg);const Nht={},_1=R(),b1=R(),Fht=Lu();let ta=class extends Se{constructor(e){super(e),this._handles=new jt,this._tmpRay=uo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new dy({renderPointOfView:kht},this),this.renderPointOfView=R(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=td(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=yo.MIN,this._contentIntersector=td(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new ic(me(F({},a),{task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("centerOnSurfaceFrequent",new ic(me(F({},a),{task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("contentCenterOnSurface",new ic(me(F({},a),{task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s,cameraName:"contentCamera"}))),this._set("centerOnContent",new ic(me(F({},a),{task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new iu(me(F({},a),{cache:o,task:yt.POINT_OF_INTEREST_INFREQUENT,map:r}))),this._set("contentCameraOnSurface",new iu(me(F({},a),{cache:o,task:yt.POINT_OF_INTEREST_INFREQUENT,map:r,cameraName:"contentCamera"}))),this._set("surfaceGeometryUpdates",new vg(me(F({},a),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new $ht({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new yg({cache:o,view:this.view})),this._set("focus",new vf({state:e,scheduler:n,surface:t,renderCoordsHelper:i,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new X0(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new X0(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new X0(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new X0(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new X0(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new X0(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new X0(l,"green","Focus")),this._handles.add([se(()=>e.camera,h=>this._cameraChanged(h),Ki),se(()=>t.extent,()=>this._updateCenterPointsOfInterest()),vo(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),Ki),En(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),En(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),vo(()=>ji.SHOW_POI,h=>this._setDebug(h),At)]),this._cameraChanged(this.view.state.camera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)==null?void 0:e.updating)&&!this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return M(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,oT,zht)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(oT):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(M(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=de(oT,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(oT)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(oT)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=oQ(t,e,Uht);if(M(r))return null;const s=r.origin,n=de(oT,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;bl(this.renderPointOfView,t)||this._set("renderPointOfView",le(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(se(()=>t.renderLocation,i=>this._debugCenters.get(t).show(i,t.renderCoordsHelper.spatialReference),At),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],ta.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],ta.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],ta.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],ta.prototype,"contentCenterOnSurface",void 0),u([d({readOnly:!0})],ta.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],ta.prototype,"contentCameraOnSurface",void 0),u([d({readOnly:!0})],ta.prototype,"focus",void 0),u([d({readOnly:!0})],ta.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],ta.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],ta.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],ta.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],ta.prototype,"view",void 0),u([d({readOnly:!0})],ta.prototype,"updating",null),ta=u([P("esri.views.3d.support.PointsOfInterest")],ta);const kht=Array,oT=R(),Uht=uo(),zht={exclude:new Set([tp])};class Vht{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,i){this.store.put(t,i,i.values.byteLength+256)}}const Bht=ge.getLogger("esri.core.workers.WorkerHandle");class USe{constructor(t,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=Pfe(t,me(F({},n),{schedule:s})).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>Bht.error(`Failed to initialize ${t} worker: ${o}`))}on(t,i){const r={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Yh(()=>{r.removed=!0,eW(this._listeners,r),this._thread&&_(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,i){return this.invokeMethod(this._mainMethod,t,i)}invokeMethod(t,i,r){if(this._thread){const s=this._transferLists[t],n=s?s(i):[];return this._thread.invoke(t,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(ci(r),this.invokeMethod(t,i,r))):Promise.reject(null)}broadcast(t,i){return this._thread?Promise.all(this._thread.broadcast(i,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,i)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(i=>{t.removed||(t.threadHandle=i)})}}class ple extends USe{constructor(t=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,r){return t&&t.byteLength!==0?this.invoke({buffer:t,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(VO.forEach((t,i)=>{t===this&&VO.delete(i)}),this.destroy())}}const VO=new Map;function Ght(e=null){let t=VO.get(e);return t||(_(e)?(t=new ple(i=>e.schedule(i)),VO.set(e,t)):(t=new ple,VO.set(null,t))),++t.ref,t}function ey(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function zSe(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function jht(e,t,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Hht(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:ey,clone:zSe,fromValues:jht,createView:Hht},Symbol.toStringTag,{value:"Module"}));var fle,lc,mle,gle,yle;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(fle||(fle={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(lc||(lc={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(mle||(mle={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(gle||(gle={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(yle||(yle={}));class qht{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class p2t{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function f2t(e,t,i,r,s,n){const o=i-s;if(o>=0)return(t>>o)+(r-(n<<o))*(e>>o);const a=-o;return t-(n-(r<<a))*(e>>a)<<a}class m2t{constructor(t,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,i,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function Wht(e,t,i,r,s,n){const o=t[r++];for(let a=0;a<o;a++){const l=new qht(n);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];const c=t[r++];for(let f=0;f<c;f++){const m=t[r++],y=t[r++],v=t[r++],w=t[r++],b=!!t[r++],S=t[r++],T=i[r++],E=i[r++],C=t[r++],A=t[r++];l.colliders.push({xTile:m,yTile:y,dxPixels:v,dyPixels:w,hard:b,partIndex:S,width:C,height:A,minLod:T,maxLod:E})}const h=e[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([e[r++],e[r++]]);const p=e[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[r++],e[r++]]);s.push(l)}return r}function g2t(e,t,i){for(const[r,s]of e.symbols)Xht(e,t,i,s,r)}function Xht(e,t,i,r,s){const n=e.layerData.get(s);if(n.type===lc.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class ZU{constructor(t,i){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let r=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return M(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){M(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class Yht extends ZU{constructor(t,i){super(t,i),this.type=lc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){_(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),_(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),_(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=si.createVertex(t,_i.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=si.createIndex(t,_i.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new qs(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class Zht extends ZU{constructor(t,i){super(t,i),this.type=lc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){_(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),_(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),_(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,_(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),_(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),_(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=si.createVertex(t,_i.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=si.createIndex(t,_i.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=si.createVertex(t,_i.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=si.createIndex(t,_i.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new qs(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new qs(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class Qht extends ZU{constructor(t,i,r){super(t,i),this.type=lc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],v=s[a++];this.iconPerPageElementsMap.set(m,[y,v])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],v=s[a++];this.glyphPerPageElementsMap.set(m,[y,v])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=Wht(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[i,r]of this.iconPerPageElementsMap)t+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3}doDestroy(){_(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),_(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),_(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),_(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,_(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),_(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),_(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),_(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,i=this.iconOpacityBuffer;t.length>0&&t.byteLength===i.size&&i.setSubData(t);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r)}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=si.createVertex(t,_i.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=si.createIndex(t,_i.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=si.createVertex(t,_i.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=si.createIndex(t,_i.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=si.createVertex(t,_i.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=si.createVertex(t,_i.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new qs(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new qs(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class Jht extends ZU{constructor(t,i){super(t,i),this.type=lc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){_(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),_(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),_(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=si.createVertex(t,_i.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=si.createIndex(t,_i.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new qs(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const y2t=!0,v2t=32,vle=200,Kht=1/he("mapview-transitions-duration");class edt extends as{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const i=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return M(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=bp(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=bp(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*Kht;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class Ff{constructor(t,i,r,s){this.set(t,i,r,s)}static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new Ff(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Ff(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new Ff(t,i,r,s),new Ff(t,i,r+1,s),new Ff(t,i+1,r,s),new Ff(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}Ff.pool=new Es(Ff,null,null,25,50);class tdt extends edt{constructor(t,i,r,s,n,o=s,a=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Ff(t),this.x=i,this.y=r,this.width=s,this.height=n,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,i){const r=i/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[n,o]=t.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*r,l=this.height/this.rangeY*r;$Z(s,a,0,0,0,l,0,n,o,1),Hk(this.transforms.dvs,t.displayViewMat3,s)}}class BO extends tdt{constructor(t,i,r,s,n,o,a=null){super(t,i,r,s,n,4096,4096),this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=o,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<vle}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<vle)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let i=!1;for(const r of t)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===lc.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(VSe.delete(this),BO._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let i=!1;if(t){const{bucketsWithData:r,emptyBuckets:s}=t,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===lc.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===lc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,i){super.setTransform(t,i);const r=i/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*r,n=this.height/this.rangeY*r,o=[0,0];t.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;DZ(a),w4(a,a,o),LZ(a,a,Math.PI*t.rotation/180),NZ(a,a,[s,n,1])}_createTransforms(){return{dvs:ey(),tileMat3:ey(),tileUnitsToPixels:ey()}}static _destroyRenderBuckets(t){if(!t)return;const i=new Set;t.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),t.clear()}_createRenderBuckets(t){const i=new Map,r=new Map;for(const s of t){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(t,i){let r=i.get(t);if(r)return r;switch(new Uint32Array(t)[0]){case lc.FILL:r=new Zht(t,this.styleRepository);break;case lc.LINE:r=new Yht(t,this.styleRepository);break;case lc.SYMBOL:r=new Qht(t,this.styleRepository,this);break;case lc.CIRCLE:r=new Jht(t,this.styleRepository)}return i.set(t,r),r}_deleteLayerData(t){if(!this.layerData.has(t))return;const i=this.layerData.get(t);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(t),this.layerCount--}}const VSe=new Map;function idt(){VSe.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(i=>console.log(i)),console.log("========"),e[1].forEach(i=>console.log(i))})}const _2t={value:.5,readOnly:!0},rdt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class hJ{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class sdt{constructor(t,i,r){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i;const s=r.noDataValue,n=r.values;let o=1/0,a=-1/0,l=!0,c=!1;for(let h=0;h<n.length;h++){const p=n[h];p!==s?(o=p<o?p:o,a=p>a?p:a,l=!1):c=!0}l&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:s,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(i[2]-i[0]),dy:(r.width-1)/(i[3]-i[1]),x0:i[0],y1:i[3]},this.bounds=[o,a],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.width,h=this.samplerData.pixelData,p=.5*CR;let f=(c-1)/o,m=(r-this.j*o)*f,y=(i-this.i*o)*f;if(f<1){const v=Math.floor(m),w=Math.floor(y),b=v+w*c,S=h[b],T=h[b+1],E=h[b+c],C=h[b+c+1];if(S+T+E+C<p){const A=m-v,I=y-w,L=gI(S,T,E,C,A,I),D=gI(S,T,E,C,A+f,I),U=gI(S,T,E,C,A,I+f),z=gI(S,T,E,C,A+f,I+f);return s.min=Math.min(L,D,U,z),s.max=Math.max(L,D,U,z),s}m=v,y=w,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let v=m;v<=m+f;v++)for(let w=y;w<=y+f;w++){const b=h[v+w*c];b<p?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}function BSe(e,t,i){if(M(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=De(r.dy*(r.y1-t),0,s),o=De(r.dx*(e-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.width,h=a*c+l,p=r.pixelData,f=p[h],m=p[h+1],y=h+c,v=p[y],w=p[y+1];if(f+v+m+w<.5*CR){n-=a,o-=l;const b=f+(m-f)*o;return b+(v+(w-v)*o-b)*n}}return null}function Tr(e,t,i){const r=BSe(e,t,i);return _(r)?r:0}let vh=class extends Se{constructor(e){super(e),this._handles=new jt}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const r=GSe(i.fullExtent,this.viewSpatialReference);_(r)&&e.push(Ape(r))}}),e}};function ndt(e,t){return e===Ve.Global?new oq(t):new aq(t)}u([d({readOnly:!0})],vh.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],vh.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],vh.prototype,"stencilEnabledExtents",null),u([d()],vh.prototype,"viewSpatialReference",void 0),u([d()],vh.prototype,"tilingScheme",void 0),u([d()],vh.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],vh.prototype,"layers",void 0),u([d({constructOnly:!0})],vh.prototype,"layerViews",void 0),vh=u([P("esri.views.3d.terrain.ExtentHelper")],vh);let oq=class extends vh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?L_e:G7e}};oq=u([P("esri.views.3d.terrain.ExtentHelperGlobal")],oq);let aq=class extends vh{_computeLayerViewsExtent(){const e=Lu(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=GSe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);rw(e,o,e)}});const i=z9(e)?e:null,r=this._get("layerViewsExtent");return sw(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=Lu();this.layers.forEach(n=>{if(n.loaded&&fO(n)){const o=YU(n,t,Ve.Local);if(M(o))return;const{tileInfo:a,fullExtent:l}=o;_(a)&&_(l)&&(a5(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&rw(i,l,i)}}),rw(i,this.defaultTiledLayersExtent,i);const r=z9(i)?i:null,s=this._get("tiledLayersExtent");return sw(r,s)?s:r}};function GSe(e,t){return _(e)&&!e.spatialReference.equals(t)?sme(e,e.spatialReference,t):e}aq=u([P("esri.views.3d.terrain.ExtentHelperLocal")],aq);var Wt;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(Wt||(Wt={}));const ub=[Wt.ELEVATION,Wt.MAP];function jSe(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const i=Object.keys(e);for(const r of i)r.search(".glsl")!==-1&&delete e[r]}}const odt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let c0,ol=class extends Se{constructor(e){super(e),this._handles=new jt,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=he("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||ji.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return _(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?bi(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new Nd({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=td(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var i;return(i=e._stage)==null?void 0:i.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),se(()=>{var t,i,r;return[(t=e.pointsOfInterest)==null?void 0:t.renderPointOfView,(r=(i=e.pointsOfInterest)==null?void 0:i.centerOnSurfaceFrequent)==null?void 0:r.location]},()=>this.setPlacementDirty()),se(()=>{var t;return(t=e.state)==null?void 0:t.pixelRatio},()=>this.setPlacementDirty(),Ki),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),vw({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,ks.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(yt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,ks.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,ks.BACKGROUND,t)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),_(c0)&&(c0.hide(),c0=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;_(e)&&_(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new s_(-20037508342787e-6,20037508342787e-6):new s_(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Of)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&_(e.setDrapingExtent)&&_(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,ks.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const i=wit(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,qm);const r=vu(qm.inner)/vu(qm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(Ur.INNER,qm.inner,i,1*qm.pixelRatioAdjustment,qm.mapUnitsPerPixel),n=this._updateOverlay(Ur.OUTER,qm.outer,i,r*qm.pixelRatioAdjustment,qm.mapUnitsPerPixel);s!==Pf.EXTENT&&n!==Pf.EXTENT||(this._drapeSources.forEach(o=>this._updateDrapeSourceExtent(o)),this.surface.updateTileOverlayParams(t)),s===Pf.NONE&&n===Pf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return Pf.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,adt(t,n.extent)&&i===n.resolution)return o===s?Pf.NONE:Pf.RERENDER_ONLY;ay(n.extent,t),n.resolution=i;const a=XW(n.extent);return n.renderLocalOrigin=LO(a[0],a[1],0,"OV_"+this._latestOriginId++),Pf.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Ur.INNER],r=this.renderer.overlays[Ur.OUTER],s=fL(e.extent,this.surface.extent,_le);this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,Ur.INNER,t),this._setTileOverlayData(s,Ur.OUTER,t)):(this._clearTileOverlayData(Ur.INNER,t),this._clearTileOverlayData(Ur.OUTER,t))}else this._clearTileOverlayData(Ur.INNER,t),this._clearTileOverlayData(Ur.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[Ur.INNER],i=this.renderer.overlays[Ur.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;const r=this.renderer.overlays[t].extent,s=vu(r),n=Sp(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,vu(e)/s,Sp(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){jSe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||_(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,cdt,t,i);if(M(s))return!1;const n=s.origin,o=de(yD,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=De(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=yD;QE(ak(lk,bi(this.view.spatialReference).radius+a),Uu(e.eye,e.viewForward),c),pe(c,c,e.eye);const h=n_.normalize(ODe(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:r;i=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=mi(0,h,1,0),f=xu(p,p,e.projectionMatrix)[1],m=De(.5+.5*f,0,1);i=m===1||m===0?.5:l?m*r:1-(1-m)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&yW(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=R();this._findHorizonBasedPointOfInterest(e,s)||le(s,r);const n=Math.max(.1,hr(e.eye,s)),o=v_(this.view.renderCoordsHelper,r,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);ji.OVERLAY_SHOW_CENTER?(M(c0)&&(c0=new X0(this.view.graphics,"red")),c0.show(s,this._renderSR)):_(c0)&&c0.hide(),this._overlaySREqualsRenderSR||un(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&_(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&_(this._spatialReference)?1/bi(this._spatialReference).metersPerDegree:1,p=e.perRenderPixelRatio*n*h;i.mapUnitsPerPixel=p/this._worldToPCSRatio;let f=t*p/2,m=!1,y=c?90:1/0;this._isSpherical&&_(l)&&_(this._spatialReference)&&(this._spatialReference.isWebMercator?(f/=Math.cos(SF(s[1])),y=l[3]):(m=!0,f/=bi(this._spatialReference).metersPerDegree,y=90),f>=y&&(f=y,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;m&&(v=1/Math.max(.2,Math.cos(Math.abs(Dt(s[1])))),f*v>180&&(v=180/f),i.mapUnitsPerPixel*=v);const w=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/w)*w);const b=f*v,S=32,T=.5*t/(S*b),E=.5*t/(S*f);s[0]=Math.round(s[0]*T)/T,s[1]=Math.round(s[1]*E)/E;const C=i.inner;C[0]=s[0]-b,C[1]=s[1]-f,C[2]=s[0]+b,C[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(C,1/0,y);const A=i.outer;if(6*b>vu(l))ay(A,l);else if(a<=.25*Math.PI)A[0]=C[0]-b,A[1]=C[1]-f,A[2]=C[2]+b,A[3]=C[3]+f;else{un(e.eye,this._renderSR,yD,this._spatialReference),zf(w1,s,yD);let L=-Math.atan2(w1[1],w1[0])+.125*Math.PI;L<0&&(L+=2*Math.PI);const D=Math.floor(L/(.25*Math.PI));IP(w1,odt[D],2*f),w1[0]*=v,w1[2]*=v,_W(A,C,w1)}if(this._isSpherical)A[0]=this._longitudeCyclical.clamp(A[0]),A[2]=this._longitudeCyclical.clamp(A[2]),A[1]=Math.max(A[1],-y),A[3]=Math.min(A[3],y);else{const L=fL(C,l,_le),D=fL(A,l,ldt);FK(L,D)&&(A[2]=A[0],A[3]=A[1])}const I=Math.abs(C[2]-C[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,I),i.pixelRatioAdjustment=i.mapUnitsPerPixel/I}_drawOverlayTextures(e,t,i=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[Ur.INNER],i),n=this._drawOverlay(e[Ur.OUTER],i);s!==cE.CHANGED&&n!==cE.CHANGED||this.surface.updateTileOverlayParams(ks.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),r?(this.surface.requestRender(t),t===ks.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(ks.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!M(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):kP(e,t))}_rectInsideRect(e,t){return!M(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:FK(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),OF(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function adt(e,t){const r=ji.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}u([d()],ol.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],ol.prototype,"running",null),u([d()],ol.prototype,"_placementDirty",void 0),u([d()],ol.prototype,"_contentUpdated",void 0),u([d()],ol.prototype,"_isSpherical",null),u([d()],ol.prototype,"_worldToPCSRatio",null),u([d()],ol.prototype,"renderer",void 0),u([d({constructOnly:!0})],ol.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"surface.suspended"})],ol.prototype,"suspended",void 0),u([d({readOnly:!0})],ol.prototype,"updating",null),u([d({type:Boolean})],ol.prototype,"hasHighlights",null),u([d({type:Boolean})],ol.prototype,"rendersOccluded",null),ol=u([P("esri.views.3d.terrain.OverlayManager")],ol);const w1=Ht(),yD=R(),qm={inner:Nt(),outer:Nt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},_le=Nt(),ldt=Nt(),cdt=uo();var Pf;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(Pf||(Pf={}));class gP{constructor(t,i){this._factoryCallback=t,this._lengthCallback=i,this._pool=new Map}acquire(t){if(!gP.test.disabled){const i=this._pool.get(t);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(t)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+i+s),i}}release(t){if(gP.test.disabled)return;const i=this._lengthCallback(t);let r=this._pool.get(i);r||(r=new Gt({shrink:!0}),this._pool.set(i,r)),r.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}gP.test={disabled:!1};class udt{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=mr(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=Ht(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class ble{constructor(t,i,r,s,n){this._buf=t,this._localOrigin=i,this.offset0=r,this.stride=s,this.count=n}getVertexOffset(t){return 0<=t&&t<this.count,this.offset0+this.stride*t}getVertex(t,i){const r=this.getVertexOffset(i)*wh;t[0]=this._buf[r+0]+this._localOrigin[0],t[1]=this._buf[r+1]+this._localOrigin[1],t[2]=this._buf[r+2]+this._localOrigin[2]}getVertexZ(t){const i=this.getVertexOffset(t)*wh;return this._buf[i+2]+this._localOrigin[2]}setVertex(t,i,r,s){const n=this.getVertexOffset(t)*wh;this._buf[n+0]=i[0]-this._localOrigin[0],this._buf[n+1]=i[1]-this._localOrigin[1],this._buf[n+2]=i[2]-this._localOrigin[2],this._buf[n+3]=r,this._buf[n+4]=s}getNormal(t,i){const r=this.getVertexOffset(i)*wh;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}setVertexRawXYZUV(t,i,r,s,n,o){const a=this.getVertexOffset(t)*wh;this._buf[a+0]=i,this._buf[a+1]=r,this._buf[a+2]=s,this._buf[a+3]=n,this._buf[a+4]=o}setVertexRawXYZUVN(t,i,r,s,n,o,a,l,c){const h=this.getVertexOffset(t)*wh;this._buf[h+0]=i,this._buf[h+1]=r,this._buf[h+2]=s,this._buf[h+3]=n,this._buf[h+4]=o,this._buf[h+5]=a,this._buf[h+6]=l,this._buf[h+7]=c}setVertexRawNormal(t,i,r,s){const n=this.getVertexOffset(t)*wh;this._buf[n+5]=i,this._buf[n+6]=r,this._buf[n+7]=s}getVertexRawNormal(t,i){const r=this.getVertexOffset(i)*wh;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}}const hdt=ls().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.NORMAL),dJ=new gP(e=>hdt.createBuffer(e),e=>e.count);function ddt(){dJ.clear()}function HSe(e){return dJ.acquire(e)}function pdt(e){dJ.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}class fdt{constructor(){this.sinLonLUT=new Array(Hj+1),this.cosLonLUT=new Array(Hj+1)}update(t,i){const r=i[0],s=i[2];for(let n=0;n<=t;n++){const o=n/t,a=r*(1-o)+s*o;this.sinLonLUT[n]=Math.sin(a),this.cosLonLUT[n]=Math.cos(a)}}}class vD{constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class mdt{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new vD,new vD,new vD,new vD],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class gdt{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new mdt}}class p2{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=lt(this._current),this._next=lt(this._next),this._waiting=lt(this._waiting),this._delayed=lt(this._delayed)}get current(){if(M(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=p2.test.fadeMoment;if(_(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,ty.Immediate),this._delayed=null)),_(this._next)){t=t||performance.now();const i=this._fadeDuration,r=_(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==Vn.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(lt(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(M(this._next))return 1;const t=p2.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return _(this._next)||_(this._delayed)}push(t,i=ty.Immediate){this._delayed=lt(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),M(this._current))return void(this._current=t);const r=p2.test.fadeMoment||performance.now();return i!==ty.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):M(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(M(t)||(lt(this._waiting),this._waiting=t))}get _fadeDuration(){return M(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}}var ty;p2.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(ty||(ty={}));class qSe{constructor(){this._queue=new Gt,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),_(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class ydt{constructor(){this.q=new Gt}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!M(t)){this.q.pushArray(t);for(let i=0;i<this.q.length;++i){const r=this.q.data[i];r.isLeaf||this.q.pushArray(r.children)}}}next(){return this.q.pop()}}function GO(e,t,i){if(M(t)||M(t.fullExtent))return!1;const r=t.fullExtent,s=e.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function WSe(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function XSe(e,t){t.sort((i,r)=>YSe(i,r,e))}function YSe(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:WSe(e,t)}function vdt(e,t){const i=new Map;e.forAll(r=>i.set(r.lij,r.distanceToSquared(t))),e.sort((r,s)=>i.get(r.lij)-i.get(s.lij)||WSe(r,s))}function _dt(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function bdt(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i&&n.loadable)return!0}}return!1}function b2t(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}class pJ{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,Vn.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return _(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),s=rq(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?GO:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=_(m)?m.tile.level:-1,v=!!_(m)&&y-p>=a,w=rs(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const b=h.level,S=p-b,T=h.layerInfo[i][t];if(T.data&&S>=a){(!v||b>y)&&this._setUpsampleTile(h),T.dataInvalidated&&(f=h);break}if((M(w)||w.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&b<=o&&!T.data&&!T.dataMissing&&((M(f)||h.level===n||b%D_e==0||p-f.level<a)&&(f=h),S>=l))break;h=h.parent}return _(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,Vn.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class wdt extends pJ{get _desiredMinLevelDelta(){throw wle}get _progressiveLevelModulo(){throw wle}dispose(){}}const wle=new Error("Abstract method called on TileAgent"),Vl=new wdt;class ZSe extends pJ{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return iN(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class QSe extends pJ{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return D_e}}var mw,Kw;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(mw||(mw={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(Kw||(Kw={}));var xle,Ne;(function(e){e[e.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.COUNT=2]="COUNT"})(xle||(xle={})),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(Ne||(Ne={}));const DN={normal:Ne.Normal,average:Ne.Average,lighten:Ne.Lighten,lighter:Ne.Lighter,screen:Ne.Screen,plus:Ne.Plus,"color-dodge":Ne.ColorDodge,darken:Ne.Darken,multiply:Ne.Multiply,"color-burn":Ne.ColorBurn,overlay:Ne.Overlay,"soft-light":Ne.SoftLight,"hard-light":Ne.HardLight,"vivid-light":Ne.VividLight,hue:Ne.Hue,saturation:Ne.Saturation,luminosity:Ne.Luminosity,color:Ne.Color,difference:Ne.Difference,exclusion:Ne.Exclusion,minus:Ne.Minus,invert:Ne.Invert,reflect:Ne.Reflect,"destination-over":Ne.DestinationOver,"destination-atop":Ne.DestinationAtop,"destination-in":Ne.DestinationIn,"destination-out":Ne.DestinationOut,"source-atop":Ne.SourceAtop,"source-in":Ne.SourceIn,"source-out":Ne.SourceOut,xor:Ne.Xor};function xdt(e){return e===Ne.DestinationOver||e===Ne.DestinationAtop||e===Ne.DestinationIn||e===Ne.DestinationOut||e===Ne.SourceAtop||e===Ne.SourceIn||e===Ne.SourceOut||e===Ne.Xor}function Tdt(e){e.fragment.uniforms.add([new Vt("u_colormap",t=>t.u_colormap),new Xe("u_colormapOffset",t=>t.colormap.u_colormapOffset),new Xe("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new Xe("u_opacity",t=>t.common.u_opacity)]),e.fragment.code.add(x`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}function Sdt(e){e.fragment.uniforms.add(new Vt("u_transformGrid",t=>t.u_transformGrid)),e.fragment.uniforms.add(new pi("u_transformSpacing",t=>t.common.u_transformSpacing)),e.fragment.uniforms.add(new pi("u_transformGridSize",t=>t.common.u_transformGridSize)),e.fragment.uniforms.add(new pi("u_targetImageSize",t=>t.common.u_targetImageSize)),e.fragment.code.add(x`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}class JSe extends Ys{constructor(){super(...arguments),this.scale=1,this.offset=Zh}}function KSe(e){e.attributes.add(O.POSITION,"vec2"),e.attributes.add(O.UV0,"vec2"),e.vertex.uniforms.add(new Xe("scale",t=>t.scale)),e.vertex.uniforms.add(new pi("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(x`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class Edt extends JSe{constructor(t,i,r){super(),this.common=t,this.u_image=i,this.u_transformGrid=r}}function Cdt(e){e.include(Sdt),e.fragment.uniforms.add([new Vt("u_image",t=>t.u_image),new kw("u_flipY",t=>t.common.u_flipY),new kw("u_applyTransform",t=>t.common.u_applyTransform)]),e.fragment.code.add(x`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}function fJ(e){e.code.add(x`
    float lineFactorAtPosition(float value) {
      float pos = value * ${x.float(257)};
      if(pos < 0.5 || pos > ${x.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}var Bo;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(Bo||(Bo={}));function e2e(e,t){const i=t.blendMode;i!==Ne.Normal&&(i===Ne.Reflect&&e.code.add(x`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Ne.ColorDodge&&i!==Ne.VividLight||e.code.add(x`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Ne.ColorBurn&&i!==Ne.VividLight||e.code.add(x`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Ne.Overlay&&e.code.add(x`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Ne.HardLight&&e.code.add(x`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Ne.SoftLight&&e.code.add(x`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Ne.VividLight&&e.code.add(x`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Ne.Hue&&i!==Ne.Saturation&&i!==Ne.Color&&i!==Ne.Luminosity||(e.code.add(x`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Ne.Hue&&i!==Ne.Saturation||e.code.add(x`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(x`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Ne.Multiply?x`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Average?x`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Lighten?x`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Darken?x`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Lighter?x`return vec4(cl * ol + cb * ob, ol + ob);`:i===Ne.Plus?x`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Ne.Minus?x`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Ne.Screen?x`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Difference?x`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Invert?x`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ne.DestinationOver?x`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Ne.DestinationAtop?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Ne.DestinationOut?x`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Ne.SourceAtop?x`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ne.SourceOut?x`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Ne.Xor?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Ne.DestinationIn?x`return vec4(cb * ob * ol, ol * ob);`:i===Ne.SourceIn?x`return vec4(cl * ol * ob, ol * ob);`:i===Ne.Hue?x`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Saturation?x`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Color?x`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Luminosity?x`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Exclusion?x`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Reflect?x`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.ColorDodge?x`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.ColorBurn?x`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Overlay?x`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.SoftLight?x`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.HardLight?x`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.VividLight?x`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:x``}
    }
  `))}var po,wn;function Adt(e){const t=new qi,i=e.output===po.GridOnly,r=e.output===po.GridComposite,s=r||i,n=e.output===po.ColorOnly,o=e.output===po.ColorComposite,a=o||n,l=r||o;if(t.include(KSe),a&&t.fragment.uniforms.add(new xt("backgroundColor",m=>m.backgroundColor)),e.baseOpacityMode!==wn.One&&t.fragment.uniforms.add(new Xe("baseOpacity",m=>m.baseOpacity)),s&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(fJ)),i||n)return t.fragment.code.add(x`
    void main() {
      gl_FragColor = ${n?x`vec4(backgroundColor, 1.0)`:x`gridColor(uv)`};
    }
  `),t;const c=e.blendMode!==Ne.Normal,h=e.baseOpacityMode===wn.OnBaseLayer,p=e.baseOpacityMode===wn.OnBackground||e.baseOpacityMode===wn.OnBaseLayer,f=e.premultipliedSource;return t.fragment.uniforms.add(new Vt("tex",m=>m.texture)),t.fragment.uniforms.add(new Xe("opacity",m=>m.opacity)),(c||h||f)&&(t.fragment.uniforms.add(new Vt("fboColor",m=>m.fboTexture)),t.fragment.uniforms.add(new Xe("tileSize",m=>_(m.fboTexture)?m.fboTexture.descriptor.width:1))),t.fragment.include(e2e,e),t.fragment.code.add(x`
    void main() {
      ${l||h||f?x`
      vec4 bgColor = ${o?x`vec4(backgroundColor, 1.0)`:r?x`gridColor(uv)`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${p?x`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${c?x`
          vec4 fboTex = ${l?x`bgColor;`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${h?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:x`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${f?x`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:l||h?x`mix(bgColor, pmColorLayer, composeAlpha);`:x`pmColorLayer * composeAlpha;`}`}
    }
  `),t}(function(e){e[e.Composite=0]="Composite",e[e.ColorOnly=1]="ColorOnly",e[e.GridOnly=2]="GridOnly",e[e.ColorComposite=3]="ColorComposite",e[e.GridComposite=4]="GridComposite",e[e.COUNT=5]="COUNT"})(po||(po={})),function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT"}(wn||(wn={}));const Mdt=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return po},get BaseOpacityMode(){return wn},build:Adt},Symbol.toStringTag,{value:"Module"}));class QU extends Edt{constructor(t,i,r,s,n,o){super(t,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=za,this.fboTexture=null,this.baseOpacity=1}}class Odt extends QU{}class Rdt extends QU{}function Pdt(e){const t=new qi;t.include(KSe),t.include(Cdt),t.include(Tdt),e.tileBlendInput===Bo.GridComposite&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(fJ));const i=e.tileBlendInput===Bo.ColorComposite;i&&t.fragment.uniforms.add(new xt("backgroundColor",a=>a.backgroundColor)),e.baseOpacityMode!==wn.One&&t.fragment.uniforms.add(new Xe("baseOpacity",a=>a.baseOpacity));const r=e.baseOpacityMode===wn.OnBaseLayer,s=e.baseOpacityMode===wn.OnBackground||e.baseOpacityMode===wn.OnBaseLayer,n=e.blendMode!==Ne.Normal;t.fragment.include(e2e,e);const o=e.tileBlendInput!==Bo.LayerOnly;return(n&&!o||r)&&(t.fragment.uniforms.add(new Vt("fboColor",a=>a.fboTexture)),t.fragment.uniforms.add(new Xe("tileSize",a=>_(a.fboTexture)?a.fboTexture.descriptor.width:1))),t.fragment.code.add(x`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${o||r?x`
          vec4 bgColor = ${r?x`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:i?x`vec4(backgroundColor, 1.0)`:x`gridColor(vuv)`};
          ${s?x`bgColor *= baseOpacity;`:""}`:""}
      ${n?x`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${o?x`bgColor;`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${r?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:o||r?x`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:x`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),e.colorizerType===mw.Stretch?$dt(t,e):e.colorizerType===mw.Lut?Idt(t):e.colorizerType===mw.Hillshade&&Ddt(t,e),t}function Idt(e){e.fragment.code.add(x`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function $dt(e,t){e.fragment.uniforms.add([new x3("u_bandCount",r=>r.symbolizer.u_bandCount),new aa("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new aa("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new aa("u_factor",r=>r.symbolizer.u_factor,3),new Xe("u_minOutput",r=>r.symbolizer.u_minOutput),new Xe("u_maxOutput",r=>r.symbolizer.u_maxOutput),new kw("u_useGamma",r=>r.symbolizer.u_useGamma),new aa("u_gamma",r=>r.symbolizer.u_gamma,3),new aa("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new Xe("u_opacity",r=>r.common.u_opacity)]),e.fragment.code.add(x`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(x`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===Kw.Noop?x`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:x`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function Ddt(e,t){const i=e.fragment;i.uniforms.add([new Vt("u_image",s=>s.u_image),new x3("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new aa("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new aa("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new aa("u_cosZs",s=>s.symbolizer.u_cosZs,6),new aa("u_weights",s=>s.symbolizer.u_weights,6),new pi("u_factor",s=>s.symbolizer.u_factor),new Xe("u_minValue",s=>s.symbolizer.u_minValue),new Xe("u_maxValue",s=>s.symbolizer.u_maxValue),new pi("u_srcImageSize",s=>s.common.u_srcImageSize)]),i.include(Mm),i.code.add(x`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),i.code.add(x`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(x`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Ldt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:QU,ColorizerStretchUniforms:Odt,ColorizerHillshadeUniforms:Rdt,build:Pdt},Symbol.toStringTag,{value:"Module"}));function Ndt(e,t,i="nearest",r=!1){var c;const s=!(r&&t.pixelType==="u8"),n=s?St.FLOAT:St.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===li.WEBGL2&&s?gt.RGBA32F:ze.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?tt.NEAREST:tt.LINEAR,dataType:n,wrapMode:bt.CLAMP_TO_EDGE,flipped:!1};return new ot(e,l,o)}function Fdt(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=t,a=i[0]>1,l={width:a?4*n:n,height:o,target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===li.WEBGL2?gt.RGBA32F:ze.RGBA,dataType:St.FLOAT,samplingMode:tt.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new ot(e,l,c)}function Tle(e,t){const i={width:t.length/4,height:1,target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,flipped:!1};return new ot(e,i,t)}function kdt(e,t,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:Zh,u_transformGridSize:e?e.size:Zh,u_targetImageSize:t,u_srcImageSize:i}}function Udt(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function zdt(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function Vdt(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const Sle={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class Bdt{constructor(t,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=Qe(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?me(F({},Sle),{maxCutOff:[1,1,1],factor:[1,1,1]}):this._symbolizerParameters||Sle}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){_(t)&&t.length>0?this._bandIds&&t.every((i,r)=>!!this._bandIds[r]&&i===this._bandIds[r])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,_(this._rasterTexture)){const i=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(i==="bilinear"?tt.LINEAR:tt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=Qe(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((M(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),_(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&M(this._transformGridTexture)&&(this._transformGridTexture=Fdt(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:i,width:r,height:s,opacity:n}=this,o=kdt(i,[r,s],[this.source.width,this.source.height],n),a=Udt(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?zdt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Vdt(this.symbolizerParameters):null;return new QU(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(M(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(i=>_(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=Qe(this._rasterTexture),this._transformGridTexture=Qe(this._transformGridTexture),this._colormapTexture=Qe(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=Qe(this._rasterTexture));const s=M(i)&&M(this.bandIds)||_(i)&&_(this.bandIds)&&i.join("")===this.bandIds.join("");if(_(this._rasterTexture)&&s)return;this._rasterTexture=Qe(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Ndt(t,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=Qe(this._colormapTexture),this._colormapTexture=Tle(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=Tle(t,r),void(this._colormap=r)):(this._colormapTexture=Qe(this._colormapTexture),void(this._colormap=null))}}class LN{constructor(){this.waitingAgents=new Gt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const i=WB.acquire();return i._init(t),i}release(){this.dispose(),NN.delete(this),WB.release(this)}dispose(){this.loadingAgent=Qe(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=d2(this._data)}static prune(){WB.prune(0)}_init(t){this.waitingAgents.clear(),this._data=d2(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Xh(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){_(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t===i||M(i))this._unsetUpsampleInfo();else{if(M(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),_dt(t,i,this._upsampleInfo)}}get data(){return this._data}set data(t){d2(this._data),this._data=t}}const WB=new Es(LN,null,()=>{}),NN=new Map;function Gdt(){NN.size>0&&(console.log(`${NN.size} live TilePerLayerInfo allocations:`),NN.forEach(e=>console.log(e,`
`)))}class aS{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var _t;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(_t||(_t={}));const XB=R(),aT=R(),Wn=R(),jdt=.1;class Hdt{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class mJ{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=Nt(),this._elevationBounds=st(),this.layerInfo=[[],[]],this.extentInRadians=Nt(),this.centerAtSeaLevel=R(),this._center=[R(),Cn(),R()],this.up=mW(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){gJ.prune(0),yJ.prune(0),LN.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Pa.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===AE.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,i,r){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=bi(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Pa.MIDDLE][3]=0,this.vlevel=t?t[0]:0,i&&i.elevationBounds?_o(this._elevationBounds,i.elevationBounds):di(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of ub){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=LN.acquire(this._surface.upsampleInfoPool),s===Wt.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,Hj)}release(){Lf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of ub){for(const i of this.layerInfo[t])i.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const t=this.cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Wt.MAP].reduce((t,i)=>t+(i instanceof BO?i.memoryUsage:0),this._mapTileMemory)}get cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(_(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let t=0;for(const{data:r}of this.layerInfo[Wt.MAP])r instanceof BO?t+=this._getTerrainDataMemory(r):this._mapTileMemory+=this._getTerrainDataMemory(r);const i=this.cpuImageMemorySize;for(const r of this.layerInfo[Wt.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=Fw(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+t),this._usedMemory}getUsedMemoryForLayer(t,i){const r=this.layerInfo[t][i];return(r==null?void 0:r.data)?t===Wt.MAP?this.isCached?0:this._getTerrainDataMemory(r.data):t===Wt.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof aS?Fw(t.texture):t instanceof HTMLImageElement||t instanceof WU?this.cpuImageMemorySize:t instanceof BO||t instanceof Bdt?t.memoryUsage:0}updateScreenDepth(t){const i=this._center[Pa.MIDDLE],r=t,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this._screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(t,i,r){if(_(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return _t.NONE;const s=this.level;pe(XB,this._center[Pa.MIDDLE],i);let n=Fa(XB),o=Pa.MIDDLE;pe(aT,this._center[Pa.TOP],i);const a=Fa(aT);a<n&&(n=a,o=Pa.TOP),pe(aT,this._center[Pa.BOTTOM],i);const l=Fa(aT);if(l<n&&(n=l,o=Pa.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return _t.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,f=()=>{const w=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return w!==this.vlevel?(this.vlevel=w,_t.VSPLITMERGE):_t.NONE_HIT_MAXLOD};if(r===AE.ON&&this._surface.snapLevel-s===1)return s>=t.maxLod?f():_t.SPLIT;const m=Te(this.up,XB),y=this._elevationBounds[1]-this._elevationBounds[0],v=y/this.edgeLen;if(t.aboveGround&&m>0&&v<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-v>0)return _t.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,_t.VSPLITMERGE):_t.NONE;if(s>=t.maxLod)return f();if(s>6){pe(aT,this._center[o],i),ce(Wn,this.up,m),pe(Wn,Wn,aT);const w=Fa(Wn);if(w>this.radius*this.radius){ce(Wn,Wn,this.radius/Math.sqrt(w)),de(Wn,Wn,this._center[o]),pe(Wn,i,Wn);const b=Math.min(1,(Math.abs(Te(Wn,this.up))+.5*y+this._curvatureHeight)/Oe(Wn)),S=jdt/t.angledSplitBias,T=t.fovY*c*2;if(b*(this._edgeLen/T)<S*t.relativeHeightLimit)return _t.NONE}}return _t.SPLIT}setChildren(t,i,r,s){Lf(!!(t&&i&&r&&s),"Null child passed"),this._children[0]=t,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,i;return(i=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?i:!1}prepareToLoad(t){this.refMapData();for(const i of ub)this._createOrUpdateAgents(0,i);t.updateTileGeometryState(this)}load(t){this.prepareToLoad(t),this.loadPrepared(t)}loadPrepared(t){t.loadTile(this)}unload(t){t.unloadTile(this);for(const i of ub){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==Vl&&(_D(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(_t.GEOMETRY),this.resetPendingUpdate(_t.TEXTURE_NOFADING),this.resetPendingUpdate(_t.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[Wt.MAP];for(const i of t)i.loadingAgent&&i.loadingAgent!==Vl&&(_D(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(sw(t,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;_(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(_t.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){const r=this.layerInfo[i][t];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of ub){const i=this.layerInfo[t];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Vl&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(_t.SPLIT)||t!==Wt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===_t.SPLIT||t===_t.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){const s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),r.dataArrived(this),!0;if(s.requestPromise)return!0;Xh(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return Fa(pe(Wn,this._center[Pa.MIDDLE],t))}containsPoint(t){const i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}unrequestLayerData(t,i,r){const s=this.layerInfo[i][t],n=s.waitingAgents,o=n.removeUnordered(r)!=null;Lf(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,i,r){const s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${t} error ${r}`);const s=this.layerInfo[i][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,i){switch(t){case Wt.MAP:return this._updateTexture(i);case Wt.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===Vn.FADING?_t.TEXTURE_NOFADING:_t.TEXTURE_FADING),this.setPendingUpdate(t===Vn.FADING?_t.TEXTURE_FADING:_t.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(_t.GEOMETRY);for(const t of this.layerInfo[Wt.ELEVATION])t.pendingUpdates|=_t.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const t=this._elevationBounds;di(t,Number.MAX_VALUE,-Number.MAX_VALUE);const i=this.layerInfo[Wt.ELEVATION];let r=!0;for(const s of i)_(s.elevationBounds)&&(t[0]=Math.min(t[0],s.elevationBounds.min),t[1]=Math.max(t[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(r=!1));r&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,i=.5*(t[0]+t[1]);ce(Wn,this.up,i),de(this._center[Pa.MIDDLE],this.centerAtSeaLevel,Wn),ce(Wn,this.up,t[0]),de(this._center[Pa.TOP],this.centerAtSeaLevel,Wn),ce(Wn,this.up,t[1]),de(this._center[Pa.BOTTOM],this.centerAtSeaLevel,Wn)}findElevationBoundsForLayer(t,i){const r=this.layerInfo[Wt.ELEVATION][t];if(_(r.elevationBounds)&&r.elevationBounds.level>=i)return;const s=this._surface.layerViewByIndex(t,Wt.ELEVATION),n=rq(s);if(!GO(this,n,!1))return;const o=Wdt;let a=!1;if(r.data){const l=r.data;o.min=l.bounds[0],o.max=l.bounds[1],o.hasNoDataValues=l.hasNoDataValues,o.level=this.level,a=!0}else{let l,c,h=0;for(let p=this._parent;p&&(!c||h<iN(this.level))&&(h=this.vlevel-p.level,l=c||l,c=p.layerInfo[Wt.ELEVATION][t].data,!(!c&&l&&h>=iN(this.level)));p=p.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=c.level,a=!0))}a&&(M(r.elevationBounds)&&(r.elevationBounds=new hJ),r.elevationBounds.copyFrom(o))}modifyLayers(t,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Vl&&(_D(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:LN.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,Vn.FADING))}updateAgents(t){if(this.renderData){const i=this.layerInfo[t];for(const r of i)r.loadingAgent===Vl&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of ub){const i=this._isSuspended(t);for(const r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==Vl&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Vl&&this.updateRenderData(t,Vn.FADING))}}removeLayerAgent(t,i){const r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==Vl&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){const r=this.layerInfo[i][t];r.loadingAgent=Vl,!r.data&&M(r.upsampleInfo)&&this._createOrUpdateAgents(t+1,i)}_createOrUpdateAgents(t,i){const r=this.layerInfo[i];if(r.length===0)return;const s=(()=>{for(let o=t;o<r.length;++o){const a=this._surface.layerViewByIndex(o,i);if(l5(a)&&a.layer.blendMode!=="normal")return!0}return!1})(),n=this._isSuspended(i);for(let o=t;o<r.length;++o){const a=r[o];let l=!1;const c=this._surface.layerViewByIndex(o,i),h=rq(c);if(a.loadingAgent?GO(this,h,!1)?(a.loadingAgent!==Vl&&a.loadingAgent.setSuspension(n),a.loadingAgent!==Vl&&(l=a.loadingAgent.update())):a.dispose():GO(this,h,!1)&&(a.loadingAgent=qdt(this,o,i,n),l=a.loadingAgent.startLoading(),l?a.loadingAgent===Vl&&this.setPendingUpdate(_t.GEOMETRY):(_D(a.loadingAgent),a.loadingAgent=Vl)),a.loadingAgent===Vl&&this.updateRenderData(i,Vn.FADING),!s&&l&&c.isOpaque)return}}_isWithinExtent(t){const i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){const i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationBasedVerticesPerSide(t){const i=this.vlevel-this.level,r=Math.max(this.level-t,iN(this.level)-i);return De(1+(this.maxTesselation>>r),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(t,i){if(!t)return null;const r=this.surface.rootTiles;if(_(r)){for(const s of r)if(Xdt(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(t,i){const r=this.lij,s=this.getNeighborLIJ(r,t);return s?Ydt(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(t,i){const r=t===kt.NORTH_EAST?1:t===kt.NORTH_WEST?0:t===kt.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||i&&i(s));)s=s.children[r];return s}findNeighborCornerTileExact(t,i){var r;return(r=this.findNeighborTile(t,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(c5(t),i)}forAllSubtreeOnSide(t,i){const r=t===kt.NORTH?[0,1]:t===kt.NORTH_EAST?[1]:t===kt.EAST?[1,3]:t===kt.SOUTH_EAST?[3]:t===kt.SOUTH?[2,3]:t===kt.SOUTH_WEST?[2]:t===kt.WEST?[0,2]:[0],s=n=>{i(n)||n.isLeaf||r.forEach(o=>s(n.children[o]))};s(this)}forallNeighbors(t){u5.forEach(i=>this.findNeighborCornerTileExact(i,t)),_v.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||t(s)))==null?void 0:r.forAllSubtreeOnSide($N(i),t)})}getNeighborEdgeStartVertexIndex(t,i){const r=i!=null?i:this.findNeighborTile(_v[t],h=>h.isLoaded);if(!r||!this.isLoaded||!r.isLoaded)return 0;const s=this.level-r.level;if(s===0)return 0;const n=2**s,o=(1&t)==1,a=o?0:1,l=r.lij[a+1]*n,c=this.lij[a+1]-l;return o?n-1-c:c}_updateNeighborsWithChangedEdgeResolution(){for(let t=0;t<4;++t)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]){const i=_v[t],r=this.findNeighborTile(i,s=>s.isLoaded||s.level===this.level);if(!r)continue;if(!r.isLoaded){r.isLeaf;const s=(t+2)%4,n=$N(i);r.forAllSubtreeOnSide(n,o=>o.isLoaded?(o.updateEdgeAfterResolutionChange(s),!0):(o.isLeaf,!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(t=this.level){this.forEachLoadedNeighbor(i=>this._updateNeighbor(i)),_v.forEach(i=>{var r;(r=this.findNeighborTile(i,s=>s.isLoaded&&s.level<t))==null||r.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(t){this.renderData.updateEdgeAfterResolutionChange(t)}forEachLoadedNeighbor(t){const i=this.level,r=s=>s.level===i||s.isLoaded;_v.forEach((s,n)=>{var l,c;const o=this.findNeighborTile(s,r);o!=null&&o!==this&&o.forAllSubtreeOnSide($N(s),h=>!!h.isLoaded&&(t(h),!0));const a=(c=(l=this.renderData)==null?void 0:l.geometryState)==null?void 0:c.neighborData;a&&(a.modifiedEdgeResolutions[n]=!1)}),u5.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(c5(s),a=>a.isLoaded);!n||Zdt(this,n,s),(n==null?void 0:n.isLoaded)&&t(n)})}_updateNeighbor(t){(t==null?void 0:t.isLoaded)&&t.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(t,i){const r=ule(i)?-1:cle(i)?1:0,s=ale(i)?-1:lle(i)?1:0,n=[t[0],t[1]+r,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Et>=this.surface.extent[1]}compareLIJs(t){const i=this.lij,r=i[0],s=t[0];if(r===s)return[i,t];const n=r-s;if(n<0){const o=2**-n;return[[s,i[1]*o,i[2]*o],t]}{const o=2**n;return[i,[r,t[1]*o,t[2]*o]]}}checkGeometryWaterproofness(){}shouldHaveNeighbor(t){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(ule(t)&&i[3]+s>=r[3]||cle(t)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&ale(t)&&i[0]-s<=r[0])&&!(!n&&lle(t)&&i[2]+s>=r[2])}}function qdt(e,t,i,r){const s=i===Wt.ELEVATION?yJ.acquire():gJ.acquire();return s.init(e,t,i,r),s}function _D(e){e.dispose(),e instanceof ZSe?yJ.release(e):e instanceof QSe&&gJ.release(e)}const gJ=new Es(QSe),yJ=new Es(ZSe),Wdt=new hJ;var Pa;function Xdt(e,t){const i=e.level,r=t[0];if(i>r)return!1;const s=r-i,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function Ydt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function YB(e,t,i){return Math.abs(e-t)<=i}function Zdt(e,t,i){return!M(e)&&!M(t)&&t!==e&&(e.level>=t.level?Ele(e,t,i):Ele(t,e,c5(i)))}function Ele(e,t,i){e.level>=t.level;const r=xht(i),s=Tht(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=YB(a[0],l[0],c)||e.surface.isGlobal&&YB(a[0],-l[0],c),p=YB(a[1],l[1],c);return h&&p?!0:e.level===t.level||!h&&!p?!1:h?Cle(o[1],o[3],n[1],n[3],c):Cle(o[0],o[2],n[0],n[2],c)}function Cle(e,t,i,r,s=Et){return e-s<=i&&i<=r&&r<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Pa||(Pa={}));class Qdt{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}class Gg{constructor(){this.geometryInfo=new udt,this.intersectionData=null,this.geometryState=null,this._textureRef=new p2(()=>this.tile.surface.textureFadeDuration),this.overlay=new Qdt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(t){this._tile=t,this.clear();const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,mr(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new gdt,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(t,i){const r=this.updateGeometryStateAndPrepareForGeometryGeneration(i);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(r,t)}updateNeighborDataAndGeometryIfNeeded(t=!1,i=this.vao.context){const r=this._updateNeighborData(),s=t||this._geometryStateChangedSinceLastUpdate||r;return s&&(this._updateGeometry(i),this._geometryStateChangedSinceLastUpdate=!1),s}_calculateEdgeResolution(t,i){var c;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const h=r.surface.extent;if(_(h)&&(t===0&&r.extent[3]>h[3]||t===1&&r.extent[2]>h[2]||t===2&&r.extent[1]<h[1]||t===3&&r.extent[0]<h[0]))return s}const n=r.level,o=_v[t],a=i||r.findNeighborTile(o,h=>h.isLoaded||h.level===n);if(!a||a.isLeaf&&!a.isLoaded)return M((c=r.surface)==null?void 0:c.rootTiles)||r.surface.updatingRootTiles||r.shouldHaveNeighbor(o),s;if(a.isLoaded){const h=a,p=h.renderData.geometryState,f=n-h.level;if(f===0){const v=p.numVerticesPerSide-1;return Math.max(v,s)}const m=2**f,y=p.neighborData.edgeResolutions[(t+2)%4]/m;return Math.max(1,y)}a.isLeaf;let l=s;return a.forAllSubtreeOnSide($N(o),h=>h===r||(h.isLoaded?(l=Math.max(l,2**(h.level-n)),!0):(h.isLeaf,!1))),l}_updateNeighborData(){const t=this.tile,i=c=>c.isLoaded||c.level===t.level,r=c=>c.isLoaded,s=[null,null,null,null],n=[null,null,null,null];(()=>{for(let c=0;c<4;++c){const h=t.findNeighborTile(_v[c],i);s[c]=h,n[c]=(h==null?void 0:h.isLoaded)?h:null}})();const o=[null,null,null,null];(()=>{for(let c=0;c<4;++c)o[c]=t.findNeighborTile(u5[c],r)})();const a=this.geometryState.neighborData;let l=!1;return(()=>{for(let c=0;c<4;++c){const h=a.edgeResolutions[c],p=s[c],f=this._calculateEdgeResolution(c,p);a.edgeResolutions[c]=f,h!==f&&(l=!0,this._edgeResolutionChanged=!0,p&&p!==t&&!p.isLoaded&&p.level===t.level&&(a.modifiedEdgeResolutions[c]=!0))}})(),(()=>{const c=(f,m)=>{var b,S;const y=f.reduce((T,E)=>{var C;return Math.min(T,(C=E==null?void 0:E.level)!=null?C:1/0)},1/0);for(let T=0;T<4;++T){const E=f[(T+3)%4],C=f[T];if(E&&E.level<t.level&&E===C){const A=E,I=(1&T)==1,L=(t.getNeighborEdgeStartVertexIndex(T,A)+(m===0||m===1&&!I||m===3&&I?1:0))/2**(t.level-A.level),D=I?m===0||m===1?A.extent[0]:A.extent[2]:qt(A.extent[0],A.extent[2],L),U=I?qt(A.extent[1],A.extent[3],L):m===0||m===3?A.extent[1]:A.extent[3];return Tr(D,U,A.renderData.geometryState.samplerData)}}let v=0,w=0;for(let T=0;T<4;++T){const E=f[T];if(E&&E.level===y){const C=T===0||T===1,A=T===0||T===3,I=E.extent;w+=Tr(I[C?0:2],I[A?1:3],(S=(b=E.renderData)==null?void 0:b.geometryState)==null?void 0:S.samplerData),v++}}return v?w/v:0},h=a.cornerNeighborData,p=(f,m)=>{var b;const y=h[f],v=y.cornerTiles;for(let S=0;S<4;++S){const T=u5[S],E=(b=m[S])==null?void 0:b.findCorner(c5(T),C=>(C==null?void 0:C.isLoaded)||C===t);v[S]=E}const w=c(v,f);return y.elevation!==w&&(y.elevation=w,!0)};for(let f=0;f<4;++f){const m=o[f],y=n[f],v=[m,n[(f+1)%4],t,y],w=v.map((b,S)=>v[(S+4-f)%4]);p(f,w)&&(this._cornerElevationChanged=!0,l=!0)}})(),(()=>{var p;const c=(f,m)=>{if(!(f==null?void 0:f.isLoaded)||f.lij[0]>t.lij[0])return null;const y=f.renderData.geometryState;return{neighborSamplerData:y.samplerData,neighborEdgeOverlapResolution:y.neighborData.edgeResolutions[m+2],version:y.samplerDataVersion,neighborVerticesPerSide:y.numVerticesPerSide,neighborTile:f}},h=a.edgeNeighbours;for(let f=0;f<4;++f){const m=n[f];m&&(m==null||m.isLoaded,(m==null?void 0:m.lij[0])<=t.lij[0],void 0);const y=h[f],v=y==null?void 0:y.version,w=c(m,f),b=(p=w==null?void 0:w.version)!=null?p:null,S=y!=null!=(w!=null),T=y&&w&&v!==b,E=y&&w&&(y==null?void 0:y.neighborTile)!==(w==null?void 0:w.neighborTile),C=S||T||E;this._edgeNeighborChanged||(this._edgeNeighborChanged=C),l||(l=C),!C&&v||(h[f]=w)}})(),l}updateEdgeAfterResolutionChange(t){var n,o;const i=this._calculateEdgeResolution(t),r=this.geometryState.neighborData.edgeResolutions,s=r[t];((o=(n=this.geometryState.neighborData.edgeNeighbours[t])==null?void 0:n.neighborTile.level)!=null?o:0)<=this.tile.level,i!==s&&(r[t]=i,this._edgeResolutionChanged=!0,Gg.deferTileNeighborUpdate?Gg.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(t){this.intersectionData=null;const i=this.tile,r=i.lij,s=Gg.updatedGeometryTiles.get(r)||0;Gg.updatedGeometryTiles.set(r,s+1);const n=this._vao,o=this.geometryInfo.vertexAttributes,a=!n||!o||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,l=!a&&this._edgeNeighborChanged,c=!l&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,a?(this._releaseGeometry(),this._createGeometry(t)):l?i.updateEdgeElevations():c?i.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,i){return _(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),M(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){_(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(t){const i=this._getElevationInfo(),r=i.samplerData?this.tile.getElevationBasedVerticesPerSide(i.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),s=Math.max(r,5);let n=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;return o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),i.changed&&(this._samplerDataChanged=!0,o.samplerData=i.samplerData,o.samplerDataVersion++,a=!0),i_(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0),o.wireframe!==t&&(this._wireframeChanged=!0,o.wireframe=t,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),this._hasGeometry=!0,a}_createGeometry(t){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=t.gl;this._vao=new qs(t,zi,{geometry:Dc(i.layout)},{geometry:si.createVertex(t,s.STATIC_DRAW,i.buffer)},si.createIndex(t,s.STATIC_DRAW,r)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,pdt(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,i=ty.Immediate){_(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,i=this.tile.layerInfo[Wt.ELEVATION],r=i.length;let s=new Array(r),n=0,o=0,a=!1;for(let l=0;l<r;l++){const c=i[l];if(_(c.upsampleInfo)){const h=c.upsampleInfo.tile,p=h.layerInfo[Wt.ELEVATION][l].data,f=p&&p.samplerData;t&&t[n]===f||(a=!0),s[n++]=f,o=Math.max(o,h.lij[0])}else if(c.data){const h=this.tile.surface.layerViewByIndex(l,Wt.ELEVATION);if(GO(this.tile,h.layer,!1)){const p=c.data;t&&t[n]===p.samplerData||(a=!0),s[n++]=p.samplerData,o=this.tile.level}}}return _(t)&&t.length!==n&&(a=!0),n>0?s.length=n:s=null,{changed:a,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const t=fu(this.intersectionData,0,i=>i.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return _(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){}}Gg.updatedGeometryTiles=new Map,Gg.deferTileNeighborUpdate=!1,Gg.neighborTilesToUpdate=new Set;const Jdt=65536;function Kdt(e,t){const i=e.tile,{extent:r,extentInRadians:s,surface:n}=i,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shadingEnabled,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(t===Ih.HAS_SOUTH_POLE||t===Ih.HAS_BOTH_POLES),y=l&&(t===Ih.HAS_NORTH_POLE||t===Ih.HAS_BOTH_POLES),v=6,w=((m?1:0)+(y?1:0))*v*(p+1),b=a.neighborData,S=b.edgeResolutions.reduce((ee,G)=>ee+G+1,0),T=HSe(f+w+S),E=e.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=T,Ji(E.uvOffsetAndScale,0,0,1,1);const C=T.position.typedBuffer,A=T.uv0.typedBuffer,I=T.normal.typedBuffer,L=E.boundingBox;mr(L);const D=o[0],U=o[1],z=o[2];x1.update(p,s);let V=0;const X=a.samplerData,Z=i.ellipsoid.radius,ae=_J(e),re=h-2,$=r[0],k=r[2],B=r[1],H=r[3];(()=>{for(let ee=1;ee<=re;ee++){const G=ee/p,te=B*(1-G)+H*G,fe=ae(G),xe=Math.cos(fe),Le=Math.sin(fe);for(let _e=1;_e<=re;_e++){const ye=_e/p,Ce=$*(1-ye)+k*ye,Pe=x1.sinLonLUT[_e],xi=x1.cosLonLUT[_e],Ti=Z+Tr(Ce,te,X),Xt=xi*xe*Ti-D,Pi=Pe*xe*Ti-U,Yt=Le*Ti-z;iy(Xt,Pi,Yt,L);const Si=wh*V;C[Si+0]=Xt,C[Si+1]=Pi,C[Si+2]=Yt,A[Si+0]=ye,A[Si+1]=G,++V}}})(),c&&(()=>{const ee=_e=>(pe(ry,_e,ZB),ct(PE,ry,t_),ct(IE,PE,ry),IE),G=T.position,te=T.normal;V=0;const fe=_e=>{G.getVec(_e,yc),de(fs,fs,ee(yc))},xe=(_e,ye)=>{{const Ce=_e/p,Pe=$*(1-Ce)+k*Ce,xi=x1.sinLonLUT[_e],Ti=x1.cosLonLUT[_e],Xt=ye/p,Pi=B*(1-Xt)+H*Xt,Yt=ae(Xt),Si=Math.cos(Yt),Ir=Math.sin(Yt),Hr=Z+Tr(Pe,Pi,X);ne(yc,Ti*Si*Hr-D,xi*Si*Hr-U,Ir*Hr-z)}de(fs,fs,ee(yc))},Le=(_e,ye,Ce)=>{_e>1&&ye>1&&_e<re&&ye<re?fe(V+Ce):xe(_e,ye)};for(let _e=1;_e<=re;_e++)for(let ye=1;ye<=re;ye++)G.getVec(V,ZB),de(Bf,ZB,e.localOrigin),we(t_,Bf),ne(fs,0,0,0),Le(ye-1,_e,-1),Le(ye+1,_e,1),Le(ye,_e-1,-re),Le(ye,_e+1,+re),we(fs,fs),te.setVec(V,fs),++V})(),V=f,i2e(e,f),l2e(e),V=f+S;const Y=[];(()=>{const ee=(G,te)=>{const fe=te*h;iy(-D,-U,G*Z-z,L),Y.push({connectedRowOffset:fe,connectedOuterEdgeOffset:G===1?0:2,rowOffset:V,latitudeResolution:v});const xe=u2e(G===-1?B:H,Z),Le=G*Math.PI/2-xe,_e=.99*(G===1?1:-1),ye=Z+0;for(let Ce=1;Ce<=v;++Ce){const Pe=xe+Le*(Ce/v),xi=Math.cos(Pe),Ti=Math.sin(Pe);for(let Xt=0;Xt<=p;Xt++){const Pi=Xt/p,Yt=x1.sinLonLUT[Xt],Si=x1.cosLonLUT[Xt]*xi*ye-D,Ir=Yt*xi*ye-U,Hr=Ti*ye-z;iy(Si,Ir,Hr,L);const Ye=wh*V;if(C[Ye+0]=Si,C[Ye+1]=Ir,C[Ye+2]=Hr,A[Ye+0]=Pi,A[Ye+1]=_e,c){const Wi=1/Math.sqrt(Si*Si+Ir*Ir+Hr*Hr);I[Ye+0]=Wi*Si,I[Ye+1]=Wi*Ir,I[Ye+2]=Wi*Hr}++V}}};m&&ee(-1,0),y&&ee(1,p)})(),t2e(E,a.numVerticesPerSide,Y,[0,h-1],[0,h-1],a.wireframe),e.intersectionData=null;for(let ee=0;ee<4;++ee)E.outerEdges[ee].count,b.edgeResolutions[ee]+1}function ept(e,t){const i=e.tile,r=i.extent,s=e.localOrigin,n=e.geometryState,o=i.surface,a=o.isWebMercatorOnPlateeCarree,l=o.shadingEnabled,c=r[0],h=r[1],p=r[2]-c,f=r[3]-h,m=n.clippingArea,y=_(m)?Math.max(0,(m[0]-r[0])/p):0,v=_(m)?Math.max(0,(m[1]-r[1])/f):0,w=_(m)?Math.min(1,(m[2]-r[0])/p):1,b=_(m)?Math.min(1,(m[3]-r[1])/f):1,S=w-y,T=b-v,E=S>0?1/S:1,C=T>0?1/T:1,A=-y*E,I=-v*C,L=n.numVerticesPerSide,D=L-1,U=(L-2)**2+n.neighborData.edgeResolutions.reduce((xe,Le)=>xe+Le+1,0),z=HSe(U),V=z.position.typedBuffer,X=z.uv0.typedBuffer,Z=z.normal.typedBuffer,ae=e.geometryInfo,re=ae.boundingBox;mr(re);let $=0;const k=i.ellipsoid.radius,B=n.samplerData,H=_(m)?m:f2e,Y=WW(Math.max(r[0],H[0]),Math.max(r[1],H[1]),Math.min(r[2],H[2]),Math.min(r[3],H[3])),ee=s[0],G=s[1],te=s[2],fe=C3(a,k,t);(()=>{for(let xe=1;xe<=D-1;xe++){const Le=xe/D,_e=I+Le*C,ye=De(h+Le*f,Y[1],Y[3]),Ce=De(_e,0,1),Pe=fe(ye)-G,xi=p/D;for(let Ti=1;Ti<=D-1;Ti++){const Xt=Ti/D,Pi=A+Xt*E,Yt=De(c+Xt*p,Y[0],Y[2]),Si=De(Pi,0,1),Ir=Tr(Yt,ye,B),Hr=Yt*t-ee,Ye=Ir-te;iy(Hr,Pe,Ye,re);const Wi=wh*$;if(V[Wi+0]=Hr,V[Wi+1]=Pe,V[Wi+2]=Ye,X[Wi+0]=Si,X[Wi+1]=Ce,l){const Zs=Tr(Yt+xi,ye,B),wo=Tr(Yt-xi,ye,B),An=Tr(Yt,ye+xi,B),Dl=.25*(wo-Zs),Ll=.25*(Tr(Yt,ye-xi,B)-An),Hn=xi,Rp=Math.sqrt(Dl*Dl+Ll*Ll+Hn*Hn);Z[Wi+0]=Dl/Rp,Z[Wi+1]=Ll/Rp,Z[Wi+2]=Hn/Rp}++$}}})(),ae.numVerticesPerSide=n.numVerticesPerSide,ae.vertexAttributes=z,Ji(e.geometryInfo.uvOffsetAndScale,y,v,w-y,b-v),i2e(e,$),r2e(e,t),$=U,t2e(ae,n.numVerticesPerSide,[],[0,L-1],[0,L-1],n.wireframe),e.intersectionData=null}function t2e(e,t,i,r,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,r[1])-Math.max(1,r[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=_v.map((b,S)=>S===0&&s[1]<t-2||S===1&&r[1]<t-2||S===2&&s[0]>1||S===3&&r[0]>1),h=3*(l+e.outerEdges.reduce((b,S,T)=>b+(c[T]?0:o-2+S.count-1),0)+i.reduce((b,S)=>b+o*(2*(S.latitudeResolution-1)+1),0))*(n?2:1),p=new(a>Jdt?Uint32Array:Uint16Array)(h);let f=0;const m=n?(b,S,T)=>{p[f++]=b,p[f++]=S,p[f++]=S,p[f++]=T,p[f++]=T,p[f++]=b}:(b,S,T)=>{p[f++]=b,p[f++]=S,p[f++]=T},y=t-2,v=o-2;(()=>{for(let b=Math.max(s[0],1)-1;b<Math.min(s[1],t-2)-1;++b)for(let S=Math.max(r[0],1)-1;S<Math.min(r[1],t-2)-1;++S){const T=b*y+S,E=T+1,C=E+y,A=C-1;m(T,E,C),m(C,A,T)}})(),(()=>{for(let b=0;b<4;++b){if(c[b])continue;const S=e.outerEdges[b],T=e.innerEdges[b];let E=0,C=0;const A=S.count,I=T.count;S.count;const L=b===1||b===2?(D,U,z)=>m(D,U,z):(D,U,z)=>m(D,z,U);for(;E<A-1||C<I-1;){const D=T.getVertexOffset(C),U=S.getVertexOffset(E),z=E<A-1,V=C<I-1,X=z?0+o*(E+.5)/(A-1):0,Z=V?1+v*(C+.5)/(I-1):0;z&&(!V||X<=Z)?(++E,L(D,U,S.getVertexOffset(E))):(++C,L(D,U,T.getVertexOffset(C)))}}})();const w=b=>{let S=e.outerEdges[b.connectedOuterEdgeOffset].offset0;for(let T=0;T<b.latitudeResolution;++T){const E=T===0?b.rowOffset:S+t;for(let C=0;C<o;C++)m(S,S+1,E+C),T<b.latitudeResolution-1&&m(S+1,E+C+1,E+C),++S;S=E}};i.forEach(w),e.indices=p,e.indexCount=h}function i2e(e,t){const i=e.localOrigin,r=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes.position.typedBuffer;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new ble(o,i,h,p,n)}{const c=a,h=s[l]+1;r.outerEdges[l]=new ble(o,i,c,1,h),a+=h}}}function tpt(e){var r,s;n2e(e),h2e(e);const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function ipt(e){l2e(e),vJ(e)}function rpt(e,t){o2e(e,t),d2e(e,t),vJ(e)}function spt(e,t){r2e(e,t),vJ(e)}function r2e(e,t){o2e(e,t),hpt(e,t),d2e(e,t)}function s2e(e,t,i,r,s){const n=Math.cos(i),o=Math.sin(i),a=Math.sin(t),l=Math.cos(t),c=s+r;e[0]=l*n*c,e[1]=a*n*c,e[2]=o*c}function npt(e,t,i,r,s,n){const o=s[i===0?1:3];s2e(e,s[t===0?0:2],o,r,n)}function opt(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function apt(e,t){return e*t}function C3(e,t,i){return e?r=>opt(r,t):r=>apt(r,i)}function lpt(e,t,i,r,s,n,o){const a=t===0?s[0]:s[2],l=i===0?s[1]:s[3],c=r;e[0]=a*n,e[1]=o(l),e[2]=c}function cpt(e,t){const i=e.geometryState,r=e.tile,s=r.extent,n=ft(i.clippingArea,s),o=e.geometryInfo,a=o.boundingBox,l=o.outerEdges,c=i.neighborData.cornerNeighborData,h=o.uvOffsetAndScale[0],p=o.uvOffsetAndScale[1],f=o.uvOffsetAndScale[2],m=o.uvOffsetAndScale[3],y=f>0?1/f:1,v=m>0?1/m:1,w=-h*y,b=-p*v,S=r.surface.isWebMercatorOnPlateeCarree,T=C3(S,S?r.ellipsoid.radius:0,t),E=i.samplerData,C=i.neighborData.edgeNeighbours,A=e.localOrigin,I=(L,D,U,z,V)=>{const X=s[0]*(1-z)+s[2]*z,Z=s[1]*(1-V)+s[3]*V,ae=De(X,n[0],n[2]),re=De(Z,n[1],n[3]),$=[re===s[3],ae===s[2],re===s[1],ae===s[0]],k=!$[3]&&!$[1]||!$[0]&&!$[2],B=k?$[0]&&_(C[0])?C[0]:$[1]&&_(C[1])?C[1]:$[2]&&_(C[2])?C[2]:$[3]&&_(C[3])?C[3]:null:null,H=k?B?B.neighborTile.level===r.level?.5*(Tr(ae,re,E)+Tr(ae,re,B.neighborSamplerData)):Tr(ae,re,B.neighborSamplerData):Tr(ae,re,E):c[U].elevation,Y=ae*t-A[0],ee=T(re)-A[1],G=H-A[2];iy(Y,ee,G,a);const te=De(w+z*y,0,1),fe=De(b+V*v,0,1);L.setVertexRawXYZUV(D,Y,ee,G,te,fe)};for(let L=0;L<4;++L){const D=l[L];I(D,0,L===0?3:L===1?1:2,L===1?1:0,L===0?1:0);const U=L===2?1:L===3?3:0,z=L===3?0:1,V=L===2?0:1;I(D,D.count-1,U,z,V)}}function n2e(e){a2e(e,(t,i,r,s)=>npt(t,i,r,s,e.tile.extentInRadians,e.tile.ellipsoid.radius))}function o2e(e,t){const i=e.tile;_(i.renderData.geometryState.clippingArea)?cpt(e,t):a2e(e,(r,s,n,o)=>lpt(r,s,n,o,e.tile.extent,t,C3(i.surface.isWebMercatorOnPlateeCarree,i.ellipsoid.radius,t)))}function a2e(e,t){const i=e.geometryInfo,r=i.outerEdges,s=e.geometryState.neighborData.cornerNeighborData,n=i.boundingBox,o=e.localOrigin,a=(l,c,h,p,f)=>{t(u0,h,p,s[c].elevation);for(let m=0;m<3;++m)u0[m]-=o[m];iy(u0[0],u0[1],u0[2],n),l.setVertexRawXYZUV(f,u0[0],u0[1],u0[2],h,p)};for(let l=0;l<4;++l){const c=r[l];a(c,l===0?3:l===1?1:2,l===1?1:0,l===0?1:0,0),a(c,l===2?1:l===3?3:0,l===3?0:1,l===2?0:1,c.count-1)}}function vJ(e){var r,s;const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function l2e(e){n2e(e);for(let t=0;t<4;++t)upt(e,t);h2e(e)}function upt(e,t){var N3,F3,k3;const i=e.geometryState,r=i.neighborData,s=e.tile;s.level;const n=s.extent,o=n[2]-n[0],a=n[3]-n[1],l=s.extentInRadians,c=l[0];l[1];const h=l[2];l[3];const p=s.ellipsoid.radius,f=_J(e),m=Ii=>{if(!Ii)return 0;const jo=v,xo=w?0:1,Nl=Ii.lij[xo+1]*D,k_=s.lij[xo+1]-Nl;return(w?D-1-k_:k_)*jo},y=r.edgeNeighbours[t],v=r.edgeResolutions[t],w=t===1||t===3,b=t===1?1:0,S=t===0?1:0,T=n[0]+b*o,E=n[1]+S*a,C=c*(1-b)+h*b,A=f(S),I=y==null?void 0:y.neighborTile,L=s.level-((N3=I==null?void 0:I.level)!=null?N3:s.level),D=2**L,U=v*D,z=m(I),V=I==null?void 0:I.extent,X=(t+2)%4,Z=i.samplerData,ae=(k3=(F3=I==null?void 0:I.renderData)==null?void 0:F3.geometryState)==null?void 0:k3.samplerData,re=I&&L===0,$=(Ii,jo,xo,Nl)=>.5*(Tr(Ii,jo,ae)+Tr(xo,Nl,Z)),k=(Ii,jo)=>Tr(Ii,jo,ae),B=re?$:k;let H=V?X===1?V[2]:V[0]:T,Y=V?X===0?V[3]:V[1]:E;const ee=(Ii,jo,xo)=>{const Nl=(z+Ii)/U;return Y=V[1]*(1-Nl)+V[3]*Nl,B(H,Y,jo,xo)},G=(Ii,jo,xo)=>{const Nl=(z+Ii)/U;return H=V[0]*(1-Nl)+V[2]*Nl,B(H,Y,jo,xo)},te=I?w?ee:G:(Ii,jo,xo)=>Tr(jo,xo,Z),fe=(Ii,jo,xo)=>te(Ii,jo,xo);let xe=b,Le=T,_e=C,ye=S,Ce=E,Pe=A,xi=Math.sin(_e),Ti=Math.cos(_e),Xt=Math.cos(Pe),Pi=Math.sin(Pe);const Yt=w?()=>f(ye):()=>A,Si=w?Ii=>{ye=Ii,Ce=n[1]*(1-Ii)+n[3]*Ii,Pe=Yt(),Xt=Math.cos(Pe),Pi=Math.sin(Pe)}:Ii=>{xe=Ii,Le=n[0]*(1-Ii)+n[2]*Ii,_e=c*(1-xe)+h*xe,xi=Math.sin(_e),Ti=Math.cos(_e)},Ir=e.geometryInfo,Hr=Ir.boundingBox,Ye=Ir.vertexAttributes,Wi=Ye.position.typedBuffer,Zs=Ye.uv0.typedBuffer,wo=Ye.normal.typedBuffer,An=Ir.outerEdges[t];let Dl=An.getVertexOffset(1);const Ll=v+1,Hn=e.localOrigin,Rp=Hn[0],bz=Hn[1],wz=Hn[2],I3=s.surface.shadingEnabled,$3=t===1?-1:t===3?1:0,D3=t===0?-1:t===2?1:0,L3=o/v,xz=$3*L3,Tz=D3*L3,Sz=$3*(1/v),Ez=D3*(1/v),gC=Ii=>{Tc(ry,Ii,Bf),ct(PE,ry,t_),ct(IE,PE,ry),de(fs,fs,IE)};for(let Ii=1;Ii<Ll-1;++Ii){Si(Ii/v);const jo=fe(Ii,Le,Ce),xo=p+jo,Nl=Ti*Xt*xo,k_=xi*Xt*xo,U3=Pi*xo,z3=Nl-Rp,V3=k_-bz,B3=U3-wz;iy(z3,V3,B3,Hr);const Pp=wh*Dl;if(Wi[Pp+0]=z3,Wi[Pp+1]=V3,Wi[Pp+2]=B3,Zs[Pp+0]=xe,Zs[Pp+1]=ye,I3){ne(fs,0,0,0),ne(Bf,Nl,k_,U3),we(t_,Bf);const ue=($r,bx)=>{const ju=Tr(Le+$r*xz,Ce+$r*Tz,bx),U_=p+ju,ht=xe+$r*Sz,z_=c*(1-ht)+h*ht,Mn=Math.sin(z_),V_=Math.cos(z_),G3=f(ye+$r*Ez),cd=Math.sin(G3),yC=Math.cos(G3),j3=Fe(V_*yC*U_,Mn*yC*U_,cd*U_);gC(j3)};I&&ue(-1,ae),I&&!re||ue(1,Z),wo[Pp+0]=fs[0],wo[Pp+1]=fs[1],wo[Pp+2]=fs[2]}++Dl}if(I3)for(let Ii=1;Ii<Ll-1;++Ii)An.getVertexRawNormal(fs,Ii),An.getVertex(Bf,Ii),we(t_,Bf),An.getVertex(yc,Ii-1),gC(yc),An.getVertex(yc,Ii+1),gC(yc),we(fs,fs),An.setVertexRawNormal(Ii,fs[0],fs[1],fs[2])}function hpt(e,t){const i=e.geometryState.clippingArea,r=e.tile.extent,s=_(i)&&(r[0]<i[0]||r[2]>i[2]||r[1]<i[1]||r[3]>i[3])?ppt:dpt;for(let n=0;n<4;++n)s(e,n,t)}function c2e(e,t,i,r,s,n,o){return o===s?!e||t?(a,l)=>Tr(a,l,i):null:o===n&&e?(a,l)=>Tr(a,l,r):null}function h5(e,t,i,r){if(t!==e)return()=>0;const s=t?3:2,n=t?1:0,o=r(s,n),a=r(n,s),l=(o!=null?1:0)+(a!=null?1:0),c=t?i:0,h=t?0:i;return(p,f,m)=>((o!=null?-(o(p+c,f+h)-m):0)+(a!=null?+(a(p-c,f-h)-m):0))/l}function dpt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,y=p+1,v=c,w=e.localOrigin,b=m.samplerData,S=(G,te)=>Tr(G,te,b),T=(G,te)=>.5*(Tr(G,te,v.neighborSamplerData)+Tr(G,te,b)),E=(G,te)=>Tr(G,te,v.neighborSamplerData),C=(v==null?void 0:v.neighborTile.level)===o,A=C?T:E,I=_(v)?A:S,L=e.geometryInfo,D=L.outerEdges[t],U=C3(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),z=L.boundingBox,V=t===1||t===3,X=t===1?f[2]:f[0],Z=t===0?f[3]:f[1],ae=t===1?1:0,re=t===0?1:0,$=(f[2]-f[0])/h,k=v==null?void 0:v.neighborSamplerData,B=_(v),H=(G,te)=>c2e(B,C,b,k,G,te,t),Y=h5(V,!0,$,H),ee=h5(V,!1,$,H);for(let G=1;G<y-1;++G){const te=G/p,fe=V?X:f[0]*(1-te)+f[2]*te,xe=V?f[1]*(1-te)+f[3]*te:Z,Le=V?ae:te,_e=V?te:re,ye=I(fe,xe),Ce=fe*i-w[0],Pe=U(xe)-w[1],xi=ye-w[2];if(iy(Ce,Pe,xi,z),l){const Ti=Y(fe,xe,ye),Xt=ee(fe,xe,ye),Pi=$;D.setVertexRawXYZUVN(G,Ce,Pe,xi,Le,_e,Ti,Xt,Pi)}else D.setVertexRawXYZUV(G,Ce,Pe,xi,Le,_e)}if(l){const G=V?0:1,te=V?1:0;for(let fe=1;fe<y-1;++fe){D.getNormal(f2,fe);const xe=D.getVertexZ(fe-1)-D.getVertexZ(fe+1),Le=f2[0]+.5*G*xe,_e=f2[1]+.5*te*xe,ye=2*$,Ce=1/Math.sqrt(Le*Le+_e*_e+ye*ye);D.setVertexRawNormal(fe,Ce*Le,Ce*_e,Ce*ye)}}}function ppt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,y=ft(m.clippingArea,f2e),v=e.geometryInfo,w=v.uvOffsetAndScale[0],b=v.uvOffsetAndScale[1],S=w+v.uvOffsetAndScale[2],T=b+v.uvOffsetAndScale[3],E=S>w?1/(S-w):1,C=T>b?1/(T-b):1,A=-w*E,I=-b*C,L=p+1,D=[f[3]>y[3],f[2]>y[2],f[1]<y[1],f[0]<y[0]],U=c,z=m.samplerData,V=(Xt,Pi)=>Tr(Xt,Pi,z),X=(U==null?void 0:U.neighborTile.level)===o,Z=(Xt,Pi)=>{const Yt=Tr(Xt,Pi,U.neighborSamplerData);return X?.5*(Yt+Tr(Xt,Pi,z)):Yt},ae=V,re=_(U)?Z:V,$=D[t]?ae:re,k=v.outerEdges[t],B=v.boundingBox,H=t===1||t===3,Y=De(t===1?f[2]:f[0],y[0],y[2]),ee=De(t===0?f[3]:f[1],y[1],y[3]),G=t===1?1:0,te=t===0?1:0,fe=e.localOrigin,xe=C3(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),Le=(f[2]-f[0])/h,_e=U==null?void 0:U.neighborSamplerData,ye=_(U),Ce=(U==null?void 0:U.neighborTile.level)===o,Pe=(Xt,Pi)=>c2e(ye,Ce,z,_e,Xt,Pi,t),xi=h5(H,!0,Le,Pe),Ti=h5(H,!1,Le,Pe);for(let Xt=1;Xt<L-1;++Xt){const Pi=Xt/p,Yt=H?Y:De(f[0]*(1-Pi)+f[2]*Pi,y[0],y[2]),Si=H?De(f[1]*(1-Pi)+f[3]*Pi,y[1],y[3]):ee,Ir=H?G:De(A+Pi*E,0,1),Hr=H?De(I+Pi*C,0,1):te,Ye=$(Yt,Si),Wi=Yt*i-fe[0],Zs=xe(Si)-fe[1],wo=Ye-fe[2];if(iy(Wi,Zs,wo,B),l){const An=xi(Yt,Si,Ye),Dl=Ti(Yt,Si,Ye),Ll=Le;k.setVertexRawXYZUVN(Xt,Wi,Zs,wo,Ir,Hr,An,Dl,Ll)}else k.setVertexRawXYZUV(Xt,Wi,Zs,wo,Ir,Hr)}if(l){const Xt=H?0:1,Pi=H?1:0;for(let Yt=1;Yt<L-1;++Yt){k.getNormal(f2,Yt);const Si=k.getVertexZ(Yt-1)-k.getVertexZ(Yt+1),Ir=f2[0]+.5*Xt*Si,Hr=f2[1]+.5*Pi*Si,Ye=2*Le,Wi=1/Math.sqrt(Ir*Ir+Hr*Hr+Ye*Ye);k.setVertexRawNormal(Yt,Wi*Ir,Wi*Hr,Wi*Ye)}}}function u2e(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function fpt(e,t,i,r){return u2e(e+r*(t-e),i)}function mpt(e,t,i){return e*(1-i)+t*i}function _J(e){const t=e.tile;if(t.surface.isWebMercator){const r=t.extent,s=t.ellipsoid.radius;return n=>fpt(r[1],r[3],s,n)}const i=t.extentInRadians;return r=>mpt(i[1],i[3],r)}function h2e(e){e.tile.surface.shadingEnabled&&p2e(e,(t,i,r,s,n,o,a)=>gpt(i,t,r,s,n,o,a))}function d2e(e,t){e.tile.surface.shadingEnabled&&p2e(e,(i,r,s,n,o,a,l)=>ypt(_pt(e,t),i,s,o,a,l))}function gpt(e,t,i,r,s,n,o){vpt(e,yc,s,n,o),Tc(ry,yc,i),ct(PE,ry,r),ct(t,PE,ry)}function ypt(e,t,i,r,s,n){e(yc,r,s,n);const o=yc[0]-i[0],a=yc[1]-i[1],l=yc[2]-i[2];t[0]=-o*l,t[1]=-a*l,t[2]=o*o+a*a}function vpt(e,t,i,r,s){const n=_J(e),o=e.tile,a=o.extent;ZA(a,i,r,1);const l=(i-a[0])/(a[2]-a[0]),c=(r-a[1])/(a[3]-a[1]),h=o.extentInRadians;s2e(t,h[0]*(1-l)+h[2]*l,n(c),s,o.ellipsoid.radius)}function _pt(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(i,r,s,n)=>wpt(t,e.tile.ellipsoid.radius,i,r,s,n):(i,r,s,n)=>bpt(t,i,r,s,n)}function bpt(e,t,i,r,s){t[0]=i*e,t[1]=r*e,t[2]=s}function wpt(e,t,i,r,s,n){i[0]=r*e,i[1]=(Math.PI/2-2*Math.atan(Math.exp(-s/t)))*t,i[2]=n}function p2e(e,t){var o;if(!e.tile.surface.shadingEnabled)return;const i=e.geometryState.neighborData.cornerNeighborData,r=e.tile,s=r.extent,n=((o=e.tile.surface.view)==null?void 0:o.viewingMode)==="local";n&&ne(t_,0,0,1);{const a=(v,w,b,S)=>{t(IE,v.renderData,Bf,t_,w,b,S),de(fs,fs,IE)},c=(v,w,b,S,T,E)=>{const C=E===1?T.extent[0]:E===3?T.extent[2]:v,A=E===0?T.extent[1]:E===2?T.extent[3]:w,I=C+lT[b][0]*S,L=A+lT[b][1]*S;ZA(T.extent,I,L,1);const D=Tr(I,L,T.renderData.geometryState.samplerData);a(T,I,L,D)},h=(v,w,b)=>v.extent[w===0||w===1?2:0]+b,p=(v,w,b)=>v.extent[w===0||w===3?3:1]+b,f=(v,w,b,S)=>{const T=h(b,S,lT[v][0]*w),E=p(b,S,lT[v][1]*w);ZA(b.extent,T,E,1);const C=Tr(T,E,b.renderData.geometryState.samplerData);a(b,T,E,C)},m=(v,w,b,S,T,E)=>{const C=lT[v][0]*w,A=lT[v][1]*w,I=h(b,S,C),L=p(b,S,A),D=h(T,E,C),U=p(T,E,A);ZA(b.extent,I,L,1),ZA(T.extent,D,U,1);const z=Tr(I,L,b.renderData.geometryState.samplerData),V=Tr(D,U,T.renderData.geometryState.samplerData);a(b,I,L,.5*(z+V))},y=v=>{const w=v===0||v===1?s[2]:s[0],b=v===0||v===3?s[3]:s[1],S=i[v].cornerTiles,T=S.reduce((E,C)=>{var A;return Math.min(E,(A=C==null?void 0:C.level)!=null?A:1/0)},1/0);for(let E=0;E<4;++E){const C=S[E];h0[E]=(C==null?void 0:C.level)===T?C:null}for(let E=0;E<4;++E){const C=h0[(E+3)%4],A=h0[E];if(C!=null&&C!==r&&C===A){const I=C,L=(E+2)%4,D=I.renderData.geometryState.neighborData.edgeResolutions[L],U=Math.max(D,2**(r.level-I.level)),z=(I.extent[2]-I.extent[0])/U,V=(E+0)%4,X=(E+1)%4;return c(w,b,(E+3)%4,z,I,E),c(w,b,V,z,I,E),c(w,b,X,z,I,E),fs}}{h0.some(C=>(C==null?void 0:C.isLoaded)||C===r);const E=h0.reduce((C,A)=>A?A.extent[2]-A.extent[0]:C,0)/h0.reduce((C,A)=>{var I;return Math.max(C,(I=A==null?void 0:A.renderData.geometryState.numVerticesPerSide)!=null?I:1)},1);for(let C=0;C<4;++C){const A=h0[(C+3)%4],I=h0[(C+0)%4];if(!A&&!I)continue;const L=C===0?1:C===1?2:C===2?3:0,D=C===0?2:C===1?3:C===2?0:1;A&&I?m(C,E,A,L,I,D):f(C,E,A!=null?A:I,A?L:D)}}return fs};for(let v=0;v<4;++v){const w=e.geometryInfo.outerEdges[v],b=v===1||v===2?0:w.count-1;w.getVertex(Bf,b),n||we(t_,Bf),ne(fs,0,0,0);const S=y(v);we(QB[v],S)}}{const a=(c,h,p,f,m)=>{c.setVertexRawNormal(m,h,p,f)},l=e.geometryInfo.outerEdges;for(let c=0;c<4;++c){const h=l[c];{const p=QB[c===0?3:c===1?1:2];a(h,p[0],p[1],p[2],0)}{const p=QB[c===2?1:c===3?3:0];a(h,p[0],p[1],p[2],h.count-1)}}}}function iy(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}const lT=[[0,1],[1,0],[0,-1],[-1,0]],x1=new fdt,f2e=WW(-1/0,-1/0,1/0,1/0),u0=R(),yc=R(),ry=R(),PE=R(),IE=R(),Bf=R(),ZB=R(),t_=R(),fs=R(),f2=R(),QB=[R(),R(),R(),R()],h0=[null,null,null,null];class xpt extends mJ{constructor(t,i,r){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=Nt(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=_(s)&&iR(s)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this.extentInRenderSR,c=this.extent;if(a){const h=Fe(c[0],c[1],0);un(h,Ze.WebMercator,h,Ze.PlateCarree);const p=Fe(c[2],c[3],0);un(p,Ze.WebMercator,p,Ze.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Pa.MIDDLE][3]=o}_isVisible(t){return UZe(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return EPe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,i,r,s){return bD[0]=1/i[0],bD[1]=1/i[1],bD[2]=1/i[2],_Q(this._aabb(),t,bD,r,s)}createGeometry(){ept(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){rpt(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){spt(this.renderData,this.horizontalScaleFactor)}}const bD=R();var yP;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(yP||(yP={}));class Tpt extends mJ{constructor(t,i,r){super(),this.obb=new Array(8);for(let s=0;s<8;s++)this.obb[s]=R();t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=qt(o,l,.5),p=qt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),AC(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=pl(this.centerAtSeaLevel);we(m,m),this.up=m,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)ne(this._center[Vd.MIDDLE],0,0,0),ne(this._center[Vd.TOP],0,0,0),ne(this._center[Vd.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=bi(this.surface.spatialReference)),this._center[Vd.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(Gs(this._center[Vd.MIDDLE],this.obb[0]),Gs(this._center[Vd.MIDDLE],this.obb[1]));this._center[Vd.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!Fv(t,this._center[Vd.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const i=this.obb;for(let r=0;r<yy.NUM;r++){const s=r===lr.NEAR,n=t[r];s&&(bA[0]=n[0],bA[1]=n[1],bA[2]=n[2],bA[3]=n[3]-this.surface.view.state.camera.near);const o=s?bA:n;let a;for(a=0;a<8;a++){const l=i[a];if(o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]<0)break}if(a===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);Kdt(this.renderData,t),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,i=this.obb;for(let r=0;r<2;r++){const s=this.elevationBounds[r];let n=4*r;AC(i[n++],t[0],t[1],this.ellipsoid.radius+s),AC(i[n++],t[0],t[3],this.ellipsoid.radius+s),AC(i[n++],t[2],t[3],this.ellipsoid.radius+s),AC(i[n++],t[2],t[1],this.ellipsoid.radius+s)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case Ih.HAS_NORTH_POLE:ne(i[1],0,0,this.ellipsoid.radius),ne(i[2],0,0,this.ellipsoid.radius),ne(i[5],0,0,this.ellipsoid.radius),ne(i[6],0,0,this.ellipsoid.radius);break;case Ih.HAS_SOUTH_POLE:ne(i[0],0,0,-this.ellipsoid.radius),ne(i[3],0,0,-this.ellipsoid.radius),ne(i[4],0,0,-this.ellipsoid.radius),ne(i[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,i){return t===(1<<i)-1?t===0?Ih.HAS_BOTH_POLES:Ih.HAS_SOUTH_POLE:t===0?Ih.HAS_NORTH_POLE:Ih.REGULAR}intersectsRay(t,i,r,s){const n=this._center[Vd.MIDDLE],o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*p-l,m=i[1]*p-c,y=i[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<Ale.length?Ale[this.level]+1:2}updateCornerElevations(){tpt(this.renderData)}updateEdgeElevations(){ipt(this.renderData)}}const Ale=[128,64,32,16,16,8,8,4],bA=vi();var Vd;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Vd||(Vd={}));class Spt{constructor(){this.extent=Ht(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class Ept{constructor(){this._queries=new Gt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Gt({initialSize:30}),this._queryPool=new Es(Spt)}queryVisibleLevelRange(t,i,r,s){const n=this._queryPool.acquire();np(n.extent,t),n.minLevel=i||-Number.MAX_VALUE,n.maxLevel=r!=null?r:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const i=this._queries.data[t];this._queryPool.release(i),i.callback(t>=this._queriesInvPtr),i.callback=null}this._queries.clear()}scaleQueriesForTile(t){const i=t.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}}class bJ extends Ha{constructor(){super(...arguments),this.blendMode=Ne.Normal}}u([j({count:Ne.COUNT})],bJ.prototype,"blendMode",void 0);class Cpt extends JSe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=Ne.Normal,this.backgroundColor=za}}class JU extends fr{initializeProgram(t){const i=JU.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:Am(Me.ONE,Me.ONE_MINUS_SRC_ALPHA),colorWrite:ti})}}JU.shader=new sr(Mdt,()=>import("./BlendLayers.glsl.b3d02291.js"));class FN extends bJ{constructor(){super(...arguments),this.output=po.Composite,this.baseOpacityMode=wn.One,this.premultipliedSource=!1}}u([j({count:po.COUNT})],FN.prototype,"output",void 0),u([j({count:wn.COUNT})],FN.prototype,"baseOpacityMode",void 0),u([j()],FN.prototype,"premultipliedSource",void 0);class JB{constructor(t,i,r,s,n,o){this.texture=t,this.type=i,t.retain(),this.offsetAndScale=mi(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Fe(s,o,n)}destroy(){this.texture.release()}}function kN(){return[1,0,0,1,0,0]}function Apt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Mpt(e,t,i,r,s,n){return[e,t,i,r,s,n]}function Opt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:kN,clone:Apt,fromValues:Mpt,createView:Opt},Symbol.toStringTag,{value:"Module"}));function Rpt(e){return e instanceof Float32Array&&e.length>=2}function Ppt(e){return Array.isArray(e)&&e.length>=2}function KB(e){return Rpt(e)||Ppt(e)}const Ipt=96,$pt=39.37;function wJ(e,t){return t.type?di(e,t.x,t.y):_o(e,t)}function Dpt(e){return Ic(e)}function Lpt(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const Npt=function(){const e=st();return function(t,i,r){const s=i.targetGeometry;wJ(e,s);const n=.5*KU(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();function KU(e){return e.scale*Fpt(e.targetGeometry)}function Fpt(e){return _(e)&&Ml(e.spatialReference)?1/(Dpt(e.spatialReference)*$pt*Ipt):1}function kpt(e){return L5(e.rotation)||0}const xJ=function(){const e=st(),t=st(),i=st();return function(r,s,n,o,a,l){return vZ(e,s),dc(t,n,.5*l),di(i,1/o*l,-1/o*l),lZ(r,t),a&&oZ(r,r,a),T_e(r,r,i),aZ(r,r,e),r}}(),Upt=function(){const e=st();return function(t,i,r,s){const n=KU(i),o=kpt(i);return wJ(e,i.targetGeometry),xJ(t,e,r,n,o,s)}}(),zpt=function(){const e=st();return function(t,i,r,s){const n=KU(i);return wJ(e,i.targetGeometry),xJ(t,e,r,n,0,s)}}();function Vpt(e){const t=jv(e);return t?t.valid[1]-t.valid[0]:0}function Bpt(e,t){return Math.round(Vpt(e)/t)}var lq;const Wm=[0,0];let Y0=lq=class extends ve{constructor(e){super(e),this._viewpoint2D={center:st(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new ui,this.id=0,this.inverseTransform=kN(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=kN(),this.transformNoRotation=kN(),this.displayMat3=ey(),this.displayViewMat3=ey(),this.viewMat3=ey(),this.viewMat2d=__e(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=Lpt(i,e.viewpoint),this._set("size",_o(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new lq({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return KB(t)?rb(e,t,this.inverseTransform):(Wm[0]=t,Wm[1]=i,rb(e,Wm,this.inverseTransform))}toScreen(e,t,i){return KB(t)?rb(e,t,this.transform):(Wm[0]=t,Wm[1]=i,rb(e,Wm,this.transform))}toScreenNoRotation(e,t,i){return KB(t)?rb(e,t,this.transformNoRotation):(Wm[0]=t,Wm[1]=i,rb(e,Wm,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return xJ(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Rl({targetGeometry:new at(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=KU(o),this.rotation=r,this.scale=i,this.spatialReference=t,_o(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;$Z(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=DZ(this.viewMat3),h=Na(n[0]/2,n[1]/2),p=Na(-n[0]/2,-n[1]/2),f=L5(r);w4(c,c,h),LZ(c,c,f),w4(c,c,p),Hk(this.displayViewMat3,this.displayMat3,c);const m=lZ(this.viewMat2d,h);return oZ(m,m,f),aZ(m,m,p),Npt(this.extent,o,n),Upt(this.transform,o,n,s),w_e(this.inverseTransform,this.transform),zpt(this.transformNoRotation,o,n,s),this.worldScreenWidth=Bpt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],Y0.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],Y0.prototype,"pixelRatio",null),u([d({json:{write:!0}})],Y0.prototype,"size",null),u([d()],Y0.prototype,"spatialReference",void 0),u([d({type:Rl,json:{write:!0}})],Y0.prototype,"viewpoint",null),Y0=lq=u([P("esri.views.2d.ViewState")],Y0);const Gpt=Y0,jpt=.125;class Hpt{constructor(){this._renderParams={context:null,drawPhase:1,state:new Gpt({viewpoint:new Rl({targetGeometry:new at(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,i,r,s,n,o,a,l,c,h){const p=o.adjustLevel(i[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(i[0]),[y,v]=o.getShift(i,a*m),w=jpt*a*m/c,b=r.transforms.dvs;b[0]=w,b[4]=-w,b[6]=-1-y-l[0]*a*2,b[7]=1+v+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(t),r.triangleCount=0,s.drawTile(f,r,n)}}class ez extends fr{initializeProgram(t){const i=ez.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:Am(Me.ONE,Me.ONE_MINUS_SRC_ALPHA),colorWrite:ti})}}ez.shader=new sr(Ldt,()=>import("./RasterColorizer.glsl.dad6e78a.js"));class lS extends bJ{constructor(){super(...arguments),this.colorizerType=mw.Stretch,this.stretchType=Kw.Noop,this.tileBlendInput=Bo.LayerOnly,this.baseOpacityMode=wn.One,this.applyColormap=!0}}u([j({count:mw.COUNT})],lS.prototype,"colorizerType",void 0),u([j({count:Kw.COUNT})],lS.prototype,"stretchType",void 0),u([j({count:Bo.COUNT})],lS.prototype,"tileBlendInput",void 0),u([j({count:wn.COUNT})],lS.prototype,"baseOpacityMode",void 0),u([j()],lS.prototype,"applyColormap",void 0);class Mle{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let i=this._pools.get(t);if(!i){const r=Ole.bind(Ole,this._rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.DEPTH_RENDER_BUFFER,width:t,height:t},s=>this._getPool(s.width).release(s));i=new Es(r,null,()=>{}),this._pools.set(t,i)}return i}}class Ole extends Or{constructor(t,i,r){super(t,i),this.release=()=>r(this)}}const qpt=ge.getLogger("esri.views.3d.terrain");class Wpt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new Hpt,this._bindParameters=new Xk(null,null,null),this._blendLayersTechniqueConfig=new FN,this._poolToWrite=0,this._vaoQuad=qa(this._rctx,s3),this._fboPools.push(new Mle(this._rctx)),this._fboPools.push(new Mle(this._rctx))}dispose(){this._fboPools.forEach(t=>{t.clear(),t=null}),this._fboPools=null,this._doubleBufferFbo.forEach(t=>Qe(t)),this._vaoQuad=Qe(this._vaoQuad),this._vectorTileHelper=Qe(this._vectorTileHelper),this._backgroundTechnique=er(this._backgroundTechnique),this._applyOpacityTechnique=er(this._applyOpacityTechnique),this._blendLayersTechnique=er(this._blendLayersTechnique)}_getBlendLayersTechnique(t,i,r,s=!1){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=r?i===po.Composite?wn.OnBaseLayer:wn.OnBackground:wn.One,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(JU,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,i){const r=this._getBlendLayersTechnique(Ne.Normal,i,!1),s=this._rctx.bindTechnique(r,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(It.TRIANGLE_STRIP,0,ko(this._vaoQuad,"geometry"))}drawRasterData(t,i,r=!1){if(M(i.texture))return;const s=i.baseOpacity<1;i.blendMode!==Ne.Normal||s||r?(i.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):i.fboTexture=null;const n=this._getBlendLayersTechnique(i.blendMode,t,s,r),o=this._rctx.bindTechnique(n,i,this._bindParameters);this._render(o)}drawImageryTileData(t,i,r){const s=t.sourceLayerInfo.data;if(!s.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,Wt.MAP).ensureSymbolizerParameters(s);const n=r.baseOpacity<1;r.blendMode!==Ne.Normal||n?(r.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):r.fboTexture=null;const o=this._getRasterColorizerTechnique(s,i,r.blendMode,n),a=this._rctx.bindTechnique(o);if(!s.bind(this._rctx))return;s.opacity=r.opacity;const l=s.getUniforms();l.scale=t.scale,l.offset=t.offset,l.backgroundColor=r.backgroundColor,l.fboTexture=r.fboTexture,l.baseOpacity=r.baseOpacity,o.bindPass(l,null),this._render(a)}_getRasterColorizerTechnique(t,i,r,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return M(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new lS,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=i===po.ColorComposite?Bo.ColorComposite:i===po.GridComposite?Bo.GridComposite:Bo.LayerOnly,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s?i===po.Composite?wn.OnBaseLayer:wn.OnBackground:wn.One,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?Kw.Noop:Kw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(ez,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,i,r,s,n,o,a){const l=this._rctx,c=i.sourceLayerInfo.data,h=i.tile.surface.layerViewByIndex(i.layerIndex,Wt.MAP),p=t.baseOpacity<1||t.opacity<1||t.blendMode!==Ne.Normal||a!==po.Composite;let f;this._getBlendLayersTechnique(t.blendMode,a,t.baseOpacity<1,p).bindPipelineState(l),p?(f=this._acquire(n),l.bindFramebuffer(f),l.setClearColor(0,0,0,0),l.clearSafe(tr.COLOR_BUFFER_BIT|tr.DEPTH_BUFFER_BIT)):o&&l.clearSafe(tr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(l,i.sourceLod,c,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/i.scale),i.offset,s,r)}catch(m){qpt.warnOnce("A render call containing vector tiles did not resolve correctly.",m)}return!_(f)||(l.bindFramebuffer(this._currentFBO),t.texture=f.colorTexture,t.offset=Zh,t.scale=1,this.drawRasterData(a,t,p),f.release(),o)}copyFBOToTexture(t){const i=this._rctx,r=i.bindTexture(t.texture,ot.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;i.gl.copyTexImage2D(mt.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),i.bindTexture(r,ot.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(t,i){this._rctx.bindFramebuffer(t),this._rctx.setViewport(0,0,i,i),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(tr.COLOR_BUFFER_BIT|tr.DEPTH_BUFFER_BIT)}_acquire(t){return this._fboPools[this._poolToWrite].acquire(t)}bindPool(t,i){this._poolToWrite=t,this._doubleBufferFbo[t]==null&&(this._doubleBufferFbo[t]=this._acquire(i),this._initFBO(this._doubleBufferFbo[t],i))}_switchPool(t){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=this._poolToWrite===0?1:0,this.bindPool(this._poolToWrite,t)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(t,i){t===this._lastPixelRatio&&i===this._lastNumLayers||(this._fboPools.forEach(r=>r.clear()),this._lastPixelRatio=t,this._lastNumLayers=i)}}class Xpt{constructor(t,i,r){this._rctx=t,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new Cpt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Wpt(this._rctx,this._techniqueRepository),this._blackTex=new aS(mqe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Qe(this._composition),this._backgroundTexture=er(this._backgroundTexture),this._blackTex=er(this._blackTex)}get backgroundIsGrid(){return M(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,i){if(!t.renderData)return;const r=t.surface,s=r.baseOpacity;this._numTexturedLayer=0;let n=0,o=this.tileSize,a=!1;const l=r.view.state.pixelRatio;let c=!1;const h=t.layerInfo[Wt.MAP];let p=h.length,f=0;for(;f<h.length;f++){const v=r.layerViewByIndex(f,Wt.MAP),w=v.fullOpacity;if(t8[f]=w,fge(v.layer)&&p>=h.length&&(p=f),w===0){h[f].pendingUpdates&=~(_t.TEXTURE_NOFADING&_t.TEXTURE_FADING);continue}++n;const b=e8(t,f);if(b){if(h[f].pendingUpdates&=~(_t.TEXTURE_NOFADING&_t.TEXTURE_FADING),l5(v)){const S=kSe(v.layer.parent)?"normal":v.layer.blendMode;Rle[f]=S;const T=S!=="normal";T&&(c=T,a=!1)}fP(v)?o=Math.max(o,this.tileSize*l):s===1&&w===1&&(v.isOpaque||this._dataToTexture(b)&&b.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(l,h.length),o=Ypt(o);const m=o/this.tileSize,y=f-1;this._ensureBackgroundTexture(this.tileSize),this._numTexturedLayer!==0?this._numTexturedLayer===1&&!c&&this._useLayerTexture(t,y,p,t8[y])||this._composeMapLayers(t,i,y,p,t8,Rle,o,m,!a||c):this._useBackgroundTexture(t,n)}_ensureBackgroundTexture(t){M(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,t),this._passParameters.offset=Zh,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=Ne.Normal,_(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,_(this.backgroundColor)?po.ColorOnly:po.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(t,i){let r=ty.Immediate;(t.surface.view.layerViewManager.updating||i>0)&&(r=ty.Delayed),this._backgroundTexture&&M(t.renderData.textureReference)&&(r=ty.Immediate),t.renderData.setTextureReference(_(this._backgroundTexture)?new JB(this._backgroundTexture,Vn.FADING,Ple,t.surface.baseOpacity,1,0):null,r)}_useLayerTexture(t,i,r,s){const n=i<r,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=e8(t,i);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new JB(l.sourceLayerInfo.data,Vn.FADING,l,o,s,a)),!0)}_composeMapLayers(t,i,r,s,n,o,a,l,c){this._composition.bindPool(0,a);const h=t.surface.baseOpacity;let p=!1,f=tt.LINEAR_MIPMAP_LINEAR,m=!1,y=0;for(let w=r;w>=0;w--){const b=e8(t,w);if(!b||n[w]===0)continue;const S=w<s&&h<1&&!p;this._passParameters.baseOpacity=S?h:1,S&&(p=!0);const T=y===0,E=c&&T?this.backgroundIsGrid?po.GridComposite:po.ColorComposite:po.Composite;ght(b)?(this._passParameters.opacity=n[w],this._passParameters.blendMode=DN[o[w]],m=this._composition.drawVectorData(this._passParameters,b,l,this.tileSize,a,m,E)):mht(b)?(this._passParameters.opacity=n[w],this._passParameters.blendMode=DN[o[w]],this._composition.drawImageryTileData(b,E,this._passParameters),this._hasNearestInterpolation(b)&&(f=tt.NEAREST)):this._dataToTexture(b)&&(this._passParameters.texture=b.sourceLayerInfo.data.texture,this._passParameters.offset=b.offset,this._passParameters.scale=b.scale,this._passParameters.opacity=n[w],this._passParameters.blendMode=DN[o[w]],this._composition.drawRasterData(E,this._passParameters)),y++}const v=t.renderData.ensureTexture(a,()=>this._buildTexture(a,f));this._composition.copyFBOToTexture(v),this._composition.releasePool(),t.renderData.setTextureReference(new JB(v,i,Ple,p?1:h,1,0))}_hasNearestInterpolation(t){const i=t.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(t){return vht(t)&&this._rasterDataToTexture(t),yht(t)}_rasterDataToTexture(t){const i=t.sourceLayerInfo;i.data=this._buildTexture(i.data),t.tile.setMemoryDirty()}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,i=tt.LINEAR_MIPMAP_LINEAR){if(M(t))return null;const r={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")r.width=r.height=t,n=new aS(new ot(s,r));else if(t instanceof WU)r.isOpaque=t.isOpaque,n=new aS(new ot(s,r,t.image)),t.release();else try{n=new aS(new ot(s,r,t))}catch{n=new aS(A1e(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,ot.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,ot.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function Ypt(e){const t=C2(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}function e8(e,t){Bc.layerIndex=t;const i=e.layerInfo[Wt.MAP][t];if(_(i.data))return di(Bc.offset,0,0),Bc.tile=e,Bc.scale=1,Bc.sourceLod=e.lij,Bc.sourceLayerInfo=i,Bc;const r=i.upsampleInfo;if(_(r)){const s=r.tile.layerInfo[Wt.MAP][t];return Bc.tile=r.tile,_o(Bc.offset,r.offset),Bc.scale=r.scale,Bc.sourceLod=r.tile.lij,Bc.sourceLayerInfo=s,Bc}return null}const t8=new Array,Rle=new Array,Bc={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},Ple={offset:[0,0],scale:1},m2e=200,i8=40,Zpt=.8,Qpt=10,HM=1e-6;function Jpt(e,t,i){const r=t,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(r[a]<l){if(s[a]<=HM)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-HM){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(r[a]>l){if(s[a]>=-HM)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=HM){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class Ile{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}}class $E{constructor(t,i,r,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=s,this.rayDirection=R(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=r-i,o=n<=g2e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=rft(t,i,r,s.data,s.stride),l=De(Math.log2(n/i8),2,Qpt),c=(h,p,f)=>{const m=tft(o,a,h,p),y=p-h;if(y<=i8){const E=new Ile(m,void 0,0,h,p);return this.bspNodeTree.push(E),E}const{axis:v,midValue:w}=ift(m),b=eft(o,a,h,p,v,w),S=(E,C)=>{if(f>l)return;const A=C-E;return A<i8||A>=Zpt*y?void 0:c(E,C,f+1)},T=new Ile(m,v,w,b.next,b.mid);return this.bspNodeTree.push(T),T.leftNode=S(h,b.next),T.rightNode=S(b.mid,p),T};c(0,n,0),this.triangleVertexIndices=sft(o,t,i,r)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],l=o[1],c=o[2],h=this.rayDirection,p=h[0],f=h[1],m=h[2];for(let y=t,v=3*t;y<i;++y){const w=r[v]*n,b=s[w],S=s[w+1],T=s[w+2],E=r[v+1]*n,C=s[E],A=s[E+1],I=s[E+2],L=r[v+2]*n,D=s[L],U=s[L+1],z=s[L+2];v+=3;const V=C-b,X=A-S,Z=I-T,ae=D-b,re=U-S,$=z-T,k=f*$-re*m,B=m*ae-$*p,H=p*re-ae*f,Y=V*k+X*B+Z*H;if(Math.abs(Y)<=Number.EPSILON)continue;const ee=a-b,G=l-S,te=c-T,fe=ee*k+G*B+te*H;if(Y>0){if(fe<0||fe>Y)continue}else if(fe>0||fe<Y)continue;const xe=G*Z-X*te,Le=te*V-Z*ee,_e=ee*X-V*G,ye=p*xe+f*Le+m*_e;if(Y>0){if(ye<0||fe+ye>Y)continue}else if(ye>0||fe+ye<Y)continue;const Ce=(ae*xe+re*Le+$*_e)/Y;if(Ce>=0){const Pe=this.indices[y]+this.firstTriangleIndex,xi=yQ(V,X,Z,ae,re,$,Kpt);this.callback(Ce,xi,Pe,!1)}}}$E.numFacesTested+=i-t}intersectRay(t,i){$E.numFacesTested=0;const r=Fe(t.r0[0],t.r0[1],t.r0[2]),s=Fe(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<HM)return;this.rayOrigin=r;const l=this.rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this.callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,i,r){const s=this.rayOrigin,n=this.rayDirection;if(!Jpt(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=i,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=r;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}$E.numFacesTested=0;const Kpt=R(),cT=[1/0,1/0,1/0],uT=[-1/0,-1/0,-1/0];function eft(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=r;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function tft(e,t,i,r){if(r<=i)return Ew(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[i];for(let n=0;n<3;++n)cT[n]=t[s+0+n],uT[n]=t[s+3+n]}for(let s=i+1;s<r;++s){const n=6*e[s];for(let o=0;o<3;++o)cT[o]=Math.min(cT[o],t[n+0+o]),uT[o]=Math.max(uT[o],t[n+3+o])}return Ew(cT[0],cT[1],cT[2],uT[0],uT[1],uT[2])}function ift(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function rft(e,t,i,r,s){const n=i-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],y=r[h+f],v=r[p+f];o[6*a+f]=Math.min(m,y,v),o[6*a+3+f]=Math.max(m,y,v)}}return o}function sft(e,t,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=g2e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+i);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const g2e=65535;class TJ extends sTe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=R(),this.origin=this.slicePlaneLocalOrigin}}var wu,oo;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(wu||(wu={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(oo||(oo={}));class nft extends TJ{constructor(){super(...arguments),this.identifier=wu.Material,this.transparent=!1,this.integratedMesh=!1}}class oft extends TJ{constructor(){super(...arguments),this.identifier=wu.ShadowMap}}class aft extends TJ{constructor(){super(...arguments),this.identifier=wu.Highlight}}class d5 extends Jr{constructor(t,i){super(t,"vec4",Ui.Draw,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}var sy;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(sy||(sy={}));class lft extends Ys{constructor(){super(...arguments),this.overlayOpacity=1}}function $le(e,t){e.vertex.uniforms.add([new Ua("overlayTexOffset"),new Ua("overlayTexScale")]),e.fragment.uniforms.add([new Xe("overlayOpacity",i=>i.overlayOpacity),new Vt("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[Ur.INNER].getColorTexture(i.overlaySource))]),y2e(e,t)}function cft(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add([new d5("overlayTexOffset",(s,n)=>uft(s,n)),new d5("overlayTexScale",(s,n)=>hft(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new Vt("ovColorTex",(s,n)=>cq(s,n))),y2e(e,t)}function y2e(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==Ot.Water&&t.pbrMode!==Ot.WaterOnIntegratedMesh||e.include(cTe,t);const{vertex:i,fragment:r}=e;e.varyings.add("vtcOverlay","vec4"),i.code.add(x`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(x`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(x`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==Ot.Water&&t.pbrMode!==Ot.WaterOnIntegratedMesh||(r.uniforms.add([new xt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new xt("lightingMainIntensity",(s,n)=>n.lighting.mainLight.intensity)]),r.code.add(x`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function cq(e,t){return t.overlays.length===0?null:e.identifier===wu.Material&&e.subPass===oo.Color?t.overlays[Ur.INNER].getColorTextureNoRasterImage():e.identifier===wu.Highlight?t.overlays[Ur.INNER].getValidTexture(xs.Highlight):null}function uft(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Mpe(s)>0&&(m2[2*r]=e.toMapSpace[0]/vu(s)-s[0]/vu(s),m2[2*r+1]=e.toMapSpace[1]/Sp(s)-s[1]/Sp(s))}return m2}function hft(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Mpe(s)>0&&(m2[2*r]=e.toMapSpace[2]/vu(s),m2[2*r+1]=e.toMapSpace[3]/Sp(s))}return m2}const m2=Ht();function dft(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(x`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function pft(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new Ua("texOffsetAndScale")),e.fragment.uniforms.add(new Vr("tex")),e.fragment.uniforms.add(new xl("textureOpacities"));const i=t.textureFadingEnabled&&!t.renderOccluded;i&&(e.vertex.uniforms.add(new Ua("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new Vr("texNext")),e.fragment.uniforms.add(new xl("nextTexOpacities")),e.fragment.uniforms.add(new Fi("fadeFactor")));const r=t.tileBlendInput===Bo.ColorComposite,s=t.tileBlendInput===Bo.GridComposite;s&&e.fragment.include(fJ),r&&e.fragment.uniforms.add(new xl("backgroundColor")),e.vertex.code.add(x`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${i?x`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:x``}
  }`),e.fragment.code.add(x`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${s||r?x`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${r?x`vec4(backgroundColor, 1.0)`:x`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:x`return color;`}
    }`),i?e.fragment.code.add(x`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(x`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class v2e extends lft{}function fft(e){const t=new qi;t.include(ITe,{name:"Terrain Shader",output:e.output}),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.NORMAL,"vec3");const{vertex:i,fragment:r}=t;if(i.uniforms.add([new Er("proj",(s,n)=>n.camera.projectionMatrix),new FH("view",(s,n)=>ja(Dle,n.camera.viewMatrix,s.origin)),new Va("origin",s=>s.origin)]),r.uniforms.add(new Va("origin",s=>s.origin)),e.output===K.Color){t.include(Uo),t.include(zv,e),t.include(pft,e),t.include(Zw,e);const s=e.overlayMode!==sy.Disabled,n=e.overlayMode===sy.EnabledWithWater;s&&t.include($le,me(F({},e),{pbrMode:Ot.Water})),n&&t.include(dft,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&i.uniforms.add(new Er("viewNormal",(a,l)=>l.camera.viewInverseTransposeMatrix));const o=e.receiveShadows&&!e.renderOccluded;o&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(i.uniforms.add(new xt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),i.code.add(x`
      void main(void) {
        vpos = position;
        vnormal = ${e.shading?x`normal`:x`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${e.atmosphere?x`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?x`vuv = uv;`:""}
        ${e.screenSizePerspective?x`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${o?x`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${s?x`setOverlayVTC(uv);`:""}
        ${n?x`forwardVertexTangent(vnormal);`:x``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(ys,e),t.include(Zw,e),t.include(S3,e),t.include(Yw,e),r.uniforms.add([new Va("cameraPosition",(a,l)=>pe(r8,l.camera.eye,a.origin)),new xt("viewDirection",(a,l)=>we(r8,ne(r8,l.camera.viewMatrix[12],l.camera.viewMatrix[13],l.camera.viewMatrix[14]))),new Xe("lightingGlobalFactor",(a,l)=>l.lighting.globalFactor),new xt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection),new xt("lightingMainIntensity",(a,l)=>l.lighting.mainLight.intensity)]),r.constants.add("ambientBoostFactor","float",uC),n&&r.uniforms.add([new Vt("ovWaterTex",(a,l)=>l.overlays.length===0?null:l.overlays[Ur.INNER].getNormalTexture(a.overlaySource)),new FH("view",(a,l)=>ja(Dle,l.camera.viewMatrix,a.origin))]),r.code.add(x`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),r.code.add(x`
      void main() {
        ${o?x`float shadow = readShadowMap(vpos, linearDepth);`:x`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${s?x`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?x`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?x`atm + tileColor.rgb;`:x`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${e.shading?"":x`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${e.shading?"":x`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${n?x`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?x`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?x`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==K.Depth&&e.output!==K.Shadow||(t.include(Uo,{hasModelTransformation:!1,linearDepth:!0}),t.include(L_,{output:e.output}),t.include(zv,e),t.varyings.add("linearDepth","float"),i.uniforms.add(new pi("nearFar",(s,n)=>n.camera.nearFar)),i.code.add(x`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(x`void main() {
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(Uo),t.include(zv,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),i.uniforms.add(new Er("viewNormal",(s,n)=>n.camera.viewInverseTransposeMatrix)),i.code.add(x`
        void main(void) {
          vec3 normal = ${e.shading?x`normal`:x`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),r.code.add(x`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===K.Highlight&&(t.include(Uo),t.include(zv,e),t.include($le,e),i.code.add(x`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),t.include(Iy),r.code.add(x`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const Dle=Ae(),r8=R(),mft=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:v2e,build:fft},Symbol.toStringTag,{value:"Module"}));class tz extends fr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global}initializeProgram(t){const i=tz.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Ut({blending:i.renderOccluded?Am(Me.ONE,Me.ONE_MINUS_SRC_ALPHA):null,culling:r&&_Z,depthTest:!i.renderOccluded&&{func:yr.LESS},depthWrite:!i.renderOccluded&&Il,colorWrite:ti,stencilTest:t?Git(Cl.IntegratedMeshMaskExcluded):null})}getPipelineState(t,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,i)}}tz.shader=new sr(mft,()=>import("./Terrain.glsl.629dbacf.js"));class Ps extends la{constructor(){super(...arguments),this.output=K.Color,this.overlayMode=sy.Disabled,this.tileBlendInput=Bo.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=he("enable-feature:terrain-shading")}}u([j({count:K.COUNT})],Ps.prototype,"output",void 0),u([j({count:sy.COUNT})],Ps.prototype,"overlayMode",void 0),u([j({count:Bo.COUNT})],Ps.prototype,"tileBlendInput",void 0),u([j()],Ps.prototype,"spherical",void 0),u([j()],Ps.prototype,"atmosphere",void 0),u([j()],Ps.prototype,"receiveShadows",void 0),u([j()],Ps.prototype,"hasSlicePlane",void 0),u([j()],Ps.prototype,"backfaceCullingEnabled",void 0),u([j()],Ps.prototype,"stencilEnabled",void 0),u([j()],Ps.prototype,"textureFadingEnabled",void 0),u([j()],Ps.prototype,"renderOccluded",void 0),u([j()],Ps.prototype,"hasScreenSpaceReflections",void 0),u([j()],Ps.prototype,"hasCloudsReflections",void 0),u([j()],Ps.prototype,"tileBorders",void 0),u([j()],Ps.prototype,"screenSizePerspective",void 0),u([j()],Ps.prototype,"receiveAmbientOcclusion",void 0),u([j()],Ps.prototype,"shading",void 0),u([j({constValue:!0})],Ps.prototype,"isGround",void 0),u([j({constValue:Ot.Disabled})],Ps.prototype,"pbrMode",void 0),u([j({constValue:!1})],Ps.prototype,"highStepCount",void 0),u([j({constValue:!1})],Ps.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Ps.prototype,"useFillLights",void 0);const s8=7,gft=10,n8=Hs(),wD=Ht();let Kc=class extends Se{constructor(e){super(e),this.type=Br.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new Ps,this._passParameters=new v2e,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new Ept,this.renderDataPool=new Es(Gg),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new qSe,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Fr.Occlude}get isGlobal(){return this.stage.viewingMode===Ve.Global}get shadingEnabled(){var e;return(e=this._techniqueConfiguration)==null?void 0:e.shading}initialize(){const e=[Ee.OPAQUE_TERRAIN,Ee.TRANSPARENT_TERRAIN,Ee.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),ddt()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return tp}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?Z4:Fr.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,_(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,_t.TEXTURE_FADING)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){_(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===_t.TEXTURE_FADING?Vn.FADING:Vn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[Wt.ELEVATION])t.pendingUpdates&=~_t.GEOMETRY;e.resetPendingUpdate(_t.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=gft-s8,i=Math.max(0,Math.floor((e.level-t)/s8)*s8);if(this.isGlobal&&i===0)return za;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{t.isLoaded&&(this.updateTileGeometry(t),t.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(e=ks.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new Xpt(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=A1e(this.rctx)}uninitializeRenderContext(){this.emptyTex=Qe(this.emptyTex),this.tileRenderer=Qe(this.tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=vft,n=_ft;pe(s,r,i),ne(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===yo.MIN,h=!!e.results.ground.target,p=BYe(e.verticalOffset),f=e.tolerance;let m,y=c&&_(o.dist)?o.dist:1/0;const v=b=>{const S=b.renderData;if(!(S==null?void 0:S.vao))return;const T=S.geometryInfo;j5(n8,T.boundingBox);const E=S.localOrigin;_(p)&&(p.localOrigin=E,p.applyToAabb(n8));const C=n8;if(hT[0]=i[0]-E[0],hT[1]=i[1]-E[1],hT[2]=i[2]-E[2],!_Q(C,hT,n,f,y))return;const A=(X,Z,ae)=>{X.set(this.type,b,Z,ae,hn),y=c&&_(o.dist)?o.dist:1/0},I=(X,Z)=>{if(_(Z)&&X>=0&&(e.options.backfacesTerrain||Te(Z,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(i,r,X))){if((l.dist==null||X<l.dist)&&A(l,X,Z),e.options.isFiltered)return;e.options.store===yo.ALL&&(M(m)?(m=YZ(e.ray),A(m,X,Z),e.results.all.push(m)):X<m.dist&&A(m,X,Z)),(o.dist==null||X<o.dist)&&A(o,X,Z),e.options.store!==yo.MIN&&(a.dist==null||X>a.dist)&&A(a,X,Z)}},L=bft;pe(L,r,E);const D=T.indices,U=T.vertexAttributes,z={data:U.getField(O.POSITION,Hi).typedBuffer,size:3,stride:U.stride/4},V=T.indexCount/3;if(M(p)&&V>m2e){const X=b.renderData;M(X.intersectionData)&&(X.intersectionData=new $E(D,0,V,z)),X.intersectionData.intersectRay({r0:hT,r1:L},I)}else h3(hT,L,0,V,D,z,null,p,I)},w=this._rootTiles;_(w)&&(()=>{const b=this.tileIterator;b.reset(w);const S=e.options.invisibleTerrain;for(;!b.done;){const T=b.next();!(T.visible||S&&T.intersectsClippingArea)||!_(p)&&!T.intersectsRay(i,s,f,y)||h&&this._useStencilForTile(T)?b.skipSubtree():v(T)}})()}prepareTechnique(e){if(e.bindParameters.slot===Ee.OCCLUDED_TERRAIN){if((e.renderOccludedMask&Z4)==0)return null}else{const t=this.opaque?Ee.OPAQUE_TERRAIN:Ee.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case je.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=_(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?sy.Disabled:this.overlayRenderer.hasWater?sy.EnabledWithWater:sy.Enabled;const t=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?$a.Occluded:$a.ColorAndWater;return this._updateTechnique(K.Color,t===$a.Occluded)}case je.MATERIAL_DEPTH_SHADOWMAP_ALL:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Shadow,!1)):null;case je.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Depth,!1));case je.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Normal,!1);case je.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Highlight,!1)):null}return null}render(e,t){const i=e.pass,r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,i){case je.MATERIAL:{const s=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?$a.Occluded:$a.ColorAndWater;this._renderMaterialPass(e,t,s);break}case je.MATERIAL_DEPTH_SHADOWMAP_ALL:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,$a.None);break;case je.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,$a.None);break;case je.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,$a.None);break;case je.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,$a.Highlight),e.rctx.clearSafe(tr.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,i)}updateTileBackground(e=null){if(M(this.tileRenderer))return;const t=this.tileRenderer;let i=null;if(_(e)){const r=We.toUnitRGBA(e);i=Fe(r[0]||0,r[1]||0,r[2]||0)}t.setBackground(i),this.allTiles.forAll(r=>t.updateTileTexture(r,Vn.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?Bo.GridComposite:_(t.backgroundColor)?Bo.ColorComposite:Bo.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==yP.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>XSe(this.renderOrder,t)),e.sort((t,i)=>YSe(t[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!M(e)){(t=e[0])==null||t.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const i=t.next(),r=i.renderData;if(!r||i.visible)if(i.rendered){if(r){const s=this._patchGroups.get(r.localOrigin)||new Array;this._patchGroups.set(r.localOrigin,s),s.push(i),(!this.highestVisibleLODTile||i.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=i),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){const r=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new GH(n),e.bindParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],It.TRIANGLES,r,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.rctx,s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=xwe(this.stage.viewingMode,this.ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this.stencilEnabledLayerExtents.length>0,a=i===$a.Occluded;a&&(n.bindTexture("tex",this.emptyTex),n.setUniform1f("blend",1),n.setUniform4fv("texOffsetAndScale",Qf));const l=_(this.tileRenderer)&&_(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:za;this._techniqueConfiguration.tileBlendInput===Bo.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?It.LINES:It.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(h=>{const p=h[0].renderData.localOrigin;t.program.bindDraw(new GH(p),e.bindParameters),this.numOriginsRendered++;for(let f=0;f<h.length;f++){const m=h[f],y=m.renderData.textureReference;if(!M(y)){if(!a){this._scaleRangeQueries.scaleQueriesForTile(m),Lle(m.renderData.geometryInfo.uvOffsetAndScale,y.offsetAndScale,wD),n.setUniform4fv("texOffsetAndScale",wD),n.bindTexture("tex",y.texture.texture);const v=m.renderData.textureFadeFactor,w=v<1?m.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&_(w)&&v<1?(Lle(m.renderData.geometryInfo.uvOffsetAndScale,w.offsetAndScale,wD),n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",wD),n.setUniform3fv("nextTexOpacities",w.opacities),n.bindTexture("texNext",w.texture.texture)):n.setUniform1f("fadeFactor",1),m.renderData.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,t,m,c,o,i),m.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),r.bindVAO(null)}_renderPatch(e,t,i,r,s,n){const o=i.renderData,a=o.vao,l=a.indexBuffer;if(M(l))return;const c=t.program;n!==$a.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===K.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(tz,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};u([d({constructOnly:!0})],Kc.prototype,"overlayRenderer",void 0),u([d({constructOnly:!0})],Kc.prototype,"stage",void 0),u([d({readOnly:!0})],Kc.prototype,"isGlobal",null),u([d({constructOnly:!0})],Kc.prototype,"allTiles",void 0),u([d({constructOnly:!0})],Kc.prototype,"ellipsoidRadius",void 0),u([d({value:!1})],Kc.prototype,"renderingDisabled",null),u([d()],Kc.prototype,"renderPatchBorders",null),u([d()],Kc.prototype,"cullBackFaces",null),u([d({value:yP.FRONT_TO_BACK})],Kc.prototype,"renderOrder",null),u([d()],Kc.prototype,"wireframe",null),Kc=u([P("esri.views.3d.terrain.TerrainRenderer")],Kc);const yft=Kc;function Lle(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3]}const vft=R(),_ft=R(),hT=R(),bft=R();class wft{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let _f=class extends Se{constructor(e){super(e),this._handles=new jt}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(se(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=lt(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!fO(t)||t.isRejected())&&!(t.isFulfilled()&&!xft(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||a5(t)))),e)if(e.isResolved()){const t=YU(e,this.viewSpatialReference,this.viewingMode);if(_(t)){const i=new Nr(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Ve.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Nr.makeWebMercatorAuxiliarySphere(t):Ow(e.spatialReference)&&(e=Nr.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(se(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ve.Global){const e=this.extentHelper.viewSpatialReference,t=Ow(e)||_m(e)||bm(e);e.isWebMercator?this.tilingScheme=Nr.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Nr.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;_(e)&&!sw(e,this.extent)&&(this.tilingScheme=Nr.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function xft(e,t,i){return _(YU(e,t,i))}u([d()],_f.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],_f.prototype,"extent",void 0),u([d({value:!1})],_f.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],_f.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],_f.prototype,"layers",void 0),u([d({constructOnly:!0})],_f.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],_f.prototype,"viewingMode",void 0),_f=u([P("esri.views.3d.terrain.TilingSchemeLogic")],_f);class Tft{constructor(){this.offset=st(),this.scale=0,this.tile=null}init(t,i,r,s){this.tile=t,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const vd=ge.getLogger("esri.views.3d.terrain.TerrainSurface"),Sft=.25;let ii=class extends as.EventedMixin(Se){constructor(e){var t,i;super(e),this._elevationBounds=new hJ,this._iteratorPool=new Es(qSe,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new ydt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new wft,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=R(),this._eyePosSurfaceSR=R(),this._splitLimits=new Hdt,this._snapLevel=1/0,this._frustum=QR(),this._viewProjectionMatrix=Ae(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new jt,this._watchUpdatingTracking=new Zf,this._frameTask=rE,this._allTiles=new Gt,this._upsampleInfoPool=new Es(Tft),this._rootTilesExtent=Nt(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!((i=(t=e.view)==null?void 0:t.state)==null?void 0:i.isLocal)}initialize(){this._lercDecoder=Ght(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Es(xpt):new Es(Tpt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new Vht(e.newCache("elevation-query")),this._set("overlayManager",new ol({surface:this})),this._handles.add([se(()=>this.overlayManager.hasHighlights,s=>this._renderer.setNeedsHighlight(s)),se(()=>this.overlayManager.rendersOccluded,s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new yft({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:bi(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([se(()=>this.baseOpacity,s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},wr),se(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},wr),se(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),Ki),se(()=>this.backgroundColor,s=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(s)},wr),se(()=>this.view.pointsOfInterest,s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),se(()=>ji.TERRAIN_TILE_TREE_SHOW_TILES,s=>{s&&!this._treeDebugger?import("./TerrainTileTree3DDebugger.7009f6ca.js").then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&ji.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=lt(this._treeDebugger))},At)]),this._extentHelper=ndt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new iE({getCollections:()=>{var s,n,o;return(o=(n=(s=this.view)==null?void 0:s.defaultsFromMap)==null?void 0:n.mapCollections)==null?void 0:o.map(({layers:a})=>a)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}):this.view.map.allLayers,i=new _f({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Vf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Vf.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(yt.TERRAIN_SURFACE,this),this._handles.add([se(()=>this._extentHelper.stencilEnabledExtents,s=>this._renderer.setStencilEnabledLayerExtents(s),At),se(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Ki),se(()=>this.extent,()=>this._updateRootTiles(),At),this.view.on("resize",()=>this._viewChangeUpdate()),se(()=>{var o,a;const s=this.view,n=s.state;return[this.lodBias,this.lodSnapping,(a=(o=s.resourceController)==null?void 0:o.memoryController)==null?void 0:a.memoryFactor,n.camera,n.contentCamera,n.fixedContentCamera]},()=>this._viewChangeUpdate(),wr),se(()=>{var s,n;return(n=(s=this.view.qualitySettings)==null?void 0:s.tiledSurface)==null?void 0:n.textureFadeDuration},s=>this._renderer.textureFadingEnabled=s>0,At),se(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Ki)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=er(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=lt(this._upsampleMapCache),this._elevationQueryCache=lt(this._elevationQueryCache),this._set("tilingSchemeLogic",lt(this.tilingSchemeLogic)),this._extentHelper=lt(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",lt(this.overlayManager)),this._tilePool=lt(this._tilePool),mJ.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=lt(this._renderer),this._iteratorPool=lt(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=lt(this._upsampleInfoPool),idt(),Gdt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,i;const e=(i=(t=this.view.pointsOfInterest)==null?void 0:t.contentCameraOnSurface)==null?void 0:i.scale;if(e){const r=this.view.state.contentCamera;let s=iU(this.view,r.eye,r.viewForward,r.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,o=cwe(this.view,e)-n;Math.abs(this._snapLevel-o)>Sft&&(Math.round(o)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=o)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?AE.ON:AE.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(M(t)||M(e))return null;const i=Nt(),r=SSe(t,i,e)?i:null,s=this._get("extent");return sw(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=fL(this.groundExtent,this._userClippingExtent,Nt()),t=this._get("extent");return sw(e,t)?t:e}get groundExtent(){return _(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return _(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){var t,i;const e=!this.renderingDisabled&&!this.opaque;(i=(t=this.view)==null?void 0:t._stage)==null||i.renderView.setRenderParameters({transparentTerrain:e})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,Mo);return M(s)?null:BSe(Mo[0],Mo[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=Mo){var o;const n=this.rootTiles;if(M(n)||!n.length||n[0].layerInfo[Wt.ELEVATION].length===0)return null;if(s[0]=e,s[1]=t,s[2]=i,!un(s,r,s,(o=this.tilingScheme)==null?void 0:o.spatialReference))return vd.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let a of n){if(!a.containsPoint(s))continue;for(;a&&!a.rendered&&!a.isLeaf;){let c=0;s[0]>.5*(a.extent[0]+a.extent[2])&&(c+=1),s[1]<.5*(a.extent[1]+a.extent[3])&&(c+=2),a=a.children[c]}const l=a.renderData;return(l?l.geometryState.samplerData:null)?a:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!Gn(e,Mo,this.spatialReference))return vd.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(_(t)){for(let i of t)if(i==null?void 0:i.containsPoint(Mo)){for(;!i.isLeaf&&!i.rendered;){let r=0;Mo[0]>i.children[0].extent[2]&&(r+=1),Mo[1]<i.children[0].extent[1]&&(r+=2),i=i.children[r]}return this._getLodBiasCorrectedScale(i.level)}}}return 1e100}getSphereElevationBounds(e,t,i,r,s){var c;if(Mo[0]=e,Mo[1]=t,Mo[2]=i,Mo[3]=r,!un(Mo,s,Mo,(c=this.tilingScheme)==null?void 0:c.spatialReference))return vd.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=h=>{if(h&&NK(h.extent,Mo))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),o=Math.max(o,h.elevationBounds[1]);else for(const p of h.children)a(p)},l=this.rootTiles;if(_(l))for(const h of l)a(h);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!Gn(e,Mo,this.spatialReference))return vd.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Mo[3]=t;let i=null;const r=n=>{if(n&&NK(n.extent,Mo))if(n.isLeaf||n.rendered){const o=this._getLodBiasCorrectedScale(n.level);i=i==null?o:Math.min(i,o)}else for(const o of n.children)r(o)},s=this.rootTiles;if(_(s))for(const n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const i=t!==this._renderer.opaque;i&&this._updateTransparentTerrain(),this._updateTileTextures(i?Vn.UNFADED:Vn.IMMEDIATE)}_updateTilingScheme(){var t,i;const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(Lf(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(t=this.view)==null?void 0:t.state)==null?void 0:i.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return xD[0]=e,xD[1]=t,xD[2]=i,s.init(xD,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=Aft;let r=t.rootTilesInExtent(e,i,5*RS);if(_(this.rootTiles)){if(r.length>RS)return void vd.warn(j7e);const s=this.rootTiles.map(o=>o.lij),n=PCe(s,r,Nle);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this.rootTiles.filter(a=>!(n.removed.findIndex(l=>Nle(l,a.lij))>-1)||(this._purgeTile(a,!0),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>RS&&(vd.warn(H7e),r=t.rootTilesInExtent(e,i,RS)),this._setRootTiles(r.map(s=>this._newRootTile(s)));sw(i,this._rootTilesExtent)||(this._rootTilesExtent=Nt(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(s=>{s.isLoaded&&this._prepareToLoadTile(s)}),this._allTiles.forAll(s=>{s.isLoaded&&(this._updateTileGeometry(s),this._updateTileNeighborsAfterGeometryChange(s))}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===_t.SPLIT&&t.setPendingUpdate(_t.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),_(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(_t.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(M(e))return;const t=bdt(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(_t.GEOMETRY)&&this._updateTileGeometry(l),l.setPendingUpdate(_t.RENDERDATA);const c=l.computeVisibility();s||c?(l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),r=Math.max(l.elevationBounds[1],r))):a.skipSubtree()}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(M(this._splitLimits.frustum)&&(this._splitLimits.frustum=QR()),A4(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,A4(this._frustum,e.frustum),jr(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),le(this._eyePosRenderSR,t.eye),un(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(_2e(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach(t=>t.checkGeometryWaterproofness()))):Cft(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e)}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const i=this.neighborTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}else e.updateNeighborsAfterGeometryChange(t)}_updateTileTexture(e,t){const i=e.resetPendingUpdate(_t.TEXTURE_FADING)?_t.TEXTURE_FADING:!!e.resetPendingUpdate(_t.TEXTURE_NOFADING)&&_t.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_elevationUpdate(e){TD.spatialReference=this.spatialReference,TD.tile=e,TD.extent=e.extent,this.emit("elevation-change",TD)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const i=t.next();if(i.loadable){const r=i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(r===_t.SPLIT){i.resetPendingUpdate(_t.MERGE),i.isLeaf&&(i.setPendingUpdate(_t.SPLIT),t.skipSubtree());continue}i.resetPendingUpdate(_t.SPLIT)&&i.updateAgentSuspension(),r===_t.VSPLITMERGE&&i.updateAgents(Wt.ELEVATION)}if(t.skipSubtree(),!i.isLeaf){i.setPendingUpdate(_t.MERGE),i.resetPendingUpdate(_t.SPLIT);const r=this._iteratorPool.acquire();r.resetOne(i);for(let s=r.next();!r.done;s=r.next())this._updateClippingStatus(s),s.updateVisibility(),s.loadable&&s.updateScreenDepth(this._viewProjectionMatrix);r.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(vdt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_prepareBatchTileGeometryUpdate(){this.neighborTilesToUpdate.size,this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{const t=()=>{for(const i of e)i.updateNeighborsWithChangedEdgeResolution()};(()=>{for(const i of e)i.updateNeighborDataAndGeometryIfNeeded()})(),t(),e.clear()})()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let i=!1;for(;!e.done;){i=!0;let r=!1;const s=!this._allTiles.some(n=>{if(n.resetPendingUpdate(_t.MERGE)){if(!t)return n.setPendingUpdate(_t.MERGE),e.done;this._mergeTile(n),r=!0,e.madeProgress()}else n.resetPendingUpdate(_t.SPLIT)&&(this._splitTile(n),r=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(_t.RENDERDATA)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}i||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e)}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some(t=>(t.resetPendingUpdate(_t.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ks.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*V7e}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=De(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){_(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),i}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer)}_splitTile(e){Lf(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(_t.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){SD.spatialReference=this.spatialReference,SD.extent=e.extent,SD.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",SD)}_createTile(e,t,i,r){Lf(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===_t.SPLIT&&s.setPendingUpdate(_t.SPLIT)),s}_mergeTile(e){Lf(!e.hasPendingUpdate(_t.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Lf(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),Lf(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(i=>this._prepareToLoadTile(i)),t.forEach(i=>this._loadTilePrepared(i)),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach(i=>i.updateNeighborsWithChangedEdgeResolution()),t.forEach(i=>i.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(e))}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const i=e.children[t];this._unloadChildren(i),this._unloadTile(i)}}_postLoadTile(e){e.setPendingUpdate(_t.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,i){const r=new sdt(e.lij,e.extent,i);e.dataArrived(t,Wt.ELEVATION,r);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=lC){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),mP(s))if(this._basemapLayerViewHandles.has(s.uid)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);_(o)&&((o<r||M(r))&&(t=!0),r=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,i;let e=((i=(t=this.view.map)==null?void 0:t.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(nq(r)&&!fge(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(l5(e)){const t=kSe(e.layer.parent)?"normal":e.layer.blendMode;if(xdt(DN[t]))return!0}return!1}_layerClassFromLayerView(e){return sq(e)?Wt.ELEVATION:Wt.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push(se(()=>e.suspended,()=>this._updateTiledLayers())),t.push(se(()=>e.fullOpacity,()=>this._updateTileTextures(Vn.UNFADED))),t.push(se(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),l5(e)&&t.push(se(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Vn.UNFADED)})),e.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,e.uid);_(r)&&this._invalidateLayerData(r,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let i=0;i<t.length;i++)t[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach(r=>{if(!r.layer||r.suspended||!mP(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===Wt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}t[s].push(r)});for(const r of ub){const s=this._layerViews[r],n=t[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const p=n[h].uid;this._layerIndexByUid[r].set(p,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this.rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===Wt.ELEVATION&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(Wt.MAP),e===Vn.IMMEDIATE?this.renderer.updateTileTexture(t,_t.TEXTURE_NOFADING):t.updateRenderData(Wt.MAP,e)}),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=ks.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||fP(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],me(F({},r),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Qr(o)||this._dataMissing(e,i,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){return t===Wt.ELEVATION?sq(i)?this._requestElevationTileData(e,i,r):Promise.reject():nq(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=o=>{if(nn(i))return;const a=this._layerIndexByUid[Wt.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):vd.warn("TerrainSurface: received data from unknown layer %d %s",Wt.ELEVATION,e.lij.toString())},s=o=>{Qr(o)||(this._dataMissing(e,Wt.ELEVATION,t,o),this.requestUpdate())};if(ole(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:CR,signal:i.signal}).then(o=>{if(!nn(i))return this._frameTask.schedule(()=>r(o),i.signal,s);vd.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:CR},i.signal)).then(o=>{o?r({values:o.pixelData,width:o.width,height:o.height,noDataValue:o.noDataValue,minValue:o.minValue,maxValue:o.maxValue}):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,d2(h),nn(i)||(this._dataMissing(e,Wt.MAP,t,c),this.requestUpdate())},s=c=>h=>r(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),nn(i)?d2(c):this._mapTileDataArrived(e,t,c)},i.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(fP(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],i).then(n,o)}if(XU(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,o);if(cJ(t)&&ole(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(c=>{if(nn(i))return vd.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(hi());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);u9e(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(n,o)}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(Wt.MAP,t.uid);_(r)?e.dataArrived(r,Wt.MAP,i):(d2(i),vd.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i,r){const s=this._getLayerIdxByUID(t,i.uid);_(s)?e.dataMissing(s,t,r):vd.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(M(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),_(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return _(r)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(M(e)||M(this.rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this.rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this.rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return Lf(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{_(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){o8.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&o8.push(i)});const t=o8.toArray();return XSe(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){var e;return!!((e=this.tilingScheme)==null?void 0:e.spatialReference.isWebMercator)}get isWebMercatorOnPlateeCarree(){var e;return this.isWebMercator&&iR((e=this.view)==null?void 0:e.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}};u([d()],ii.prototype,"_renderer",void 0),u([d()],ii.prototype,"_hasPendingUpdates",void 0),u([d()],ii.prototype,"_asyncWorkItems",void 0),u([d()],ii.prototype,"_allTilesDirty",void 0),u([d()],ii.prototype,"_allTilesSorted",void 0),u([d()],ii.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],ii.prototype,"_watchUpdatingTracking",void 0),u([d()],ii.prototype,"_frameTask",void 0),u([d({readOnly:!0})],ii.prototype,"snapLevel",null),u([d({readOnly:!0})],ii.prototype,"lodSnapping",null),u([d({constructOnly:!0})],ii.prototype,"view",void 0),u([d()],ii.prototype,"_userClippingExtent",null),u([d()],ii.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],ii.prototype,"extent",null),u([d({readOnly:!0})],ii.prototype,"groundExtent",null),u([d({readOnly:!0})],ii.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],ii.prototype,"updating",null),u([d(rdt)],ii.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],ii.prototype,"updatingProgressValue",null),u([d()],ii.prototype,"_maxNumUpdating",void 0),u([d({aliasOf:"view.map.ground.opacity"})],ii.prototype,"baseOpacity",void 0),u([d()],ii.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],ii.prototype,"overlayManager",void 0),u([d({readOnly:!0})],ii.prototype,"viewingMode",null),u([d()],ii.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],ii.prototype,"ready",null),u([d({value:yP.FRONT_TO_BACK})],ii.prototype,"renderOrder",null),u([d({readOnly:!0})],ii.prototype,"rootTiles",void 0),u([d({readOnly:!0})],ii.prototype,"spatialReference",null),u([d({type:We,aliasOf:"view.map.ground.surfaceColor"})],ii.prototype,"backgroundColor",void 0),u([d({value:!1})],ii.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],ii.prototype,"tilingScheme",void 0),u([d({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],ii.prototype,"tilingSchemeLocked",void 0),u([d({readOnly:!0})],ii.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],ii.prototype,"velvetOverground",null),u([qe("_renderer.wireframe")],ii.prototype,"wireframe",void 0),u([d({value:!1})],ii.prototype,"suspended",null),u([d({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],ii.prototype,"textureFadeDuration",void 0),u([d()],ii.prototype,"_layerViewsDirty",void 0),u([qe("_renderer.renderPatchBorders")],ii.prototype,"renderPatchBorders",void 0),u([qe("_renderer.renderingDisabled")],ii.prototype,"renderingDisabled",void 0),ii=u([P("esri.views.3d.terrain.TerrainSurface")],ii);const Eft=ii;function Nle(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function _2e(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>_2e(t)))}function Cft(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const Mo=Ht(),Aft=Nt(),xD=[0,0,0],o8=new Gt,TD={spatialReference:null,tile:null,extent:null,context:"ground"},SD={spatialReference:null,extent:null,scale:0};let qM=class extends Se{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,i)=>this.commitLayer(i,e))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((r,s)=>{const n=this._ensureGeomRecord(e,s);r.forEach((o,a)=>{const l=o[0],c=o[1],h=o[2];let p=!1;if(c&ei.Geometry.UPDATE){const f=n.get(a);if(f){const m=f[1];if(h&ei.State.TRANSFORMATION){const y=this.model.getObject(s);this.model.updateRenderGeometryTransformation(y,l,m)&&(p=!0)}p||t.updates.push({renderGeometry:m,updateType:h})}else pt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(c&ei.Geometry.REMOVE||p){const f=n.get(a);f?(t.removes.push(f[1]),n.delete(a),f[0].disposed&&Ww.pool.release(f[0])):c===ei.Geometry.REMOVE&&pt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(c&ei.Geometry.ADD||p){const f=this.model.getObject(s);if(_(f)){const m=this.model.getRenderGeometry(f,l),y=[l,m];t.adds.push(m),n.set(a,y)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s[1])))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,ei.Geometry.UPDATE,0,0,ei.Geometry.UPDATE,ei.Geometry.ADD|ei.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(ei.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(ei.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(ei.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,ei.Geometry.UPDATE,0,0,ei.Geometry.UPDATE,ei.Geometry.ADD|ei.Geometry.REMOVE,ei.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((i,r)=>{const s=this.model.getObject(r);s&&s.hasVolativeTransformation()&&i.forEach(n=>{n[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r[0],t,ei.Geometry.UPDATE,0,0,ei.Geometry.UPDATE,ei.Geometry.ADD|ei.Geometry.REMOVE,ei.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,ei.Geometry.ADD,ei.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,ei.Geometry.REMOVE,ei.Geometry.ADD,ei.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,s,n,o,a,l){i=ft(i,this._getParentLayerId(e));const c=e.id,h=t.id,p=this._ensureDirtyRecord(i,c),f=p.get(h);if(f){const m=f[1];m&s?(p.delete(h),f[0].disposed&&Ww.pool.release(f[0])):m&n?(f[1]=r,f[2]=l):m&o?f[2]|=l:m&a||pt(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else p.set(h,[t,r,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return on(this._dirtyGeomRecords,e=>on(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return _(e.parentLayer)?e.parentLayer.id:IAe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;const o=[];s.forEach(a=>{const l=a[1];o[l]||(o[l]=[]),o[l].push(a[0].geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,i)=>t+i.size,0)}}}};u([d({constructOnly:!0})],qM.prototype,"model",void 0),u([d()],qM.prototype,"dirty",void 0),qM=u([P("esri.views.3d.webgl-engine.lib.ModelDirtySet")],qM);const Mft=qM;let UN=class extends Se{constructor(){super(...arguments),this.dirtySet=new Mft({model:this}),this._content=new Map,this._originFactory=new UQ(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;pt(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),q4(e)&&this.dirtySet.layerAdded(e)}remove(e){pt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),q4(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)_(t)&&(pt(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)pt(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{geometry:i,material:r,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new RE(i,r,{id:s,boundingInfo:i.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=o||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,i){if(M(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<Mp.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],UN.prototype,"dirtySet",void 0),UN=u([P("esri.views.3d.webgl-engine.parts.Model")],UN);function b2e(){const e=new Float32Array(4);return e[3]=1,e}function w2e(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Oft(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function x2e(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:b2e,clone:w2e,fromValues:Oft,createView:x2e},Symbol.toStringTag,{value:"Module"}));const ps=!0,Kb={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function SJ(e,t,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,i+Kb.identifierOffset,Kb.identifierLength)),version:t.getUint16(i+Kb.versionOffset,ps),checksum:t.getUint32(i+Kb.checksumOffset,ps)}}const Ql={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function Rft(e,t){return{sizeLo:e.getUint32(t+Ql.sizeLo,ps),sizeHi:e.getUint32(t+Ql.sizeHi,ps),minX:e.getFloat64(t+Ql.minX,ps),minY:e.getFloat64(t+Ql.minY,ps),minZ:e.getFloat64(t+Ql.minZ,ps),maxX:e.getFloat64(t+Ql.maxX,ps),maxY:e.getFloat64(t+Ql.maxY,ps),maxZ:e.getFloat64(t+Ql.maxZ,ps),errorX:e.getFloat64(t+Ql.errorX,ps),errorY:e.getFloat64(t+Ql.errorY,ps),errorZ:e.getFloat64(t+Ql.errorZ,ps),count:e.getUint32(t+Ql.count,ps),reserved:e.getUint32(t+Ql.reserved,ps)}}function w2t(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=SJ(e,t,i);if(i+=Kb.byteCount,r!=="LEPCC     ")throw new q("lepcc-decode-error","Bad identifier");if(s>1)throw new q("lepcc-decode-error","Unknown version");const n=Rft(t,i);if(i+=Ql.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new q("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(i=ED(e,i,a),i=ED(e,i,l),i=ED(e,i,c),i=ED(e,i,h),i!==e.byteLength)throw new q("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let y=0;for(let v=0;v<l[m];v++){y+=c[p];const w=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*y),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*w),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function ED(e,t,i){const r=[];t=uq(e,t,r);const s=[];for(let n=0;n<r.length;n++){s.length=0,t=uq(e,t,s);for(let o=0;o<s.length;o++)i.push(s[o]+r[n])}return t}function uq(e,t,i){const r=new DataView(e,t),s=r.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=r.getUint32(1,ps),t+=5;else if(a===1)l=r.getUint16(1,ps),t+=3;else{if(a!==2)throw new q("lepcc-decode-error","Bad count type");l=r.getUint8(1),t+=2}if(o)throw new q("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(e,t,c);let p=0,f=0,m=0;const y=-1>>>32-n;for(let v=0;v<l;v++){for(;f<n;)p|=h[m]<<f,f+=8,m+=1;i[v]=p&y,p>>>=n,f-=n,f+n>32&&(p|=h[m-1]>>8-f)}return t+m}const hb={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function Pft(e,t){return{sizeLo:e.getUint32(t+hb.sizeLo,ps),sizeHi:e.getUint32(t+hb.sizeHi,ps),count:e.getUint32(t+hb.count,ps),colorMapCount:e.getUint16(t+hb.colorMapCount,ps),lookupMethod:e.getUint8(t+hb.lookupMethod),compressionMethod:e.getUint8(t+hb.compressionMethod)}}function Ift(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=SJ(e,t,i);if(i+=Kb.byteCount,r!=="ClusterRGB")throw new q("lepcc-decode-error","Bad identifier");if(s>1)throw new q("lepcc-decode-error","Unknown version");const n=Pft(t,i);if(i+=hb.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new q("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+i!==e.byteLength||n.colorMapCount>256)throw new q("lepcc-decode-error","Bad count");const o=new Uint8Array(e,i,3*n.colorMapCount),a=new Uint8Array(e,i+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+i!==e.byteLength||n.colorMapCount!==0)throw new q("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(i+3!==e.byteLength||n.colorMapCount!==1)throw new q("lepcc-decode-error","Bad count");const o=t.getUint8(i),a=t.getUint8(i+1),l=t.getUint8(i+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new q("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const db={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function $ft(e,t){return{sizeLo:e.getUint32(t+db.sizeLo,ps),sizeHi:e.getUint32(t+db.sizeHi,ps),count:e.getUint32(t+db.count,ps),scaleFactor:e.getUint16(t+db.scaleFactor,ps),bitsPerPoint:e.getUint8(t+db.bitsPerPoint),reserved:e.getUint8(t+db.reserved)}}function Dft(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=SJ(e,t,i);if(i+=Kb.byteCount,r!=="Intensity ")throw new q("lepcc-decode-error","Bad identifier");if(s>1)throw new q("lepcc-decode-error","Unknown version");const n=$ft(t,i);if(i+=db.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new q("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+i!==e.byteLength)throw new q("lepcc-decode-error","Bad size");const a=new Uint8Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+i!==e.byteLength)throw new q("lepcc-decode-error","Bad size");const a=new Uint16Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(uq(e,i,a)!==e.byteLength)throw new q("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const hq=ge.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function Lft(e,t,i){let r="",s=0;for(;s<i;){const n=e[t+s];if(n<128)r+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=i)throw new q("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&e[t+s+1];r+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=i)throw new q("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&e[t+s+1])<<6|63&e[t+s+2];r+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new q("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=i)throw new q("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&e[t+s+1])<<12|(63&e[t+s+2])<<6|63&e[t+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);r+=String.fromCharCode(a,l)}else r+=String.fromCharCode(o);s+=4}}}return r}function T2e(e,t){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let s=0;s<t.length;s++){const n=t[s],o=n.valueType||n.type,a=Gft[o];i.fields[n.property]=a(e,r),r+=iz[o].BYTES_PER_ELEMENT}return i.byteCount=r,i}function Nft(e,t,i){const r=[];let s,n,o=0;for(n=0;n<e;n+=1){if(s=t[n],s>0){if(r.push(Lft(i,o,s-1)),i[o+s-1]!==0)throw new q("string-array-error","Invalid string array: missing null termination.")}else r.push(null);o+=s}return r}function Fle(e,t){return new iz[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function Fft(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function kft(e,t,i){const r=t.header!=null?T2e(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},s={header:r,byteOffset:r.byteCount,byteCount:0,entries:Object.create(null)};let n=r.byteCount;for(let o=0;o<t.ordering.length;o++){const a=t.ordering[o],l=ie(t[a]);if(l.count=r.fields.count,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=r.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new q("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!E2e(l.valueType))throw new q("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=zN(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function S2e(e,t,i){if(t!==e&&hq.error(`Invalid ${i} buffer size
 expected: ${e}, actual: ${t})`),t<e)throw new q("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function Uft(e){return{isDraco:!1,isLegacy:!1,color:e.color!=null,normal:e.normal!=null,uv0:e.uv0!=null,uvRegion:e.uvRegion!=null,featureIndex:e.faceRange!=null&&e.featureId!=null}}function x2t(e,t){const i=T2e(e,t&&t.header);let r=i.byteCount;const s={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},n=i.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of t.ordering){if(!t.vertexAttributes[c])continue;const h=me(F({},t.vertexAttributes[c]),{byteOffset:r,count:o}),p=kle[c]?kle[c]:"_"+c;s.vertexAttributes[p]=h,r+=zN(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(t.faces&&a){s.faces={};for(const c of t.ordering){if(!t.faces[c])continue;const h=me(F({},t.faces[c]),{byteOffset:r,count:a});s.faces[c]=h,r+=zN(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){s.featureAttributes={};for(const c of t.featureAttributeOrder){if(!t.featureAttributes[c])continue;const h=me(F({},t.featureAttributes[c]),{byteOffset:r,count:l});s.featureAttributes[c]=h,r+=(h.valueType==="UInt64"?8:zN(h.valueType))*h.valuesPerElement*l}}return S2e(r,e.byteLength,"geometry"),s.byteCount=r-s.byteOffset,s}function T2t(e,t){return!e||!e.compressedAttributes||e.compressedAttributes.encoding!=="draco"?e?Uft(e):zft(t):Vft(e.compressedAttributes.attributes)}function zft(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e.ordering)if(e.vertexAttributes[i])switch(i){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function Vft(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e)switch(i){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const kle={position:O.POSITION,normal:O.NORMAL,color:O.COLOR,uv0:O.UV0,region:O.UVREGION};function Bft(e,t,i){if(e.encoding==="lepcc-rgb")return Ift(t);if(e.encoding==="lepcc-intensity")return Dft(t);if(e.encoding!=null&&e.encoding!=="")throw new q("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(hq.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),e.ordering[0]==="ObjectIds"&&e.hasOwnProperty("objectIds")&&(hq.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const r=kft(t,e,i);S2e(r.byteOffset+r.byteCount,t.byteLength,"attribute");const s=r.entries.attributeValues||r.entries.objectIds;if(s){if(s.valueType==="String"){const n=r.entries.attributeByteCounts,o=Fle(t,n),a=Fft(t,s);return Nft(n.count,o,a)}return Fle(t,s)}throw new q("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const iz={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},Gft={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function E2e(e){return iz.hasOwnProperty(e)}function zN(e){return E2e(e)?iz[e].BYTES_PER_ELEMENT:0}function jft(e,t,i,r){const s=Hft(e,t,i),n=Ae();return ku(i,s,n,r),n}const C2e=1,Ule=5-C2e;function Hft(e,t,i){const r=R(),s=e[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/Ule)*Ule+C2e);if(i.isGeographic){const l=n/bi(i).radius*180/Math.PI,c=Math.round(e[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(e[0]/p)*p;r[0]=f,r[1]=h}else{const l=Math.round(e[0]/n),c=Math.round(e[1]/n);r[0]=l*n,r[1]=c*n}const o=e[2]+t,a=Math.round(o/n);return r[2]=a*n,r}const DE=1e-6,wA=[0,0,0],CD=[0,0,0];function qft(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new tmt(e);VN(wA,n.minProj,n.maxProj),Nb(wA,wA,.5),Dh(CD,n.maxProj,n.minProj);const o=dq(CD),a=new imt;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(Wft(n,e,y,l,c,h,p,f,m,a)){case 1:return void Gle(wA,CD,t);case 2:return void emt(e,p,t)}Xft(e,y,l,c,h,p,f,m,a),A2e(e,a.b0,a.b1,a.b2,y2,v2);const v=[0,0,0];Dh(v,v2,y2),a.quality=dq(v),a.quality<o?M2e(a.b0,a.b1,a.b2,y2,v2,v,t):Gle(wA,CD,t)}function Wft(e,t,i,r,s,n,o,a,l,c){return Yft(e,r,s),pq(r,s)<DE?1:(Dh(o,r,s),$o(o,o),Zft(t,r,o,n)<DE?2:(Dh(a,s,n),$o(a,a),Dh(l,n,r),$o(l,l),Lh(i,a,o),$o(i,i),pb(t,i,o,a,l,c),0))}const xA=[0,0,0],TA=[0,0,0],th=[0,0,0],ih=[0,0,0],rh=[0,0,0],d0=[0,0,0],p0=[0,0,0],f0=[0,0,0];function Xft(e,t,i,r,s,n,o,a,l){Qft(e,t,i,xA,TA),xA[0]!==void 0&&(Dh(th,xA,i),$o(th,th),Dh(ih,xA,r),$o(ih,ih),Dh(rh,xA,s),$o(rh,rh),Lh(d0,ih,n),$o(d0,d0),Lh(p0,rh,o),$o(p0,p0),Lh(f0,th,a),$o(f0,f0),pb(e,d0,n,ih,th,l),pb(e,p0,o,rh,ih,l),pb(e,f0,a,th,rh,l)),TA[0]!==void 0&&(Dh(th,TA,i),$o(th,th),Dh(ih,TA,r),$o(ih,ih),Dh(rh,TA,s),$o(rh,rh),Lh(d0,ih,n),$o(d0,d0),Lh(p0,rh,o),$o(p0,p0),Lh(f0,th,a),$o(f0,f0),pb(e,d0,n,ih,th,l),pb(e,p0,o,rh,ih,l),pb(e,f0,a,th,rh,l))}function Yft(e,t,i){let r=pq(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=pq(e.maxVert[n],e.minVert[n]);o>r&&(r=o,s=n)}vc(t,e.minVert[s]),vc(i,e.maxVert[s])}const sh=[0,0,0];function Zft(e,t,i,r){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){sh[0]=s[l]-t[0],sh[1]=s[l+1]-t[1],sh[2]=s[l+2]-t[2];const c=i[0]*sh[0]+i[1]*sh[1]+i[2]*sh[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=sh[0]*sh[0]+sh[1]*sh[1]+sh[2]*sh[2]-c*c/h;p>o&&(o=p,a=l)}return vc(r,s,a),o}const _n=[0,0];function Qft(e,t,i,r,s){Kft(e,t,_n,s,r);const n=R2e(i,t);_n[1]-DE<=n&&(r[0]=void 0),_n[0]+DE>=n&&(s[0]=void 0)}const zle=[0,0,0],Vle=[0,0,0],Ble=[0,0,0],dT=[0,0,0],pT=[0,0,0],AD=[0,0,0];function pb(e,t,i,r,s,n){if(O2e(t)<DE)return;Lh(zle,i,t),Lh(Vle,r,t),Lh(Ble,s,t),g2(e,t,_n),pT[1]=_n[0],dT[1]=_n[1],AD[1]=dT[1]-pT[1];const o=[i,r,s],a=[zle,Vle,Ble];for(let l=0;l<3;++l){g2(e,o[l],_n),pT[0]=_n[0],dT[0]=_n[1],g2(e,a[l],_n),pT[2]=_n[0],dT[2]=_n[1],AD[0]=dT[0]-pT[0],AD[2]=dT[2]-pT[2];const c=dq(AD);c<n.quality&&(vc(n.b0,o[l]),vc(n.b1,t),vc(n.b2,a[l]),n.quality=c)}}const Jft=[0,0,0];function g2(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*t[0]+r[n+1]*t[1]+r[n+2]*t[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function Kft(e,t,i,r,s){const{data:n,size:o}=e;vc(r,n),vc(s,r),i[0]=R2e(Jft,t),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<i[0]&&(i[0]=l,vc(r,n,a)),l>i[1]&&(i[1]=l,vc(s,n,a))}}function Gle(e,t,i){vc(i.center,e),Nb(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const Xm=[0,0,0],fT=[0,0,0],SA=[0,0,0],y2=[0,0,0],v2=[0,0,0],jle=[0,0,0];function emt(e,t,i){vc(Xm,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?Xm[0]=0:Math.abs(t[1])>Math.abs(t[2])?Xm[1]=0:Xm[2]=0,O2e(Xm)<DE&&(Xm[0]=Xm[1]=Xm[2]=1),Lh(fT,t,Xm),$o(fT,fT),Lh(SA,t,fT),$o(SA,SA),A2e(e,t,fT,SA,y2,v2),Dh(jle,v2,y2),M2e(t,fT,SA,y2,v2,jle,i)}function A2e(e,t,i,r,s,n){g2(e,t,_n),s[0]=_n[0],n[0]=_n[1],g2(e,i,_n),s[1]=_n[0],n[1]=_n[1],g2(e,r,_n),s[2]=_n[0],n[2]=_n[1]}const MD=[0,0,0],Zp=[1,0,0,0,1,0,0,0,1],mT=[0,0,0];function M2e(e,t,i,r,s,n,o){Zp[0]=e[0],Zp[1]=e[1],Zp[2]=e[2],Zp[3]=t[0],Zp[4]=t[1],Zp[5]=t[2],Zp[6]=i[0],Zp[7]=i[1],Zp[8]=i[2],rmt(o.quaternion,Zp),VN(mT,r,s),Nb(mT,mT,.5),Nb(o.center,e,mT[0]),Nb(MD,t,mT[1]),VN(o.center,o.center,MD),Nb(MD,i,mT[2]),VN(o.center,o.center,MD),Nb(o.halfSize,n,.5)}const Gc=7;class tmt{constructor(t){this.minVert=new Array(Gc),this.maxVert=new Array(Gc);const i=64*Gc;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Gc),r+=8*Gc,this.maxProj=new Float64Array(this.buffer,r,Gc),r+=8*Gc;for(let l=0;l<Gc;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Gc;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Gc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Gc),n=new Array(Gc),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Gc;++l){let c=s[l];vc(this.minVert[l],o,c),c=n[l],vc(this.maxVert[l],o,c)}}}class imt{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function dq(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function VN(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function Dh(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function Nb(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function vc(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function Lh(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o}function $o(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function O2e(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function pq(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function R2e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function rmt(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1);e[r]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+r]+t[3*r+s])*o,e[n]=(t[3*n+r]+t[3*r+n])*o}}const jO=Sy(),ew=R(),smt=R(),nmt=Pr();class S2t{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:fW(this.buffer,56*a+0),halfSize:D1e(this.buffer,56*a+24),quaternion:x2e(this.buffer,56*a+36)}}}function EJ(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:Bs(e),halfSize:b4(t),quaternion:w2e(i)}}function Hle(e){return EJ(e.center,e.halfSize,e.quaternion)}function E2t(e,t){le(t.center,e.center),le(t.halfSize,e.halfSize),n3(t.quaternion,e.quaternion)}function P2e(e,t){return t=t||EJ(),qft(e,t),t}function fb(e,t){const i=cr(t,e.center),r=rz(e,t);return i>r?1:i<-r?-1:0}function C2t(e,t){t||(t=Hs());const i=qk(nmt,e.quaternion),r=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),s=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),n=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+r,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function A2t(e,t){return cr(t,e.center)-rz(e,t)}function M2t(e,t){return cr(t,e.center)+rz(e,t)}function O2t(e,t){return fb(e,t[0])<=0&&fb(e,t[1])<=0&&fb(e,t[2])<=0&&fb(e,t[3])<=0&&fb(e,t[4])<=0&&fb(e,t[5])<=0}function R2t(e,t,i,r=0){my(jO,e.quaternion),pe(ew,t,e.center);const s=Eu(ew,ew,jO),n=Eu(smt,i,jO);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+e.halfSize[l]-s[l])/n[l],h=(-r-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+r||s[l]<-e.halfSize[l]-r)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function rz(e,t){my(jO,e.quaternion),Eu(ew,t,jO);const i=e.halfSize;return Math.abs(ew[0]*i[0])+Math.abs(ew[1]*i[1])+Math.abs(ew[2]*i[2])}function I2e(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],Eu(r,r,e.quaternion),de(r,r,e.center)}}function omt(e){return vW(e.halfSize)}function $2e(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function P2t(e){var t;if(he("disable-feature:i3s-draco")||!e)return!1;for(const i of e)for(const r of i.geometryBuffers)if(((t=r.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function I2t(e,t,i,r,s,n){const o=t!==r;s.traverse(i,a=>{let l=a.mbs;return o&&(l=amt,K$e(a.mbs,r,l,t)),lmt(e,l)!==tw.OUTSIDE&&(n(a),!0)})}function $2t(e,t,i){let r=0,s=0;for(let n=0;n<t.length&&r<e.length;n++)e[r]===t[n]&&(i(n)&&(e[s]=e[r],s++),r++);e.length=s}function D2t(e,t,i){let r=0,s=0;for(;r<i.length;)Xue(e,i[r])>=0===t&&(i[s]=i[r],s++),r++;i.length=s}const EA=Nt();function L2t(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return EA[0]=(e[0]-t.position[0])/t.rotationScale[0],EA[1]=(e[1]-t.position[1])/t.rotationScale[4],EA[2]=(e[2]-t.position[0])/t.rotationScale[0],EA[3]=(e[3]-t.position[1])/t.rotationScale[4],EA}const amt=Ht();var tw;function lmt(e,t){const i=t[0],r=t[1],s=t[3],n=e[0]-i,o=i-e[2],a=e[1]-r,l=r-e[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?tw.OUTSIDE:p>0?tw.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?tw.INSIDE:tw.INTERSECTS_CENTER_INSIDE}function cmt(e,t,i){const r=[],s=i&&i.missingFields,n=i&&i.originalFields;for(const o of e){const a=o.toLowerCase();let l=!1;for(const c of t)if(a===c.name.toLowerCase()){r.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return r}async function N2t(e,t,i,r,s){if(t.length===0)return[];const n=e.attributeStorageInfo;if(_(e.associatedLayer))try{return await hmt(e.associatedLayer,t,i,r)}catch(o){if(e.associatedLayer.loaded)throw o}if(n){const o=umt(t,i,s);if(M(o))throw new q("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=e.parsedUrl.path,l=await Promise.all(o.map(c=>dmt(a,n,c.node,c.indices,r).then(h=>{for(let p=0;p<c.graphics.length;p++){const f=c.graphics[p],m=h[p];if(f.attributes)for(const y in f.attributes)y in m||(m[y]=f.attributes[y]);f.attributes=m}return c.graphics})));return Yue(l)}throw new q("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function umt(e,t,i){const r=new Map,s=[],n=i();for(const o of e){const a=o.attributes[t];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=r.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),r.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function hmt(e,t,i,r){t.sort((l,c)=>l.attributes[i]-c.attributes[i]);const s=t.map(l=>l.attributes[i]),n=[],o=cmt(r,e.fields,{originalFields:n}),a=await D2e(e,s,o);for(let l=0;l<t.length;l++){const c=t[l],h=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=h[o[f]];c.attributes=p}return t}function D2e(e,t,i){const r=e.capabilities.query.maxRecordCount;if(r!=null&&t.length>r){const n=$Ce(t,r);return Promise.all(n.map(o=>D2e(e,o,i))).then(Yue)}const s=new Kd({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===t.length)return n.features.map(o=>o.attributes);throw new q("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function dmt(e,t,i,r,s){const n=[];for(const o of t)if(o&&s.includes(o.name)){const a=`${e}/nodes/${i.resources.attributes}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return Sn(n.map(o=>gr(o.url,{responseType:"array-buffer"}).then(a=>Bft(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of r){const c={};for(let h=0;h<o.length;h++)o[h].value!=null&&(c[n[h].storageInfo.name]=mmt(o[h].value,l));a.push(c)}return a})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(tw||(tw={}));const pmt=-32768,fmt=-(2**31);function mmt(e,t){if(!e)return null;const i=e[t];return Kue(e)?i===pmt?null:i:ehe(e)?i===fmt?null:i:i!=i?null:i}function gmt(e){const t=e.store.indexCRS||e.store.geographicCRS,i=t===void 0?e.store.indexWKT:void 0;if(i){if(!e.spatialReference)throw new q("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new q("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new Ze($2e(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function ymt(e){const t=e.store.vertexCRS||e.store.projectedCRS,i=t===void 0?e.store.vertexWKT:void 0;if(i){if(!e.spatialReference)throw new q("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new q("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new Ze($2e(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function F2t(e,t){return M(t)?"@null":t===hm(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function fq(e,t,i){if(!cy(e,t))throw new q("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(i==="local"&&!vmt(e,t))throw new q("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function vmt(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function _mt(e,t,i){const r=gmt(e),s=ymt(e);fq(r,t,i),fq(s,t,i)}function bmt(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function k2t(e){if(e.store==null||e.store.defaultGeometrySchema==null||!bmt(e.store.defaultGeometrySchema))throw new q("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function U2t(e,t){_mt(e,t.spatialReference,t.viewingMode)}function wmt(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function z2t(e){if(e.store==null||e.store.defaultGeometrySchema==null||!wmt(e.store.defaultGeometrySchema))throw new q("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function V2t(e,t){fq(e.spatialReference,t.spatialReference,t.viewingMode)}function xmt(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function Tmt(e){return e.type==="mesh-3d"}function B2t(e){if(e==null||!xmt(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const i of t){if(!Tmt(i)||i.symbolLayers.length===0)return!0;for(const r of i.symbolLayers.items)if(r.type!=="fill"||M(r.material)||M(r.material.color)||r.material.colorMixMode!=="replace")return!0}return!1}const G2t=$xe({color:[0,0,0,0],opacity:0});class Smt{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function j2t(e){const t=new Smt;let i=!1,r=!1;for(const s of e.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(_(n)&&!i){const a=n.color,l=STe(n.colorMixMode);_(a)?t.material={color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:Ss.Multiply},t.castShadows=s.castShadows,i=!0}_(o)&&!r&&(t.edgeMaterial=Ixe(o,{}),r=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:Ss.Multiply}),t}function H2t(e,t){return(0|e)+(0|t)|0}function Emt(e,t,i,r,s=0){r===hm(r)?t.isGeographic?Imt(e,i,t,s):Pmt(e,i,t,s):t.isWGS84&&(r.isWebMercator||iR(r))?Amt(t,e,r,i,s):t.isWebMercator&&iR(r)?Rmt(t,e,r,i,s):e===i?(i.center[2]+=s,pr(i.center,t,0,i.center,r,0,1)):(ne(i.center,e.center[0],e.center[1],e.center[2]+s),pr(i.center,t,0,i.center,r,0,1),n3(i.quaternion,e.quaternion),le(i.halfSize,e.halfSize))}function Cmt(e,t,i,r,s){if(n3(s.quaternion,e.quaternion),r===Ve.Global){my(OD,e.quaternion),Eu(m0,e.center,OD),Z8(gT,m0),tde(yT,gT,e.halfSize),Tc(yT,gT,yT);const n=Oe(yT);de(yT,gT,e.halfSize);const o=Oe(yT);if(n<i)le(s.center,e.center),ne(m0,i,i,i),de(s.halfSize,e.halfSize,m0);else{const a=o>0?1+t/o:1,l=n>0?1+i/n:1,c=(l+a)/2,h=(l-a)/2;ce(s.halfSize,gT,h),Fb(s.halfSize,s.halfSize,e.halfSize,c),ce(s.center,gT,c),Fb(s.center,s.center,e.halfSize,h),ede(m0,m0),N5(s.center,s.center,m0),Eu(s.center,s.center,s.quaternion)}}else{const n=ne(m0,0,0,1);Fb(s.center,e.center,n,(i+t)/2),my(OD,e.quaternion),Eu(n,n,OD),Z8(n,n),Fb(s.halfSize,e.halfSize,n,(i-t)/2)}return s}const m0=R(),gT=R(),yT=R(),OD=Sy();function Amt(e,t,i,r,s){le(wv,t.center),wv[2]+=s;const n=hm(i);pr(wv,e,0,wv,n,0,1),L2e(n,t,wv,i,r)}const BN=new Float64Array(24),Mmt={data:BN,size:3},qle=R(),wv=R(),Omt=Pr();function Rmt(e,t,i,r,s){le(wv,t.center),wv[2]+=s,L2e(e,t,wv,i,r)}function L2e(e,t,i,r,s){const n=qk(Omt,t.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)qle[a]=t.halfSize[a]*((o&1<<a)!=0?-1:1);for(let a=0;a<3;++a){let l=i[a];for(let c=0;c<3;++c)l+=qle[c]*n[3*c+a];BN[3*o+a]=l}}pr(BN,e,0,BN,r,0,8),P2e(Mmt,s)}function Pmt(e,t,i,r){I2e(e,mq),ne(t.center,e.center[0],e.center[1],e.center[2]+r),ku(i,t.center,jc,hm(i)),ne(t.center,jc[12],jc[13],jc[14]);const s=2*Math.sqrt(1+jc[0]+jc[5]+jc[10]);Rg[0]=(jc[6]-jc[9])/s,Rg[1]=(jc[8]-jc[2])/s,Rg[2]=(jc[1]-jc[4])/s,Rg[3]=.25*s,TZ(t.quaternion,Rg,e.quaternion),my(Rg,t.quaternion);let n=0,o=0,a=0;for(const l of mq)l[2]+=r,pr(l,i,0,l,hm(i),0,1),Tc(yi,l,t.center),Eu(yi,yi,Rg),n=Math.max(n,Math.abs(yi[0])),o=Math.max(o,Math.abs(yi[1])),a=Math.max(a,Math.abs(yi[2]));ne(t.halfSize,n,o,a)}function Imt(e,t,i,r){const s=bi(i),n=1+Math.max(0,r)/(s.radius+e.center[2]);ne(t.center,e.center[0],e.center[1],e.center[2]+r),pr(t.center,i,0,t.center,hm(i),0,1),n3(t.quaternion,e.quaternion),my(Rg,e.quaternion),ne(yi,0,0,1),Eu(yi,yi,Rg),ne(yi,e.halfSize[0]*Math.abs(yi[0]),e.halfSize[1]*Math.abs(yi[1]),e.halfSize[2]*Math.abs(yi[2])),ce(yi,yi,s.inverseFlattening),de(t.halfSize,e.halfSize,yi),ce(t.halfSize,t.halfSize,n)}function q2t(e,t,i,r,s,n){if(!n||n.length===0||M(t))return null;const o=jft(e.mbs,s,i,t);let a;vs(PD,o);const l=()=>{if(!a)if(a=mq,Lu(RD),_(e.serviceObb)){Emt(e.serviceObb,i,Wle,t,s),I2e(Wle,a);for(const m of a)ke(m,m,PD),JS(RD,m)}else{const m=e.mbs,y=m[3];un(m,i,yi,t),ke(yi,yi,PD),yi[2]+=s;for(let v=0;v<8;++v){const w=1&v?y:-y,b=2&v?y:-y,S=4&v?y:-y,T=a[v];le(T,[yi[0]+w,yi[1]+b,yi[2]+S]),JS(RD,T)}}};let c=1/0,h=-1/0;const p=m=>{if(m.type!=="replace")return;const y=m.geometry;if(!y.hasZ)return;Lu(a8);const v=y.spatialReference||r,w=y.rings.reduce((b,S)=>S.reduce((T,E)=>(un(E,v,yi,t),ke(yi,yi,PD),JS(a8,yi),Math.min(yi[2],T)),b),1/0);l(),kP(RD,a8)&&(c=Math.min(c,w),h=Math.max(h,w))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,y,v)=>{ke(yi,v,o),m[y+0]=yi[0],m[y+1]=yi[1],m[y+2]=yi[2],y+=24,v[2]=c,ke(yi,v,o),m[y+0]=yi[0],m[y+1]=yi[1],m[y+2]=yi[2],y+=24,v[2]=h,ke(yi,v,o),m[y+0]=yi[0],m[y+1]=yi[1],m[y+2]=yi[2]};for(let m=0;m<8;++m)f(Xle.data,3*m,a[m]);return P2e(Xle)}function W2t(e){return _(e)&&e.halfSize[0]>=0}function X2t(e){return e[3]>=0}function Y2t(e){_(e)&&(e.halfSize[0]=-1)}function Z2t(e){_(e)&&(e[3]=-1)}const jc=Ae(),Rg=b2e(),mq=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],a8=Nt(),RD=Nt(),Wle=EJ(),yi=[0,0,0],Xle={data:new Array(72),size:3},PD=Ae();class $mt{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];return i}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Dmt(t)}forEachComponent(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=t[n],l=t[o];i[s]=a,i[s+1]=l-a}return i}}function Dmt(e){const t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}class Lmt extends wU{constructor(t,i){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=tW(i);const r=this.count;this.visibility=new $mt(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return M(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return M(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return M(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((M(this.cachedHighlightRanges)||M(this.cachedDefaultRanges))&&_(this.highlightCounts)){const{highlightRanges:t,defaultRanges:i}=Nmt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=i}}}function Nmt(e,t,i){const r=[],s=[];let n=i.length,o=i.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}class gq extends wU{constructor(){super(...arguments),this.visible=_2.Hidden}}var _2;u([Io()],gq.prototype,"renderable",void 0),u([Io()],gq.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(_2||(_2={}));function Fmt(e,t,i,r){if(i>=t)return e;e==null&&(e=kmt());const s=e.isVisibleBit;let n=e.data;const o=F2e(n),a=i/o|0,l=i-o*a,c=(t-1)/o|0,h=n,p=r===s;if(!(i<h.length*o)&&p){const m=a+1,y=Math.ceil(h.length*1.5),v=c+1;let w=Math.max(m,y);w=Math.min(w,v),n=new Uint32Array(w),n.set(h)}return a<n.length&&(n[a]=zmt(n[a],l,p)),e.data=n,e}function N2e(e,t){if(e==null)return!0;const{isVisibleBit:i,data:r}=e,s=F2e(r);return t<r.length*s?Umt(i,r,t,s):!e.isVisibleBit}function kmt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function Umt(e,t,i,r){const s=i/r|0,n=i-s*r;return Vmt(t[s],n)===e}function F2e(e){return e.BYTES_PER_ELEMENT*8}function zmt(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function Vmt(e,t){return(e&1<<t)!=0}class Bmt{constructor(t,i){this._indices=_(t.indices)?t.indices:vE(t.positions.length/3),this._positions=new Hi(t.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(t,i){if(_(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*t+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(t,i)}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,o,a){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},c=this._indices,h=this._components.offsets,p=Dwe(t,i,Gmt),f=t[2],m=i[2];this._components.visibility.forEachComponent(y=>{if(!N2e(this._components.pickability,y))return!0;const v=this.getComponentAabb(y,jmt);if(_(o)){const E=o[y];_(n)?n.componentOffset=E:(t[2]=f-E,i[2]=m-E)}if(_(n)&&n.applyToAabb(v),!vQ(v,t,p,r))return!0;const w=h[y]/3,b=h[y+1]/3,S=(E,C,A)=>{a(y,E,fc(C,C,s),A)},T=b-w;return M(n)&&T>m2e?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new $E(this._indices,w,b,l)),this._componentIntersectionData[y].intersectRay({r0:t,r1:i},S)):h3(t,i,w,b,c,l,void 0,n,S),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const i=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,v=-1/0;for(let w=l;w<c;w++){const b=i[w]*s,S=r[b],T=r[b+1],E=r[b+2];h=Math.min(h,S),p=Math.min(p,T),f=Math.min(f,E),m=Math.max(m,S),y=Math.max(y,T),v=Math.max(v,E)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=y,this._perComponentAabbs[o++]=v}}get positions(){return this._positions}get indices(){return this._indices}}const Gmt=R(),jmt=Hs();class Hmt{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}dispose(){this.material.dispose(),this.geometry.dispose()}}class k2e extends wU{constructor(t,i,r,s){super(),this.primitiveType=i,this.parameters=r,this.indexed=s,this.vao=t}}u([Io()],k2e.prototype,"vao",void 0);function qmt(e,t){return{near:e,far:t}}function A3(e){return e?vP(e,1/0,-1/0):qmt(1/0,-1/0)}function vP(e,t,i){return e.near=t,e.far=i,e}function LE(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function ID(e,t){return e.near<=t&&t<=e.far}const yq={near:0,far:0};function Wmt(e,t){const i=A3(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=_(o.offsetObb)?o.offsetObb:o.obb,l=Te(Tc(eu,a.center,r),n),c=rz(a,n);if(ID(i,l-c)&&ID(i,l+c))return;const h=Jmt(a,s);if(h===-1)return;if(h===0)return Ym.far=l+c,Ym.near=l-c,void LE(i,Ym);const p=$D.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<$D.length;o++){const a=$D.data[o];if(ID(i,a.near)&&ID(i,a.far))continue;Ym.far=a.far,Ym.near=1/0,Qmt(_(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,Xmt,c=>{let h=Ymt;for(let p=0;p<U2e&&c.length>0;p++){if((a.mask&1<<p)==0)continue;Zmt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){ne(hl,c.data[p+0],c.data[p+1],c.data[p+2]);const f=Te(Tc(hl,hl,r),n);Ym.near=Math.min(Ym.near,f)}})===0&&(Ym.near=0),LE(i,Ym)}return $D.length=0,i}const $D=new Gt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),Ym=A3(),hl=R(),T1=R(),Xmt=new Gt({deallocator:null}),Ymt=new Gt({deallocator:null});function Zmt(e,t,i){i.length=0;const r=t.length-3;l8(hl,t,r);const s=cr(e,hl);s<=0&&(i.push(hl[0]),i.push(hl[1]),i.push(hl[2]));let n=0,o=s;for(;n<r;n+=3){l8(T1,t,n);const a=cr(e,T1);o*a<0&&(dn(hl,T1,hl,a/(a-o)),dl(i,hl)),a<=0&&dl(i,T1),o=a,le(hl,T1)}o*s<0&&(l8(T1,t,r),dn(hl,T1,hl,s/(s-o)),dl(i,hl))}function l8(e,t,i){return ne(e,t.data[i+0],t.data[i+1],t.data[i+2])}function dl(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function Qmt(e,t,i,r){my(Zle,e.quaternion),Tc(eu,t,e.center),Eu(eu,eu,Zle);const s=8*((eu[0]<-e.halfSize[0]?-1:eu[0]>e.halfSize[0]?1:0)+3*(eu[1]<-e.halfSize[1]?-1:eu[1]>e.halfSize[1]?1:0)+9*(eu[2]<-e.halfSize[2]?-1:eu[2]>e.halfSize[2]?1:0)+13),n=Yle[s];if(n===0)return n;qk(DD,e.quaternion),NZ(DD,DD,e.halfSize);const o=(a,l)=>{const c=Yle[s+l+1];return ne(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),fc(a,a,DD),de(a,e.center,a)};return i.length=0,dl(i,o(c8,0)),dl(i,o(Qle,1)),dl(i,o(eu,2)),dl(i,o(Jle,3)),r(i),n===1||(i.length=0,dl(i,c8),dl(i,Jle),dl(i,o(eu,4)),dl(i,o(Kle,5)),r(i),n===2||(i.length=0,dl(i,c8),dl(i,Kle),dl(i,o(eu,6)),dl(i,Qle),r(i))),n}const Yle=(()=>{const e=new Int8Array(216);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),U2e=4;function Jmt(e,t){let i=0;for(let r=0;r<U2e;r++){const s=fb(e,t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const DD=Pr(),Zle=Sy(),eu=R(),c8=R(),Qle=R(),Jle=R(),Kle=R();class Kmt{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,i,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?Wmt(t,this._objects.visibleObjects):null}}function egt(e){const t=ls().vec3f(O.POSITION);return e.normals&&t.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===ln.Default?t.vec2f(O.UV0):e.textureCoordinates===ln.Atlas&&(t.vec2f(O.UV0),t.vec4u16(O.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(O.COLOR,{glNormalized:!0}),t.alignTo(4)}class tgt extends Jr{constructor(t,i){super(t,"int",Ui.Draw,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}var vp;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(vp||(vp={}));const CJ=429496.7296;function z2e(e,t){tP(e/CJ*.5+.5,t)}function igt(e,t){switch(t.componentData){case vp.Varying:return rgt(e);case vp.Uniform:return sgt(e);case vp.COUNT:return;default:t.componentData}}function rgt(e){const{vertex:t,fragment:i}=e;t.include($c),t.uniforms.add([new Vr("componentColorTex"),new Zg("componentColorTexInvDim")]),e.attributes.add(O.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(CTe),t.constants.add("elevationScale","float",2*CJ),t.code.add(x`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),i.code.add(x`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}function sgt(e){const{vertex:t,fragment:i}=e;t.uniforms.add(new d5("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new tgt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(x`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(x`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var Uh;function ngt(e,t){const i=e.vertex;switch(i.code.add(x`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case Uh.None:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Uh.Opaque:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Uh.Transparent:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Uh||(Uh={}));var em;function Q2t(e){return e&&_m(e)?em.Mars:e&&bm(e)?em.Moon:em.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(em||(em={}));var ece,yu;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(ece||(ece={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(yu||(yu={}));class oi extends Ha{constructor(){super(...arguments),this.output=K.Color,this.textureCoordinateType=ln.None,this.componentData=vp.Uniform,this.cullFace=dr.Back,this.vertexDiscardMode=Uh.None,this.doubleSidedMode=Gr.WindingOrder,this.alphaDiscardMode=ur.Opaque,this.integratedMeshMode=yu.None,this.transparencyPassType=vt.NONE,this.ellipsoidMode=em.Earth,this.pbrMode=Ot.Disabled,this.normalType=Rr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}u([j({count:K.COUNT})],oi.prototype,"output",void 0),u([j({count:ln.COUNT})],oi.prototype,"textureCoordinateType",void 0),u([j({count:vp.COUNT})],oi.prototype,"componentData",void 0),u([j({count:dr.COUNT})],oi.prototype,"cullFace",void 0),u([j({count:Uh.COUNT})],oi.prototype,"vertexDiscardMode",void 0),u([j({count:Gr.COUNT})],oi.prototype,"doubleSidedMode",void 0),u([j({count:ur.COUNT})],oi.prototype,"alphaDiscardMode",void 0),u([j({count:yu.COUNT})],oi.prototype,"integratedMeshMode",void 0),u([j({count:vt.COUNT})],oi.prototype,"transparencyPassType",void 0),u([j({count:em.COUNT})],oi.prototype,"ellipsoidMode",void 0),u([j({count:Ot.COUNT})],oi.prototype,"pbrMode",void 0),u([j({count:Rr.COUNT})],oi.prototype,"normalType",void 0),u([j()],oi.prototype,"spherical",void 0),u([j()],oi.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],oi.prototype,"hasVertexColors",void 0),u([j()],oi.prototype,"hasNormals",void 0),u([j()],oi.prototype,"hasSlicePlane",void 0),u([j()],oi.prototype,"hasBaseColorTexture",void 0),u([j()],oi.prototype,"receiveAmbientOcclusion",void 0),u([j()],oi.prototype,"receiveShadows",void 0),u([j()],oi.prototype,"blendingEnabled",void 0),u([j()],oi.prototype,"hasScreenSpaceReflections",void 0),u([j()],oi.prototype,"hasPolygonOffset",void 0),u([j()],oi.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([j()],oi.prototype,"hasEmissionTexture",void 0),u([j()],oi.prototype,"hasOcclusionTexture",void 0),u([j()],oi.prototype,"hasNormalTexture",void 0),u([j()],oi.prototype,"hasOccludees",void 0),u([j()],oi.prototype,"hasMultipassTerrain",void 0),u([j()],oi.prototype,"cullAboveGround",void 0),u([j()],oi.prototype,"isGround",void 0),u([j()],oi.prototype,"hasCloudsReflections",void 0),u([j()],oi.prototype,"snowCover",void 0),u([j({constValue:Ui.Draw})],oi.prototype,"pbrTextureBindType",void 0),u([j({constValue:!0})],oi.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],oi.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],oi.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],oi.prototype,"hasVertexTangents",void 0),u([j({constValue:!0})],oi.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!1})],oi.prototype,"highStepCount",void 0),u([j({constValue:!1})],oi.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!0})],oi.prototype,"useFillLights",void 0);function tce(e,t){e.include(_x,t),e.fragment.include(lP);const i=e.fragment;i.uniforms.add(new d5("baseColor",r=>r.baseColor)),i.uniforms.add(new MTe("objectOpacity",r=>r.objectOpacity)),t.hasVertexColors?i.code.add(x`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(x`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(x`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function ice(e,t){const i=e.fragment;switch(t.doubleSidedMode){case Gr.None:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Gr.View:e.include(h2,t),i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Gr.WindingOrder:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Gr.COUNT:}switch(t.normalType){case Rr.Attribute:case Rr.CompressedAttribute:e.include(EU,t),i.code.add(x`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Rr.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(h2,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Rr.Ground:t.spherical?(e.include(h2,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(x`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case Rr.COUNT:}}function ogt(e,t){const i=e.fragment;if(t.hasBaseColorTexture){e.include(CZ,t);const r=t.textureCoordinateType===ln.Atlas;i.uniforms.add(AO("baseColorTexture",s=>s.texture,r)),r?(e.include(U1e),i.code.add(x`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):i.code.add(x`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(x`vec4 readBaseColorTexture() { return vec4(1.0); }`)}const V2e=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);function agt(e){const t=new qi;t.include(h2,e),t.include(EU,e),t.include(_x,e),t.include(Yg,e),t.include(w3,e),t.include(igt,e),t.include(qrt,e),t.include(ret,e),t.include(ogt,e),t.include(ngt,e);const{vertex:i,fragment:r}=t;r.uniforms.add(new u_("view")),e.pbrMode!==Ot.Normal&&e.pbrMode!==Ot.Schematic||(t.include(RZ,e),e.hasNormalTexture&&t.include(PTe,e)),e.output===K.Shadow&&e.componentData===vp.Varying?i.code.add(x`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(x`#define discardShadows(castShadows) {}`);const s=e.integratedMeshMode===yu.ColorOverlay||e.integratedMeshMode===yu.ColorOverlayWithWater,n=s&&e.output===K.Color&&e.pbrMode===Ot.WaterOnIntegratedMesh;return s&&(t.include(Zw,e),t.include(cft,e),e.spherical?i.code.add(x`
      const float invEllipsoidRadius = ${x.float(1/(e.ellipsoidMode===em.Earth?Ri.radius:e.ellipsoidMode===em.Mars?Yf.radius:oy.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(x`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),n&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),i.code.add(x`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${x.float(Vo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${n?e.spherical?x`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:x`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?x`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===K.Alpha&&(r.include(zu),t.include(Vu,e),t.include(tce,e),s&&r.uniforms.add(new Vt("ovColorTex",(o,a)=>cq(o,a))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?x`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===K.Color&&(r.include(zu),t.include(Vu,e),t.include(tce,e),t.include(ice,e),t.include(Zw,e),e.receiveShadows?(t.include(CU,e),r.code.add(x`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(x`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new Vt("ovColorTex",(o,a)=>cq(o,a))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?x`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?(r.uniforms.add(new xt("lightingMainIntensity",(o,a)=>a.lighting.mainLight.intensity)),r.code.add(x`
        ${e.pbrMode===Ot.Normal?x`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?r.code.add(x`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(x`vec3 shadingNormal = normalVertex;`),r.code.add(x`${e.spherical?x`vec3 normalGround = normalize(positionWorld());`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(x`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?x`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?r.code.add(x`float shadow = evaluateShadow();`):e.spherical?(r.uniforms.add(new Xe("lightingGlobalFactor",(o,a)=>a.lighting.globalFactor)),r.code.add(x`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(x`float shadow = 0.0;`),n&&r.uniforms.add(new Vt("ovNormalTex",(o,a)=>AJ(a))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(x`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(x`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${n?x`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(x`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===vt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(L_,e),r.code.add(x`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(ice,e),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===Rr.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===K.Highlight&&(t.include(Iy),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?x`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function AJ(e){return e.overlays.length===0?null:e.overlays[Ur.INNER].getValidTexture(xs.Water)}const lgt=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:V2e,build:agt,getOverlayNormalTexture:AJ},Symbol.toStringTag,{value:"Module"}));class sz extends fr{bindDraw(t,i){const r=this.program;r.bindDraw(t,i),r.rebindTextures(),t.componentParameters.type===vp.Varying&&t.componentParameters.texture.bind(r,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global,i.doublePrecisionRequiresObfuscation=b3(t.rctx)}initializeProgram(t){const i=sz.shader.get(),r=i.build(this.configuration);return new nr(t.rctx,r,i.attributeLocations)}_setPipelineState(t){const i=this.configuration,r=i.integratedMeshMode!==yu.None,s=t===vt.NONE,n=t===vt.FrontFace;return Ut({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.blendingEnabled?null:s?Pu:$y(t),culling:Bk(i.cullFace),depthTest:{func:D_(t)},depthWrite:s||n?Il:null,colorWrite:ti,stencilWrite:r||i.hasOccludees?ym:null,stencilTest:r?jit(Cl.IntegratedMeshMaskExcluded):i.hasOccludees?N_:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:pU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}sz.shader=new sr(lgt,()=>import("./ComponentShader.glsl.034ea07d.js"));class cgt extends Ys{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class MJ{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Wr(e={}){return(t,i)=>{var s;const r=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=r+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[r]},set(o){const a=this[r];if(a==null)this[r]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[r]},set(n){this[r]!==n&&(e.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function rce(){return(e,t)=>{var r;const i=(r=e._parameterCount)!=null?r:0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(s){this[i]!==s&&(this[i]=s,this._setDirty())}})}}class nz{constructor(t){this._low=Ci(),this._high=Ci(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const i=this._low,r=this._high;le(i,t),Tc(r,t,i)}setElements(t,i,r){ne(sce,t,i,r),this.set(sce)}get(t){return de(t,this._low,this._high)}getLowScaled(t){return ce(t,this._low,1)}}const sce=R();class Dn extends cgt{constructor(t,i){super(),this.toMapSpace=i,this.baseColor=rd(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=$i(1,1,.5),this.emissiveFactor=$i(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new GN,this.componentParameters=new HO,this.textureAlphaCutoff=B4,this.alphaDiscardMode=ur.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=em.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new oi;const r=new nz(t.position),s=zSe(t.rotationScale);yx(s,s),this.transformNormalGlobalFromModel=Kh(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=er(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return _(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return _(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return _(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return _(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return _(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetalnessAndRoughnessTexture=_(this.metallicRoughnessTexture),n.hasEmissionTexture=_(this.emissionTexture),n.hasOcclusionTexture=_(this.occlusionTexture),n.hasNormalTexture=_(this.normalTexture),n.transparencyPassType=i.identifier===wu.Material&&r.transparencyPassType!=null?r.transparencyPassType:vt.NONE,n.hasMultipassTerrain=i.identifier===wu.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===wu.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Gr.View:Gr.None,n.hasBaseColorTexture=_(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Ra.Transparent||o===Ra.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?dgt(r)?AJ(r)?yu.ColorOverlayWithWater:yu.ColorOverlay:yu.NoOverlay:yu.None,n.isGround=this.isIntegratedMesh,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&M(this.baseColorTexture);return n.pbrMode=n.integratedMeshMode===yu.ColorOverlayWithWater?Ot.WaterOnIntegratedMesh:this.usePBR?a?Ot.Schematic:Ot.Normal:Ot.Disabled,n.normalType=n.integratedMeshMode===yu.None?n.hasNormals?Rr.CompressedAttribute:Rr.ScreenDerivative:Rr.Ground,n.hasSlicePlane=_(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===wu.ShadowMap?(n.output=K.Shadow,n.vertexDiscardMode=Uh.None):i.identifier===wu.Highlight?(n.output=K.Highlight,n.vertexDiscardMode=Uh.None):(this._computeWhichMaterialPass()===Ra.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?Uh.Opaque:Uh.Transparent:n.vertexDiscardMode=Uh.None,n.output=ugt(i.subPass),i.subPass===oo.Alpha&&(n.hasOccludees=r.hasOccludees),i.subPass===oo.Color?(n.receiveAmbientOcclusion=r.ssaoHelper.ready,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=_(r.clouds.data)):(n.receiveAmbientOcclusion=!1,n.receiveShadows=!1),n.snowCover=this.hasSnowCover(r)),this._technique=t.releaseAndAcquire(sz,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ra.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case Ra.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case Ra.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case Ra.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),hgt(i)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==bn.None;h&&t.shadowMap.submitDraw(this,s,a,o),_(l)&&(t.highlight.submitDraw(this,s,l,o),h&&t.highlightShadowMap.submitDraw(this,s,l,o)),h&&_(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}get attributeLocations(){return V2e}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ra.IntegratedMesh:this.objectOpacity<1?Ra.Transparent:this.componentParameters.opaqueOverride===bn.All?Ra.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===ur.Blend||this.alphaDiscardMode===ur.MaskBlend?Ra.Transparent:this.componentParameters.transparent===bn.None?Ra.Opaque:this.componentParameters.transparent===bn.All?Ra.Transparent:Ra.OpaqueAndTransparent}}var nce,Ra,bn;u([Wr({vectorOps:cde})],Dn.prototype,"baseColor",void 0),u([Wr()],Dn.prototype,"usePBR",void 0),u([Wr()],Dn.prototype,"hasParametersFromSource",void 0),u([Wr({vectorOps:bK})],Dn.prototype,"mrrFactors",void 0),u([Wr({vectorOps:bK})],Dn.prototype,"emissiveFactor",void 0),u([Wr({dispose:!0})],Dn.prototype,"baseColorTexture",void 0),u([Wr({dispose:!0})],Dn.prototype,"metallicRoughnessTexture",void 0),u([Wr({dispose:!0})],Dn.prototype,"emissionTexture",void 0),u([Wr({dispose:!0})],Dn.prototype,"occlusionTexture",void 0),u([Wr({dispose:!0})],Dn.prototype,"normalTexture",void 0),u([Wr()],Dn.prototype,"objectOpacity",void 0),u([rce()],Dn.prototype,"commonMaterialParameters",void 0),u([rce()],Dn.prototype,"componentParameters",void 0),u([Wr()],Dn.prototype,"textureAlphaCutoff",void 0),u([Wr()],Dn.prototype,"alphaDiscardMode",void 0),u([Wr()],Dn.prototype,"isIntegratedMesh",void 0),u([Wr()],Dn.prototype,"polygonOffsetEnabled",void 0),u([Wr()],Dn.prototype,"ellipsoidMode",void 0),u([Wr()],Dn.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(nce||(nce={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(Ra||(Ra={}));class GN extends MJ{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=dr.Back,this.hasSlicePlane=!0}}u([Wr()],GN.prototype,"doubleSided",void 0),u([Wr()],GN.prototype,"cullFace",void 0),u([Wr()],GN.prototype,"hasSlicePlane",void 0);class HO extends MJ{constructor(){super(...arguments),this.externalColor=rd(1,1,1,1),this.externalColorMixMode=Ss.Multiply,this.castShadows=bn.All}get transparent(){return this.externalColor[3]<1?bn.All:bn.None}get opaqueOverride(){return this.externalColorMixMode===Ss.Replace&&this.externalColor[3]===1?bn.All:bn.None}get visible(){return this.externalColor[3]>0?bn.All:bn.None}get type(){return vp.Uniform}}u([Wr({vectorOps:cde})],HO.prototype,"externalColor",void 0),u([Wr()],HO.prototype,"externalColorMixMode",void 0),u([Wr()],HO.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(bn||(bn={}));class WM extends MJ{constructor(){super(...arguments),this.texture=null,this.transparent=bn.None,this.opaqueOverride=bn.None,this.castShadows=bn.None}get type(){return vp.Varying}}function ugt(e){switch(e){case oo.Color:return K.Color;case oo.Alpha:return K.Alpha;case oo.Depth:return K.Depth;case oo.Normal:return K.Normal}}function hgt(e){return e.overlays.length!==0&&_(e.overlays[Ur.INNER].getValidTexture(xs.Highlight))}function dgt(e){return e.overlays.length!==0&&_(e.overlays[Ur.INNER].getColorTextureNoRasterImage())}u([Wr()],WM.prototype,"texture",void 0),u([Wr()],WM.prototype,"transparent",void 0),u([Wr()],WM.prototype,"opaqueOverride",void 0),u([Wr()],WM.prototype,"castShadows",void 0);const _P=ls().vec3f(O.POSITION).u16(O.COMPONENTINDEX).u16(O.U16PADDING),B2e=ls().vec2u8(O.SIDENESS),oce=Dc(B2e),G2e=ls().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).u8(O.U8PADDING,{glPadding:!0}).u16(O.U16PADDING,{glPadding:!0}),vq=G2e.clone().vec3f(O.NORMAL),_q=G2e.clone().vec3f(O.NORMALA).vec3f(O.NORMALB),bq=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMAL,6],[O.NORMALA,6],[O.NORMALB,7],[O.SIDENESS,8]]);function ace(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(b,S)=>{b<S?s[b+1]++:n[S+1]++};for(let b=0;b<r;b++){const S=e[3*b],T=e[3*b+1],E=e[3*b+2];o(S,T),o(T,E),o(E,S)}let a=0,l=0;for(let b=0;b<i;b++){const S=s[b+1],T=n[b+1];s[b+1]=a,n[b+1]=l,a+=S,l+=T}const c=new Uint32Array(6*r),h=s[i],p=(b,S,T)=>{if(b<S){const E=s[b+1]++;c[2*E]=S,c[2*E+1]=T}else{const E=n[S+1]++;c[2*h+2*E]=b,c[2*h+2*E+1]=T}};for(let b=0;b<r;b++){const S=e[3*b],T=e[3*b+1],E=e[3*b+2];p(S,T,b),p(T,E,b),p(E,S,b)}const f=(b,S)=>{const T=2*b,E=S-b;for(let C=1;C<E;C++){const A=c[T+2*C],I=c[T+2*C+1];let L=C-1;for(;L>=0&&c[T+2*L]>A;L--)c[T+2*L+2]=c[T+2*L],c[T+2*L+3]=c[T+2*L+1];c[T+2*L+2]=A,c[T+2*L+3]=I}};for(let b=0;b<i;b++)f(s[b],s[b+1]),f(h+n[b],h+n[b+1]);const m=new Int32Array(3*r),y=(b,S)=>b===e[3*S]?0:b===e[3*S+1]?1:b===e[3*S+2]?2:-1,v=(b,S)=>{const T=y(b,S);m[3*S+T]=-1},w=(b,S,T,E)=>{const C=y(b,S);m[3*S+C]=E;const A=y(T,E);m[3*E+A]=S};for(let b=0;b<i;b++){let S=s[b];const T=s[b+1];let E=n[b];const C=n[b+1];for(;S<T&&E<C;){const A=c[2*S],I=c[2*h+2*E];A===I?(w(b,c[2*S+1],I,c[2*h+2*E+1]),S++,E++):A<I?(v(b,c[2*S+1]),S++):(v(I,c[2*h+2*E+1]),E++)}for(;S<T;)v(b,c[2*S+1]),S++;for(;E<C;)v(c[2*h+2*E],c[2*h+2*E+1]),E++}return m}function p5(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:pgt(e.layout)}}function LD(e){return fgt(e.layout).createView(e.buffer)}function pgt(e){const t=new Array;return e.fields.forEach((i,r)=>{const s=me(F({},i),{constructor:j2e(i.constructor)});t.push([r,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function fgt(e){const t=ls();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(i=>t.fields.set(i[0],me(F({},i[1]),{constructor:ggt(i[1].constructor)}))),t}const mgt=[o3,ed,Hi,jn,Ap,dE,pE,fE,Cs,Uw,h_,d_,gy,zw,p_,$l,Vw,mE,Bw,f_,Gw,gE,kR,UR,yE,jw,zR,VR,BR,Hw,GR,jR,HR,qR,WR,XR];function j2e(e){return`${e.ElementType}_${e.ElementCount}`}function ggt(e){return H2e.get(e)}const H2e=new Map;mgt.forEach(e=>H2e.set(j2e(e),e));class q2e{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?vgt:ygt}write(t,i,r){const s=this.edgeHashFunction(r);FD.seed=s;const n=FD.getIntRange(0,255),o=FD.getIntRange(0,this.settings.variants-1),a=.7,l=FD.getFloat(),c=255*(.5*_gt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex),t.variantOffset.set(i,n),t.variantStroke.set(i,o),t.variantExtension.set(i,c)}trim(t,i){return t.slice(0,i)}}const OJ=new Float32Array(6),f5=new Uint32Array(OJ.buffer),Bv=new Uint32Array(1);function ygt(e){const t=OJ;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],Bv[0]=5381;for(let i=0;i<f5.length;i++)Bv[0]=31*Bv[0]+f5[i];return Bv[0]}function vgt(e){const t=OJ;t[0]=vT(e.position0[0]),t[1]=vT(e.position0[1]),t[2]=vT(e.position0[2]),t[3]=vT(e.position1[0]),t[4]=vT(e.position1[1]),t[5]=vT(e.position1[2]),Bv[0]=5381;for(let i=0;i<f5.length;i++)Bv[0]=31*Bv[0]+f5[i];return Bv[0]}const lce=1e4;function vT(e){return Math.round(e*lce)/lce}function _gt(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class m5{constructor(){this.commonWriter=new q2e}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return vq.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),de(ND,r.faceNormal0,r.faceNormal1),we(ND,ND),t.normal.setVec(i,ND)}trim(t,i){return this.commonWriter.trim(t,i)}}m5.Layout=vq,m5.glLayout=Dc(vq,1);class g5{constructor(){this.commonWriter=new q2e}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return _q.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),t.normalA.setVec(i,r.faceNormal0),t.normalB.setVec(i,r.faceNormal1)}trim(t,i){return this.commonWriter.trim(t,i)}}g5.Layout=_q,g5.glLayout=Dc(_q,1);const ND=R(),FD=new Oh,mb=-1;var y5;function wq(e,t,i,r=Egt){const s=e.vertices.position,n=e.vertices.componentIndex,o=Dt(r.anglePlanar),a=Dt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=xq.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,v=Sgt(e),w=Tgt(e),b=w.length/4,S=t.allocate(b);let T=0;const E=b,C=i.allocate(E);let A=0,I=0,L=0;const D=LCe(0,b),U=new Float32Array(b);kCe(U,(ae,re,$)=>{s.getVec(w[4*re+0],p),s.getVec(w[4*re+1],f),$[re]=hr(p,f)}),D.sort((ae,re)=>U[re]-U[ae]);const z=new Array,V=new Array;for(let ae=0;ae<b;ae++){const re=D[ae],$=U[re],k=w[4*re+0],B=w[4*re+1],H=w[4*re+2],Y=w[4*re+3],ee=Y===mb;if(s.getVec(k,p),s.getVec(B,f),ee)ne(m,v[3*H+0],v[3*H+1],v[3*H+2]),le(y,m),h.componentIndex=n.get(k),h.cosAngle=Te(m,y);else{if(ne(m,v[3*H+0],v[3*H+1],v[3*H+2]),ne(y,v[3*Y+0],v[3*Y+1],v[3*Y+2]),h.componentIndex=n.get(k),h.cosAngle=Te(m,y),wgt(h,c))continue;h.cosAngle<-.9999&&le(y,m)}I+=$,L++,ee||bgt(h,l)?(t.write(S,T++,h),z.push($)):xgt(h,o)&&(i.write(C,A++,h),V.push($))}const X=new Float32Array(z.reverse()),Z=new Float32Array(V.reverse());return{regular:{instancesData:t.trim(S,T),lodInfo:{lengths:X}},silhouette:{instancesData:i.trim(C,A),lodInfo:{lengths:Z}},averageEdgeLength:I/L}}function bgt(e,t){return e.cosAngle<t}function wgt(e,t){return e.cosAngle>t}function xgt(e,t){const i=pn(e.cosAngle),r=xq.fwd,s=xq.ortho;return wy(r,e.position1,e.position0),i*(Te(ct(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function Tgt(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];s+=l===mb||p<f?1:0,s+=c===mb||f<m?1:0,s+=h===mb||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];(l===mb||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===mb||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===mb||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function Sgt(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=u8.v0,n=u8.v1,o=u8.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(p,o),pe(n,n,s),pe(o,o,s),ct(s,n,o),we(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(y5||(y5={}));const xq={edge:{position0:R(),position1:R(),faceNormal0:R(),faceNormal1:R(),componentIndex:0,cosAngle:0},ortho:R(),fwd:R()},u8={v0:R(),v1:R(),v2:R()},Egt={anglePlanar:4,angleSignificantEdge:35};class W2e{async extract(t){const i=h8(t),r=RJ(i),s=[i.data.buffer];return{result:Cgt(r,s),transferList:s}}async extractComponentsEdgeLocations(t){const i=h8(t),r=Tq(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=wq(r,Rgt,hce),n=[];return{result:p5(s.regular.instancesData,n),transferList:n}}async extractEdgeLocations(t){const i=h8(t),r=Tq(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=wq(r,Ogt,hce),n=[];return{result:p5(s.regular.instancesData,n),transferList:n}}}function RJ(e){const t=Tq(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return cce.updateSettings(e.writerSettings),uce.updateSettings(e.writerSettings),wq(t,cce,uce)}function h8(e){return{data:_P.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function Cgt(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:p5(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:p5(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function Tq(e,t,i,r){if(t)return{faces:i,facesLength:r,neighbors:ace(i,r,e.count),vertices:e};const s=kxe(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:r}),n=ace(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:_P.createView(s.buffer)}}const cce=new m5,uce=new g5;class Agt{allocate(t){return X2e.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1)}}class Mgt{allocate(t){return PJ.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex)}}const Ogt=new Agt,Rgt=new Mgt,hce={allocate:()=>null,write:()=>{},trim:()=>null},X2e=ls().vec3f(O.POSITION0).vec3f(O.POSITION1),PJ=ls().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u16(O.U16PADDING,{glPadding:!0});function Pgt(){return new W2e}var Igt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",EdgeProcessingWorker:W2e,default:Pgt,extract:RJ,extractComponentsEdgeLocationsLayout:PJ,extractEdgeLocationsLayout:X2e});class $gt{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class Dgt{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.textureWidth=4096,this.dirty=!0,this.texture=new ot(this.rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new $l(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,i,r,s,n,o){const a=t*this.fieldCount+i;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,s),this.data.set(a,2,n),this.data.set(a,3,o)}setDataElement(t,i,r,s){const n=t*this.fieldCount+i;this.dirty=!0,this.data.set(n,r,s)}resizeToFit(t){const i=t*this.fieldCount;if(i>=this.data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new $l(new ArrayBuffer(4*r));s.typedBuffer.set(this.data.typedBuffer),this.data=s}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,i=this.texture.descriptor.height;this.data.count>t*i&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,i,r){t.bindTexture(i,this.texture),t.setUniform2f(r,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const Y2e=65536;class Lgt{constructor(t,i=1){this.textureBuffer=new Dgt(t,i),this.indexManager=new $gt(Y2e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class Z2e{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const r of this.buffers)if(r.availableCount>=t)return r;if(t>Y2e)return null;const i=new Lgt(this.rctx,this.fieldCount);return this.buffers.push(i),i}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const dce=ge.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Ngt{constructor(t,i){this._renderManager=t,this._viewingMode=i,this._objects=[new Gt,new Gt],this._renderSubmit=new Kmt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new Z2e(t.rctx,2)}dispose(){pt(this._objects[_2.Hidden].length===0&&this._objects[_2.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const i=new gq;return i.toMapSpace=t.toMapSpace,i.transform=t.transform,i.obb=Hle(t.obb),i.components=new Lmt(this._componentBufferManager,t.geometry.componentOffsets),i.renderable=this._createRenderable(t,i.components),i.intersectionGeometry=new Bmt(t.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(t){const i=t;this._objects[i.visible].removeUnordered(i),i.dispose(),this._notifyDirty()}setObjectVisibility(t,i){const r=t;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(t){const i=t.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Gs(i,r.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,i){const r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){const r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){const i=t,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){const r=t,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:oJ(),externalColorMixMode:Ss.Multiply,elevationOffset:0},c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,v=n.verticalOffsets,w=1/0,b=-1/0,S=!1,T=!1,E=0;for(let C=0;C<n.count;C++)i(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Ss.Replace&&l.externalColor[3]===1),y+=+l.castShadows,ETe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[C],0,h[0],h[1],h[2],h[3]),S||(S=C>0&&E!==p[0]),E=p[0],T||(T=l.elevationOffset!==0),T&&M(v)&&(v=new Array(C).fill(0)),_(v)&&(v[C]=l.elevationOffset),w=Math.min(w,l.elevationOffset),b=Math.max(b,l.elevationOffset),z2e(l.elevationOffset,h),c.setData(a[C],1,h[0],h[1],h[2],h[3]),l.pickable!==N2e(n.pickability,C)&&(n.pickability=Fmt(n.pickability,n.count,C,l.pickable));n.verticalOffsets=T?v:null,r.offsetObb=T?Cmt(r.obb,w,b,this._viewingMode,_(r.offsetObb)?r.offsetObb:Hle(r.obb)):null,S||T?(s.componentParameters=new WM,s.componentParameters.castShadows=d8(y,n.count),s.componentParameters.transparent=d8(f,n.count),s.componentParameters.opaqueOverride=d8(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new HO,s.componentParameters.castShadows=l.castShadows?bn.All:bn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,i,r,s=!1){t.intersectionGeometry.getComponentAabb(i,r);const n=t,o=n.components.verticalOffsets;if(s||M(o))return r;const a=o[i];if(this._viewingMode===Ve.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=VYe(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}intersect(t,i,r,s,n,o){const a=t;_(n)&&(n.localOrigin=a.transform.position);const l=yx(pce,a.transform.rotationScale);Tc(kD,i,a.transform.position),Tc(UD,r,a.transform.position),fc(kD,kD,l),fc(UD,UD,l);const c=Kh(pce,l);return a.intersectionGeometry.intersect(kD,UD,s,c,n,a.components.verticalOffsets,o)}addEdges(t,i,r,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(t,n.transform,{center:n.obb.center,radius:omt(n.obb)},a,o,l,r,s)}async extractEdgeInformation(t,i,r){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:PJ.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=_P.createBuffer(a.count);zU(c.position,a),x_(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:Bs(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(t,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,i,r,s){if(t&&i.allVisible())return t;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let f=h;f<p;f++)o[a++]=t?t[f]:f;return!0}),o}addComponentHighlight(t,i){const r=t.components;M(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(t,i){const r=t.components;if(M(r.highlightCounts))return void dce.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else dce.warn("Removing non-existing highlight.")}clearHighlights(t){const i=t.components;_(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[_2.Visible]}_createRenderable(t,i){const r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=si.createVertex(r,_i.STATIC_DRAW,s.vertices.data),a=Qi(s.indices,v=>si.createIndex(r,_i.STATIC_DRAW,v)),l=Dc(egt(n)),c=new Uint16Array(s.vertices.count);for(let v=0;v<i.count;v++){const w=i.offsets[v],b=i.offsets[v+1],S=i.materialDataIndices[v];if(_(s.indices))for(let T=w;T<b;T++)c[s.indices[T]]=S;else for(let T=w;T<b;T++)c[T]=S}const h=si.createVertex(r,_i.STATIC_DRAW,c.buffer),p=new Dn(t.transform,t.toMapSpace),f=new qs(r,p.attributeLocations,{data:l,componentIndices:Fgt},{data:o,componentIndices:h},a),m=new k2e(f,It.TRIANGLES,n,_(a)),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(_(a)?a.byteSize:0)};return new Hmt(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const Fgt=Dc(ls().u16(O.COMPONENTINDEX));function d8(e,t){return e===t?bn.All:e===0?bn.None:bn.Some}const pce=ey(),kD=R(),UD=R();class Q2e extends Ys{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function kgt(e){const t=new qi;t.include($_);const i=t.fragment;switch(e.function){case pc.Standard:i.uniforms.add(new Vt("tex",r=>r.texture)),e.hasOpacityFactor?(i.uniforms.add(new Xe("opacity",r=>r.opacity)),i.code.add(x`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):i.code.add(x`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case pc.OverlayWithTransparency:i.uniforms.add(new Vt("tex",r=>r.texture)),i.uniforms.add(new x3("overlayIdx",r=>r.overlayIndex)),e.hasOpacityFactor&&i.uniforms.add(new Xe("opacity",r=>r.opacity)),i.code.add(x`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case pc.TransparentToHUDVisibility:i.uniforms.add(new Vt("tex",r=>r.texture)),i.code.add(x`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case pc.Transparency:i.uniforms.add([new Vt("colorTexture",r=>r.colorTexture),new Vt("alphaTexture",r=>r.alphaTexture),new Vt("frontFaceTexture",r=>r.frontFaceTexture)]),i.code.add(x`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case pc.COUNT:break;default:e.function}return t}const Ugt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:Q2e,build:kgt},Symbol.toStringTag,{value:"Module"}));class bP extends fr{initializeProgram(t){const i=bP.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){if(this.configuration.function===pc.TransparentToHUDVisibility)return Ut({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case No.None:return Ut({colorWrite:ti});case No.Alpha:return Ut({blending:bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),colorWrite:ti});default:return Ut({blending:Am(Me.ONE,Me.ONE_MINUS_SRC_ALPHA),colorWrite:ti})}}}bP.shader=new sr(Ugt,()=>import("./Compositing.glsl.5ee28631.js"));class zgt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._configuration=new TN,this._passParameters=new Q2e}dispose(){this._vao=Qe(this._vao)}compositeTransparent(t,i,r,s,n=1){this._configuration.alphaMode=No.Alpha,this._configuration.function=pc.Transparency,this._configuration.hasOpacityFactor=n!==1,this._passParameters.colorTexture=i,this._passParameters.alphaTexture=r,this._passParameters.frontFaceTexture=s;const o=this._rctx,a=this._techniqueRepository.acquire(bP,this._configuration);o.bindTechnique(a,this._passParameters,t);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(It.TRIANGLE_STRIP,0,ko(l,"geometry")),a.release()}composite(t,i,r=No.None,s=1,n=pc.Standard,o=Ur.INNER){const a=this._rctx;this._configuration.alphaMode=r,this._configuration.function=n,this._configuration.hasOpacityFactor=s!==1,this._passParameters.overlayIndex=o,this._passParameters.texture=i,this._passParameters.opacity=s;const l=this._techniqueRepository.acquire(bP,this._configuration);a.bindTechnique(l,this._passParameters,t);const c=this._ensureVAO();a.bindVAO(c),a.drawArrays(It.TRIANGLE_STRIP,0,ko(c,"geometry")),l.release()}_ensureVAO(){return M(this._vao)&&(this._vao=qa(this._rctx)),this._vao}}const Vgt=1e4,Sq=100,Bgt=500,Ggt=500,jgt=.1;function Hgt(e,t,i){return wQ(t,e)*(i[1]-i[0])+i[0]}function qgt(e,t,i){if(t.size<Vgt)return eyt.compute(e,t);const r=A3();return i.forAll(s=>{s.isVisible&&LE(r,Wgt(e,s))}),r}function Wgt(e,t){if(!t.isVisible)return;const i=A3(),r=t.getSpatialQueryAccelerator();return _(r)?Xgt(i,e,r):Ygt(i,e,t.objects),i}function Xgt(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.isVisible,a=i.objectCount;if(a<Bgt)vP(Ch,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,dp.DepthOrder.FRONT_TO_BACK,Ch,(l,c)=>{Eq(e,t,l),Ch.far=e.near,c.setRange(Ch)},n,o),vP(Ch,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,dp.DepthOrder.BACK_TO_FRONT,Ch,(l,c)=>{Eq(e,t,l),Ch.near=e.far,c.setRange(Ch)},n,o);else{const l=Math.max(Math.min(a,Ggt),Math.ceil(a*jgt)),c=i.findClosest(s,dp.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,dp.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(fce(e,t,c.boundingVolumeWorldSpace.bounds),fce(e,t,h.boundingVolumeWorldSpace.bounds))}}function Ygt(e,t,i){_T.clear(),i.forAll(r=>{r.isVisible&&r.geometryRecords.length!==0&&_T.add(r)}),_T.empty||(_T.sort(t),vP(Ch,t.near,Math.min(e.near,t.far)),_T.forEachInDepthRange(Ch,dp.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<e.near&&Eq(e,t,r)}),vP(Ch,Math.max(e.far,t.near),t.far),_T.forEachInDepthRange(Ch,dp.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function Eq(e,t,i){if(!i.isVisible||!Fv(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=Kgt;i.geometryRecords.forEach(n=>{jr(s,r,n.getShaderTransformation());const o=Rw(s);J2e(e,t,n.geometry.boundingInfo,s,o)})}function J2e(e,t,i,r,s){if(M(i))return;const n=t.eye,o=t.viewForward;ke(Do,i.center,r);const a=o[0]*(Do[0]-n[0])+o[1]*(Do[1]-n[1])+o[2]*(Do[2]-n[2]);if(Do[3]=i.radius*s,!(a-Do[3]>e.near&&a+Do[3]<e.far)&&Fv(t.frustum,Do))if(i.radius>Sq&&i.getChildren()){const l=i.getChildren();for(let c=0;c<8;++c)l[c]&&J2e(e,t,l[c],r,s)}else Cq.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function fce(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}class Zgt{constructor(){this._items=new Gt({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const i=t.eye,r=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===dp.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}}}class Qgt{constructor(){this.view=Ae(),this.viewProj=Ae(),this.frustum=QR(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,i){this._reset(),Ts(this.view,t.viewMatrix),jr(this.viewProj,t.projectionMatrix,this.view),A4(this.frustum,t.frustum);const r=this.view,s=r[2],n=r[6],o=r[10],a=r[14],l=this.range;let c=0;if(i.forEach(m=>{if(!m.instanceParameters.visible||!m.castShadow)return;let y;m.hasShaderTransformation?(m.computeBoundingSphere(m.getShaderTransformation(),Do,1),y=Do):y=m.boundingSphere;const v=s*y[0]+n*y[1]+o*y[2]+a,w=v-y[3],b=v+y[3];this.geometries[c]=m,this.near[c]=-b,this.far[c]=-w,++c}),this.geometries.length===0)return l;for(let m=0;m<this.geometries.length;++m)this.near[m]>l.far&&(l.far=this.near[m]),this.near[m]>2&&this.far[m]<l.near&&(l.near=this.far[m]);const h=this.looseRange;h.near=Math.max(.5*l.near,2),h.far=2*l.far;let p=0,f=0;for(let m=0;m<this.geometries.length;++m)this.near[m]<l.near&&(this.near[m]>=h.near?l.near=this.near[m]:this.nearCandidates[p++]=m),this.far[m]>l.far&&(this.far[m]<=h.far?l.far=this.far[m]:this.farCandidates[f++]=m);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return l;this.nearCandidates.sort((m,y)=>this.near[m]<this.near[y]?-1:this.near[m]>this.near[y]?1:0),this.farCandidates.sort((m,y)=>this.far[m]<this.far[y]?1:this.far[m]>this.far[y]?-1:0);for(let m=0;m<this.nearCandidates.length;++m){const y=this.nearCandidates[m];if(this.near[y]<l.near){const v=this.geometries[y],w=v.boundingInfo;this._includeNearBoundingInfoRec(w,v.getShaderTransformation())}}for(let m=0;m<this.farCandidates.length;++m){const y=this.farCandidates[m];if(this.far[y]>l.far){const v=this.geometries[y],w=v.boundingInfo;this._includeFarBoundingInfoRec(w,v.getShaderTransformation())}}return l}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,i){if(M(t))return;const r=t.getCenter();ke(Do,r,i);const s=Rw(i),n=Do[0],o=Do[1],a=Do[2],l=t.getBSRadius()*s,c=this.frustum;if(c[0][0]*n+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*n+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*n+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*n+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const h=this.view[2]*n+this.view[6]*o+this.view[10]*a+this.view[14],p=h+l;if(!(-(h-l)<2||-p>=this.range.near))if(-p>this.looseRange.near)this.range.near=-p;else{if(l>Sq){const f=t.getChildren();if(f!==void 0){for(let m=0;m<8;++m)f[m]!==void 0&&this._includeNearBoundingInfoRec(f[m],i);return}}Cq.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,i){if(M(t))return;let r=t.getBSRadius();const s=t.getCenter();ke(Do,s,i);const n=Rw(i),o=Do[0],a=Do[1],l=Do[2];r*=n;const c=this.frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>r||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>r||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>r||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>r)return;const h=this.view[2]*o+this.view[6]*a+this.view[10]*l+this.view[14]-r;if(!(-h<=this.range.far))if(-h<this.looseRange.far)this.range.far=-h;else{if(r>Sq){const p=t.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&this._includeFarBoundingInfoRec(p[f],i);return}}Cq.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}}class Jgt{constructor(){this.modelViewProj=Ae(),this.clipPosition=[Ht(),Ht(),Ht(),Ht(),Ht(),Ht(),Ht(),Ht()]}unionDepthRangeWithAABB(t,i,r,s,n){const o=this.modelViewProj;jr(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this.clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this.clipPosition[p8[l][0]],h=this.clipPosition[p8[l][1]],p=this.clipPosition[p8[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const v=f[y][3];v<t.near&&(t.near=v),v>t.far&&(t.far=v)}}}return a}_inside(t,i){return i===0?t[0]>=-t[3]:i===1?t[1]>=-t[3]:i===2?t[0]<=t[3]:i===3?t[1]<=t[3]:void pt(!1)}_intersect(t,i,r){let s=0;return r===0?s=(-t[3]-t[0])/(i[0]-t[0]+i[3]-t[3]):r===1?s=(-t[3]-t[1])/(i[1]-t[1]+i[3]-t[3]):r===2?s=(t[3]-t[0])/(i[0]-t[0]-i[3]+t[3]):r===3&&(s=(t[3]-t[1])/(i[1]-t[1]-i[3]+t[3])),F5(Ht(),t,i,s)}_clipTriangle(t,i,r){let s=[t,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const p8=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Do=Cn(),Kgt=Ae(),Ch=A3(),_T=new Zgt,eyt=new Qgt,Cq=new Jgt;class tyt extends Ys{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function iyt(){const e=new qi;return e.attributes.add(O.POSITION,"vec2"),e.vertex.uniforms.add(new Ua("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(x`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new Vr("textureInput")),e.fragment.uniforms.add(new Vr("textureMask")),e.fragment.uniforms.add(new Vr("textureOverlay")),e.fragment.uniforms.add(new kw("maskEnabled",t=>t.maskEnabled)),e.fragment.uniforms.add(new kw("overlayEnabled",t=>t.overlayEnabled)),e.fragment.code.add(x`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function ryt(e){const t=import("./mask-svg.d736db49.js"),i=import("./overlay-svg.ddc1dd43.js"),r=Cp((await t).default,{signal:e}),s=Cp((await i).default,{signal:e}),n={mask:await r,overlay:await s};return ci(e),n}let cS=class extends Se{constructor(){super(...arguments),this._handles=new jt,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new tyt,this.events=new as,this.attributeLocations=new Map([[O.POSITION,0]]),this.tmpScreenPoint=Yr(),this.tmpRenderPoint=rPe()}get updating(){return M(this._imageSources)&&_(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};_(this._magnifier)&&this._handles.add(se(()=>Qi(this._magnifier,i=>i.version),t)),t()}get enabled(){return _(this._validMagnifier)}get _validMagnifier(){return _(this._magnifier)&&this._magnifier.visible&&_(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return _(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),_(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if(M(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),M(this._resources))return;this._passParameters.maskEnabled=i.maskEnabled,this._passParameters.overlayEnabled=i.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,t);const o=this._resources.textures,a=Math.ceil(1/this.factor*s);o.input.resize(a,a);const l=t.camera.fullWidth,c=t.camera.fullHeight;Lg(i.position,this.tmpScreenPoint);const h=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),p=.5*a,f=.5*a;h[0]=De(h[0],p,l-p-1),h[1]=De(h[1],f,c-f-1);const m=Math.floor(h[0]-p),y=Math.floor(h[1]-f);n.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0);const v=i.offset.x*r,w=i.offset.y*r,b=(h[0]+v)/l*2-1,S=(h[1]-w)/c*2-1,T=s/l*2,E=s/c*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",o.overlay),n.bindTexture("textureMask",o.mask),n.setUniform4f("drawPosition",b,S,T,E),e.setPipelineState(this._resources.pipelineState),e.drawArrays(It.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(M(e))return;const t=e.maskUrl,i=e.overlayUrl;!_(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),_(this._imageSources)||_(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:RP(async r=>{const s=M(t)||M(i)?ryt(r):null,n=_(t)?Cp(t,{signal:r}):s.then(a=>a.mask),o=_(i)?Cp(i,{signal:r}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(_(this._resources)){if(this._resources.textures.size!==t){const r=this._createTextureResources(e,t);if(M(r))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=r}return}const i=this._createTextureResources(e,t);M(i)||(this._resources={textures:i,program:this._createProgram(e),vao:qa(e,bZ,this.attributeLocations,0,1),pipelineState:Ut({blending:Am(Me.ONE,Me.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ti})})}_disposeResources(){M(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(M(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new ot(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!0,preMultiplyAlpha:!oX(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new ot(e,{target:mt.TEXTURE_2D,pixelFormat:ze.ALPHA,internalFormat:ze.ALPHA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new ot(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){return new nr(e,iyt(),this.attributeLocations)}};u([d()],cS.prototype,"_imageSources",void 0),u([d()],cS.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],cS.prototype,"updating",null),cS=u([P("esri/views/3d/webgl-engine/lib/MagnifierHelper")],cS);const syt=.5,nyt=1e3/30;var wP;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(wP||(wP={}));class g0{constructor(t,i,r=wP.FrontToBack){this._rctx=t,this._techniqueRepository=i,this._sorting=r,this._draws=new Gt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=t,n.depthSquaredHint=s,n.indexType=i.indexed?i.vao.indexBuffer.indexType:0}dispatch(t,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===vt.NONE||(r.bindTechnique(l,t,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.bindDraw(c.material,i),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=jN.get(c.indexType);for(let y=0;y<f;y+=2){const v=p[y],w=p[y+1];r.drawElements(h.primitiveType,w,c.indexType,v*m)}}else for(let m=0;m<f;m+=2){const y=p[m],v=p[m+1];r.drawArrays(h.primitiveType,y,v)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===wP.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}}const jN=new Map;jN.set(dt.UNSIGNED_BYTE,1),jN.set(dt.UNSIGNED_SHORT,2),jN.set(dt.UNSIGNED_INT,4);class oyt{constructor(t,i){this.rctx=t,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new nft,this._shadowPassParameters=new oft,this._highlightPassParameters=new aft,this._systems=new Set,this._passes={materialOpaque:new g0(t,i),materialTransparent:new g0(t,i,wP.BackToFront),materialIntegratedMesh:new g0(t,i),shadowMap:new g0(t,i),highlight:new g0(t,i),highlightIntegratedMesh:new g0(t,i),highlightShadowMap:new g0(t,i),defaultShadowMap:new g0(t,i)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,t.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case Ee.OPAQUE_MATERIAL:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=oo.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=oo.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=oo.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters)}return;case Ee.TRANSPARENT_MATERIAL:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=oo.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_ALPHA:return this._materialPassParameters.subPass=oo.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=oo.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=oo.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Ee.INTEGRATED_MESH:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=oo.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=oo.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=oo.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL,Ee.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(t);_(s)&&LE(i,s,i)}),i}_configure(t){const i=t.pass===je.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:t.pass===je.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,i)}_updateParameters(t,i){const r=t.bindParameters.camera,s=r.viewInverseTransposeMatrix;ne(f8,s[3],s[7],s[11]),m8.set(f8),le(i.transformWorldFromViewTH,m8.high),le(i.transformWorldFromViewTL,m8.low),le(i.slicePlaneLocalOrigin,f8),Jh(i.transformViewFromCameraRelativeRS,r.viewMatrix),Ts(i.transformProjFromView,r.projectionMatrix),i.identifier===wu.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Ee.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Ee.INTEGRATED_MESH,Kh(mce,i.transformViewFromCameraRelativeRS),yx(i.transformNormalViewFromGlobal,mce))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const f8=R(),mce=Pr(),m8=new nz,ayt=8.6,lyt=.4;function cyt(){const e=new qi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(O.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(O.UV0,"vec2"),t.uniforms.add(new Vt("coverageTex",n=>n.coverageTexture)),r.add(x`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new Vt("tex",n=>n.blurColorTexture)),i.uniforms.add(new Vt("origin",n=>n.highlightColorTexture)),i.uniforms.add(new ri("uColor",n=>n.color)),i.uniforms.add(new ri("haloColor",n=>n.haloColor)),i.uniforms.add(new ri("opacities",n=>Ji(uyt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",ayt),i.constants.add("blurSize","float",lyt),s.add(x`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const uyt=Ht(),hyt=Object.freeze(Object.defineProperty({__proto__:null,build:cyt},Symbol.toStringTag,{value:"Module"}));class oz extends fr{initializeProgram(t){const i=oz.shader.get().build();return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),colorWrite:ti})}}oz.shader=new sr(hyt,()=>import("./HighlightApply.glsl.a944c126.js"));class K2e extends Ys{constructor(){super(...arguments),this.blurSize=st()}}function dyt(){const e=new qi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(O.POSITION,"vec2"),e.attributes.add(O.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new Vt("coverageTex",n=>n.coverageTexture)),i.uniforms.add(new AZ("blurSize",n=>n.blurSize)),r.add(x`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new MZ("tex",n=>n.blurInputTexture)),s.add(x`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const pyt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:K2e,build:dyt},Symbol.toStringTag,{value:"Module"}));class az extends fr{initializeProgram(t){const i=az.shader.get().build();return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({colorWrite:ti})}}az.shader=new sr(pyt,()=>import("./HighlightBlur.glsl.aa18c423.js"));class eEe extends Ys{constructor(){super(...arguments),this.invFramebufferDim=st()}}function fyt(){const e=new qi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(O.POSITION,"vec2"),r.add(x`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new MZ("tex",n=>n.inputTexture)),i.uniforms.add(new AZ("invFramebufferDim",n=>n.invFramebufferDim)),s.add(x`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const myt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:eEe,build:fyt},Symbol.toStringTag,{value:"Module"}));class lz extends fr{initializeProgram(t){const i=lz.shader.get().build();return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({colorWrite:ti})}}lz.shader=new sr(myt,()=>import("./HighlightDownsample.glsl.e1b5a164.js"));class gce extends Ys{constructor(){super(...arguments),this.color=rd(1,0,1,1),this.haloColor=rd(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=mi(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const gyt=32;class yyt{constructor(t,i){this._techniqueRep=t,this._rctx=i,this.viewportToRestore=Ht(),this._passParameters=new gce,this._downsampleDrawParameters=new eEe,this._blurDrawParameters=new K2e,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=qa(this._rctx);const t={colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE,width:0,height:0},i={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new Or(this._rctx,t,i),this.blur1Fbo=new Or(this._rctx,t,i);const r=new Ha;this._blurTechnique=this._techniqueRep.acquire(az,r),this._downsampleTechnique=this._techniqueRep.acquire(lz,r),this._applyTechnique=this._techniqueRep.acquire(oz,r)}dispose(){if(this._blurTechnique=er(this._blurTechnique),this._downsampleTechnique=er(this._downsampleTechnique),this._applyTechnique=er(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=Qe(this.blur0Fbo),this.blur1Fbo=Qe(this.blur1Fbo)}setDefaultOptions(t){this._passParameters=F(F({},new gce),t)}render(t,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=t.camera;np(this.viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this.quadVAO);let p=null;this._gridUpdateResources(i,gyt),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this.blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(tr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,di(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,ko(p,"geometry")),h.bindFramebuffer(this.blur1Fbo),h.clear(tr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,di(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,ko(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,ko(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:mt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:St.UNSIGNED_SHORT_5_6_5,samplingMode:tt.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Or(r,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let v=0;for(let w=0;w<l;w++)for(let b=0;b<c;b++)y[v+0]=(b-.5)*p*2-1,y[v+1]=(w-.5)*h*2-1,y[v+2]=b*p,y[v+3]=w*h,y[v+4]=(b+.5)*p*2-1,y[v+5]=(w-.5)*h*2-1,y[v+6]=b*p,y[v+7]=w*h,y[v+8]=(b-.5)*p*2-1,y[v+9]=(w+.5)*h*2-1,y[v+10]=b*p,y[v+11]=w*h,y[v+12]=(b-.5)*p*2-1,y[v+13]=(w+.5)*h*2-1,y[v+14]=b*p,y[v+15]=w*h,y[v+16]=(b+.5)*p*2-1,y[v+17]=(w-.5)*h*2-1,y[v+18]=b*p,y[v+19]=w*h,y[v+20]=(b+.5)*p*2-1,y[v+21]=(w+.5)*h*2-1,y[v+22]=b*p,y[v+23]=w*h,v+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new qs(r,zi,{geometry:s3},{geometry:si.createVertex(r,_i.STATIC_DRAW,y)})}}_gridComputeMipmap(t){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,t);i.bindVAO(this.quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,di(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t),i.setViewport(0,0,o,a),i.drawArrays(It.TRIANGLE_STRIP,0,ko(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(_(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(_(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)t+=i.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const vyt={dataType:St.UNSIGNED_BYTE,internalFormat:ze.RGBA},_yt={};class byt{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const i=t.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(t,i){const r=t.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),t.delete(i))}getDepthTexture(t,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(t.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null),r||(r=new ot(this.rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:St.UNSIGNED_INT_24_8,samplingMode:tt.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(t.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new rS(this.rctx,F({internalFormat:La.DEPTH_STENCIL},i)),this._depthBuffers.set(t.id,r),this._activeTargets.add(t.id)),r}getColorTexture(t,i){let r=this._colorTextures.get(t.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null)),r||(r=new ot(this.rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:tt.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return F(F({id:Tl()},_yt),t)}registerColorTarget(t={}){return F(F({id:Tl()},vyt),t)}getFramebuffer(t,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,t);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=_(r)?new Or(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.DEPTH_STENCIL_TEXTURE},o,l):new Or(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Or(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:r?Ai.DEPTH_STENCIL_RENDER_BUFFER:Ai.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,i){return`${t.id}_${i?i.id:"X"}_${t.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let t=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),t+=Fw(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),t}}class wyt{constructor(t,i){this._rctx=t,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const r=t.type===li.WEBGL2;this._renderTargetHelper=new byt(t);const s=this._renderTargetHelper;this.mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:St.FLOAT,internalFormat:r?gt.RGBA32F:ze.RGBA,samplingMode:tt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:tt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?gt.RGBA4:ze.RGBA,dataType:St.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?gt.RGBA4:ze.RGBA,dataType:St.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const i=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(tr.COLOR_BUFFER_BIT|tr.DEPTH_BUFFER_BIT|tr.STENCIL_BUFFER_BIT)}composite(t){_(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,No.None)}renderTmpAndCompositeToMain(t,i,r,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,xyt),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(t,i=!1){this.renderToTargets(t,this.hudVisibility,i?this.tmpDepth:this.mainDepth,Tyt)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),No.None,1,pc.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,i,r){let s,n;switch(i){case vt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case vt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case vt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),No.PremultipliedAlpha)}compositeOccludedOntoMain(t,i){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),No.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(t,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(tr.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,i,r,s,n=!1,o=!1){const a=this._rctx,l=this.bindTarget(i,r);let c=0;if(s){const p=Math.max(1e-13,s[3]);a.setClearColor(s[0],s[1],s[2],p),c|=tr.COLOR_BUFFER_BIT}return n&&(c|=tr.DEPTH_BUFFER_BIT),o===!1?o=0:(o===!0&&(o=255),c|=tr.STENCIL_BUFFER_BIT),c&&a.clearSafe(c,o),t(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),l}bindTarget(t,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,t,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const xyt=[0,0,0,0],Tyt=[0,1,0,1];class Syt{constructor(t){this.context=t,this._renderPlugins=new Gt,this.slots=[];for(let i=0;i<Ee.MAX_SLOTS;++i)this.slots[i]=[]}add(t,i,r){const s=()=>{if(r==null?void 0:r.aborted)throw i.uninitializeRenderContext(),hi();this._renderPlugins.push(i);for(const o of t)this.slots[o].push(i);this.context.requestRender()},n=i.initializeRenderContext(this.context,r);if(Bu(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let i=0;i<this.slots.length;++i)this.slots[i]=this.slots[i].filter(r=>r!==t);t.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(t)||i)}),i}render(){const t=this.slots[this.context.renderContext.bindParameters.slot],i=new Array;t.filter(r=>{if(!r.canRender)return!1;if(Eyt(r)){const s=r.prepareTechnique(this.context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this.context.renderContext,i[s]))}queryDepthRange(t){const i=Cyt;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(t);s&&LE(i,s,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[Ee.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,i)=>t|i.renderOccludedFlags,0)}}function Eyt(e){return"prepareTechnique"in e}const Cyt={near:0,far:0};class tEe extends aTe{}const cz=255,Ayt=1/cz;function Myt(){const e=new qi,t=e.fragment;return t.include($c),t.include(zu),e.include(RU),e.include($_),e.include(CU,{receiveShadows:!0}),t.uniforms.add([new Vt("depthMap",i=>i.linearDepthTexture),new Er("inverseViewMatrix",(i,r)=>vs(yce,ja(yce,r.camera.viewMatrix,r.camera.center))),new pi("nearFar",(i,r)=>r.camera.nearFar)]),t.constants.add("sampleValue","float",Ayt),t.code.add(x`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const yce=Ae(),Oyt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:tEe,shadowCastMaxSamples:cz,build:Myt},Symbol.toStringTag,{value:"Module"}));var ex;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(ex||(ex={}));class Aq extends Ha{constructor(){super(...arguments),this.visualization=ex.Gradient,this.bandsEnabled=!1}}u([j({count:ex.COUNT})],Aq.prototype,"visualization",void 0),u([j()],Aq.prototype,"bandsEnabled",void 0);function Ryt(e){const t=new qi,i=t.fragment;i.include($c),i.include(zu),t.include(RU),t.include($_);const{visualization:r,bandsEnabled:s}=e;i.constants.add("inverseSampleValue","float",cz),i.uniforms.add([new Vt("shadowCastMap",a=>a.shadowCastMap),new Xe("sampleScale",a=>a.sampleScale),new Xe("opacityFromElevation",a=>a.opacityFromElevation),new ri("uColor",a=>a.color)]);const n=r===ex.Gradient,o=r===ex.Threshold;return n&&s?i.uniforms.add(new Xe("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new Xe("threshold",a=>a.threshold)),i.code.add(x`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?x`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?x`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?x`* strength`:""});
      }
    `),t}const Pyt=Object.freeze(Object.defineProperty({__proto__:null,build:Ryt},Symbol.toStringTag,{value:"Module"}));class uz extends fr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=uz.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:Pu,colorWrite:ti,depthTest:null,depthWrite:null})}get primitiveType(){return It.TRIANGLE_STRIP}}uz.shader=new sr(Pyt,()=>import("./ShadowCastVisualize.glsl.118b2642.js"));const Iyt=mi(.01,0,.25,1),$yt=4e4,Dyt=5e4,iEe=1/512;let HN=class extends Se{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:Iyt,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new Aq,this._enabled=!1,this._vao=qa(t),this._techniqueConfig.visualization=ex.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Qe(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(uz,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,ko(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>iEe}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;eR(e,t)||(np(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],HN.prototype,"opacityFromElevation",null),HN=u([P("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],HN);class hz extends fr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=hz.shader.get().build();return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:bo(Me.ONE,Me.ONE,Me.ONE,Me.ONE),colorWrite:ti,depthTest:null,depthWrite:null})}get primitiveType(){return It.TRIANGLE_STRIP}}hz.shader=new sr(Oyt,()=>import("./ShadowCastAccumulate.glsl.6171fa64.js"));var XM;let Ko=XM=class extends Se{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new tEe,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=yq,this._previewing=!1,this._handles=new jt,this._cameraForcedForScreenshot=!1,this._bindParameters=new Xk(new zQ(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new ir,this._vao=qa(e);const o={colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE,width:0,height:0},a={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Or(e,o,a),this._accumulationRenderer=new HN(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(yt.SHADOW_ACCUMULATOR,this)),this._handles.add(se(()=>i.renderView,c=>{this._handles.remove(XM.renderViewHandleKey),M(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),XM.renderViewHandleKey)},wr))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(M(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new hz(e,new Ha)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==yq&&this._opacityFromElevation>iEe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(i_(t,e,_w))return;const i=e.length;t.length=i,this._sampleCount=Math.min(cz,i);for(let r=0;r<i;++r){const s=e[r],n=t[r]||R();le(n,s),t[r]=n}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(XM.previewSamples,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Qe(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Qe(this._fbo),this._vao=Qe(this._vao),this._accumulationTechnique=er(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.previewing!==void 0&&(this.previewing=e.previewing),e.lightDirections!==void 0&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=Lyt;return this._fbo.readPixels(e,t,1,1,ze.RGBA,St.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(tr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,ko(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-M2($yt,Dyt,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};Ko.previewSamples=6,Ko.renderViewHandleKey="renderView",u([d()],Ko.prototype,"_progress",void 0),u([d()],Ko.prototype,"_sampleCount",void 0),u([d()],Ko.prototype,"_enabled",void 0),u([d()],Ko.prototype,"_depthRange",void 0),u([d()],Ko.prototype,"_previewing",void 0),u([d()],Ko.prototype,"_accumulationRenderer",void 0),u([d()],Ko.prototype,"_isRefining",null),u([d()],Ko.prototype,"_isActive",null),u([d()],Ko.prototype,"canAccumulate",null),u([d()],Ko.prototype,"_isDoneAccumulating",null),u([d()],Ko.prototype,"_opacityFromElevation",null),u([d()],Ko.prototype,"running",null),Ko=XM=u([P("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Ko);const Lyt=new Uint8Array(4),vce={highlightedThreshold:.99999,selfShadowThreshold:.025};function Nyt(){const e=new qi;e.include(Yw,{receiveShadows:!0});const t=e.fragment;return t.include($c),t.include(zu),e.include(RU),e.include($_),t.uniforms.add([new Vt("defaultDepthTex",(i,r)=>r.shadowMap.getSnapshot(OE.Default)),new Vt("highlightDepthTex",(i,r)=>r.shadowMap.getSnapshot(OE.Highlight)),new Vt("depthMap",(i,r)=>r.linearDepthTexture),new Vt("highlightMap",(i,r)=>r.highlightColorTexture),new ri("uColor",i=>i.shadowColor),new pi("nearFar",(i,r)=>r.camera.nearFar),new Xe("opacity",i=>i.shadowOpacity),new Xe("occludedOpacity",i=>i.occludedShadowOpacity),new Xe("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new xt("lightingMainDirectionView",(i,r)=>we(bce,ke(bce,r.lighting.lightingMainDirection,r.camera.viewInverseTransposeMatrix))),new pi("texelSize",(i,r)=>_(r.linearDepthTexture)?di(Fyt,1/r.linearDepthTexture.descriptor.width,1/r.linearDepthTexture.descriptor.height):Zh),new Er("inverseViewMatrix",(i,r)=>vs(_ce,ja(_ce,r.camera.viewMatrix,r.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",exe).add("highlightedThreshold","float",vce.highlightedThreshold).add("selfShadowThreshold","float",vce.selfShadowThreshold),t.code.add(x`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(x`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const _ce=Ae(),bce=R(),Fyt=st(),kyt=Object.freeze(Object.defineProperty({__proto__:null,build:Nyt},Symbol.toStringTag,{value:"Module"}));class Uyt extends Ys{constructor(){super(...arguments),this.shadowColor=mi(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class dz extends fr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=dz.shader.get().build();return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({blending:bo(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),colorWrite:ti,depthTest:null,depthWrite:null})}get primitiveType(){return It.TRIANGLE_STRIP}}dz.shader=new sr(kyt,()=>import("./ShadowHighlight.glsl.65bf5606.js"));const zyt=.001953125,Vyt=4e4,Byt=5e4;class Gyt{constructor(t,i){this._rctx=t,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new Uyt,this._drawParameters=new aTe,this._vao=qa(this._rctx)}get technique(){return M(this._technique)&&(this._technique=new dz({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,i){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const r=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,ko(this._vao,"geometry"))}get gpuMemoryUsage(){var t,i;return(i=(t=this._vao)==null?void 0:t.size)!=null?i:0}setDefaultOptions(t){this._passParameters=F(F({},this._passParameters),t),this._updateMaxOpacity()}updateParameters(t,i){this._passParameters.opacityElevation=1-M2(Vyt,Byt,t.relativeElevation);const r=this._viewingMode===Ve.Global?we(wce,t.center):ne(wce,0,0,1),s=Te(r,i);this._passParameters.dayNightTerminator=M2(0,1,De(30*s,0,1))}dispose(){this._vao=Qe(this._vao),this._technique=er(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*t*i>=zyt}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const wce=R(),xce=P_();class jyt{constructor(){this._plane=P_()}get isEnabled(){return!sge(this.plane,xce)}get plane(){return this._plane}set plane(t){px(t||xce,this._plane)}}var tm;(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(tm||(tm={}));class rEe extends Ha{constructor(){super(...arguments),this.output=tm.EdgeDetector}}u([j({count:tm.COUNT})],rEe.prototype,"output",void 0);const y0={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function Hyt(e){const t=new qi;return e.output===tm.EdgeDetector&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new Ua("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(x`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new Vr("tColor")),t.fragment.code.add(x`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${x.float(y0.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${x.float(y0.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===tm.BlendWeight&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new Ua("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(x`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${x.int(y0.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new Vr("tEdges")),t.fragment.uniforms.add(new Vr("tArea")),t.fragment.uniforms.add(new Vr("tSearch")),t.fragment.uniforms.add(new Vr("tColor")),t.fragment.uniforms.add(new Ua("resolution")),t.fragment.code.add(x`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(y0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(y0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(y0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(y0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${x.int(y0.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===tm.Blur&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new Ua("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(x`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new Vr("tBlendWeights")),t.fragment.uniforms.add(new Vr("tColor")),t.fragment.uniforms.add(new Ua("resolution")),t.fragment.code.add(x`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const qyt=Object.freeze(Object.defineProperty({__proto__:null,build:Hyt},Symbol.toStringTag,{value:"Module"}));class pz extends fr{initializeProgram(t){const i=pz.shader.get().build(this.configuration);return new nr(t.rctx,i,zi)}initializePipeline(){return Ut({colorWrite:ti})}}pz.shader=new sr(qyt,()=>import("./SMAA.glsl.d1a1337c.js"));let YM=class extends Se{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Xh(this._abortController),this.disable()}_loadResources(e){if(_(this._abortController))return!1;if(_(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return import("./SmaaRenderPassData.e07ab82b.js").then(i=>this._loadTextures(i,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return ci(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,tt.LINEAR,ze.RGB),this._loadTextureFromBase64(e.searchTexure,tt.NEAREST,ze.LUMINANCE)]).then(([i,r])=>{nn(t)?(i.dispose(),r.dispose(),ci(t)):(this._areaTexture=i,this._searchTexture=r)})}get updating(){return _(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new rEe,i=(r,s)=>this._techniqueRep.releaseAndAcquire(pz,r,s);t.output=tm.EdgeDetector,this._edgeDetectTechnique=i(t,this._edgeDetectTechnique),t.output=tm.BlendWeight,this._blendWeightsTechnique=i(t,this._blendWeightsTechnique),t.output=tm.Blur,this._blurTechnique=i(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=fqe(this.rctx),this._edges=new Or(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE},{target:mt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:St.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new Or(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE},{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Qe(this._vao),this._areaTexture=Qe(this._areaTexture),this._searchTexture=Qe(this._searchTexture),this._blend=Qe(this._blend),this._edges=Qe(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(tr.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays(It.TRIANGLES,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(tr.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture("tSearch",this._searchTexture),n.bindTexture("tArea",this._areaTexture),n.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays(It.TRIANGLES,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(tr.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blurTechnique);o.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),o.bindTexture("tColor",e),o.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays(It.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){return Cp(e).then(r=>new ot(this.rctx,{pixelFormat:i,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,width:r.width,height:r.height,samplingMode:t},r))}};u([d()],YM.prototype,"_abortController",void 0),u([d({readOnly:!0})],YM.prototype,"updating",null),YM=u([P("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],YM);function Wyt(e,t){const i=t,r=-e[0],s=-e[1],n=-e[2],o=i[3],a=i[7],l=i[11],c=i[15];i[0]+=o*r,i[1]+=o*s,i[2]+=o*n,i[4]+=a*r,i[5]+=a*s,i[6]+=a*n,i[8]+=l*r,i[9]+=l*s,i[10]+=l*n,i[12]+=c*r,i[13]+=c*s,i[14]+=c*n}function Xyt(e,t){const i=t,r=e[0],s=e[1],n=e[2];i[12]+=r*i[0]+s*i[4]+n*i[8],i[13]+=r*i[1]+s*i[5]+n*i[9],i[14]+=r*i[2]+s*i[6]+n*i[10],i[14]+=r*i[3]+s*i[7]+n*i[11]}class Yyt{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const i=this.originData.get(t.id);return i?(i.refCount++,i.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:Ae(),origin:t}),t)}release(t){const i=this.originData.get(t.id);i&&(i.refCount--,i.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(i=>{Ts(i.viewMatrix,t),Xyt(i.origin.vec3,i.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}class Zyt extends iTe{constructor(t,i,r){super(),this.distanceFalloffFactor=t,this.minimumEdgeLength=i,this.transparency=r,this.transformNormalViewFromGlobal=Pr()}}class Qyt extends rTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Pr(),this.slicePlaneLocalOrigin=R(),this.transformNormalGlobalFromModel=Pr()}}function Jyt(e){const t=x`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const Kyt=Ni(.5,-4e-4);function e0t(e,t){const i=e.vertex;i.include(Jyt),i.constants.add("depthBias","vec2",Kyt),i.uniforms.add(new pi("inverseViewport",(r,s)=>s.inverseViewport)),t.legacy?(i.uniforms.add(new u_("localView")),i.uniforms.add(new Er("proj",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new p3("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new Er("transformProjFromView",r=>r.transformProjFromView)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(x`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function t0t(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(x`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(x`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function i0t(e,t){const i=e.vertex;t.silhouette?(i.code.add(x`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function r0t(e,t){const i=e.vertex;i.include($c),i.uniforms.add(new Xe("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(x`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new Vr("componentDataTex")),i.uniforms.add(new Zg("componentDataTexInvDim")),e.attributes.add(O.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.constants.add("verticalOffsetScale","float",2*CJ),i.code.add(x`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new LR("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(O.NORMALA,"vec3"),e.attributes.add(O.NORMALB,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(O.NORMAL,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(x`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(Y4,t),i.include(Y4,t),i.uniforms.add([new p3("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new LR("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Va("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Va("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new xt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new xt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(x`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?x`normalize(transformWorldFromModelTL + rotatedModelPosition);`:x`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Er("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(x`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function sEe(e){return e.mode===Us.SKETCH||e.mode===Us.MIXED}var Us;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(Us||(Us={}));function s0t(e,t){const i=e.vertex;switch(t.mode){case Us.SKETCH:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Us.MIXED:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Us.SOLID:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function IJ(e,t){const i=e.vertex;switch(e.attributes.add(O.SIDENESS,"vec2"),t.mode===Us.MIXED?i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case Us.MIXED:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Us.SKETCH:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Us.SOLID:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Us.COUNT:break;default:t.mode}}function n0t(e,t){const i=e.vertex;switch(e.include(IJ,t),sEe(t)&&i.uniforms.add(new Fi("strokesAmplitude")),t.mode){case Us.SOLID:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Us.SKETCH:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Us.MIXED:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function o0t(e,t){const i=e.vertex;e.include(IJ,t);const r=e.fragment;switch(sEe(t)&&(i.uniforms.add(new Zg("strokesTextureScale")),i.uniforms.add(new Fi("strokesLog2Resolution")),i.uniforms.add(new Fi("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new Vr("strokesTexture")),r.uniforms.add(new Fi("strokesNormalizationScale")),i.code.add(x`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include($c),r.code.add(x`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case Us.SOLID:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(x`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Us.SKETCH:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(x`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Us.MIXED:e.varyings.add("vType","float"),i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(x`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function a0t(e){const t=new qi,i=t.vertex,r=t.fragment;return e.legacy&&i.uniforms.add(new u_("model")),e.antialiasing&&(i.code.add(x`#define ANTIALIASING 1`),r.code.add(x`#define ANTIALIASING 1`)),t.include(e0t,e),t.include(r0t,e),t.include(n0t,e),t.include(IJ,e),t.include(o0t,e),t.include(ys,e),t.include(i0t,e),t.include(t0t,e),t.include(s0t,e),t.include(Vu,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new pi("pixelToNDC",(s,n)=>di(l0t,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]))),i.uniforms.add(new ri("viewport",(s,n)=>n.camera.fullViewport)),i.uniforms.add(new Xe("pixelRatio",(s,n)=>n.camera.pixelRatio)),t.attributes.add(O.POSITION0,"vec3"),t.attributes.add(O.POSITION1,"vec3"),t.attributes.add(O.VARIANTOFFSET,"float"),t.attributes.add(O.VARIANTSTROKE,"float"),t.attributes.add(O.VARIANTEXTENSION,"float"),i.code.add(x`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(x`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const l0t=st(),c0t=Object.freeze(Object.defineProperty({__proto__:null,build:a0t},Symbol.toStringTag,{value:"Module"}));class fz extends fr{initializeProgram(t){const i=fz.shader.get().build(this.configuration);return new nr(t.rctx,i,bq)}initializePipeline(t){return t.blendMinMax?Ut({blending:bo(Me.ONE,Me.ONE,Me.ZERO,Me.ONE,py.ADD,t.blendMinMax.MAX),depthTest:{func:yr.LEQUAL},colorWrite:ti}):Ut({depthTest:{func:yr.LEQUAL},depthWrite:Il,colorWrite:ti})}}fz.shader=new sr(c0t,()=>import("./EdgeShader.glsl.a1ebdb8d.js"));class bf extends la{constructor(){super(...arguments),this.mode=Us.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([j({count:Us.COUNT})],bf.prototype,"mode",void 0),u([j()],bf.prototype,"hasSlicePlane",void 0),u([j()],bf.prototype,"silhouette",void 0),u([j()],bf.prototype,"legacy",void 0),u([j()],bf.prototype,"antialiasing",void 0),u([j()],bf.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],bf.prototype,"hasMultipassTerrain",void 0),u([j()],bf.prototype,"cullAboveGround",void 0),u([j()],bf.prototype,"spherical",void 0);const u0t=8,g8=128,h0t={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class d0t{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const p0t={solid:Us.SOLID,sketch:Us.SKETCH,uber:Us.MIXED};class qO{constructor(t,i,r){this.rctx=t,this.shaderTechniqueRepository=i,this._configuration=new bf,this.refCount=new d0t,this.renderables=new Set,this.sortedRenderables={[$t.TRANSPARENT]:{[$t.TRANSPARENT]:new Gt,[$t.OPAQUE]:new Gt},[$t.OPAQUE]:{[$t.TRANSPARENT]:new Gt,[$t.OPAQUE]:new Gt}},this._renderablesDirty=!1,this._drawParameters=new Qyt,this._settings=F(F({},h0t),r),this.key=qO.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:ji.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=p0t[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=b3(t),this._configuration.spherical=r.spherical}dispose(){this._technique=er(this._technique)}addRenderable(t){this.renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,i){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[i][$t.TRANSPARENT].forAll(t),this.sortedRenderables[i][$t.OPAQUE].forAll(t)}updateTechnique(t,i){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(fz,this._configuration,this._technique),this._technique}bindRegularEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!1),t,i)}bindSilhouetteEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!0),t,i)}renderRegularEdges(t,i,r,s,n){this._render(t,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(t,i,r,s,n){this._render(t,i,i.silhouette.vao,r,s,n)}_render(t,i,r,s,n,o){this._bindDraw(t,i,s,o),this.rctx.bindVAO(r),this.rctx.capabilities.instancing.drawArraysInstanced(It.TRIANGLE_FAN,0,4,n)}_bindDraw(t,i,r,s){if(i.components.buffer.textureBuffer.bind(t,f0t,m0t),"origin"in i.transform)t.setUniformMatrix4fv("localView",s),t.setUniformMatrix4fv("model",i.transform.modelMatrix),le(this._drawParameters.slicePlaneLocalOrigin,i.transform.origin.vec3);else{const n=new nz(i.transform.position),o=Kh(Tce,yx(Tce,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=r.camera.viewInverseTransposeMatrix;ne(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,r),this._settings.type!=="uber"&&this._settings.type!=="sketch"||this._setSketchUniforms(t)}_setSketchUniforms(t){const i=this._settings.strokesTexture,r=i.texture;M(r)||(t.bindTexture("strokesTexture",r),t.setUniform2f("strokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(i.resolution)),t.setUniform1f("strokesNormalizationScale",i.normalizationScale),t.setUniform1f("strokesAmplitude",i.amplitude),t.setUniform1f("strokeVariants",i.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[$t.TRANSPARENT][$t.TRANSPARENT].clear(),this.sortedRenderables[$t.TRANSPARENT][$t.OPAQUE].clear(),this.sortedRenderables[$t.OPAQUE][$t.TRANSPARENT].clear(),this.sortedRenderables[$t.OPAQUE][$t.OPAQUE].clear(),this.renderables.forEach(i=>{i.objectTransparency!==$t.INVISIBLE&&i.edgeTransparency!==$t.INVISIBLE&&this.sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const t=(i,r)=>"origin"in i.transform&&"origin"in r.transform?i.transform.origin.id<r.transform.origin.id?-1:i.transform.origin.id>r.transform.origin.id?1:0:0;this.sortedRenderables[$t.TRANSPARENT][$t.TRANSPARENT].sort(t),this.sortedRenderables[$t.TRANSPARENT][$t.OPAQUE].sort(t),this.sortedRenderables[$t.OPAQUE][$t.TRANSPARENT].sort(t),this.sortedRenderables[$t.OPAQUE][$t.OPAQUE].sort(t)}static getKey(t,i,r){return`edges-t:${t}:${i}:${r}`}}const f0t="componentDataTex",m0t="componentDataTexInvDim",Tce=ey();class g0t extends USe{constructor(t){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},t)}async process(t,i,r){if(r)return RJ(t);const s=this._packInput(t),n=await this.invoke(s,i);return this._unpackOutput(n)}async extractEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractEdgeLocations",r,i);return LD(s)}async extractComponentsEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractComponentsEdgeLocations",r,i);return LD(s)}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:aF(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:LD(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:LD(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function y0t(e){const i=CA.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=CA.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=CA.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:y}of CA.strokes){let v=m,w=y,b=p;for(let S=0;S<c;S++){S!==0&&(v=Sce(v,xP.DISTANCE),w=Sce(w,xP.PRESSURE));for(let T=0;T<CA.resolution;T++){const E=.5+(v?v[T%v.length]/a:0),C=w?w[T%w.length]:1;tP(E,s,b),tP(C,s,b+n),b+=4}b-=l*(h+1)}p+=l}const f=new ot(e,{pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:tt.LINEAR,width:i,height:i,wrapMode:bt.REPEAT},s);return new _0t(i,a,o,h,f)}function Sce(e,t){if(!e)return null;const i=e.length/2,r=v0t*i,s=new Array(i);let n=0;const o=t===xP.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*Ece):Math.min(r,l*Ece)}return s}var xP;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(xP||(xP={}));const v0t=.1,Ece=.5;class _0t{constructor(t,i,r,s,n){this.resolution=t,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=Qe(this.texture)}}const CA={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Cce(e){let t=null;for(const i of e){const r=i.type;if(b0t(i)){if(M(t))t=r;else if(t!==r)return"uber"}}return _(t)?t:"uber"}function y8(e){let t=$t.INVISIBLE;for(const{material:i}of e)if(nEe(i)){if(i.color[3]*i.opacity<1)return $t.TRANSPARENT;t=$t.OPAQUE}return t}function v8(e){let t=$t.INVISIBLE;for(const{material:i}of e)if(nEe(i)){switch(i.objectTransparency){case $t.TRANSPARENT:case $t.INVISIBLE:return $t.TRANSPARENT;case $t.OPAQUE:if(i.opacity<1)return $t.TRANSPARENT}t=$t.OPAQUE}return t}function nEe(e){return e.size*e.color[3]*e.opacity>0}function b0t(e){return e.size*e.color[3]>0}function w0t(e,t){const i=Xue(e,t,!0);return i===-1?t<e[0]?0:e.length:i}function Ace(e,t,i){return e.length-w0t(e,t*i.minimumEdgeLength)}function Mce(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}const x0t=ge.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let kd=class extends Se{constructor(e){super(e),this.updatingHandles=new Zf,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[$t.TRANSPARENT]:0,[$t.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=R(),this.localOrigins=new Yyt(new UQ(e.renderSR))}initialize(){this.worker=new g0t(this.schedule),this.componentColorManager=new Z2e(this.rctx,3);const e=B2e.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=si.createVertex(this.rctx,_i.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=Qe(this.strokesTexture),this.componentColorManager=lt(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=Qe(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[$t.TRANSPARENT]+this.numberOfRenderedEdges[$t.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new Oce(new Promise(p=>l=p),i.center,i.radius);this.perObjectData.set(e,c);const h=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void x0t.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this.perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new Oce(new Promise(c=>n=c),o,Wg(o));this.perObjectData.set(e,a);const l=new Array;if(i.mergeGeometries&&e.geometries.length>1&&S0t(e))l.push(this._addObjectMergedGeometries(e,a,t,i,r));else for(let c=0;c<e.geometries.length;c++){const h=e.geometryRecords[c];if(!h.material.supportsEdges)continue;const p=e.geometries[c];l.push(this._addGeometry(e,a,p,h,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?r=>t[r]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{const s=r.components.meta.length;for(let n=0;n<s;n++){const o=i(n),a=r.components.meta[n],l=a.index;a.material.opacity=o,r.components.buffer.textureBuffer.setDataElement(l,1,3,255*o)}this._updateTransparency(r)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,i)=>t+i.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof Ly,n=!!i.hasSlicePlane,o=Cce(t),a=qO.getKey(o,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(l=>{if(a!==l.rendererKey){const c=this.renderers.get(l.rendererKey),h=this._acquireRenderer(o,n,s);c.removeRenderable(l),c.refCount.decrement(),l.rendererKey=a,h.addRenderable(l)}for(let c=0;c<t.length;c++)l.components.meta[c].material=t[c];r&&this._updateComponentBuffer(l.components),this._updateTransparency(l)}),this.setNeedsRender()}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>{var s;const r=i.components.meta;for(let n=0;n<r.length;n++)i.components.meta[n].verticalOffset=(s=t==null?void 0:t[n])!=null?s:0;this._updateComponentBuffer(i.components)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>i.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";if(await t.loaded,t.loaded==null)throw hi();return t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,M(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=R(),s=new nz;let n=0,o=0;if(this.renderers.forEach(h=>{h.refCount.value===0?(this.renderers.delete(h.key),h.dispose()):h.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,p.regular&&h.updateTechnique(e,!1),p.silhouette&&h.updateTechnique(e,!0))},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),o===0)return;const a=40*n/o,l=e.camera.perScreenPixelRatio,c=new Zyt(a,l,t);ne(r,i[3],i[7],i[11]),s.set(r),le(c.transformWorldFromViewTH,s.high),le(c.transformWorldFromViewTL,s.low),Jh(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Kh(Rce,c.transformViewFromCameraRelativeRS),yx(c.transformNormalViewFromGlobal,Rce),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach(h=>{this._renderRegularEdges(h,e,c),this._renderSilhouetteEdges(h,e,c)})}_updateTransparency(e){const t=y8(e.components.meta),i=v8(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),_(t.origin))this.localOrigins.register(t.origin);else{const r=ne(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(r)}return Wyt(t.origin.vec3,i),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:i}=e,r=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=De(Math.round(n.size*u0t),0,255),l=De(n.extensionLength,-g8,255-g8)+g8,c=n.type==="solid"?y5.SOLID:y5.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],y=255*p[2],v=255*p[3];i.textureBuffer.setData(o,0,f,m,y,v),i.textureBuffer.setData(o,1,a,l,c,h),z2e(t[s].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(e){if(M(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=i.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const r={meta:t,buffer:i};return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}_createEdgeResources(e){const t={};if(M(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new qs(this.rctx,bq,{vertices:oce,instances:m5.glLayout},{vertices:this.verticesBufferObject,instances:si.createVertex(this.rctx,_i.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new qs(this.rctx,bq,{vertices:oce,instances:g5.glLayout},{vertices:this.verticesBufferObject,instances:si.createVertex(this.rctx,_i.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,i,r,s,n,o){const a=i.vertexAttributes.get(O.POSITION),l=i.indices.get(O.POSITION),c=Ae(),h={position:a,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,r,c)};return this._addPositionData(t,h,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,i,r,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([r]);if(M(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,f=p.data.length/p.size,m=_P.createBuffer(f);for(let T=0;T<f;T++)m.position.set(T,0,p.data[T*p.size+0]),m.position.set(T,1,p.data[T*p.size+1]),m.position.set(T,2,p.data[T*p.size+2]);Mce(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this.updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,i));if(e.loaded==null)return;const{regular:v,silhouette:w}=this._createEdgeResources(y),b=(v?v.vao.size:0)+(w?w.vao.size:0),S={regular:v,silhouette:w,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:b,externalMemoryUsage:!1,averageEdgeLength:y.averageEdgeLength},components:o,visible:!0,edgeTransparency:y8(o.meta),objectTransparency:v8(o.meta),distanceToCamera:0,rendererKey:a.key};e.renderables.push(S),a.addRenderable(S),this.gpuMemoryUsage+=b}async _addComponentGeometry(e,t,i,r,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(M(a))return 0;const l=Cce(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=_P.createBuffer(i.count);zU(h.position,i),Mce(a.meta,s,h.componentIndex,r);const p=!0,f=c.writerSettings,m=await this.updatingHandles.addPromise(this._extractEdges(f,h,p,!1,r));if(t.loaded==null)return 0;const{regular:y,silhouette:v}=this._createEdgeResources(m),w=(y?y.vao.size:0)+(v?v.vao.size:0),b={regular:y,silhouette:v,transform:e,statistics:{gpuMemoryUsage:w,externalMemoryUsage:!0,averageEdgeLength:m.averageEdgeLength},components:a,visible:!0,edgeTransparency:y8(a.meta),objectTransparency:v8(a.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(b),c.addRenderable(b),w}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let b=0;b<e.geometries.length;b++){const S=e.geometries[b],T=e.geometryRecords[b];if(!T.material.supportsEdges)continue;!a&&T.origin&&(a=T);const E=S.vertexAttributes.get(O.POSITION);l+=E.data.length/E.size,o+=S.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let b=0;b<e.geometries.length;b++){const S=e.geometries[b];if(!e.geometryRecords[b].material.supportsEdges)continue;const T=S.vertexAttributes.get(O.POSITION),E=S.indices.get(O.POSITION);let C=n.get(T.data);if(C==null){C=p.length/3;for(let A=0;A<T.data.length;A+=T.size)p.push(T.data[A+0]),p.push(T.data[A+1]),p.push(T.data[A+2]);n.set(T.data,C)}if(E)for(let A=0;A<S.edgeIndicesLength;A++)h[f++]=C+E[A]}const m=a||e.geometryRecords[0],y=Ae(),v=this._computeModelTransformWithLocalOrigin(e,m,y);for(let b=0;b<e.geometryRecords.length;b++)e.geometryRecords[b].origin=v;const w={position:{data:p,size:3},indices:h,modelTransform:y,origin:v};await this.updatingHandles.addPromise(this._addPositionData(t,w,h.length,i[0],r,s))}_acquireRenderer(e,t,i){const r=qO.getKey(e,t,i);let s=this.renderers.get(r);return M(this.strokesTexture)&&(this.strokesTexture=y0t(this.rctx)),s||(s=new qO(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:i,spherical:this.viewingMode===Ve.Global}),this.renderers.set(r,s)),s.refCount.increment(),s}_removeRenderable(e){T0t(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=R(),s=n=>{const{center:o,radius:a}=n;Tc(r,o,t);const l=Te(r,i),c=l<-a?1/0:l<a?0:l-a;n.renderables.forEach(h=>h.distanceToCamera=c)};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){const r=e.bindRegularEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.regular)return;const o=Ace(n.regular.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):hn;e.renderRegularEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}_renderSilhouetteEdges(e,t,i){const r=e.bindSilhouetteEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.silhouette)return;const o=Ace(n.silhouette.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):hn;e.renderSilhouetteEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}};function T0t(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function S0t(e){let t=null,i=null;for(let r=0;r<e.geometries.length;r++){const s=e.geometryRecords[r];if(s.material.supportsEdges){if(t){if(!i_(t,s.transformation))return!1}else t=s.transformation;if(!i&&_(s.origin))i=s;else if(_(i==null?void 0:i.origin)&&_(s.origin)&&i.origin.id!==s.origin.id)return!1}}return!0}u([d({constructOnly:!0})],kd.prototype,"rctx",void 0),u([d({constructOnly:!0})],kd.prototype,"renderSR",void 0),u([d({constructOnly:!0})],kd.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],kd.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],kd.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],kd.prototype,"schedule",void 0),u([d({readOnly:!0})],kd.prototype,"updatingHandles",void 0),u([d({readOnly:!0})],kd.prototype,"updating",null),kd=u([P("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],kd);class Oce{constructor(t,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}const Rce=Pr();function E0t(e){const t=e.capabilities.disjointTimerQuery;return M(t)?null:t.timestampBits()>0?new C0t(t):Mq?null:new A0t(t)}class C0t{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,i=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,i)}_checkQueryResult(t,i){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,i),i);if(this.timer.disjoint())return void t(null);const r=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-r)/1e6)}}class A0t{constructor(t){this.timer=t,this.query=t.createQuery(),Mq=!0,this.timer.beginTimeElapsed(this.query)}stop(t,i=50){this.timer.endTimeElapsed(),Mq=!1,this._checkQueryResult(t,i)}_checkQueryResult(t,i){const r=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!r||s)s?t(null):setTimeout(()=>this._checkQueryResult(t,i),i);else{const n=this.timer.getResult(this.query);t(n/1e6)}}}let Mq=!1;var Is;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})(Is||(Is={}));const M0t=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class O0t extends Gv{constructor(){super("total"),this.total=0,this.frameCount=0}}class R0t{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new O0t,this.gpuTime=new Gv("gpu",9),this.renderPassTimings=M0t.map(t=>new Gv(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:rW(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=E0t(t))}advance(t){const i=performance.now();this.renderPassTimings[t].record(i-this._lastSample),this._lastSample=i}postrender(){_(this._gpuTimer)&&(this._gpuTimer.stop(i=>_(i)&&this.gpuTime.record(i),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const Pce=.9;let _g=class extends Se{constructor(e,t,i,r,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new R0t,this._antialiasing=Ib.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new jt,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new YM(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new wyt(this._rctx,this._compositingHelper),this._sliceHelper=new jyt,this._shadowMap=new zQ(this._rctx,l.viewingMode,2),this._ssaoHelper=new gTe(i,this._rctx,()=>this._requestRender()),this._highlight=new yyt(i,this._rctx),this._shadowHighlight=new Gyt(this._rctx,l.viewingMode),this._shadowAccumulator=new Ko(this._rctx,i,l,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p),this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_ALL,c.shadowMap),c.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(c.camera,c.contentCamera)},()=>this._requestRender()),this._renderContext=new ert(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new Syt({renderContext:this._renderContext,shaderTechniqueRepository:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new oyt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([se(()=>this._stage.state.camera,()=>this._requestRender(),wr),se(()=>ji.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges($t.TRANSPARENT):()=>{},this._requestRender()},At)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=lt(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=Qe(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),Yk.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===Ib.SMAA&&this._smaaPass.updating||_(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return M(this._edgeView)&&(this._edgeView=new kd({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(se(()=>Qi(this._edgeView,e=>e.updating),()=>this._requestRender(),Ki)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return Qfe(this._bindParameters.ssr.reprojectionMatrix,hn)}set _reprojectionMatrix(e){Kq(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)==null?void 0:e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:i,_bindParameters:r}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),_(e.environment)){_(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&i.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(i.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const n=e.environment.lighting.type==="sun";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?Ib.SMAA:Ib.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.transparentTerrain!==void 0&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(t.length===0&&i.length===0&&r.length===0)return;i.forAll(({id:o})=>this._content.delete(o)),t.forAll(o=>this._content.set(o.id,o));const s=tTe(e);let n=!1;s.forEach((o,a)=>{let l=this._materialRenderers.get(a);if(!l){if(!(o.adds.length>0))return;l=new pTe(this._rctx,this._materialRepository,a),this._materialRenderers.set(a,l)}l.modify(o),l.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((o,a)=>{o.isEmpty&&(this._materialRenderers.delete(a),o.dispose())}),this._hasHighlights=on(this._materialRenderers,o=>o.hasHighlights),this._bindParameters.hasOccludees=on(this._materialRenderers,o=>o.hasOccludees),this._hasWater=on(this._materialRenderers,o=>o.hasWater),this._needsTransparentPass=on(this._materialRenderers,o=>o.requiresSlot(Ee.TRANSPARENT_MATERIAL,je.MATERIAL)),this._hasHUDElements=on(this._materialRenderers,o=>o.requiresSlot(Ee.LINE_CALLOUTS_HUD_DEPTH,je.MATERIAL)||o.requiresSlot(Ee.HUD_MATERIAL,je.MATERIAL)||o.requiresSlot(Ee.LABEL_MATERIAL,je.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,i){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=i,this._bindParameters.lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=vt.NONE;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=P_(this._sliceHelper.plane);r===Nw.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._ensureCameraBindParameters(t,i),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Is.Prepare);const o=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,o),this.performanceInfo.advance(Is.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t,i),this._renderLinearDepth(),this.performanceInfo.advance(Is.Lineardepth),this._accumulateShadows(o,t,i),this._renderNormal(),this.performanceInfo.advance(Is.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance(Is.SSAO),this._renderContext.pass=je.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Is.Opaque);const a=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(a),this._setMultipassEnabled(a),this._setTerrainCulling(a),this._renderEdges($t.OPAQUE),this.performanceInfo.advance(Is.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(Ee.VOXEL),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Is.Transparent),this._renderGeometryLinearDepth(a);const c=this._renderHUDVisibility();a||this._renderInternalSlot(Ee.LINE_CALLOUTS),this.performanceInfo.advance(Is.Hudvisibility),this._renderEdges($t.TRANSPARENT,a),this.performanceInfo.advance(Is.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(a?this._renderLineCallouts(Eh.Occluded):s.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Eh.Occluded,s.framebuffer),this.performanceInfo.advance(Is.HudOccluded)),this.performanceInfo.advance(Is.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(s.compositeTransparentTerrainOntoMain(this._bindParameters),a&&(this._renderEdges($t.OPAQUE),this.performanceInfo.advance(Is.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Is.Transparent),this._renderEdges($t.TRANSPARENT),this.performanceInfo.advance(Is.TransparentEdges))),a&&this._renderLineCallouts(Eh.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.renderToTargets(()=>{this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Ee.LASERLINES)},s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(Is.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain(()=>this._renderSlot(Ee.LASERLINES_CONTRAST_CONTROL),this._bindParameters,No.PremultipliedAlpha),this.performanceInfo.advance(Is.Laserline),this._renderOccluded(),this.performanceInfo.advance(Is.Occluded);const h=r===Nw.ON&&this._magnifierHelper.enabled,p=h&&M(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(p);const f=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,f)&&_(f)&&this._compositingHelper.composite(this._bindParameters,f,No.None),this.performanceInfo.advance(Is.Antialiasing),this._renderHUD(Eh.NotOccluded,p),this.performanceInfo.advance(Is.HudNotoccluded),this._renderHighlights(p,this._bindParameters),this.performanceInfo.advance(Is.Highlights),h&&this._magnifierHelper.render(this._rctx,this._bindParameters),p!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,No.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===ks.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/syt;this._animationTimestep=Math.max(this._animationTimestep*Pce+t*(1-Pce),nyt)}}readDepthPixels(e,t,i){const r=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=tr.COLOR_BUFFER_BIT|tr.DEPTH_BUFFER_BIT|tr.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH)}r.readPixels(t[0],t[1],t[2],t[3],ze.RGBA,St.UNSIGNED_BYTE,i)}readHUDVisibility(e,t,i,r,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,i,r,ze.RGBA,St.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;_(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,No.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&(s.start(t,i,r),this._shadowHighlight.updateParameters(t,i),this.needsShadowHighlight?(this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,OE.Highlight)),s.clear(),this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,OE.Default),this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=r=>{}){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=je.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(je.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return yq;const t=qgt(e,this._content,this._stage.layers);return LE(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(Ee.INTEGRATED_MESH),this._renderSlot(Ee.OPAQUE_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL),this._renderSlot(Ee.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Ee.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Ee.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Eh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(Ee.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Ee.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,No.PremultipliedAlpha)):e===Eh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(Eh.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Ee.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Ee.HUD_MATERIAL),this._renderInternalSlot(Ee.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlight,r=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(tr.DEPTH_BUFFER_BIT),this._renderHUDElements(Eh.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),i.render(this._bindParameters,r,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,i)}_renderOrderIndependentTransparency(e,t){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreenRendering.renderOITPass(()=>e(),s,t)},r=this._renderContext.pass;this._renderContext.pass=je.MATERIAL_ALPHA,i(vt.Alpha),this._renderContext.pass=je.MATERIAL,i(vt.Color),i(vt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=vt.NONE,this._renderContext.pass=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&o.renderOccluded===Fr.OccludeAndTransparentStencil&&(e|=o.renderOccluded,MA.push(o))});const t=this._offscreenRendering,i=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};MA.length!==0&&(this._renderInternalSlot(Ee.OCCLUDER_MATERIAL,MA),i(.5,Fr.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Ee.TRANSPARENT_OCCLUDER_MATERIAL,MA),!1,!1),MA.length=0),this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&(o.renderOccluded===Fr.OccludeAndTransparent||o.renderOccluded===Fr.Transparent||o.renderOccluded===Fr.Opaque)&&(e|=o.renderOccluded,AA.push(o))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>Fr.Occlude&&this._renderSlot(Ee.OCCLUDED_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL,AA),this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL,AA),this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,AA),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=je.MATERIAL,i(.5,Fr.OccludeAndTransparent,()=>s(Fr.OccludeAndTransparent),!0,Cl.OutlineVisualElementMask),i(.5,Fr.Transparent,()=>s(Fr.Transparent),!0,Cl.OutlineVisualElementMask),i(1,Fr.Opaque,()=>s(Fr.Opaque),!0,Cl.OutlineVisualElementMask),AA.length=0}_renderAntiAliasing(e,t){if(e===Ib.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&_(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var r;this._ensureCameraBindParameters(e,t);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(r=i.depthTexture)!=null?r:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=hn:(vs($ce,this._bindParameters.camera.viewMatrix),vs(Ice,this._bindParameters.camera.projectionMatrix),jr(bT,$ce,Ice),jr(bT,this._renderContext.lastFrameCamera.viewMatrix,bT),jr(bT,this._renderContext.lastFrameCamera.projectionMatrix,bT),this._reprojectionMatrix=bT),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,_(t)?t.forEach(r=>{if(!r.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(r);_(s)&&(i=s.render(this._renderContext.pass,this._bindParameters)||i)}):this._materialRenderers.forEach((r,s)=>{s.shouldRender(this._renderContext)&&r.render(this._renderContext.pass,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=M1e(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreenRendering)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((r=(i=this._highlight)==null?void 0:i.gpuMemoryUsage)!=null?r:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case pv.Color:return e._offscreenRendering.colorTexture;case pv.LinearDepth:return e._offscreenRendering.linearDepthTexture;case pv.Normals:return e._offscreenRendering.normalTexture;case pv.ShadowMap:return e._shadowMap.depthTexture;case pv.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case pv.Highlight:return e._offscreenRendering.highlightTexture}}}}};var pv;u([d()],_g.prototype,"_shadowAccumulator",void 0),u([d()],_g.prototype,"_smaaPass",void 0),u([d()],_g.prototype,"_antialiasing",void 0),u([d()],_g.prototype,"_edgeView",void 0),u([d()],_g.prototype,"updating",null),u([d()],_g.prototype,"isCameraFinal",null),_g=u([P("esri.views.3d.webgl-engine.lib.Renderer")],_g),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(pv||(pv={}));const AA=[],MA=[],Ice=Ae(),$ce=Ae(),bT=Ae();class Dce{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Me.ONE,dstRGB:Me.ZERO,srcAlpha:Me.ONE,dstAlpha:Me.ZERO},this.blendEquation={mode:py.ADD,modeAlpha:py.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=hp.BACK,this.frontFace=aE.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=yr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:hp.FRONT_AND_BACK,func:yr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:hp.FRONT_AND_BACK,fail:os.KEEP,zFail:os.KEEP,zPass:os.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class P0t{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(i=>{var r;t.set(i,((r=t.get(i))!=null?r:0)+1)}),t.forEach((i,r)=>{const s=r.split(`
`);s.shift(),s.shift(),console.log(`${i}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}const I0t={RECORD_ALLOCATIONS:!1};class $0t{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new P0t(I0t.RECORD_ALLOCATIONS);this._current.length<Tn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,i){const r=++this._current[t];this._max[t]=Math.max(r,this._max[t]),this._allocations.add(i)}decrement(t,i){--this._current[t],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,i)=>t+i,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<Tn.COUNT;++t){const i=this._current[t];i>0&&console.log(`${Tn[t]}: ${i}`)}}this._allocations.print()}}const D0t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Lce,oEe={exports:{}};(Lce=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(oEe.exports=Lce);const L0t=oEe.exports;var Nce,aEe={exports:{}};Nce=aEe,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(Nce.exports=t)}();const Fce=aEe.exports;var lEe={exports:{}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();i!==void 0&&(e.exports=i)})()})(lEe);const N0t=lEe.exports;var _d=999,kce=9999,_8=0,b8=1,Uce=2,zce=3,Vce=4,zD=5,F0t=6,k0t=7,U0t=8,Bce=9,z0t=10,Gce=11,V0t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function B0t(){var e,t,i,r=0,s=0,n=_d,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(V){return a=[],V!==null?v(V.replace?V.replace(/\r\n/g,`
`):V):w()};function y(V){V.length&&a.push({type:V0t[n],data:V,position:h,line:l,column:c})}function v(V){var X;for(r=0,i=(m+=V).length;e=m[r],r<i;){switch(X=r,n){case _8:r=C();break;case b8:r=E();break;case Uce:r=T();break;case zce:r=A();break;case Vce:r=D();break;case Gce:r=L();break;case zD:r=U();break;case kce:r=z();break;case Bce:r=S();break;case _d:r=b()}X!==r&&(m[X]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function w(V){return o.length&&y(o.join("")),n=z0t,y("(eof)"),a}function b(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+r-1,n=_8,t=e,r+1):t==="/"&&e==="/"?(h=s+r-1,n=b8,t=e,r+1):e==="#"?(n=Uce,h=s+r,r):/\s/.test(e)?(n=Bce,h=s+r,r):(p=/\d/.test(e),f=/[^\w_]/.test(e),h=s+r,n=p?Vce:f?zce:kce,r)}function S(){return/[^\s]/g.test(e)?(y(o.join("")),n=_d,r):(o.push(e),t=e,r+1)}function T(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,r+1):(y(o.join("")),n=_d,r)}function E(){return T()}function C(){return e==="/"&&t==="*"?(o.push(e),y(o.join("")),n=_d,r+1):(o.push(e),t=e,r+1)}function A(){if(t==="."&&/\d/.test(e))return n=zD,r;if(t==="/"&&e==="*")return n=_8,r;if(t==="/"&&e==="/")return n=b8,r;if(e==="."&&o.length){for(;I(o););return n=zD,r}if(e===";"||e===")"||e==="("){if(o.length)for(;I(o););return y(e),n=_d,r+1}var V=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||V){for(;I(o););return n=_d,r}return o.push(e),t=e,r+1}function I(V){for(var X,Z,ae=0;;){if(X=Fce.indexOf(V.slice(0,V.length+ae).join("")),Z=Fce[X],X===-1){if(ae--+V.length>0)continue;Z=V.slice(0,1).join("")}return y(Z),h+=Z.length,(o=o.slice(Z.length)).length}}function L(){return/[^a-fA-F0-9]/.test(e)?(y(o.join("")),n=_d,r):(o.push(e),t=e,r+1)}function D(){return e==="."||/[eE]/.test(e)?(o.push(e),n=zD,t=e,r+1):e==="x"&&o.length===1&&o[0]==="0"?(n=Gce,o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=_d,r):(o.push(e),t=e,r+1)}function U(){return e==="f"&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=_d,r):(o.push(e),t=e,r+1)}function z(){if(/[^\d\w_]/.test(e)){var V=o.join("");return n=L0t.indexOf(V)>-1?U0t:N0t.indexOf(V)>-1?k0t:F0t,y(o.join("")),n=_d,r}return o.push(e),t=e,r+1}}function G0t(e){var t=B0t(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function j0t(e){return G0t(e)}function H0t(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const w8=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function q0t(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function W0t(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function ZM(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,ZM(e,t,r+"_"+t[r],r);return i}function cEe(e,t,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=r(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function X0t(e,t,i,r="lowp"){cEe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function Y0t(e,t,i,r,s="lowp"){cEe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function Z0t(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&e.splice(i,r-i+1),s}function jce(e,t){const i=Q0t();if(_(i))return i;const r=j0t(e);if(q0t(r,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":t===gu.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===gu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===gu.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=ZM(r,o,"fragColor"),X0t(r,s,"vec4")),c.data=s),t===gu.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=Z0t(r,l+1),p=ZM(r,o,"fragData");Y0t(r,p,"vec4",h,"mediump"),c.data=p}else t===gu.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=ZM(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if(D0t.includes(c.data)){if(t===gu.VERTEX_SHADER&&W0t(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=ZM(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&w8.includes(h[1].trim())){const m=r[l+1];r.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&w8.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&w8.includes(f[1].trim())&&(c.data="#if 0")}}return J0t(e,H0t(r))}function Q0t(e){return null}function J0t(e,t){return t}const K0t=4294967295;class evt{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===li.WEBGL2&&(i=jce(i,gu.VERTEX_SHADER),r=jce(r,gu.FRAGMENT_SHADER)),this._vShader=Hce(this._context,gu.VERTEX_SHADER,i),this._fShader=Hce(this._context,gu.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Tn.Shader,this),PR()&&(this.vertexShader=i,this.fragmentShader=r)}get glName(){if(_(this._glName))return this._glName;if(M(this._vShader))return null;const t=this._context.gl,i=t.createProgram();if(t.attachShader(i,this._vShader),t.attachShader(i,this._fShader),this._locations.forEach((r,s)=>t.bindAttribLocation(i,r,s)),t.linkProgram(i),PR()&&!t.getProgramParameter(i,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(i,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(i)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===li.WEBGL2){const r=t;for(const[s,n]of this._uniformBlockBindings){const o=r.getUniformBlockIndex(i,s);o<K0t&&r.uniformBlockBinding(i,o,n)}}return this._glName=i,this._context.instanceCounter.increment(Tn.Program,this),i}get hasGLName(){return _(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Tn.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Tn.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){Qp(this._nameToUniform1v,t,i)&&this._context.gl.uniform1iv(this._getUniformLocation(t),i)}setUniform2iv(t,i){Qp(this._nameToUniform2,t,i)&&this._context.gl.uniform2iv(this._getUniformLocation(t),i)}setUniform3iv(t,i){Qp(this._nameToUniform3,t,i)&&this._context.gl.uniform3iv(this._getUniformLocation(t),i)}setUniform4iv(t,i){Qp(this._nameToUniform4,t,i)&&this._context.gl.uniform4iv(this._getUniformLocation(t),i)}setUniform1f(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){Qp(this._nameToUniform1v,t,i)&&this._context.gl.uniform1fv(this._getUniformLocation(t),i)}setUniform2f(t,i,r){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),this._nameToUniform2.set(t,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s[0]=i,s[1]=r)}setUniform2fv(t,i){Qp(this._nameToUniform2,t,i)&&this._context.gl.uniform2fv(this._getUniformLocation(t),i)}setUniform3f(t,i,r,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),this._nameToUniform3[t]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(t,i){Qp(this._nameToUniform3,t,i)&&this._context.gl.uniform3fv(this._getUniformLocation(t),i)}setUniform4f(t,i,r,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),this._nameToUniform4.set(t,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(t,i){Qp(this._nameToUniform4,t,i)&&this._context.gl.uniform4fv(this._getUniformLocation(t),i)}setUniformMatrix3fv(t,i,r=!1){Qp(this._nameToUniformMatrix3,t,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i)}setUniformMatrix4fv(t,i,r=!1){Qp(this._nameToUniformMatrix4,t,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i)}stop(){}}function Hce(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),PR()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===gu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(tvt(i))),s}function tvt(e){let t=2;return e.replace(/\n/g,()=>`
`+ivt(t++)+":")}function ivt(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function Qp(e,t,i){const r=e.get(t);return r?Kq(r,i):(e.set(t,Array.from(i)),!0)}class rvt{constructor(t){this._rctx=t,this._store=new FQ}dispose(){this._store.forEach(t=>t.forEach(i=>i.dispose())),this._store.clear()}acquire(t,i,r,s){const n=this._store.get(t,i);if(_(n))return n.ref(),n;const o=new evt(this._rctx,t,i,r,s);return o.ref(),this._store.set(t,i,o),o}get test(){let t=0;return this._store.forEach(i=>i.forEach(r=>t+=r.hasGLName?2:1)),{cachedWebGLObjects:t}}}function qce(e,t){const i=new Or(e,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE},{target:mt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1});function r(b,S){const T=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,E=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,C=e.programCache.acquire(T,E,new Map([["position",0]])),A=new Float32Array(6);xH(b,A,3);const I=new Float32Array(6);return xH(S,I,3),e.useProgram(C),C.setUniform3f("u_highA",A[0],A[2],A[4]),C.setUniform3f("u_lowA",A[1],A[3],A[5]),C.setUniform3f("u_highB",I[0],I[2],I[4]),C.setUniform3f("u_lowB",I[1],I[3],I[5]),C}const s=si.createVertex(e,_i.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new qs(e,new Map([["position",0]]),{geometry:[new go("position",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Fe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Fe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=r(o,a),c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(It.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);i.readPixels(0,0,1,1,ze.RGBA,St.UNSIGNED_BYTE,y),l.dispose(),n.dispose(!1),s.dispose(),i.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c);const v=(o[2]-a[2])/25,w=wQ(y);return Math.abs(v-w)}var Wce,Xce,Yce,uEe={exports:{}};function svt(e){var y,v,w,b,S;if(!e.gl)return!1;if(e.type===li.WEBGL1)return!(!((y=e.capabilities.textureFloat)==null?void 0:y.textureFloat)||!((v=e.capabilities.colorBufferFloat)==null?void 0:v.textureFloat));if(!(((w=e.capabilities.textureFloat)==null?void 0:w.textureFloat)&&((b=e.capabilities.colorBufferFloat)==null?void 0:b.textureFloat)&&((S=e.capabilities.colorBufferFloat)==null?void 0:S.floatBlend)))return!1;const t=new Or(e,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE},{target:mt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.FLOAT,internalFormat:gt.RGBA32F,samplingMode:tt.NEAREST,width:1,height:1}),i=si.createVertex(e,_i.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new qs(e,new Map([["a_pos",0]]),{geometry:[new go("a_pos",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:i}),s=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,n=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,o=e.programCache.acquire(s,n,new Map([["a_pos",0]]));e.useProgram(o);const a=e.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays(It.TRIANGLE_STRIP,0,4);const f=Ut({blending:ixe});e.setPipelineState(f),e.drawArrays(It.TRIANGLE_STRIP,0,4),uEe.exports.init(e);const m=e.gl.getError();return e.setViewport(l,c,h,p),e.bindFramebuffer(a),o.dispose(),r.dispose(!1),i.dispose(),t.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}Wce=uEe,Xce=function(){var e=function(v){window.console&&window.console.log&&window.console.log(v)},t=function(v){window.console&&window.console.error?window.console.error(v):e(v)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(v){if(r==null)for(var w in r={},s={},v)typeof v[w]=="number"&&(r[v[w]]=w,s[w]=v[w])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(v){return o(),r[v]!==void 0}function l(v){o();var w=r[v];return w!==void 0?"gl."+w:"/*UNKNOWN WebGL ENUM*/ 0x"+v.toString(16)}function c(v,w,b,S){var T;if((T=i[v])!==void 0&&(T=T[w])!==void 0&&T[b]){if(typeof T[b]=="object"&&T[b].enumBitwiseOr!==void 0){for(var E=T[b].enumBitwiseOr,C=0,A=[],I=0;I<E.length;++I){var L=s[E[I]];(S&L)!=0&&(C|=L,A.push(l(L)))}return C===S?A.join(" | "):l(S)}return l(S)}return S===null?"null":S===void 0?"undefined":S.toString()}function h(v,w){for(var b="",S=w.length,T=0;T<S;++T)b+=(T==0?"":", ")+c(v,S,T,w[T]);return b}function p(v,w,b){v.__defineGetter__(b,function(){return w[b]}),v.__defineSetter__(b,function(S){w[b]=S})}function f(v,w,b,S){S=S||v,n(v),w=w||function(L,D,U){for(var z="",V=U.length,X=0;X<V;++X)z+=(X==0?"":", ")+c(D,V,X,U[X]);t("WebGL error "+l(L)+" in "+D+"("+z+")")};var T={};function E(L,D){return function(){b&&b(D,arguments);var U=L[D].apply(L,arguments),z=S.getError();return z!=0&&(T[z]=!0,w(z,D,arguments)),U}}var C={};for(var A in v)if(typeof v[A]=="function")if(A!="getExtension")C[A]=E(v,A);else{var I=E(v,A);C[A]=function(){return f(I.apply(v,arguments),w,b,S)}}else p(C,v,A);return C.getError=function(){for(var L in T)if(T.hasOwnProperty(L)&&T[L])return T[L]=!1,L;return v.NO_ERROR},C}function m(v){var w=v.getParameter(v.MAX_VERTEX_ATTRIBS),b=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,b);for(var S=0;S<w;++S)v.disableVertexAttribArray(S),v.vertexAttribPointer(S,4,v.FLOAT,!1,0,0),v.vertexAttrib1f(S,0);v.deleteBuffer(b);var T=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);for(S=0;S<T;++S)v.activeTexture(v.TEXTURE0+S),v.bindTexture(v.TEXTURE_CUBE_MAP,null),v.bindTexture(v.TEXTURE_2D,null);for(v.activeTexture(v.TEXTURE0),v.useProgram(null),v.bindBuffer(v.ARRAY_BUFFER,null),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.disable(v.BLEND),v.disable(v.CULL_FACE),v.disable(v.DEPTH_TEST),v.disable(v.DITHER),v.disable(v.SCISSOR_TEST),v.blendColor(0,0,0,0),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.ONE,v.ZERO),v.clearColor(0,0,0,0),v.clearDepth(1),v.clearStencil(-1),v.colorMask(!0,!0,!0,!0),v.cullFace(v.BACK),v.depthFunc(v.LESS),v.depthMask(!0),v.depthRange(0,1),v.frontFace(v.CCW),v.hint(v.GENERATE_MIPMAP_HINT,v.DONT_CARE),v.lineWidth(1),v.pixelStorei(v.PACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1),v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),v.UNPACK_COLORSPACE_CONVERSION_WEBGL&&v.pixelStorei(v.UNPACK_COLORSPACE_CONVERSION_WEBGL,v.BROWSER_DEFAULT_WEBGL),v.polygonOffset(0,0),v.sampleCoverage(1,!1),v.scissor(0,0,v.canvas.width,v.canvas.height),v.stencilFunc(v.ALWAYS,0,4294967295),v.stencilMask(4294967295),v.stencilOp(v.KEEP,v.KEEP,v.KEEP),v.viewport(0,0,v.canvas.width,v.canvas.height),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT);v.getError(););}function y(v){var w,b,S=[],T=[],E={},C=1,A=!1,I=[],L=0,D=0,U=!1,z=0,V={};function X(G){return typeof G=="function"?G:function(te){G.handleEvent(te)}}v.getContext=(b=v.getContext,function(){var G=b.apply(v,arguments);if(G instanceof WebGLRenderingContext){if(G!=w){if(w)throw"got different context";E=ee(w=G)}return E}return G});var Z=function(G){S.push(X(G))},ae=function(G){T.push(X(G))};function re(G){var te=G.addEventListener;G.addEventListener=function(fe,xe,Le){switch(fe){case"webglcontextlost":Z(xe);break;case"webglcontextrestored":ae(xe);break;default:te.apply(G,arguments)}}}function $(){for(var G=Object.keys(V),te=0;te<G.length;++te)delete V[G]}function k(){++D,A||L==D&&v.loseContext()}function B(G,te){var fe=G[te];return function(){if(k(),!A)return fe.apply(G,arguments)}}function H(){for(var G=0;G<I.length;++G){var te=I[G];te instanceof WebGLBuffer?w.deleteBuffer(te):te instanceof WebGLFramebuffer?w.deleteFramebuffer(te):te instanceof WebGLProgram?w.deleteProgram(te):te instanceof WebGLRenderbuffer?w.deleteRenderbuffer(te):te instanceof WebGLShader?w.deleteShader(te):te instanceof WebGLTexture&&w.deleteTexture(te)}}function Y(G){return{statusMessage:G,preventDefault:function(){U=!0}}}return re(v),v.loseContext=function(){if(!A){for(A=!0,L=0,++C;w.getError(););$(),V[w.CONTEXT_LOST_WEBGL]=!0;var G=Y("context lost"),te=S.slice();setTimeout(function(){for(var fe=0;fe<te.length;++fe)te[fe](G);z>=0&&setTimeout(function(){v.restoreContext()},z)},0)}},v.restoreContext=function(){A&&T.length&&setTimeout(function(){if(!U)throw"can not restore. webglcontestlost listener did not call event.preventDefault";H(),m(w),A=!1,D=0,U=!1;for(var G=T.slice(),te=Y("context restored"),fe=0;fe<G.length;++fe)G[fe](te)},0)},v.loseContextInNCalls=function(G){if(A)throw"You can not ask a lost contet to be lost";L=D+G},v.getNumCalls=function(){return D},v.setRestoreTimeout=function(G){z=G},v;function ee(G){for(var te in G)typeof G[te]=="function"?E[te]=B(G,te):p(E,G,te);E.getError=function(){if(k(),!A)for(;Ce=w.getError();)V[Ce]=!0;for(var Ce in V)if(V[Ce])return delete V[Ce],Ce;return E.NO_ERROR};for(var fe=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],xe=0;xe<fe.length;++xe){var Le=fe[xe];E[Le]=function(Ce){return function(){if(k(),A)return null;var Pe=Ce.apply(G,arguments);return Pe.__webglDebugContextLostId__=C,I.push(Pe),Pe}}(G[Le])}var _e=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(xe=0;xe<_e.length;++xe)Le=_e[xe],E[Le]=function(Ce){return function(){return k(),A?null:Ce.apply(G,arguments)}}(E[Le]);var ye=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(xe=0;xe<ye.length;++xe)Le=ye[xe],E[Le]=function(Ce){return function(){return k(),!A&&Ce.apply(G,arguments)}}(E[Le]);return E.checkFramebufferStatus=function(Ce){return function(){return k(),A?E.FRAMEBUFFER_UNSUPPORTED:Ce.apply(G,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Ce){return function(){return k(),A?-1:Ce.apply(G,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Ce){return function(){return k(),A?0:Ce.apply(G,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return A},E}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:y,resetToInitialState:m}},(Yce=Xce())!==void 0&&(Wce.exports=Yce);const nvt=ge.getLogger("esri.views.WebGLDriverTest");function ovt(e){const t=new Or(e,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE},{target:mt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1}),i=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,r=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=si.createVertex(e,_i.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new qs(e,new Map([["a_position",0]]),{geometry:[new go("a_position",2,dt.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire(i,r,new Map([["a_pos",0]]));e.useProgram(a);const l=new ot(e,{target:mt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);const{x:h,y:p,width:f,height:m}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(o),e.drawArrays(It.TRIANGLE_STRIP,0,4),e.setViewport(h,p,f,m),t.readPixels(0,0,1,1,ze.RGBA,St.UNSIGNED_BYTE,s),a.dispose(),o.dispose(!1),n.dispose(),t.dispose();const y=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return y&&nvt.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(c),y}new go("a_pos",2,dt.BYTE,0,2);new go("a_pos",2,dt.BYTE,0,4),new go("a_tex",2,dt.BYTE,2,4);const avt={geometry:[new go("a_pos",2,dt.UNSIGNED_SHORT,0,4)]};async function lvt(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new Or(e,{colorTarget:ss.TEXTURE,depthStencilTarget:Ai.NONE},{target:mt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1}),r=si.createVertex(e,_i.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new qs(e,new Map([["a_pos",0]]),avt,{geometry:r}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,o=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,a=e.programCache.acquire(n,o,new Map([["a_pos",0]]));e.useProgram(a);const l=new ot(e,{dataType:St.UNSIGNED_BYTE,pixelFormat:ze.RGBA,preMultiplyAlpha:!1,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR},t);e.bindTexture(l,0),a.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(tr.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays(It.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return i.readPixels(0,0,1,1,ze.RGBA,St.UNSIGNED_BYTE,y),a.dispose(),s.dispose(!1),r.dispose(),i.dispose(),l.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c),t.src="",y[0]===255}class cvt{constructor(t){this.context=t,this._floatBufferBlendWorking=svt(t),lvt(t).then(i=>this._svgAlwaysPremultipliesAlpha=!i)}get floatBufferBlendWorking(){if(M(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(M(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(M(this._doublePrecisionRequiresObfuscation)){const t=qce(this.context,!1),i=qce(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(i===0||t/i>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return M(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=ovt(this.context)),this._ignoresSamplerPrecision}}class Zce{constructor(t,i,r,s,n,o,a,l){this.createQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=s,this.beginTimeElapsed=n,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}function uvt(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&zn(e)?new Zce(()=>e.createQuery(),r=>e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),r=>e.getQueryParameter(r,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>e.beginQuery(i.TIME_ELAPSED_EXT,r),()=>e.endQuery(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new Zce(()=>i.createQueryEXT(),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,r),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function hvt(e,t){if(t.disjointTimerQuery)return null;if(zn(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function dvt(e){if(zn(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function pvt(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function fvt(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function mvt(e,t){if(zn(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function gvt(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function yvt(e,t){if(zn(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function vvt(e,t){if(zn(e)){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function OA(e,t,i,r,s){if(r&&zn(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function _vt(e,t){if(!zn(e)||t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function bvt(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function wvt(e,t){if(zn(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class xvt{constructor(t,i){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=hvt(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=dvt(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=wvt(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=pvt(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=fvt(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=gvt(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=uvt(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=yvt(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=vvt(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=mvt(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=OA(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=OA(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=OA(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=OA(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=bvt(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=_vt(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=OA(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}class Tvt{constructor(t,i){this.gl=t,this.instanceCounter=new $0t,this.programCache=new rvt(this),this._state=new Dce,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=zn(t)?li.WEBGL2:li.WEBGL1,this._loadExtensions(),this.configure(i)}configure(t){this._capabilities=new xvt(this.gl,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Dce,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new sqe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new cvt(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),zn(this.gl)&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,xh()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,i){for(let r=0;r<t.length;++r)this._state.textureUnitMap[t[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,i,r,s){t===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,i,r,s),this._state.blendColor.r=t,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,i){t===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,i),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,i,r,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,i,r,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,i){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(t,i),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(t,i,r,s){this._state.colorMask.r===t&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(t,i,r,s),this._state.colorMask.r=t,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,i,r,s){this._state.clearColor.r===t&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(t,i,r,s),this._state.clearColor.r=t,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,i){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=i,this.gl.polygonOffset(t,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,i,r,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(t,i,r,s),this._state.scissorRect.x=t,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,i){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===i||(this.gl.depthRange(t,i),this._state.depthRange.zNear=t,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,i,r){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(t,i,r),this._state.stencilFunction.face=hp.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,i,r,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,i,r,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,i,r){this._state.stencilOperation.face===hp.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(t,i,r),this._state.stencilOperation.face=hp.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,i,r,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,i,r,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,i=!1){const r=this._state.activeTexture;return t>=0&&(i||t!==this._state.activeTexture)&&(this.gl.activeTexture(lV+t),this._state.activeTexture=t),r}clear(t){t&&this.gl.clear(t)}clearSafe(t,i=255){t&&(t&tr.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&tr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&tr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(t))}drawArrays(t,i,r){if(xh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Qce(t,r)),this.gl.drawArrays(t,i,r),xh()){const s=fse(this);s&&console.error("drawArrays:",s)}}drawElements(t,i,r,s){var n;if(xh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Qce(t,i)),this.gl.drawElements(t,i,r,s),xh()){const o=fse(this);if(o){const a=this.getBoundVAO(),l=a==null?void 0:a.indexBuffer,c=a==null?void 0:a.vertexBuffers,h={indexBuffer:l,vertexBuffers:c},p={mode:t,count:i,type:r,offset:s},f=(n=Qi(l,v=>v.size))!=null?n:0,m=s+i,y=f<m?`. Buffer is too small. Attempted to draw index ${m} of ${f}`:"";console.error(`drawElements: ${o}${y}`,{args:p,vao:h})}}}logInfo(){xh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){xh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===i&&n.width===r&&n.height===s||(n.x=t,n.y=i,n.width=r,n.height=s,this.gl.viewport(t,i,r,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var i,r;this._state.program!==t&&((i=this._state.program)==null||i.stop(),this._state.program=t,this.gl.useProgram((r=t==null?void 0:t.glName)!=null?r:null))}bindTexture(t,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return M(t)||t.glName==null?(_(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==t?(this.setActiveTexture(i,r),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[i]=t,s):(t.isDirty&&(this.setActiveTexture(i,r),t.applyChanges()),s)}unbindTexture(t){if(!M(t))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===t&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(t,i=!1){if(i||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(M(t))return this.gl.bindFramebuffer(Fn.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(Fn.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,i,r=!1){const s=i===Fn.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==t)&&(M(t)?this.gl.bindFramebuffer(i,null):t.initializeAndBind(i),s?this._state.readFramebuffer=ft(t,null):this._state.drawFramebuffer=ft(t,null))}blitFramebuffer(t,i,r=0,s=0,n=t.width,o=t.height,a=0,l=0,c=i.width,h=i.height,p=tr.COLOR_BUFFER_BIT,f=tt.NEAREST){this.bindFramebufferSeparate(t,Fn.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Fn.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,p,f)}bindBuffer(t,i){if(t)switch(i!=null||(i=t.bufferType),i){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Bl(this.gl,t,i,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Bl(this.gl,t,i,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Bl(this.gl,t,i,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Bl(this.gl,t,i,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Bl(this.gl,t,i,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Bl(this.gl,t,i,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Bl(this.gl,t,i,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const i=this.gl;t||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(i.bindRenderbuffer(i.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return M(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(t,i,r){const s=this._getBufferBinding(t,i);M(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(t,i,r,s,n){const o=this._getBufferBinding(t,i);if(!M(o)&&!(o.buffer===r&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n}}bindUBO(t,i,r,s){M(i)?this.bindBufferBase(wt.UNIFORM_BUFFER,t,null):(xh()&&(s!=null?s:i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(wt.UNIFORM_BUFFER,t,i.buffer,r,s):this.bindBufferBase(wt.UNIFORM_BUFFER,t,i.buffer))}unbindUBO(t){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];_(s)&&s.buffer===t.buffer&&this.bindBufferBase(wt.UNIFORM_BUFFER,i,null)}}unbindBuffer(t){switch(t){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Bl(this.gl,null,t,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Bl(this.gl,null,t,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Bl(this.gl,null,t,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Bl(this.gl,null,t,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Bl(this.gl,null,t,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Bl(this.gl,null,t,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Bl(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){M(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const i=this.gl,r=i.fenceSync(dH.SYNC_GPU_COMMANDS_COMPLETE,0);let s;this.instanceCounter.increment(Tn.Sync,r),i.flush();do await S2(t),s=i.clientWaitSync(r,0,0);while(s===v4.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Tn.Sync,r),i.deleteSync(r),s===v4.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=Fn.FRAMEBUFFER){return t===Fn.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),zn(this.gl)&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(Me.ONE,Me.ZERO),this.setBlendEquation(py.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(hp.BACK),this.setFrontFace(aE.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(yr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(yr.ALWAYS,0,0),this.setStencilOp(os.KEEP,os.KEEP,os.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n,o,a,l;const t=this.gl,i=this.capabilities.vao;i&&i.bindVertexArray(null);for(let c=0;c<this.parameters.maxVertexAttributes;c++)t.disableVertexAttribArray(c);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(wt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(wt.ELEMENT_ARRAY_BUFFER,null),zn(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(wt.UNIFORM_BUFFER,null);for(let c=0;c<this._parameters.maxUniformBufferBindings;c++){const h=this._state.uniformBufferBindingPoints[c];if(_(h)){const{buffer:p,offset:f,size:m}=h;p!==null?f===0&&m===0?t.bindBufferBase(wt.UNIFORM_BUFFER,c,p.glName):t.bindBufferRange(wt.UNIFORM_BUFFER,c,p.glName,f,m):t.bindBufferBase(wt.UNIFORM_BUFFER,c,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(wt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(wt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(wt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(wt.COPY_WRITE_BUFFER,null),t.bindFramebuffer(Fn.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(Fn.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(su.COLOR_ATTACHMENT0)),t.bindFramebuffer(Fn.DRAW_FRAMEBUFFER,(s=(r=this._state.drawFramebuffer)==null?void 0:r.glName)!=null?s:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(Fn.FRAMEBUFFER,(o=(n=this._state.drawFramebuffer)==null?void 0:n.glName)!=null?o:null);if(i&&this._state.vertexArrayObject){const c=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(c)}t.useProgram((l=(a=this._state.program)==null?void 0:a.glName)!=null?l:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let c=0;c<this.parameters.maxTextureImageUnits;c++){t.activeTexture(lV+c),t.bindTexture(mt.TEXTURE_2D,null),t.bindTexture(mt.TEXTURE_CUBE_MAP,null),zn(t)&&(t.bindTexture(mt.TEXTURE_3D,null),t.bindTexture(mt.TEXTURE_2D_ARRAY,null));const h=this._state.textureUnitMap[c];_(h)&&t.bindTexture(h.descriptor.target,h.glName)}t.activeTexture(lV+this._state.activeTexture),t.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===li.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var a;const i=this.capabilities.textureFilterAnisotropic,r=(a=t.maxAnisotropy)!=null?a:1/0,s=zn(this.gl),n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return ot.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}}function Bl(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function Qce(e,t){switch(e){case It.POINTS:return 2*t;case It.TRIANGLES:return t/3;case It.TRIANGLE_STRIP:case It.TRIANGLE_FAN:return t-2;default:return 0}}class Svt extends Tvt{constructor(t,i,r){super(t,i),this.newCache=r,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,i,r,s){this.useProgram(t.program);const n=_(r)?r.slot:null;return t.bindPipelineState(this,n,s),_(i)&&_(r)&&t.bindPass(i,r),t.program}get test(){return this.programCache.test}}const hEe=ge.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let uS=class extends Se{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new as,this._frameTask=e.resourceController.scheduler.registerTask(yt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(Mp.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return M(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(T3,new VQ)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),ft(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",ks.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(M(t))return pt(t!==void 0),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new Evt(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),_(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,Qr(a)||hEe.error(a),null);return Bu(s)?s.then(n,o):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",ks.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],uS.prototype,"_loadingCount",void 0),u([d()],uS.prototype,"_frameTask",void 0),u([d()],uS.prototype,"updating",null),uS=u([P("esri.views.3d.webgl-engine.lib.TextureRepository")],uS);class Evt{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(hEe.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const Cvt=ge.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let QM=class extends Se{constructor(){super(...arguments),this._data=new Array,this._state=ac.NOT_LOADED}dispose(){this._state=ac.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this._state===ac.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[Li("esri/images/materials/water/normals.jpg"),Li("esri/images/materials/water/perturbation.jpg")];this._state=ac.LOADING,Promise.all(t.map(i=>Cp(i))).then(i=>{i.forEach(r=>this._data.push(new ot(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.REPEAT,samplingMode:tt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:r.width,height:r.height},r))),this._state=ac.LOADED}).catch(i=>{Cvt.error("Failed to load textures for water material.",i),this._state=ac.NOT_LOADED})}bind(e){this._state===ac.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};u([d()],QM.prototype,"_state",void 0),u([d({type:Boolean,readOnly:!0})],QM.prototype,"updating",null),QM=u([P("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],QM);class Avt extends wU{constructor(t,i,r,s,n,o){super(),this._rctx=t,this._renderScene=i,this._requestRenderScene=r,this._renderOverlay=s,this._forceCameraHook=n,this._disposeOffscreenBuffers=o,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(ks.BACKGROUND);const i=bp();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t){for(const i of this._screenshotQueue){if(this.isDisposed){i.resolver.reject();continue}const r=me(F({},i.settings),{pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio}),s=this._renderScreenshot(t,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){if(M(this._renderOverlay))return i;t.width=i.width,t.height=i.height;const s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderOverlay(t,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(t,i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=bB(r,s,a);this._rctx.gl.readPixels(0,0,r,s,ze.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,me(F({},t),{region:null}));const c=bB(n.width,n.height,a);return Ont(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){const{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=bB(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,ze.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,i){let r=null;const s=t.viewCamera,{framebufferWidth:n,framebufferHeight:o}=i;let a=!1;const l=i.disableDecorations&&t.frameHasDecorations,c=n!==s.fullWidth||o!==s.fullHeight,h=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,p=c||l||h;if(p){const y=s.clone();if(i.ignorePadding){const b=ok(y.padding);for(let S=0;S<4;S++)b[S]=Math.round(b[S]/y.pixelRatio*i.pixelRatio);y.padding=b}y.fullWidth=n,y.fullHeight=o,y.pixelRatio=i.pixelRatio;const v=s.fovX-y.fovX,w=s.fovY-y.fovY;v<0&&v<w?y.fovX=s.fovX:w<0&&w<v&&(y.fovY=s.fovY),this._forceCameraHook(y),a=!0,r=new Or(this._rctx,{width:y.fullWidth,height:y.fullHeight,colorTarget:ss.TEXTURE,depthStencilTarget:Ai.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(r,y,i.disableDecorations?Nw.OFF:Nw.ON),this._disposeOffscreenBuffers()}const f=()=>{this._rctx.bindFramebuffer(null),Qe(r)},m=this._readbackScreenshot(i,f);if(f(),p&&!this._rctx.contextAttributes.alpha)for(let y=3;y<m.data.length;y+=4)m.data[y]=255;return a&&this._forceCameraHook(s),m}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const Jce=ge.getLogger("esri.views.3d.webgl-engine.parts.View");let Po=class extends bU(Se){constructor(e){super({}),this.events=new as,this.waterTextureRepository=new QM,this._magnifierHelper=new cS,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),se(()=>{var t;return(t=this.waterTextureRepository)==null?void 0:t.updating},()=>this.requestRender(),At),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new yTe(this._rctx),this._shaderTechniqueRepository=new zxe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new uS(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new Vxe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new zgt(this._rctx,this._shaderTechniqueRepository),this._renderer=new _g(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,i)=>e.schedule(t,i),e),this._screenshotManager=new Avt(this._rctx,(t,i,r)=>this._renderer.render(t,i,i,r),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Vs(this._frameTask),this._shaderTechniqueRepository=Qe(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=ks.UPDATE){e===ks.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,i,r,s){this._renderer.readHUDVisibility(e,t,i,r,s)}getMinimalDepthForArea(e,t,i,r,s,n=s){const o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(r,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=Hgt(4*c,a,r.nearFar);l>h&&h!==r.nearFar[0]&&h!==r.nearFar[1]&&(l=h)}if(_(e)){const c=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);_(c)&&l>c&&c!==r.nearFar[0]&&c!==r.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(M(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){jSe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1};let r=!1,s=ks.BACKGROUND,n=!1;const o={preRender:a=>{r=this.updating,s=this._needsUpdate?ks.UPDATE:ks.BACKGROUND,e.processSyncLayers();const l=a.time-this._lastAnimationUpdate;(l>this.animationTimestep||_(this.forcedAnimationTime)||r||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:l,forcedTime:this.forcedAnimationTime})&&this.requestRender(ks.BACKGROUND),this._lastAnimationUpdate=a.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,Nw.ON),n=!0,a&&this._renderer.hasWaterReflection&&(this.requestRender(ks.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=vw(o)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},r=nqe("3d",this._canvas,i);if(M(r)){const n=he("esri-force-webgl");Jce.error(n)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&Jce.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&he("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new Svt(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return M(this._componentObjectCollection)&&(this._componentObjectCollection=new Ngt(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],Po.prototype,"updating",null),u([Io()],Po.prototype,"_rctx",void 0),u([Io()],Po.prototype,"_container",void 0),u([Io()],Po.prototype,"_canvas",void 0),u([Io()],Po.prototype,"_stippleTextureRepository",void 0),u([Io(),d()],Po.prototype,"waterTextureRepository",void 0),u([Io(),d()],Po.prototype,"_magnifierHelper",void 0),u([Io(),d()],Po.prototype,"_textureRepository",void 0),u([Io()],Po.prototype,"_compositingHelper",void 0),u([Io()],Po.prototype,"_renderer",void 0),u([Io()],Po.prototype,"_screenshotManager",void 0),u([Io()],Po.prototype,"componentObjectCollection",null),u([Io()],Po.prototype,"_componentObjectCollection",void 0),u([d()],Po.prototype,"_needsUpdate",void 0),u([d()],Po.prototype,"_needsWaterReflectionUpdate",void 0),Po=u([P("esri.views.3d.webgl-engine.parts.RenderView")],Po);var qN;let al=qN=class extends bU(Se){constructor(e){super(e),this._handles=new jt,this._model=new UN,this._layers=new Gt,this._changeSet=new eTe,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Po(this)),this._frameTask=this.resourceController.scheduler.registerTask(yt.STAGE,this),this._handles.add(this._frameTask)}destroy(){Ww.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),q4(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){M(e)||(this.renderView.requestRender(),this._model.remove(e),q4(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){_(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){_(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){M(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>M(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;qN.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),qN.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===lE.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),s=()=>{tle(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(Bu(r))return r.then(s);s()}removeRenderPlugin(e){tle(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(i=>i.type===t).length,model:e._model}}};al.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},u([d({constructOnly:!0})],al.prototype,"resourceController",void 0),u([d({constructOnly:!0})],al.prototype,"options",void 0),u([d({constructOnly:!0})],al.prototype,"state",void 0),u([d({constructOnly:!0})],al.prototype,"sceneIntersectionHelper",void 0),u([d({readOnly:!0})],al.prototype,"viewingMode",null),u([d({constructOnly:!0})],al.prototype,"container",void 0),u([d({constructOnly:!0})],al.prototype,"renderSR",void 0),u([d({constructOnly:!0})],al.prototype,"_handles",void 0),u([d({readOnly:!0})],al.prototype,"updating",null),u([d({constructOnly:!0})],al.prototype,"_model",void 0),u([Io(),d()],al.prototype,"renderView",void 0),al=qN=u([P("esri.views.3d.webgl-engine.Stage")],al);function dEe(e){return Om(e)&&e.intersector===Br.PCL&&!!e.target}function mz(e){return Om(e)&&e.intersector===Br.I3S&&!!e.target}function Mvt(e){return Om(e)&&e.intersector===Br.TERRAIN&&!!e.target}function pEe(e){return Om(e)&&e.intersector===Br.OVERLAY&&!!e.target}function $J(e){return Om(e)&&e.intersector===Br.LOD&&!!e.target}function Kce(e,t){var i;return Qk(e)||Jk(e)?TP(e.target.object.metadata,t):Mvt(e)?(i=t.map)==null?void 0:i.ground:dEe(e)||mz(e)||pEe(e)?TP(e.target,t):null}function J2t(e,t){const i=Oq(e,t);return _(i)&&i.type==="graphic"?i.graphic:null}function Oq(e,t){if(M(e))return null;if(Qk(e)||Jk(e))return eue(e.target.object.metadata,t);if(dEe(e)){const i=e.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return pEe(e)||$J(e)?eue(e.target,t):mz(e)?Ovt(e.target,t):null}function eue(e,t){if(M(e)||M(e.graphicUid))return null;const i=TP(e,t);if(M(i))return null;if(i===t.graphics)return M(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||M(e.graphicUid)?null:"getHit"in r?r.getHit(e.graphicUid):null}function Ovt(e,t){const i=TP(e,t);if(M(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?Pvt(r.getGraphicFromIntersectorTarget(e)):null}function Rvt(e,t){const i=TP(e,t);if(M(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}function Pvt(e){return _(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function TP(e,t){return M(e.layerUid)?null:_(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function K2t(e,t){if(Qk(e)||Jk(e))return Wg(e.target.object.boundingVolumeWorldSpace.bounds);if($J(e)){Wfe(VD,e.transformation);const i=Math.max(VD[0],VD[1],VD[2]);return e.target.baseBoundingSphere.radius*i}return mz(e)?Qi(Rvt(e.target,t),i=>.5*Rpe(i)):null}function eEt(e){return!Qk(e)&&!Jk(e)&&($J(e)?e.target.numLodLevels>1:!!mz(e))}const VD=R();async function Ivt(e,t){if(e.type==="2d")return e.hitTest(t);const i=await e.hitTest(t);if(i.results.length===0)return i;const r=i.results[0],s=_(r.distance)?r.distance*(1+$vt):r.distance,n=i.results.findIndex(o=>o.distance>s);return n!==-1&&(i.results=i.results.slice(0,n)),i}const $vt=.05;let x8,T8;function Dvt(e){const t=S1e(e);for(;t.length>1;){const i=tue(t.shift());if(i.available)return i}return tue(t.shift())}function tue(e){switch(e){case li.WEBGL1:return Lvt();case li.WEBGL2:return Nvt()}}function Lvt(){return x8||(x8=Uvt()),x8}function Nvt(){return T8||(T8=zvt()),T8}class fEe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class Fvt extends fEe{constructor(){super(...arguments),this.type=li.WEBGL1}}class kvt extends fEe{constructor(){super(...arguments),this.type=li.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function mEe(e,t){var n;if(e===li.WEBGL1&&typeof WebGLRenderingContext===void 0||e===li.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const i=document.createElement("canvas");if(!i)return null;let r=_4(i,e,{failIfMajorPerformanceCaveat:!0});if(M(r)&&(r=_4(i,e),_(r)&&(t.majorPerformanceCaveat=!0)),M(r))return r;if(e===li.WEBGL1){const o=(n=r.getParameter(r.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),r}function Uvt(){const e=new Fvt,t=mEe(li.WEBGL1,e);return M(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function zvt(){const e=new kvt,t=mEe(li.WEBGL2,e);return M(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function Vvt(e){const t=Dvt(e);if(!t.available)return new q("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new q("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new q("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new q("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===li.WEBGL1){if(!t.supportsElementIndexUint)return new q("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new q("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new q("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Bvt(e){return e&&"nodeType"in e}function Gvt(e){return e&&typeof e.render=="function"}const iue={component:"esri-component"};let gb=class extends Se{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(iue.component),t&&t.classList.remove(iue.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||Bvt(e)?(this._set("widget",null),BP(e)):(Gvt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],gb.prototype,"id",null),u([d()],gb.prototype,"node",null),u([Rt("node")],gb.prototype,"castNode",null),u([d({readOnly:!0})],gb.prototype,"widget",void 0),gb=u([P("esri.views.ui.Component")],gb);const WN=gb,jvt={left:0,top:0,bottom:0,right:0},gEe={bottom:30,top:15,right:15,left:15},S8="manual",el={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function Hvt(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function E8(e){const t=e,i=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(i===null||i===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function C8(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let bg=class extends as.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new jt,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&C8(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&C8(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([se(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,At),se(()=>this.padding,this._applyUIPadding,At)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(el.ui),i5e(e),this._attachContainers(e)),t&&(t.classList.remove(el.ui),C8(t,{top:"",bottom:"",left:"",right:""}),Tfe(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:F(F({},gEe),e)}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=E8(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,i)=>t.concat(i)):(e=e||S8)===S8?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(el.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i;const r=E8(e)||E8(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof WN||(e=new WN({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof WN?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||jvt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(el.innerContainer),e.classList.add(el.cornerContainer);const t=document.createElement("div");t.classList.add(el.innerContainer),t.classList.add(el.manualContainer);const i=document.createElement("div");i.classList.add(el.topLeft),i.classList.add(el.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(el.topRight),r.classList.add(el.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(el.bottomLeft),s.classList.add(el.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(el.bottomRight),n.classList.add(el.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=Hf();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup=F({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||S8,r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if(Hvt(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(r===0)return void(s.firstChild?JK(t.node,s.firstChild):s.appendChild(t.node));r>=o.length?s.appendChild(t.node):JK(t.node,o[r])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some(r=>(t=r===e,t&&(i=r),t)),i}_findById(e){let t,i=null;return this._components.some(r=>(t=r.id===e,t&&(i=r),t)),i}_findByNode(e){let t,i=null;return this._components.some(r=>(t=r.node===e,t&&(i=r),t)),i}};u([d()],bg.prototype,"container",null),u([d()],bg.prototype,"height",null),u([d({value:gEe})],bg.prototype,"padding",null),u([Rt("padding")],bg.prototype,"castPadding",null),u([d()],bg.prototype,"view",void 0),u([d()],bg.prototype,"width",null),bg=u([P("esri.views.ui.UI")],bg);const qvt=bg;function rue(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function Wvt(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function BD(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function Xvt(e){return e.type==="bing-maps"}const v0=[];let hS=class extends Aw{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new it,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>se(()=>{var s;return[r.suspended,(s=r.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.handles.add([En(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),vo(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");v0.length=0,e?(e.forEach(t=>{var s;if(t.suspended||!((s=t.layer)==null?void 0:s.attributionVisible))return;const i=t.layer;if(rue(i,"user"))return void BD(v0,t,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(t)){const n=this._fetchedAttributionData.get(t);return void(n?BD(v0,t,this._getDynamicAttribution(n,this.view,i)):rue(i)&&BD(v0,t,i.copyright))}return void this._fetchAttributionData(t)}const r=i.get("portalItem.accessInformation");BD(v0,t,r||i.copyright)}),Wvt(this.items,v0)&&(this.items.removeAll(),this.items.addMany(v0)),v0.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Ac(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,Xvt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ze.WGS84},f={extent:qg(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)r[m]=r[m]||[],r[m].push(f)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||n==null||n<=-1)return"";const o=e[n],a=rx(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(c=>{const h=!l[c.id]&&a&&MW(c.extent,a);return h&&(l[c.id]=!0),h}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:it})],hS.prototype,"items",void 0),u([d({readOnly:!0})],hS.prototype,"state",null),u([d()],hS.prototype,"view",void 0),hS=u([P("esri.widgets.Attribution.AttributionViewModel")],hS);const yEe=hS,_0={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let ll=class extends Xs{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.iconClass=_0.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new yEe}initialize(){this.own(En(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[_0.open]:this._isOpen};return W("div",{bind:this,class:this.classes(_0.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return W("div",{class:_0.poweredBy},"Powered by"," ",W("a",{class:_0.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?"0":"",{attributionText:r}=this,s={[_0.sourcesOpen]:e,[_0.interactive]:t};return W("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(_0.sources,s),innerHTML:r,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],ll.prototype,"_isOpen",void 0),u([d()],ll.prototype,"_isInteractive",null),u([d()],ll.prototype,"_attributionTextOverflowed",void 0),u([d()],ll.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],ll.prototype,"attributionText",null),u([d()],ll.prototype,"iconClass",void 0),u([d()],ll.prototype,"itemDelimiter",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ll.prototype,"label",void 0),u([d(),js("esri/widgets/Attribution/t9n/Attribution")],ll.prototype,"messages",void 0),u([qe("viewModel.view")],ll.prototype,"view",void 0),u([d({type:yEe})],ll.prototype,"viewModel",void 0),u([ra()],ll.prototype,"_toggleState",null),ll=u([P("esri.widgets.Attribution")],ll);const Yvt=ll,Zvt="esri.widgets.CompassViewModel";let yb=class extends cZ(Se){constructor(e){super(e),this._handles=new jt,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(se(()=>this.view,this._updateRotationWatcher,At))}destroy(){this._handles=Vs(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?se(()=>e==null?void 0:e.rotation,this._updateForRotation,At):se(()=>e==null?void 0:e.camera,this._updateForCamera,At))}};u([d({readOnly:!0})],yb.prototype,"canShowNorth",null),u([d()],yb.prototype,"orientation",void 0),u([d({readOnly:!0})],yb.prototype,"state",null),u([d()],yb.prototype,"view",void 0),yb=u([P(Zvt)],yb);const vEe=yb,b0={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let wf=class extends Xs{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=b0.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new vEe}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i=t==="disabled",r=(t==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,n={[b0.disabled]:i,[b0.interactive]:!i},o={[b0.northIcon]:r,[b0.rotationIcon]:!r},{messages:a}=this;return W("div",{bind:this,class:this.classes(b0.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},W("span",{"aria-hidden":"true",class:this.classes(b0.icon,o),styles:this._toRotationTransform(e)}),W("span",{class:b0.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([qe("viewModel.goToOverride")],wf.prototype,"goToOverride",void 0),u([d()],wf.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],wf.prototype,"label",void 0),u([d(),js("esri/widgets/Compass/t9n/Compass")],wf.prototype,"messages",void 0),u([qe("viewModel.view")],wf.prototype,"view",void 0),u([d({type:vEe})],wf.prototype,"viewModel",void 0),u([ra()],wf.prototype,"_reset",null),wf=u([P("esri.widgets.Compass")],wf);const Qvt=wf;let dS=class extends Se{constructor(e){super(e),this._handles=new jt,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(vo(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],dS.prototype,"state",null),u([d()],dS.prototype,"navigationMode",void 0),u([d()],dS.prototype,"view",void 0),dS=u([P("esri.widgets.NavigationToggleViewModel")],dS);const _Ee=dS,nh={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let xf=class extends Xs{constructor(e,t){super(e,t),this.iconClass=nh.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new _Ee}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",i={[nh.disabled]:e,[nh.isLayoutHorizontal]:this.layout==="horizontal"},r={[nh.activeButton]:t},s={[nh.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return W("div",{bind:this,class:this.classes(nh.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},W("div",{class:this.classes(nh.button,nh.panButton,r)},W("span",{class:nh.panIcon})),W("div",{class:this.classes(nh.button,nh.rotateButton,s)},W("span",{class:nh.rotationIcon})))}_toggle(){this.toggle()}};u([d()],xf.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],xf.prototype,"label",void 0),u([d({value:"vertical"})],xf.prototype,"layout",null),u([d(),js("esri/widgets/NavigationToggle/t9n/NavigationToggle")],xf.prototype,"messages",void 0),u([qe("viewModel.view")],xf.prototype,"view",void 0),u([d({type:_Ee})],xf.prototype,"viewModel",void 0),u([ra()],xf.prototype,"_toggle",null),xf=u([P("esri.widgets.NavigationToggle")],xf);const Jvt=xf,RA={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Z0=class extends Xs{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[RA.disabled]:!this.enabled,[RA.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return W("div",{bind:this,class:this.classes(RA.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},W("span",{"aria-hidden":"true",role:"presentation",class:this.classes(RA.icon,i)}),W("span",{class:RA.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],Z0.prototype,"action",void 0),u([d()],Z0.prototype,"enabled",void 0),u([d()],Z0.prototype,"iconClass",void 0),u([d()],Z0.prototype,"title",void 0),u([ra()],Z0.prototype,"_triggerAction",null),Z0=u([P("esri.widgets.IconButton")],Z0);const sue=Z0;let pS=class extends Se{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([d({readOnly:!0})],pS.prototype,"canZoomIn",null),u([d({readOnly:!0})],pS.prototype,"canZoomOut",null),u([d()],pS.prototype,"view",void 0),pS=u([P("esri.widgets.Zoom.ZoomConditions2D")],pS);const Kvt=pS;let fS=class extends Se{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};u([d({readOnly:!0})],fS.prototype,"canZoomIn",null),u([d({readOnly:!0})],fS.prototype,"canZoomOut",null),u([d()],fS.prototype,"view",void 0),fS=u([P("esri.widgets.Zoom.ZoomConditions3D")],fS);const e_t=fS;let Q0=class extends Se{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Kvt({view:e}):e.type==="3d"&&(this._zoomConditions=new e_t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():N8(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():N8(e.goTo({zoomFactor:.5}))}};u([d()],Q0.prototype,"_zoomConditions",void 0),u([d({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],Q0.prototype,"canZoomIn",void 0),u([d({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],Q0.prototype,"canZoomOut",void 0),u([d({readOnly:!0})],Q0.prototype,"state",null),u([d()],Q0.prototype,"view",null),Q0=u([P("esri.widgets.Zoom.ZoomViewModel")],Q0);const bEe=Q0,PA={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let wg=class extends Xs{constructor(e,t){super(e,t),this.iconClass=PA.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new bEe}initialize(){this._zoomInButton=new sue({action:this.zoomIn.bind(this),iconClass:PA.zoomInIcon}),this._zoomOutButton=new sue({action:this.zoomOut.bind(this),iconClass:PA.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[PA.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,W("div",{class:this.classes(PA.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],wg.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],wg.prototype,"label",void 0),u([d({value:"vertical"})],wg.prototype,"layout",null),u([d(),js("esri/widgets/Zoom/t9n/Zoom")],wg.prototype,"messages",void 0),u([qe("viewModel.view")],wg.prototype,"view",void 0),u([d({type:bEe})],wg.prototype,"viewModel",void 0),wg=u([P("esri.widgets.Zoom")],wg);const t_t=wg,wEe="esri.views.ui.DefaultUI";function i_t(e){return e&&e.view!==void 0}ge.getLogger(wEe);let XN=class extends qvt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([se(()=>this.components,this._componentsWatcher.bind(this),At),se(()=>this.view,this._updateViewAwareWidgets.bind(this),At)])}_add(e,t,i,r){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const i=this._find(t),r=i&&i.widget;i_t(r)&&(r.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new WN({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new Yvt({view:this.view})}_createCompass(){return new Qvt({view:this.view})}_createNavigationToggle(){return new Jvt({view:this.view})}_createZoom(){return new t_t({view:this.view})}};u([d()],XN.prototype,"components",void 0),XN=u([P(wEe)],XN);const r_t=XN;let YN=class extends r_t{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],YN.prototype,"components",void 0),YN=u([P("esri.views.ui.3d.DefaultUI3D")],YN);const xEe=YN,Hc=ge.getLogger("esri.views.SceneView");let nt=class extends OLe(D7e(Y7e(Wje))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new dy({slicePlane:Qme},this),this._resourceController=iht(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new kH({view:this}),this.labeler=new lb({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new W2,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new Pb,this.environmentManager=new Ld,this.extent=null,this.floors=new it,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Zje({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Xct,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new xEe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new tq,this.voxelWasm=null,this.voxelWasmPromise=null,WIe(),e&&e.environment||(this._defaults.environment=new tS,this.environment=this._defaults.environment);const t=(i=null)=>{_(i)&&i.type===Yi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([En(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),se(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new JJe({view:this}),this.stateManager=new but({view:this})}initialize(){this.groundView=new X7e({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(En(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},At),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},At),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>AAe(t>0?1e3/Math.ceil(t):0),At),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,wr),this.updatingHandles.add(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),wr),this.handles.add(se(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Ki))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=lt(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=lt(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=lt(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||M(e)?(this._clippingArea=null,null):e instanceof ui?this.spatialReference&&(e=GD(e,this.spatialReference),M(e))?(Hc.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),M(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(Hc.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&_(e)?Hc.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Ve.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return M(t)||M(e)||t.spatialReference.equals(e)?t:GD(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||Ze.WGS84,i=GD(this.clippingArea,t);_(i)&&(e=_(e)?e.intersection(i):i);const r=this._get("dataExtent");return _(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||Ze.WGS84;let t;const i=n=>{const o=GD(n,e);M(o)||(_(t)?t.union(o):t=o.clone())},r=this.basemapTerrain;if(r==null?void 0:r.spatialReference){const n=r.groundExtent;i(new ui({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{!_(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(M(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof tS?e:e instanceof nE?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):tS.fromWebsceneEnvironment(e):ns(tS,e):new tS}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||_(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(M(this.state)||this.state.stationary)}set qualityProfile(e){PN.isValidProfile(e)&&(PN.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||PN.getDefaultProfile()}set slicePlane(e){if(_(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),M(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");px(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?pge(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?O_.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var r,s,n;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(t=!0,o.suspended||mP(o))return;++i,e+=o.updatingProgress}}else++i});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])_(o)&&o.updating&&(i+=.1,e+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])_(o)&&o.updating&&(++i,e+=o.updatingProgress);if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||((r=this.inputManager)==null?void 0:r.hasPendingInputs)||((n=(s=this.map)==null?void 0:s.allLayers)==null?void 0:n.some(o=>!o.isFulfilled()))),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const o=performance.now();if(e<1){const a=Math.min((o-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?o:0}return t}get viewingMode(){var i;const e=this._predeterminedViewingMode;if(_(e))return iV(e);const t=this.spatialReference;return t?_((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?iV(this.defaultsFromMap.viewingMode):wE(t,Ve.Global)?"global":"local":"global"}set viewingMode(e){this.ready?Hc.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new Eht(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return Hc.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=_(i.graphics)&&(_(i.graphics.include)||_(i.graphics.exclude)),s=Wre(e)?qre(this,e):e,n=Lg(s);i.enableDraped=i.include&&!i.include.has(tp)||i.exclude&&i.exclude.has(tp);const o=this.sceneIntersectionHelper,a=td(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?yo.ALL:yo.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=Oq(l,this);if(M(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return Hc.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=ft(e.z==null&&qf(this.elevationProvider,e),0);return Gn(e,wT,this.renderSpatialReference,t),this.state.camera.projectToScreen(wT,A8),Tp(A8[0],A8[1])}pixelSizeAt(e){return this.ready?e?(Gn(e,wT,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(wT)):0:(Hc.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return Hc.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=Wre(e)?qre(this,e):e,r=Yr(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=td(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=yo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Kce(a,this),c=_(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Om(a)?a.distanceInRenderSpace:0,layer:c}};return ji.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:i}=await Ivt(this,e);let r=null;return!(t.length===0||Math.abs(ft(t[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(M(e.parent))throw new q("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="line-of-sight"?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return Snt(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return Ent(i,this._pixelFormat())}_completeSettings(e){const t=Tnt(e,this);return t.pixelRatio/=this.state.pixelRatio,Rnt(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return ese.importLayerView(e)}hasLayerViewModule(e){return ese.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=Vvt(this.type);if(he("safari")&&he("safari")<9&&(e=new q("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:he("safari")})),_(e))throw Hc.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,i;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(i=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?i:null;return _(e)?Qre(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(_(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,Ve.Local),s=this._validateSpatialReferenceForViewingMode(e,t,Ve.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,Ve.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Ve.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!wE(e,i)&&(!!M(t)||!!Pee(t)||(!fO(t)||!M(YU(t,e,i)))&&(!Ree(t)||i!==Ve.Global))}_makeSpatialReferenceConstraints(e,t,i){if(M(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return Pee(t)&&(r||s)?!s||i===Ve.Local||uJ(t.tileInfo,t.fullExtent,e,Ve.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:Ze.WebMercator,viewingMode:i}]:[{spatialReference:r?Ze.WGS84:Ze.WebMercator,viewingMode:i}]:fO(t)||Ree(t)||!r&&!s?fO(t)&&r&&i!==Ve.Global?[{spatialReference:e,viewingMode:i},{spatialReference:Ze.WGS84,viewingMode:Ve.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?Ze.WGS84:Ze.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=_(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(_(i)?Hc.warnOnce(`Spatial reference defined on view not supported in ${iV(i)} viewing mode.`):e.isGeographic&&Hc.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||Ze.WGS84;return un(e,this.renderSpatialReference,e,i)||(i=Ze.WGS84,un(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new at(e,i),t}trackGraphicState(e){if(!e.graphic)return Hc.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=n=>{var o;!r&&_(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return _(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return x2(e.map(i=>this.highlight(i)));if(it.isCollection(e))return x2(e.toArray().map(i=>this.highlight(i)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Yh()}maskOccludee(e){if(!e)return Hc.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=n=>{!r&&_(n)&&v7e(n)&&(i=n.maskOccludee(e))};return _(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){_(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await hR(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new q("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,WO.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,WO.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(wT)?(t=this.computeMapPointFromVec3d(wT,t),e.intersector===Br.TERRAIN&&this.basemapTerrain&&(t.z=ft(qf(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=Kce(n,this);if(_(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=Oq(n,this);if(M(a))continue;if(a.type==="graphic"){if(M(r)&&s!==e.length-1&&(r=new Set),_(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push(me(F({},a),{mapPoint:l,distance:c}))}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return M(e)||(M(e.include)||e.include.has(i))&&(M(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof Ga)s_t(i,this._getGraphicFilterUid(e)),t===WO.INCLUDE&&(_(this.graphicsView)&&e.layer===this?IA(i,this.graphicsView.processor.layer.id):e.layer&&IA(i,e.layer.uid));else if(Wue(e))for(const r of e)r===this.graphics&&_(this.graphicsView)?IA(i,this.graphicsView.processor.layer.id):r===this.map.ground?IA(i,tp):this._externalToInternalRenderItems(r,t,i);else"uid"in e&&IA(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new Eft({view:this})),this._set("elevationProvider",new jM({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new ta({view:this})),this._set("featureTiles",new ro({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var i;const t=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const r=_(this.basemapTerrain.extent)?GP(G5(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;_(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>ji.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(import("./FeatureTileTree3DDebugger.814ee50c.js")).then(({FeatureTileTree3DDebugger:i})=>{!this.featureTreeDebugger&&ji.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new i({view:this}))}):t||!this.featureTreeDebugger||ji.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},wr),this.updatingHandles.add(()=>this.clippingArea,e,wr),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,wr)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Vut(this.map,e));const t=this.state.isGlobal,i=hge(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",o5.create(this.state.viewingMode,i)),t||this.handles.add(se(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&sk(r,this.basemapTerrain.spatialReference,nue,s)&&(this.renderCoordsHelper.extent=nue)},Ki),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(_E/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){_(e)&&e.type===Yi.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(se(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),Ki),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(a,l)=>this._renderScreenshotOverlay(a,l)}},t=new Eut(this.state.viewingMode,a=>this._stage.layers.forAll(a),this);this._set("sceneIntersectionHelper",t);const i=BP(this.surface),{resourceController:r,state:s,renderSpatialReference:n}=this;this._stage=new al({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=BE(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new q("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),At),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),At),se(()=>this.magnifier,a=>this._stage.renderView.magnifier=a,wr)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:tq.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(_E/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Aht({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Oct})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await import("./GraphicsView3D.5c7bde8f.js")).default;ci(e),await hR(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),_(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Qre(this.viewingMode);if(e===Ve.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(En(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(tp);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(tp);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return M(this.voxelWasm)?(M(this.voxelWasmPromise)&&(this.voxelWasmPromise=import("./VoxelWasmPerSceneView.ccfc6e7b.js").then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){_(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function IA(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function s_t(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function GD(e,t){return _(e)&&cy(e.spatialReference,t)?GP(e,t):null}var WO;nt.type="3d",u([d()],nt.prototype,"_userClippingArea",void 0),u([d()],nt.prototype,"_resourceController",void 0),u([d()],nt.prototype,"_stage",void 0),u([d({readOnly:!0})],nt.prototype,"deconflictor",void 0),u([d({readOnly:!0})],nt.prototype,"labeler",void 0),u([d(AG(W2,"analyses"))],nt.prototype,"analyses",void 0),u([d({type:sE,readOnly:!0,aliasOf:"state.animation"})],nt.prototype,"animation",void 0),u([d({readOnly:!0})],nt.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],nt.prototype,"elevationProvider",void 0),u([d({type:Cc,aliasOf:"stateManager.camera"})],nt.prototype,"camera",void 0),u([d({type:Cc,aliasOf:"stateManager.contentCamera"})],nt.prototype,"contentCamera",void 0),u([d({readOnly:!0})],nt.prototype,"canvas",void 0),u([d({type:at,aliasOf:"stateManager.center"})],nt.prototype,"center",void 0),u([d({type:ui})],nt.prototype,"clippingArea",null),u([d({type:Pb})],nt.prototype,"constraints",void 0),u([d({type:ui,readOnly:!0})],nt.prototype,"renderDataExtent",null),u([d({type:ui,readOnly:!0})],nt.prototype,"dataExtent",null),u([d({type:ui,readOnly:!0})],nt.prototype,"groundAndLayersExtent",null),u([d({value:null,type:tS})],nt.prototype,"environment",null),u([Rt("environment")],nt.prototype,"castEnvironment",null),u([d({readOnly:!0})],nt.prototype,"environmentManager",void 0),u([d({type:ui,aliasOf:"stateManager.extent"})],nt.prototype,"extent",void 0),u([d()],nt.prototype,"floors",void 0),u([d({readOnly:!0,aliasOf:"stateManager.screenCenter"})],nt.prototype,"screenCenter",void 0),u([d({aliasOf:"stateManager.frustum"})],nt.prototype,"frustum",void 0),u([d({type:Number,readOnly:!0})],nt.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],nt.prototype,"graphicsView",void 0),u([d({readOnly:!0})],nt.prototype,"analysisViewManager",void 0),u([d()],nt.prototype,"groundView",void 0),u([d({type:Boolean})],nt.prototype,"initialExtentRequired",null),u([d()],nt.prototype,"_defaultsFromMapSettings",null),u([d({type:Boolean,readOnly:!0})],nt.prototype,"interacting",null),u([d()],nt.prototype,"stationary",null),u([d({aliasOf:"state.navigating"})],nt.prototype,"navigating",void 0),u([d()],nt.prototype,"map",void 0),u([d({readOnly:!0})],nt.prototype,"mapCoordsHelper",void 0),u([d({aliasOf:"stateManager.padding"})],nt.prototype,"padding",void 0),u([d({type:ta,readOnly:!0})],nt.prototype,"pointsOfInterest",void 0),u([d({type:ro,readOnly:!0})],nt.prototype,"featureTiles",void 0),u([d()],nt.prototype,"featureTreeDebugger",void 0),u([d({type:Boolean})],nt.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],nt.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],nt.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],nt.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],nt.prototype,"state",void 0),u([d({readOnly:!0})],nt.prototype,"inputManager",void 0),u([d({readOnly:!0})],nt.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],nt.prototype,"qualityProfile",null),u([d({type:rle,get(){let e=this._get("qualitySettings");return e||(e=new rle,PN.apply(this.qualityProfile,e)),e}})],nt.prototype,"qualitySettings",void 0),u([d()],nt.prototype,"slicePlane",null),u([d({readOnly:!0})],nt.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],nt.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],nt.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],nt.prototype,"resolution",null),u([d({type:Number,aliasOf:"stateManager.scale"})],nt.prototype,"scale",void 0),u([d()],nt.prototype,"heightModelInfo",null),u([d()],nt.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],nt.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],nt.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],nt.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],nt.prototype,"type",void 0),u([d({type:xEe})],nt.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],nt.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],nt.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],nt.prototype,"viewingMode",null),u([d({type:Rl,aliasOf:"stateManager.viewpoint"})],nt.prototype,"viewpoint",void 0),u([d({type:Number,aliasOf:"stateManager.zoom"})],nt.prototype,"zoom",void 0),u([d({type:tq})],nt.prototype,"highlightOptions",void 0),nt=u([P("esri.views.SceneView")],nt),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(WO||(WO={}));const wT=R(),A8=Yr(),nue=Nt(),n_t=nt;function o_t(e){return e&&"getAtOrigin"in e&&"originOf"in e}function oue(e){e&&e.writtenProperties&&e.writtenProperties.forEach(({target:t,propName:i,newOrigin:r})=>{o_t(t)&&r&&t.originOf(i)!==r&&t.updateOrigin(i,r)})}let J0=class extends ve{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([d({type:String,json:{write:!0}})],J0.prototype,"facilityIdField",void 0),u([d({type:String,json:{write:!0}})],J0.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],J0.prototype,"nameField",void 0),u([d({type:String,json:{write:!0}})],J0.prototype,"siteIdField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],J0.prototype,"sublayerId",void 0),J0=u([P("esri.layers.support.FacilityLayerInfo")],J0);const a_t=J0;let Ud=class extends ve{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};u([d({type:String,json:{write:!0}})],Ud.prototype,"facilityIdField",void 0),u([d({type:String,json:{write:!0}})],Ud.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],Ud.prototype,"levelIdField",void 0),u([d({type:String,json:{write:!0}})],Ud.prototype,"levelNumberField",void 0),u([d({type:String,json:{write:!0}})],Ud.prototype,"longNameField",void 0),u([d({type:String,json:{write:!0}})],Ud.prototype,"shortNameField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Ud.prototype,"sublayerId",void 0),u([d({type:String,json:{write:!0}})],Ud.prototype,"verticalOrderField",void 0),Ud=u([P("esri.layers.support.LevelLayerInfo")],Ud);const l_t=Ud;let vb=class extends ve{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([d({type:String,json:{write:!0}})],vb.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],vb.prototype,"nameField",void 0),u([d({type:String,json:{write:!0}})],vb.prototype,"siteIdField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],vb.prototype,"sublayerId",void 0),vb=u([P("esri.layers.support.SiteLayerInfo")],vb);const c_t=vb;let mS=class extends ve{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};u([d({type:l_t,json:{write:!0}})],mS.prototype,"levelLayer",void 0),u([d({type:a_t,json:{write:!0}})],mS.prototype,"facilityLayer",void 0),u([d({type:c_t,json:{write:!0}})],mS.prototype,"siteLayer",void 0),mS=u([P("esri.support.MapFloorInfo")],mS);const u_t=mS,h_t="webscene:failed-to-copy-embedded-resources",d_t="webscene:schema-validation";function p_t(){return new q(h_t,"Copying of embedded resources is currently not supported")}function f_t(e){return new q(d_t,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})}async function m_t(e,t={},i){await e.load(i);const r=Nu(e.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=t,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:e.apiKey},signal:rs(i,"signal")},c=await e.portal._request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:f})=>({created:new Date(h),size:p,resource:e.resourceFromPath(f)}))}}async function g_t(e,t,i,r){if(!e.hasPath())throw new q(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(r);const n=Nu(s.userItemUrl,t==="add"?"addResources":"updateResources"),[o,a]=TEe(e.path),l=await SEe(i),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),_(r)&&r.access&&c.append("access",r.access),await s.portal._request(n,{method:"post",body:c,signal:rs(r,"signal")}),e}async function y_t(e,t,i){if(!t.hasPath())throw new q("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(i);const r=Nu(e.userItemUrl,"removeResources");await e.portal._request(r,{method:"post",query:{resource:t.path},signal:rs(i,"signal")}),t.portalItem=null}async function v_t(e,t){await e.load(t);const i=Nu(e.userItemUrl,"removeResources");return e.portal._request(i,{method:"post",query:{deleteAll:!0},signal:rs(t,"signal")})}function TEe(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function DJ(e){const[t,i]=__t(e),[r,s]=TEe(t);return[r,s,i]}function __t(e){const t=c3e(e);return M(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function SEe(e){return e instanceof Blob?e:(await gr(e.url,{responseType:"blob"})).data}function b_t(e,t){if(!e.hasPath())return null;const[i,,r]=DJ(e.path);return e.portalItem.resourceFromPath(Nu(i,t+r))}function EEe(e,t){if(!e.hasPath())return null;const[i,,r]=DJ(e.path);return e.portalItem.resourceFromPath(Nu(i,t+r))}var JM=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",addOrUpdateResource:g_t,contentToBlob:SEe,fetchResources:m_t,getSiblingOfSameType:b_t,getSiblingOfSameTypeI:EEe,removeAllResources:v_t,removeResource:y_t,splitPrefixFileNameAndExtension:DJ});async function aue(e,t,i){if(!t||!t.resources)return;const r=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{r.delete(c),e.paths.push(c)});for(const c of t.resources.toUpdate)if(r.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:p,finish:f,error:m}=c,y=EEe(h,zge());e.paths.push(y.path),o.push(lue({resource:y,content:p,finish:f,error:m},i))}else e.paths.push(c.resource.path),o.push(w_t(c,i)),n.add(c.resource.path);for(const c of t.resources.toAdd)o.push(lue(c,i)),e.paths.push(c.resource.path);if(r.forEach(c=>{const h=t.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}),o.length===0)return;const a=await Sn(o);ci(i);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new q("save:resources","Failed to save one or more resources",{errors:l})}async function lue(e,t){const i=await Ac(e.resource.portalItem.addResource(e.resource,e.content,t));if(i.ok!==!0)throw e.error&&e.error(i.error),i.error;e.finish&&e.finish(e.resource)}async function w_t(e,t){const i=await Ac(e.resource.update(e.content,t));if(i.ok!==!0)throw e.error(i.error),i.error;e.finish(e.resource)}const x_t={width:600,height:400},jD=1.5;function T_t(e,t){t=t||x_t;let{width:i,height:r}=t;const s=i/r;return s<jD?r=i/jD:s>jD&&(i=r*jD),i>e.width&&(r*=e.width/i,i=e.width),r>e.height&&(i*=e.height/r,r=e.height),{width:Math.round(i),height:Math.round(r)}}function cue(e){return{enabled:!!(e==null?void 0:e.length)}}var Rq;let gS=Rq=class extends ve{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new Rq({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([d({type:Boolean,json:{write:!0}})],gS.prototype,"exactMatch",void 0),u([d({type:String,json:{write:!0}})],gS.prototype,"name",void 0),u([ut(gY)],gS.prototype,"type",void 0),gS=Rq=u([P("esri.webdoc.applicationProperties.SearchLayerField")],gS);const S_t=gS;var Pq;let yS=Pq=class extends ve{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new Pq(ie({field:this.field,id:this.id,subLayer:this.subLayer}))}};u([d({type:S_t,json:{write:{isRequired:!0}}})],yS.prototype,"field",void 0),u([d({type:String,json:{write:{isRequired:!0}}})],yS.prototype,"id",void 0),u([d({type:Sr,json:{write:!0}})],yS.prototype,"subLayer",void 0),yS=Pq=u([P("esri.webdoc.applicationProperties.SearchLayer")],yS);const E_t=yS;var Iq;let vS=Iq=class extends ve{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new Iq({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([d({type:Boolean,json:{write:!0}})],vS.prototype,"exactMatch",void 0),u([d({type:String,json:{write:!0}})],vS.prototype,"name",void 0),u([ut(gY)],vS.prototype,"type",void 0),vS=Iq=u([P("esri.webdoc.applicationProperties.SearchTableField")],vS);const C_t=vS;var $q;let KM=$q=class extends ve{constructor(e){super(e),this.field=null,this.id=null}clone(){return new $q(ie({field:this.field,id:this.id}))}};u([d({type:C_t,json:{write:{isRequired:!0}}})],KM.prototype,"field",void 0),u([d({type:String,json:{write:{isRequired:!0}}})],KM.prototype,"id",void 0),KM=$q=u([P("esri.webdoc.applicationProperties.SearchTable")],KM);const A_t=KM;var Dq;const CEe=it.ofType(E_t),AEe=it.ofType(A_t);let Tf=Dq=class extends ve{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new CEe,this.tables=new AEe}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,i){t[i]=!e}clone(){return new Dq(ie({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};u([d({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Tf.prototype,"addressSearchEnabled",void 0),u([Ue("addressSearchEnabled")],Tf.prototype,"readAddressSearchEnabled",null),u([Be("addressSearchEnabled")],Tf.prototype,"writeAddressSearchEnabled",null),u([d({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Tf.prototype,"enabled",void 0),u([d({type:String,json:{write:!0}})],Tf.prototype,"hintText",void 0),u([d({type:CEe,json:{write:{overridePolicy:cue},origins:{"web-scene":{write:{isRequired:!0}}}}})],Tf.prototype,"layers",void 0),u([d({type:AEe,json:{read:!0,write:{overridePolicy:cue}}})],Tf.prototype,"tables",void 0),Tf=Dq=u([P("esri.webdoc.applicationProperties.Search")],Tf);const M_t=Tf;var Lq;let ZN=Lq=class extends ve{constructor(e){super(e),this.search=null}clone(){return new Lq(ie({search:this.search}))}};u([d({type:M_t,json:{write:!0}})],ZN.prototype,"search",void 0),ZN=Lq=u([P("esri.webdoc.applicationProperties.Viewing")],ZN);const O_t=ZN;var Nq;let QN=Nq=class extends ve{constructor(e){super(e),this.viewing=null}clone(){return new Nq({viewing:this.viewing?this.viewing.clone():null})}};u([d({type:O_t,json:{write:!0}})],QN.prototype,"viewing",void 0),QN=Nq=u([P("esri.webscene.ApplicationProperties")],QN);const R_t=QN;var Fq;let _b=Fq=class extends ve{constructor(e){super(e),this.environment=new nE,this.spatialReference=null,this.viewpoint=null}set viewingMode(e){this._set("viewingMode",e)}clone(){return new Fq({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};u([d({type:nE,json:{write:{isRequired:!0}}})],_b.prototype,"environment",void 0),u([d({type:Ze})],_b.prototype,"spatialReference",void 0),u([d({type:["local","global"]})],_b.prototype,"viewingMode",null),u([d({type:Rl,json:{write:{isRequired:!0}}})],_b.prototype,"viewpoint",void 0),_b=Fq=u([P("esri.webscene.InitialViewProperties")],_b);const v5=_b;var kq;let jg=kq=class extends ve{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new kq({url:this.url})}};u([d({type:String,json:{write:{isRequired:!0}}})],jg.prototype,"url",void 0),jg=kq=u([P("esri.webdoc.support.SlideThumbnail")],jg);var Uq;let JN=Uq=class extends ve{constructor(){super(...arguments),this.text=""}clone(){return new Uq({text:this.text})}};u([d({type:String,json:{write:!0}})],JN.prototype,"text",void 0),JN=Uq=u([P("esri.webscene.support.Description")],JN);const KN=JN;var zq;let HS=zq=class extends ve{constructor(){super(...arguments),this.lighting=new Dw,this.weather=new OR}clone(){return new zq({lighting:ie(this.lighting),weather:ie(this.weather)})}};u([d({types:r1e,json:{write:!0}})],HS.prototype,"lighting",void 0),u([d({types:mZ,json:{write:!0}})],HS.prototype,"weather",void 0),HS=zq=u([P("esri.webscene.Environment")],HS);var eF;let tF=eF=class extends ve{constructor(){super(...arguments),this.opacity=null}clone(){return new eF({opacity:this.opacity})}cloneAndApplyTo(e){return this.opacity==null||((e=e!=null?e.clone():new AR).opacity=this.opacity),e}static fromGround(e){return new eF({opacity:e.opacity})}};u([d({type:Number,json:{type:Sr,read:{reader:N2,source:"transparency"},write:{writer:(e,t)=>{t.transparency=FP(e)},target:"transparency"}}})],tF.prototype,"opacity",void 0),tF=eF=u([P("esri.webscene.support.SlideGround")],tF);const MEe=tF;var Vq;let qS=Vq=class extends ve{constructor(e){super(e),this.id="",this.sublayerIds=null}clone(){return new Vq({id:this.id,sublayerIds:ie(this.sublayerIds)})}};u([d({type:String,json:{write:!0}})],qS.prototype,"id",void 0),u([d({type:[Sr],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],qS.prototype,"sublayerIds",void 0),qS=Vq=u([P("esri.webscene.support.SlideVisibleLayer")],qS);var Bq;let iF=Bq=class extends ve{constructor(){super(...arguments),this.text=""}clone(){return new Bq({text:this.text})}};u([d({type:String,json:{write:{isRequired:!0}}})],iF.prototype,"text",void 0),iF=Bq=u([P("esri.webscene.support.Title")],iF);const XO=iF;let P_t=0;const Gq=it.ofType(qS),I_t=ge.getLogger("esri.webscene.Slide");let ea=class extends ve{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+P_t++,this.title=new XO,this.description=new KN,this.thumbnail=new jg,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new HS,this.visibleLayers=new Gq}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail&&this.thumbnail.destroy(),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new XO({text:e}):ns(XO,e)}castDescription(e){return typeof e=="string"?new KN({text:e}):ns(KN,e)}castThumbnail(e){return typeof e=="string"?new jg({url:e}):ns(jg,e)}castBasemap(e){return pZ(e)}set visibleLayers(e){this._set("visibleLayers",ly(e,this._get("visibleLayers"),Gq))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(t=>{if(typeof t=="string")return{id:t};if(t instanceof TR){const i=uue(t);return{id:t.id,sublayerIds:i}}return t.id?{id:t.id,sublayerIds:t.sublayerIds}:(I_t.warn('Invalid visible layer, expected { id }, Layer or "id"'),t)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})}_updateVisibleLayersFrom(e){const t=[];return Sn(this._getLayers(e.map).map(i=>e.whenLayerView(i).then(r=>{if(r.visible){const s=uue(i);t.push(new qS({id:r.layer.id,sublayerIds:s}))}})).toArray()).then(()=>{this.visibleLayers.removeAll(),this.visibleLayers.addMany(t)})}updateFrom(e,t){return t={screenshot:F({format:"png",quality:80,width:120,height:75,disableDecorations:!0},t&&t.screenshot)},e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?r3.prototype.clone.apply(e.environment.lighting):Dw.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?MEe.fromGround(e.map.ground):null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(t.screenshot)).then(i=>(this.thumbnail=new jg({url:i.dataUrl}),this))}async applyTo(e,t){_(this._applyToController)&&this._applyToController.abort();let i=new AbortController;this._applyToController=i;const r=I5(t,()=>i.abort()),s=e.resourceController.scheduler.registerTask(yt.SLIDE);let n=!1;t=me(F({animate:!0},t),{signal:this._applyToController.signal});const o=async()=>{await Promise.all([s.schedule(()=>n=this._setViewpointOfInterest(e,t)),s.schedule(()=>this._applyBasemap(e,t),t.signal)]),await Promise.all([s.schedule(()=>this._applyLayerVisibility(e),t.signal),s.schedule(()=>this._applyGround(e),t.signal),s.schedule(()=>this._applyViewpoint(e,t),t.signal)]),await s.schedule(()=>e.environment.weather=this.environment.weather.clone())},a=await Ac(e.addUpdatingPromise(o()));if(n&&(e.contentCamera=null),s.remove(),this._applyToController===i&&(this._applyToController=null),i=null,r==null||r.remove(),a.ok===!1)throw a.error;return this}async _applyBasemap(e,t){if(this.basemap){try{await this.basemap.load(t)}catch(i){if(Qr(i))throw i}e.map.basemap=hje(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const t=new it;return this._collectLayers(e,t),this._collectLayers(e.ground,t),t}_collectLayers(e,t){e.layers.forEach(i=>{K8e(i)&&(t.add(i),"layers"in i&&this._collectLayers(i,t))})}_applyLayerVisibility(e){!this.visibleLayers||this._getLayers(e.map).forEach(t=>{const i=this.visibleLayers.find(n=>n.id===t.id);t.visible=i!=null;const r=i&&i.sublayerIds,s=OEe(t);r&&s&&s.forEach(n=>n.visible=r.includes(n.id))})}_setViewpointOfInterest(e,t){if(e.state.fixedContentCamera||!this.viewpoint||t.ignoreViewpoint||!t.useDestinationCamera)return!1;const i=iJ(e,this.viewpoint);return e.contentCamera=i,_(i)}async _applyViewpoint(e,t){if(this.viewpoint&&!t.ignoreViewpoint){if(_(this.viewpoint.camera)&&(this.viewpoint.camera.fov=e.camera.fov),t.animate&&this.get("environment.lighting.date"))return void await this._animateToLighting(e,t);t.animate&&(e.environment.applyLighting(this.environment.lighting.clone()),await e.goTo(this.viewpoint,t)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,t){let i=null;return e.environment.lighting.type==="sun"&&this.environment.lighting.type==="sun"&&(e.viewingMode==="global"&&(i=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type==="sun"&&(e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,t).then(()=>e.environment.applyLighting(this.environment.lighting.clone())).finally(()=>{Vs(i),e.environment.lighting.type==="sun"&&(e.environment.lighting.cameraTrackingEnabled=!0)})}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,t,i){return e.setTime(t),e.setUTCHours(i/3600),e.setUTCMinutes(i%3600/60),e.setUTCSeconds(i%3600%60),e}_animateLightingWithCamera(e,t,i){const r=new Date(t.date.toString()),[s,n]=this._getTime(r),[o,a]=this._getTime(i.date),l=$_t(n,a),c=e.renderCoordsHelper,h=R();c.toRenderCoords(e.camera.position,h);const p=R(),f=R();_(this.viewpoint.camera)&&c.toRenderCoords(this.viewpoint.camera.position,p);const m=new Date;return se(()=>e.camera,y=>{c.toRenderCoords(y.position,f);const v=Gs(h,f),w=Gs(p,f);let b=0;v+w!==0&&(b=v/(v+w));const S=s+(o-s)*b,T=D_t(n,l*b);t.date=this._setTime(m,S,T)})}static createFrom(e,t){return new this().updateFrom(e,t)}};function OEe(e){if(e.type==="building-scene"||e.type==="map-image")return e.allSublayers.toArray()}function uue(e){const t=OEe(e);if(t)return t.filter(i=>i.visible).map(i=>i.id)}u([d({type:String,json:{write:{isRequired:!0}}})],ea.prototype,"id",void 0),u([d({type:XO,json:{default:()=>new XO({text:""}),write:{isRequired:!0}}})],ea.prototype,"title",void 0),u([Rt("title")],ea.prototype,"castTitle",null),u([d({type:KN,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.text)})}}})],ea.prototype,"description",void 0),u([Rt("description")],ea.prototype,"castDescription",null),u([d({type:jg,json:{default:()=>new jg({url:""}),write:{isRequired:!0}}})],ea.prototype,"thumbnail",void 0),u([Rt("thumbnail")],ea.prototype,"castThumbnail",null),u([d({type:Rl,nonNullable:!0,json:{write:{isRequired:!0}}})],ea.prototype,"viewpoint",void 0),u([d({type:tE,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],ea.prototype,"basemap",void 0),u([Rt("basemap")],ea.prototype,"castBasemap",null),u([d({type:MEe,json:{write:!0}})],ea.prototype,"ground",void 0),u([d({type:Gq,json:{write:{isRequired:!0}}})],ea.prototype,"visibleLayers",null),u([Rt("visibleLayers")],ea.prototype,"castVisibleLayers",null),u([d({type:HS,json:{write:!0}})],ea.prototype,"environment",void 0),ea=u([P("esri.webscene.Slide")],ea);const jq=86400,hue=43200;function $_t(e,t){let i=t-e;return i>hue&&(i-=jq),i<-hue&&(i+=jq),i}function D_t(e,t){return BDe(e+t,jq)}const L_t=ea,Hq=it.ofType(L_t);let rF=class extends ve{constructor(e){super(e),this.slides=new Hq}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(t=>!!t.viewpoint)),this._set("slides",ly(e,this._get("slides"),Hq))}clone(){return new this.constructor({slides:this.slides.clone()})}};u([d({type:Hq,nonNullable:!0,json:{write:!0}}),Rt(cX)],rF.prototype,"slides",null),rF=u([P("esri.webscene.Presentation")],rF);const REe=rF;var qq;let _S=qq=class extends ve{constructor(e){super(e)}clone(){return new qq({name:this.name,path:this.path,title:this.title})}};u([d({type:String,json:{write:!0}})],_S.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],_S.prototype,"path",void 0),u([d({type:String,json:{write:!0}})],_S.prototype,"title",void 0),_S=qq=u([P("esri.webscene.TransportationNetwork")],_S);const N_t=_S;class _5 extends E_{constructor(t,i){super(t,i,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}const xT=ge.getLogger("esri.WebScene"),b2=new _5(1,28),F_t=()=>{const t=[],i=b2.major;for(let r=8;r<=b2.minor;r++)t.push(`${i}.${r}`);return t},M8="Web Scene",HD="ViewingMode-Local";let Xi=class extends um.LoadableMixin(UP(WY(F_e))){constructor(e){super(e),this._handles=new jt,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=null,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new REe,this.initialViewProperties=new v5,this.portalItem=null,this.resourceInfo=null,this._debouncedSaveOperations=aW(async(t,i,r)=>{switch(t){case WS.SAVE:return this._saveImpl(i);case WS.SAVE_AS:return this._saveAsImpl(r,i)}}),this.resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{xT.error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(t){return void this.addResolvingPromise(Promise.reject(t))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this._handles.destroy(),this.presentation&&this.presentation.destroy();const e=this.portalItem;this.portalItem=null,e==null||e.destroy()}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,i,r){const s=me(F({},r),{layerContainerType:"operational-layers"}),n=e.map(o=>this.verifyWriteLayer(o,r)?o.write({},s):null).filter(o=>!!o);t[i]=n.toArray()}verifyWriteLayer(e,t){return"write"in e||(t&&t.messages&&t.messages.push(new q("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1)}readSourceVersion(e,t){const[i,r]=t.version.split(".");return new _5(parseInt(i,10),parseInt(r,10))}writeSourceVersion(e,t,i){t[i]=`${b2.major}.${b2.minor}`}get thumbnailUrl(){return this.portalItem&&this.portalItem.thumbnailUrl||null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=uX}writeGround(e,t,i,r){t[i]=e?e.write({},r):{transparency:0,layers:[]}}readInitialViewProperties(e,t){const i={};return t.initialState&&t.initialState.environment&&(i.environment=nE.fromJSON(t.initialState.environment)),t.spatialReference?i.spatialReference=Ze.fromJSON(t.spatialReference):i.spatialReference=Ze.WebMercator,i.viewingMode=t.viewingMode||"global",t.initialState&&t.initialState.viewpoint&&(i.viewpoint=Rl.fromJSON(t.initialState.viewpoint)),new v5(i)}get spatialReference(){var e,t;return(t=(e=this.initialViewProperties)==null?void 0:e.spatialReference)!=null?t:Ze.WebMercator}get viewingMode(){var e,t;return(t=(e=this.initialViewProperties)==null?void 0:e.viewingMode)!=null?t:"global"}load(e){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}loadAll(){return dZ(this,e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map(i=>i.basemap))})}read(e,t){t=me(F({},t),{origin:"web-scene"});const i=this._isAuthoringAppVersionSetByUser,r=this._isAuthoringAppSetByUser;if(fde(this,e,s=>super.read(e,s),t),r||(this._isAuthoringAppSetByUser=!1),i||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){const s=e.baseMap.elevationLayers.map(l=>({id:l.id})),n=this.presentation.slides,o=(l,c)=>l.visibleLayers.some(h=>h.id===c),a=s.filter(l=>!n.some(c=>o(c,l.id)));n.forEach(l=>{l.visibleLayers.addMany(a)})}}_writeBasemapElevationLayers(e){const t=e.ground&&e.ground.layers;!e.baseMap&&t&&t.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=ie(t))}write(e,t){if(this.loadStatus!=="loaded"){const s=new q("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw xT.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),s}this._runLayersIdGC();const i=!(t==null?void 0:t.messages);t=me(F({messages:[]},t),{origin:"web-scene"});const r=super.write(e,t);if(i){const s=t.messages.filter(n=>n.name==="web-document-write:property-required");if(s.length){const n=new q("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:s});throw xT.error("#toJSON()","One or more properties that are required in the webscene JSON are missing",s),n}}return this._writeBasemapElevationLayers(r),r}async save(e){return this._debouncedSaveOperations(WS.SAVE,e)}async _saveImpl(e){this.portalItem||(xT.error("save(): requires the .portalItem property to be set"),await Promise.reject(new q("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))),this.portalItem.type!==M8&&await Promise.reject(new q("webscene:portal-item-wrong-type",`Portal item needs to have type "${M8}"`));const t=this._updateFromPromise;await this._ensureLoadBeforeSave();const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&xn(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||mo.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),r=this.write({},i);return await Promise.all(i.resources.pendingOperations),await this._verifySave(r,i,e),this._updateTypeKeywords(this.portalItem),await this.portalItem.update({data:r}),await aue(this.resourceReferences,i,null),oue(i),t&&await t,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this._debouncedSaveOperations(WS.SAVE_AS,t,e)}async _saveAsImpl(e,t){let i=eE.from(e);i||(xT.error("saveAs(portalItem): requires a portal item parameter"),await Promise.reject(new q("webscene:portal-item-required","saveAs requires a portal item to save to"))),i.id&&(i=i.clone(),i.id=null);const r=i.portal||mo.getDefault();await this._ensureLoadBeforeSave(),i.type=M8,i.portal=r;const s=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:r,portalItem:i,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),n=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(n,s,t);const o=this.thumbnailUrl,a=!this._isOverridden("thumbnailUrl");return this._updateTypeKeywords(i),await r._signIn(),await r.user.addItem({item:i,folder:t&&t.folder,data:n}),await aue(this.resourceReferences,s,null),this.portalItem=i,hj.prototype.read.call(this,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:i.itemUrl&&xn(i.itemUrl)}),oue(s),o&&(this.thumbnailUrl=a?aX(o,"w","8192"):o),s.portalItem=i,await this._saveThumbnail(),i}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,t,i,r=!1){if(!O2(this.spatialReference))return Promise.reject(new q("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,n=t.messages.filter(a=>a.type==="error").map(a=>new q(a.name,a.message,a.details));t.blockedRelativeUrls&&(n=n.concat(t.blockedRelativeUrls.map(a=>new q("url:unsupported",`Relative url '${a}' is not supported in Web Scene`)))),i&&i.ignoreUnsupported&&(n=n.filter(a=>a.name!=="layer:unsupported"&&a.name!=="symbol:unsupported"&&a.name!=="symbol-layer:unsupported"&&a.name!=="property:unsupported"&&a.name!=="url:unsupported"&&a.name!=="scenemodification:unsupported")),(i==null?void 0:i.requiredPropertyChecksDisabled)&&(n=n.filter(a=>a.name!=="web-document-write:property-required"));const o=i&&i.strictSchemaValidationEnabled;return s=o?import("./schemaValidator.5a242a55.js").then(a=>{const l=a.validate(e);if(l.length>0){const c=`webscene did not validate:
${l.join(`
`)}`;xT.error(`${r?"saveAs":"save"}(): ${c}`)}return l.map(c=>new q("webscene:schema-validation",c))}).then(a=>{if(o&&a.length>0)throw f_t(a.concat(n));return n}):Promise.resolve(n),s.then(a=>{if(a.length>0)throw new q("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})})}_verifySaveAs(e,t,i){return this.canNotSaveAs(t)?Promise.reject(p_t()):this._verifySave(e,t,i,!0)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),i=this.write({},t);return this._verifySaveAs(i,t,e)}canNotSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.length>0}async updateFrom(e,t={}){const i=this._updateFrom(e,t);this._updateFromPromise=i,await i,this._updateFromPromise===i&&(this._updateFromPromise=null)}async _updateFrom(e,t={}){if(await e.whenReady(),!t.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=nE.prototype.clone.apply(e.environment)),!t.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,_(e.clippingArea)?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const i of e.allLayerViews){const r="visible";r in i&&r in i.layer&&i._isOverridden(r)&&(i.layer[r]=i[r])}(t.thumbnailExcluded===!1||t.thumbnailExcluded==null&&!t.viewpointExcluded)&&await this._updateFromThumbnail(e,t.thumbnailSize||void 0)}async _updateFromThumbnail(e,t){const i=T_t(e,t),r=await e.takeScreenshot({format:"jpg",width:i.width,height:i.height,disableDecorations:!0});this.thumbnailUrl=r.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,t){const i=this._validateJSON(e);return this.read(i,t),this._loadFromJSON(i,t)}_extractOperationalLayers(e){const t=[];if(!this.sourceVersion.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const s of e.baseMap.elevationLayers)t.push(s);const i=[],r=s=>(s.layers&&(s.layers=s.layers.filter(r)),s.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion.supportsGround||i.push(s),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(r):[],operationalElevationLayers:i,basemapElevationLayers:t}}_loadFromJSON(e,t){const i=new it;return this._validateSpatialReference().then(()=>this._validateHeightModelInfo()).then(()=>import("./layersCreator.bf495c80.js")).then(({populateOperationalLayers:r})=>{const{operationalLayers:s,operationalElevationLayers:n,basemapElevationLayers:o}=this._extractOperationalLayers(e),a=[],l={context:me(F({},t),{layerContainerType:"operational-layers"})};if(this.portalItem&&(l.context.portal=this.portalItem.portal||mo.getDefault()),o.length>0){const c=me(F({},l),{context:me(F({},l.context),{layerContainerType:"ground"})});c.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(r(this.ground.layers,o,c))}if(n.length>0){const c=me(F({},l),{context:me(F({},l.context),{layerContainerType:"ground"})});c.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(r(i,n,c))}return s&&s.length>0&&a.push(r(this.layers,s,l)),Sn(a).then(()=>{})}).then(()=>this._loadObjectsWithLayers()).then(()=>{this.ground.layers.addMany(i)})}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[];for(const t of this.allLayers.items)if("beforeSave"in t&&typeof t.beforeSave=="function"){const i=t.beforeSave();i&&e.push(i)}await Sn(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(t=>{t.basemap&&e.push(t.basemap.load())}),await Sn(e)}async _loadFromItem(e){if(await e.load().catch(r=>{throw new q("webscene:load-portal-item","Failed to load portal item",{error:r})}),e.type!=="Web Scene")throw new q("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const i={origin:"web-scene",url:xn(e.itemUrl),portal:e.portal||mo.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(t,i),this.resourceReferences={portalItem:e,paths:i.readResourcePaths}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let i;if(e.viewingMode!=="local"){if(!wE(t,Ve.Global))return Promise.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));i=a=>!a||cy(a,t)}else{if(!wE(t,Ve.Local))return Promise.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));i=a=>!a||a.equals(t)}const r=a=>a&&(_(a.camera)&&a.camera.position&&a.camera.position.spatialReference||_(a.targetGeometry)&&a.targetGeometry.spatialReference),s=e.viewpoint,n=r(s);if(n&&!i(n))return Promise.reject(new q("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:n,sceneSpatialReference:t,viewingMode:e.viewingMode}));const o=this.presentation.slides.find(a=>!i(r(a.viewpoint)));if(o){const a=r(o.viewpoint);return Promise.reject(new q("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:a,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=Vje(this.heightModelInfo,e);return t?Promise.reject(t):Promise.resolve()}_validateJSON(e){const t=_5.parse(e.version||"","webscene");return b2.validate(t),e.version=`${t.major}.${t.minor}`,t.major===1&&t.minor<=2&&(e.spatialReference=Ze.WebMercator.toJSON()),e}_updateTypeKeywords(e){this.initialViewProperties.viewingMode==="local"?e.typeKeywords?e.typeKeywords.includes(HD)||e.typeKeywords.push(HD):e.typeKeywords=[HD]:this.initialViewProperties.viewingMode==="global"&&e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(t=>t!==HD)),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((t,i,r)=>r.indexOf(t)===i))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||Ze.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem&&this.portalItem.itemUrl?xn(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,t=r=>this.allLayers.some(s=>s.id===r);e&&e.layers&&(e.layers=e.layers.filter(r=>t(r.id)));const i=this.presentation&&this.presentation.slides;i&&i.forEach(r=>{r.visibleLayers&&(r.visibleLayers=r.visibleLayers.filter(s=>t(s.id)))})}static fromJSON(e){if(!e)throw new q("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};var WS;Xi.VERSION=b2,u([d({type:R_t,json:{write:!0}})],Xi.prototype,"applicationProperties",void 0),u([d({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Xi.prototype,"basemap",void 0),u([d({type:ui,json:{read:{source:"clippingArea.geometry",reader:sm},write:{target:"clippingArea.geometry"}}})],Xi.prototype,"clippingArea",void 0),u([Be("clippingArea")],Xi.prototype,"writeClippingArea",null),u([d({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Xi.prototype,"clippingEnabled",void 0),u([Ue("clippingEnabled",["clippingArea"])],Xi.prototype,"readClippingEnabled",null),u([Be("clippingEnabled")],Xi.prototype,"writeClippingEnabled",null),u([d({type:u_t,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Xi.prototype,"floorInfo",void 0),u([d({type:O_,json:{write:!0}})],Xi.prototype,"heightModelInfo",void 0),u([d({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Xi.prototype,"layers",void 0),u([Be("layers")],Xi.prototype,"writeLayers",null),u([d({readOnly:!0,type:_5,json:{type:F_t(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Xi.prototype,"sourceVersion",void 0),u([Ue("sourceVersion",["version"])],Xi.prototype,"readSourceVersion",null),u([Be("sourceVersion")],Xi.prototype,"writeSourceVersion",null),u([d({json:{read:!1,write:!1}})],Xi.prototype,"tables",void 0),u([d()],Xi.prototype,"thumbnailUrl",null),u([d({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Xi.prototype,"authoringApp",null),u([Be("authoringApp")],Xi.prototype,"writeAuthoringApp",null),u([d({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Xi.prototype,"authoringAppVersion",null),u([Be("authoringAppVersion")],Xi.prototype,"writeAuthoringAppVersion",null),u([d({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Xi.prototype,"ground",void 0),u([Be("ground")],Xi.prototype,"writeGround",null),u([d({type:it.ofType(N_t),json:{write:!0}})],Xi.prototype,"transportationNetworks",void 0),u([d({type:REe,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,i,r)=>{if(e.slides&&e.slides.length>0){const s=me(F({},r),{isPresentation:!0});t.presentation=e.write({},s)}}}}})],Xi.prototype,"presentation",void 0),u([d({type:v5,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new v5({viewingMode:"global",spatialReference:Ze.WebMercator})}})],Xi.prototype,"initialViewProperties",void 0),u([Ue("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],Xi.prototype,"readInitialViewProperties",null),u([d({type:Ze,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Xi.prototype,"spatialReference",null),u([d({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Xi.prototype,"viewingMode",null),u([d({type:eE})],Xi.prototype,"portalItem",void 0),u([d()],Xi.prototype,"resourceInfo",void 0),Xi=u([P("esri.WebScene")],Xi),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(WS||(WS={}));const tEt=Xi,Sf="esri-daylight",O8=`${Sf}__container`,cs={base:Sf,widgetIcon:"esri-icon-environment-settings",widget:"esri-widget",select:"esri-select",pause:"esri-icon-pause",play:"esri-icon-play",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",sliderAmPmOn:"esri-slider--ampm-on",sliderAlignLeft:"esri-slider--align-left",sliderAlignRight:"esri-slider--align-right",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",secondaryTick:"secondary-tick",dayContainer:`${O8} ${Sf}__day-container`,dateContainer:`${O8} ${Sf}__date-container`,containerDisabled:`${O8}--disabled`,playPauseButton:`${Sf}__play-pause-button`,seasonPicker:`${Sf}__season-picker`,seasonPickerDisabled:`${Sf}__season-picker--disabled`,panelError:`${Sf}__panel--error`,sunLightingCheckbox:`${Sf}__sun-lighting-checkbox`,shadowsCheckbox:`${Sf}__shadows-checkbox`};var Wf;(function(e){e[e.NORTHERN=0]="NORTHERN",e[e.SOUTHERN=1]="SOUTHERN"})(Wf||(Wf={}));const k_t={spring:{dayOfMonth:20,month:2},summer:{dayOfMonth:21,month:5},fall:{dayOfMonth:23,month:8},winter:{dayOfMonth:21,month:11}},Wq=["spring","summer","fall","winter"];function eO(e,t,i){const r=LJ(t,i),{dayOfMonth:s,month:n}=k_t[r],o=new Date(e.getTime());return o.setMonth(n,s),o}function U_t(e,t){return LJ(z_t(e),t)}function z_t(e){const t=e.getTime(),i=eO(e,"spring",Wf.NORTHERN).getTime(),r=eO(e,"summer",Wf.NORTHERN).getTime(),s=eO(e,"fall",Wf.NORTHERN).getTime(),n=eO(e,"winter",Wf.NORTHERN).getTime();return t>=i&&t<r?"spring":t>=r&&t<s?"summer":t>=s&&t<n?"fall":"winter"}function LJ(e,t){return t===Wf.NORTHERN?e:V_t(e)}function V_t(e){const t=Wq.indexOf(e);return Wq[(t+2)%4]}function B_t(e,t){return pUe(e,t,"minutes")}function G_t(e){return fUe(e,"minutes")}function j_t(e,t,i){if(isNaN(e.getTime())&&isNaN(t.getTime()))return 3e5;const l=i.getTime(),c=e.getTime(),h=t.getTime(),p=c-72e5/2,f=c+72e5/2,m=h-72e5/3*2,y=h+72e5/3;let v=3e5;return l>=p&&l<=f?v=l-p<=12e5?18e5-(l-p)/12e5*(18e5-2e5):f-l<=12e5/2?3e5-(f-l)/12e5*2*(3e5-2e5):2e5:l>=m&&l<=y?v=l-m<=12e5/2?3e5-(l-m)/12e5*2*(3e5-2e5):y-l<=12e5?18e5-(y-l)/12e5*(18e5-2e5):2e5:(l<c||l>h)&&(v=18e5),v}const PEe="esri.widgets.Slider.SliderViewModel",H_t=ge.getLogger(PEe);let cl=class extends Se{constructor(e){super(e),this.precision=4,this.thumbsConstrained=!0}set effectiveMax(e){this.setEffectiveMax(e)}set effectiveMin(e){this.setEffectiveMin(e)}set labelFormatFunction(e){this._set("labelFormatFunction",e)}set inputFormatFunction(e){this._set("inputFormatFunction",e)}set inputParseFunction(e){this._set("inputParseFunction",e)}get labels(){const{max:e,min:t,values:i}=this,r=i&&i.length?i.map((s,n)=>this.getLabelForValue(s,"value",n)):[];return{max:this.getLabelForValue(e,"max"),min:this.getLabelForValue(t,"min"),values:r}}set max(e){this.setMax(e)}set min(e){this.setMin(e)}get state(){const{max:e,min:t}=this;return _(e)&&_(t)&&e>t?"ready":"disabled"}set values(e){const{max:t,min:i}=this,r=this.values;r&&e&&r.length===e.length&&r.every((s,n)=>s===e[n])||(this._set("values",null),e&&e.length&&(_(i)&&e.some(s=>s<i)&&(this.min=Math.min(...e)),_(t)&&e.some(s=>s>t)&&(this.max=Math.max(...e))),this._set("values",e))}toPrecision(e){return parseFloat(e.toFixed(this.precision))}defaultLabelFormatFunction(e){const{max:t,min:i,precision:r}=this,s=t-i>10?2:r;return parseFloat(e.toFixed(s)).toString()}defaultInputFormatFunction(e){return e.toString()}defaultInputParseFunction(e){return parseFloat(e)}getBounds(){const{effectiveMax:e,effectiveMin:t,max:i,min:r}=this;return{min:_(t)?Math.max(r,t):r,max:_(e)?Math.min(i,e):i}}getBoundsForValueAtIndex(e){const{thumbsConstrained:t,values:i}=this,{min:r,max:s}=this.getBounds();if(t){const n=e-1,o=e+1;return{min:_(i[n])?i[n]:r,max:_(i[o])?i[o]:s}}return{min:r,max:s}}getLabelForValue(e,t,i){return M(e)?null:this.labelFormatFunction?this.labelFormatFunction(e,t,i):this.defaultLabelFormatFunction(e)}setMax(e){const{max:t,values:i}=this;if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'max' is NaN.");if(e===null)return void this._set("max",null);const r=this.toPrecision(e);if(t!==r&&(this._set("max",r),i&&i.length))for(let s=0;s<i.length;s++)r<i[s]&&this.setValue(s,r)}setMin(e){const{min:t,values:i}=this;if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'min' is NaN.");if(e===null)return void this._set("min",null);const r=this.toPrecision(e);if(t!==r&&(this._set("min",r),i&&i.length))for(let s=0;s<i.length;s++)r>i[s]&&this.setValue(s,r)}setEffectiveMax(e){if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMax' is NaN.");if(e===null)return void this._set("effectiveMax",null);const t=this.toPrecision(e);this.effectiveMax!==t&&this._set("effectiveMax",this._applyBoundsToValue(t))}setEffectiveMin(e){if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMin' is NaN.");if(e===null)return void this._set("effectiveMin",null);const t=this.toPrecision(e);this.effectiveMin!==t&&this._set("effectiveMin",this._applyBoundsToValue(t))}setValue(e,t){if(isNaN(t))return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is NaN.");const{values:i}=this,r=i[e],s=this.toPrecision(t);if(r===s)return;const n=[...i];n[e]=s,this._set("values",n),this.notifyChange("labels")}_applyBoundsToValue(e){const{max:t,min:i}=this;return _(i)&&e<i?i:_(t)&&e>t?t:e}_logError(e,t,i){H_t.error(new q(e,t,i))}};u([d()],cl.prototype,"effectiveMax",null),u([d()],cl.prototype,"effectiveMin",null),u([d()],cl.prototype,"labelFormatFunction",null),u([d()],cl.prototype,"inputFormatFunction",null),u([d()],cl.prototype,"inputParseFunction",null),u([d({readOnly:!0})],cl.prototype,"labels",null),u([d()],cl.prototype,"max",null),u([d()],cl.prototype,"min",null),u([d()],cl.prototype,"precision",void 0),u([d({readOnly:!0})],cl.prototype,"state",null),u([d()],cl.prototype,"thumbsConstrained",void 0),u([d()],cl.prototype,"values",null),cl=u([P(PEe)],cl);const IEe=cl;let Dg=class extends IEe{constructor(e){super(e),this.items=null,this.currentIndex=0,this.isDropdownOpen=!1}get currentItem(){return this.items!==null&&this.currentIndex!==null&&this.currentIndex<this.items.length?this.items[this.currentIndex]:null}selectItem(e){this.currentIndex=e,this.isDropdownOpen=!1}toggle(){this.isDropdownOpen=!this.isDropdownOpen}};u([d()],Dg.prototype,"items",void 0),u([d()],Dg.prototype,"currentIndex",void 0),u([d()],Dg.prototype,"currentItem",null),u([d()],Dg.prototype,"isDropdownOpen",void 0),Dg=u([P("esri.widgets.Daylight.SliderWithDropdown")],Dg);let tO=class extends Se{constructor(){super(...arguments),this.state="ready",this.value=new Date}};u([d()],tO.prototype,"state",void 0),u([d()],tO.prototype,"value",void 0),tO=u([P("esri.widgets.support.DateTimeElementViewModel")],tO);const q_t=tO;let Xq=class extends q_t{constructor(e){super(e)}};Xq=u([P("esri.widgets.support.DatePickerViewModel")],Xq);const gz=Xq,W_t={hour:"2-digit",minute:"2-digit",timeZone:"UTC"},X_t={hour:"numeric",timeZone:"UTC"};function due(e,t){let i;if(t==="tick"){const s=Math.round(Lv(e,"minutes","hours"));i=new Date(Lv(s,"hours","milliseconds"))}else i=new Date(6e4*e);let r=Ls(i,W_t);return e!==0&&r==="00:00"&&(r="24:00"),t==="tick"&&r.includes(" ")&&(r=Ls(i,X_t),r=r.replace(":00","")),r}function Y_t(e,t,i,r){const s=g_.getTimes(e,t,i),n=s.sunrise,o=s.sunset,a=Hh(e,r,"hours"),l=Hh(n,r,"hours"),c=Hh(o,r,"hours");if(a.getUTCDate()!==l.getUTCDate()||a.getUTCDate()!==c.getUTCDate()){const h=a.getTime()-l.getTime()>0?1:-1;n.setUTCDate(n.getUTCDate()+h),o.setUTCDate(o.getUTCDate()+h)}return{sunrise:n,sunset:o}}function Z_t(e){return[{utcOffset:-12,short:"UTC-12",long:e.timezoneDateline},{utcOffset:-11,short:"UTC-11",long:e.timezoneSamoa},{utcOffset:-10,short:e.timezoneHAST,long:e.timezoneHawaii},{utcOffset:-9,short:e.timezoneAKST,long:e.timezoneAlaska},{utcOffset:-8,short:e.timezonePST,long:e.timezoneBaja},{utcOffset:-7,short:e.timezoneMST,long:e.timezoneMountain},{utcOffset:-7,short:e.timezoneMST,long:e.timezoneLaPaz},{utcOffset:-7,short:e.timezoneMST,long:e.timezoneArizona},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneSaskatchewan},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneCentralAmerica},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneCentralTime},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneMexico},{utcOffset:-5,short:e.timezoneEST,long:e.timezoneEasternUS},{utcOffset:-5,short:e.timezoneEST,long:e.timezoneLima},{utcOffset:-5,short:e.timezoneEST,long:e.timezoneIndiana},{utcOffset:-4,short:null,long:e.timezoneAtlantic},{utcOffset:-4,short:null,long:e.timezoneCuiaba},{utcOffset:-4,short:null,long:e.timezoneSantiago},{utcOffset:-4,short:null,long:e.timezoneManaus},{utcOffset:-4,short:null,long:e.timezoneAsuncion},{utcOffset:-3,short:null,long:e.timezoneBrasilia},{utcOffset:-3,short:null,long:e.timezoneGreenland},{utcOffset:-3,short:null,long:e.timezoneMontevideo},{utcOffset:-3,short:null,long:e.timezoneCayenne},{utcOffset:-3,short:null,long:e.timezoneBuenosAires},{utcOffset:-2,short:null,long:e.timezoneMidAtlantic},{utcOffset:-1,short:null,long:e.timezoneAzores},{utcOffset:-1,short:null,long:e.timezoneCaboVerde},{utcOffset:0,short:null,long:e.timezoneDublin},{utcOffset:0,short:null,long:e.timezoneReykjavik},{utcOffset:0,short:null,long:e.timezoneCasablanca},{utcOffset:1,short:e.timezoneCET,long:e.timezoneBelgrade},{utcOffset:1,short:e.timezoneCET,long:e.timezoneSarajevo},{utcOffset:1,short:e.timezoneCET,long:e.timezoneBrussels},{utcOffset:1,short:e.timezoneCET,long:e.timezoneWCAfrica},{utcOffset:1,short:e.timezoneCET,long:e.timezoneAmsterdam},{utcOffset:1,short:e.timezoneCET,long:e.timezoneWindhoek},{utcOffset:2,short:e.timezoneEET,long:e.timezoneMinsk},{utcOffset:2,short:e.timezoneEET,long:e.timezoneCairo},{utcOffset:2,short:e.timezoneEET,long:e.timezoneHelsinki},{utcOffset:2,short:e.timezoneEET,long:e.timezoneAthens},{utcOffset:2,short:e.timezoneEET,long:e.timezoneJerusalem},{utcOffset:2,short:e.timezoneEET,long:e.timezoneAmman},{utcOffset:2,short:e.timezoneEET,long:e.timezoneBeirut},{utcOffset:2,short:e.timezoneEET,long:e.timezoneHarare},{utcOffset:2,short:e.timezoneEET,long:e.timezoneDamascus},{utcOffset:2,short:e.timezoneEET,long:e.timezoneIstanbul},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneKuwait},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneBaghdad},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneNairobi},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneKaliningrad},{utcOffset:4,short:e.timezoneGST,long:e.timezoneMoscow},{utcOffset:4,short:e.timezoneGST,long:e.timezoneMuscat},{utcOffset:4,short:e.timezoneGST,long:e.timezoneBaku},{utcOffset:4,short:e.timezoneGST,long:e.timezoneYerevan},{utcOffset:4,short:e.timezoneGST,long:e.timezoneTbilisi},{utcOffset:4,short:e.timezoneGST,long:e.timezonePortLouis},{utcOffset:5,short:null,long:e.timezoneTashkent},{utcOffset:5,short:null,long:e.timezoneIslamabad},{utcOffset:6,short:null,long:e.timezoneEkaterinburg},{utcOffset:6,short:null,long:e.timezoneAstana},{utcOffset:6,short:null,long:e.timezoneDhaka},{utcOffset:7,short:e.timezoneICT,long:e.timezoneNovosibirsk},{utcOffset:7,short:e.timezoneICT,long:e.timezoneBangkok},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneKrasnoyarsk},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneBeijing},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneSingapore},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneTaipei},{utcOffset:8,short:e.timezoneCCT,long:e.timezonePerth},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneUlaanbaatar},{utcOffset:9,short:e.timezoneJST,long:e.timezoneIrkutsk},{utcOffset:9,short:e.timezoneJST,long:e.timezoneSeoul},{utcOffset:9,short:e.timezoneJST,long:e.timezoneOsaka},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneYakutsk},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneCanberra},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneBrisbane},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneHobart},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneGuam},{utcOffset:11,short:null,long:e.timezoneVladivostok},{utcOffset:11,short:null,long:e.timezoneSolomon},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneMagadan},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneFiji},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneAuckland},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneNukualofa}].map(({utcOffset:t,short:i,long:r})=>{const s=t>0?`UTC+${t}`:t<0?`UTC${t}`:"GMT";return i?{utcOffset:t,short:i,shortWithUTC:`${s} (${i})`,long:r}:{utcOffset:t,short:s,shortWithUTC:s,long:r}})}let Lr=class extends Aw{constructor(e){super(e),this.view=null,this.datePickerViewModel=new gz,this.timeSliderViewModel=new Dg,this.lightingUpdateInterval=200,this._oldLighting=null,this.playSpeedMultiplier=1,this._cachedLightingDateUTC=new Date(0),this._cachedDisplayUTCOffset=0,this._firstInteraction=!0,this._lastLightingUpdate=0,this._nextLightingUpdate=null}initialize(){this.handles.add([vo(()=>this.view,e=>e.when(()=>this._updateLighting(null)),At),se(()=>Qi(this._lighting,e=>e.type==="sun"?e.date:null),e=>this._scheduleUpdateLighting(e)),En(()=>this._lighting,"timezone-will-change",e=>this._timezoneWillChange(e),{onListenerAdd:()=>this._timezoneWillChange(null)}),se(()=>Qi(this.view,e=>e.stationary)===!0,()=>{(this.dayPlaying||this.yearPlaying)&&this._updateSunriseAndSunset()},At),se(()=>{const e=this.timeSliderViewModel;return{vm:e,state:e.state,sliderPosition:this.timeSliderPosition}},({vm:e,state:t,sliderPosition:i})=>{t==="ready"&&e.setValue(0,i)}),se(()=>{var e;return(e=this.timeSliderViewModel.currentItem)==null?void 0:e.utcOffset},e=>this.utcOffset=e),se(()=>this.timeSliderViewModel.isDropdownOpen,()=>this.stopPlaying()),se(()=>this.timeSliderViewModel.values,e=>this.timeSliderPosition=e[0]),se(()=>this.datePickerViewModel.value,e=>{this.dayPlaying=!1,this.localDate=e}),se(()=>this.localDate,e=>{this.datePickerViewModel.value.valueOf()!==e.getTime()&&this.datePickerViewModel.set("value",e)})])}destroy(){this._nextLightingUpdate&&(clearTimeout(this._nextLightingUpdate),this._nextLightingUpdate=null),this.view=null}get isSupported(){return M(this.view)||this.view.type==="3d"}get utcOffset(){return this._cachedDisplayUTCOffset}set utcOffset(e){e!==this.utcOffset&&_(this._lighting)&&this._lighting.type==="sun"&&(this._lighting.displayUTCOffset=e,this._updateLighting(null))}get localDate(){return gUe(this._lightingDateDisplay)}set localDate(e){e.getTime()!==this.localDate.getTime()&&(this._lightingDateDisplay=mUe(this._lightingDateDisplay,e))}get timeSliderPosition(){return G_t(this._lightingDateDisplay)}set timeSliderPosition(e){Math.abs(e-this.timeSliderPosition)>1/60&&(this._lightingDateDisplay=B_t(this._lightingDateDisplay,e),this.stopPlaying(),this._enableDirectShadowsIfFirstInteraction())}_timezoneFromCamera(e,t){if(M(t)||!e.cameraTrackingEnabled)return 0;const i=bH([t.longitude,t.latitude]);return M(i)?0:Math.round(i.hours+i.minutes/60+i.seconds/3600)}get directShadowsEnabled(){const e=Qi(this._lighting,t=>t.directShadowsEnabled);return ft(e,!1)}set directShadowsEnabled(e){Qi(this._lighting,t=>{t.directShadowsEnabled=e})}get sunLightingEnabled(){return this._lightingType==="sun"}set sunLightingEnabled(e){const t=this._environment;if(e===this._get("sunLightingEnabled")||M(t))return;const i=t.lighting,r=this._oldLighting;this._oldLighting=i;const s={directShadowsEnabled:i.directShadowsEnabled,ambientOcclusionEnabled:i.ambientOcclusionEnabled,waterReflectionEnabled:i.waterReflectionEnabled},n=e?"sun":"virtual";let o;o=_(r)&&r.type===n?r:e?new $f:new DS,o.set(s),t.lighting=o,e||(this.timeSliderViewModel.isDropdownOpen=!1)}set playingState(e){this.playingState!==e&&this.sunLightingEnabled&&(this._set("playingState",e),e!=="none"&&(this._updateSunriseAndSunset(),this._lastTime=Date.now(),this._play(),this._enableDirectShadowsIfFirstInteraction()))}get dayPlaying(){return this.playingState==="day"}set dayPlaying(e){e?this.playingState="day":this.dayPlaying&&(this.playingState="none")}get yearPlaying(){return this.playingState==="year"}set yearPlaying(e){e?this.playingState="year":this.yearPlaying&&(this.playingState="none")}get currentSeason(){return U_t(this.localDate,this._currentHemisphere)}set currentSeason(e){this.stopPlaying();const t=LJ(e,this._currentHemisphere);this.localDate=eO(this.localDate,t,Wf.NORTHERN)}get _currentHemisphere(){const e=Qi(this.view,t=>{var i;return(i=t.camera)==null?void 0:i.position});return M(e)||e.latitude>=0?Wf.NORTHERN:Wf.SOUTHERN}get _environment(){return Qi(this.view,e=>e.environment)}get _lighting(){return Qi(this._environment,e=>e.lighting)}get _lightingType(){return Qi(this._lighting,e=>e.type)}get _lightingDateDisplay(){return Hh(this._cachedLightingDateUTC,this._cachedDisplayUTCOffset,"hours")}set _lightingDateDisplay(e){const t=this._lighting;if(M(t)||!this.sunLightingEnabled||t.type!=="sun")return;const i=Hh(e,-this._cachedDisplayUTCOffset,"hours");i.getTime()!==t.date.getTime()&&(t.date=i,this._updateLighting(null))}stopPlaying(){this.playingState="none"}toggleDayPlaying(){this.dayPlaying=!this.dayPlaying}toggleYearPlaying(){this.yearPlaying=!this.yearPlaying}toggleSunLightingEnabled(){this.stopPlaying(),this.sunLightingEnabled=!this.sunLightingEnabled}toggleDirectShadowsEnabled(){this.stopPlaying(),this.directShadowsEnabled=!this.directShadowsEnabled}_enableDirectShadowsIfFirstInteraction(){this._firstInteraction&&(this._firstInteraction=!1,this.directShadowsEnabled=!0)}_updateLighting(e){var a;const t=Date.now();this._lastLightingUpdate=t;const{view:i}=this,r=this._lighting;if(M(i)||M(r)||r.type!=="sun")return;const s=e||r.date,n=r.displayUTCOffset,o=n!==null?n:this._timezoneFromCamera(r,(a=i.camera)==null?void 0:a.position);this._cachedLightingDateUTC.getTime()!==s.getTime()&&(this._cachedLightingDateUTC=new Date(s.getTime())),this._cachedDisplayUTCOffset!==o&&(this._cachedDisplayUTCOffset=o)}_timezoneWillChange(e){const t=this._lighting;if(M(t)||t.type!=="sun"||!t.cameraTrackingEnabled)return;let i;if(e)i=e.timezoneOffset;else{if(t.displayUTCOffset!=null)return;i=$f.calculateTimezoneOffset(t.positionTimezoneInfo)}t.displayUTCOffset=i,this._scheduleUpdateLighting(null)}_scheduleUpdateLighting(e){if(this._nextLightingUpdate||M(e))return;const t=Date.now()-this._lastLightingUpdate,i=this.lightingUpdateInterval-t;i<=0?ix(()=>this._updateLighting(e)):this._nextLightingUpdate=setTimeout(()=>{this._updateLighting(null),this._nextLightingUpdate=null},i)}_play(){const e=this._lighting;if(!M(e)&&this.sunLightingEnabled&&e.type==="sun"&&(this.dayPlaying||this.yearPlaying)){const t=Date.now()-this._lastTime;if(this.dayPlaying){this._lastTime=Date.now();const i=j_t(this._sunrise,this._sunset,e.date)*this.playSpeedMultiplier/100*t;if(i>0){let r=new Date(e.date.getTime()+i);((r.getUTCHours()+e.displayUTCOffset)%24+24)%24<((e.date.getUTCHours()+e.displayUTCOffset)%24+24)%24&&(r=new Date(e.date.getTime()+i-864e5)),e.date=r}}else if(t>1e3){this._lastTime=Date.now();const i=(e.date.getUTCMonth()+1)%12,r=new Date(e.date.getTime());r.setUTCMonth(i),e.date=r}requestAnimationFrame(()=>this._play())}}_updateSunriseAndSunset(){const e=this._lighting;if(M(e)||e.type!=="sun"||!this.sunLightingEnabled)return;const t=Qi(this.view,r=>{var s;return(s=r.camera)==null?void 0:s.position});if(M(t))return;const i=Y_t(e.date,t.latitude,t.longitude,e.displayUTCOffset);this._sunrise=new Date(i.sunrise),this._sunset=new Date(i.sunset)}};u([d({type:n_t})],Lr.prototype,"view",void 0),u([d({type:gz,nonNullable:!0})],Lr.prototype,"datePickerViewModel",void 0),u([d({type:Dg,nonNullable:!0})],Lr.prototype,"timeSliderViewModel",void 0),u([d()],Lr.prototype,"isSupported",null),u([d()],Lr.prototype,"lightingUpdateInterval",void 0),u([d()],Lr.prototype,"utcOffset",null),u([d()],Lr.prototype,"localDate",null),u([d()],Lr.prototype,"timeSliderPosition",null),u([d()],Lr.prototype,"directShadowsEnabled",null),u([d()],Lr.prototype,"sunLightingEnabled",null),u([d({type:["none","day","year"],value:"none"})],Lr.prototype,"playingState",null),u([d()],Lr.prototype,"dayPlaying",null),u([d()],Lr.prototype,"yearPlaying",null),u([d()],Lr.prototype,"playSpeedMultiplier",void 0),u([d()],Lr.prototype,"currentSeason",null),u([d()],Lr.prototype,"_lastTime",void 0),u([d()],Lr.prototype,"_sunrise",void 0),u([d()],Lr.prototype,"_sunset",void 0),u([d()],Lr.prototype,"_cachedLightingDateUTC",void 0),u([d()],Lr.prototype,"_cachedDisplayUTCOffset",void 0),u([d()],Lr.prototype,"_firstInteraction",void 0),u([d()],Lr.prototype,"_currentHemisphere",null),u([d()],Lr.prototype,"_environment",null),u([d()],Lr.prototype,"_lighting",null),u([d()],Lr.prototype,"_lightingType",null),u([d()],Lr.prototype,"_lightingDateDisplay",null),Lr=u([P("esri.widgets.Daylight.DaylightViewModel")],Lr);const $Ee=Lr;let xg=class extends Se{constructor(){super(...arguments),this.header=!0,this.playButtons=!0,this.datePicker=!0,this.timezone=!0,this.sunLightingToggle=!0,this.shadowsToggle=!0}};u([d({type:Boolean,nonNullable:!0})],xg.prototype,"header",void 0),u([d({type:Boolean,nonNullable:!0})],xg.prototype,"playButtons",void 0),u([d({type:Boolean,nonNullable:!0})],xg.prototype,"datePicker",void 0),u([d({type:Boolean,nonNullable:!0})],xg.prototype,"timezone",void 0),u([d({type:Boolean,nonNullable:!0})],xg.prototype,"sunLightingToggle",void 0),u([d({type:Boolean,nonNullable:!0})],xg.prototype,"shadowsToggle",void 0),xg=u([P("esri.widgets.Daylight.VisibleElements")],xg);const DEe=xg,Qt={base:"esri-slider",reversed:"esri-slider--reversed",horizontalLayout:"esri-slider--horizontal",verticalLayout:"esri-slider--vertical",contentElement:"esri-slider__content",extraContentElement:"esri-slider__extra-content",trackElement:"esri-slider__track",ticksContainerElement:"esri-slider__ticks",tickElement:"esri-slider__tick",tickLabelElement:"esri-slider__tick-label",maxElement:"esri-slider__max",minElement:"esri-slider__min",maxElementInteractive:"esri-slider__max--interactive",minElementInteractive:"esri-slider__min--interactive",rangeElementActive:"esri-slider__range--active",rangeInput:"esri-slider__range-input",anchorElement:"esri-slider__anchor",movingAnchorElement:"esri-slider__anchor--moving",lastMovedAnchorElement:"esri-slider__anchor--moved",anchorElementActive:"esri-slider__anchor--active",anchorElementIndexPrefix:"esri-slider__anchor-",segmentElement:"esri-slider__segment",segmentElementIndexPrefix:"esri-slider__segment-",segmentElementInteractive:"esri-slider__segment--interactive",segmentElementActive:"esri-slider__segment--active",effectiveSegmentElement:"esri-slider__effective-segment",effectiveMaxSegmentElement:"esri-slider__effective-max-segment",effectiveMinSegmentElement:"esri-slider__effective-min-segment",thumbElement:"esri-slider__thumb",labelElement:"esri-slider__label",labelElementInteractive:"esri-slider__label--interactive",labelInput:"esri-slider__label-input",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},Gl={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},Q_t="esri.widgets.Slider",pue={labels:!1,rangeLabels:!1};let gi=class extends Xs{constructor(e,t){super(e,t),this._activeLabelInputIndex=null,this._anchorElements=[],this._dragged=!1,this._dragStartInfo=null,this._focusedAnchorIndex=null,this._isMinInputActive=!1,this._isMaxInputActive=!1,this._lastMovedHandleIndex=null,this._positionPrecision=5,this._segmentDragStartInfo=null,this._trackHeight=null,this._trackWidth=null,this._zIndices=null,this._zIndexOffset=3,this.disabled=!1,this.draggableSegmentsEnabled=!0,this.effectiveMax=null,this.effectiveMin=null,this.effectiveSegmentElements=new it,this.extraNodes=[],this.inputCreatedFunction=null,this.inputFormatFunction=null,this.inputParseFunction=null,this.label=void 0,this.labelElements=new it,this.labelInputsEnabled=!1,this.labelFormatFunction=null,this.labels=null,this.max=null,this.maxLabelElement=null,this.messages=null,this.min=null,this.minLabelElement=null,this.precision=4,this.rangeLabelInputsEnabled=!1,this.segmentElements=new it,this.snapOnClickEnabled=!0,this.steps=null,this.syncedSegmentsEnabled=!1,this.thumbsConstrained=!0,this.thumbCreatedFunction=null,this.thumbElements=new it,this.tickElements=new it,this.trackElement=null,this.values=null,this.viewModel=new IEe,this.visibleElements=F({},pue),this._onAnchorPointerDown=this._onAnchorPointerDown.bind(this),this._onAnchorPointerMove=this._onAnchorPointerMove.bind(this),this._onAnchorPointerUp=this._onAnchorPointerUp.bind(this),this._onLabelPointerDown=this._onLabelPointerDown.bind(this),this._onLabelPointerUp=this._onLabelPointerUp.bind(this),this._onSegmentPointerDown=this._onSegmentPointerDown.bind(this),this._onSegmentPointerMove=this._onSegmentPointerMove.bind(this),this._onSegmentPointerUp=this._onSegmentPointerUp.bind(this),this._onTrackPointerDown=this._onTrackPointerDown.bind(this),this._onTrackPointerMove=this._onTrackPointerMove.bind(this),this._onTrackPointerUp=this._onTrackPointerUp.bind(this)}destroy(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this.labelElements.removeAll(),this.labelElements.destroy(),this.segmentElements.removeAll(),this.segmentElements.destroy(),this.effectiveSegmentElements.removeAll(),this.effectiveSegmentElements.destroy(),this.thumbElements.removeAll(),this.thumbElements.destroy(),this.tickElements.removeAll(),this.tickElements.destroy()}set layout(e){["vertical","vertical-reversed","horizontal","horizontal-reversed"].includes(e)||(e="horizontal"),this._set("layout",e)}get state(){const{_activeLabelInputIndex:e,_isMaxInputActive:t,_isMinInputActive:i,_dragStartInfo:r,_segmentDragStartInfo:s,disabled:n,viewModel:o}=this,a=_(r)||_(s);return n?"disabled":e===null&&!t&&!i?a?"dragging":o.state:"editing"}set tickConfigs(e){this._set("tickConfigs",e),this.scheduleRender()}castVisibleElements(e){return F(F({},pue),e)}render(){const{label:e}=this,t=this.classes(Qt.base,Qt.esriWidget,this._isHorizontalLayout()?Qt.horizontalLayout:Qt.verticalLayout,this._isReversedLayout()?Qt.reversed:null,this._isDisabled()?Qt.disabled:null);return this._storeTrackDimensions(),W("div",{"aria-label":e,class:t,"touch-action":"none",bind:this,afterCreate:this._afterContainerCreate},this.renderContent())}toNextStep(e){this._toStep(e,1)}toPreviousStep(e){this._toStep(e,-1)}renderContent(){const{max:e,min:t}=this;if(!(M(t)||M(e)||t>=e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]}renderSliderContainer(){return W("div",{key:"slider-container",bind:this,class:Qt.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())}renderTrackElement(){return W("div",{afterCreate:this._afterTrackCreate,afterRemoved:this._afterTrackRemoved,bind:this,class:Qt.trackElement,"data-node-ref":"trackElement","touch-action":"none"},this.renderEffectiveSegmentElements(),this.renderSegmentElements(),this.renderAnchorElements())}renderEffectiveSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=_(this.effectiveMax),t=_(this.effectiveMin);if(!e&&!t)return;const{max:i,min:r,viewModel:s}=this,n=s.getBounds(),o=[];return t&&o.push(this.renderEffectiveSegmentElement(r,n.min,!0)),e&&o.push(this.renderEffectiveSegmentElement(n.max,i,!1)),o}renderSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length,t=[];for(let i=0;i<=e;i++)t.push(this.renderSegmentElement(i));return t}renderSegmentElement(e){const{_trackHeight:t,_trackWidth:i,draggableSegmentsEnabled:r,id:s,state:n,values:o}=this,a=this._isHorizontalLayout(),l=a?i:t,c=this.viewModel.getBounds(),h=this._positionFromValue(c.max),p=this._positionFromValue(c.min),f=e===o.length?null:e,m=e===0?null:e-1,y=_(f),v=_(m);let w,b;const S=[...o].sort((I,L)=>I-L);this._isReversedLayout()?(w=v?this._positionFromValue(S[m]):p,b=y?this._positionFromValue(S[f]):h):(w=y?this._positionFromValue(S[f]):h,b=v?this._positionFromValue(S[m]):p);const T=this._applyPrecisionToPosition(100*b/l),E=(w-b)/l,C=a?`transform: translate(${T}%, 0px) scale(${E}, 1);`:`transform: translate(0px, ${T}%) scale(1, ${E});`,A=this.classes(Qt.segmentElement,Qt.segmentElementIndexPrefix+e,r&&y&&v&&n!=="disabled"?Qt.segmentElementInteractive:null);return W("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:A,"data-max-thumb-index":f,"data-min-thumb-index":m,"data-segment-index":e,key:`${s}-segment-${e}`,style:C,"touch-action":"none"})}renderEffectiveSegmentElement(e,t,i){const{_trackHeight:r,_trackWidth:s,layout:n}=this,o=this._positionFromValue(e),a=this._positionFromValue(t),l=this._isHorizontalLayout(),c=l?s:r,h=this._applyPrecisionToPosition(100*o/c);let p=null;if(n==="horizontal"){const y=i?c-a:a,v=o===c?0:h;p=`clip-path: inset(0% ${a===c?0:this._applyPrecisionToPosition(y/c*100)}% 0% ${v}%);`}else{const y=(a-o)/c;p=l?`transform: translate(${h}%, 0px) scale(${y}, 1);`:`transform: translate(0px, ${h}%) scale(1, ${y});`}const f=i?Qt.effectiveMinSegmentElement:Qt.effectiveMaxSegmentElement,m=this.classes(Qt.segmentElement,Qt.effectiveSegmentElement,f);return W("div",{afterCreate:this._afterEffectiveSegmentCreate,afterRemoved:this._afterEffectiveSegmentRemoved,bind:this,class:m,style:p,"touch-action":"none"})}renderAnchorElements(){const{trackElement:e,values:t}=this;if(t&&t.length)return this._zIndices=t.map((i,r)=>{const s=this._positionFromValue(i),n=this._positionToPercent(s),o=(this._isHorizontalLayout()?n>50:n<50)?-1:1;return this._zIndexOffset+(t.length+o*r)}),e&&t&&t.length?t.map((i,r)=>this.renderAnchorElement(i,r)):null}renderAnchorElement(e,t){const i=this._positionFromValue(e),r=this._valueFromPosition(i);if(M(r)||isNaN(r))return;const{_dragStartInfo:s,_lastMovedHandleIndex:n,id:o,layout:a,values:l,visibleElements:{labels:c}}=this,h=s&&s.index===t,p=n===t,f=this.classes(Qt.anchorElement,Qt.anchorElementIndexPrefix+t,h?Qt.movingAnchorElement:null,p?Qt.lastMovedAnchorElement:null),m=this.labels.values[t],y=this._getStyleForAnchor(e,t,h||p),{min:v,max:w}=this.viewModel.getBoundsForValueAtIndex(t),{disabled:b,messages:S}=this,T=l.length===2?Af(t===0?S.rangeMinimum:S.rangeMaximum,{value:e}):m,E=l.length===1?null:t===0?`${o}-handle-${t+1}`:t===l.length-1?`${o}-handle-${t-1}`:`${o}-handle-${t-1} ${o}-handle-${t+1}`;return W("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":E,"aria-label":S.sliderValue,"aria-labelledby":c?`${o}-label-${t}`:null,"aria-orientation":a,"aria-valuemax":w.toString(),"aria-valuemin":v.toString(),"aria-valuenow":e.toString(),"aria-valuetext":T,bind:this,class:f,"data-thumb-index":t,"data-value":e,id:`${o}-handle-${t}`,key:`${o}-handle-${t}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:y,tabIndex:b?-1:0},W("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:Qt.thumbElement,"data-thumb-index":t,"touch-action":"none"}),this.renderThumbLabel(t))}renderThumbLabel(e){const{id:t,labels:i,labelInputsEnabled:r,state:s}=this,n=this.visibleElements.labels,o=i.values[e],a=this.classes(Qt.labelElement,n?null:Qt.hidden,r&&s!=="disabled"?Qt.labelElementInteractive:null);return W("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!n).toString(),bind:this,class:a,"data-thumb-index":e,key:`${t}-label-${e}`,id:`${t}-label-${e}`,role:r?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):o)}renderValueInput(e){const{disabled:t,values:i}=this,r=i[e];return W("input",{key:`value-input-${e}`,afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:Qt.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:t?-1:0,type:"text",value:this._formatInputValue(r,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})}renderMax(){const{_isMaxInputActive:e,labels:t,rangeLabelInputsEnabled:i,state:r}=this,s=this.visibleElements.rangeLabels,n=this.classes(Qt.maxElement,{[Qt.hidden]:!s,[Qt.maxElementInteractive]:i&&r!=="disabled",[Qt.rangeElementActive]:e});return W("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMaxLabelCreate,bind:this,class:n,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:i?"button":null,tabIndex:!this.disabled&&i?0:-1},e?this.renderMaxInput():t.max)}renderMin(){const{_isMinInputActive:e,labels:t,rangeLabelInputsEnabled:i,state:r}=this,s=this.visibleElements.rangeLabels,n=this.classes(Qt.minElement,{[Qt.hidden]:!s,[Qt.minElementInteractive]:i&&r!=="disabled",[Qt.rangeElementActive]:e});return W("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMinLabelCreate,bind:this,class:n,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:i?"button":null,tabIndex:!this.disabled&&i?0:-1},e?this.renderMinInput():t.min)}renderMaxInput(){return W("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:Qt.rangeInput,"data-input-type":"max",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})}renderMinInput(){return W("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:Qt.rangeInput,"data-input-type":"min",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})}renderExtraContentElements(){return W("div",{bind:this,class:Qt.extraContentElement},this.extraNodes)}renderTicksContainer(){if(this.tickConfigs&&this.trackElement&&(this._trackHeight!==0||this._trackWidth!==0))return this.tickConfigs.map((e,t)=>W("div",{key:"ticks-container",class:this.classes(Qt.ticksContainerElement)},this.renderTicks(e,t)))}renderTicks(e,t){const{mode:i,values:r}=e;if(this.tickElements.getItemAt(t)||this.tickElements.add(new it,t),i==="position"){const o=Array.isArray(r)?r:[r];return this._calculateTickPositions(o).map((a,l)=>this.renderTickGroup(e,l,t,a))}if(i==="percent"&&Array.isArray(r)){const{max:o,min:a}=this,l=o-a,c=r.map(h=>this._applyPrecisionToPosition(h/100*l+a));return this._calculateTickPositions(c).map((h,p)=>this.renderTickGroup(e,p,t,h))}const s=Array.isArray(r)&&r.length?r[0]:isNaN(r)?null:r,n=this._getTickCounts(s,e);return this._calculateEquidistantTickPositions(n).map((o,a)=>this.renderTickGroup(e,a,t,o))}renderTickGroup(e,t,i,r){const s=e.mode==="position"?Array.isArray(e.values)?e.values[t]:e.values:this._valueFromPosition(r);if(!M(s)&&!isNaN(s))return W("div",{afterCreate:this._afterTickGroupCreate,afterRemoved:this._afterTickGroupRemoved,bind:this,"data-config":e,"data-position":r,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":s,onclick:this._onTickGroupClick,key:`tick-group-${t}`},this.renderTickLine(e,t,i,s),e.labelsVisible?this.renderTickLabel(e,t,i,s):null)}renderTickLine(e,t,i,r){return W("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":r.toString(),bind:this,class:Qt.tickElement,"data-config":e,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":r,key:`tick-label-${t}`,style:this._getPositionStyleForElement(r)})}renderTickLabel(e,t,i,r){const s=e.labelFormatFunction?e.labelFormatFunction(r,"tick",t):this.viewModel.getLabelForValue(r,"tick",t);return W("div",{afterCreate:this._afterTickLabelCreate,"aria-label":s,"aria-valuenow":r.toString(),"aria-valuetext":s,bind:this,class:Qt.tickLabelElement,"data-config":e,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":r,key:`tick-label-${t}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(r)}`},s)}_afterContainerCreate(e){this.own(NNe(e,()=>this.scheduleRender()))}_afterTrackCreate(e){this._set("trackElement",e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()}_afterTrackRemoved(e){e.removeEventListener("pointerdown",this._onTrackPointerDown),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp)}_afterSegmentCreate(e){this.segmentElements.add(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)}_afterSegmentRemoved(e){this.segmentElements.remove(e),e.removeEventListener("pointerdown",this._onSegmentPointerDown)}_afterEffectiveSegmentCreate(e){this.effectiveSegmentElements.add(e)}_afterEffectiveSegmentRemoved(e){this.effectiveSegmentElements.remove(e)}_afterAnchorCreate(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const t=e["data-thumb-index"],i=e["data-value"],r=this.thumbElements.getItemAt(t)||null,s=this.labelElements.getItemAt(t)||null;this.thumbCreatedFunction(t,i,r,s)}}_afterAnchorUpdate(e){_(this._focusedAnchorIndex)&&e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}_afterAnchorRemoved(e){const t=this._anchorElements.indexOf(e,0);t>-1&&this._anchorElements.splice(t,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)}_afterThumbCreate(e){this.thumbElements.add(e)}_afterThumbRemoved(e){this.thumbElements.remove(e)}_afterLabelCreate(e){this.labelElements.add(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)}_afterLabelRemoved(e){this.labelElements.remove(e),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)}_afterInputCreate(e){if(e.focus(),e.select(),this.inputCreatedFunction){const t=e.getAttribute("data-input-type"),i=t==="thumb"?e["data-input-index"]:null;this.inputCreatedFunction(e,t,i)}}_afterTickLineCreate(e){const t=e["data-tick-config-index"],i=e["data-tick-group-index"],r=this.tickElements.getItemAt(t);r.getItemAt(i)?r.getItemAt(i).tickElement=e:r.add({groupElement:null,tickElement:e,labelElement:null},i)}_afterTickLabelCreate(e){const t=e["data-tick-config-index"],i=e["data-tick-group-index"],r=this.tickElements.getItemAt(t);r.getItemAt(i)?r.getItemAt(i).labelElement=e:r.add({groupElement:null,labelElement:e,tickElement:null},i)}_afterTickGroupRemoved(e){const t=e["data-tick-config-index"],i=this.tickElements.items[t],r=i==null?void 0:i.find(s=>s.groupElement===e);r&&i.remove(r)}_afterTickGroupCreate(e){var i,r;const t=e["data-config"];if(t&&t.tickCreatedFunction){const s=e["data-tick-config-index"],n=e["data-tick-group-index"],o=e["data-value"],a=(r=(i=this.tickElements)==null?void 0:i.getItemAt(s))==null?void 0:r.getItemAt(n);if(a){a.groupElement=e;const l=a.tickElement||null,c=a.labelElement||null;t.tickCreatedFunction(o,l,c)}}}_afterMaxLabelCreate(e){this._set("maxLabelElement",e)}_afterMinLabelCreate(e){this._set("minLabelElement",e)}_onAnchorKeyDown(e){if(this._isDisabled()||this.state==="editing")return;const{target:t}=e,i=vl(e),{_anchorElements:r,values:s}=this,n=t["data-thumb-index"],o=r[n],a=s[n],l=[Gl.moveAnchorUp,Gl.moveAnchorDown,Gl.moveAnchorLeft,Gl.moveAnchorRight];if(i===Gl.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=n,this.notifyChange("state");else if(l.includes(i)){e.preventDefault();const{steps:c}=this,h=i===Gl.moveAnchorUp||i===Gl.moveAnchorRight?1:-1;if(_(c))this._toStep(n,this._isReversedLayout()?-1*h:h);else{const{precision:f}=this,m=this._getPositionOfElement(o),y=this._valueFromPosition(m),v=this._isHorizontalLayout()?h:-1*h;let w;w=f===0?this._positionFromValue(y+v):f===1?this._positionFromValue(y+.1*v):m+v,this._toPosition(n,w)}const p=this.values[n];a!==p&&this._emitThumbChangeEvent({index:n,oldValue:a,value:p})}else if(i===Gl.moveAnchorToMax||i===Gl.moveAnchorToMin){e.preventDefault();const{min:c,max:h}=this._getAnchorBoundsInPixels(n),p=this._isPositionInverted()?i===Gl.moveAnchorToMax?c:h:i===Gl.moveAnchorToMin?c:h;this._toPosition(n,p);const f=this.values[n];a!==f&&this._emitThumbChangeEvent({index:n,oldValue:a,value:f})}}_onAnchorPointerDown(e){if(this._isDisabled())return;const{target:t,clientX:i,clientY:r}=e,s=t["data-thumb-index"];s!==void 0&&(e.preventDefault(),this._anchorElements[s]&&this._anchorElements[s].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:i,clientY:r,index:s,position:this._getPositionOfElement(this._anchorElements[s])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onAnchorPointerMove(e){if(this.state==="editing"||!this._dragStartInfo)return;e.preventDefault();const{values:t,_anchorElements:i,_dragged:r,_dragStartInfo:s,_dragStartInfo:{index:n,position:o}}=this,{clientX:a,clientY:l}=e,c=r?"drag":"start",h=i[n],p=this._getPositionOfElement(h),f=this._applyPrecisionToPosition(this._isHorizontalLayout()?o+a-s.clientX:o+l-s.clientY);if(p===f)return;const m=t[n];this._dragged=!0,this._toPosition(n,f);const y=this.values[n];r?m!==y&&this._emitThumbDragEvent({index:n,state:c,value:y}):this._emitThumbDragEvent({index:n,state:c,value:m})}_onAnchorPointerUp(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:t}=this._dragStartInfo,i=this._dragged,r=this.values[t];this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=t,this.notifyChange("state"),i?this._emitThumbDragEvent({index:t,state:"stop",value:r}):(this.scheduleRender(),this.state!=="editing"&&this._emitThumbClickEvent({index:t,value:r}))}_onTrackPointerDown(e){const{_dragStartInfo:t,snapOnClickEnabled:i,state:r,values:s}=this;if(this._isDisabled()||r==="editing"||t||(document.addEventListener("pointermove",this._onTrackPointerMove),document.addEventListener("pointerup",this._onTrackPointerUp),!i||!s.length))return;const{steps:n}=this,{clientX:o,clientY:a}=e,l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l),h=this._getIndexOfNearestValue(c),p=s[h],f=s.some((w,b)=>w===p&&b!==h)&&c>p?this.values.lastIndexOf(p):h;if(M(f))return;const m=s[f],y=_(n)?this._calculateNearestStepPosition(l):l;this._toPosition(f,y),this._dragged=!0,this._dragStartInfo={clientX:o,clientY:a,index:f,position:y},this._focusedAnchorIndex=f,this.notifyChange("state"),this._emitThumbDragEvent({index:f,state:"start",value:m});const v=this.values[f];m!==v&&this._emitThumbDragEvent({index:f,state:"drag",value:v}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}_onTrackPointerMove(e){e.preventDefault(),this._dragged=!0}_onTrackPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp),this.snapOnClickEnabled||(this._dragged=!1),!this._dragged){const t=this._getCursorPositionFromEvent(e),i=this._valueFromPosition(t);this._emitTrackClickEvent({value:i})}}_onSegmentPointerDown(e){var a,l;e.preventDefault();const t=e.target,i=t["data-segment-index"],r=t["data-min-thumb-index"],s=t["data-max-thumb-index"];if(this._isDisabled()||M(r)||M(s))return;e.stopPropagation(),this._storeTrackDimensions(),document.addEventListener("pointerup",this._onSegmentPointerUp);const n=this._getAnchorDetails(r),o=this._getAnchorDetails(s);this.syncedSegmentsEnabled?(this.segmentElements.forEach(c=>c.classList.add(Qt.segmentElementActive)),this._anchorElements.forEach(c=>c.classList.add(Qt.anchorElementActive))):(this.segmentElements.getItemAt(i).classList.add(Qt.segmentElementActive),(a=this._anchorElements[n.index])==null||a.classList.add(Qt.anchorElementActive),(l=this._anchorElements[o.index])==null||l.classList.add(Qt.anchorElementActive)),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:i,details:this._normalizeSegmentDetails({min:n,max:o})},this.draggableSegmentsEnabled&&(document.addEventListener("pointermove",this._onSegmentPointerMove),this.notifyChange("state"),this._emitSegmentDragEvent({index:i,state:"start",thumbIndices:[r,s]}))}_onSegmentPointerMove(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:t,_trackWidth:i,_segmentDragStartInfo:{index:r,cursorPosition:s,details:{min:n,max:o}}}=this,{index:a,position:l,value:c}=n,{index:h,position:p,value:f}=o;this._dragged=!0;const m=this._getCursorPositionFromEvent(e);if(m===s)return;const y=this._positionToPercent(s),v=this._positionToPercent(m)-y,w=this._positionToPercent(l)+v,b=this._positionToPercent(p)+v,{min:S}=this._getAnchorBoundsAsPercents(a),{max:T}=this._getAnchorBoundsAsPercents(h);let E=!1,C=!1;if(w<S?E=!0:b>T&&(C=!0),E){const{min:X,max:Z}=this.viewModel.getBoundsForValueAtIndex(a),ae=this._isPositionInverted()?Z:X,re=ae,$=f+(ae-c),k=$-this.values[h];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(k):this._updateAnchorValues([a,h],[re,$]))}if(C){const{min:X,max:Z}=this.viewModel.getBoundsForValueAtIndex(h),ae=this._isPositionInverted()?X:Z,re=ae,$=c+(ae-f),k=$-this.values[a];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(k):this._updateAnchorValues([a,h],[$,re]))}const A=this._isHorizontalLayout()?i:t,I=b/100*A,L=w/100*A,D=this.values,U=[D[a],D[h]],z=this._getValueForAnchorAtPosition(a,L),V=this._getValueForAnchorAtPosition(h,I);this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(z-U[0]):this._updateAnchorValues([a,h],[z,V]),[this.values[a],this.values[h]].every((X,Z)=>X===U[Z])||this._emitSegmentDragEvent({index:r,state:"drag",thumbIndices:[a,h]})}_onSegmentPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{_dragged:t,max:i,min:r,values:s}=this,{index:n,details:{min:{index:o},max:{index:a}}}=this._segmentDragStartInfo;if(this.segmentElements.forEach(l=>l.classList.remove(Qt.segmentElementActive)),this._anchorElements.forEach(l=>l.classList.remove(Qt.anchorElementActive)),this.draggableSegmentsEnabled){const l=i-r,c=s[o],h=s[a];this._lastMovedHandleIndex=c===h?c>l/2?o:a:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:n,state:"stop",thumbIndices:[o,a]})}if(!t){const l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l);this._emitSegmentClickEvent({index:n,value:c,thumbIndices:[o,a]})}}_onTickGroupClick(e){const t=e.target;if(t["data-config"]){const i=t["data-tick-config-index"],r=t["data-tick-group-index"],s=t["data-value"];this._emitTickClickEvent({configIndex:i,groupIndex:r,value:s})}}_storeTrackDimensions(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}}_onLabelPointerDown(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onLabelPointerMove(){this._isDisabled()||(this._dragged=!0)}_onLabelPointerUp(e){if(this._isDisabled())return;const t=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&_(t)&&(this._activeLabelInputIndex=t),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}_onLabelInputBlur(e){const{_activeLabelInputIndex:t,values:i,viewModel:r}=this,s=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!s)return;const n=this._parseInputValue(s,"value",t),o=i[t],{min:a,max:l}=this.viewModel.getBoundsForValueAtIndex(t);if(n<a||n>l)return;r.setValue(t,n);const c=this.values[t];o!==c&&this._emitThumbChangeEvent({index:t,oldValue:o,value:c})}_onInputKeyDown(e){if(this._isDisabled())return;const{target:t}=e,i=vl(e),{hideInput1:r,hideInput2:s,hideInput3:n}=Gl,{_activeLabelInputIndex:o,_anchorElements:a}=this,l=t;if(i===r||i===s||i===n){e.stopPropagation();const c=o;l.blur(),_(c)?a[c].focus():l.parentElement.focus()}}_onMaxLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"max-click",value:this.max}),this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state")))}_onMaxLabelKeyDown(e){this._isDisabled()||vl(e)!==Gl.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxInputBlur(e){const t=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!t)return;const i=this.max,r=this._parseInputValue(t,"max");r<=this.min||(this.viewModel.set("max",r),this.max!==i&&this._emitMaxChangeEvent({oldValue:i,value:this.max}))}_onMinLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"min-click",value:this.min}),this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state")))}_onMinLabelKeyDown(e){this._isDisabled()||vl(e)!==Gl.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinInputBlur(e){const t=e.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!t)return;const i=this.min,r=this._parseInputValue(t,"min");r>=this.max||(this.viewModel.set("min",r),this.min!==i&&this._emitMinChangeEvent({oldValue:i,value:this.min}))}_isDisabled(){return this.disabled||this.state==="disabled"}_positionFromValue(e){const{max:t,min:i}=this,r=t-i;if(r===0)return 0;const{_trackHeight:s,_trackWidth:n}=this,o=this._isHorizontalLayout();let a=parseFloat(o?(n*(e-i)/r).toFixed(2):(s*(t-e)/r).toFixed(2));return this._isReversedLayout()&&(a=o?n-a:s-a),a}_valueFromPosition(e){const{_trackHeight:t,_trackWidth:i,max:r,min:s,precision:n}=this,o=r-s;let a=this._isHorizontalLayout()?e*o/i+s:o*(1e3-e/t*1e3)/1e3+s;return this._isReversedLayout()&&(a=r+s-a),parseFloat(a.toFixed(n))}_positionToPercent(e){const{_trackHeight:t,_trackWidth:i}=this,r=100*e/(this._isHorizontalLayout()?i:t);return this._applyPrecisionToPosition(r)}_applyPrecisionToPosition(e){return parseFloat(e.toFixed(this._positionPrecision))}_isPositionInverted(){const{layout:e}=this;return e==="horizontal-reversed"||e==="vertical"}_isHorizontalLayout(){return this.layout.includes("horizontal")}_isReversedLayout(){return this.layout.includes("reversed")}_normalizeSegmentDetails(e){if(this._isPositionInverted()){const{min:t,max:i}=e;return{min:i,max:t}}return e}_parseInputValue(e,t,i){return this.inputParseFunction?this.inputParseFunction(e,t,i):this.viewModel.defaultInputParseFunction(e)}_formatInputValue(e,t,i){return this.inputFormatFunction?this.inputFormatFunction(e,t,i):this.viewModel.defaultInputFormatFunction(e)}_getAnchorDetails(e){const t=[...this.values].sort((r,s)=>r-s)[e],i=this.values.indexOf(t);return{index:i,position:this._getPositionOfElement(this._anchorElements[i]),value:t}}_updateAnchorStyle(e,t){const i=this._anchorElements[e];i&&(this._isHorizontalLayout()?i.style.left=`${t}`:i.style.top=`${t}`)}_getStyleForAnchor(e,t,i){const r=this._getPositionStyleForElement(e);if(this.values.length===1)return`${r}`;const s=this._zIndices[t];return`${r}; z-index: ${i?this._zIndexOffset+s:s}`}_getPositionStyleForElement(e){const t=this._positionFromValue(e),i=this._positionToPercent(t);return`${this._isHorizontalLayout()?"left":"top"}: ${i+"%"}`}_getPositionOfElement(e){const t=this._getDimensions(e.offsetParent),i=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(i.left-t.left):this._applyPrecisionToPosition(i.top-t.top)}_updateAnchorValues(e,t){e.forEach((i,r)=>this._toValue(i,t[r]))}_updateAnchorValuesByDifference(e){const{min:t,max:i,values:r}=this;r.forEach((s,n)=>this._toValue(n,Math.max(Math.min(s+e,i),t)))}_toValue(e,t){_(this.steps)&&(t=this._getStepValues()[this._getIndexOfNearestStepValue(t)]),this._updateAnchorStyle(e,this._getPositionStyleForElement(t)),this.viewModel.setValue(e,t)}_toPosition(e,t){const i=_(this.steps)?this._getStepValueForAnchorAtPosition(e,t):this._getValueForAnchorAtPosition(e,t);this._updateAnchorStyle(e,this._getPositionStyleForElement(i)),this.viewModel.setValue(e,i)}_getValueForAnchorAtPosition(e,t){const{min:i,max:r}=this._getAnchorBoundsInPixels(e),{min:s,max:n}=this.viewModel.getBoundsForValueAtIndex(e);let o,a,l=null;return this._isPositionInverted()?(o=s,a=n):(o=n,a=s),l=t>r?o:t<i?a:this._valueFromPosition(t),l>n?l=n:l<s&&(l=s),l}_getStepValueForAnchorAtPosition(e,t){const i=this._getStepValues(),r=this._calculateNearestStepPosition(t),s=this._getValueForAnchorAtPosition(e,r);return i[this._getIndexOfNearestStepValue(s)]}_getAnchorBoundsAsPercents(e){const{min:t,max:i}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(t),max:this._positionToPercent(i)}}_getAnchorBoundsInPixels(e){const{_anchorElements:t,_trackHeight:i,_trackWidth:r,effectiveMax:s,effectiveMin:n,thumbsConstrained:o}=this,a=t[e-1],l=t[e+1],c=this._isHorizontalLayout()?r:i;let h,p;return this._isPositionInverted()?(h=_(n)?this._positionFromValue(n):c,p=_(s)?this._positionFromValue(s):0):(h=_(s)?this._positionFromValue(s):c,p=_(n)?this._positionFromValue(n):0),o?this._isPositionInverted()?{max:a?this._getPositionOfElement(a):h,min:l?this._getPositionOfElement(l):p}:{max:l?this._getPositionOfElement(l):h,min:a?this._getPositionOfElement(a):p}:{max:h,min:p}}_getIndexOfNearestValue(e){return this.values.indexOf(this.values.reduce((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t))}_getCursorPositionFromEvent(e){const t=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-t.left:e.clientY-t.top}_getStepValues(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:t,min:i}=this,r=Math.ceil((t-i)/e),s=[];for(let n=0;n<=r;n++){const o=i+e*n;s.push(o>t?t:o)}return s}_toStep(e,t){const{values:i,viewModel:r}=this,s=i[e],n=this._getStepValues(),o=n.indexOf(s);let a=null;if(o>-1){let l=n[o+t];isNaN(l)&&(l=n[o]);const c=this._positionFromValue(l);a=this._getStepValueForAnchorAtPosition(e,c)}else a=n[this._getIndexOfNearestStepValue(s)+t];r.setValue(e,a)}_getIndexOfNearestStepValue(e){const{steps:t}=this;if(M(t))return null;const i=this._getStepValues(),r=i.reduce((s,n)=>Math.abs(n-e)<Math.abs(s-e)?n:s);return i.indexOf(r)}_calculateNearestStepPosition(e){const t=this._valueFromPosition(e),i=this._getIndexOfNearestStepValue(t),r=this._getStepValues();return this._positionFromValue(r[i])}_getTickCounts(e,t){const{mode:i}=t;return i==="count"||i==="position"?e||0:i==="percent"&&100/e||0}_calculateTickPositions(e){return e.map(t=>this._positionFromValue(t))}_calculateEquidistantTickPositions(e){const{_trackWidth:t,_trackHeight:i}=this,r=this._isHorizontalLayout()?t:i,s=r/(e-1),n=[];if(e===1)return[r/2];for(let o=0;o<e;o++){const a=o*s;a<=r&&n.push(a)}return n}_getDimensions(e){try{return e.getBoundingClientRect()}catch(t){if(typeof t=="object"&&t!==null)return new DOMRect(0,0,0,0);throw t}}_emitTrackClickEvent(e){this.emit("track-click",me(F({},e),{type:"track-click"}))}_emitTickClickEvent(e){this.emit("tick-click",me(F({},e),{type:"tick-click"}))}_emitMaxChangeEvent(e){this.emit("max-change",me(F({},e),{type:"max-change"}))}_emitMinChangeEvent(e){this.emit("min-change",me(F({},e),{type:"min-change"}))}_emitThumbChangeEvent(e){this.emit("thumb-change",me(F({},e),{type:"thumb-change"}))}_emitThumbClickEvent(e){this.emit("thumb-click",me(F({},e),{type:"thumb-click"}))}_emitThumbDragEvent(e){this.emit("thumb-drag",me(F({},e),{type:"thumb-drag"}))}_emitSegmentClickEvent(e){this.emit("segment-click",me(F({},e),{type:"segment-click"}))}_emitSegmentDragEvent(e){this.emit("segment-drag",me(F({},e),{type:"segment-drag"}))}_emitRangeLabelClickEvent(e){this.emit(e.type,F({},e))}};u([d()],gi.prototype,"disabled",void 0),u([d()],gi.prototype,"draggableSegmentsEnabled",void 0),u([qe("viewModel.effectiveMax")],gi.prototype,"effectiveMax",void 0),u([qe("viewModel.effectiveMin")],gi.prototype,"effectiveMin",void 0),u([d({readOnly:!0})],gi.prototype,"effectiveSegmentElements",void 0),u([d()],gi.prototype,"extraNodes",void 0),u([d()],gi.prototype,"inputCreatedFunction",void 0),u([qe("viewModel.inputFormatFunction")],gi.prototype,"inputFormatFunction",void 0),u([qe("viewModel.inputParseFunction")],gi.prototype,"inputParseFunction",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],gi.prototype,"label",void 0),u([d({readOnly:!0})],gi.prototype,"labelElements",void 0),u([d()],gi.prototype,"labelInputsEnabled",void 0),u([qe("viewModel.labelFormatFunction")],gi.prototype,"labelFormatFunction",void 0),u([qe("viewModel.labels")],gi.prototype,"labels",void 0),u([d({value:"horizontal"})],gi.prototype,"layout",null),u([qe("viewModel.max")],gi.prototype,"max",void 0),u([d({readOnly:!0})],gi.prototype,"maxLabelElement",void 0),u([d(),js("esri/widgets/Slider/t9n/Slider")],gi.prototype,"messages",void 0),u([qe("viewModel.min")],gi.prototype,"min",void 0),u([d({readOnly:!0})],gi.prototype,"minLabelElement",void 0),u([qe("viewModel.precision")],gi.prototype,"precision",void 0),u([d()],gi.prototype,"rangeLabelInputsEnabled",void 0),u([d({readOnly:!0})],gi.prototype,"segmentElements",void 0),u([d()],gi.prototype,"snapOnClickEnabled",void 0),u([d({readOnly:!0})],gi.prototype,"state",null),u([d()],gi.prototype,"steps",void 0),u([d()],gi.prototype,"syncedSegmentsEnabled",void 0),u([qe("viewModel.thumbsConstrained")],gi.prototype,"thumbsConstrained",void 0),u([d()],gi.prototype,"thumbCreatedFunction",void 0),u([d({readOnly:!0})],gi.prototype,"thumbElements",void 0),u([d()],gi.prototype,"tickConfigs",null),u([d({readOnly:!0})],gi.prototype,"tickElements",void 0),u([d({readOnly:!0})],gi.prototype,"trackElement",void 0),u([qe("viewModel.values")],gi.prototype,"values",void 0),u([d()],gi.prototype,"viewModel",void 0),u([d()],gi.prototype,"visibleElements",void 0),u([Rt("visibleElements")],gi.prototype,"castVisibleElements",null),gi=u([P(Q_t)],gi);const J_t=gi;function Op(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function NE(e){var t=Op(e).Element;return e instanceof t||e instanceof Element}function Wh(e){var t=Op(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function NJ(e){if(typeof ShadowRoot=="undefined")return!1;var t=Op(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var gw=Math.max,b5=Math.min,FE=Math.round;function kE(e,t){t===void 0&&(t=!1);var i=e.getBoundingClientRect(),r=1,s=1;if(Wh(e)&&t){var n=e.offsetHeight,o=e.offsetWidth;o>0&&(r=FE(i.width)/o||1),n>0&&(s=FE(i.height)/n||1)}return{width:i.width/r,height:i.height/s,top:i.top/s,right:i.right/r,bottom:i.bottom/s,left:i.left/r,x:i.left/r,y:i.top/s}}function FJ(e){var t=Op(e),i=t.pageXOffset,r=t.pageYOffset;return{scrollLeft:i,scrollTop:r}}function K_t(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function e1t(e){return e===Op(e)||!Wh(e)?FJ(e):K_t(e)}function vm(e){return e?(e.nodeName||"").toLowerCase():null}function F_(e){return((NE(e)?e.ownerDocument:e.document)||window.document).documentElement}function kJ(e){return kE(F_(e)).left+FJ(e).scrollLeft}function _y(e){return Op(e).getComputedStyle(e)}function UJ(e){var t=_y(e),i=t.overflow,r=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+s+r)}function t1t(e){var t=e.getBoundingClientRect(),i=FE(t.width)/e.offsetWidth||1,r=FE(t.height)/e.offsetHeight||1;return i!==1||r!==1}function i1t(e,t,i){i===void 0&&(i=!1);var r=Wh(t),s=Wh(t)&&t1t(t),n=F_(t),o=kE(e,s),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((vm(t)!=="body"||UJ(n))&&(a=e1t(t)),Wh(t)?(l=kE(t,!0),l.x+=t.clientLeft,l.y+=t.clientTop):n&&(l.x=kJ(n))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function zJ(e){var t=kE(e),i=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:r}}function yz(e){return vm(e)==="html"?e:e.assignedSlot||e.parentNode||(NJ(e)?e.host:null)||F_(e)}function LEe(e){return["html","body","#document"].indexOf(vm(e))>=0?e.ownerDocument.body:Wh(e)&&UJ(e)?e:LEe(yz(e))}function YO(e,t){var i;t===void 0&&(t=[]);var r=LEe(e),s=r===((i=e.ownerDocument)==null?void 0:i.body),n=Op(r),o=s?[n].concat(n.visualViewport||[],UJ(r)?r:[]):r,a=t.concat(o);return s?a:a.concat(YO(yz(o)))}function r1t(e){return["table","td","th"].indexOf(vm(e))>=0}function fue(e){return!Wh(e)||_y(e).position==="fixed"?null:e.offsetParent}function s1t(e){var t=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,i=navigator.userAgent.indexOf("Trident")!==-1;if(i&&Wh(e)){var r=_y(e);if(r.position==="fixed")return null}var s=yz(e);for(NJ(s)&&(s=s.host);Wh(s)&&["html","body"].indexOf(vm(s))<0;){var n=_y(s);if(n.transform!=="none"||n.perspective!=="none"||n.contain==="paint"||["transform","perspective"].indexOf(n.willChange)!==-1||t&&n.willChange==="filter"||t&&n.filter&&n.filter!=="none")return s;s=s.parentNode}return null}function M3(e){for(var t=Op(e),i=fue(e);i&&r1t(i)&&_y(i).position==="static";)i=fue(i);return i&&(vm(i)==="html"||vm(i)==="body"&&_y(i).position==="static")?t:i||s1t(e)||t}var bc="top",sd="bottom",nd="right",wc="left",VJ="auto",O3=[bc,sd,nd,wc],UE="start",SP="end",n1t="clippingParents",NEe="viewport",$A="popper",o1t="reference",mue=O3.reduce(function(e,t){return e.concat([t+"-"+UE,t+"-"+SP])},[]),FEe=[].concat(O3,[VJ]).reduce(function(e,t){return e.concat([t,t+"-"+UE,t+"-"+SP])},[]),a1t="beforeRead",l1t="read",c1t="afterRead",u1t="beforeMain",h1t="main",d1t="afterMain",p1t="beforeWrite",f1t="write",m1t="afterWrite",g1t=[a1t,l1t,c1t,u1t,h1t,d1t,p1t,f1t,m1t];function y1t(e){var t=new Map,i=new Set,r=[];e.forEach(function(n){t.set(n.name,n)});function s(n){i.add(n.name);var o=[].concat(n.requires||[],n.requiresIfExists||[]);o.forEach(function(a){if(!i.has(a)){var l=t.get(a);l&&s(l)}}),r.push(n)}return e.forEach(function(n){i.has(n.name)||s(n)}),r}function v1t(e){var t=y1t(e);return g1t.reduce(function(i,r){return i.concat(t.filter(function(s){return s.phase===r}))},[])}function _1t(e){var t;return function(){return t||(t=new Promise(function(i){Promise.resolve().then(function(){t=void 0,i(e())})})),t}}function im(e){return e.split("-")[0]}function b1t(e){var t=e.reduce(function(i,r){var s=i[r.name];return i[r.name]=s?Object.assign({},s,r,{options:Object.assign({},s.options,r.options),data:Object.assign({},s.data,r.data)}):r,i},{});return Object.keys(t).map(function(i){return t[i]})}function w1t(e){var t=Op(e),i=F_(e),r=t.visualViewport,s=i.clientWidth,n=i.clientHeight,o=0,a=0;return r&&(s=r.width,n=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(o=r.offsetLeft,a=r.offsetTop)),{width:s,height:n,x:o+kJ(e),y:a}}function x1t(e){var t,i=F_(e),r=FJ(e),s=(t=e.ownerDocument)==null?void 0:t.body,n=gw(i.scrollWidth,i.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),o=gw(i.scrollHeight,i.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),a=-r.scrollLeft+kJ(e),l=-r.scrollTop;return _y(s||i).direction==="rtl"&&(a+=gw(i.clientWidth,s?s.clientWidth:0)-n),{width:n,height:o,x:a,y:l}}function kEe(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&NJ(i)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Yq(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function T1t(e){var t=kE(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}function gue(e,t){return t===NEe?Yq(w1t(e)):NE(t)?T1t(t):Yq(x1t(F_(e)))}function S1t(e){var t=YO(yz(e)),i=["absolute","fixed"].indexOf(_y(e).position)>=0,r=i&&Wh(e)?M3(e):e;return NE(r)?t.filter(function(s){return NE(s)&&kEe(s,r)&&vm(s)!=="body"}):[]}function E1t(e,t,i){var r=t==="clippingParents"?S1t(e):[].concat(t),s=[].concat(r,[i]),n=s[0],o=s.reduce(function(a,l){var c=gue(e,l);return a.top=gw(c.top,a.top),a.right=b5(c.right,a.right),a.bottom=b5(c.bottom,a.bottom),a.left=gw(c.left,a.left),a},gue(e,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function zE(e){return e.split("-")[1]}function BJ(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function UEe(e){var t=e.reference,i=e.element,r=e.placement,s=r?im(r):null,n=r?zE(r):null,o=t.x+t.width/2-i.width/2,a=t.y+t.height/2-i.height/2,l;switch(s){case bc:l={x:o,y:t.y-i.height};break;case sd:l={x:o,y:t.y+t.height};break;case nd:l={x:t.x+t.width,y:a};break;case wc:l={x:t.x-i.width,y:a};break;default:l={x:t.x,y:t.y}}var c=s?BJ(s):null;if(c!=null){var h=c==="y"?"height":"width";switch(n){case UE:l[c]=l[c]-(t[h]/2-i[h]/2);break;case SP:l[c]=l[c]+(t[h]/2-i[h]/2);break}}return l}function zEe(){return{top:0,right:0,bottom:0,left:0}}function VEe(e){return Object.assign({},zEe(),e)}function BEe(e,t){return t.reduce(function(i,r){return i[r]=e,i},{})}function EP(e,t){t===void 0&&(t={});var i=t,r=i.placement,s=r===void 0?e.placement:r,n=i.boundary,o=n===void 0?n1t:n,a=i.rootBoundary,l=a===void 0?NEe:a,c=i.elementContext,h=c===void 0?$A:c,p=i.altBoundary,f=p===void 0?!1:p,m=i.padding,y=m===void 0?0:m,v=VEe(typeof y!="number"?y:BEe(y,O3)),w=h===$A?o1t:$A,b=e.rects.popper,S=e.elements[f?w:h],T=E1t(NE(S)?S:S.contextElement||F_(e.elements.popper),o,l),E=kE(e.elements.reference),C=UEe({reference:E,element:b,strategy:"absolute",placement:s}),A=Yq(Object.assign({},b,C)),I=h===$A?A:E,L={top:T.top-I.top+v.top,bottom:I.bottom-T.bottom+v.bottom,left:T.left-I.left+v.left,right:I.right-T.right+v.right},D=e.modifiersData.offset;if(h===$A&&D){var U=D[s];Object.keys(L).forEach(function(z){var V=[nd,sd].indexOf(z)>=0?1:-1,X=[bc,sd].indexOf(z)>=0?"y":"x";L[z]+=U[X]*V})}return L}var yue={placement:"bottom",modifiers:[],strategy:"absolute"};function vue(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function C1t(e){e===void 0&&(e={});var t=e,i=t.defaultModifiers,r=i===void 0?[]:i,s=t.defaultOptions,n=s===void 0?yue:s;return function(a,l,c){c===void 0&&(c=n);var h={placement:"bottom",orderedModifiers:[],options:Object.assign({},yue,n),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},p=[],f=!1,m={state:h,setOptions:function(b){var S=typeof b=="function"?b(h.options):b;v(),h.options=Object.assign({},n,h.options,S),h.scrollParents={reference:NE(a)?YO(a):a.contextElement?YO(a.contextElement):[],popper:YO(l)};var T=v1t(b1t([].concat(r,h.options.modifiers)));return h.orderedModifiers=T.filter(function(E){return E.enabled}),y(),m.update()},forceUpdate:function(){if(!f){var b=h.elements,S=b.reference,T=b.popper;if(!!vue(S,T)){h.rects={reference:i1t(S,M3(T),h.options.strategy==="fixed"),popper:zJ(T)},h.reset=!1,h.placement=h.options.placement,h.orderedModifiers.forEach(function(U){return h.modifiersData[U.name]=Object.assign({},U.data)});for(var E=0;E<h.orderedModifiers.length;E++){if(h.reset===!0){h.reset=!1,E=-1;continue}var C=h.orderedModifiers[E],A=C.fn,I=C.options,L=I===void 0?{}:I,D=C.name;typeof A=="function"&&(h=A({state:h,options:L,name:D,instance:m})||h)}}}},update:_1t(function(){return new Promise(function(w){m.forceUpdate(),w(h)})}),destroy:function(){v(),f=!0}};if(!vue(a,l))return m;m.setOptions(c).then(function(w){!f&&c.onFirstUpdate&&c.onFirstUpdate(w)});function y(){h.orderedModifiers.forEach(function(w){var b=w.name,S=w.options,T=S===void 0?{}:S,E=w.effect;if(typeof E=="function"){var C=E({state:h,name:b,instance:m,options:T}),A=function(){};p.push(C||A)}})}function v(){p.forEach(function(w){return w()}),p=[]}return m}}var qD={passive:!0};function A1t(e){var t=e.state,i=e.instance,r=e.options,s=r.scroll,n=s===void 0?!0:s,o=r.resize,a=o===void 0?!0:o,l=Op(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return n&&c.forEach(function(h){h.addEventListener("scroll",i.update,qD)}),a&&l.addEventListener("resize",i.update,qD),function(){n&&c.forEach(function(h){h.removeEventListener("scroll",i.update,qD)}),a&&l.removeEventListener("resize",i.update,qD)}}var M1t={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:A1t,data:{}};function O1t(e){var t=e.state,i=e.name;t.modifiersData[i]=UEe({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}var R1t={name:"popperOffsets",enabled:!0,phase:"read",fn:O1t,data:{}},P1t={top:"auto",right:"auto",bottom:"auto",left:"auto"};function I1t(e){var t=e.x,i=e.y,r=window,s=r.devicePixelRatio||1;return{x:FE(t*s)/s||0,y:FE(i*s)/s||0}}function _ue(e){var t,i=e.popper,r=e.popperRect,s=e.placement,n=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,h=e.roundOffsets,p=e.isFixed,f=o.x,m=f===void 0?0:f,y=o.y,v=y===void 0?0:y,w=typeof h=="function"?h({x:m,y:v}):{x:m,y:v};m=w.x,v=w.y;var b=o.hasOwnProperty("x"),S=o.hasOwnProperty("y"),T=wc,E=bc,C=window;if(c){var A=M3(i),I="clientHeight",L="clientWidth";if(A===Op(i)&&(A=F_(i),_y(A).position!=="static"&&a==="absolute"&&(I="scrollHeight",L="scrollWidth")),A=A,s===bc||(s===wc||s===nd)&&n===SP){E=sd;var D=p&&A===C&&C.visualViewport?C.visualViewport.height:A[I];v-=D-r.height,v*=l?1:-1}if(s===wc||(s===bc||s===sd)&&n===SP){T=nd;var U=p&&A===C&&C.visualViewport?C.visualViewport.width:A[L];m-=U-r.width,m*=l?1:-1}}var z=Object.assign({position:a},c&&P1t),V=h===!0?I1t({x:m,y:v}):{x:m,y:v};if(m=V.x,v=V.y,l){var X;return Object.assign({},z,(X={},X[E]=S?"0":"",X[T]=b?"0":"",X.transform=(C.devicePixelRatio||1)<=1?"translate("+m+"px, "+v+"px)":"translate3d("+m+"px, "+v+"px, 0)",X))}return Object.assign({},z,(t={},t[E]=S?v+"px":"",t[T]=b?m+"px":"",t.transform="",t))}function $1t(e){var t=e.state,i=e.options,r=i.gpuAcceleration,s=r===void 0?!0:r,n=i.adaptive,o=n===void 0?!0:n,a=i.roundOffsets,l=a===void 0?!0:a,c={placement:im(t.placement),variation:zE(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,_ue(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,_ue(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}var D1t={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:$1t,data:{}};function L1t(e){var t=e.state;Object.keys(t.elements).forEach(function(i){var r=t.styles[i]||{},s=t.attributes[i]||{},n=t.elements[i];!Wh(n)||!vm(n)||(Object.assign(n.style,r),Object.keys(s).forEach(function(o){var a=s[o];a===!1?n.removeAttribute(o):n.setAttribute(o,a===!0?"":a)}))})}function N1t(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach(function(r){var s=t.elements[r],n=t.attributes[r]||{},o=Object.keys(t.styles.hasOwnProperty(r)?t.styles[r]:i[r]),a=o.reduce(function(l,c){return l[c]="",l},{});!Wh(s)||!vm(s)||(Object.assign(s.style,a),Object.keys(n).forEach(function(l){s.removeAttribute(l)}))})}}var F1t={name:"applyStyles",enabled:!0,phase:"write",fn:L1t,effect:N1t,requires:["computeStyles"]};function k1t(e,t,i){var r=im(e),s=[wc,bc].indexOf(r)>=0?-1:1,n=typeof i=="function"?i(Object.assign({},t,{placement:e})):i,o=n[0],a=n[1];return o=o||0,a=(a||0)*s,[wc,nd].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}function U1t(e){var t=e.state,i=e.options,r=e.name,s=i.offset,n=s===void 0?[0,0]:s,o=FEe.reduce(function(h,p){return h[p]=k1t(p,t.rects,n),h},{}),a=o[t.placement],l=a.x,c=a.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[r]=o}var z1t={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:U1t},V1t={left:"right",right:"left",bottom:"top",top:"bottom"};function sF(e){return e.replace(/left|right|bottom|top/g,function(t){return V1t[t]})}var B1t={start:"end",end:"start"};function bue(e){return e.replace(/start|end/g,function(t){return B1t[t]})}function G1t(e,t){t===void 0&&(t={});var i=t,r=i.placement,s=i.boundary,n=i.rootBoundary,o=i.padding,a=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?FEe:l,h=zE(r),p=h?a?mue:mue.filter(function(y){return zE(y)===h}):O3,f=p.filter(function(y){return c.indexOf(y)>=0});f.length===0&&(f=p);var m=f.reduce(function(y,v){return y[v]=EP(e,{placement:v,boundary:s,rootBoundary:n,padding:o})[im(v)],y},{});return Object.keys(m).sort(function(y,v){return m[y]-m[v]})}function j1t(e){if(im(e)===VJ)return[];var t=sF(e);return[bue(e),t,bue(t)]}function H1t(e){var t=e.state,i=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var s=i.mainAxis,n=s===void 0?!0:s,o=i.altAxis,a=o===void 0?!0:o,l=i.fallbackPlacements,c=i.padding,h=i.boundary,p=i.rootBoundary,f=i.altBoundary,m=i.flipVariations,y=m===void 0?!0:m,v=i.allowedAutoPlacements,w=t.options.placement,b=im(w),S=b===w,T=l||(S||!y?[sF(w)]:j1t(w)),E=[w].concat(T).reduce(function(te,fe){return te.concat(im(fe)===VJ?G1t(t,{placement:fe,boundary:h,rootBoundary:p,padding:c,flipVariations:y,allowedAutoPlacements:v}):fe)},[]),C=t.rects.reference,A=t.rects.popper,I=new Map,L=!0,D=E[0],U=0;U<E.length;U++){var z=E[U],V=im(z),X=zE(z)===UE,Z=[bc,sd].indexOf(V)>=0,ae=Z?"width":"height",re=EP(t,{placement:z,boundary:h,rootBoundary:p,altBoundary:f,padding:c}),$=Z?X?nd:wc:X?sd:bc;C[ae]>A[ae]&&($=sF($));var k=sF($),B=[];if(n&&B.push(re[V]<=0),a&&B.push(re[$]<=0,re[k]<=0),B.every(function(te){return te})){D=z,L=!1;break}I.set(z,B)}if(L)for(var H=y?3:1,Y=function(fe){var xe=E.find(function(Le){var _e=I.get(Le);if(_e)return _e.slice(0,fe).every(function(ye){return ye})});if(xe)return D=xe,"break"},ee=H;ee>0;ee--){var G=Y(ee);if(G==="break")break}t.placement!==D&&(t.modifiersData[r]._skip=!0,t.placement=D,t.reset=!0)}}var q1t={name:"flip",enabled:!0,phase:"main",fn:H1t,requiresIfExists:["offset"],data:{_skip:!1}};function W1t(e){return e==="x"?"y":"x"}function ZO(e,t,i){return gw(e,b5(t,i))}function X1t(e,t,i){var r=ZO(e,t,i);return r>i?i:r}function Y1t(e){var t=e.state,i=e.options,r=e.name,s=i.mainAxis,n=s===void 0?!0:s,o=i.altAxis,a=o===void 0?!1:o,l=i.boundary,c=i.rootBoundary,h=i.altBoundary,p=i.padding,f=i.tether,m=f===void 0?!0:f,y=i.tetherOffset,v=y===void 0?0:y,w=EP(t,{boundary:l,rootBoundary:c,padding:p,altBoundary:h}),b=im(t.placement),S=zE(t.placement),T=!S,E=BJ(b),C=W1t(E),A=t.modifiersData.popperOffsets,I=t.rects.reference,L=t.rects.popper,D=typeof v=="function"?v(Object.assign({},t.rects,{placement:t.placement})):v,U=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),z=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,V={x:0,y:0};if(!!A){if(n){var X,Z=E==="y"?bc:wc,ae=E==="y"?sd:nd,re=E==="y"?"height":"width",$=A[E],k=$+w[Z],B=$-w[ae],H=m?-L[re]/2:0,Y=S===UE?I[re]:L[re],ee=S===UE?-L[re]:-I[re],G=t.elements.arrow,te=m&&G?zJ(G):{width:0,height:0},fe=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:zEe(),xe=fe[Z],Le=fe[ae],_e=ZO(0,I[re],te[re]),ye=T?I[re]/2-H-_e-xe-U.mainAxis:Y-_e-xe-U.mainAxis,Ce=T?-I[re]/2+H+_e+Le+U.mainAxis:ee+_e+Le+U.mainAxis,Pe=t.elements.arrow&&M3(t.elements.arrow),xi=Pe?E==="y"?Pe.clientTop||0:Pe.clientLeft||0:0,Ti=(X=z==null?void 0:z[E])!=null?X:0,Xt=$+ye-Ti-xi,Pi=$+Ce-Ti,Yt=ZO(m?b5(k,Xt):k,$,m?gw(B,Pi):B);A[E]=Yt,V[E]=Yt-$}if(a){var Si,Ir=E==="x"?bc:wc,Hr=E==="x"?sd:nd,Ye=A[C],Wi=C==="y"?"height":"width",Zs=Ye+w[Ir],wo=Ye-w[Hr],An=[bc,wc].indexOf(b)!==-1,Dl=(Si=z==null?void 0:z[C])!=null?Si:0,Ll=An?Zs:Ye-I[Wi]-L[Wi]-Dl+U.altAxis,Hn=An?Ye+I[Wi]+L[Wi]-Dl-U.altAxis:wo,Rp=m&&An?X1t(Ll,Ye,Hn):ZO(m?Ll:Zs,Ye,m?Hn:wo);A[C]=Rp,V[C]=Rp-Ye}t.modifiersData[r]=V}}var Z1t={name:"preventOverflow",enabled:!0,phase:"main",fn:Y1t,requiresIfExists:["offset"]},Q1t=function(t,i){return t=typeof t=="function"?t(Object.assign({},i.rects,{placement:i.placement})):t,VEe(typeof t!="number"?t:BEe(t,O3))};function J1t(e){var t,i=e.state,r=e.name,s=e.options,n=i.elements.arrow,o=i.modifiersData.popperOffsets,a=im(i.placement),l=BJ(a),c=[wc,nd].indexOf(a)>=0,h=c?"height":"width";if(!(!n||!o)){var p=Q1t(s.padding,i),f=zJ(n),m=l==="y"?bc:wc,y=l==="y"?sd:nd,v=i.rects.reference[h]+i.rects.reference[l]-o[l]-i.rects.popper[h],w=o[l]-i.rects.reference[l],b=M3(n),S=b?l==="y"?b.clientHeight||0:b.clientWidth||0:0,T=v/2-w/2,E=p[m],C=S-f[h]-p[y],A=S/2-f[h]/2+T,I=ZO(E,A,C),L=l;i.modifiersData[r]=(t={},t[L]=I,t.centerOffset=I-A,t)}}function K1t(e){var t=e.state,i=e.options,r=i.element,s=r===void 0?"[data-popper-arrow]":r;s!=null&&(typeof s=="string"&&(s=t.elements.popper.querySelector(s),!s)||!kEe(t.elements.popper,s)||(t.elements.arrow=s))}var ebt={name:"arrow",enabled:!0,phase:"main",fn:J1t,effect:K1t,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function wue(e,t,i){return i===void 0&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function xue(e){return[bc,nd,sd,wc].some(function(t){return e[t]>=0})}function tbt(e){var t=e.state,i=e.name,r=t.rects.reference,s=t.rects.popper,n=t.modifiersData.preventOverflow,o=EP(t,{elementContext:"reference"}),a=EP(t,{altBoundary:!0}),l=wue(o,r),c=wue(a,s,n),h=xue(l),p=xue(c);t.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:h,hasPopperEscaped:p},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":h,"data-popper-escaped":p})}var ibt={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:tbt},rbt=[M1t,R1t,D1t,F1t,z1t,q1t,Z1t,ebt,ibt],sbt=C1t({defaultModifiers:rbt});const nbt=["bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end","top","top-start","top-end"],Tue={base:"esri-popover",open:"esri-popover--open"},obt={position:"fixed","z-index":"1000"};let Ef=class extends Xs{constructor(e,t){super(e,t),this._popper=null,this._contentNode=null,this._renderAttached=!1,this._rootNode=null,this.anchorElement=null,this.offset=[0,0],this.open=!1,this.renderContentFunction=null,this._afterRootCreate=i=>{this._rootNode=i},this._afterContentCreate=i=>{this._contentNode=i},this._updatePosition=()=>{_(this._popper)&&this._popper.update()}}initialize(){this.when(()=>{this.destroyed||(this._projector.append(document.body,this.render),this._renderAttached=!0)}),this.own([se(()=>[this.open,this.anchorElement],()=>this._buildPopper(),At),se(()=>[this.placement,this.offset],()=>this._setPopperOptions(),At)])}destroy(){this.owner=null,this.anchorElement=null,this.renderContentFunction=null,this._renderAttached&&(this._projector.detach(this.render),this._renderAttached=!1),_(this._rootNode)&&(uIe(this._rootNode),this._rootNode=null),this._contentNode=null,_(this._popper)&&(this._popper.destroy(),this._popper=null)}set container(e){}set owner(e){this._set("owner",e)}get placement(){return"top"}set placement(e){nbt.includes(e)?this._override("placement",e):this._clearOverride("placement")}render(){var r;const{open:e,owner:t,renderContentFunction:i}=this;return W("div",{afterCreate:this._afterRootCreate,class:this.classes(Tue.base,e?Tue.open:null),styles:obt},W("div",{dir:FNe((r=this.owner)==null?void 0:r.container),afterCreate:this._afterContentCreate,afterUpdate:this._updatePosition},e&&(i==null?void 0:i.call(t))))}_buildPopper(){_(this._popper)&&(this._popper.destroy(),this._popper=null);const e=this._contentNode;if(M(e)||!this.open||!this.renderContentFunction)return;const t=this._getAnchor();t&&(this._popper=sbt(t,e),this._setPopperOptions())}_setPopperOptions(){const{placement:e,offset:t,_popper:i}=this;M(i)||(i.setOptions({placement:e,modifiers:[{name:"offset",options:{offset:t}}]}),i.forceUpdate())}_getAnchor(){const{anchorElement:e}=this;return BP(typeof e=="function"?e():e)}};u([d()],Ef.prototype,"anchorElement",void 0),u([d()],Ef.prototype,"container",null),u([d()],Ef.prototype,"offset",void 0),u([d()],Ef.prototype,"open",void 0),u([d()],Ef.prototype,"owner",null),u([d()],Ef.prototype,"placement",null),u([d()],Ef.prototype,"renderContentFunction",void 0),Ef=u([P("esri.widgets.support.Popover")],Ef);const GEe=Ef,_a={interactive:"esri-interactive",label:"esri-slider__label",box:"esri-slider-with-dropdown__box",dropdownRoot:"esri-slider-with-dropdown__dropdown-root",anchor:" esri-widget__anchor esri-slider-with-dropdown__anchor",anchorOpen:"esri-slider-with-dropdown__anchor--open",anchorClosed:"esri-slider-with-dropdown__anchor--closed",dropdownList:"esri-slider-with-dropdown__list",dropdownListItem:"esri-slider-with-dropdown__list-item",dropdownListItemSelected:"esri-slider-with-dropdown__list-item--selected",boxDropDownOn:"esri-slider-with-dropdown__box--drop-down-on",boxDropDownOff:"esri-slider-with-dropdown__box--drop-down-off"},WD={selectItem:"Enter",closeDropdown:"Escape",moveSelectionUp:"ArrowUp",moveSelectionDown:"ArrowDown"};let Cf=class extends J_t{constructor(e,t){super(e,t),this.viewModel=new Dg,this.buttonTooltip="",this.showDropDown=!0,this.currentIndex=0,this._dropdownAnchor=null,this._dropdownElement=null,this._popover=new GEe({owner:this,placement:"bottom-start",anchorElement:()=>this._dropdownAnchor,renderContentFunction:()=>this._renderPopover()})}initialize(){this.own(se(()=>this.viewModel.isDropdownOpen,e=>{this._popover.open=e},At))}destroy(){this._popover.destroy()}renderThumbLabel(e){const t={[_a.boxDropDownOn]:this.showDropDown,[_a.boxDropDownOff]:!this.showDropDown};return W("div",{class:this.classes(_a.box,_a.label,t)},super.renderThumbLabel(e),this.showDropDown&&W("div",{bind:this,afterCreate:this._onDropdownAnchorAfterCreate,class:_a.dropdownRoot},W("button",{class:this.classes(_a.interactive,_a.anchor,this.isDropdownOpen?_a.anchorOpen:_a.anchorClosed),bind:this,disabled:this.disabled,onclick:this._onAnchorClick,onpointerdown:this._killEvent,"aria-label":this.buttonTooltip,title:this.buttonTooltip,"aria-expanded":this.isDropdownOpen.toString(),"aria-haspopup":"listbox",type:"button"},this.currentItem?this.currentItem.name+" ":"")))}_onDropdownAnchorAfterCreate(e){this._dropdownAnchor=e}_renderPopover(){return W("ol",{role:"listbox",afterCreate:this._onDropdownAfterCreate,"aria-label":this.buttonTooltip,bind:this,class:this.classes(_a.dropdownList),tabindex:"-1",onkeydown:this._onDropdownKeyDown,onfocusout:this._onDropdownFocusOut,onpointerdown:this._killEvent},this.items.map((e,t)=>W("li",{class:t===this.currentIndex?this.classes(_a.interactive,_a.dropdownListItem,_a.dropdownListItemSelected):this.classes(_a.interactive,_a.dropdownListItem),bind:this,onclick:this._onDropdownItemClick,"data-result":t,"aria-label":e.label.join(" "),role:"option","aria-selected":(t===this.currentIndex).toString(),onkeydown:this._onLiKeyDown,tabindex:"0"},e.label.map(i=>W("span",{bind:this},i)))))}_onDropdownAfterCreate(e){var i;this._dropdownElement=e;const t=(i=e.querySelector(`.${_a.dropdownListItemSelected}`))!=null?i:e.firstChild;_(t)&&t instanceof HTMLElement&&(t.scrollIntoView(),t.focus())}_onAnchorClick(){return!this.disabled&&(this.viewModel.toggle(),!0)}_onDropdownItemClick(e){const t=e.currentTarget;this.viewModel.selectItem(t["data-result"])}_onDropdownFocusOut(e){let t=e.relatedTarget;t===null&&(t=document.activeElement),_(this._dropdownElement)&&!this._dropdownElement.contains(t)&&_(this._dropdownAnchor)&&!this._dropdownAnchor.contains(t)&&(this.viewModel.isDropdownOpen=!1)}_killEvent(e){return e.stopPropagation(),!0}_onDropdownKeyDown(e){e.stopPropagation(),vl(e)===WD.closeDropdown&&(this.viewModel.isDropdownOpen=!1)}_onLiKeyDown(e){const t=e.target;switch(vl(e)){case WD.moveSelectionUp:t.previousElementSibling&&t.previousElementSibling.focus();break;case WD.moveSelectionDown:t.nextElementSibling&&t.nextElementSibling.focus();break;case WD.selectItem:t.click()}}};u([d()],Cf.prototype,"viewModel",void 0),u([d()],Cf.prototype,"buttonTooltip",void 0),u([d()],Cf.prototype,"showDropDown",void 0),u([d({aliasOf:"viewModel.items"})],Cf.prototype,"items",void 0),u([d({aliasOf:"viewModel.currentIndex"})],Cf.prototype,"currentIndex",void 0),u([d({aliasOf:"viewModel.currentItem"})],Cf.prototype,"currentItem",void 0),u([d({aliasOf:"viewModel.isDropdownOpen"})],Cf.prototype,"isDropdownOpen",void 0),Cf=u([P("esri.widgets.Daylight.SliderWithDropdown")],Cf);const abt=Cf;function lbt(e,t){const i=ipe(t),r=Date.now(),s=i.formatToParts(r),n=new Set;s.filter(({type:c})=>c==="literal").forEach(({value:c})=>n.add(c));let o=0;const a={};for(;s.length>0;){const{type:c,value:h}=s.shift();for(let p=0;p<h.length;p++,o++){const f=e.charAt(o);if(n.has(f)){o++;break}if(c==="literal")break;a[c]||(a[c]=[]),a[c].push(f)}}const l={};try{l.day=R8(a.day.join("")),l.month=R8(a.month.join("")),l.year=R8((a.year||a.relatedYear).join(""))}catch{throw Sue(t)}if(isNaN(l.day)||isNaN(l.month)||isNaN(l.year))throw Sue(t);return l}function R8(e){const t=[/٠/g,/١/g,/٢/g,/٣/g,/٤/g,/٥/g,/٦/g,/٧/g,/٨/g,/٩/g];for(let i=0;i<10;i++)e=e.replace(t[i],i.toString());return Number(e)}function Sue(e){return new q(`could not parse date input, expecting the following format: ${Ls(Date.now(),e)}`)}const DA={ar:6,"ar-dz":6,"ar-kw":6,"ar-ly":6,"ar-ma":1,"ar-sa":7,"ar-tn":1,bg:1,bs:1,ca:1,cs:1,da:1,de:1,"de-at":1,"de-ch":1,el:1,"en-au":1,"en-ca":7,"en-gb":1,"en-ie":1,"en-il":7,"en-in":7,"en-nz":1,"en-sg":7,es:1,"es-do":7,"es-mx":7,"es-us":7,et:1,fi:1,fr:1,"fr-ca":7,"fr-ch":1,he:7,hr:1,hu:1,id:7,it:1,"it-ch":1,ja:7,ko:7,lt:1,lv:1,nb:1,nl:1,"nl-be":1,pl:1,pt:7,"pt-br":7,ro:1,ru:1,sk:1,sl:1,sr:1,"sr-cyrl":1,sv:1,th:7,tr:1,uk:1,vi:1,"zh-cn":7,"zh-hk":7,"zh-mo":7,"zh-tw":7},cbt="Locale"in Intl&&"weekInfo"in Intl.Locale.prototype;function jEe(e){if(e=e.toLowerCase(),DA[e])return DA[e];if(cbt)try{const i=new Intl.Locale(e).weekInfo.firstDay;return DA[e]=i,i}catch{}const t=NRe(e);return DA[t]?DA[t]:7}function ubt(e,t){return(t+7-jEe(e))%7}const Di={base:"esri-date-picker",datePicker:"esri-date-picker__calendar",monthPicker:"esri-date-picker__month-picker",dayPicker:"esri-date-picker__day-picker",week:"esri-date-picker__week-item",nearbyMonth:"esri-date-picker__day-item--nearby-month",activeDay:"esri-date-picker__day-item--active",today:"esri-date-picker__day-item--today",selectedDay:"esri-date-picker__day-item--selected",day:"esri-date-picker__day-item",dayHeader:"esri-date-picker__day-item--header",yearPicker:"esri-date-picker__year-picker",selectedYear:"esri-date-picker__year-picker-item--selected",year:"esri-date-picker__year-picker-item",monthDropdown:"esri-date-picker__month-dropdown",date:"esri-date-picker__date",datePickerToggle:"esri-date-picker__calendar-toggle",dateInput:"esri-date-picker__input",dateTextInput:"esri-date-picker__text-input",leadingIcon:"esri-date-picker__icon--leading",previousIcon:"esri-icon-left",nextIcon:"esri-icon-right",calendarIcon:"esri-icon-calendar",widget:"esri-widget",button:"esri-widget--button",input:"esri-input",select:"esri-select"},TT={year:"numeric",month:"2-digit",day:"2-digit"},hbt=[" ","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Enter","Home","PageDown","PageUp"],HEe="esri.widgets.support.DatePicker",dbt=ge.getLogger(HEe);let Jl=class extends Xs{constructor(e,t){super(e,t),this._activeDate=null,this._calendarNode=null,this._calendarPopover=new GEe({owner:this,placement:"bottom-start",anchorElement:()=>this._rootNode,renderContentFunction:this._renderCalendar}),this._inputOrButtonNode=null,this._isOpen=!1,this._requestDayPickerFocusOnCreate=!1,this._rootNode=null,this.dateInputEnabled=!1,this.label=void 0,this.messages=null,this.value=null,this.commitOnMonthChange=!1,this.viewModel=new gz,this.disabled=!1,this._toggle=this._toggle.bind(this)}initialize(){this.own(se(()=>{var e;return{viewModel:this.viewModel,value:(e=this.viewModel)==null?void 0:e.value}},({viewModel:e,value:t})=>{this.destroyed||!e||M(this.onChange)||this.onChange(t)},Ki))}destroy(){this._calendarPopover.destroy()}render(){return W("div",{afterCreate:Bb,bind:this,class:this.classes(Di.base,Di.widget),"data-node-ref":"_rootNode"},this.dateInputEnabled?this.renderInputAndButtonMode():this.renderButtonOnlyMode())}renderButtonOnlyMode(){const e=Ls(this.viewModel.value,TT),{disabled:t,_isOpen:i,messages:r}=this;return W("div",{key:`date-button-${t}`,afterCreate:Bb,"aria-controls":i?this._getCalendarId():null,"aria-expanded":i.toString(),"aria-haspopup":"true","aria-label":r.setDate,"aria-pressed":i.toString(),bind:this,class:this.classes(Di.button,Di.select,Di.datePickerToggle),"data-node-ref":"_inputOrButtonNode",onclick:this._toggle,onkeydown:this._handleDateButtonKeyDown,role:"button",tabIndex:t?null:0},W("span",{class:Di.date},e))}renderInputAndButtonMode(){const e=Ls(this.viewModel.value,TT),{_isOpen:t,messages:i}=this;return W("div",{class:this.classes(Di.dateInput)},W("input",{afterCreate:Bb,"data-node-ref":"_inputOrButtonNode","aria-controls":t?this._getCalendarId():null,"aria-haspopup":"true","aria-label":i.setDate,bind:this,class:this.classes(Di.dateTextInput,Di.input),key:"date-input",onblur:this._handleDateInputBlur,onclick:this._handleDateInputClick,onkeydown:this._handleDateInputKeyDown,type:"text",value:e}),W("span",{"aria-hidden":"true",class:this.classes(Di.leadingIcon,Di.calendarIcon)}))}_handleDateInputClick(){this._open(this.viewModel.value,!1)}_handleDateInputKeyDown(e){const{key:t}=e;this._isOpen?t==="Enter"?this._handleDateText(e):t==="Escape"&&this._close():t==="ArrowDown"&&(this._open(this.viewModel.value),e.preventDefault())}_handleDateButtonKeyDown(e){const{key:t,shiftKey:i}=e;this._isOpen&&t==="Tab"&&i?this._close():cM(t)&&this._toggle()}_handleDateInputBlur(e){this._isOpen||this._handleDateText(e)}_handleDateText(e){const t=e.currentTarget;let i;try{i=lbt(t.value,TT)}catch(s){return dbt.warn(s),void(t.value=Ls(this.viewModel.value,TT))}const r=Lt.fromObject(i);r.isValid?(this.viewModel.value=r.toJSDate(),this._activeDate=r):t.value=Ls(this.viewModel.value,TT)}_handleDatePickerKeydown(e){vl(e)==="Escape"&&(this._close(),e.preventDefault(),e.stopPropagation())}_renderCalendar(){const e=this._activeDate,t=Lt.fromJSDate(this.viewModel.value);return W("div",{afterCreate:Bb,bind:this,class:this.classes(Di.datePicker,Di.widget),"data-node-ref":"_calendarNode",id:this._getCalendarId(),key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(e),this._renderDayPicker(e,t),this._renderYearPicker(e))}_getCalendarId(){return`date-picker__calendar--${this.id}`}_renderMonthPicker(e){const t=Hf(this.container),i=t?Di.nextIcon:Di.previousIcon,r=t?Di.previousIcon:Di.nextIcon,s=yM.months("long",{locale:ua()}).map((a,l)=>{const c=e.month-1===l;return W("option",{selected:c,value:l.toString()},a)}),{disabled:n,messages:o}=this;return W("div",{class:Di.monthPicker},W("div",{key:`previous-month-${n}`,"aria-label":o.goToPreviousMonth,bind:this,class:Di.button,onclick:this._setPreviousMonth,onkeydown:this._handlePreviousMonthKeyDown,role:"button",tabIndex:n?null:0,title:o.goToPreviousMonth},W("span",{"aria-hidden":"true",class:i})),W("select",{"aria-live":"assertive","aria-label":o.selectMonth,bind:this,class:this.classes(Di.monthDropdown,Di.select),disabled:n,id:`${this.id}__month-picker`,onchange:this._setMonth,onkeydown:this._setMonth,title:o.selectMonth},s),W("div",{key:`next-month-${n}`,"aria-label":o.goToNextMonth,bind:this,class:Di.button,onclick:this._setNextMonth,onkeydown:this._setNextMonth,role:"button",tabIndex:n?null:0,title:o.goToNextMonth},W("span",{"aria-hidden":"true",class:r})))}_renderDayPicker(e,t){const i=this._getWeekLabels(),r=this._getDayId(e),s=this._renderMonth(e,t),{id:n,disabled:o}=this;return W("div",{key:`day-picker-${o}`,afterCreate:this._handleDayPickerCreate,"aria-activedescendant":r,"aria-labelledby":`${n}__month-picker ${n}__selected-year`,bind:this,class:Di.dayPicker,id:`${n}__day-picker`,onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:o?null:0},W("div",{class:Di.week,role:"row"},i.map(a=>W("div",{"aria-label":a.name,class:this.classes(Di.day,Di.dayHeader),role:"columnheader",title:a.name},a.abbr))),s)}_getDayId(e){return`${this.id}__${Ls(e.valueOf(),TT)}`}_handleDayPickerCreate(e){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,e.focus())}_getWeekLabels(){const e=[],t={weekday:"long"},i={weekday:"narrow"};let r=Lt.now().set({weekday:jEe(ua())});for(let s=0;s<7;s++)e.push({name:Ls(r.valueOf(),t),abbr:Ls(r.valueOf(),i)}),r=r.plus({day:1});return e}_handleDayPickerKeydown(e){const{ctrlKey:t,shiftKey:i}=e,r=vl(e);if(!hbt.includes(r))return;let s=this._activeDate;if(r==="ArrowLeft")s=s.minus({day:1});else if(r==="ArrowRight")s=s.plus({day:1});else if(r==="ArrowUp")s=s.minus({week:1});else if(r==="ArrowDown")s=s.plus({week:1});else if(r==="PageUp"){const n=i?"year":"month";s=s.minus({[n]:1})}else if(r==="PageDown"){const n=i?"year":"month";s=s.plus({[n]:1})}else if(r==="Home"){const n=t?"year":"month";s=s.startOf(n)}else if(r==="End"){const n=t?"year":"month";s=s.endOf(n)}else cM(r)&&(this.viewModel.value=s.toJSDate(),this._close());this._activeDate=s,e.preventDefault(),e.stopPropagation()}_renderMonth(e,t){const i=Lt.now(),r=e.startOf("month"),s=e.endOf("month"),n=6,o=7;let a=r.minus({day:ubt(ua(),r.weekday)});const l=[];for(let c=0;c<n;c++){const h=[];for(let p=0;p<o;p++){const f=a.day,m=a.hasSame(e,"day"),y=a.hasSame(t,"day"),v=this._getDayId(a),w=Ds.fromDateTimes(r,s),b={[Di.nearbyMonth]:!w.contains(a),[Di.today]:a.hasSame(i,"day"),[Di.activeDay]:m,[Di.selectedDay]:y};h.push(W("div",{"aria-label":f.toString(),"aria-selected":m.toString(),bind:this,class:this.classes(Di.day,b),"data-iso-date":a.toISO(),id:v,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},f)),a=a.plus({day:1})}l.push(W("div",{class:Di.week,role:"row"},h))}return l}_renderYearPicker(e){const t={year:"numeric"},i=e,r=Ls(i.valueOf(),t),s=Ls(i.plus({year:1}).valueOf(),t),n=Ls(i.minus({year:1}).valueOf(),t),{disabled:o,messages:a}=this;return W("div",{class:Di.yearPicker},W("div",{key:`previous-year-${o}`,"aria-label":a.goToPreviousYear,bind:this,class:Di.year,onclick:this._setPreviousYear,onkeydown:this._setPreviousYear,tabIndex:o?null:0,title:a.goToPreviousYear},n),W("div",{class:this.classes(Di.year,Di.selectedYear),id:`${this.id}__selected-year`},r),W("div",{key:`next-year-${o}`,"aria-label":a.goToNextYear,bind:this,class:Di.year,onclick:this._setNextYear,onkeydown:this._handleNextYearKeyDown,tabIndex:o?null:0,title:a.goToNextYear},s))}_toggle(){this._isOpen?this._close():this._open(this.viewModel.value)}_setMonth(e){const t=e.target,i=Number(t.value)+1;this._activeDate=this._activeDate.set({month:i}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_close(e=!0){this._activeDate=null,this._isOpen=!1,this._calendarPopover.open=!1,this.pageClickHandler.pause(),e&&this._inputOrButtonNode.focus()}_open(e,t=!0){this._activeDate=Lt.fromJSDate(e),this._isOpen=!0,this._calendarPopover.open=!0,this._requestDayPickerFocusOnCreate=t,this.pageClickHandler||(this.pageClickHandler=_Ae(document,"click",({target:i})=>{var r,s;((r=this._calendarNode)==null?void 0:r.contains(i))||((s=this._rootNode)==null?void 0:s.contains(i))||this._close()}),this.own(this.pageClickHandler)),this.pageClickHandler.resume()}_setPreviousMonth(){this._activeDate=this._activeDate.minus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_handlePreviousMonthKeyDown(e){if(e.key==="Tab"&&e.shiftKey)return e.preventDefault(),void this._close();cM(e.key)&&this._setPreviousMonth()}_setNextMonth(){this._activeDate=this._activeDate.plus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_setPreviousYear(){this._activeDate=this._activeDate.minus({year:1})}_setNextYear(){this._activeDate=this._activeDate.plus({year:1})}_handleNextYearKeyDown(e){if(e.key==="Tab"&&!e.shiftKey)return e.preventDefault(),void this._close();cM(e.key)&&this._setNextYear()}_handleSelectedDate(e){const t=e.target;this.viewModel.value=Lt.fromISO(t.getAttribute("data-iso-date")).toJSDate(),this._close()}};u([d()],Jl.prototype,"dateInputEnabled",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Jl.prototype,"label",void 0),u([d(),js("esri/widgets/support/t9n/DatePicker")],Jl.prototype,"messages",void 0),u([qe("viewModel.value")],Jl.prototype,"value",void 0),u([d()],Jl.prototype,"commitOnMonthChange",void 0),u([d({type:gz})],Jl.prototype,"viewModel",void 0),u([d()],Jl.prototype,"onChange",void 0),u([d()],Jl.prototype,"disabled",void 0),u([ra()],Jl.prototype,"_setNextMonth",null),u([ra()],Jl.prototype,"_setPreviousYear",null),u([ra()],Jl.prototype,"_handleSelectedDate",null),Jl=u([P(HEe)],Jl);const pbt=Jl,Eue=/(.*)\s(.*)/,fbt=ge.getLogger("esri.widgets.Daylight"),Zq="date";let io=class extends Xs{constructor(e,t){var i;super(e,t),this.headingLevel=3,this.iconClass=cs.widgetIcon,this.label=void 0,this.playSpeedMultiplier=1,this.timeSliderSteps=5,this.view=null,this.viewModel=new $Ee,this.visibleElements=new DEe,this.dateOrSeason=Zq,this._timeSlider=new abt({viewModel:this.viewModel.timeSliderViewModel,labelFormatFunction:due,inputFormatFunction:due,min:0,max:1439,steps:(i=this.timeSliderSteps)!=null?i:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:this._onPrimaryTickCreated.bind(this)},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:this._onSecondaryTickCreated.bind(this)}],items:[]}),this._datePicker=new pbt({viewModel:this.viewModel.datePickerViewModel,commitOnMonthChange:!0}),this._onPlayDayClick=()=>{this.viewModel.toggleDayPlaying()},this._onYearPlayClick=()=>{this.viewModel.toggleYearPlaying()},this._onSeasonChange=r=>{const s=r.target;this.viewModel.currentSeason=s.value},this._onSunLightingCheckboxChange=()=>{this.viewModel.toggleSunLightingEnabled()},this._onShadowCheckboxChange=()=>{this.viewModel.toggleDirectShadowsEnabled()}}get gmtOffsets(){return Qi(this.timezoneMessages,Z_t)}get _useAmPm(){const e=this._timeSlider.viewModel.getLabelForValue(0,"tick");return Eue.test(e)}get _labelAlignmentClass(){var r,s;const e=(s=(r=this.viewModel.timeSliderViewModel.values)==null?void 0:r[0])!=null?s:0,t=60*(this._useAmPm?4:3),i=60*(this._useAmPm?21:21.5);return e<t?cs.sliderAlignLeft:e>i?cs.sliderAlignRight:null}postInitialize(){this.viewModel.isSupported&&this.own([se(()=>this.viewModel.datePickerViewModel,e=>this._datePicker.viewModel=e,wr),se(()=>this.viewModel.timeSliderViewModel,e=>this._timeSlider.viewModel=e,wr),se(()=>{var e;return(e=this.timezoneMessages)==null?void 0:e.chooseTimezone},e=>this._timeSlider.buttonTooltip=e,wr),se(()=>{var e;return(e=this.visibleElements)==null?void 0:e.timezone},e=>this._timeSlider.showDropDown=e,wr),se(()=>!this.viewModel.sunLightingEnabled,e=>{this._datePicker.disabled=e,this._timeSlider.disabled=e},wr),vo(()=>this.gmtOffsets,e=>{this._timeSlider.items=e.map(t=>({utcOffset:t.utcOffset,name:t.short,label:[t.shortWithUTC,t.long]}))},wr),se(()=>[this.viewModel.utcOffset,this.gmtOffsets],()=>this._onUTCOffsetChange(),wr)])}destroy(){this._datePicker.destroy(),this._timeSlider.destroy()}render(){const{messages:e,viewModel:t,visibleElements:i}=this,r=t.isSupported;return W("div",{class:this.classes(cs.base,cs.widget)},r?W(ML,null,i.header&&W(qP,{level:this.headingLevel},e.title),this._renderTimeOptions(),i.datePicker&&this._renderDateOrSeason(),i.sunLightingToggle&&this._renderSunLightingToggle(),i.shadowsToggle&&this._renderShadowsToggle()):W("div",{key:"unsupported",class:cs.panelError},W("p",null,e.unsupported)))}async loadDependencies(){await Promise.all([import("./calcite-button.d23502aa.js"),import("./calcite-checkbox.5075a784.js"),import("./calcite-label.9e1a1ab9.js")])}_renderTimeOptions(){const{viewModel:e,visibleElements:t,messages:i}=this,{directShadowsEnabled:r,dayPlaying:s}=e,n=!e.sunLightingEnabled;return W("div",{class:this.classes(cs.dayContainer,this._labelAlignmentClass,{[cs.shadowOn]:r,[cs.shadowOff]:!r,[cs.sliderDateOn]:t.datePicker,[cs.sliderDateOff]:!t.datePicker,[cs.sliderAmPmOn]:this._useAmPm,[cs.containerDisabled]:n}),key:"daylight-time-options"},this._timeSlider.render(),t.playButtons&&this._renderPlayPauseButton({playing:s,disabled:n,label:i==null?void 0:i.playDay,onClick:this._onPlayDayClick}))}_renderDateOptions(){const{viewModel:e,visibleElements:t,messages:i}=this,{yearPlaying:r}=e,s=!e.sunLightingEnabled;return W("div",{key:"daylight-date-options",class:this.classes(cs.dateContainer,s&&cs.containerDisabled)},this._datePicker.render(),t.playButtons&&this._renderPlayPauseButton({playing:r,disabled:s,label:i==null?void 0:i.playYear,onClick:this._onYearPlayClick}))}_renderPlayPauseButton({playing:e,disabled:t,label:i,onClick:r}){return W("calcite-button",{appearance:"solid",class:cs.playPauseButton,disabled:t,"icon-start":e?"pause-f":"play-f",label:i,round:!0,title:i,type:"button",onclick:r})}_renderSeasonOptions(){const{messages:e,viewModel:t}=this,i=!t.sunLightingEnabled;return W("select",{class:this.classes(cs.select,cs.seasonPicker,i&&cs.seasonPickerDisabled),disabled:i,value:t.currentSeason,"aria-label":e.season,onchange:this._onSeasonChange},Wq.map(r=>W("option",{value:r},e[r])))}_renderDateOrSeason(){return this.dateOrSeason==="date"?this._renderDateOptions():this._renderSeasonOptions()}_renderSunLightingToggle(){var t;const e=(t=this.messages)==null?void 0:t.sunLightingToggle;return W("calcite-label",{key:"date-time-toggle",layout:"inline",title:e==null?void 0:e.tooltip,scale:"s"},W("calcite-checkbox",{class:cs.sunLightingCheckbox,checked:this.viewModel.sunLightingEnabled,onCalciteCheckboxChange:this._onSunLightingCheckboxChange}),e==null?void 0:e.label)}_renderShadowsToggle(){var t;const e=(t=this.messages)==null?void 0:t.shadowsToggle;return W("calcite-label",{key:"shadow-toggle",layout:"inline",title:e==null?void 0:e.tooltip,scale:"s"},W("calcite-checkbox",{class:cs.shadowsCheckbox,checked:this.viewModel.directShadowsEnabled,onCalciteCheckboxChange:this._onShadowCheckboxChange}),e.label)}_onUTCOffsetChange(){var s;const e=this.viewModel.utcOffset,t=(s=this._timeSlider.currentItem)==null?void 0:s.utcOffset,i=this.gmtOffsets;if(M(i)||t===e)return;const r=i.findIndex(({utcOffset:n})=>n===e);r>-1&&(this._timeSlider.currentIndex=r)}_onPrimaryTickCreated(e,t,i){t.classList.add(...P8,cs.primaryTick),i.classList.add(...P8,cs.primaryTickLabel),i.onclick=t.onclick=this._makeGoToTime(e);const r=i.textContent.match(Eue);r&&(i.innerHTML=`${r[1]}<br><div class=${cs.primaryTickAmPm}>${r[2]}</div>`)}_onSecondaryTickCreated(e,t){t.classList.add(...P8,cs.secondaryTick),t.onclick=this._makeGoToTime(e)}_makeGoToTime(e){return()=>{this.viewModel.timeSliderPosition=e}}};u([d({readOnly:!0})],io.prototype,"gmtOffsets",null),u([d(),js("esri/widgets/Daylight/t9n/Daylight")],io.prototype,"messages",void 0),u([d(),js("esri/widgets/support/t9n/timezone")],io.prototype,"timezoneMessages",void 0),u([d()],io.prototype,"headingLevel",void 0),u([d()],io.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.title",overridable:!0}})],io.prototype,"label",void 0),u([qe("viewModel.playSpeedMultiplier")],io.prototype,"playSpeedMultiplier",void 0),u([qe("_timeSlider.steps")],io.prototype,"timeSliderSteps",void 0),u([qe("viewModel.view")],io.prototype,"view",void 0),u([d({type:$Ee})],io.prototype,"viewModel",void 0),u([d({type:DEe,nonNullable:!0})],io.prototype,"visibleElements",void 0),u([d({cast:e=>e==="season"||e==="date"?e:(fbt.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${Zq}".`),Zq)})],io.prototype,"dateOrSeason",void 0),u([d()],io.prototype,"_timeSlider",void 0),u([d()],io.prototype,"_useAmPm",null),u([d()],io.prototype,"_labelAlignmentClass",null),u([d()],io.prototype,"_datePicker",void 0),io=u([P("esri.widgets.Daylight")],io);const P8=["esri-interactive","esri-widget__anchor"],iEt=io;let K0=class extends Se{constructor(e){super(e),this._viewpointHandle=null,this._handles=new jt,this.group=null}initialize(){this._handles.add(En(()=>{var e;return(e=this.view)==null?void 0:e.ui},"expand",e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const t=!!e;this._set("expanded",t);const i=this.get("view.ui");i&&i.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&vo(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?vo(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:t,view:i}=this;if(i&&t){const r=dIe(()=>i.type==="3d"?i.camera:i.viewpoint,()=>this._collapse());this._handles.add(r,e),this._viewpointHandle=r}}_collapse(){this.expanded=!1}};u([d({value:!1})],K0.prototype,"autoCollapse",null),u([d({value:!1})],K0.prototype,"expanded",null),u([d()],K0.prototype,"group",void 0),u([d({readOnly:!0})],K0.prototype,"state",null),u([d({value:null})],K0.prototype,"view",null),K0=u([P("esri.widgets.Expand.ExpandViewModel")],K0);const qEe=K0,On={base:"esri-expand esri-widget",modeAuto:"esri-expand--auto",modeDrawer:"esri-expand--drawer",modeFloating:"esri-expand--floating",container:"esri-expand__container",containerExpanded:"esri-expand__container--expanded",panel:"esri-expand__panel",button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:"esri-expand__icon--expanded",iconNumber:"esri-expand__icon-number",iconNumberExpanded:"esri-expand__icon-number--expanded",expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:"esri-expand__content",contentExpanded:"esri-expand__content--expanded",expandMask:"esri-expand__mask",expandMaskExpanded:"esri-expand__mask--expanded"};let Ks=class extends Xs{constructor(e,t){super(e,t),this.autoCollapse=null,this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expanded=null,this.expandTooltip="",this.group=null,this.iconNumber=0,this.label=void 0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.view=null,this.viewModel=new qEe,this._handleKeyDown=i=>{const{closeOnEsc:r,_toggleButtonEl:s,expanded:n}=this;!n||!r||i.target===s||i.key!=="Escape"||(typeof r=="function"?r(i):r)&&(this.expanded=!1,s==null||s.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:i,expandTooltip:r}=this;return e?i||t.collapse:r||t.expand}get collapseIconClass(){return On.collapseIcon}set collapseIconClass(e){e?this._override("collapseIconClass",e):this._clearOverride("collapseIconClass")}get expandIconClass(){return r4(this.content)?this.content.iconClass:On.expandIcon}set expandIconClass(e){e?this._override("expandIconClass",e):this._clearOverride("expandIconClass")}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,t={[On.modeAuto]:e==="auto",[On.modeDrawer]:e==="drawer",[On.modeFloating]:e==="floating"};return W("div",{class:this.classes(On.base,t),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,t={[On.containerExpanded]:e};return W("div",{class:this.classes(On.container,t)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,t={[On.expandMaskExpanded]:e};return W("div",{bind:this,onclick:this._toggle,class:this.classes(On.expandMask,t)})}renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?W("span",{key:"expand__icon-number",class:On.iconNumber},t):null}renderPanelNumber(){const{iconNumber:e,expanded:t}=this;return e&&t?W("span",{key:"expand__expand-icon-number",class:this.classes(On.iconNumber,On.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:t,expanded:i}=this,r={[On.iconExpanded]:i,[e]:i,[t]:!i};return e===t&&(r[e]=!0),W("span",{"aria-hidden":"true",class:this.classes(On.icon,r)})}renderTitle(){return W("span",{class:On.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:t,contentId:i}=this;return W("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":i,"aria-expanded":e?"true":"false",bind:this,class:On.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:t},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return W("div",{class:On.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:t,content:i}=this,r={[On.contentExpanded]:e},s={id:t,role:"region",class:this.classes(On.content,r)};return typeof i=="string"?W("div",F({key:"content__string",innerHTML:i},s)):r4(i)?W("div",F({key:"content__widget"},s),i.render()):i instanceof HTMLElement?W("div",F({key:"content__html-element",bind:i,afterCreate:this._attachToNode},s)):Eye(i)?W("div",F({key:"content__node",bind:i.domNode,afterCreate:this._attachToNode},s)):null}_toggle(){this.toggle()}_attachToNode(e){const t=this;e.appendChild(t)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};u([d({readOnly:!0})],Ks.prototype,"contentId",null),u([d({readOnly:!0})],Ks.prototype,"expandTitle",null),u([qe("viewModel.autoCollapse")],Ks.prototype,"autoCollapse",void 0),u([d()],Ks.prototype,"closeOnEsc",void 0),u([d()],Ks.prototype,"collapseIconClass",null),u([d()],Ks.prototype,"collapseTooltip",void 0),u([d()],Ks.prototype,"content",void 0),u([qe("viewModel.expanded")],Ks.prototype,"expanded",void 0),u([d()],Ks.prototype,"expandIconClass",null),u([d()],Ks.prototype,"expandTooltip",void 0),u([qe("viewModel.group")],Ks.prototype,"group",void 0),u([d()],Ks.prototype,"iconNumber",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ks.prototype,"label",void 0),u([d(),js("esri/widgets/Expand/t9n/Expand")],Ks.prototype,"messages",void 0),u([d(),js("esri/t9n/common")],Ks.prototype,"messagesCommon",void 0),u([d()],Ks.prototype,"mode",void 0),u([qe("viewModel.view")],Ks.prototype,"view",void 0),u([d({type:qEe})],Ks.prototype,"viewModel",void 0),u([ra()],Ks.prototype,"_toggle",null),Ks=u([P("esri.widgets.Expand")],Ks);const rEt=Ks;function mbt(e){let t,i,r=[],s=!1;function n(...o){return s&&t===this&&gbt(o,r)||(i=e.apply(this,o),t=this,r=o,s=!0),i}return n}function gbt(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}const ev="esri-weather",Jp={base:ev,esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",widgetIcon:"esri-icon-partly-cloudy",content:`${ev}__content`,hasError:`${ev}__content--has-error`,selector:`${ev}__selector`,options:`${ev}__options`,error:`${ev}__error`,warning:`${ev}__warning`},ybt={base:`${`${ev}__labeled-slider`}`};var Xf,rp;(function(e){e.Disabled="disabled",e.Ready="ready",e.Error="error"})(Xf||(Xf={})),function(e){e.NotVisible="not-visible",e.LocalScene="local-scene",e.NoAtmosphere="no-atmosphere",e.UnsupportedView="unsupported-view"}(rp||(rp={}));let pu=class extends Xs{constructor(e){super(e),this.debounceDelay=200,this._onChangeTimeout=null,this._onChangeDebounced=t=>{const i=t.target.value;this._cancelChange(),this._onChangeTimeout=setTimeout(()=>this.onChange(i),this.debounceDelay)},this._cancelChange=()=>{_(this._onChangeTimeout)&&(clearTimeout(this._onChangeTimeout),this._onChangeTimeout=null)}}initialize(){this.own([se(()=>this.onChange,()=>{this._cancelChange()})])}render(){const{label:e,disabled:t}=this;return W("div",{class:ybt.base},W("calcite-label",{scale:"s",disabled:t},e,W("calcite-slider",{"aria-label":e,disabled:this.disabled,max:1,min:0,step:.01,value:this.value,onCalciteSliderInput:this._onChangeDebounced,onCalciteSliderChange:this._onChangeDebounced})))}destroy(){this._cancelChange()}async loadDependencies(){await import("./calcite-slider.c565ec68.js")}};u([d()],pu.prototype,"value",void 0),u([d()],pu.prototype,"onChange",void 0),u([d()],pu.prototype,"disabled",void 0),u([d()],pu.prototype,"debounceDelay",void 0),pu=u([P("esri.widgets.Weather.LabeledSlider")],pu);let nF=class extends Se{constructor(){super(...arguments),this.header=!0}};u([d({type:Boolean,nonNullable:!0})],nF.prototype,"header",void 0),nF=u([P("esri.widgets.Weather.VisibleElements")],nF);const WEe=nF,vbt=ge.getLogger("esri.widgets.Weather.WeatherViewModel");let tv=class extends Se{constructor(e){super(e),this.view=null,this._handles=new jt,this._settingWeather=!1,this._weatherByType={sunny:new OR,cloudy:new Q_e,rainy:new K_e,snowy:new e1e,foggy:new J_e}}initialize(){this._handles.add([se(()=>this.current,e=>{this._settingWeather||M(e)||(this._weatherByType=me(F({},this._weatherByType),{[e.type]:e}))},wr)])}destroy(){this._handles=lt(this._handles)}get state(){const e=this.view;return M(e)||!e.ready?Xf.Disabled:_(this.error)?this.error===rp.NotVisible?Xf.Ready:Xf.Error:Xf.Ready}get error(){const e=this.view;return M(e)||!e.ready?null:e.type!=="3d"?rp.UnsupportedView:e.viewingMode==="local"?rp.LocalScene:e.environment.atmosphereEnabled?e.environmentManager.weatherVisible?null:rp.NotVisible:rp.NoAtmosphere}get current(){const e=Qi(this._environment,t=>t.weather);return ft(e,this._weatherByType.sunny)}set current(e){Qi(this._environment,t=>t.weather=e)}get test(){return F({},this._weatherByType)}get _environment(){const e=this.view;return _(e)&&e.type==="3d"?e.environment:null}setWeatherByType(e){if(!i1e(e,vbt))return;const t=this._environment;_(t)&&(this._settingWeather=!0,t.weather=this._weatherByType[e],this._settingWeather=!1)}setSnowCoverEnabled(e){const t=this.current;"snowCover"in t&&(t.snowCover=e?"enabled":"disabled")}};u([d()],tv.prototype,"view",void 0),u([d()],tv.prototype,"state",null),u([d()],tv.prototype,"error",null),u([d()],tv.prototype,"current",null),u([d()],tv.prototype,"_environment",null),tv=u([P("esri.widgets.Weather.WeatherViewModel")],tv);const _bt=tv,bbt={sunny:"brightness",cloudy:"partly-cloudy",rainy:"rain",snowy:"snow",foggy:"fog"};let yh=class extends Xs{constructor(e){super(e),this.viewModel=new _bt,this.headingLevel=4,this.visibleElements=new WEe,this.iconClass=Jp.widgetIcon,this.label=void 0,this._renderWeatherTypeButton=t=>{const i=this.viewModel,r=this.messages[t].label,s=i.state===Xf.Disabled,n=!s&&i.current.type===t;return W("calcite-button",{appearance:n?"solid":"outline","aria-checked":n?"true":"false",color:n?"blue":"neutral",disabled:s,"icon-start":bbt[t],key:`${t}-type-button`,label:r,role:"radio",scale:"l",title:r,onclick:()=>{n||i.setWeatherByType(t)}})},this._memoizedCallbacks=mbt(t=>({onCloudCoverChange:i=>{"cloudCover"in t&&(t.cloudCover=i)},onPrecipitationChange:i=>{"precipitation"in t&&(t.precipitation=i)},onFogStrengthChange:i=>{"fogStrength"in t&&(t.fogStrength=i)},onSnowCoverChange:i=>{this.viewModel.setSnowCoverEnabled(i.target.checked)}}))}render(){const e=this.viewModel.state===Xf.Disabled;return W("div",{class:this.classes(Jp.base,Jp.esriWidget,e&&Jp.esriWidgetDisabled),role:"region","aria-label":this.messages.widgetLabelAccessible},this._renderContent())}async loadDependencies(){await Promise.all([import("./calcite-button.d23502aa.js"),import("./calcite-checkbox.5075a784.js"),import("./calcite-icon.2fe39738.js"),import("./calcite-label.9e1a1ab9.js"),import("./calcite-slider.c565ec68.js")])}get view(){var e;return(e=this.viewModel)==null?void 0:e.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get _errorMessage(){const e=this.messages.error;switch(this.viewModel.error){case rp.LocalScene:return e.localScene;case rp.NoAtmosphere:return e.noAtmosphere;case rp.UnsupportedView:return e.unsupported;default:return null}}get _warningMessage(){var e;return this.viewModel.error===rp.NotVisible&&_(this.view)&&((e=this.view)==null?void 0:e.type)==="3d"&&this.view.environment.atmosphereEnabled?this.messages.error.notVisible:null}_renderContent(){const e=this.messages,t=this._warningMessage,i=this.viewModel.state===Xf.Error;return W(ML,null,this.visibleElements.header&&W(qP,{level:this.headingLevel},e.widgetLabel),i&&W("div",{key:"error",class:Jp.error},this._errorMessage),W("div",{key:"content",class:YX({[Jp.content]:!0,[Jp.hasError]:i})},W("div",{class:Jp.selector,role:"radiogroup","aria-label":e.weatherType},t1e.map(this._renderWeatherTypeButton)),W("div",{class:Jp.options},this._renderOptions()),_(t)&&this._renderWarning(t)))}_renderOptions(){const{viewModel:e,messages:t}=this,i=e.state===Xf.Disabled,r=e.current,s=this._memoizedCallbacks(r);switch(r.type){case"sunny":return W(pu,{key:"sunny-cover",disabled:i,label:t.sunny.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange});case"cloudy":return W(pu,{key:"cloudy-cover",disabled:i,label:t.cloudy.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange});case"rainy":return W(ML,null,W(pu,{key:"rainy-cover",disabled:i,label:t.rainy.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange}),W(pu,{key:"rainy-precipitation",disabled:i,debounceDelay:0,label:t.rainy.precipitation,value:r.precipitation,onChange:s.onPrecipitationChange}));case"snowy":return W(ML,null,W(pu,{key:"snowy-cloud-cover",disabled:i,label:t.snowy.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange}),W(pu,{key:"snowy-precipitation",disabled:i,debounceDelay:0,label:t.snowy.precipitation,value:r.precipitation,onChange:s.onPrecipitationChange}),W("calcite-label",{key:"snow-cover",scale:"s",disabled:i,layout:"inline",title:t.snowy.snowCoverTooltip},W("calcite-checkbox",{checked:r.snowCover==="enabled",onCalciteCheckboxChange:s.onSnowCoverChange}),t.snowy.snowCover));case"foggy":return W(pu,{key:"foggy-cover",disabled:i,debounceDelay:0,label:t.foggy.fogStrength,value:r.fogStrength,onChange:s.onFogStrengthChange})}}_renderWarning(e){return W("div",{key:"warning",class:Jp.warning},W("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s"}),e)}};u([d()],yh.prototype,"viewModel",void 0),u([d()],yh.prototype,"view",null),u([d()],yh.prototype,"headingLevel",void 0),u([d({type:WEe,nonNullable:!0})],yh.prototype,"visibleElements",void 0),u([d()],yh.prototype,"iconClass",void 0),u([qe("messages.widgetLabel",{overridable:!0})],yh.prototype,"label",void 0),u([d(),js("esri/widgets/Weather/t9n/Weather")],yh.prototype,"messages",void 0),u([d()],yh.prototype,"_errorMessage",null),u([d()],yh.prototype,"_warningMessage",null),yh=u([P("esri.widgets.Weather")],yh);const sEt=yh,Bi={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let bS,XEe,vz,YEe=!1,w5=!1,GJ=!1,uu=!1,Cue=null,Qq=!1;const R3=typeof window!="undefined"?window:{};Bi.cssVarShim&&R3.CSS;const _p=R3.document||{head:{}},wbt=R3.HTMLElement||class{},Mc={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},x5=Bi.shadowDomShim&&Bi.shadowDom?(()=>(_p.head.attachShadow+"").indexOf("[native")>-1)():!0,xbt=(()=>{let e=!1;try{_p.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),Tbt=e=>Promise.resolve(e),Sbt=Bi.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,ZEe=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=Cbt(e,s),l=Ebt(t,o),c=Abt(s);Mc.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>Mc.rel(a,n,l,c))})},Ebt=(e,t)=>i=>{try{Bi.lazyLoad||e.$hostElement$[t](i)}catch(r){P3(r)}},Cbt=(e,t)=>t&4?_p:t&8?R3:t&16?_p.body:e,Abt=e=>xbt?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Aue="http://www.w3.org/1999/xlink",tx=(e,t="")=>()=>{},Mue=new WeakMap,Mbt=(e,t,i)=>{let r=E5.get(e);Sbt&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,E5.set(e,r)},Obt=(e,t,i,r)=>{let s=QEe(t,i);const n=E5.get(s);if(e=e.nodeType===11?e:_p,n)if(typeof n=="string"){e=e.head||e;let o=Mue.get(e),a;o||Mue.set(e,o=new Set),o.has(s)||(a=_p.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},Rbt=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=tx("attachStyles",t.$tagName$),n=Obt(x5&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},QEe=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),Pbt=e=>nwt.map(t=>t(e)).find(t=>!!t),Oue={},Ibt="http://www.w3.org/2000/svg",$bt="http://www.w3.org/1999/xhtml",Dbt=e=>e!=null,jJ=e=>(e=typeof e,e==="object"||e==="function"),_h=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!jJ(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?T5(null,r):r),a=o)};if(c(i),t&&(Bi.isDev&&e==="input"&&Fbt(t),Bi.vdomKey&&t.key&&(s=t.key),Bi.slotRelocation&&t.name&&(n=t.name),Bi.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(Bi.isDev&&l.some(KEe)&&rwt(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Bi.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,Lbt);const h=T5(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),Bi.vdomKey&&(h.$key$=s),Bi.slotRelocation&&(h.$name$=n),h},T5=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Bi.vdomAttribute&&(i.$attrs$=null),Bi.vdomKey&&(i.$key$=null),Bi.slotRelocation&&(i.$name$=null),i},JEe={},KEe=e=>e&&e.$tag$===JEe,Lbt={forEach:(e,t)=>e.map(Rue).forEach(t),map:(e,t)=>e.map(Rue).map(t).map(Nbt)},Rue=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),Nbt=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),_h(e.vtag,i,...e.vchildren||[])}const t=T5(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},Fbt=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&swt('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},Pue=(e,t,i,r,s,n)=>{if(i!==r){let o=Lue(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=Iue(i),h=Iue(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Lue(R3,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&Mc.rel(e,t,i,!1),r&&Mc.ael(e,t,r,!1);else{const l=jJ(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{const h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(Aue,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(Aue,t,r):e.setAttribute(t,r))}}},kbt=/\s/,Iue=e=>e?e.split(kbt):[],eCe=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||Oue,o=t.$attrs$||Oue;for(r in n)r in o||Pue(s,r,n[r],void 0,i,t.$flags$);for(r in o)Pue(s,r,n[r],o[r],i,t.$flags$)},S5=(e,t,i,r)=>{const s=t.$children$[i];let n=0,o,a,l;if(YEe||(GJ=!0,s.$tag$==="slot"&&(bS&&r.classList.add(bS+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=_p.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=_p.createTextNode("");else{if(uu||(uu=s.$tag$==="svg"),o=s.$elm$=_p.createElementNS(uu?Ibt:$bt,s.$flags$&2?"slot-fb":s.$tag$),uu&&s.$tag$==="foreignObject"&&(uu=!1),eCe(null,s,uu),Dbt(bS)&&o["s-si"]!==bS&&o.classList.add(o["s-si"]=bS),s.$children$)for(n=0;n<s.$children$.length;++n)a=S5(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?uu=!1:o.tagName==="foreignObject"&&(uu=!0)}return o["s-hn"]=vz,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=XEe,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&CP(e.$elm$,!1)),o},CP=(e,t)=>{Mc.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==vz&&s["s-ol"]&&(rCe(s).insertBefore(s,HJ(s)),s["s-ol"].remove(),s["s-ol"]=void 0,GJ=!0),t&&CP(s,t)}Mc.$flags$&=-2},tCe=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===vz&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=S5(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,HJ(t))))},iCe=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,oCe(r),w5=!0,s["s-ol"]?s["s-ol"].remove():CP(s,!0),s.remove())},Ubt=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],m=r[p],y,v;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(XD(c,f))wS(c,f),c=t[++s],f=r[++n];else if(XD(h,m))wS(h,m),h=t[--l],m=r[--p];else if(XD(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&CP(c.$elm$.parentNode,!1),wS(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=r[--p];else if(XD(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&CP(h.$elm$.parentNode,!1),wS(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(v=t[o],v.$tag$!==f.$tag$?y=S5(t&&t[n],i,o,e):(wS(v,f),t[o]=void 0,y=v.$elm$),f=r[++n]):(y=S5(t&&t[n],i,n,e),f=r[++n]),y&&rCe(c.$elm$).insertBefore(y,HJ(c.$elm$))}s>l?tCe(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&iCe(t,s,l)},XD=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,HJ=e=>e&&e["s-ol"]||e,rCe=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,wS=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(uu=n==="svg"?!0:n==="foreignObject"?!1:uu,n==="slot"||eCe(e,t,uu),r!==null&&s!==null?Ubt(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),tCe(i,null,t,s,0,s.length-1)):r!==null&&iCe(r,0,r.length-1),uu&&n==="svg"&&(uu=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},sCe=e=>{const t=e.childNodes;let i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}sCe(i)}},Jd=[],nCe=e=>{let t,i,r,s,n,o,a=0;const l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&($ue(i,s)?(n=Jd.find(h=>h.$nodeToRelocate$===i),w5=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:Jd.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&Jd.map(h=>{$ue(h.$nodeToRelocate$,i["s-sn"])&&(n=Jd.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Jd.some(h=>h.$nodeToRelocate$===i)||Jd.push({$nodeToRelocate$:i}));t.nodeType===1&&nCe(t)}},$ue=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",oCe=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(oCe)},zbt=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||T5(null,null),n=KEe(t)?t:_h(null,null,t);vz=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,bS=i["s-sc"],XEe=i["s-cr"],YEe=x5&&(r.$flags$&1)!==0,w5=!1,wS(s,n);{if(Mc.$flags$|=1,GJ){nCe(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Jd.length;f++)o=Jd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=_p.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Jd.length;f++)if(o=Jd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}w5&&sCe(n.$elm$),Mc.$flags$&=-2,Jd.length=0}},Vbt=(e,t)=>{},aCe=(e,t)=>(e.$flags$|=16,Vbt(e,e.$ancestorComponent$),lwt(()=>Bbt(e,t))),Bbt=(e,t)=>{const i=e.$hostElement$,r=tx("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=w2(s,"componentWillLoad"):n=w2(s,"componentWillUpdate"),n=Due(n,()=>w2(s,"componentWillRender")),r(),Due(n,()=>Gbt(e,s,t))},Gbt=async(e,t,i)=>{const r=e.$hostElement$,s=tx("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&Rbt(e);const n=tx("render",e.$cmpMeta$.$tagName$);jbt(e,t,r),n(),s(),Hbt(e)},jbt=(e,t,i)=>{try{Cue=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Bi.hasRenderFn||Bi.reflect)&&(Bi.vdomRender||Bi.reflect)&&(Bi.hydrateServerSide||zbt(e,t))}catch(a){P3(a,e.$hostElement$)}return Cue=null,null},Hbt=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=tx("postUpdate",t),s=i;e.$ancestorComponent$,w2(s,"componentDidRender"),e.$flags$&64?(w2(s,"componentDidUpdate"),r()):(e.$flags$|=64,w2(s,"componentDidLoad"),r())},w2=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){P3(r)}},Due=(e,t)=>e&&e.then?e.then(t):t(),qbt=(e,t)=>e!=null&&!jJ(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,Wbt=(e,t)=>_z(e).$instanceValues$.get(t),Xbt=(e,t,i,r)=>{const s=_z(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=qbt(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(f=>{try{l[f](i,o,t)}catch(m){P3(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;aCe(s,!1)}}}},Ybt=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return Wbt(this,n)},set(a){Xbt(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Mc.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},Zbt=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=Pbt(e)]);const a=QEe(i,t.$modeName$);if(!E5.has(a)){const l=tx("registerStyles",i.$tagName$);Mbt(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>aCe(t,!0))()},Qbt=e=>{},Jbt=e=>{if((Mc.$flags$&1)===0){const t=_z(e),i=t.$cmpMeta$,r=tx("connectedCallback",i.$tagName$);t.$flags$&1?(ZEe(e,t,i.$listeners$),Qbt(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&Kbt(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),Zbt(e,t,i)),r()}},Kbt=e=>{const t=e["s-cr"]=_p.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},ewt=e=>{if((Mc.$flags$&1)===0){const t=_z(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},twt=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};Bi.member&&(i.$members$=t[2]),Bi.hostListener&&(i.$listeners$=t[3]),Bi.watchCallback&&(i.$watchers$=e.$watchers$),Bi.reflect&&(i.$attrsToReflect$=[]),Bi.shadowDom&&!x5&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){iwt(this,i)},connectedCallback(){Jbt(this),Bi.connectedCallback&&r&&r.call(this)},disconnectedCallback(){ewt(this),Bi.disconnectedCallback&&s&&s.call(this)},__attachShadow(){x5?Bi.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,Ybt(e,i)},lCe=new WeakMap,_z=e=>lCe.get(e),iwt=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Bi.isDev&&(i.$renderCount$=0),Bi.method&&Bi.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),Bi.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),ZEe(e,i,t.$listeners$),lCe.set(e,i)},Lue=(e,t)=>t in e,P3=(e,t)=>(0,console.error)(e,t),cCe=Bi.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],rwt=(...e)=>console.error(...cCe,...e),swt=(...e)=>console.warn(...cCe,...e),E5=new Map,nwt=[],Nue=[],uCe=[],owt=(e,t)=>i=>{e.push(i),Qq||(Qq=!0,t&&Mc.$flags$&4?awt(Jq):Mc.raf(Jq))},Fue=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){P3(i)}e.length=0},Jq=()=>{Fue(Nue),Fue(uCe),(Qq=Nue.length>0)&&Mc.raf(Jq)},awt=e=>Tbt().then(e),lwt=owt(uCe,!0);Bi.isDev,Bi.isTesting;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */function cwt(e){return e.map(t=>{let i="";for(let r=0;r<t;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const uwt=()=>cwt([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */const hwt='@charset "UTF-8";@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{position:relative;margin-left:auto;margin-right:auto;display:none;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;padding-top:4rem;padding-bottom:4rem;opacity:1;min-height:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;-webkit-transform:scale(1, 1);transform:scale(1, 1);animation:loader-color-shift 6s alternate-reverse infinite linear}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-top:0px;padding-bottom:0px}:host{display:none}:host([active]){display:-ms-flexbox;display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-top:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);width:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;width:var(--calcite-loader-size);height:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svg{position:absolute;top:0px;left:0px;-webkit-transform-origin:center;transform-origin:center;overflow:visible;width:var(--calcite-loader-size);height:var(--calcite-loader-size);-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:loader-clockwise;animation-name:loader-clockwise}@supports (display: grid){.loader__svg--1{-webkit-animation-name:loader-offset-1;animation-name:loader-offset-1}.loader__svg--2{-webkit-animation-name:loader-offset-2;animation-name:loader-offset-2}.loader__svg--3{-webkit-animation-name:loader-offset-3;animation-name:loader-offset-3}}:host([type=determinate]){-webkit-animation:none;animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svg--3{-webkit-animation:none;animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;-webkit-transform:rotate(-90deg);transform:rotate(-90deg);-webkit-transition:all var(--calcite-internal-animation-timing-fast) linear;transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;-webkit-animation:none;animation:none;stroke:currentColor;stroke-width:2;padding-top:0px;padding-bottom:0px;height:var(--calcite-loader-size-inline);min-height:var(--calcite-loader-size-inline);width:var(--calcite-loader-size-inline);-webkit-margin-end:calc(var(--calcite-loader-size-inline) * 0.5);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([active][inline]){display:inline-block}:host([inline]) .loader__svgs{top:0px;left:0px;margin:0px;width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444% 139.6262222222%;-webkit-animation-duration:0.72s;animation-duration:0.72s}@-webkit-keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}.loader__svg--2{stroke-dasharray:55.8504888889% 139.6262222222%;-webkit-animation-duration:0.96s;animation-duration:0.96s}@-webkit-keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}.loader__svg--3{stroke-dasharray:13.9626222222% 139.6262222222%;-webkit-animation-duration:1.16s;animation-duration:1.16s}@-webkit-keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@-webkit-keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@-webkit-keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}',dwt=twt(class extends wbt{constructor(){super();this.__registerHost(),this.__attachShadow(),this.active=!1,this.inline=!1,this.scale="m",this.value=0,this.text="",this.noPadding=!1}render(){const{el:e,inline:t,label:i,scale:r,text:s,type:n,value:o}=this,a=e.id||uwt(),l=.45,c=t?this.getInlineSize(r):this.getSize(r),h=c*l,p=`0 0 ${c} ${c}`,f=n==="determinate",m=2*h*Math.PI,y=o/100*m,v=m-y,w=Math.floor(o),b={"aria-valuenow":w,"aria-valuemin":0,"aria-valuemax":100,complete:w===100},S={r:h,cx:c/2,cy:c/2},T={"stroke-dasharray":`${y} ${v}`};return _h(JEe,Object.assign({"aria-label":i,id:a,role:"progressbar"},f?b:{}),_h("div",{class:"loader__svgs"},_h("svg",{class:"loader__svg loader__svg--1",viewBox:p},_h("circle",Object.assign({},S))),_h("svg",{class:"loader__svg loader__svg--2",viewBox:p},_h("circle",Object.assign({},S))),_h("svg",Object.assign({class:"loader__svg loader__svg--3",viewBox:p},f?{style:T}:{}),_h("circle",Object.assign({},S)))),s&&_h("div",{class:"loader__text"},s),f&&_h("div",{class:"loader__percentage"},o))}getSize(e){return{s:32,m:56,l:80}[e]}getInlineSize(e){return{s:12,m:16,l:20}[e]}get el(){return this}static get style(){return hwt}},[1,"calcite-loader",{active:[516],inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1],noPadding:[4,"no-padding"]}]);function pwt(){if(typeof customElements=="undefined")return;["calcite-loader"].forEach(t=>{switch(t){case"calcite-loader":customElements.get(t)||customElements.define(t,dwt);break}})}pwt();let Tg=class extends cZ(as.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){if(!this.get("view.ready"))throw new q("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await this.view.when(),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};u([d()],Tg.prototype,"_goingHomeController",void 0),u([d({readOnly:!0})],Tg.prototype,"state",null),u([d()],Tg.prototype,"view",null),u([d({type:Rl})],Tg.prototype,"viewpoint",null),u([d()],Tg.prototype,"go",null),u([d()],Tg.prototype,"cancelGo",null),Tg=u([P("esri.widgets.Home.HomeViewModel")],Tg);const hCe=Tg,S1={base:"esri-home esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",homeIcon:"esri-icon esri-icon-home",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",widgetIcon:"esri-icon-home",disabled:"esri-disabled"};let ul=class extends Xs{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=S1.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.view=null,this.viewModel=new hCe,this.viewpoint=null}get homeTitle(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{messagesCommon:t,messages:i}=this;return e==="going-home"?t.cancel:i.title}cancelGo(){return null}go(){return null}render(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{homeTitle:t}=this,i={[S1.disabled]:e==="disabled"};return W("div",{bind:this,class:this.classes(S1.base,i),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":t,title:t},this.renderIcon(),this.renderText())}renderIcon(){var i;const e=(i=this.viewModel)==null?void 0:i.state,t={[S1.loadingIcon]:e==="going-home",[S1.rotatingIcon]:e==="going-home"};return W("span",{"aria-hidden":"true",class:this.classes(S1.homeIcon,t)})}renderText(){const{messages:e}=this;return W("span",{class:S1.text},e.button)}_go(){const{viewModel:e}=this;e.state==="going-home"?e.cancelGo():e.go()}};u([qe("viewModel.goToOverride")],ul.prototype,"goToOverride",void 0),u([d({readOnly:!0})],ul.prototype,"homeTitle",null),u([d()],ul.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ul.prototype,"label",void 0),u([d(),js("esri/widgets/Home/t9n/Home")],ul.prototype,"messages",void 0),u([d(),js("esri/t9n/common")],ul.prototype,"messagesCommon",void 0),u([qe("viewModel.view")],ul.prototype,"view",void 0),u([d({type:hCe}),xye("go")],ul.prototype,"viewModel",void 0),u([qe("viewModel.viewpoint")],ul.prototype,"viewpoint",void 0),u([qe("viewModel.cancelGo")],ul.prototype,"cancelGo",null),u([qe("viewModel.go")],ul.prototype,"go",null),u([ra()],ul.prototype,"_go",null),ul=u([P("esri.widgets.Home")],ul);const nEt=ul;export{mSt as $,DK as A,Aw as B,DO as C,lE as D,GBe as E,Qr as F,se as G,KSt as H,e2t as I,TR as J,ltt as K,fy as L,Kd as M,it as N,wr as O,Yh as P,qSt as Q,i2t as R,A_ as S,iEt as T,Ki as U,q as V,TBe as W,pSt as X,Q5 as Y,fSt as Z,VP as _,sEt as a,bee as a$,yX as a0,q5 as a1,Jve as a2,aPe as a3,dSt as a4,as as a5,jSt as a6,q$e as a7,El as a8,pm as a9,h2t as aA,UQ as aB,ZSt as aC,YSt as aD,vo as aE,En as aF,lC as aG,yt as aH,Vs as aI,jxe as aJ,Sn as aK,on as aL,Pwt as aM,bu as aN,lo as aO,r_ as aP,rs as aQ,op as aR,hR as aS,ne as aT,un as aU,de as aV,ce as aW,at as aX,du as aY,FI as aZ,GSt as a_,dct as aa,sit as ab,Ac as ac,ci as ad,eW as ae,he as af,uxt as ag,ge as ah,td as ai,yo as aj,z2 as ak,z8e as al,ft as am,mr as an,QW as ao,le as ap,lm as aq,Lu as ar,R as as,Hs as at,dy as au,ui as av,rE as aw,Gt as ax,JSt as ay,QSt as az,Zf as b,CSt as b$,kSt as b0,oit as b1,Z5 as b2,cy as b3,ywt as b4,ux as b5,pct as b6,AQ as b7,nm as b8,HY as b9,et as bA,lr as bB,o5 as bC,Ve as bD,hge as bE,vv as bF,uTt as bG,hTt as bH,J9e as bI,eE as bJ,mo as bK,FA as bL,Ze as bM,Rxt as bN,GP as bO,xn as bP,eTt as bQ,Qxt as bR,Hge as bS,vFe as bT,iTt as bU,tTt as bV,Jxt as bW,Kxt as bX,Tu as bY,sx as bZ,jje as b_,cn as ba,ix as bb,Nt as bc,SSe as bd,hxt as be,pr as bf,sk as bg,bSt as bh,ay as bi,Mpe as bj,rw as bk,FK as bl,Ope as bm,$ct as bn,bi as bo,Twt as bp,Jue as bq,Zue as br,Li as bs,je as bt,Ee as bu,li as bv,yr as bw,hp as bx,os as by,gr as bz,K_e as c,dU as c$,rdt as c0,_2t as c1,uJ as c2,hx as c3,UP as c4,Ic as c5,vu as c6,Sp as c7,sc as c8,kP as c9,Vt as cA,Xe as cB,K as cC,B4 as cD,Mm as cE,vt as cF,Am as cG,Me as cH,j as cI,dr as cJ,sr as cK,la as cL,fr as cM,nr as cN,zi as cO,Ut as cP,$y as cQ,Bk as cR,D_ as cS,Il as cT,hU as cU,ti as cV,ym as cW,T_ as cX,N_ as cY,fU as cZ,Rm as c_,kr as ca,O as cb,aW as cc,sw as cd,_k as ce,ji as cf,ha as cg,nn as ch,hi as ci,ei as cj,Ns as ck,bt as cl,Ur as cm,RE as cn,wSt as co,fL as cp,rx as cq,Uut as cr,qi as cs,Ru as ct,Uo as cu,pi as cv,Ome as cw,x as cx,ys as cy,Vu as cz,Cc as d,WG as d$,aU as d0,Xw as d1,OU as d2,mrt as d3,OZ as d4,mC as d5,Ixe as d6,Ss as d7,ok as d8,Qi as d9,mhe as dA,j5 as dB,UK as dC,Su as dD,Dpe as dE,fc as dF,Dy as dG,USe as dH,C5 as dI,vw as dJ,E$e as dK,ke as dL,Wg as dM,IDe as dN,Ae as dO,Br as dP,VYe as dQ,W2t as dR,R2t as dS,X2t as dT,YZ as dU,j2 as dV,EJ as dW,B2t as dX,k2t as dY,U2t as dZ,F2t as d_,cmt as da,qde as db,Gwt as dc,DRe as dd,gmt as de,$8e as df,fq as dg,x2 as dh,Iu as di,Z7e as dj,hj as dk,Ue as dl,Sr as dm,cSt as dn,um as dp,G9e as dq,s_e as dr,tGe as ds,G8e as dt,QBe as du,ZY as dv,NP as dw,ut as dx,wi as dy,H9e as dz,tEt as e,QR as e$,Uwe as e0,Dc as e1,egt as e2,N2t as e3,jft as e4,vC as e5,q2t as e6,Hft as e7,Pxt as e8,Hle as e9,xX as eA,BF as eB,WW as eC,Gz as eD,De as eE,Ri as eF,Mk as eG,Ht as eH,Xwt as eI,ve as eJ,DX as eK,Oe as eL,Z2t as eM,Y2t as eN,Bu as eO,er as eP,Q2t as eQ,ASt as eR,A2 as eS,ur as eT,Bft as eU,lTt as eV,T2t as eW,zh as eX,ie as eY,I5 as eZ,Owt as e_,_2 as ea,lw as eb,jr as ec,w$e as ed,Jh as ee,ey as ef,Dxt as eg,mi as eh,ln as ei,bp as ej,$2t as ek,K$e as el,lmt as em,tw as en,H2t as eo,Ji as ep,YE as eq,j2t as er,$t as es,mmt as et,wve as eu,xve as ev,WSt as ew,G2t as ex,L2t as ey,D2t as ez,n_t as f,zge as f$,iR as f0,Gu as f1,XSt as f2,Abe as f3,np as f4,ytt as f5,Emt as f6,Cmt as f7,O2t as f8,Fv as f9,jOe as fA,iw as fB,r0e as fC,Vde as fD,MW as fE,Fwt as fF,Ml as fG,jE as fH,fY as fI,W5e as fJ,F2 as fK,Rc as fL,zye as fM,sm as fN,LUe as fO,zwt as fP,c3e as fQ,Uhe as fR,lX as fS,Cw as fT,uR as fU,o_t as fV,Tv as fW,Au as fX,f3e as fY,k2 as fZ,A5 as f_,PDe as fa,Gs as fb,hr as fc,Te as fd,Fa as fe,pe as ff,hm as fg,nN as fh,Vf as fi,ymt as fj,Qre as fk,I2t as fl,NK as fm,xSt as fn,Gut as fo,wAe as fp,$Ce as fq,aTt as fr,om as fs,lDe as ft,cDe as fu,Be as fv,Ixt as fw,tW as fx,Bme as fy,FOe as fz,jt as g,Ai as g$,Nu as g0,vxt as g1,xS as g2,rO as g3,Hv as g4,bw as g5,_ee as g6,X5e as g7,ITt as g8,$te as g9,Hwt as gA,Wwt as gB,rR as gC,Gh as gD,$Re as gE,yxe as gF,NSt as gG,ntt as gH,VSt as gI,Ape as gJ,oxt as gK,Cwt as gL,b2t as gM,rxt as gN,G5 as gO,vUe as gP,BSt as gQ,Nr as gR,Wye as gS,Gve as gT,$_ as gU,Hrt as gV,Ys as gW,Pu as gX,It as gY,Of as gZ,ss as g_,DTt as ga,Bwt as gb,vde as gc,SOe as gd,STt as ge,e0e as gf,i0e as gg,Jye as gh,Zwt as gi,DSt as gj,kde as gk,XOe as gl,Uwt as gm,Pc as gn,ZVe as go,QVe as gp,YP as gq,tC as gr,Hye as gs,zSt as gt,D8e as gu,uSt as gv,vAe as gw,Ywt as gx,jwt as gy,qwt as gz,At as h,kwt as h$,mt as h0,ze as h1,gt as h2,St as h3,tt as h4,Or as h5,qa as h6,ot as h7,Ha as h8,Qe as h9,ZTt as hA,$Tt as hB,rSt as hC,cX as hD,ly as hE,zH as hF,RP as hG,Xh as hH,Yxt as hI,i8e as hJ,nx as hK,Em as hL,E2 as hM,PK as hN,Fye as hO,Pke as hP,Rke as hQ,Oi as hR,Oxt as hS,Swt as hT,Zv as hU,jv as hV,SI as hW,LW as hX,DW as hY,NW as hZ,kye as h_,tr as ha,ko as hb,py as hc,ls as hd,KB as he,di as hf,y4 as hg,I_ as hh,lU as hi,ISt as hj,st as hk,fo as hl,bme as hm,Lxt as hn,pge as ho,KTt as hp,k5 as hq,ETt as hr,_wt as hs,Gn as ht,BQ as hu,Al as hv,Yi as hw,JD as hx,zde as hy,Mwt as hz,u as i,Bdt as i$,jb as i0,E2t as i1,C2t as i2,lxt as i3,SPe as i4,fb as i5,S2t as i6,H4 as i7,u_ as i8,Er as i9,$ye as iA,dM as iB,Xme as iC,xAe as iD,b4 as iE,X3 as iF,x2t as iG,Fle as iH,w2t as iI,fa as iJ,o2 as iK,c5e as iL,iE as iM,Oc as iN,nw as iO,ny as iP,$5 as iQ,EX as iR,_mt as iS,ime as iT,P2t as iU,IOe as iV,P2e as iW,Fe as iX,Xue as iY,qz as iZ,S2 as i_,Zg as ia,xl as ib,$c as ic,Iy as id,go as ie,dt as ig,dxt as ih,WP as ii,Ci as ij,vi as ik,ca as il,Ppe as im,A2t as io,M2t as ip,ZW as iq,SDe as ir,ik as is,$St as it,qs as iu,si as iv,_i as iw,u2t as ix,z2t as iy,V2t as iz,d as j,FRe as j$,Dvt as j0,RG as j1,ds as j2,OG as j3,IG as j4,zF as j5,j$e as j6,uw as j7,Pfe as j8,Ff as j9,Q5e as jA,CLe as jB,Q$e as jC,qxt as jD,Z$e as jE,we as jF,ct as jG,CE as jH,Ow as jI,Mu as jJ,$xt as jK,Gxt as jL,jxt as jM,gZ as jN,t9 as jO,Mse as jP,Dt as jQ,qf as jR,$fe as jS,XIe as jT,JS as jU,H$e as jV,ri as jW,bo as jX,Fr as jY,eR as jZ,r2t as j_,m2t as ja,v2t as jb,zSe as jc,vle as jd,f2t as je,g2t as jf,p2t as jg,BO as jh,RL as ji,jht as jj,rd as jk,$wt as jl,kZ as jm,Na as jn,gle as jo,bht as jp,wht as jq,_St as jr,nZ as js,vSt as jt,Rt as ju,Es as jv,Oh as jw,tP as jx,yTt as jy,Du as jz,Ga as k,TW as k$,Dwt as k0,sn as k1,Txt as k2,xxt as k3,s$e as k4,i$e as k5,Ofe as k6,Ext as k7,Mxt as k8,Axt as k9,dc as kA,Wd as kB,en as kC,l1e as kD,yZ as kE,ZS as kF,aM as kG,wy as kH,kX as kI,q2 as kJ,cr as kK,pO as kL,ck as kM,Wxt as kN,_w as kO,Xxt as kP,mHe as kQ,_He as kR,MG as kS,Tp as kT,Yr as kU,vZ as kV,rPe as kW,He as kX,Bs as kY,Hxt as kZ,GDe as k_,Cxt as ka,zf as kb,RR as kc,Fo as kd,yk as ke,nTt as kf,oTt as kg,rTt as kh,sTt as ki,Ts as kj,Ly as kk,za as kl,oJ as km,Out as kn,VS as ko,qH as kp,Jw as kq,Ni as kr,iS as ks,Tme as kt,_o as ku,dn as kv,pl as kw,F5 as kx,i_ as ky,cHe as kz,We as l,Uu as l$,Rh as l0,_K as l1,sQ as l2,Sm as l3,uo as l4,bl as l5,cw as l6,LZe as l7,PSt as l8,OSt as l9,Pr as lA,mm as lB,xt as lC,Vo as lD,pU as lE,cU as lF,pt as lG,Hi as lH,cxt as lI,Iae as lJ,NX as lK,vs as lL,MR as lM,TSt as lN,ixt as lO,Nxt as lP,tp as lQ,zu as lR,RU as lS,Vr as lT,ja as lU,Ua as lV,Fi as lW,Cn as lX,Nwe as lY,kxt as lZ,gKe as l_,RSt as la,zxt as lb,g0t as lc,T2 as ld,N8 as le,Yet as lf,htt as lg,ESt as lh,Fb as li,Tc as lj,Sxt as lk,ir as ll,Hre as lm,rW as ln,Lg as lo,Ibe as lp,dx as lq,FX as lr,ext as ls,Vxt as lt,nxt as lu,jre as lv,Tm as lw,OX as lx,cme as ly,dm as lz,nEt as m,NBe as m$,xu as m0,xDe as m1,Mp as m2,jwe as m3,SE as m4,C2 as m5,TQ as m6,ek as m7,Lwt as m8,MCe as m9,cLe as mA,uy as mB,hk as mC,Nqe as mD,Fxt as mE,d2t as mF,O5 as mG,px as mH,Fu as mI,y$e as mJ,Qf as mK,R8e as mL,J8e as mM,o9e as mN,WY as mO,Ght as mP,by as mQ,lR as mR,O_ as mS,H8e as mT,tN as mU,Ewt as mV,CBe as mW,Rwt as mX,LSt as mY,TOe as mZ,tSt as m_,Bxt as ma,mz as mb,jF as mc,Mvt as md,J2t as me,eEt as mf,K2t as mg,gW as mh,iW as mi,sxt as mj,E1 as mk,Gre as ml,pf as mm,$P as mn,zX as mo,fR as mp,B2 as mq,txt as mr,fQe as ms,VX as mt,Hfe as mu,V2 as mv,ODe as mw,aae as mx,Sc as my,P_ as mz,P as n,L8 as n$,uVe as n0,wRe as n1,yxt as n2,R9e as n3,P9e as n4,I9e as n5,O1e as n6,TZ as n7,R1e as n8,Sy as n9,gY as nA,NUe as nB,s0e as nC,ATt as nD,CTt as nE,Qwt as nF,Jwt as nG,Kwt as nH,nOe as nI,USt as nJ,Dte as nK,FSt as nL,Tl as nM,oUe as nN,BBe as nO,dRe as nP,Gke as nQ,LTt as nR,eUe as nS,xte as nT,qye as nU,PTt as nV,wIe as nW,iSt as nX,EG as nY,v6 as nZ,_6 as n_,mc as na,Cs as nb,ku as nc,v3 as nd,Qfe as ne,hn as nf,zU as ng,$$e as nh,o2t as ni,uE as nj,x_ as nk,s2t as nl,a2t as nm,n2t as nn,Wnt as no,Qnt as np,Xnt as nq,Ynt as nr,Znt as ns,uUe as nt,aUe as nu,wTt as nv,RTt as nw,OTt as nx,cUe as ny,Yve as nz,Av as o,Cm as o$,ACe as o0,bwt as o1,wwt as o2,fu as o3,bTt as o4,xwt as o5,cc as o6,MTt as o7,Ak as o8,b2e as o9,rhe as oA,KS as oB,Vpe as oC,mxt as oD,BE as oE,ki as oF,jh as oG,X5 as oH,VE as oI,_xt as oJ,YBe as oK,sSt as oL,QTt as oM,s3e as oN,XBe as oO,XE as oP,nSt as oQ,l2t as oR,yot as oS,U2 as oT,cO as oU,dG as oV,oSt as oW,fl as oX,ml as oY,sa as oZ,Ec as o_,$i as oa,my as ob,Eu as oc,Mv as od,ySt as oe,dp as of,PJ as og,Uxt as oh,UDe as oi,gwt as oj,mwt as ok,KPe as ol,cR as om,nX as on,y2t as oo,lc as op,sW as oq,yle as or,SSt as os,js as ot,Xs as ou,W as ov,Af as ow,Bb as ox,r4 as oy,zs as oz,cx as p,FWe as p$,DL as p0,wR as p1,NY as p2,l4 as p3,$s as p4,$Ve as p5,Wv as p6,Da as p7,PVe as p8,Qh as p9,RVe as pA,MVe as pB,TVe as pC,XVe as pD,HVe as pE,jVe as pF,qTt as pG,qVe as pH,WVe as pI,SVe as pJ,EVe as pK,OVe as pL,BVe as pM,TY as pN,YTt as pO,_Ve as pP,bVe as pQ,yVe as pR,gVe as pS,AS as pT,v2e as pU,fft as pV,K2 as pW,E8e as pX,LHe as pY,eWe as pZ,Y1e as p_,CVe as pa,xVe as pb,wVe as pc,$w as pd,hu as pe,cve as pf,aze as pg,mVe as ph,vVe as pi,Lt as pj,lve as pk,ua as pl,IVe as pm,AVe as pn,mx as po,RW as pp,DVe as pq,LVe as pr,NVe as ps,DY as pt,kVe as pu,FVe as pv,UVe as pw,uX as px,bR as py,hVe as pz,ZE as q,wUe as q$,oXe as q0,zZ as q1,uXe as q2,OXe as q3,UXe as q4,cet as q5,G4 as q6,Xrt as q7,Krt as q8,krt as q9,QU as qA,Pdt as qB,W4 as qC,Vit as qD,V2e as qE,agt as qF,AJ as qG,cyt as qH,K2e as qI,dyt as qJ,eEe as qK,fyt as qL,tEe as qM,Myt as qN,cz as qO,Nyt as qP,Hyt as qQ,Y5 as qR,fxt as qS,bxt as qT,c4e as qU,Vye as qV,i7 as qW,A7 as qX,b7 as qY,EI as qZ,qd as q_,wn as qa,po as qb,Adt as qc,Q2e as qd,kgt as qe,nI as qf,Hz as qg,RPe as qh,UWe as qi,Ytt as qj,mTt as qk,fTt as ql,dTt as qm,SS as qn,J5e as qo,pTt as qp,gTt as qq,Z5e as qr,DP as qs,yst as qt,vTt as qu,_Tt as qv,cTt as qw,Nrt as qx,Rdt as qy,Odt as qz,_ as r,fve as r$,v8e as r0,xc as r1,lUe as r2,oue as r3,WX as r4,PCe as r5,Zxt as r6,drt as r7,Ryt as r8,a0t as r9,q8e as rA,od as rB,J5 as rC,M_ as rD,i9e as rE,I8e as rF,L8e as rG,m9e as rH,IK as rI,Hde as rJ,V9e as rK,QY as rL,kk as rM,sre as rN,YL as rO,Nk as rP,j8e as rQ,tZ as rR,i_e as rS,Cve as rT,qe as rU,F8 as rV,y6 as rW,KAe as rX,Q9e as rY,oC as rZ,rr as r_,ant as ra,Knt as rb,mlt as rc,klt as rd,Ilt as re,P8e as rf,d9e as rg,h9e as rh,_pe as ri,x8e as rj,dZ as rk,hSt as rl,W8e as rm,Y8e as rn,C8e as ro,YY as rp,M8e as rq,O8e as rr,aue as rs,o_ as rt,_je as ru,yje as rv,fje as rw,Are as rx,Ba as ry,tR as rz,qt as s,L9e as s$,vve as s0,fke as s1,gBe as s2,mke as s3,Tve as s4,Rve as s5,h4 as s6,Iwt as s7,pve as s8,d4 as s9,GE as sA,wfe as sB,aSt as sC,fp as sD,pxt as sE,Ype as sF,X8e as sG,lSt as sH,mOe as sI,uK as sJ,N as sK,wxt as sL,Kme as sM,nLe as sN,ia as sO,Tje as sP,eSt as sQ,QGe as sR,__e as sS,x_e as sT,rb as sU,aZ as sV,oZ as sW,qGe as sX,NTt as sY,lZ as sZ,D9e as s_,A8e as sa,Vwt as sb,ns as sc,Awt as sd,Ew as se,axt as sf,E_ as sg,uW as sh,NT as si,Y9e as sj,uF as sk,EO as sl,AG as sm,$_e as sn,cm as so,rm as sp,dpe as sq,Wpe as sr,vwt as ss,KBe as st,Xv as su,Jie as sv,N2 as sw,jY as sx,Q8e as sy,Z8e as sz,M as t,xTt as t$,N9e as t0,HTt as t1,mie as t2,FTt as t3,fie as t4,VVe as t5,jTt as t6,XTt as t7,WTt as t8,UTt as t9,kO as tA,Lb as tB,jn as tC,$l as tD,ed as tE,tT as tF,Nwt as tG,NQ as tH,Cot as tI,KTe as tJ,bot as tK,rSe as tL,tSe as tM,Eot as tN,ZH as tO,iSe as tP,f_ as tQ,wot as tR,p_ as tS,UH as tT,Bw as tU,uit as tV,eat as tW,Kot as tX,Jot as tY,MSt as tZ,F3e as t_,kTt as ta,zTt as tb,VTt as tc,GTt as td,fVe as te,yie as tf,BTt as tg,zVe as th,Dk as ti,hve as tj,dve as tk,rX as tl,Qu as tm,qnt as tn,t2t as to,xm as tp,Dqe as tq,fDe as tr,dDe as ts,Gf as tt,WTe as tu,cW as tv,Sqe as tw,gxt as tx,sSe as ty,oSe as tz,Q_e as u,TTt as u0,JTt as u1,gSt as u2,HSt as u3,c2t as u4,$u as v,GW as w,rEt as x,Se as y,lt as z};
